(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function tu(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function $4(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){var i=!1;try{i=this instanceof r}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Qv={exports:{}},Ih={},Zv={exports:{}},en={};var S2;function X4(){if(S2)return en;S2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function f(z){return z===null||typeof z!="object"?null:(z=h&&z[h]||z["@@iterator"],typeof z=="function"?z:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,w={};function v(z,q,re){this.props=z,this.context=q,this.refs=w,this.updater=re||m}v.prototype.isReactComponent={},v.prototype.setState=function(z,q){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,q,"setState")},v.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function y(){}y.prototype=v.prototype;function x(z,q,re){this.props=z,this.context=q,this.refs=w,this.updater=re||m}var E=x.prototype=new y;E.constructor=x,g(E,v.prototype),E.isPureReactComponent=!0;var _=Array.isArray,k=Object.prototype.hasOwnProperty,C={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function I(z,q,re){var de,ye={},te=null,ie=null;if(q!=null)for(de in q.ref!==void 0&&(ie=q.ref),q.key!==void 0&&(te=""+q.key),q)k.call(q,de)&&!A.hasOwnProperty(de)&&(ye[de]=q[de]);var fe=arguments.length-2;if(fe===1)ye.children=re;else if(1<fe){for(var Re=Array(fe),De=0;De<fe;De++)Re[De]=arguments[De+2];ye.children=Re}if(z&&z.defaultProps)for(de in fe=z.defaultProps,fe)ye[de]===void 0&&(ye[de]=fe[de]);return{$$typeof:n,type:z,key:te,ref:ie,props:ye,_owner:C.current}}function T(z,q){return{$$typeof:n,type:z.type,key:q,ref:z.ref,props:z.props,_owner:z._owner}}function R(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function N(z){var q={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(re){return q[re]})}var O=/\/+/g;function V(z,q){return typeof z=="object"&&z!==null&&z.key!=null?N(""+z.key):q.toString(36)}function F(z,q,re,de,ye){var te=typeof z;(te==="undefined"||te==="boolean")&&(z=null);var ie=!1;if(z===null)ie=!0;else switch(te){case"string":case"number":ie=!0;break;case"object":switch(z.$$typeof){case n:case e:ie=!0}}if(ie)return ie=z,ye=ye(ie),z=de===""?"."+V(ie,0):de,_(ye)?(re="",z!=null&&(re=z.replace(O,"$&/")+"/"),F(ye,q,re,"",function(De){return De})):ye!=null&&(R(ye)&&(ye=T(ye,re+(!ye.key||ie&&ie.key===ye.key?"":(""+ye.key).replace(O,"$&/")+"/")+z)),q.push(ye)),1;if(ie=0,de=de===""?".":de+":",_(z))for(var fe=0;fe<z.length;fe++){te=z[fe];var Re=de+V(te,fe);ie+=F(te,q,re,Re,ye)}else if(Re=f(z),typeof Re=="function")for(z=Re.call(z),fe=0;!(te=z.next()).done;)te=te.value,Re=de+V(te,fe++),ie+=F(te,q,re,Re,ye);else if(te==="object")throw q=String(z),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.");return ie}function B(z,q,re){if(z==null)return z;var de=[],ye=0;return F(z,de,"","",function(te){return q.call(re,te,ye++)}),de}function U(z){if(z._status===-1){var q=z._result;q=q(),q.then(function(re){(z._status===0||z._status===-1)&&(z._status=1,z._result=re)},function(re){(z._status===0||z._status===-1)&&(z._status=2,z._result=re)}),z._status===-1&&(z._status=0,z._result=q)}if(z._status===1)return z._result.default;throw z._result}var P={current:null},L={transition:null},H={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:L,ReactCurrentOwner:C};function W(){throw Error("act(...) is not supported in production builds of React.")}return en.Children={map:B,forEach:function(z,q,re){B(z,function(){q.apply(this,arguments)},re)},count:function(z){var q=0;return B(z,function(){q++}),q},toArray:function(z){return B(z,function(q){return q})||[]},only:function(z){if(!R(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},en.Component=v,en.Fragment=t,en.Profiler=i,en.PureComponent=x,en.StrictMode=r,en.Suspense=u,en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,en.act=W,en.cloneElement=function(z,q,re){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var de=g({},z.props),ye=z.key,te=z.ref,ie=z._owner;if(q!=null){if(q.ref!==void 0&&(te=q.ref,ie=C.current),q.key!==void 0&&(ye=""+q.key),z.type&&z.type.defaultProps)var fe=z.type.defaultProps;for(Re in q)k.call(q,Re)&&!A.hasOwnProperty(Re)&&(de[Re]=q[Re]===void 0&&fe!==void 0?fe[Re]:q[Re])}var Re=arguments.length-2;if(Re===1)de.children=re;else if(1<Re){fe=Array(Re);for(var De=0;De<Re;De++)fe[De]=arguments[De+2];de.children=fe}return{$$typeof:n,type:z.type,key:ye,ref:te,props:de,_owner:ie}},en.createContext=function(z){return z={$$typeof:a,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:o,_context:z},z.Consumer=z},en.createElement=I,en.createFactory=function(z){var q=I.bind(null,z);return q.type=z,q},en.createRef=function(){return{current:null}},en.forwardRef=function(z){return{$$typeof:s,render:z}},en.isValidElement=R,en.lazy=function(z){return{$$typeof:c,_payload:{_status:-1,_result:z},_init:U}},en.memo=function(z,q){return{$$typeof:l,type:z,compare:q===void 0?null:q}},en.startTransition=function(z){var q=L.transition;L.transition={};try{z()}finally{L.transition=q}},en.unstable_act=W,en.useCallback=function(z,q){return P.current.useCallback(z,q)},en.useContext=function(z){return P.current.useContext(z)},en.useDebugValue=function(){},en.useDeferredValue=function(z){return P.current.useDeferredValue(z)},en.useEffect=function(z,q){return P.current.useEffect(z,q)},en.useId=function(){return P.current.useId()},en.useImperativeHandle=function(z,q,re){return P.current.useImperativeHandle(z,q,re)},en.useInsertionEffect=function(z,q){return P.current.useInsertionEffect(z,q)},en.useLayoutEffect=function(z,q){return P.current.useLayoutEffect(z,q)},en.useMemo=function(z,q){return P.current.useMemo(z,q)},en.useReducer=function(z,q,re){return P.current.useReducer(z,q,re)},en.useRef=function(z){return P.current.useRef(z)},en.useState=function(z){return P.current.useState(z)},en.useSyncExternalStore=function(z,q,re){return P.current.useSyncExternalStore(z,q,re)},en.useTransition=function(){return P.current.useTransition()},en.version="18.3.1",en}var E2;function qc(){return E2||(E2=1,Zv.exports=X4()),Zv.exports}var k2;function Y4(){if(k2)return Ih;k2=1;var n=qc(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,i=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(s,u,l){var c,h={},f=null,m=null;l!==void 0&&(f=""+l),u.key!==void 0&&(f=""+u.key),u.ref!==void 0&&(m=u.ref);for(c in u)r.call(u,c)&&!o.hasOwnProperty(c)&&(h[c]=u[c]);if(s&&s.defaultProps)for(c in u=s.defaultProps,u)h[c]===void 0&&(h[c]=u[c]);return{$$typeof:e,type:s,key:f,ref:m,props:h,_owner:i.current}}return Ih.Fragment=t,Ih.jsx=a,Ih.jsxs=a,Ih}var C2;function K4(){return C2||(C2=1,Qv.exports=Y4()),Qv.exports}var ne=K4(),Gf={},ey={exports:{}},hi={},ty={exports:{}},ny={};var T2;function J4(){return T2||(T2=1,(function(n){function e(L,H){var W=L.length;L.push(H);e:for(;0<W;){var z=W-1>>>1,q=L[z];if(0<i(q,H))L[z]=H,L[W]=q,W=z;else break e}}function t(L){return L.length===0?null:L[0]}function r(L){if(L.length===0)return null;var H=L[0],W=L.pop();if(W!==H){L[0]=W;e:for(var z=0,q=L.length,re=q>>>1;z<re;){var de=2*(z+1)-1,ye=L[de],te=de+1,ie=L[te];if(0>i(ye,W))te<q&&0>i(ie,ye)?(L[z]=ie,L[te]=W,z=te):(L[z]=ye,L[de]=W,z=de);else if(te<q&&0>i(ie,W))L[z]=ie,L[te]=W,z=te;else break e}}return H}function i(L,H){var W=L.sortIndex-H.sortIndex;return W!==0?W:L.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();n.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,h=null,f=3,m=!1,g=!1,w=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(L){for(var H=t(l);H!==null;){if(H.callback===null)r(l);else if(H.startTime<=L)r(l),H.sortIndex=H.expirationTime,e(u,H);else break;H=t(l)}}function _(L){if(w=!1,E(L),!g)if(t(u)!==null)g=!0,U(k);else{var H=t(l);H!==null&&P(_,H.startTime-L)}}function k(L,H){g=!1,w&&(w=!1,y(I),I=-1),m=!0;var W=f;try{for(E(H),h=t(u);h!==null&&(!(h.expirationTime>H)||L&&!N());){var z=h.callback;if(typeof z=="function"){h.callback=null,f=h.priorityLevel;var q=z(h.expirationTime<=H);H=n.unstable_now(),typeof q=="function"?h.callback=q:h===t(u)&&r(u),E(H)}else r(u);h=t(u)}if(h!==null)var re=!0;else{var de=t(l);de!==null&&P(_,de.startTime-H),re=!1}return re}finally{h=null,f=W,m=!1}}var C=!1,A=null,I=-1,T=5,R=-1;function N(){return!(n.unstable_now()-R<T)}function O(){if(A!==null){var L=n.unstable_now();R=L;var H=!0;try{H=A(!0,L)}finally{H?V():(C=!1,A=null)}}else C=!1}var V;if(typeof x=="function")V=function(){x(O)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,B=F.port2;F.port1.onmessage=O,V=function(){B.postMessage(null)}}else V=function(){v(O,0)};function U(L){A=L,C||(C=!0,V())}function P(L,H){I=v(function(){L(n.unstable_now())},H)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(L){L.callback=null},n.unstable_continueExecution=function(){g||m||(g=!0,U(k))},n.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<L?Math.floor(1e3/L):5},n.unstable_getCurrentPriorityLevel=function(){return f},n.unstable_getFirstCallbackNode=function(){return t(u)},n.unstable_next=function(L){switch(f){case 1:case 2:case 3:var H=3;break;default:H=f}var W=f;f=H;try{return L()}finally{f=W}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(L,H){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var W=f;f=L;try{return H()}finally{f=W}},n.unstable_scheduleCallback=function(L,H,W){var z=n.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?z+W:z):W=z,L){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=W+q,L={id:c++,callback:H,priorityLevel:L,startTime:W,expirationTime:q,sortIndex:-1},W>z?(L.sortIndex=W,e(l,L),t(u)===null&&L===t(l)&&(w?(y(I),I=-1):w=!0,P(_,W-z))):(L.sortIndex=q,e(u,L),g||m||(g=!0,U(k))),L},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(L){var H=f;return function(){var W=f;f=H;try{return L.apply(this,arguments)}finally{f=W}}}})(ny)),ny}var M2;function Q4(){return M2||(M2=1,ty.exports=J4()),ty.exports}var R2;function Z4(){if(R2)return hi;R2=1;var n=qc(),e=Q4();function t(d){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+d,b=1;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,i={};function o(d,p){a(d,p),a(d+"Capture",p)}function a(d,p){for(i[d]=p,d=0;d<p.length;d++)r.add(p[d])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,l=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function f(d){return u.call(h,d)?!0:u.call(c,d)?!1:l.test(d)?h[d]=!0:(c[d]=!0,!1)}function m(d,p,b,S){if(b!==null&&b.type===0)return!1;switch(typeof p){case"function":case"symbol":return!0;case"boolean":return S?!1:b!==null?!b.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function g(d,p,b,S){if(p===null||typeof p>"u"||m(d,p,b,S))return!0;if(S)return!1;if(b!==null)switch(b.type){case 3:return!p;case 4:return p===!1;case 5:return isNaN(p);case 6:return isNaN(p)||1>p}return!1}function w(d,p,b,S,M,D,G){this.acceptsBooleans=p===2||p===3||p===4,this.attributeName=S,this.attributeNamespace=M,this.mustUseProperty=b,this.propertyName=d,this.type=p,this.sanitizeURL=D,this.removeEmptyString=G}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){v[d]=new w(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var p=d[0];v[p]=new w(p,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){v[d]=new w(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){v[d]=new w(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){v[d]=new w(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){v[d]=new w(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){v[d]=new w(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){v[d]=new w(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){v[d]=new w(d,5,!1,d.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function x(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var p=d.replace(y,x);v[p]=new w(p,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var p=d.replace(y,x);v[p]=new w(p,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var p=d.replace(y,x);v[p]=new w(p,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){v[d]=new w(d,1,!1,d.toLowerCase(),null,!1,!1)}),v.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){v[d]=new w(d,1,!1,d.toLowerCase(),null,!0,!0)});function E(d,p,b,S){var M=v.hasOwnProperty(p)?v[p]:null;(M!==null?M.type!==0:S||!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(g(p,b,M,S)&&(b=null),S||M===null?f(p)&&(b===null?d.removeAttribute(p):d.setAttribute(p,""+b)):M.mustUseProperty?d[M.propertyName]=b===null?M.type===3?!1:"":b:(p=M.attributeName,S=M.attributeNamespace,b===null?d.removeAttribute(p):(M=M.type,b=M===3||M===4&&b===!0?"":""+b,S?d.setAttributeNS(S,p,b):d.setAttribute(p,b))))}var _=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),C=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),R=Symbol.for("react.provider"),N=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),L=Symbol.iterator;function H(d){return d===null||typeof d!="object"?null:(d=L&&d[L]||d["@@iterator"],typeof d=="function"?d:null)}var W=Object.assign,z;function q(d){if(z===void 0)try{throw Error()}catch(b){var p=b.stack.trim().match(/\n( *(at )?)/);z=p&&p[1]||""}return`
`+z+d}var re=!1;function de(d,p){if(!d||re)return"";re=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(Se){var S=Se}Reflect.construct(d,[],p)}else{try{p.call()}catch(Se){S=Se}d.call(p.prototype)}else{try{throw Error()}catch(Se){S=Se}d()}}catch(Se){if(Se&&S&&typeof Se.stack=="string"){for(var M=Se.stack.split(`
`),D=S.stack.split(`
`),G=M.length-1,Z=D.length-1;1<=G&&0<=Z&&M[G]!==D[Z];)Z--;for(;1<=G&&0<=Z;G--,Z--)if(M[G]!==D[Z]){if(G!==1||Z!==1)do if(G--,Z--,0>Z||M[G]!==D[Z]){var ae=`
`+M[G].replace(" at new "," at ");return d.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",d.displayName)),ae}while(1<=G&&0<=Z);break}}}finally{re=!1,Error.prepareStackTrace=b}return(d=d?d.displayName||d.name:"")?q(d):""}function ye(d){switch(d.tag){case 5:return q(d.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return d=de(d.type,!1),d;case 11:return d=de(d.type.render,!1),d;case 1:return d=de(d.type,!0),d;default:return""}}function te(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case A:return"Fragment";case C:return"Portal";case T:return"Profiler";case I:return"StrictMode";case V:return"Suspense";case F:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case N:return(d.displayName||"Context")+".Consumer";case R:return(d._context.displayName||"Context")+".Provider";case O:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case B:return p=d.displayName||null,p!==null?p:te(d.type)||"Memo";case U:p=d._payload,d=d._init;try{return te(d(p))}catch{}}return null}function ie(d){var p=d.type;switch(d.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=p.render,d=d.displayName||d.name||"",p.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return te(p);case 8:return p===I?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function fe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Re(d){var p=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function De(d){var p=Re(d)?"checked":"value",b=Object.getOwnPropertyDescriptor(d.constructor.prototype,p),S=""+d[p];if(!d.hasOwnProperty(p)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var M=b.get,D=b.set;return Object.defineProperty(d,p,{configurable:!0,get:function(){return M.call(this)},set:function(G){S=""+G,D.call(this,G)}}),Object.defineProperty(d,p,{enumerable:b.enumerable}),{getValue:function(){return S},setValue:function(G){S=""+G},stopTracking:function(){d._valueTracker=null,delete d[p]}}}}function Be(d){d._valueTracker||(d._valueTracker=De(d))}function lt(d){if(!d)return!1;var p=d._valueTracker;if(!p)return!0;var b=p.getValue(),S="";return d&&(S=Re(d)?d.checked?"true":"false":d.value),d=S,d!==b?(p.setValue(d),!0):!1}function Y(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function ot(d,p){var b=p.checked;return W({},p,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??d._wrapperState.initialChecked})}function Ke(d,p){var b=p.defaultValue==null?"":p.defaultValue,S=p.checked!=null?p.checked:p.defaultChecked;b=fe(p.value!=null?p.value:b),d._wrapperState={initialChecked:S,initialValue:b,controlled:p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null}}function Xe(d,p){p=p.checked,p!=null&&E(d,"checked",p,!1)}function qe(d,p){Xe(d,p);var b=fe(p.value),S=p.type;if(b!=null)S==="number"?(b===0&&d.value===""||d.value!=b)&&(d.value=""+b):d.value!==""+b&&(d.value=""+b);else if(S==="submit"||S==="reset"){d.removeAttribute("value");return}p.hasOwnProperty("value")?Qe(d,p.type,b):p.hasOwnProperty("defaultValue")&&Qe(d,p.type,fe(p.defaultValue)),p.checked==null&&p.defaultChecked!=null&&(d.defaultChecked=!!p.defaultChecked)}function Tt(d,p,b){if(p.hasOwnProperty("value")||p.hasOwnProperty("defaultValue")){var S=p.type;if(!(S!=="submit"&&S!=="reset"||p.value!==void 0&&p.value!==null))return;p=""+d._wrapperState.initialValue,b||p===d.value||(d.value=p),d.defaultValue=p}b=d.name,b!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,b!==""&&(d.name=b)}function Qe(d,p,b){(p!=="number"||Y(d.ownerDocument)!==d)&&(b==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+b&&(d.defaultValue=""+b))}var ft=Array.isArray;function Mt(d,p,b,S){if(d=d.options,p){p={};for(var M=0;M<b.length;M++)p["$"+b[M]]=!0;for(b=0;b<d.length;b++)M=p.hasOwnProperty("$"+d[b].value),d[b].selected!==M&&(d[b].selected=M),M&&S&&(d[b].defaultSelected=!0)}else{for(b=""+fe(b),p=null,M=0;M<d.length;M++){if(d[M].value===b){d[M].selected=!0,S&&(d[M].defaultSelected=!0);return}p!==null||d[M].disabled||(p=d[M])}p!==null&&(p.selected=!0)}}function Ut(d,p){if(p.dangerouslySetInnerHTML!=null)throw Error(t(91));return W({},p,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Q(d,p){var b=p.value;if(b==null){if(b=p.children,p=p.defaultValue,b!=null){if(p!=null)throw Error(t(92));if(ft(b)){if(1<b.length)throw Error(t(93));b=b[0]}p=b}p==null&&(p=""),b=p}d._wrapperState={initialValue:fe(b)}}function j(d,p){var b=fe(p.value),S=fe(p.defaultValue);b!=null&&(b=""+b,b!==d.value&&(d.value=b),p.defaultValue==null&&d.defaultValue!==b&&(d.defaultValue=b)),S!=null&&(d.defaultValue=""+S)}function me(d){var p=d.textContent;p===d._wrapperState.initialValue&&p!==""&&p!==null&&(d.value=p)}function Ae(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pe(d,p){return d==null||d==="http://www.w3.org/1999/xhtml"?Ae(p):d==="http://www.w3.org/2000/svg"&&p==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var ke,Ue=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(p,b,S,M){MSApp.execUnsafeLocalFunction(function(){return d(p,b,S,M)})}:d})(function(d,p){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=p;else{for(ke=ke||document.createElement("div"),ke.innerHTML="<svg>"+p.valueOf().toString()+"</svg>",p=ke.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;p.firstChild;)d.appendChild(p.firstChild)}});function _e(d,p){if(p){var b=d.firstChild;if(b&&b===d.lastChild&&b.nodeType===3){b.nodeValue=p;return}}d.textContent=p}var rt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Je=["Webkit","ms","Moz","O"];Object.keys(rt).forEach(function(d){Je.forEach(function(p){p=p+d.charAt(0).toUpperCase()+d.substring(1),rt[p]=rt[d]})});function Oe(d,p,b){return p==null||typeof p=="boolean"||p===""?"":b||typeof p!="number"||p===0||rt.hasOwnProperty(d)&&rt[d]?(""+p).trim():p+"px"}function $e(d,p){d=d.style;for(var b in p)if(p.hasOwnProperty(b)){var S=b.indexOf("--")===0,M=Oe(b,p[b],S);b==="float"&&(b="cssFloat"),S?d.setProperty(b,M):d[b]=M}}var pt=W({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function nt(d,p){if(p){if(pt[d]&&(p.children!=null||p.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(p.dangerouslySetInnerHTML!=null){if(p.children!=null)throw Error(t(60));if(typeof p.dangerouslySetInnerHTML!="object"||!("__html"in p.dangerouslySetInnerHTML))throw Error(t(61))}if(p.style!=null&&typeof p.style!="object")throw Error(t(62))}}function tt(d,p){if(d.indexOf("-")===-1)return typeof p.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nt=null;function se(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var He=null,Ve=null,it=null;function We(d){if(d=gh(d)){if(typeof He!="function")throw Error(t(280));var p=d.stateNode;p&&(p=rf(p),He(d.stateNode,d.type,p))}}function Fe(d){Ve?it?it.push(d):it=[d]:Ve=d}function gt(){if(Ve){var d=Ve,p=it;if(it=Ve=null,We(d),p)for(d=0;d<p.length;d++)We(p[d])}}function Ht(d,p){return d(p)}function bn(){}var an=!1;function oi(d,p,b){if(an)return d(p,b);an=!0;try{return Ht(d,p,b)}finally{an=!1,(Ve!==null||it!==null)&&(bn(),gt())}}function fr(d,p){var b=d.stateNode;if(b===null)return null;var S=rf(b);if(S===null)return null;b=S[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(d=d.type,S=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!S;break e;default:d=!1}if(d)return null;if(b&&typeof b!="function")throw Error(t(231,p,typeof b));return b}var os=!1;if(s)try{var pr={};Object.defineProperty(pr,"passive",{get:function(){os=!0}}),window.addEventListener("test",pr,pr),window.removeEventListener("test",pr,pr)}catch{os=!1}function Ho(d,p,b,S,M,D,G,Z,ae){var Se=Array.prototype.slice.call(arguments,3);try{p.apply(b,Se)}catch(Ge){this.onError(Ge)}}var Go=!1,Hi=null,Gi=!1,co=null,as={onError:function(d){Go=!0,Hi=d}};function fl(d,p,b,S,M,D,G,Z,ae){Go=!1,Hi=null,Ho.apply(as,arguments)}function pl(d,p,b,S,M,D,G,Z,ae){if(fl.apply(this,arguments),Go){if(Go){var Se=Hi;Go=!1,Hi=null}else throw Error(t(198));Gi||(Gi=!0,co=Se)}}function ho(d){var p=d,b=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,(p.flags&4098)!==0&&(b=p.return),d=p.return;while(d)}return p.tag===3?b:null}function ml(d){if(d.tag===13){var p=d.memoizedState;if(p===null&&(d=d.alternate,d!==null&&(p=d.memoizedState)),p!==null)return p.dehydrated}return null}function ss(d){if(ho(d)!==d)throw Error(t(188))}function _g(d){var p=d.alternate;if(!p){if(p=ho(d),p===null)throw Error(t(188));return p!==d?null:d}for(var b=d,S=p;;){var M=b.return;if(M===null)break;var D=M.alternate;if(D===null){if(S=M.return,S!==null){b=S;continue}break}if(M.child===D.child){for(D=M.child;D;){if(D===b)return ss(M),d;if(D===S)return ss(M),p;D=D.sibling}throw Error(t(188))}if(b.return!==S.return)b=M,S=D;else{for(var G=!1,Z=M.child;Z;){if(Z===b){G=!0,b=M,S=D;break}if(Z===S){G=!0,S=M,b=D;break}Z=Z.sibling}if(!G){for(Z=D.child;Z;){if(Z===b){G=!0,b=D,S=M;break}if(Z===S){G=!0,S=D,b=M;break}Z=Z.sibling}if(!G)throw Error(t(189))}}if(b.alternate!==S)throw Error(t(190))}if(b.tag!==3)throw Error(t(188));return b.stateNode.current===b?d:p}function zd(d){return d=_g(d),d!==null?Wd(d):null}function Wd(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var p=Wd(d);if(p!==null)return p;d=d.sibling}return null}var $=e.unstable_scheduleCallback,pe=e.unstable_cancelCallback,Ee=e.unstable_shouldYield,Ce=e.unstable_requestPaint,he=e.unstable_now,Ye=e.unstable_getCurrentPriorityLevel,st=e.unstable_ImmediatePriority,vt=e.unstable_UserBlockingPriority,ct=e.unstable_NormalPriority,Bt=e.unstable_LowPriority,zt=e.unstable_IdlePriority,Rt=null,jt=null;function xn(d){if(jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot(Rt,d,void 0,(d.current.flags&128)===128)}catch{}}var ln=Math.clz32?Math.clz32:Ft,An=Math.log,kn=Math.LN2;function Ft(d){return d>>>=0,d===0?32:31-(An(d)/kn|0)|0}var Tn=64,nn=4194304;function tr(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function fo(d,p){var b=d.pendingLanes;if(b===0)return 0;var S=0,M=d.suspendedLanes,D=d.pingedLanes,G=b&268435455;if(G!==0){var Z=G&~M;Z!==0?S=tr(Z):(D&=G,D!==0&&(S=tr(D)))}else G=b&~M,G!==0?S=tr(G):D!==0&&(S=tr(D));if(S===0)return 0;if(p!==0&&p!==S&&(p&M)===0&&(M=S&-S,D=p&-p,M>=D||M===16&&(D&4194240)!==0))return p;if((S&4)!==0&&(S|=b&16),p=d.entangledLanes,p!==0)for(d=d.entanglements,p&=S;0<p;)b=31-ln(p),M=1<<b,S|=d[b],p&=~M;return S}function Yr(d,p){switch(d){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lu(d,p){for(var b=d.suspendedLanes,S=d.pingedLanes,M=d.expirationTimes,D=d.pendingLanes;0<D;){var G=31-ln(D),Z=1<<G,ae=M[G];ae===-1?((Z&b)===0||(Z&S)!==0)&&(M[G]=Yr(Z,p)):ae<=p&&(d.expiredLanes|=Z),D&=~Z}}function In(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Kr(){var d=Tn;return Tn<<=1,(Tn&4194240)===0&&(Tn=64),d}function Rr(d){for(var p=[],b=0;31>b;b++)p.push(d);return p}function Yn(d,p,b){d.pendingLanes|=p,p!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,p=31-ln(p),d[p]=b}function Ar(d,p){var b=d.pendingLanes&~p;d.pendingLanes=p,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=p,d.mutableReadLanes&=p,d.entangledLanes&=p,p=d.entanglements;var S=d.eventTimes;for(d=d.expirationTimes;0<b;){var M=31-ln(b),D=1<<M;p[M]=0,S[M]=-1,d[M]=-1,b&=~D}}function cu(d,p){var b=d.entangledLanes|=p;for(d=d.entanglements;b;){var S=31-ln(b),M=1<<S;M&p|d[S]&p&&(d[S]|=p),b&=~M}}var rn=0;function t1(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var n1,xg,r1,i1,o1,Sg=!1,Hd=[],us=null,ls=null,cs=null,eh=new Map,th=new Map,hs=[],mA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function a1(d,p){switch(d){case"focusin":case"focusout":us=null;break;case"dragenter":case"dragleave":ls=null;break;case"mouseover":case"mouseout":cs=null;break;case"pointerover":case"pointerout":eh.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":th.delete(p.pointerId)}}function nh(d,p,b,S,M,D){return d===null||d.nativeEvent!==D?(d={blockedOn:p,domEventName:b,eventSystemFlags:S,nativeEvent:D,targetContainers:[M]},p!==null&&(p=gh(p),p!==null&&xg(p)),d):(d.eventSystemFlags|=S,p=d.targetContainers,M!==null&&p.indexOf(M)===-1&&p.push(M),d)}function gA(d,p,b,S,M){switch(p){case"focusin":return us=nh(us,d,p,b,S,M),!0;case"dragenter":return ls=nh(ls,d,p,b,S,M),!0;case"mouseover":return cs=nh(cs,d,p,b,S,M),!0;case"pointerover":var D=M.pointerId;return eh.set(D,nh(eh.get(D)||null,d,p,b,S,M)),!0;case"gotpointercapture":return D=M.pointerId,th.set(D,nh(th.get(D)||null,d,p,b,S,M)),!0}return!1}function s1(d){var p=hu(d.target);if(p!==null){var b=ho(p);if(b!==null){if(p=b.tag,p===13){if(p=ml(b),p!==null){d.blockedOn=p,o1(d.priority,function(){r1(b)});return}}else if(p===3&&b.stateNode.current.memoizedState.isDehydrated){d.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Gd(d){if(d.blockedOn!==null)return!1;for(var p=d.targetContainers;0<p.length;){var b=kg(d.domEventName,d.eventSystemFlags,p[0],d.nativeEvent);if(b===null){b=d.nativeEvent;var S=new b.constructor(b.type,b);Nt=S,b.target.dispatchEvent(S),Nt=null}else return p=gh(b),p!==null&&xg(p),d.blockedOn=b,!1;p.shift()}return!0}function u1(d,p,b){Gd(d)&&b.delete(p)}function vA(){Sg=!1,us!==null&&Gd(us)&&(us=null),ls!==null&&Gd(ls)&&(ls=null),cs!==null&&Gd(cs)&&(cs=null),eh.forEach(u1),th.forEach(u1)}function rh(d,p){d.blockedOn===p&&(d.blockedOn=null,Sg||(Sg=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,vA)))}function ih(d){function p(M){return rh(M,d)}if(0<Hd.length){rh(Hd[0],d);for(var b=1;b<Hd.length;b++){var S=Hd[b];S.blockedOn===d&&(S.blockedOn=null)}}for(us!==null&&rh(us,d),ls!==null&&rh(ls,d),cs!==null&&rh(cs,d),eh.forEach(p),th.forEach(p),b=0;b<hs.length;b++)S=hs[b],S.blockedOn===d&&(S.blockedOn=null);for(;0<hs.length&&(b=hs[0],b.blockedOn===null);)s1(b),b.blockedOn===null&&hs.shift()}var gl=_.ReactCurrentBatchConfig,Vd=!0;function yA(d,p,b,S){var M=rn,D=gl.transition;gl.transition=null;try{rn=1,Eg(d,p,b,S)}finally{rn=M,gl.transition=D}}function bA(d,p,b,S){var M=rn,D=gl.transition;gl.transition=null;try{rn=4,Eg(d,p,b,S)}finally{rn=M,gl.transition=D}}function Eg(d,p,b,S){if(Vd){var M=kg(d,p,b,S);if(M===null)Hg(d,p,S,jd,b),a1(d,S);else if(gA(M,d,p,b,S))S.stopPropagation();else if(a1(d,S),p&4&&-1<mA.indexOf(d)){for(;M!==null;){var D=gh(M);if(D!==null&&n1(D),D=kg(d,p,b,S),D===null&&Hg(d,p,S,jd,b),D===M)break;M=D}M!==null&&S.stopPropagation()}else Hg(d,p,S,null,b)}}var jd=null;function kg(d,p,b,S){if(jd=null,d=se(S),d=hu(d),d!==null)if(p=ho(d),p===null)d=null;else if(b=p.tag,b===13){if(d=ml(p),d!==null)return d;d=null}else if(b===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;d=null}else p!==d&&(d=null);return jd=d,null}function l1(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ye()){case st:return 1;case vt:return 4;case ct:case Bt:return 16;case zt:return 536870912;default:return 16}default:return 16}}var ds=null,Cg=null,qd=null;function c1(){if(qd)return qd;var d,p=Cg,b=p.length,S,M="value"in ds?ds.value:ds.textContent,D=M.length;for(d=0;d<b&&p[d]===M[d];d++);var G=b-d;for(S=1;S<=G&&p[b-S]===M[D-S];S++);return qd=M.slice(d,1<S?1-S:void 0)}function $d(d){var p=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&p===13&&(d=13)):d=p,d===10&&(d=13),32<=d||d===13?d:0}function Xd(){return!0}function h1(){return!1}function Si(d){function p(b,S,M,D,G){this._reactName=b,this._targetInst=M,this.type=S,this.nativeEvent=D,this.target=G,this.currentTarget=null;for(var Z in d)d.hasOwnProperty(Z)&&(b=d[Z],this[Z]=b?b(D):D[Z]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Xd:h1,this.isPropagationStopped=h1,this}return W(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=Xd)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=Xd)},persist:function(){},isPersistent:Xd}),p}var vl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Tg=Si(vl),oh=W({},vl,{view:0,detail:0}),wA=Si(oh),Mg,Rg,ah,Yd=W({},oh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ig,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==ah&&(ah&&d.type==="mousemove"?(Mg=d.screenX-ah.screenX,Rg=d.screenY-ah.screenY):Rg=Mg=0,ah=d),Mg)},movementY:function(d){return"movementY"in d?d.movementY:Rg}}),d1=Si(Yd),_A=W({},Yd,{dataTransfer:0}),xA=Si(_A),SA=W({},oh,{relatedTarget:0}),Ag=Si(SA),EA=W({},vl,{animationName:0,elapsedTime:0,pseudoElement:0}),kA=Si(EA),CA=W({},vl,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),TA=Si(CA),MA=W({},vl,{data:0}),f1=Si(MA),RA={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},AA={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},IA={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function DA(d){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(d):(d=IA[d])?!!p[d]:!1}function Ig(){return DA}var NA=W({},oh,{key:function(d){if(d.key){var p=RA[d.key]||d.key;if(p!=="Unidentified")return p}return d.type==="keypress"?(d=$d(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?AA[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ig,charCode:function(d){return d.type==="keypress"?$d(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?$d(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),PA=Si(NA),FA=W({},Yd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),p1=Si(FA),OA=W({},oh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ig}),LA=Si(OA),BA=W({},vl,{propertyName:0,elapsedTime:0,pseudoElement:0}),UA=Si(BA),zA=W({},Yd,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),WA=Si(zA),HA=[9,13,27,32],Dg=s&&"CompositionEvent"in window,sh=null;s&&"documentMode"in document&&(sh=document.documentMode);var GA=s&&"TextEvent"in window&&!sh,m1=s&&(!Dg||sh&&8<sh&&11>=sh),g1=" ",v1=!1;function y1(d,p){switch(d){case"keyup":return HA.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function b1(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var yl=!1;function VA(d,p){switch(d){case"compositionend":return b1(p);case"keypress":return p.which!==32?null:(v1=!0,g1);case"textInput":return d=p.data,d===g1&&v1?null:d;default:return null}}function jA(d,p){if(yl)return d==="compositionend"||!Dg&&y1(d,p)?(d=c1(),qd=Cg=ds=null,yl=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return m1&&p.locale!=="ko"?null:p.data;default:return null}}var qA={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function w1(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p==="input"?!!qA[d.type]:p==="textarea"}function _1(d,p,b,S){Fe(S),p=ef(p,"onChange"),0<p.length&&(b=new Tg("onChange","change",null,b,S),d.push({event:b,listeners:p}))}var uh=null,lh=null;function $A(d){U1(d,0)}function Kd(d){var p=Sl(d);if(lt(p))return d}function XA(d,p){if(d==="change")return p}var x1=!1;if(s){var Ng;if(s){var Pg="oninput"in document;if(!Pg){var S1=document.createElement("div");S1.setAttribute("oninput","return;"),Pg=typeof S1.oninput=="function"}Ng=Pg}else Ng=!1;x1=Ng&&(!document.documentMode||9<document.documentMode)}function E1(){uh&&(uh.detachEvent("onpropertychange",k1),lh=uh=null)}function k1(d){if(d.propertyName==="value"&&Kd(lh)){var p=[];_1(p,lh,d,se(d)),oi($A,p)}}function YA(d,p,b){d==="focusin"?(E1(),uh=p,lh=b,uh.attachEvent("onpropertychange",k1)):d==="focusout"&&E1()}function KA(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Kd(lh)}function JA(d,p){if(d==="click")return Kd(p)}function QA(d,p){if(d==="input"||d==="change")return Kd(p)}function ZA(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var po=typeof Object.is=="function"?Object.is:ZA;function ch(d,p){if(po(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var b=Object.keys(d),S=Object.keys(p);if(b.length!==S.length)return!1;for(S=0;S<b.length;S++){var M=b[S];if(!u.call(p,M)||!po(d[M],p[M]))return!1}return!0}function C1(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function T1(d,p){var b=C1(d);d=0;for(var S;b;){if(b.nodeType===3){if(S=d+b.textContent.length,d<=p&&S>=p)return{node:b,offset:p-d};d=S}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=C1(b)}}function M1(d,p){return d&&p?d===p?!0:d&&d.nodeType===3?!1:p&&p.nodeType===3?M1(d,p.parentNode):"contains"in d?d.contains(p):d.compareDocumentPosition?!!(d.compareDocumentPosition(p)&16):!1:!1}function R1(){for(var d=window,p=Y();p instanceof d.HTMLIFrameElement;){try{var b=typeof p.contentWindow.location.href=="string"}catch{b=!1}if(b)d=p.contentWindow;else break;p=Y(d.document)}return p}function Fg(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p&&(p==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||p==="textarea"||d.contentEditable==="true")}function e4(d){var p=R1(),b=d.focusedElem,S=d.selectionRange;if(p!==b&&b&&b.ownerDocument&&M1(b.ownerDocument.documentElement,b)){if(S!==null&&Fg(b)){if(p=S.start,d=S.end,d===void 0&&(d=p),"selectionStart"in b)b.selectionStart=p,b.selectionEnd=Math.min(d,b.value.length);else if(d=(p=b.ownerDocument||document)&&p.defaultView||window,d.getSelection){d=d.getSelection();var M=b.textContent.length,D=Math.min(S.start,M);S=S.end===void 0?D:Math.min(S.end,M),!d.extend&&D>S&&(M=S,S=D,D=M),M=T1(b,D);var G=T1(b,S);M&&G&&(d.rangeCount!==1||d.anchorNode!==M.node||d.anchorOffset!==M.offset||d.focusNode!==G.node||d.focusOffset!==G.offset)&&(p=p.createRange(),p.setStart(M.node,M.offset),d.removeAllRanges(),D>S?(d.addRange(p),d.extend(G.node,G.offset)):(p.setEnd(G.node,G.offset),d.addRange(p)))}}for(p=[],d=b;d=d.parentNode;)d.nodeType===1&&p.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<p.length;b++)d=p[b],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var t4=s&&"documentMode"in document&&11>=document.documentMode,bl=null,Og=null,hh=null,Lg=!1;function A1(d,p,b){var S=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;Lg||bl==null||bl!==Y(S)||(S=bl,"selectionStart"in S&&Fg(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),hh&&ch(hh,S)||(hh=S,S=ef(Og,"onSelect"),0<S.length&&(p=new Tg("onSelect","select",null,p,b),d.push({event:p,listeners:S}),p.target=bl)))}function Jd(d,p){var b={};return b[d.toLowerCase()]=p.toLowerCase(),b["Webkit"+d]="webkit"+p,b["Moz"+d]="moz"+p,b}var wl={animationend:Jd("Animation","AnimationEnd"),animationiteration:Jd("Animation","AnimationIteration"),animationstart:Jd("Animation","AnimationStart"),transitionend:Jd("Transition","TransitionEnd")},Bg={},I1={};s&&(I1=document.createElement("div").style,"AnimationEvent"in window||(delete wl.animationend.animation,delete wl.animationiteration.animation,delete wl.animationstart.animation),"TransitionEvent"in window||delete wl.transitionend.transition);function Qd(d){if(Bg[d])return Bg[d];if(!wl[d])return d;var p=wl[d],b;for(b in p)if(p.hasOwnProperty(b)&&b in I1)return Bg[d]=p[b];return d}var D1=Qd("animationend"),N1=Qd("animationiteration"),P1=Qd("animationstart"),F1=Qd("transitionend"),O1=new Map,L1="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function fs(d,p){O1.set(d,p),o(p,[d])}for(var Ug=0;Ug<L1.length;Ug++){var zg=L1[Ug],n4=zg.toLowerCase(),r4=zg[0].toUpperCase()+zg.slice(1);fs(n4,"on"+r4)}fs(D1,"onAnimationEnd"),fs(N1,"onAnimationIteration"),fs(P1,"onAnimationStart"),fs("dblclick","onDoubleClick"),fs("focusin","onFocus"),fs("focusout","onBlur"),fs(F1,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var dh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),i4=new Set("cancel close invalid load scroll toggle".split(" ").concat(dh));function B1(d,p,b){var S=d.type||"unknown-event";d.currentTarget=b,pl(S,p,void 0,d),d.currentTarget=null}function U1(d,p){p=(p&4)!==0;for(var b=0;b<d.length;b++){var S=d[b],M=S.event;S=S.listeners;e:{var D=void 0;if(p)for(var G=S.length-1;0<=G;G--){var Z=S[G],ae=Z.instance,Se=Z.currentTarget;if(Z=Z.listener,ae!==D&&M.isPropagationStopped())break e;B1(M,Z,Se),D=ae}else for(G=0;G<S.length;G++){if(Z=S[G],ae=Z.instance,Se=Z.currentTarget,Z=Z.listener,ae!==D&&M.isPropagationStopped())break e;B1(M,Z,Se),D=ae}}}if(Gi)throw d=co,Gi=!1,co=null,d}function On(d,p){var b=p[Xg];b===void 0&&(b=p[Xg]=new Set);var S=d+"__bubble";b.has(S)||(z1(p,d,2,!1),b.add(S))}function Wg(d,p,b){var S=0;p&&(S|=4),z1(b,d,S,p)}var Zd="_reactListening"+Math.random().toString(36).slice(2);function fh(d){if(!d[Zd]){d[Zd]=!0,r.forEach(function(b){b!=="selectionchange"&&(i4.has(b)||Wg(b,!1,d),Wg(b,!0,d))});var p=d.nodeType===9?d:d.ownerDocument;p===null||p[Zd]||(p[Zd]=!0,Wg("selectionchange",!1,p))}}function z1(d,p,b,S){switch(l1(p)){case 1:var M=yA;break;case 4:M=bA;break;default:M=Eg}b=M.bind(null,p,b,d),M=void 0,!os||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(M=!0),S?M!==void 0?d.addEventListener(p,b,{capture:!0,passive:M}):d.addEventListener(p,b,!0):M!==void 0?d.addEventListener(p,b,{passive:M}):d.addEventListener(p,b,!1)}function Hg(d,p,b,S,M){var D=S;if((p&1)===0&&(p&2)===0&&S!==null)e:for(;;){if(S===null)return;var G=S.tag;if(G===3||G===4){var Z=S.stateNode.containerInfo;if(Z===M||Z.nodeType===8&&Z.parentNode===M)break;if(G===4)for(G=S.return;G!==null;){var ae=G.tag;if((ae===3||ae===4)&&(ae=G.stateNode.containerInfo,ae===M||ae.nodeType===8&&ae.parentNode===M))return;G=G.return}for(;Z!==null;){if(G=hu(Z),G===null)return;if(ae=G.tag,ae===5||ae===6){S=D=G;continue e}Z=Z.parentNode}}S=S.return}oi(function(){var Se=D,Ge=se(b),je=[];e:{var ze=O1.get(d);if(ze!==void 0){var ht=Tg,yt=d;switch(d){case"keypress":if($d(b)===0)break e;case"keydown":case"keyup":ht=PA;break;case"focusin":yt="focus",ht=Ag;break;case"focusout":yt="blur",ht=Ag;break;case"beforeblur":case"afterblur":ht=Ag;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ht=d1;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ht=xA;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ht=LA;break;case D1:case N1:case P1:ht=kA;break;case F1:ht=UA;break;case"scroll":ht=wA;break;case"wheel":ht=WA;break;case"copy":case"cut":case"paste":ht=TA;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ht=p1}var xt=(p&4)!==0,Kn=!xt&&d==="scroll",ge=xt?ze!==null?ze+"Capture":null:ze;xt=[];for(var ce=Se,we;ce!==null;){we=ce;var et=we.stateNode;if(we.tag===5&&et!==null&&(we=et,ge!==null&&(et=fr(ce,ge),et!=null&&xt.push(ph(ce,et,we)))),Kn)break;ce=ce.return}0<xt.length&&(ze=new ht(ze,yt,null,b,Ge),je.push({event:ze,listeners:xt}))}}if((p&7)===0){e:{if(ze=d==="mouseover"||d==="pointerover",ht=d==="mouseout"||d==="pointerout",ze&&b!==Nt&&(yt=b.relatedTarget||b.fromElement)&&(hu(yt)||yt[wa]))break e;if((ht||ze)&&(ze=Ge.window===Ge?Ge:(ze=Ge.ownerDocument)?ze.defaultView||ze.parentWindow:window,ht?(yt=b.relatedTarget||b.toElement,ht=Se,yt=yt?hu(yt):null,yt!==null&&(Kn=ho(yt),yt!==Kn||yt.tag!==5&&yt.tag!==6)&&(yt=null)):(ht=null,yt=Se),ht!==yt)){if(xt=d1,et="onMouseLeave",ge="onMouseEnter",ce="mouse",(d==="pointerout"||d==="pointerover")&&(xt=p1,et="onPointerLeave",ge="onPointerEnter",ce="pointer"),Kn=ht==null?ze:Sl(ht),we=yt==null?ze:Sl(yt),ze=new xt(et,ce+"leave",ht,b,Ge),ze.target=Kn,ze.relatedTarget=we,et=null,hu(Ge)===Se&&(xt=new xt(ge,ce+"enter",yt,b,Ge),xt.target=we,xt.relatedTarget=Kn,et=xt),Kn=et,ht&&yt)t:{for(xt=ht,ge=yt,ce=0,we=xt;we;we=_l(we))ce++;for(we=0,et=ge;et;et=_l(et))we++;for(;0<ce-we;)xt=_l(xt),ce--;for(;0<we-ce;)ge=_l(ge),we--;for(;ce--;){if(xt===ge||ge!==null&&xt===ge.alternate)break t;xt=_l(xt),ge=_l(ge)}xt=null}else xt=null;ht!==null&&W1(je,ze,ht,xt,!1),yt!==null&&Kn!==null&&W1(je,Kn,yt,xt,!0)}}e:{if(ze=Se?Sl(Se):window,ht=ze.nodeName&&ze.nodeName.toLowerCase(),ht==="select"||ht==="input"&&ze.type==="file")var St=XA;else if(w1(ze))if(x1)St=QA;else{St=KA;var Ot=YA}else(ht=ze.nodeName)&&ht.toLowerCase()==="input"&&(ze.type==="checkbox"||ze.type==="radio")&&(St=JA);if(St&&(St=St(d,Se))){_1(je,St,b,Ge);break e}Ot&&Ot(d,ze,Se),d==="focusout"&&(Ot=ze._wrapperState)&&Ot.controlled&&ze.type==="number"&&Qe(ze,"number",ze.value)}switch(Ot=Se?Sl(Se):window,d){case"focusin":(w1(Ot)||Ot.contentEditable==="true")&&(bl=Ot,Og=Se,hh=null);break;case"focusout":hh=Og=bl=null;break;case"mousedown":Lg=!0;break;case"contextmenu":case"mouseup":case"dragend":Lg=!1,A1(je,b,Ge);break;case"selectionchange":if(t4)break;case"keydown":case"keyup":A1(je,b,Ge)}var Lt;if(Dg)e:{switch(d){case"compositionstart":var qt="onCompositionStart";break e;case"compositionend":qt="onCompositionEnd";break e;case"compositionupdate":qt="onCompositionUpdate";break e}qt=void 0}else yl?y1(d,b)&&(qt="onCompositionEnd"):d==="keydown"&&b.keyCode===229&&(qt="onCompositionStart");qt&&(m1&&b.locale!=="ko"&&(yl||qt!=="onCompositionStart"?qt==="onCompositionEnd"&&yl&&(Lt=c1()):(ds=Ge,Cg="value"in ds?ds.value:ds.textContent,yl=!0)),Ot=ef(Se,qt),0<Ot.length&&(qt=new f1(qt,d,null,b,Ge),je.push({event:qt,listeners:Ot}),Lt?qt.data=Lt:(Lt=b1(b),Lt!==null&&(qt.data=Lt)))),(Lt=GA?VA(d,b):jA(d,b))&&(Se=ef(Se,"onBeforeInput"),0<Se.length&&(Ge=new f1("onBeforeInput","beforeinput",null,b,Ge),je.push({event:Ge,listeners:Se}),Ge.data=Lt))}U1(je,p)})}function ph(d,p,b){return{instance:d,listener:p,currentTarget:b}}function ef(d,p){for(var b=p+"Capture",S=[];d!==null;){var M=d,D=M.stateNode;M.tag===5&&D!==null&&(M=D,D=fr(d,b),D!=null&&S.unshift(ph(d,D,M)),D=fr(d,p),D!=null&&S.push(ph(d,D,M))),d=d.return}return S}function _l(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function W1(d,p,b,S,M){for(var D=p._reactName,G=[];b!==null&&b!==S;){var Z=b,ae=Z.alternate,Se=Z.stateNode;if(ae!==null&&ae===S)break;Z.tag===5&&Se!==null&&(Z=Se,M?(ae=fr(b,D),ae!=null&&G.unshift(ph(b,ae,Z))):M||(ae=fr(b,D),ae!=null&&G.push(ph(b,ae,Z)))),b=b.return}G.length!==0&&d.push({event:p,listeners:G})}var o4=/\r\n?/g,a4=/\u0000|\uFFFD/g;function H1(d){return(typeof d=="string"?d:""+d).replace(o4,`
`).replace(a4,"")}function tf(d,p,b){if(p=H1(p),H1(d)!==p&&b)throw Error(t(425))}function nf(){}var Gg=null,Vg=null;function jg(d,p){return d==="textarea"||d==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var qg=typeof setTimeout=="function"?setTimeout:void 0,s4=typeof clearTimeout=="function"?clearTimeout:void 0,G1=typeof Promise=="function"?Promise:void 0,u4=typeof queueMicrotask=="function"?queueMicrotask:typeof G1<"u"?function(d){return G1.resolve(null).then(d).catch(l4)}:qg;function l4(d){setTimeout(function(){throw d})}function $g(d,p){var b=p,S=0;do{var M=b.nextSibling;if(d.removeChild(b),M&&M.nodeType===8)if(b=M.data,b==="/$"){if(S===0){d.removeChild(M),ih(p);return}S--}else b!=="$"&&b!=="$?"&&b!=="$!"||S++;b=M}while(b);ih(p)}function ps(d){for(;d!=null;d=d.nextSibling){var p=d.nodeType;if(p===1||p===3)break;if(p===8){if(p=d.data,p==="$"||p==="$!"||p==="$?")break;if(p==="/$")return null}}return d}function V1(d){d=d.previousSibling;for(var p=0;d;){if(d.nodeType===8){var b=d.data;if(b==="$"||b==="$!"||b==="$?"){if(p===0)return d;p--}else b==="/$"&&p++}d=d.previousSibling}return null}var xl=Math.random().toString(36).slice(2),Vo="__reactFiber$"+xl,mh="__reactProps$"+xl,wa="__reactContainer$"+xl,Xg="__reactEvents$"+xl,c4="__reactListeners$"+xl,h4="__reactHandles$"+xl;function hu(d){var p=d[Vo];if(p)return p;for(var b=d.parentNode;b;){if(p=b[wa]||b[Vo]){if(b=p.alternate,p.child!==null||b!==null&&b.child!==null)for(d=V1(d);d!==null;){if(b=d[Vo])return b;d=V1(d)}return p}d=b,b=d.parentNode}return null}function gh(d){return d=d[Vo]||d[wa],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function Sl(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function rf(d){return d[mh]||null}var Yg=[],El=-1;function ms(d){return{current:d}}function Ln(d){0>El||(d.current=Yg[El],Yg[El]=null,El--)}function Dn(d,p){El++,Yg[El]=d.current,d.current=p}var gs={},Ir=ms(gs),ai=ms(!1),du=gs;function kl(d,p){var b=d.type.contextTypes;if(!b)return gs;var S=d.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===p)return S.__reactInternalMemoizedMaskedChildContext;var M={},D;for(D in b)M[D]=p[D];return S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=p,d.__reactInternalMemoizedMaskedChildContext=M),M}function si(d){return d=d.childContextTypes,d!=null}function of(){Ln(ai),Ln(Ir)}function j1(d,p,b){if(Ir.current!==gs)throw Error(t(168));Dn(Ir,p),Dn(ai,b)}function q1(d,p,b){var S=d.stateNode;if(p=p.childContextTypes,typeof S.getChildContext!="function")return b;S=S.getChildContext();for(var M in S)if(!(M in p))throw Error(t(108,ie(d)||"Unknown",M));return W({},b,S)}function af(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||gs,du=Ir.current,Dn(Ir,d),Dn(ai,ai.current),!0}function $1(d,p,b){var S=d.stateNode;if(!S)throw Error(t(169));b?(d=q1(d,p,du),S.__reactInternalMemoizedMergedChildContext=d,Ln(ai),Ln(Ir),Dn(Ir,d)):Ln(ai),Dn(ai,b)}var _a=null,sf=!1,Kg=!1;function X1(d){_a===null?_a=[d]:_a.push(d)}function d4(d){sf=!0,X1(d)}function vs(){if(!Kg&&_a!==null){Kg=!0;var d=0,p=rn;try{var b=_a;for(rn=1;d<b.length;d++){var S=b[d];do S=S(!0);while(S!==null)}_a=null,sf=!1}catch(M){throw _a!==null&&(_a=_a.slice(d+1)),$(st,vs),M}finally{rn=p,Kg=!1}}return null}var Cl=[],Tl=0,uf=null,lf=0,Vi=[],ji=0,fu=null,xa=1,Sa="";function pu(d,p){Cl[Tl++]=lf,Cl[Tl++]=uf,uf=d,lf=p}function Y1(d,p,b){Vi[ji++]=xa,Vi[ji++]=Sa,Vi[ji++]=fu,fu=d;var S=xa;d=Sa;var M=32-ln(S)-1;S&=~(1<<M),b+=1;var D=32-ln(p)+M;if(30<D){var G=M-M%5;D=(S&(1<<G)-1).toString(32),S>>=G,M-=G,xa=1<<32-ln(p)+M|b<<M|S,Sa=D+d}else xa=1<<D|b<<M|S,Sa=d}function Jg(d){d.return!==null&&(pu(d,1),Y1(d,1,0))}function Qg(d){for(;d===uf;)uf=Cl[--Tl],Cl[Tl]=null,lf=Cl[--Tl],Cl[Tl]=null;for(;d===fu;)fu=Vi[--ji],Vi[ji]=null,Sa=Vi[--ji],Vi[ji]=null,xa=Vi[--ji],Vi[ji]=null}var Ei=null,ki=null,Bn=!1,mo=null;function K1(d,p){var b=Yi(5,null,null,0);b.elementType="DELETED",b.stateNode=p,b.return=d,p=d.deletions,p===null?(d.deletions=[b],d.flags|=16):p.push(b)}function J1(d,p){switch(d.tag){case 5:var b=d.type;return p=p.nodeType!==1||b.toLowerCase()!==p.nodeName.toLowerCase()?null:p,p!==null?(d.stateNode=p,Ei=d,ki=ps(p.firstChild),!0):!1;case 6:return p=d.pendingProps===""||p.nodeType!==3?null:p,p!==null?(d.stateNode=p,Ei=d,ki=null,!0):!1;case 13:return p=p.nodeType!==8?null:p,p!==null?(b=fu!==null?{id:xa,overflow:Sa}:null,d.memoizedState={dehydrated:p,treeContext:b,retryLane:1073741824},b=Yi(18,null,null,0),b.stateNode=p,b.return=d,d.child=b,Ei=d,ki=null,!0):!1;default:return!1}}function Zg(d){return(d.mode&1)!==0&&(d.flags&128)===0}function ev(d){if(Bn){var p=ki;if(p){var b=p;if(!J1(d,p)){if(Zg(d))throw Error(t(418));p=ps(b.nextSibling);var S=Ei;p&&J1(d,p)?K1(S,b):(d.flags=d.flags&-4097|2,Bn=!1,Ei=d)}}else{if(Zg(d))throw Error(t(418));d.flags=d.flags&-4097|2,Bn=!1,Ei=d}}}function Q1(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;Ei=d}function cf(d){if(d!==Ei)return!1;if(!Bn)return Q1(d),Bn=!0,!1;var p;if((p=d.tag!==3)&&!(p=d.tag!==5)&&(p=d.type,p=p!=="head"&&p!=="body"&&!jg(d.type,d.memoizedProps)),p&&(p=ki)){if(Zg(d))throw Z1(),Error(t(418));for(;p;)K1(d,p),p=ps(p.nextSibling)}if(Q1(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,p=0;d;){if(d.nodeType===8){var b=d.data;if(b==="/$"){if(p===0){ki=ps(d.nextSibling);break e}p--}else b!=="$"&&b!=="$!"&&b!=="$?"||p++}d=d.nextSibling}ki=null}}else ki=Ei?ps(d.stateNode.nextSibling):null;return!0}function Z1(){for(var d=ki;d;)d=ps(d.nextSibling)}function Ml(){ki=Ei=null,Bn=!1}function tv(d){mo===null?mo=[d]:mo.push(d)}var f4=_.ReactCurrentBatchConfig;function vh(d,p,b){if(d=b.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(t(309));var S=b.stateNode}if(!S)throw Error(t(147,d));var M=S,D=""+d;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===D?p.ref:(p=function(G){var Z=M.refs;G===null?delete Z[D]:Z[D]=G},p._stringRef=D,p)}if(typeof d!="string")throw Error(t(284));if(!b._owner)throw Error(t(290,d))}return d}function hf(d,p){throw d=Object.prototype.toString.call(p),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d))}function ex(d){var p=d._init;return p(d._payload)}function tx(d){function p(ge,ce){if(d){var we=ge.deletions;we===null?(ge.deletions=[ce],ge.flags|=16):we.push(ce)}}function b(ge,ce){if(!d)return null;for(;ce!==null;)p(ge,ce),ce=ce.sibling;return null}function S(ge,ce){for(ge=new Map;ce!==null;)ce.key!==null?ge.set(ce.key,ce):ge.set(ce.index,ce),ce=ce.sibling;return ge}function M(ge,ce){return ge=ks(ge,ce),ge.index=0,ge.sibling=null,ge}function D(ge,ce,we){return ge.index=we,d?(we=ge.alternate,we!==null?(we=we.index,we<ce?(ge.flags|=2,ce):we):(ge.flags|=2,ce)):(ge.flags|=1048576,ce)}function G(ge){return d&&ge.alternate===null&&(ge.flags|=2),ge}function Z(ge,ce,we,et){return ce===null||ce.tag!==6?(ce=qv(we,ge.mode,et),ce.return=ge,ce):(ce=M(ce,we),ce.return=ge,ce)}function ae(ge,ce,we,et){var St=we.type;return St===A?Ge(ge,ce,we.props.children,et,we.key):ce!==null&&(ce.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===U&&ex(St)===ce.type)?(et=M(ce,we.props),et.ref=vh(ge,ce,we),et.return=ge,et):(et=Ff(we.type,we.key,we.props,null,ge.mode,et),et.ref=vh(ge,ce,we),et.return=ge,et)}function Se(ge,ce,we,et){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==we.containerInfo||ce.stateNode.implementation!==we.implementation?(ce=$v(we,ge.mode,et),ce.return=ge,ce):(ce=M(ce,we.children||[]),ce.return=ge,ce)}function Ge(ge,ce,we,et,St){return ce===null||ce.tag!==7?(ce=xu(we,ge.mode,et,St),ce.return=ge,ce):(ce=M(ce,we),ce.return=ge,ce)}function je(ge,ce,we){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return ce=qv(""+ce,ge.mode,we),ce.return=ge,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case k:return we=Ff(ce.type,ce.key,ce.props,null,ge.mode,we),we.ref=vh(ge,null,ce),we.return=ge,we;case C:return ce=$v(ce,ge.mode,we),ce.return=ge,ce;case U:var et=ce._init;return je(ge,et(ce._payload),we)}if(ft(ce)||H(ce))return ce=xu(ce,ge.mode,we,null),ce.return=ge,ce;hf(ge,ce)}return null}function ze(ge,ce,we,et){var St=ce!==null?ce.key:null;if(typeof we=="string"&&we!==""||typeof we=="number")return St!==null?null:Z(ge,ce,""+we,et);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case k:return we.key===St?ae(ge,ce,we,et):null;case C:return we.key===St?Se(ge,ce,we,et):null;case U:return St=we._init,ze(ge,ce,St(we._payload),et)}if(ft(we)||H(we))return St!==null?null:Ge(ge,ce,we,et,null);hf(ge,we)}return null}function ht(ge,ce,we,et,St){if(typeof et=="string"&&et!==""||typeof et=="number")return ge=ge.get(we)||null,Z(ce,ge,""+et,St);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case k:return ge=ge.get(et.key===null?we:et.key)||null,ae(ce,ge,et,St);case C:return ge=ge.get(et.key===null?we:et.key)||null,Se(ce,ge,et,St);case U:var Ot=et._init;return ht(ge,ce,we,Ot(et._payload),St)}if(ft(et)||H(et))return ge=ge.get(we)||null,Ge(ce,ge,et,St,null);hf(ce,et)}return null}function yt(ge,ce,we,et){for(var St=null,Ot=null,Lt=ce,qt=ce=0,vr=null;Lt!==null&&qt<we.length;qt++){Lt.index>qt?(vr=Lt,Lt=null):vr=Lt.sibling;var mn=ze(ge,Lt,we[qt],et);if(mn===null){Lt===null&&(Lt=vr);break}d&&Lt&&mn.alternate===null&&p(ge,Lt),ce=D(mn,ce,qt),Ot===null?St=mn:Ot.sibling=mn,Ot=mn,Lt=vr}if(qt===we.length)return b(ge,Lt),Bn&&pu(ge,qt),St;if(Lt===null){for(;qt<we.length;qt++)Lt=je(ge,we[qt],et),Lt!==null&&(ce=D(Lt,ce,qt),Ot===null?St=Lt:Ot.sibling=Lt,Ot=Lt);return Bn&&pu(ge,qt),St}for(Lt=S(ge,Lt);qt<we.length;qt++)vr=ht(Lt,ge,qt,we[qt],et),vr!==null&&(d&&vr.alternate!==null&&Lt.delete(vr.key===null?qt:vr.key),ce=D(vr,ce,qt),Ot===null?St=vr:Ot.sibling=vr,Ot=vr);return d&&Lt.forEach(function(Cs){return p(ge,Cs)}),Bn&&pu(ge,qt),St}function xt(ge,ce,we,et){var St=H(we);if(typeof St!="function")throw Error(t(150));if(we=St.call(we),we==null)throw Error(t(151));for(var Ot=St=null,Lt=ce,qt=ce=0,vr=null,mn=we.next();Lt!==null&&!mn.done;qt++,mn=we.next()){Lt.index>qt?(vr=Lt,Lt=null):vr=Lt.sibling;var Cs=ze(ge,Lt,mn.value,et);if(Cs===null){Lt===null&&(Lt=vr);break}d&&Lt&&Cs.alternate===null&&p(ge,Lt),ce=D(Cs,ce,qt),Ot===null?St=Cs:Ot.sibling=Cs,Ot=Cs,Lt=vr}if(mn.done)return b(ge,Lt),Bn&&pu(ge,qt),St;if(Lt===null){for(;!mn.done;qt++,mn=we.next())mn=je(ge,mn.value,et),mn!==null&&(ce=D(mn,ce,qt),Ot===null?St=mn:Ot.sibling=mn,Ot=mn);return Bn&&pu(ge,qt),St}for(Lt=S(ge,Lt);!mn.done;qt++,mn=we.next())mn=ht(Lt,ge,qt,mn.value,et),mn!==null&&(d&&mn.alternate!==null&&Lt.delete(mn.key===null?qt:mn.key),ce=D(mn,ce,qt),Ot===null?St=mn:Ot.sibling=mn,Ot=mn);return d&&Lt.forEach(function(q4){return p(ge,q4)}),Bn&&pu(ge,qt),St}function Kn(ge,ce,we,et){if(typeof we=="object"&&we!==null&&we.type===A&&we.key===null&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case k:e:{for(var St=we.key,Ot=ce;Ot!==null;){if(Ot.key===St){if(St=we.type,St===A){if(Ot.tag===7){b(ge,Ot.sibling),ce=M(Ot,we.props.children),ce.return=ge,ge=ce;break e}}else if(Ot.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===U&&ex(St)===Ot.type){b(ge,Ot.sibling),ce=M(Ot,we.props),ce.ref=vh(ge,Ot,we),ce.return=ge,ge=ce;break e}b(ge,Ot);break}else p(ge,Ot);Ot=Ot.sibling}we.type===A?(ce=xu(we.props.children,ge.mode,et,we.key),ce.return=ge,ge=ce):(et=Ff(we.type,we.key,we.props,null,ge.mode,et),et.ref=vh(ge,ce,we),et.return=ge,ge=et)}return G(ge);case C:e:{for(Ot=we.key;ce!==null;){if(ce.key===Ot)if(ce.tag===4&&ce.stateNode.containerInfo===we.containerInfo&&ce.stateNode.implementation===we.implementation){b(ge,ce.sibling),ce=M(ce,we.children||[]),ce.return=ge,ge=ce;break e}else{b(ge,ce);break}else p(ge,ce);ce=ce.sibling}ce=$v(we,ge.mode,et),ce.return=ge,ge=ce}return G(ge);case U:return Ot=we._init,Kn(ge,ce,Ot(we._payload),et)}if(ft(we))return yt(ge,ce,we,et);if(H(we))return xt(ge,ce,we,et);hf(ge,we)}return typeof we=="string"&&we!==""||typeof we=="number"?(we=""+we,ce!==null&&ce.tag===6?(b(ge,ce.sibling),ce=M(ce,we),ce.return=ge,ge=ce):(b(ge,ce),ce=qv(we,ge.mode,et),ce.return=ge,ge=ce),G(ge)):b(ge,ce)}return Kn}var Rl=tx(!0),nx=tx(!1),df=ms(null),ff=null,Al=null,nv=null;function rv(){nv=Al=ff=null}function iv(d){var p=df.current;Ln(df),d._currentValue=p}function ov(d,p,b){for(;d!==null;){var S=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,S!==null&&(S.childLanes|=p)):S!==null&&(S.childLanes&p)!==p&&(S.childLanes|=p),d===b)break;d=d.return}}function Il(d,p){ff=d,nv=Al=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&p)!==0&&(ui=!0),d.firstContext=null)}function qi(d){var p=d._currentValue;if(nv!==d)if(d={context:d,memoizedValue:p,next:null},Al===null){if(ff===null)throw Error(t(308));Al=d,ff.dependencies={lanes:0,firstContext:d}}else Al=Al.next=d;return p}var mu=null;function av(d){mu===null?mu=[d]:mu.push(d)}function rx(d,p,b,S){var M=p.interleaved;return M===null?(b.next=b,av(p)):(b.next=M.next,M.next=b),p.interleaved=b,Ea(d,S)}function Ea(d,p){d.lanes|=p;var b=d.alternate;for(b!==null&&(b.lanes|=p),b=d,d=d.return;d!==null;)d.childLanes|=p,b=d.alternate,b!==null&&(b.childLanes|=p),b=d,d=d.return;return b.tag===3?b.stateNode:null}var ys=!1;function sv(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ix(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function ka(d,p){return{eventTime:d,lane:p,tag:0,payload:null,callback:null,next:null}}function bs(d,p,b){var S=d.updateQueue;if(S===null)return null;if(S=S.shared,(dn&2)!==0){var M=S.pending;return M===null?p.next=p:(p.next=M.next,M.next=p),S.pending=p,Ea(d,b)}return M=S.interleaved,M===null?(p.next=p,av(S)):(p.next=M.next,M.next=p),S.interleaved=p,Ea(d,b)}function pf(d,p,b){if(p=p.updateQueue,p!==null&&(p=p.shared,(b&4194240)!==0)){var S=p.lanes;S&=d.pendingLanes,b|=S,p.lanes=b,cu(d,b)}}function ox(d,p){var b=d.updateQueue,S=d.alternate;if(S!==null&&(S=S.updateQueue,b===S)){var M=null,D=null;if(b=b.firstBaseUpdate,b!==null){do{var G={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};D===null?M=D=G:D=D.next=G,b=b.next}while(b!==null);D===null?M=D=p:D=D.next=p}else M=D=p;b={baseState:S.baseState,firstBaseUpdate:M,lastBaseUpdate:D,shared:S.shared,effects:S.effects},d.updateQueue=b;return}d=b.lastBaseUpdate,d===null?b.firstBaseUpdate=p:d.next=p,b.lastBaseUpdate=p}function mf(d,p,b,S){var M=d.updateQueue;ys=!1;var D=M.firstBaseUpdate,G=M.lastBaseUpdate,Z=M.shared.pending;if(Z!==null){M.shared.pending=null;var ae=Z,Se=ae.next;ae.next=null,G===null?D=Se:G.next=Se,G=ae;var Ge=d.alternate;Ge!==null&&(Ge=Ge.updateQueue,Z=Ge.lastBaseUpdate,Z!==G&&(Z===null?Ge.firstBaseUpdate=Se:Z.next=Se,Ge.lastBaseUpdate=ae))}if(D!==null){var je=M.baseState;G=0,Ge=Se=ae=null,Z=D;do{var ze=Z.lane,ht=Z.eventTime;if((S&ze)===ze){Ge!==null&&(Ge=Ge.next={eventTime:ht,lane:0,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null});e:{var yt=d,xt=Z;switch(ze=p,ht=b,xt.tag){case 1:if(yt=xt.payload,typeof yt=="function"){je=yt.call(ht,je,ze);break e}je=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=xt.payload,ze=typeof yt=="function"?yt.call(ht,je,ze):yt,ze==null)break e;je=W({},je,ze);break e;case 2:ys=!0}}Z.callback!==null&&Z.lane!==0&&(d.flags|=64,ze=M.effects,ze===null?M.effects=[Z]:ze.push(Z))}else ht={eventTime:ht,lane:ze,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Ge===null?(Se=Ge=ht,ae=je):Ge=Ge.next=ht,G|=ze;if(Z=Z.next,Z===null){if(Z=M.shared.pending,Z===null)break;ze=Z,Z=ze.next,ze.next=null,M.lastBaseUpdate=ze,M.shared.pending=null}}while(!0);if(Ge===null&&(ae=je),M.baseState=ae,M.firstBaseUpdate=Se,M.lastBaseUpdate=Ge,p=M.shared.interleaved,p!==null){M=p;do G|=M.lane,M=M.next;while(M!==p)}else D===null&&(M.shared.lanes=0);yu|=G,d.lanes=G,d.memoizedState=je}}function ax(d,p,b){if(d=p.effects,p.effects=null,d!==null)for(p=0;p<d.length;p++){var S=d[p],M=S.callback;if(M!==null){if(S.callback=null,S=b,typeof M!="function")throw Error(t(191,M));M.call(S)}}}var yh={},jo=ms(yh),bh=ms(yh),wh=ms(yh);function gu(d){if(d===yh)throw Error(t(174));return d}function uv(d,p){switch(Dn(wh,p),Dn(bh,d),Dn(jo,yh),d=p.nodeType,d){case 9:case 11:p=(p=p.documentElement)?p.namespaceURI:Pe(null,"");break;default:d=d===8?p.parentNode:p,p=d.namespaceURI||null,d=d.tagName,p=Pe(p,d)}Ln(jo),Dn(jo,p)}function Dl(){Ln(jo),Ln(bh),Ln(wh)}function sx(d){gu(wh.current);var p=gu(jo.current),b=Pe(p,d.type);p!==b&&(Dn(bh,d),Dn(jo,b))}function lv(d){bh.current===d&&(Ln(jo),Ln(bh))}var Un=ms(0);function gf(d){for(var p=d;p!==null;){if(p.tag===13){var b=p.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var cv=[];function hv(){for(var d=0;d<cv.length;d++)cv[d]._workInProgressVersionPrimary=null;cv.length=0}var vf=_.ReactCurrentDispatcher,dv=_.ReactCurrentBatchConfig,vu=0,zn=null,nr=null,mr=null,yf=!1,_h=!1,xh=0,p4=0;function Dr(){throw Error(t(321))}function fv(d,p){if(p===null)return!1;for(var b=0;b<p.length&&b<d.length;b++)if(!po(d[b],p[b]))return!1;return!0}function pv(d,p,b,S,M,D){if(vu=D,zn=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,vf.current=d===null||d.memoizedState===null?y4:b4,d=b(S,M),_h){D=0;do{if(_h=!1,xh=0,25<=D)throw Error(t(301));D+=1,mr=nr=null,p.updateQueue=null,vf.current=w4,d=b(S,M)}while(_h)}if(vf.current=_f,p=nr!==null&&nr.next!==null,vu=0,mr=nr=zn=null,yf=!1,p)throw Error(t(300));return d}function mv(){var d=xh!==0;return xh=0,d}function qo(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mr===null?zn.memoizedState=mr=d:mr=mr.next=d,mr}function $i(){if(nr===null){var d=zn.alternate;d=d!==null?d.memoizedState:null}else d=nr.next;var p=mr===null?zn.memoizedState:mr.next;if(p!==null)mr=p,nr=d;else{if(d===null)throw Error(t(310));nr=d,d={memoizedState:nr.memoizedState,baseState:nr.baseState,baseQueue:nr.baseQueue,queue:nr.queue,next:null},mr===null?zn.memoizedState=mr=d:mr=mr.next=d}return mr}function Sh(d,p){return typeof p=="function"?p(d):p}function gv(d){var p=$i(),b=p.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=d;var S=nr,M=S.baseQueue,D=b.pending;if(D!==null){if(M!==null){var G=M.next;M.next=D.next,D.next=G}S.baseQueue=M=D,b.pending=null}if(M!==null){D=M.next,S=S.baseState;var Z=G=null,ae=null,Se=D;do{var Ge=Se.lane;if((vu&Ge)===Ge)ae!==null&&(ae=ae.next={lane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),S=Se.hasEagerState?Se.eagerState:d(S,Se.action);else{var je={lane:Ge,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null};ae===null?(Z=ae=je,G=S):ae=ae.next=je,zn.lanes|=Ge,yu|=Ge}Se=Se.next}while(Se!==null&&Se!==D);ae===null?G=S:ae.next=Z,po(S,p.memoizedState)||(ui=!0),p.memoizedState=S,p.baseState=G,p.baseQueue=ae,b.lastRenderedState=S}if(d=b.interleaved,d!==null){M=d;do D=M.lane,zn.lanes|=D,yu|=D,M=M.next;while(M!==d)}else M===null&&(b.lanes=0);return[p.memoizedState,b.dispatch]}function vv(d){var p=$i(),b=p.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=d;var S=b.dispatch,M=b.pending,D=p.memoizedState;if(M!==null){b.pending=null;var G=M=M.next;do D=d(D,G.action),G=G.next;while(G!==M);po(D,p.memoizedState)||(ui=!0),p.memoizedState=D,p.baseQueue===null&&(p.baseState=D),b.lastRenderedState=D}return[D,S]}function ux(){}function lx(d,p){var b=zn,S=$i(),M=p(),D=!po(S.memoizedState,M);if(D&&(S.memoizedState=M,ui=!0),S=S.queue,yv(dx.bind(null,b,S,d),[d]),S.getSnapshot!==p||D||mr!==null&&mr.memoizedState.tag&1){if(b.flags|=2048,Eh(9,hx.bind(null,b,S,M,p),void 0,null),gr===null)throw Error(t(349));(vu&30)!==0||cx(b,p,M)}return M}function cx(d,p,b){d.flags|=16384,d={getSnapshot:p,value:b},p=zn.updateQueue,p===null?(p={lastEffect:null,stores:null},zn.updateQueue=p,p.stores=[d]):(b=p.stores,b===null?p.stores=[d]:b.push(d))}function hx(d,p,b,S){p.value=b,p.getSnapshot=S,fx(p)&&px(d)}function dx(d,p,b){return b(function(){fx(p)&&px(d)})}function fx(d){var p=d.getSnapshot;d=d.value;try{var b=p();return!po(d,b)}catch{return!0}}function px(d){var p=Ea(d,1);p!==null&&bo(p,d,1,-1)}function mx(d){var p=qo();return typeof d=="function"&&(d=d()),p.memoizedState=p.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sh,lastRenderedState:d},p.queue=d,d=d.dispatch=v4.bind(null,zn,d),[p.memoizedState,d]}function Eh(d,p,b,S){return d={tag:d,create:p,destroy:b,deps:S,next:null},p=zn.updateQueue,p===null?(p={lastEffect:null,stores:null},zn.updateQueue=p,p.lastEffect=d.next=d):(b=p.lastEffect,b===null?p.lastEffect=d.next=d:(S=b.next,b.next=d,d.next=S,p.lastEffect=d)),d}function gx(){return $i().memoizedState}function bf(d,p,b,S){var M=qo();zn.flags|=d,M.memoizedState=Eh(1|p,b,void 0,S===void 0?null:S)}function wf(d,p,b,S){var M=$i();S=S===void 0?null:S;var D=void 0;if(nr!==null){var G=nr.memoizedState;if(D=G.destroy,S!==null&&fv(S,G.deps)){M.memoizedState=Eh(p,b,D,S);return}}zn.flags|=d,M.memoizedState=Eh(1|p,b,D,S)}function vx(d,p){return bf(8390656,8,d,p)}function yv(d,p){return wf(2048,8,d,p)}function yx(d,p){return wf(4,2,d,p)}function bx(d,p){return wf(4,4,d,p)}function wx(d,p){if(typeof p=="function")return d=d(),p(d),function(){p(null)};if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function _x(d,p,b){return b=b!=null?b.concat([d]):null,wf(4,4,wx.bind(null,p,d),b)}function bv(){}function xx(d,p){var b=$i();p=p===void 0?null:p;var S=b.memoizedState;return S!==null&&p!==null&&fv(p,S[1])?S[0]:(b.memoizedState=[d,p],d)}function Sx(d,p){var b=$i();p=p===void 0?null:p;var S=b.memoizedState;return S!==null&&p!==null&&fv(p,S[1])?S[0]:(d=d(),b.memoizedState=[d,p],d)}function Ex(d,p,b){return(vu&21)===0?(d.baseState&&(d.baseState=!1,ui=!0),d.memoizedState=b):(po(b,p)||(b=Kr(),zn.lanes|=b,yu|=b,d.baseState=!0),p)}function m4(d,p){var b=rn;rn=b!==0&&4>b?b:4,d(!0);var S=dv.transition;dv.transition={};try{d(!1),p()}finally{rn=b,dv.transition=S}}function kx(){return $i().memoizedState}function g4(d,p,b){var S=Ss(d);if(b={lane:S,action:b,hasEagerState:!1,eagerState:null,next:null},Cx(d))Tx(p,b);else if(b=rx(d,p,b,S),b!==null){var M=Qr();bo(b,d,S,M),Mx(b,p,S)}}function v4(d,p,b){var S=Ss(d),M={lane:S,action:b,hasEagerState:!1,eagerState:null,next:null};if(Cx(d))Tx(p,M);else{var D=d.alternate;if(d.lanes===0&&(D===null||D.lanes===0)&&(D=p.lastRenderedReducer,D!==null))try{var G=p.lastRenderedState,Z=D(G,b);if(M.hasEagerState=!0,M.eagerState=Z,po(Z,G)){var ae=p.interleaved;ae===null?(M.next=M,av(p)):(M.next=ae.next,ae.next=M),p.interleaved=M;return}}catch{}finally{}b=rx(d,p,M,S),b!==null&&(M=Qr(),bo(b,d,S,M),Mx(b,p,S))}}function Cx(d){var p=d.alternate;return d===zn||p!==null&&p===zn}function Tx(d,p){_h=yf=!0;var b=d.pending;b===null?p.next=p:(p.next=b.next,b.next=p),d.pending=p}function Mx(d,p,b){if((b&4194240)!==0){var S=p.lanes;S&=d.pendingLanes,b|=S,p.lanes=b,cu(d,b)}}var _f={readContext:qi,useCallback:Dr,useContext:Dr,useEffect:Dr,useImperativeHandle:Dr,useInsertionEffect:Dr,useLayoutEffect:Dr,useMemo:Dr,useReducer:Dr,useRef:Dr,useState:Dr,useDebugValue:Dr,useDeferredValue:Dr,useTransition:Dr,useMutableSource:Dr,useSyncExternalStore:Dr,useId:Dr,unstable_isNewReconciler:!1},y4={readContext:qi,useCallback:function(d,p){return qo().memoizedState=[d,p===void 0?null:p],d},useContext:qi,useEffect:vx,useImperativeHandle:function(d,p,b){return b=b!=null?b.concat([d]):null,bf(4194308,4,wx.bind(null,p,d),b)},useLayoutEffect:function(d,p){return bf(4194308,4,d,p)},useInsertionEffect:function(d,p){return bf(4,2,d,p)},useMemo:function(d,p){var b=qo();return p=p===void 0?null:p,d=d(),b.memoizedState=[d,p],d},useReducer:function(d,p,b){var S=qo();return p=b!==void 0?b(p):p,S.memoizedState=S.baseState=p,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:p},S.queue=d,d=d.dispatch=g4.bind(null,zn,d),[S.memoizedState,d]},useRef:function(d){var p=qo();return d={current:d},p.memoizedState=d},useState:mx,useDebugValue:bv,useDeferredValue:function(d){return qo().memoizedState=d},useTransition:function(){var d=mx(!1),p=d[0];return d=m4.bind(null,d[1]),qo().memoizedState=d,[p,d]},useMutableSource:function(){},useSyncExternalStore:function(d,p,b){var S=zn,M=qo();if(Bn){if(b===void 0)throw Error(t(407));b=b()}else{if(b=p(),gr===null)throw Error(t(349));(vu&30)!==0||cx(S,p,b)}M.memoizedState=b;var D={value:b,getSnapshot:p};return M.queue=D,vx(dx.bind(null,S,D,d),[d]),S.flags|=2048,Eh(9,hx.bind(null,S,D,b,p),void 0,null),b},useId:function(){var d=qo(),p=gr.identifierPrefix;if(Bn){var b=Sa,S=xa;b=(S&~(1<<32-ln(S)-1)).toString(32)+b,p=":"+p+"R"+b,b=xh++,0<b&&(p+="H"+b.toString(32)),p+=":"}else b=p4++,p=":"+p+"r"+b.toString(32)+":";return d.memoizedState=p},unstable_isNewReconciler:!1},b4={readContext:qi,useCallback:xx,useContext:qi,useEffect:yv,useImperativeHandle:_x,useInsertionEffect:yx,useLayoutEffect:bx,useMemo:Sx,useReducer:gv,useRef:gx,useState:function(){return gv(Sh)},useDebugValue:bv,useDeferredValue:function(d){var p=$i();return Ex(p,nr.memoizedState,d)},useTransition:function(){var d=gv(Sh)[0],p=$i().memoizedState;return[d,p]},useMutableSource:ux,useSyncExternalStore:lx,useId:kx,unstable_isNewReconciler:!1},w4={readContext:qi,useCallback:xx,useContext:qi,useEffect:yv,useImperativeHandle:_x,useInsertionEffect:yx,useLayoutEffect:bx,useMemo:Sx,useReducer:vv,useRef:gx,useState:function(){return vv(Sh)},useDebugValue:bv,useDeferredValue:function(d){var p=$i();return nr===null?p.memoizedState=d:Ex(p,nr.memoizedState,d)},useTransition:function(){var d=vv(Sh)[0],p=$i().memoizedState;return[d,p]},useMutableSource:ux,useSyncExternalStore:lx,useId:kx,unstable_isNewReconciler:!1};function go(d,p){if(d&&d.defaultProps){p=W({},p),d=d.defaultProps;for(var b in d)p[b]===void 0&&(p[b]=d[b]);return p}return p}function wv(d,p,b,S){p=d.memoizedState,b=b(S,p),b=b==null?p:W({},p,b),d.memoizedState=b,d.lanes===0&&(d.updateQueue.baseState=b)}var xf={isMounted:function(d){return(d=d._reactInternals)?ho(d)===d:!1},enqueueSetState:function(d,p,b){d=d._reactInternals;var S=Qr(),M=Ss(d),D=ka(S,M);D.payload=p,b!=null&&(D.callback=b),p=bs(d,D,M),p!==null&&(bo(p,d,M,S),pf(p,d,M))},enqueueReplaceState:function(d,p,b){d=d._reactInternals;var S=Qr(),M=Ss(d),D=ka(S,M);D.tag=1,D.payload=p,b!=null&&(D.callback=b),p=bs(d,D,M),p!==null&&(bo(p,d,M,S),pf(p,d,M))},enqueueForceUpdate:function(d,p){d=d._reactInternals;var b=Qr(),S=Ss(d),M=ka(b,S);M.tag=2,p!=null&&(M.callback=p),p=bs(d,M,S),p!==null&&(bo(p,d,S,b),pf(p,d,S))}};function Rx(d,p,b,S,M,D,G){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(S,D,G):p.prototype&&p.prototype.isPureReactComponent?!ch(b,S)||!ch(M,D):!0}function Ax(d,p,b){var S=!1,M=gs,D=p.contextType;return typeof D=="object"&&D!==null?D=qi(D):(M=si(p)?du:Ir.current,S=p.contextTypes,D=(S=S!=null)?kl(d,M):gs),p=new p(b,D),d.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=xf,d.stateNode=p,p._reactInternals=d,S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=M,d.__reactInternalMemoizedMaskedChildContext=D),p}function Ix(d,p,b,S){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(b,S),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(b,S),p.state!==d&&xf.enqueueReplaceState(p,p.state,null)}function _v(d,p,b,S){var M=d.stateNode;M.props=b,M.state=d.memoizedState,M.refs={},sv(d);var D=p.contextType;typeof D=="object"&&D!==null?M.context=qi(D):(D=si(p)?du:Ir.current,M.context=kl(d,D)),M.state=d.memoizedState,D=p.getDerivedStateFromProps,typeof D=="function"&&(wv(d,p,D,b),M.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(p=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),p!==M.state&&xf.enqueueReplaceState(M,M.state,null),mf(d,b,M,S),M.state=d.memoizedState),typeof M.componentDidMount=="function"&&(d.flags|=4194308)}function Nl(d,p){try{var b="",S=p;do b+=ye(S),S=S.return;while(S);var M=b}catch(D){M=`
Error generating stack: `+D.message+`
`+D.stack}return{value:d,source:p,stack:M,digest:null}}function xv(d,p,b){return{value:d,source:null,stack:b??null,digest:p??null}}function Sv(d,p){try{console.error(p.value)}catch(b){setTimeout(function(){throw b})}}var _4=typeof WeakMap=="function"?WeakMap:Map;function Dx(d,p,b){b=ka(-1,b),b.tag=3,b.payload={element:null};var S=p.value;return b.callback=function(){Rf||(Rf=!0,Bv=S),Sv(d,p)},b}function Nx(d,p,b){b=ka(-1,b),b.tag=3;var S=d.type.getDerivedStateFromError;if(typeof S=="function"){var M=p.value;b.payload=function(){return S(M)},b.callback=function(){Sv(d,p)}}var D=d.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(b.callback=function(){Sv(d,p),typeof S!="function"&&(_s===null?_s=new Set([this]):_s.add(this));var G=p.stack;this.componentDidCatch(p.value,{componentStack:G!==null?G:""})}),b}function Px(d,p,b){var S=d.pingCache;if(S===null){S=d.pingCache=new _4;var M=new Set;S.set(p,M)}else M=S.get(p),M===void 0&&(M=new Set,S.set(p,M));M.has(b)||(M.add(b),d=F4.bind(null,d,p,b),p.then(d,d))}function Fx(d){do{var p;if((p=d.tag===13)&&(p=d.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return d;d=d.return}while(d!==null);return null}function Ox(d,p,b,S,M){return(d.mode&1)===0?(d===p?d.flags|=65536:(d.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(p=ka(-1,1),p.tag=2,bs(b,p,1))),b.lanes|=1),d):(d.flags|=65536,d.lanes=M,d)}var x4=_.ReactCurrentOwner,ui=!1;function Jr(d,p,b,S){p.child=d===null?nx(p,null,b,S):Rl(p,d.child,b,S)}function Lx(d,p,b,S,M){b=b.render;var D=p.ref;return Il(p,M),S=pv(d,p,b,S,D,M),b=mv(),d!==null&&!ui?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~M,Ca(d,p,M)):(Bn&&b&&Jg(p),p.flags|=1,Jr(d,p,S,M),p.child)}function Bx(d,p,b,S,M){if(d===null){var D=b.type;return typeof D=="function"&&!jv(D)&&D.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(p.tag=15,p.type=D,Ux(d,p,D,S,M)):(d=Ff(b.type,null,S,p,p.mode,M),d.ref=p.ref,d.return=p,p.child=d)}if(D=d.child,(d.lanes&M)===0){var G=D.memoizedProps;if(b=b.compare,b=b!==null?b:ch,b(G,S)&&d.ref===p.ref)return Ca(d,p,M)}return p.flags|=1,d=ks(D,S),d.ref=p.ref,d.return=p,p.child=d}function Ux(d,p,b,S,M){if(d!==null){var D=d.memoizedProps;if(ch(D,S)&&d.ref===p.ref)if(ui=!1,p.pendingProps=S=D,(d.lanes&M)!==0)(d.flags&131072)!==0&&(ui=!0);else return p.lanes=d.lanes,Ca(d,p,M)}return Ev(d,p,b,S,M)}function zx(d,p,b){var S=p.pendingProps,M=S.children,D=d!==null?d.memoizedState:null;if(S.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dn(Fl,Ci),Ci|=b;else{if((b&1073741824)===0)return d=D!==null?D.baseLanes|b:b,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:d,cachePool:null,transitions:null},p.updateQueue=null,Dn(Fl,Ci),Ci|=d,null;p.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=D!==null?D.baseLanes:b,Dn(Fl,Ci),Ci|=S}else D!==null?(S=D.baseLanes|b,p.memoizedState=null):S=b,Dn(Fl,Ci),Ci|=S;return Jr(d,p,M,b),p.child}function Wx(d,p){var b=p.ref;(d===null&&b!==null||d!==null&&d.ref!==b)&&(p.flags|=512,p.flags|=2097152)}function Ev(d,p,b,S,M){var D=si(b)?du:Ir.current;return D=kl(p,D),Il(p,M),b=pv(d,p,b,S,D,M),S=mv(),d!==null&&!ui?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~M,Ca(d,p,M)):(Bn&&S&&Jg(p),p.flags|=1,Jr(d,p,b,M),p.child)}function Hx(d,p,b,S,M){if(si(b)){var D=!0;af(p)}else D=!1;if(Il(p,M),p.stateNode===null)Ef(d,p),Ax(p,b,S),_v(p,b,S,M),S=!0;else if(d===null){var G=p.stateNode,Z=p.memoizedProps;G.props=Z;var ae=G.context,Se=b.contextType;typeof Se=="object"&&Se!==null?Se=qi(Se):(Se=si(b)?du:Ir.current,Se=kl(p,Se));var Ge=b.getDerivedStateFromProps,je=typeof Ge=="function"||typeof G.getSnapshotBeforeUpdate=="function";je||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(Z!==S||ae!==Se)&&Ix(p,G,S,Se),ys=!1;var ze=p.memoizedState;G.state=ze,mf(p,S,G,M),ae=p.memoizedState,Z!==S||ze!==ae||ai.current||ys?(typeof Ge=="function"&&(wv(p,b,Ge,S),ae=p.memoizedState),(Z=ys||Rx(p,b,Z,S,ze,ae,Se))?(je||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"&&(p.flags|=4194308)):(typeof G.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=S,p.memoizedState=ae),G.props=S,G.state=ae,G.context=Se,S=Z):(typeof G.componentDidMount=="function"&&(p.flags|=4194308),S=!1)}else{G=p.stateNode,ix(d,p),Z=p.memoizedProps,Se=p.type===p.elementType?Z:go(p.type,Z),G.props=Se,je=p.pendingProps,ze=G.context,ae=b.contextType,typeof ae=="object"&&ae!==null?ae=qi(ae):(ae=si(b)?du:Ir.current,ae=kl(p,ae));var ht=b.getDerivedStateFromProps;(Ge=typeof ht=="function"||typeof G.getSnapshotBeforeUpdate=="function")||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(Z!==je||ze!==ae)&&Ix(p,G,S,ae),ys=!1,ze=p.memoizedState,G.state=ze,mf(p,S,G,M);var yt=p.memoizedState;Z!==je||ze!==yt||ai.current||ys?(typeof ht=="function"&&(wv(p,b,ht,S),yt=p.memoizedState),(Se=ys||Rx(p,b,Se,S,ze,yt,ae)||!1)?(Ge||typeof G.UNSAFE_componentWillUpdate!="function"&&typeof G.componentWillUpdate!="function"||(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(S,yt,ae),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(S,yt,ae)),typeof G.componentDidUpdate=="function"&&(p.flags|=4),typeof G.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof G.componentDidUpdate!="function"||Z===d.memoizedProps&&ze===d.memoizedState||(p.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||Z===d.memoizedProps&&ze===d.memoizedState||(p.flags|=1024),p.memoizedProps=S,p.memoizedState=yt),G.props=S,G.state=yt,G.context=ae,S=Se):(typeof G.componentDidUpdate!="function"||Z===d.memoizedProps&&ze===d.memoizedState||(p.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||Z===d.memoizedProps&&ze===d.memoizedState||(p.flags|=1024),S=!1)}return kv(d,p,b,S,D,M)}function kv(d,p,b,S,M,D){Wx(d,p);var G=(p.flags&128)!==0;if(!S&&!G)return M&&$1(p,b,!1),Ca(d,p,D);S=p.stateNode,x4.current=p;var Z=G&&typeof b.getDerivedStateFromError!="function"?null:S.render();return p.flags|=1,d!==null&&G?(p.child=Rl(p,d.child,null,D),p.child=Rl(p,null,Z,D)):Jr(d,p,Z,D),p.memoizedState=S.state,M&&$1(p,b,!0),p.child}function Gx(d){var p=d.stateNode;p.pendingContext?j1(d,p.pendingContext,p.pendingContext!==p.context):p.context&&j1(d,p.context,!1),uv(d,p.containerInfo)}function Vx(d,p,b,S,M){return Ml(),tv(M),p.flags|=256,Jr(d,p,b,S),p.child}var Cv={dehydrated:null,treeContext:null,retryLane:0};function Tv(d){return{baseLanes:d,cachePool:null,transitions:null}}function jx(d,p,b){var S=p.pendingProps,M=Un.current,D=!1,G=(p.flags&128)!==0,Z;if((Z=G)||(Z=d!==null&&d.memoizedState===null?!1:(M&2)!==0),Z?(D=!0,p.flags&=-129):(d===null||d.memoizedState!==null)&&(M|=1),Dn(Un,M&1),d===null)return ev(p),d=p.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((p.mode&1)===0?p.lanes=1:d.data==="$!"?p.lanes=8:p.lanes=1073741824,null):(G=S.children,d=S.fallback,D?(S=p.mode,D=p.child,G={mode:"hidden",children:G},(S&1)===0&&D!==null?(D.childLanes=0,D.pendingProps=G):D=Of(G,S,0,null),d=xu(d,S,b,null),D.return=p,d.return=p,D.sibling=d,p.child=D,p.child.memoizedState=Tv(b),p.memoizedState=Cv,d):Mv(p,G));if(M=d.memoizedState,M!==null&&(Z=M.dehydrated,Z!==null))return S4(d,p,G,S,Z,M,b);if(D){D=S.fallback,G=p.mode,M=d.child,Z=M.sibling;var ae={mode:"hidden",children:S.children};return(G&1)===0&&p.child!==M?(S=p.child,S.childLanes=0,S.pendingProps=ae,p.deletions=null):(S=ks(M,ae),S.subtreeFlags=M.subtreeFlags&14680064),Z!==null?D=ks(Z,D):(D=xu(D,G,b,null),D.flags|=2),D.return=p,S.return=p,S.sibling=D,p.child=S,S=D,D=p.child,G=d.child.memoizedState,G=G===null?Tv(b):{baseLanes:G.baseLanes|b,cachePool:null,transitions:G.transitions},D.memoizedState=G,D.childLanes=d.childLanes&~b,p.memoizedState=Cv,S}return D=d.child,d=D.sibling,S=ks(D,{mode:"visible",children:S.children}),(p.mode&1)===0&&(S.lanes=b),S.return=p,S.sibling=null,d!==null&&(b=p.deletions,b===null?(p.deletions=[d],p.flags|=16):b.push(d)),p.child=S,p.memoizedState=null,S}function Mv(d,p){return p=Of({mode:"visible",children:p},d.mode,0,null),p.return=d,d.child=p}function Sf(d,p,b,S){return S!==null&&tv(S),Rl(p,d.child,null,b),d=Mv(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function S4(d,p,b,S,M,D,G){if(b)return p.flags&256?(p.flags&=-257,S=xv(Error(t(422))),Sf(d,p,G,S)):p.memoizedState!==null?(p.child=d.child,p.flags|=128,null):(D=S.fallback,M=p.mode,S=Of({mode:"visible",children:S.children},M,0,null),D=xu(D,M,G,null),D.flags|=2,S.return=p,D.return=p,S.sibling=D,p.child=S,(p.mode&1)!==0&&Rl(p,d.child,null,G),p.child.memoizedState=Tv(G),p.memoizedState=Cv,D);if((p.mode&1)===0)return Sf(d,p,G,null);if(M.data==="$!"){if(S=M.nextSibling&&M.nextSibling.dataset,S)var Z=S.dgst;return S=Z,D=Error(t(419)),S=xv(D,S,void 0),Sf(d,p,G,S)}if(Z=(G&d.childLanes)!==0,ui||Z){if(S=gr,S!==null){switch(G&-G){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(S.suspendedLanes|G))!==0?0:M,M!==0&&M!==D.retryLane&&(D.retryLane=M,Ea(d,M),bo(S,d,M,-1))}return Vv(),S=xv(Error(t(421))),Sf(d,p,G,S)}return M.data==="$?"?(p.flags|=128,p.child=d.child,p=O4.bind(null,d),M._reactRetry=p,null):(d=D.treeContext,ki=ps(M.nextSibling),Ei=p,Bn=!0,mo=null,d!==null&&(Vi[ji++]=xa,Vi[ji++]=Sa,Vi[ji++]=fu,xa=d.id,Sa=d.overflow,fu=p),p=Mv(p,S.children),p.flags|=4096,p)}function qx(d,p,b){d.lanes|=p;var S=d.alternate;S!==null&&(S.lanes|=p),ov(d.return,p,b)}function Rv(d,p,b,S,M){var D=d.memoizedState;D===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:S,tail:b,tailMode:M}:(D.isBackwards=p,D.rendering=null,D.renderingStartTime=0,D.last=S,D.tail=b,D.tailMode=M)}function $x(d,p,b){var S=p.pendingProps,M=S.revealOrder,D=S.tail;if(Jr(d,p,S.children,b),S=Un.current,(S&2)!==0)S=S&1|2,p.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&qx(d,b,p);else if(d.tag===19)qx(d,b,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}S&=1}if(Dn(Un,S),(p.mode&1)===0)p.memoizedState=null;else switch(M){case"forwards":for(b=p.child,M=null;b!==null;)d=b.alternate,d!==null&&gf(d)===null&&(M=b),b=b.sibling;b=M,b===null?(M=p.child,p.child=null):(M=b.sibling,b.sibling=null),Rv(p,!1,M,b,D);break;case"backwards":for(b=null,M=p.child,p.child=null;M!==null;){if(d=M.alternate,d!==null&&gf(d)===null){p.child=M;break}d=M.sibling,M.sibling=b,b=M,M=d}Rv(p,!0,b,null,D);break;case"together":Rv(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function Ef(d,p){(p.mode&1)===0&&d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2)}function Ca(d,p,b){if(d!==null&&(p.dependencies=d.dependencies),yu|=p.lanes,(b&p.childLanes)===0)return null;if(d!==null&&p.child!==d.child)throw Error(t(153));if(p.child!==null){for(d=p.child,b=ks(d,d.pendingProps),p.child=b,b.return=p;d.sibling!==null;)d=d.sibling,b=b.sibling=ks(d,d.pendingProps),b.return=p;b.sibling=null}return p.child}function E4(d,p,b){switch(p.tag){case 3:Gx(p),Ml();break;case 5:sx(p);break;case 1:si(p.type)&&af(p);break;case 4:uv(p,p.stateNode.containerInfo);break;case 10:var S=p.type._context,M=p.memoizedProps.value;Dn(df,S._currentValue),S._currentValue=M;break;case 13:if(S=p.memoizedState,S!==null)return S.dehydrated!==null?(Dn(Un,Un.current&1),p.flags|=128,null):(b&p.child.childLanes)!==0?jx(d,p,b):(Dn(Un,Un.current&1),d=Ca(d,p,b),d!==null?d.sibling:null);Dn(Un,Un.current&1);break;case 19:if(S=(b&p.childLanes)!==0,(d.flags&128)!==0){if(S)return $x(d,p,b);p.flags|=128}if(M=p.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),Dn(Un,Un.current),S)break;return null;case 22:case 23:return p.lanes=0,zx(d,p,b)}return Ca(d,p,b)}var Xx,Av,Yx,Kx;Xx=function(d,p){for(var b=p.child;b!==null;){if(b.tag===5||b.tag===6)d.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},Av=function(){},Yx=function(d,p,b,S){var M=d.memoizedProps;if(M!==S){d=p.stateNode,gu(jo.current);var D=null;switch(b){case"input":M=ot(d,M),S=ot(d,S),D=[];break;case"select":M=W({},M,{value:void 0}),S=W({},S,{value:void 0}),D=[];break;case"textarea":M=Ut(d,M),S=Ut(d,S),D=[];break;default:typeof M.onClick!="function"&&typeof S.onClick=="function"&&(d.onclick=nf)}nt(b,S);var G;b=null;for(Se in M)if(!S.hasOwnProperty(Se)&&M.hasOwnProperty(Se)&&M[Se]!=null)if(Se==="style"){var Z=M[Se];for(G in Z)Z.hasOwnProperty(G)&&(b||(b={}),b[G]="")}else Se!=="dangerouslySetInnerHTML"&&Se!=="children"&&Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&Se!=="autoFocus"&&(i.hasOwnProperty(Se)?D||(D=[]):(D=D||[]).push(Se,null));for(Se in S){var ae=S[Se];if(Z=M?.[Se],S.hasOwnProperty(Se)&&ae!==Z&&(ae!=null||Z!=null))if(Se==="style")if(Z){for(G in Z)!Z.hasOwnProperty(G)||ae&&ae.hasOwnProperty(G)||(b||(b={}),b[G]="");for(G in ae)ae.hasOwnProperty(G)&&Z[G]!==ae[G]&&(b||(b={}),b[G]=ae[G])}else b||(D||(D=[]),D.push(Se,b)),b=ae;else Se==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,Z=Z?Z.__html:void 0,ae!=null&&Z!==ae&&(D=D||[]).push(Se,ae)):Se==="children"?typeof ae!="string"&&typeof ae!="number"||(D=D||[]).push(Se,""+ae):Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&(i.hasOwnProperty(Se)?(ae!=null&&Se==="onScroll"&&On("scroll",d),D||Z===ae||(D=[])):(D=D||[]).push(Se,ae))}b&&(D=D||[]).push("style",b);var Se=D;(p.updateQueue=Se)&&(p.flags|=4)}},Kx=function(d,p,b,S){b!==S&&(p.flags|=4)};function kh(d,p){if(!Bn)switch(d.tailMode){case"hidden":p=d.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?d.tail=null:b.sibling=null;break;case"collapsed":b=d.tail;for(var S=null;b!==null;)b.alternate!==null&&(S=b),b=b.sibling;S===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:S.sibling=null}}function Nr(d){var p=d.alternate!==null&&d.alternate.child===d.child,b=0,S=0;if(p)for(var M=d.child;M!==null;)b|=M.lanes|M.childLanes,S|=M.subtreeFlags&14680064,S|=M.flags&14680064,M.return=d,M=M.sibling;else for(M=d.child;M!==null;)b|=M.lanes|M.childLanes,S|=M.subtreeFlags,S|=M.flags,M.return=d,M=M.sibling;return d.subtreeFlags|=S,d.childLanes=b,p}function k4(d,p,b){var S=p.pendingProps;switch(Qg(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nr(p),null;case 1:return si(p.type)&&of(),Nr(p),null;case 3:return S=p.stateNode,Dl(),Ln(ai),Ln(Ir),hv(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(d===null||d.child===null)&&(cf(p)?p.flags|=4:d===null||d.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,mo!==null&&(Wv(mo),mo=null))),Av(d,p),Nr(p),null;case 5:lv(p);var M=gu(wh.current);if(b=p.type,d!==null&&p.stateNode!=null)Yx(d,p,b,S,M),d.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!S){if(p.stateNode===null)throw Error(t(166));return Nr(p),null}if(d=gu(jo.current),cf(p)){S=p.stateNode,b=p.type;var D=p.memoizedProps;switch(S[Vo]=p,S[mh]=D,d=(p.mode&1)!==0,b){case"dialog":On("cancel",S),On("close",S);break;case"iframe":case"object":case"embed":On("load",S);break;case"video":case"audio":for(M=0;M<dh.length;M++)On(dh[M],S);break;case"source":On("error",S);break;case"img":case"image":case"link":On("error",S),On("load",S);break;case"details":On("toggle",S);break;case"input":Ke(S,D),On("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!D.multiple},On("invalid",S);break;case"textarea":Q(S,D),On("invalid",S)}nt(b,D),M=null;for(var G in D)if(D.hasOwnProperty(G)){var Z=D[G];G==="children"?typeof Z=="string"?S.textContent!==Z&&(D.suppressHydrationWarning!==!0&&tf(S.textContent,Z,d),M=["children",Z]):typeof Z=="number"&&S.textContent!==""+Z&&(D.suppressHydrationWarning!==!0&&tf(S.textContent,Z,d),M=["children",""+Z]):i.hasOwnProperty(G)&&Z!=null&&G==="onScroll"&&On("scroll",S)}switch(b){case"input":Be(S),Tt(S,D,!0);break;case"textarea":Be(S),me(S);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(S.onclick=nf)}S=M,p.updateQueue=S,S!==null&&(p.flags|=4)}else{G=M.nodeType===9?M:M.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Ae(b)),d==="http://www.w3.org/1999/xhtml"?b==="script"?(d=G.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof S.is=="string"?d=G.createElement(b,{is:S.is}):(d=G.createElement(b),b==="select"&&(G=d,S.multiple?G.multiple=!0:S.size&&(G.size=S.size))):d=G.createElementNS(d,b),d[Vo]=p,d[mh]=S,Xx(d,p,!1,!1),p.stateNode=d;e:{switch(G=tt(b,S),b){case"dialog":On("cancel",d),On("close",d),M=S;break;case"iframe":case"object":case"embed":On("load",d),M=S;break;case"video":case"audio":for(M=0;M<dh.length;M++)On(dh[M],d);M=S;break;case"source":On("error",d),M=S;break;case"img":case"image":case"link":On("error",d),On("load",d),M=S;break;case"details":On("toggle",d),M=S;break;case"input":Ke(d,S),M=ot(d,S),On("invalid",d);break;case"option":M=S;break;case"select":d._wrapperState={wasMultiple:!!S.multiple},M=W({},S,{value:void 0}),On("invalid",d);break;case"textarea":Q(d,S),M=Ut(d,S),On("invalid",d);break;default:M=S}nt(b,M),Z=M;for(D in Z)if(Z.hasOwnProperty(D)){var ae=Z[D];D==="style"?$e(d,ae):D==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ae!=null&&Ue(d,ae)):D==="children"?typeof ae=="string"?(b!=="textarea"||ae!=="")&&_e(d,ae):typeof ae=="number"&&_e(d,""+ae):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(i.hasOwnProperty(D)?ae!=null&&D==="onScroll"&&On("scroll",d):ae!=null&&E(d,D,ae,G))}switch(b){case"input":Be(d),Tt(d,S,!1);break;case"textarea":Be(d),me(d);break;case"option":S.value!=null&&d.setAttribute("value",""+fe(S.value));break;case"select":d.multiple=!!S.multiple,D=S.value,D!=null?Mt(d,!!S.multiple,D,!1):S.defaultValue!=null&&Mt(d,!!S.multiple,S.defaultValue,!0);break;default:typeof M.onClick=="function"&&(d.onclick=nf)}switch(b){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(p.flags|=4)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return Nr(p),null;case 6:if(d&&p.stateNode!=null)Kx(d,p,d.memoizedProps,S);else{if(typeof S!="string"&&p.stateNode===null)throw Error(t(166));if(b=gu(wh.current),gu(jo.current),cf(p)){if(S=p.stateNode,b=p.memoizedProps,S[Vo]=p,(D=S.nodeValue!==b)&&(d=Ei,d!==null))switch(d.tag){case 3:tf(S.nodeValue,b,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&tf(S.nodeValue,b,(d.mode&1)!==0)}D&&(p.flags|=4)}else S=(b.nodeType===9?b:b.ownerDocument).createTextNode(S),S[Vo]=p,p.stateNode=S}return Nr(p),null;case 13:if(Ln(Un),S=p.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Bn&&ki!==null&&(p.mode&1)!==0&&(p.flags&128)===0)Z1(),Ml(),p.flags|=98560,D=!1;else if(D=cf(p),S!==null&&S.dehydrated!==null){if(d===null){if(!D)throw Error(t(318));if(D=p.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(t(317));D[Vo]=p}else Ml(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Nr(p),D=!1}else mo!==null&&(Wv(mo),mo=null),D=!0;if(!D)return p.flags&65536?p:null}return(p.flags&128)!==0?(p.lanes=b,p):(S=S!==null,S!==(d!==null&&d.memoizedState!==null)&&S&&(p.child.flags|=8192,(p.mode&1)!==0&&(d===null||(Un.current&1)!==0?rr===0&&(rr=3):Vv())),p.updateQueue!==null&&(p.flags|=4),Nr(p),null);case 4:return Dl(),Av(d,p),d===null&&fh(p.stateNode.containerInfo),Nr(p),null;case 10:return iv(p.type._context),Nr(p),null;case 17:return si(p.type)&&of(),Nr(p),null;case 19:if(Ln(Un),D=p.memoizedState,D===null)return Nr(p),null;if(S=(p.flags&128)!==0,G=D.rendering,G===null)if(S)kh(D,!1);else{if(rr!==0||d!==null&&(d.flags&128)!==0)for(d=p.child;d!==null;){if(G=gf(d),G!==null){for(p.flags|=128,kh(D,!1),S=G.updateQueue,S!==null&&(p.updateQueue=S,p.flags|=4),p.subtreeFlags=0,S=b,b=p.child;b!==null;)D=b,d=S,D.flags&=14680066,G=D.alternate,G===null?(D.childLanes=0,D.lanes=d,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=G.childLanes,D.lanes=G.lanes,D.child=G.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=G.memoizedProps,D.memoizedState=G.memoizedState,D.updateQueue=G.updateQueue,D.type=G.type,d=G.dependencies,D.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),b=b.sibling;return Dn(Un,Un.current&1|2),p.child}d=d.sibling}D.tail!==null&&he()>Ol&&(p.flags|=128,S=!0,kh(D,!1),p.lanes=4194304)}else{if(!S)if(d=gf(G),d!==null){if(p.flags|=128,S=!0,b=d.updateQueue,b!==null&&(p.updateQueue=b,p.flags|=4),kh(D,!0),D.tail===null&&D.tailMode==="hidden"&&!G.alternate&&!Bn)return Nr(p),null}else 2*he()-D.renderingStartTime>Ol&&b!==1073741824&&(p.flags|=128,S=!0,kh(D,!1),p.lanes=4194304);D.isBackwards?(G.sibling=p.child,p.child=G):(b=D.last,b!==null?b.sibling=G:p.child=G,D.last=G)}return D.tail!==null?(p=D.tail,D.rendering=p,D.tail=p.sibling,D.renderingStartTime=he(),p.sibling=null,b=Un.current,Dn(Un,S?b&1|2:b&1),p):(Nr(p),null);case 22:case 23:return Gv(),S=p.memoizedState!==null,d!==null&&d.memoizedState!==null!==S&&(p.flags|=8192),S&&(p.mode&1)!==0?(Ci&1073741824)!==0&&(Nr(p),p.subtreeFlags&6&&(p.flags|=8192)):Nr(p),null;case 24:return null;case 25:return null}throw Error(t(156,p.tag))}function C4(d,p){switch(Qg(p),p.tag){case 1:return si(p.type)&&of(),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return Dl(),Ln(ai),Ln(Ir),hv(),d=p.flags,(d&65536)!==0&&(d&128)===0?(p.flags=d&-65537|128,p):null;case 5:return lv(p),null;case 13:if(Ln(Un),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(t(340));Ml()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return Ln(Un),null;case 4:return Dl(),null;case 10:return iv(p.type._context),null;case 22:case 23:return Gv(),null;case 24:return null;default:return null}}var kf=!1,Pr=!1,T4=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Pl(d,p){var b=d.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(S){Vn(d,p,S)}else b.current=null}function Iv(d,p,b){try{b()}catch(S){Vn(d,p,S)}}var Jx=!1;function M4(d,p){if(Gg=Vd,d=R1(),Fg(d)){if("selectionStart"in d)var b={start:d.selectionStart,end:d.selectionEnd};else e:{b=(b=d.ownerDocument)&&b.defaultView||window;var S=b.getSelection&&b.getSelection();if(S&&S.rangeCount!==0){b=S.anchorNode;var M=S.anchorOffset,D=S.focusNode;S=S.focusOffset;try{b.nodeType,D.nodeType}catch{b=null;break e}var G=0,Z=-1,ae=-1,Se=0,Ge=0,je=d,ze=null;t:for(;;){for(var ht;je!==b||M!==0&&je.nodeType!==3||(Z=G+M),je!==D||S!==0&&je.nodeType!==3||(ae=G+S),je.nodeType===3&&(G+=je.nodeValue.length),(ht=je.firstChild)!==null;)ze=je,je=ht;for(;;){if(je===d)break t;if(ze===b&&++Se===M&&(Z=G),ze===D&&++Ge===S&&(ae=G),(ht=je.nextSibling)!==null)break;je=ze,ze=je.parentNode}je=ht}b=Z===-1||ae===-1?null:{start:Z,end:ae}}else b=null}b=b||{start:0,end:0}}else b=null;for(Vg={focusedElem:d,selectionRange:b},Vd=!1,mt=p;mt!==null;)if(p=mt,d=p.child,(p.subtreeFlags&1028)!==0&&d!==null)d.return=p,mt=d;else for(;mt!==null;){p=mt;try{var yt=p.alternate;if((p.flags&1024)!==0)switch(p.tag){case 0:case 11:case 15:break;case 1:if(yt!==null){var xt=yt.memoizedProps,Kn=yt.memoizedState,ge=p.stateNode,ce=ge.getSnapshotBeforeUpdate(p.elementType===p.type?xt:go(p.type,xt),Kn);ge.__reactInternalSnapshotBeforeUpdate=ce}break;case 3:var we=p.stateNode.containerInfo;we.nodeType===1?we.textContent="":we.nodeType===9&&we.documentElement&&we.removeChild(we.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(et){Vn(p,p.return,et)}if(d=p.sibling,d!==null){d.return=p.return,mt=d;break}mt=p.return}return yt=Jx,Jx=!1,yt}function Ch(d,p,b){var S=p.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var M=S=S.next;do{if((M.tag&d)===d){var D=M.destroy;M.destroy=void 0,D!==void 0&&Iv(p,b,D)}M=M.next}while(M!==S)}}function Cf(d,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var b=p=p.next;do{if((b.tag&d)===d){var S=b.create;b.destroy=S()}b=b.next}while(b!==p)}}function Dv(d){var p=d.ref;if(p!==null){var b=d.stateNode;switch(d.tag){case 5:d=b;break;default:d=b}typeof p=="function"?p(d):p.current=d}}function Qx(d){var p=d.alternate;p!==null&&(d.alternate=null,Qx(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&(delete p[Vo],delete p[mh],delete p[Xg],delete p[c4],delete p[h4])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Zx(d){return d.tag===5||d.tag===3||d.tag===4}function e2(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||Zx(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Nv(d,p,b){var S=d.tag;if(S===5||S===6)d=d.stateNode,p?b.nodeType===8?b.parentNode.insertBefore(d,p):b.insertBefore(d,p):(b.nodeType===8?(p=b.parentNode,p.insertBefore(d,b)):(p=b,p.appendChild(d)),b=b._reactRootContainer,b!=null||p.onclick!==null||(p.onclick=nf));else if(S!==4&&(d=d.child,d!==null))for(Nv(d,p,b),d=d.sibling;d!==null;)Nv(d,p,b),d=d.sibling}function Pv(d,p,b){var S=d.tag;if(S===5||S===6)d=d.stateNode,p?b.insertBefore(d,p):b.appendChild(d);else if(S!==4&&(d=d.child,d!==null))for(Pv(d,p,b),d=d.sibling;d!==null;)Pv(d,p,b),d=d.sibling}var xr=null,vo=!1;function ws(d,p,b){for(b=b.child;b!==null;)t2(d,p,b),b=b.sibling}function t2(d,p,b){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount(Rt,b)}catch{}switch(b.tag){case 5:Pr||Pl(b,p);case 6:var S=xr,M=vo;xr=null,ws(d,p,b),xr=S,vo=M,xr!==null&&(vo?(d=xr,b=b.stateNode,d.nodeType===8?d.parentNode.removeChild(b):d.removeChild(b)):xr.removeChild(b.stateNode));break;case 18:xr!==null&&(vo?(d=xr,b=b.stateNode,d.nodeType===8?$g(d.parentNode,b):d.nodeType===1&&$g(d,b),ih(d)):$g(xr,b.stateNode));break;case 4:S=xr,M=vo,xr=b.stateNode.containerInfo,vo=!0,ws(d,p,b),xr=S,vo=M;break;case 0:case 11:case 14:case 15:if(!Pr&&(S=b.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){M=S=S.next;do{var D=M,G=D.destroy;D=D.tag,G!==void 0&&((D&2)!==0||(D&4)!==0)&&Iv(b,p,G),M=M.next}while(M!==S)}ws(d,p,b);break;case 1:if(!Pr&&(Pl(b,p),S=b.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=b.memoizedProps,S.state=b.memoizedState,S.componentWillUnmount()}catch(Z){Vn(b,p,Z)}ws(d,p,b);break;case 21:ws(d,p,b);break;case 22:b.mode&1?(Pr=(S=Pr)||b.memoizedState!==null,ws(d,p,b),Pr=S):ws(d,p,b);break;default:ws(d,p,b)}}function n2(d){var p=d.updateQueue;if(p!==null){d.updateQueue=null;var b=d.stateNode;b===null&&(b=d.stateNode=new T4),p.forEach(function(S){var M=L4.bind(null,d,S);b.has(S)||(b.add(S),S.then(M,M))})}}function yo(d,p){var b=p.deletions;if(b!==null)for(var S=0;S<b.length;S++){var M=b[S];try{var D=d,G=p,Z=G;e:for(;Z!==null;){switch(Z.tag){case 5:xr=Z.stateNode,vo=!1;break e;case 3:xr=Z.stateNode.containerInfo,vo=!0;break e;case 4:xr=Z.stateNode.containerInfo,vo=!0;break e}Z=Z.return}if(xr===null)throw Error(t(160));t2(D,G,M),xr=null,vo=!1;var ae=M.alternate;ae!==null&&(ae.return=null),M.return=null}catch(Se){Vn(M,p,Se)}}if(p.subtreeFlags&12854)for(p=p.child;p!==null;)r2(p,d),p=p.sibling}function r2(d,p){var b=d.alternate,S=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(yo(p,d),$o(d),S&4){try{Ch(3,d,d.return),Cf(3,d)}catch(xt){Vn(d,d.return,xt)}try{Ch(5,d,d.return)}catch(xt){Vn(d,d.return,xt)}}break;case 1:yo(p,d),$o(d),S&512&&b!==null&&Pl(b,b.return);break;case 5:if(yo(p,d),$o(d),S&512&&b!==null&&Pl(b,b.return),d.flags&32){var M=d.stateNode;try{_e(M,"")}catch(xt){Vn(d,d.return,xt)}}if(S&4&&(M=d.stateNode,M!=null)){var D=d.memoizedProps,G=b!==null?b.memoizedProps:D,Z=d.type,ae=d.updateQueue;if(d.updateQueue=null,ae!==null)try{Z==="input"&&D.type==="radio"&&D.name!=null&&Xe(M,D),tt(Z,G);var Se=tt(Z,D);for(G=0;G<ae.length;G+=2){var Ge=ae[G],je=ae[G+1];Ge==="style"?$e(M,je):Ge==="dangerouslySetInnerHTML"?Ue(M,je):Ge==="children"?_e(M,je):E(M,Ge,je,Se)}switch(Z){case"input":qe(M,D);break;case"textarea":j(M,D);break;case"select":var ze=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!D.multiple;var ht=D.value;ht!=null?Mt(M,!!D.multiple,ht,!1):ze!==!!D.multiple&&(D.defaultValue!=null?Mt(M,!!D.multiple,D.defaultValue,!0):Mt(M,!!D.multiple,D.multiple?[]:"",!1))}M[mh]=D}catch(xt){Vn(d,d.return,xt)}}break;case 6:if(yo(p,d),$o(d),S&4){if(d.stateNode===null)throw Error(t(162));M=d.stateNode,D=d.memoizedProps;try{M.nodeValue=D}catch(xt){Vn(d,d.return,xt)}}break;case 3:if(yo(p,d),$o(d),S&4&&b!==null&&b.memoizedState.isDehydrated)try{ih(p.containerInfo)}catch(xt){Vn(d,d.return,xt)}break;case 4:yo(p,d),$o(d);break;case 13:yo(p,d),$o(d),M=d.child,M.flags&8192&&(D=M.memoizedState!==null,M.stateNode.isHidden=D,!D||M.alternate!==null&&M.alternate.memoizedState!==null||(Lv=he())),S&4&&n2(d);break;case 22:if(Ge=b!==null&&b.memoizedState!==null,d.mode&1?(Pr=(Se=Pr)||Ge,yo(p,d),Pr=Se):yo(p,d),$o(d),S&8192){if(Se=d.memoizedState!==null,(d.stateNode.isHidden=Se)&&!Ge&&(d.mode&1)!==0)for(mt=d,Ge=d.child;Ge!==null;){for(je=mt=Ge;mt!==null;){switch(ze=mt,ht=ze.child,ze.tag){case 0:case 11:case 14:case 15:Ch(4,ze,ze.return);break;case 1:Pl(ze,ze.return);var yt=ze.stateNode;if(typeof yt.componentWillUnmount=="function"){S=ze,b=ze.return;try{p=S,yt.props=p.memoizedProps,yt.state=p.memoizedState,yt.componentWillUnmount()}catch(xt){Vn(S,b,xt)}}break;case 5:Pl(ze,ze.return);break;case 22:if(ze.memoizedState!==null){a2(je);continue}}ht!==null?(ht.return=ze,mt=ht):a2(je)}Ge=Ge.sibling}e:for(Ge=null,je=d;;){if(je.tag===5){if(Ge===null){Ge=je;try{M=je.stateNode,Se?(D=M.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(Z=je.stateNode,ae=je.memoizedProps.style,G=ae!=null&&ae.hasOwnProperty("display")?ae.display:null,Z.style.display=Oe("display",G))}catch(xt){Vn(d,d.return,xt)}}}else if(je.tag===6){if(Ge===null)try{je.stateNode.nodeValue=Se?"":je.memoizedProps}catch(xt){Vn(d,d.return,xt)}}else if((je.tag!==22&&je.tag!==23||je.memoizedState===null||je===d)&&je.child!==null){je.child.return=je,je=je.child;continue}if(je===d)break e;for(;je.sibling===null;){if(je.return===null||je.return===d)break e;Ge===je&&(Ge=null),je=je.return}Ge===je&&(Ge=null),je.sibling.return=je.return,je=je.sibling}}break;case 19:yo(p,d),$o(d),S&4&&n2(d);break;case 21:break;default:yo(p,d),$o(d)}}function $o(d){var p=d.flags;if(p&2){try{e:{for(var b=d.return;b!==null;){if(Zx(b)){var S=b;break e}b=b.return}throw Error(t(160))}switch(S.tag){case 5:var M=S.stateNode;S.flags&32&&(_e(M,""),S.flags&=-33);var D=e2(d);Pv(d,D,M);break;case 3:case 4:var G=S.stateNode.containerInfo,Z=e2(d);Nv(d,Z,G);break;default:throw Error(t(161))}}catch(ae){Vn(d,d.return,ae)}d.flags&=-3}p&4096&&(d.flags&=-4097)}function R4(d,p,b){mt=d,i2(d)}function i2(d,p,b){for(var S=(d.mode&1)!==0;mt!==null;){var M=mt,D=M.child;if(M.tag===22&&S){var G=M.memoizedState!==null||kf;if(!G){var Z=M.alternate,ae=Z!==null&&Z.memoizedState!==null||Pr;Z=kf;var Se=Pr;if(kf=G,(Pr=ae)&&!Se)for(mt=M;mt!==null;)G=mt,ae=G.child,G.tag===22&&G.memoizedState!==null?s2(M):ae!==null?(ae.return=G,mt=ae):s2(M);for(;D!==null;)mt=D,i2(D),D=D.sibling;mt=M,kf=Z,Pr=Se}o2(d)}else(M.subtreeFlags&8772)!==0&&D!==null?(D.return=M,mt=D):o2(d)}}function o2(d){for(;mt!==null;){var p=mt;if((p.flags&8772)!==0){var b=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:Pr||Cf(5,p);break;case 1:var S=p.stateNode;if(p.flags&4&&!Pr)if(b===null)S.componentDidMount();else{var M=p.elementType===p.type?b.memoizedProps:go(p.type,b.memoizedProps);S.componentDidUpdate(M,b.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var D=p.updateQueue;D!==null&&ax(p,D,S);break;case 3:var G=p.updateQueue;if(G!==null){if(b=null,p.child!==null)switch(p.child.tag){case 5:b=p.child.stateNode;break;case 1:b=p.child.stateNode}ax(p,G,b)}break;case 5:var Z=p.stateNode;if(b===null&&p.flags&4){b=Z;var ae=p.memoizedProps;switch(p.type){case"button":case"input":case"select":case"textarea":ae.autoFocus&&b.focus();break;case"img":ae.src&&(b.src=ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(p.memoizedState===null){var Se=p.alternate;if(Se!==null){var Ge=Se.memoizedState;if(Ge!==null){var je=Ge.dehydrated;je!==null&&ih(je)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Pr||p.flags&512&&Dv(p)}catch(ze){Vn(p,p.return,ze)}}if(p===d){mt=null;break}if(b=p.sibling,b!==null){b.return=p.return,mt=b;break}mt=p.return}}function a2(d){for(;mt!==null;){var p=mt;if(p===d){mt=null;break}var b=p.sibling;if(b!==null){b.return=p.return,mt=b;break}mt=p.return}}function s2(d){for(;mt!==null;){var p=mt;try{switch(p.tag){case 0:case 11:case 15:var b=p.return;try{Cf(4,p)}catch(ae){Vn(p,b,ae)}break;case 1:var S=p.stateNode;if(typeof S.componentDidMount=="function"){var M=p.return;try{S.componentDidMount()}catch(ae){Vn(p,M,ae)}}var D=p.return;try{Dv(p)}catch(ae){Vn(p,D,ae)}break;case 5:var G=p.return;try{Dv(p)}catch(ae){Vn(p,G,ae)}}}catch(ae){Vn(p,p.return,ae)}if(p===d){mt=null;break}var Z=p.sibling;if(Z!==null){Z.return=p.return,mt=Z;break}mt=p.return}}var A4=Math.ceil,Tf=_.ReactCurrentDispatcher,Fv=_.ReactCurrentOwner,Xi=_.ReactCurrentBatchConfig,dn=0,gr=null,Qn=null,Sr=0,Ci=0,Fl=ms(0),rr=0,Th=null,yu=0,Mf=0,Ov=0,Mh=null,li=null,Lv=0,Ol=1/0,Ta=null,Rf=!1,Bv=null,_s=null,Af=!1,xs=null,If=0,Rh=0,Uv=null,Df=-1,Nf=0;function Qr(){return(dn&6)!==0?he():Df!==-1?Df:Df=he()}function Ss(d){return(d.mode&1)===0?1:(dn&2)!==0&&Sr!==0?Sr&-Sr:f4.transition!==null?(Nf===0&&(Nf=Kr()),Nf):(d=rn,d!==0||(d=window.event,d=d===void 0?16:l1(d.type)),d)}function bo(d,p,b,S){if(50<Rh)throw Rh=0,Uv=null,Error(t(185));Yn(d,b,S),((dn&2)===0||d!==gr)&&(d===gr&&((dn&2)===0&&(Mf|=b),rr===4&&Es(d,Sr)),ci(d,S),b===1&&dn===0&&(p.mode&1)===0&&(Ol=he()+500,sf&&vs()))}function ci(d,p){var b=d.callbackNode;lu(d,p);var S=fo(d,d===gr?Sr:0);if(S===0)b!==null&&pe(b),d.callbackNode=null,d.callbackPriority=0;else if(p=S&-S,d.callbackPriority!==p){if(b!=null&&pe(b),p===1)d.tag===0?d4(l2.bind(null,d)):X1(l2.bind(null,d)),u4(function(){(dn&6)===0&&vs()}),b=null;else{switch(t1(S)){case 1:b=st;break;case 4:b=vt;break;case 16:b=ct;break;case 536870912:b=zt;break;default:b=ct}b=v2(b,u2.bind(null,d))}d.callbackPriority=p,d.callbackNode=b}}function u2(d,p){if(Df=-1,Nf=0,(dn&6)!==0)throw Error(t(327));var b=d.callbackNode;if(Ll()&&d.callbackNode!==b)return null;var S=fo(d,d===gr?Sr:0);if(S===0)return null;if((S&30)!==0||(S&d.expiredLanes)!==0||p)p=Pf(d,S);else{p=S;var M=dn;dn|=2;var D=h2();(gr!==d||Sr!==p)&&(Ta=null,Ol=he()+500,wu(d,p));do try{N4();break}catch(Z){c2(d,Z)}while(!0);rv(),Tf.current=D,dn=M,Qn!==null?p=0:(gr=null,Sr=0,p=rr)}if(p!==0){if(p===2&&(M=In(d),M!==0&&(S=M,p=zv(d,M))),p===1)throw b=Th,wu(d,0),Es(d,S),ci(d,he()),b;if(p===6)Es(d,S);else{if(M=d.current.alternate,(S&30)===0&&!I4(M)&&(p=Pf(d,S),p===2&&(D=In(d),D!==0&&(S=D,p=zv(d,D))),p===1))throw b=Th,wu(d,0),Es(d,S),ci(d,he()),b;switch(d.finishedWork=M,d.finishedLanes=S,p){case 0:case 1:throw Error(t(345));case 2:_u(d,li,Ta);break;case 3:if(Es(d,S),(S&130023424)===S&&(p=Lv+500-he(),10<p)){if(fo(d,0)!==0)break;if(M=d.suspendedLanes,(M&S)!==S){Qr(),d.pingedLanes|=d.suspendedLanes&M;break}d.timeoutHandle=qg(_u.bind(null,d,li,Ta),p);break}_u(d,li,Ta);break;case 4:if(Es(d,S),(S&4194240)===S)break;for(p=d.eventTimes,M=-1;0<S;){var G=31-ln(S);D=1<<G,G=p[G],G>M&&(M=G),S&=~D}if(S=M,S=he()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*A4(S/1960))-S,10<S){d.timeoutHandle=qg(_u.bind(null,d,li,Ta),S);break}_u(d,li,Ta);break;case 5:_u(d,li,Ta);break;default:throw Error(t(329))}}}return ci(d,he()),d.callbackNode===b?u2.bind(null,d):null}function zv(d,p){var b=Mh;return d.current.memoizedState.isDehydrated&&(wu(d,p).flags|=256),d=Pf(d,p),d!==2&&(p=li,li=b,p!==null&&Wv(p)),d}function Wv(d){li===null?li=d:li.push.apply(li,d)}function I4(d){for(var p=d;;){if(p.flags&16384){var b=p.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var S=0;S<b.length;S++){var M=b[S],D=M.getSnapshot;M=M.value;try{if(!po(D(),M))return!1}catch{return!1}}}if(b=p.child,p.subtreeFlags&16384&&b!==null)b.return=p,p=b;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Es(d,p){for(p&=~Ov,p&=~Mf,d.suspendedLanes|=p,d.pingedLanes&=~p,d=d.expirationTimes;0<p;){var b=31-ln(p),S=1<<b;d[b]=-1,p&=~S}}function l2(d){if((dn&6)!==0)throw Error(t(327));Ll();var p=fo(d,0);if((p&1)===0)return ci(d,he()),null;var b=Pf(d,p);if(d.tag!==0&&b===2){var S=In(d);S!==0&&(p=S,b=zv(d,S))}if(b===1)throw b=Th,wu(d,0),Es(d,p),ci(d,he()),b;if(b===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=p,_u(d,li,Ta),ci(d,he()),null}function Hv(d,p){var b=dn;dn|=1;try{return d(p)}finally{dn=b,dn===0&&(Ol=he()+500,sf&&vs())}}function bu(d){xs!==null&&xs.tag===0&&(dn&6)===0&&Ll();var p=dn;dn|=1;var b=Xi.transition,S=rn;try{if(Xi.transition=null,rn=1,d)return d()}finally{rn=S,Xi.transition=b,dn=p,(dn&6)===0&&vs()}}function Gv(){Ci=Fl.current,Ln(Fl)}function wu(d,p){d.finishedWork=null,d.finishedLanes=0;var b=d.timeoutHandle;if(b!==-1&&(d.timeoutHandle=-1,s4(b)),Qn!==null)for(b=Qn.return;b!==null;){var S=b;switch(Qg(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&of();break;case 3:Dl(),Ln(ai),Ln(Ir),hv();break;case 5:lv(S);break;case 4:Dl();break;case 13:Ln(Un);break;case 19:Ln(Un);break;case 10:iv(S.type._context);break;case 22:case 23:Gv()}b=b.return}if(gr=d,Qn=d=ks(d.current,null),Sr=Ci=p,rr=0,Th=null,Ov=Mf=yu=0,li=Mh=null,mu!==null){for(p=0;p<mu.length;p++)if(b=mu[p],S=b.interleaved,S!==null){b.interleaved=null;var M=S.next,D=b.pending;if(D!==null){var G=D.next;D.next=M,S.next=G}b.pending=S}mu=null}return d}function c2(d,p){do{var b=Qn;try{if(rv(),vf.current=_f,yf){for(var S=zn.memoizedState;S!==null;){var M=S.queue;M!==null&&(M.pending=null),S=S.next}yf=!1}if(vu=0,mr=nr=zn=null,_h=!1,xh=0,Fv.current=null,b===null||b.return===null){rr=1,Th=p,Qn=null;break}e:{var D=d,G=b.return,Z=b,ae=p;if(p=Sr,Z.flags|=32768,ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var Se=ae,Ge=Z,je=Ge.tag;if((Ge.mode&1)===0&&(je===0||je===11||je===15)){var ze=Ge.alternate;ze?(Ge.updateQueue=ze.updateQueue,Ge.memoizedState=ze.memoizedState,Ge.lanes=ze.lanes):(Ge.updateQueue=null,Ge.memoizedState=null)}var ht=Fx(G);if(ht!==null){ht.flags&=-257,Ox(ht,G,Z,D,p),ht.mode&1&&Px(D,Se,p),p=ht,ae=Se;var yt=p.updateQueue;if(yt===null){var xt=new Set;xt.add(ae),p.updateQueue=xt}else yt.add(ae);break e}else{if((p&1)===0){Px(D,Se,p),Vv();break e}ae=Error(t(426))}}else if(Bn&&Z.mode&1){var Kn=Fx(G);if(Kn!==null){(Kn.flags&65536)===0&&(Kn.flags|=256),Ox(Kn,G,Z,D,p),tv(Nl(ae,Z));break e}}D=ae=Nl(ae,Z),rr!==4&&(rr=2),Mh===null?Mh=[D]:Mh.push(D),D=G;do{switch(D.tag){case 3:D.flags|=65536,p&=-p,D.lanes|=p;var ge=Dx(D,ae,p);ox(D,ge);break e;case 1:Z=ae;var ce=D.type,we=D.stateNode;if((D.flags&128)===0&&(typeof ce.getDerivedStateFromError=="function"||we!==null&&typeof we.componentDidCatch=="function"&&(_s===null||!_s.has(we)))){D.flags|=65536,p&=-p,D.lanes|=p;var et=Nx(D,Z,p);ox(D,et);break e}}D=D.return}while(D!==null)}f2(b)}catch(St){p=St,Qn===b&&b!==null&&(Qn=b=b.return);continue}break}while(!0)}function h2(){var d=Tf.current;return Tf.current=_f,d===null?_f:d}function Vv(){(rr===0||rr===3||rr===2)&&(rr=4),gr===null||(yu&268435455)===0&&(Mf&268435455)===0||Es(gr,Sr)}function Pf(d,p){var b=dn;dn|=2;var S=h2();(gr!==d||Sr!==p)&&(Ta=null,wu(d,p));do try{D4();break}catch(M){c2(d,M)}while(!0);if(rv(),dn=b,Tf.current=S,Qn!==null)throw Error(t(261));return gr=null,Sr=0,rr}function D4(){for(;Qn!==null;)d2(Qn)}function N4(){for(;Qn!==null&&!Ee();)d2(Qn)}function d2(d){var p=g2(d.alternate,d,Ci);d.memoizedProps=d.pendingProps,p===null?f2(d):Qn=p,Fv.current=null}function f2(d){var p=d;do{var b=p.alternate;if(d=p.return,(p.flags&32768)===0){if(b=k4(b,p,Ci),b!==null){Qn=b;return}}else{if(b=C4(b,p),b!==null){b.flags&=32767,Qn=b;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{rr=6,Qn=null;return}}if(p=p.sibling,p!==null){Qn=p;return}Qn=p=d}while(p!==null);rr===0&&(rr=5)}function _u(d,p,b){var S=rn,M=Xi.transition;try{Xi.transition=null,rn=1,P4(d,p,b,S)}finally{Xi.transition=M,rn=S}return null}function P4(d,p,b,S){do Ll();while(xs!==null);if((dn&6)!==0)throw Error(t(327));b=d.finishedWork;var M=d.finishedLanes;if(b===null)return null;if(d.finishedWork=null,d.finishedLanes=0,b===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var D=b.lanes|b.childLanes;if(Ar(d,D),d===gr&&(Qn=gr=null,Sr=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||Af||(Af=!0,v2(ct,function(){return Ll(),null})),D=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||D){D=Xi.transition,Xi.transition=null;var G=rn;rn=1;var Z=dn;dn|=4,Fv.current=null,M4(d,b),r2(b,d),e4(Vg),Vd=!!Gg,Vg=Gg=null,d.current=b,R4(b),Ce(),dn=Z,rn=G,Xi.transition=D}else d.current=b;if(Af&&(Af=!1,xs=d,If=M),D=d.pendingLanes,D===0&&(_s=null),xn(b.stateNode),ci(d,he()),p!==null)for(S=d.onRecoverableError,b=0;b<p.length;b++)M=p[b],S(M.value,{componentStack:M.stack,digest:M.digest});if(Rf)throw Rf=!1,d=Bv,Bv=null,d;return(If&1)!==0&&d.tag!==0&&Ll(),D=d.pendingLanes,(D&1)!==0?d===Uv?Rh++:(Rh=0,Uv=d):Rh=0,vs(),null}function Ll(){if(xs!==null){var d=t1(If),p=Xi.transition,b=rn;try{if(Xi.transition=null,rn=16>d?16:d,xs===null)var S=!1;else{if(d=xs,xs=null,If=0,(dn&6)!==0)throw Error(t(331));var M=dn;for(dn|=4,mt=d.current;mt!==null;){var D=mt,G=D.child;if((mt.flags&16)!==0){var Z=D.deletions;if(Z!==null){for(var ae=0;ae<Z.length;ae++){var Se=Z[ae];for(mt=Se;mt!==null;){var Ge=mt;switch(Ge.tag){case 0:case 11:case 15:Ch(8,Ge,D)}var je=Ge.child;if(je!==null)je.return=Ge,mt=je;else for(;mt!==null;){Ge=mt;var ze=Ge.sibling,ht=Ge.return;if(Qx(Ge),Ge===Se){mt=null;break}if(ze!==null){ze.return=ht,mt=ze;break}mt=ht}}}var yt=D.alternate;if(yt!==null){var xt=yt.child;if(xt!==null){yt.child=null;do{var Kn=xt.sibling;xt.sibling=null,xt=Kn}while(xt!==null)}}mt=D}}if((D.subtreeFlags&2064)!==0&&G!==null)G.return=D,mt=G;else e:for(;mt!==null;){if(D=mt,(D.flags&2048)!==0)switch(D.tag){case 0:case 11:case 15:Ch(9,D,D.return)}var ge=D.sibling;if(ge!==null){ge.return=D.return,mt=ge;break e}mt=D.return}}var ce=d.current;for(mt=ce;mt!==null;){G=mt;var we=G.child;if((G.subtreeFlags&2064)!==0&&we!==null)we.return=G,mt=we;else e:for(G=ce;mt!==null;){if(Z=mt,(Z.flags&2048)!==0)try{switch(Z.tag){case 0:case 11:case 15:Cf(9,Z)}}catch(St){Vn(Z,Z.return,St)}if(Z===G){mt=null;break e}var et=Z.sibling;if(et!==null){et.return=Z.return,mt=et;break e}mt=Z.return}}if(dn=M,vs(),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot(Rt,d)}catch{}S=!0}return S}finally{rn=b,Xi.transition=p}}return!1}function p2(d,p,b){p=Nl(b,p),p=Dx(d,p,1),d=bs(d,p,1),p=Qr(),d!==null&&(Yn(d,1,p),ci(d,p))}function Vn(d,p,b){if(d.tag===3)p2(d,d,b);else for(;p!==null;){if(p.tag===3){p2(p,d,b);break}else if(p.tag===1){var S=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(_s===null||!_s.has(S))){d=Nl(b,d),d=Nx(p,d,1),p=bs(p,d,1),d=Qr(),p!==null&&(Yn(p,1,d),ci(p,d));break}}p=p.return}}function F4(d,p,b){var S=d.pingCache;S!==null&&S.delete(p),p=Qr(),d.pingedLanes|=d.suspendedLanes&b,gr===d&&(Sr&b)===b&&(rr===4||rr===3&&(Sr&130023424)===Sr&&500>he()-Lv?wu(d,0):Ov|=b),ci(d,p)}function m2(d,p){p===0&&((d.mode&1)===0?p=1:(p=nn,nn<<=1,(nn&130023424)===0&&(nn=4194304)));var b=Qr();d=Ea(d,p),d!==null&&(Yn(d,p,b),ci(d,b))}function O4(d){var p=d.memoizedState,b=0;p!==null&&(b=p.retryLane),m2(d,b)}function L4(d,p){var b=0;switch(d.tag){case 13:var S=d.stateNode,M=d.memoizedState;M!==null&&(b=M.retryLane);break;case 19:S=d.stateNode;break;default:throw Error(t(314))}S!==null&&S.delete(p),m2(d,b)}var g2;g2=function(d,p,b){if(d!==null)if(d.memoizedProps!==p.pendingProps||ai.current)ui=!0;else{if((d.lanes&b)===0&&(p.flags&128)===0)return ui=!1,E4(d,p,b);ui=(d.flags&131072)!==0}else ui=!1,Bn&&(p.flags&1048576)!==0&&Y1(p,lf,p.index);switch(p.lanes=0,p.tag){case 2:var S=p.type;Ef(d,p),d=p.pendingProps;var M=kl(p,Ir.current);Il(p,b),M=pv(null,p,S,d,M,b);var D=mv();return p.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,si(S)?(D=!0,af(p)):D=!1,p.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,sv(p),M.updater=xf,p.stateNode=M,M._reactInternals=p,_v(p,S,d,b),p=kv(null,p,S,!0,D,b)):(p.tag=0,Bn&&D&&Jg(p),Jr(null,p,M,b),p=p.child),p;case 16:S=p.elementType;e:{switch(Ef(d,p),d=p.pendingProps,M=S._init,S=M(S._payload),p.type=S,M=p.tag=U4(S),d=go(S,d),M){case 0:p=Ev(null,p,S,d,b);break e;case 1:p=Hx(null,p,S,d,b);break e;case 11:p=Lx(null,p,S,d,b);break e;case 14:p=Bx(null,p,S,go(S.type,d),b);break e}throw Error(t(306,S,""))}return p;case 0:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:go(S,M),Ev(d,p,S,M,b);case 1:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:go(S,M),Hx(d,p,S,M,b);case 3:e:{if(Gx(p),d===null)throw Error(t(387));S=p.pendingProps,D=p.memoizedState,M=D.element,ix(d,p),mf(p,S,null,b);var G=p.memoizedState;if(S=G.element,D.isDehydrated)if(D={element:S,isDehydrated:!1,cache:G.cache,pendingSuspenseBoundaries:G.pendingSuspenseBoundaries,transitions:G.transitions},p.updateQueue.baseState=D,p.memoizedState=D,p.flags&256){M=Nl(Error(t(423)),p),p=Vx(d,p,S,b,M);break e}else if(S!==M){M=Nl(Error(t(424)),p),p=Vx(d,p,S,b,M);break e}else for(ki=ps(p.stateNode.containerInfo.firstChild),Ei=p,Bn=!0,mo=null,b=nx(p,null,S,b),p.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Ml(),S===M){p=Ca(d,p,b);break e}Jr(d,p,S,b)}p=p.child}return p;case 5:return sx(p),d===null&&ev(p),S=p.type,M=p.pendingProps,D=d!==null?d.memoizedProps:null,G=M.children,jg(S,M)?G=null:D!==null&&jg(S,D)&&(p.flags|=32),Wx(d,p),Jr(d,p,G,b),p.child;case 6:return d===null&&ev(p),null;case 13:return jx(d,p,b);case 4:return uv(p,p.stateNode.containerInfo),S=p.pendingProps,d===null?p.child=Rl(p,null,S,b):Jr(d,p,S,b),p.child;case 11:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:go(S,M),Lx(d,p,S,M,b);case 7:return Jr(d,p,p.pendingProps,b),p.child;case 8:return Jr(d,p,p.pendingProps.children,b),p.child;case 12:return Jr(d,p,p.pendingProps.children,b),p.child;case 10:e:{if(S=p.type._context,M=p.pendingProps,D=p.memoizedProps,G=M.value,Dn(df,S._currentValue),S._currentValue=G,D!==null)if(po(D.value,G)){if(D.children===M.children&&!ai.current){p=Ca(d,p,b);break e}}else for(D=p.child,D!==null&&(D.return=p);D!==null;){var Z=D.dependencies;if(Z!==null){G=D.child;for(var ae=Z.firstContext;ae!==null;){if(ae.context===S){if(D.tag===1){ae=ka(-1,b&-b),ae.tag=2;var Se=D.updateQueue;if(Se!==null){Se=Se.shared;var Ge=Se.pending;Ge===null?ae.next=ae:(ae.next=Ge.next,Ge.next=ae),Se.pending=ae}}D.lanes|=b,ae=D.alternate,ae!==null&&(ae.lanes|=b),ov(D.return,b,p),Z.lanes|=b;break}ae=ae.next}}else if(D.tag===10)G=D.type===p.type?null:D.child;else if(D.tag===18){if(G=D.return,G===null)throw Error(t(341));G.lanes|=b,Z=G.alternate,Z!==null&&(Z.lanes|=b),ov(G,b,p),G=D.sibling}else G=D.child;if(G!==null)G.return=D;else for(G=D;G!==null;){if(G===p){G=null;break}if(D=G.sibling,D!==null){D.return=G.return,G=D;break}G=G.return}D=G}Jr(d,p,M.children,b),p=p.child}return p;case 9:return M=p.type,S=p.pendingProps.children,Il(p,b),M=qi(M),S=S(M),p.flags|=1,Jr(d,p,S,b),p.child;case 14:return S=p.type,M=go(S,p.pendingProps),M=go(S.type,M),Bx(d,p,S,M,b);case 15:return Ux(d,p,p.type,p.pendingProps,b);case 17:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:go(S,M),Ef(d,p),p.tag=1,si(S)?(d=!0,af(p)):d=!1,Il(p,b),Ax(p,S,M),_v(p,S,M,b),kv(null,p,S,!0,d,b);case 19:return $x(d,p,b);case 22:return zx(d,p,b)}throw Error(t(156,p.tag))};function v2(d,p){return $(d,p)}function B4(d,p,b,S){this.tag=d,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Yi(d,p,b,S){return new B4(d,p,b,S)}function jv(d){return d=d.prototype,!(!d||!d.isReactComponent)}function U4(d){if(typeof d=="function")return jv(d)?1:0;if(d!=null){if(d=d.$$typeof,d===O)return 11;if(d===B)return 14}return 2}function ks(d,p){var b=d.alternate;return b===null?(b=Yi(d.tag,p,d.key,d.mode),b.elementType=d.elementType,b.type=d.type,b.stateNode=d.stateNode,b.alternate=d,d.alternate=b):(b.pendingProps=p,b.type=d.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=d.flags&14680064,b.childLanes=d.childLanes,b.lanes=d.lanes,b.child=d.child,b.memoizedProps=d.memoizedProps,b.memoizedState=d.memoizedState,b.updateQueue=d.updateQueue,p=d.dependencies,b.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},b.sibling=d.sibling,b.index=d.index,b.ref=d.ref,b}function Ff(d,p,b,S,M,D){var G=2;if(S=d,typeof d=="function")jv(d)&&(G=1);else if(typeof d=="string")G=5;else e:switch(d){case A:return xu(b.children,M,D,p);case I:G=8,M|=8;break;case T:return d=Yi(12,b,p,M|2),d.elementType=T,d.lanes=D,d;case V:return d=Yi(13,b,p,M),d.elementType=V,d.lanes=D,d;case F:return d=Yi(19,b,p,M),d.elementType=F,d.lanes=D,d;case P:return Of(b,M,D,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case R:G=10;break e;case N:G=9;break e;case O:G=11;break e;case B:G=14;break e;case U:G=16,S=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return p=Yi(G,b,p,M),p.elementType=d,p.type=S,p.lanes=D,p}function xu(d,p,b,S){return d=Yi(7,d,S,p),d.lanes=b,d}function Of(d,p,b,S){return d=Yi(22,d,S,p),d.elementType=P,d.lanes=b,d.stateNode={isHidden:!1},d}function qv(d,p,b){return d=Yi(6,d,null,p),d.lanes=b,d}function $v(d,p,b){return p=Yi(4,d.children!==null?d.children:[],d.key,p),p.lanes=b,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function z4(d,p,b,S,M){this.tag=p,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rr(0),this.expirationTimes=Rr(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rr(0),this.identifierPrefix=S,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function Xv(d,p,b,S,M,D,G,Z,ae){return d=new z4(d,p,b,Z,ae),p===1?(p=1,D===!0&&(p|=8)):p=0,D=Yi(3,null,null,p),d.current=D,D.stateNode=d,D.memoizedState={element:S,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},sv(D),d}function W4(d,p,b){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:C,key:S==null?null:""+S,children:d,containerInfo:p,implementation:b}}function y2(d){if(!d)return gs;d=d._reactInternals;e:{if(ho(d)!==d||d.tag!==1)throw Error(t(170));var p=d;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(si(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(t(171))}if(d.tag===1){var b=d.type;if(si(b))return q1(d,b,p)}return p}function b2(d,p,b,S,M,D,G,Z,ae){return d=Xv(b,S,!0,d,M,D,G,Z,ae),d.context=y2(null),b=d.current,S=Qr(),M=Ss(b),D=ka(S,M),D.callback=p??null,bs(b,D,M),d.current.lanes=M,Yn(d,M,S),ci(d,S),d}function Lf(d,p,b,S){var M=p.current,D=Qr(),G=Ss(M);return b=y2(b),p.context===null?p.context=b:p.pendingContext=b,p=ka(D,G),p.payload={element:d},S=S===void 0?null:S,S!==null&&(p.callback=S),d=bs(M,p,G),d!==null&&(bo(d,M,G,D),pf(d,M,G)),G}function Bf(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function w2(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var b=d.retryLane;d.retryLane=b!==0&&b<p?b:p}}function Yv(d,p){w2(d,p),(d=d.alternate)&&w2(d,p)}function H4(){return null}var _2=typeof reportError=="function"?reportError:function(d){console.error(d)};function Kv(d){this._internalRoot=d}Uf.prototype.render=Kv.prototype.render=function(d){var p=this._internalRoot;if(p===null)throw Error(t(409));Lf(d,p,null,null)},Uf.prototype.unmount=Kv.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var p=d.containerInfo;bu(function(){Lf(null,d,null,null)}),p[wa]=null}};function Uf(d){this._internalRoot=d}Uf.prototype.unstable_scheduleHydration=function(d){if(d){var p=i1();d={blockedOn:null,target:d,priority:p};for(var b=0;b<hs.length&&p!==0&&p<hs[b].priority;b++);hs.splice(b,0,d),b===0&&s1(d)}};function Jv(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function zf(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function x2(){}function G4(d,p,b,S,M){if(M){if(typeof S=="function"){var D=S;S=function(){var Se=Bf(G);D.call(Se)}}var G=b2(p,S,d,0,null,!1,!1,"",x2);return d._reactRootContainer=G,d[wa]=G.current,fh(d.nodeType===8?d.parentNode:d),bu(),G}for(;M=d.lastChild;)d.removeChild(M);if(typeof S=="function"){var Z=S;S=function(){var Se=Bf(ae);Z.call(Se)}}var ae=Xv(d,0,!1,null,null,!1,!1,"",x2);return d._reactRootContainer=ae,d[wa]=ae.current,fh(d.nodeType===8?d.parentNode:d),bu(function(){Lf(p,ae,b,S)}),ae}function Wf(d,p,b,S,M){var D=b._reactRootContainer;if(D){var G=D;if(typeof M=="function"){var Z=M;M=function(){var ae=Bf(G);Z.call(ae)}}Lf(p,G,d,M)}else G=G4(b,p,d,M,S);return Bf(G)}n1=function(d){switch(d.tag){case 3:var p=d.stateNode;if(p.current.memoizedState.isDehydrated){var b=tr(p.pendingLanes);b!==0&&(cu(p,b|1),ci(p,he()),(dn&6)===0&&(Ol=he()+500,vs()))}break;case 13:bu(function(){var S=Ea(d,1);if(S!==null){var M=Qr();bo(S,d,1,M)}}),Yv(d,1)}},xg=function(d){if(d.tag===13){var p=Ea(d,134217728);if(p!==null){var b=Qr();bo(p,d,134217728,b)}Yv(d,134217728)}},r1=function(d){if(d.tag===13){var p=Ss(d),b=Ea(d,p);if(b!==null){var S=Qr();bo(b,d,p,S)}Yv(d,p)}},i1=function(){return rn},o1=function(d,p){var b=rn;try{return rn=d,p()}finally{rn=b}},He=function(d,p,b){switch(p){case"input":if(qe(d,b),p=b.name,b.type==="radio"&&p!=null){for(b=d;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+p)+'][type="radio"]'),p=0;p<b.length;p++){var S=b[p];if(S!==d&&S.form===d.form){var M=rf(S);if(!M)throw Error(t(90));lt(S),qe(S,M)}}}break;case"textarea":j(d,b);break;case"select":p=b.value,p!=null&&Mt(d,!!b.multiple,p,!1)}},Ht=Hv,bn=bu;var V4={usingClientEntryPoint:!1,Events:[gh,Sl,rf,Fe,gt,Hv]},Ah={findFiberByHostInstance:hu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},j4={bundleType:Ah.bundleType,version:Ah.version,rendererPackageName:Ah.rendererPackageName,rendererConfig:Ah.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=zd(d),d===null?null:d.stateNode},findFiberByHostInstance:Ah.findFiberByHostInstance||H4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hf.isDisabled&&Hf.supportsFiber)try{Rt=Hf.inject(j4),jt=Hf}catch{}}return hi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=V4,hi.createPortal=function(d,p){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Jv(p))throw Error(t(200));return W4(d,p,null,b)},hi.createRoot=function(d,p){if(!Jv(d))throw Error(t(299));var b=!1,S="",M=_2;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(S=p.identifierPrefix),p.onRecoverableError!==void 0&&(M=p.onRecoverableError)),p=Xv(d,1,!1,null,null,b,!1,S,M),d[wa]=p.current,fh(d.nodeType===8?d.parentNode:d),new Kv(p)},hi.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=zd(p),d=d===null?null:d.stateNode,d},hi.flushSync=function(d){return bu(d)},hi.hydrate=function(d,p,b){if(!zf(p))throw Error(t(200));return Wf(null,d,p,!0,b)},hi.hydrateRoot=function(d,p,b){if(!Jv(d))throw Error(t(405));var S=b!=null&&b.hydratedSources||null,M=!1,D="",G=_2;if(b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(D=b.identifierPrefix),b.onRecoverableError!==void 0&&(G=b.onRecoverableError)),p=b2(p,null,d,1,b??null,M,!1,D,G),d[wa]=p.current,fh(d),S)for(d=0;d<S.length;d++)b=S[d],M=b._getVersion,M=M(b._source),p.mutableSourceEagerHydrationData==null?p.mutableSourceEagerHydrationData=[b,M]:p.mutableSourceEagerHydrationData.push(b,M);return new Uf(p)},hi.render=function(d,p,b){if(!zf(p))throw Error(t(200));return Wf(null,d,p,!1,b)},hi.unmountComponentAtNode=function(d){if(!zf(d))throw Error(t(40));return d._reactRootContainer?(bu(function(){Wf(null,null,d,!1,function(){d._reactRootContainer=null,d[wa]=null})}),!0):!1},hi.unstable_batchedUpdates=Hv,hi.unstable_renderSubtreeIntoContainer=function(d,p,b,S){if(!zf(b))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return Wf(d,p,b,!1,S)},hi.version="18.3.1-next-f1338f8080-20240426",hi}var A2;function nC(){if(A2)return ey.exports;A2=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ey.exports=Z4(),ey.exports}var I2;function eI(){if(I2)return Gf;I2=1;var n=nC();return Gf.createRoot=n.createRoot,Gf.hydrateRoot=n.hydrateRoot,Gf}var tI=eI(),Ze=qc();const Do=tu(Ze);var ry={},iy={},oy={},D2;function nI(){return D2||(D2=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];if(typeof window<"u"){var s;typeof window.gtag>"u"&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(s=window).gtag.apply(s,o)}},t=e;n.default=t})(oy)),oy}var ay={},N2;function rI(){return N2||(N2=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=a;var e=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;function t(s){return s.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(u,l,c){return l>0&&l+u.length!==c.length&&u.search(e)>-1&&c.charAt(l-2)!==":"&&(c.charAt(l+u.length)!=="-"||c.charAt(l-1)==="-")&&c.charAt(l-1).search(/[^\s-]/)<0?u.toLowerCase():u.substr(1).search(/[A-Z]|\../)>-1?u:u.charAt(0).toUpperCase()+u.substr(1)})}function r(s){return typeof s=="string"&&s.indexOf("@")!==-1}var i="REDACTED (Potential Email Address)";function o(s){return r(s)?(console.warn("This arg looks like an email address, redacting."),i):s}function a(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,c=s||"";return u&&(c=t(s)),l&&(c=o(c)),c}})(ay)),ay}var P2;function iI(){return P2||(P2=1,(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.GA4=void 0;var e=a(nI()),t=a(rI()),r=["eventCategory","eventAction","eventLabel","eventValue","hitType"],i=["title","location"],o=["page","hitType"];function a(F){return F&&F.__esModule?F:{default:F}}function s(F,B){if(F==null)return{};var U=u(F,B),P,L;if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(F);for(L=0;L<H.length;L++)P=H[L],!(B.indexOf(P)>=0)&&Object.prototype.propertyIsEnumerable.call(F,P)&&(U[P]=F[P])}return U}function u(F,B){if(F==null)return{};var U={},P=Object.keys(F),L,H;for(H=0;H<P.length;H++)L=P[H],!(B.indexOf(L)>=0)&&(U[L]=F[L]);return U}function l(F){"@babel/helpers - typeof";return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},l(F)}function c(F){return m(F)||f(F)||x(F)||h()}function h(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f(F){if(typeof Symbol<"u"&&F[Symbol.iterator]!=null||F["@@iterator"]!=null)return Array.from(F)}function m(F){if(Array.isArray(F))return E(F)}function g(F,B){var U=Object.keys(F);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(F);B&&(P=P.filter(function(L){return Object.getOwnPropertyDescriptor(F,L).enumerable})),U.push.apply(U,P)}return U}function w(F){for(var B=1;B<arguments.length;B++){var U=arguments[B]!=null?arguments[B]:{};B%2?g(Object(U),!0).forEach(function(P){T(F,P,U[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(U)):g(Object(U)).forEach(function(P){Object.defineProperty(F,P,Object.getOwnPropertyDescriptor(U,P))})}return F}function v(F,B){return k(F)||_(F,B)||x(F,B)||y()}function y(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x(F,B){if(F){if(typeof F=="string")return E(F,B);var U=Object.prototype.toString.call(F).slice(8,-1);if(U==="Object"&&F.constructor&&(U=F.constructor.name),U==="Map"||U==="Set")return Array.from(F);if(U==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(U))return E(F,B)}}function E(F,B){(B==null||B>F.length)&&(B=F.length);for(var U=0,P=new Array(B);U<B;U++)P[U]=F[U];return P}function _(F,B){var U=F==null?null:typeof Symbol<"u"&&F[Symbol.iterator]||F["@@iterator"];if(U!=null){var P,L,H,W,z=[],q=!0,re=!1;try{if(H=(U=U.call(F)).next,B!==0)for(;!(q=(P=H.call(U)).done)&&(z.push(P.value),z.length!==B);q=!0);}catch(de){re=!0,L=de}finally{try{if(!q&&U.return!=null&&(W=U.return(),Object(W)!==W))return}finally{if(re)throw L}}return z}}function k(F){if(Array.isArray(F))return F}function C(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function A(F,B){for(var U=0;U<B.length;U++){var P=B[U];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(F,R(P.key),P)}}function I(F,B,U){return B&&A(F.prototype,B),Object.defineProperty(F,"prototype",{writable:!1}),F}function T(F,B,U){return B=R(B),B in F?Object.defineProperty(F,B,{value:U,enumerable:!0,configurable:!0,writable:!0}):F[B]=U,F}function R(F){var B=N(F,"string");return l(B)==="symbol"?B:String(B)}function N(F,B){if(l(F)!=="object"||F===null)return F;var U=F[Symbol.toPrimitive];if(U!==void 0){var P=U.call(F,B);if(l(P)!=="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(B==="string"?String:Number)(F)}var O=(function(){function F(){var B=this;C(this,F),T(this,"reset",function(){B.isInitialized=!1,B._testMode=!1,B._currentMeasurementId,B._hasLoadedGA=!1,B._isQueuing=!1,B._queueGtag=[]}),T(this,"_gtag",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];B._testMode||B._isQueuing?B._queueGtag.push(P):e.default.apply(void 0,P)}),T(this,"_loadGA",function(U,P){var L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"https://www.googletagmanager.com/gtag/js";if(!(typeof window>"u"||typeof document>"u")&&!B._hasLoadedGA){var H=document.createElement("script");H.async=!0,H.src="".concat(L,"?id=").concat(U),P&&H.setAttribute("nonce",P),document.body.appendChild(H),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},B._hasLoadedGA=!0}}),T(this,"_toGtagOptions",function(U){if(U){var P={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"},L=Object.entries(U).reduce(function(H,W){var z=v(W,2),q=z[0],re=z[1];return P[q]?H[P[q]]=re:H[q]=re,H},{});return L}}),T(this,"initialize",function(U){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!U)throw new Error("Require GA_MEASUREMENT_ID");var L=typeof U=="string"?[{trackingId:U}]:U;B._currentMeasurementId=L[0].trackingId;var H=P.gaOptions,W=P.gtagOptions,z=P.nonce,q=P.testMode,re=q===void 0?!1:q,de=P.gtagUrl;if(B._testMode=re,re||B._loadGA(B._currentMeasurementId,z,de),B.isInitialized||(B._gtag("js",new Date),L.forEach(function(ie){var fe=w(w(w({},B._toGtagOptions(w(w({},H),ie.gaOptions))),W),ie.gtagOptions);Object.keys(fe).length?B._gtag("config",ie.trackingId,fe):B._gtag("config",ie.trackingId)})),B.isInitialized=!0,!re){var ye=c(B._queueGtag);for(B._queueGtag=[],B._isQueuing=!1;ye.length;){var te=ye.shift();B._gtag.apply(B,c(te)),te[0]==="get"&&(B._isQueuing=!0)}}}),T(this,"set",function(U){if(!U){console.warn("`fieldsObject` is required in .set()");return}if(l(U)!=="object"){console.warn("Expected `fieldsObject` arg to be an Object");return}Object.keys(U).length===0&&console.warn("empty `fieldsObject` given to .set()"),B._gaCommand("set",U)}),T(this,"_gaCommandSendEvent",function(U,P,L,H,W){B._gtag("event",P,w(w({event_category:U,event_label:L,value:H},W&&{non_interaction:W.nonInteraction}),B._toGtagOptions(W)))}),T(this,"_gaCommandSendEventParameters",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];if(typeof P[0]=="string")B._gaCommandSendEvent.apply(B,c(P.slice(1)));else{var H=P[0],W=H.eventCategory,z=H.eventAction,q=H.eventLabel,re=H.eventValue;H.hitType;var de=s(H,r);B._gaCommandSendEvent(W,z,q,re,de)}}),T(this,"_gaCommandSendTiming",function(U,P,L,H){B._gtag("event","timing_complete",{name:P,value:L,event_category:U,event_label:H})}),T(this,"_gaCommandSendPageview",function(U,P){if(P&&Object.keys(P).length){var L=B._toGtagOptions(P),H=L.title,W=L.location,z=s(L,i);B._gtag("event","page_view",w(w(w(w({},U&&{page_path:U}),H&&{page_title:H}),W&&{page_location:W}),z))}else U?B._gtag("event","page_view",{page_path:U}):B._gtag("event","page_view")}),T(this,"_gaCommandSendPageviewParameters",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];if(typeof P[0]=="string")B._gaCommandSendPageview.apply(B,c(P.slice(1)));else{var H=P[0],W=H.page;H.hitType;var z=s(H,o);B._gaCommandSendPageview(W,z)}}),T(this,"_gaCommandSend",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];var H=typeof P[0]=="string"?P[0]:P[0].hitType;switch(H){case"event":B._gaCommandSendEventParameters.apply(B,P);break;case"pageview":B._gaCommandSendPageviewParameters.apply(B,P);break;case"timing":B._gaCommandSendTiming.apply(B,c(P.slice(1)));break;case"screenview":case"transaction":case"item":case"social":case"exception":console.warn("Unsupported send command: ".concat(H));break;default:console.warn("Send command doesn't exist: ".concat(H))}}),T(this,"_gaCommandSet",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];typeof P[0]=="string"&&(P[0]=T({},P[0],P[1])),B._gtag("set",B._toGtagOptions(P[0]))}),T(this,"_gaCommand",function(U){for(var P=arguments.length,L=new Array(P>1?P-1:0),H=1;H<P;H++)L[H-1]=arguments[H];switch(U){case"send":B._gaCommandSend.apply(B,L);break;case"set":B._gaCommandSet.apply(B,L);break;default:console.warn("Command doesn't exist: ".concat(U))}}),T(this,"ga",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];if(typeof P[0]=="string")B._gaCommand.apply(B,P);else{var H=P[0];B._gtag("get",B._currentMeasurementId,"client_id",function(W){B._isQueuing=!1;var z=B._queueGtag;for(H({get:function(de){return de==="clientId"?W:de==="trackingId"?B._currentMeasurementId:de==="apiVersion"?"1":void 0}});z.length;){var q=z.shift();B._gtag.apply(B,c(q))}}),B._isQueuing=!0}return B.ga}),T(this,"event",function(U,P){if(typeof U=="string")B._gtag("event",U,B._toGtagOptions(P));else{var L=U.action,H=U.category,W=U.label,z=U.value,q=U.nonInteraction,re=U.transport;if(!H||!L){console.warn("args.category AND args.action are required in event()");return}var de={hitType:"event",eventCategory:(0,t.default)(H),eventAction:(0,t.default)(L)};W&&(de.eventLabel=(0,t.default)(W)),typeof z<"u"&&(typeof z!="number"?console.warn("Expected `args.value` arg to be a Number."):de.eventValue=z),typeof q<"u"&&(typeof q!="boolean"?console.warn("`args.nonInteraction` must be a boolean."):de.nonInteraction=q),typeof re<"u"&&(typeof re!="string"?console.warn("`args.transport` must be a string."):(["beacon","xhr","image"].indexOf(re)===-1&&console.warn("`args.transport` must be either one of these values: `beacon`, `xhr` or `image`"),de.transport=re)),B._gaCommand("send",de)}}),T(this,"send",function(U){B._gaCommand("send",U)}),this.reset()}return I(F,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}}]),F})();n.GA4=O;var V=new O;n.default=V})(iy)),iy}var F2;function oI(){return F2||(F2=1,(function(n){function e(s){"@babel/helpers - typeof";return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},e(s)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=n.ReactGAImplementation=void 0;var t=i(iI());function r(s){if(typeof WeakMap!="function")return null;var u=new WeakMap,l=new WeakMap;return(r=function(h){return h?l:u})(s)}function i(s,u){if(s&&s.__esModule)return s;if(s===null||e(s)!=="object"&&typeof s!="function")return{default:s};var l=r(u);if(l&&l.has(s))return l.get(s);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in s)if(f!=="default"&&Object.prototype.hasOwnProperty.call(s,f)){var m=h?Object.getOwnPropertyDescriptor(s,f):null;m&&(m.get||m.set)?Object.defineProperty(c,f,m):c[f]=s[f]}return c.default=s,l&&l.set(s,c),c}var o=t.GA4;n.ReactGAImplementation=o;var a=t.default;n.default=a})(ry)),ry}var aI=oI();const rC=tu(aI),sI={name:"Abhishek Maharjan",label:"Software Engineer / SRE / Platform Engineer",picture:"",email:"rpidanny.abhishek@gmail.com",phone:"",website:"https://rpidanny.github.io/",summary:["Software Engineer with 10+ years building scalable, resilient systems, passionate about LLMs, infrastructure, and automating reliability at scale."],location:{city:"Utrecht",country:"Netherlands",countryCode:"NL"},profiles:{social:[{network:"Twitter",username:"rpidanny",url:"https://twitter.com/rpidanny"},{network:"Medium",username:"rpidanny",url:"https://blog.abhishek.pro.np"}],cv:[{network:"Github",username:"rpidanny",url:"https://github.com/rpidanny"},{network:"Linkedin",username:"Abhishek Maharjan",url:"https://www.linkedin.com/in/abhishek-m-5b401999/"}]},quote:{quote:"People who are really serious about software should make their own hardware",author:"Alan Kay"}},uI=[{title:"AWS Certified Solutions Architect - Associate",issueDate:"Jun 03, 2019",expirationDate:"Jun 03, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=1&t=c&d=2019-06-03&ci=AWS00868684",image:"CSAA.png"},{title:"AWS Certified Developer - Associate",issueDate:"Aug 06, 2019",expirationDate:"Aug 06, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=2&t=c&d=2019-08-06&ci=AWS00868684",image:"CDVA.png"},{title:"AWS Certified SysOps Administrator - Associate",issueDate:"Aug 06, 2019",expirationDate:"Aug 06, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=3&t=c&d=2019-09-03&ci=AWS00868684",image:"CSOA.png"},{title:"AWS Certified Cloud Practitioner",issueDate:"Oct 09, 2019",expirationDate:"Oct 09, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=9&t=c&d=2019-10-09&ci=AWS00868684",image:"CCP.png"}],lI=[{company:"Lemonade",position:"Senior Software Engineer -- Telematics",website:"",startDate:"2023-02-01",endDate:"Present",summary:"Design and built core services for car telematics, focusing on high-volume data processing, platform reliability, and developer productivity.",highlights:["Re-architected the core telematics trips services, reducing MTTR by 90%, cutting container usage by 50%, and simplifying the domain to accelerate product delivery.","Built an IaC-driven observability provisioning framework for Datadog and Grafana that automated dashboard creation end-to-end, reducing setup time by ~98% (from multiple days to ~1 hour).","Developed a unified alerting library covering application, infrastructure, and business KPIs; standardized alert quality across all services.","Reduced DynamoDB costs by 70% on a high-volume subsystem via bloom-filterbased optimizations.","Designed and implemented a unified, scalable ingestion pipeline for mobile, OBD, and OEM trip data with single-config IaC provisioning.","Created a fully local runtime/testing workflow, improving DX and cutting development cycle time by ~95%.","Created a team CLI and tooling suite that streamlined local development, reduced onboarding friction, and improved operational efficiency."]},{company:"DAZN Group",position:"Senior Software Engineer",website:"",startDate:"2020-07-01",endDate:"2023-02-01",summary:"Designed and scaled core backend services handling ~100k requests/sec, supporting millions of DAZN users. Prioritized reliability, safe deployments, high performance, and cost efficiency across large-scale distributed systems.",highlights:["Introduced Blue/Green and Canary deployments, to reduce deployment-related incidents and reduced rollback time during incidents by ~98%.","Implemented a custom autoscaling solution that responded to traffic ~2 faster.","Built an internal load-testing platform capable of simulating thousands of requests per second, enabling frictionless performance testing across teams.","Built a cost-efficient data engineering pipeline reducing operational cost by 96%.","Developed and maintained an inner-source tool visualizing Terraform plans on PRs.","Built and maintain an inner-source package that became one of the most used package in DAZN."]},{company:"Trivago",position:"Cloud / Software Engineer",website:"",startDate:"2020-02-01",endDate:"2020-07-01",summary:"Design and implement scalable data pipelines on AWS and GCP that can handle billions of events.",highlights:["Played a key role in migration of data pipelines from AWS to GCP.","Built and scaled data pipelines to handle billions of events."]},{company:"Javra Software",position:"R&D Engineer",website:"",startDate:"2018-03-01",endDate:"2020-01-01",summary:"Build and scaled AI/ML products for a leading agritech company, owning the full lifecycle from training and deploying models on GPUs to orchestration and integration into production.",highlights:[]},{company:"Javra Software",position:"R&D Engineer",website:"",startDate:"2016-02-01",endDate:"2018-02-01",summary:"Built AI/ML and computer vision prototypes adopted in pilot projects. Built IoT and LoRa-based data collection systems for real-time monitoring and analytics. Created interactive data visualizations to support analysis and decision-making.",highlights:[]},{company:"Real Time Solutions Pvt. Ltd",position:"Firmware Intern",website:"",startDate:"2014-11-01",endDate:"2015-02-01",summary:"Worked on embedded firmware development and low-level protocols for microcontrollers.",highlights:["Developed ZigBee stack support for NXP microcontrollers and USB implementation on EFM32 MCUs.","Implemented RTOS functionalities for real-time embedded devices."]},{company:"Robotics Club, Kathmandu Engineering College",position:"President & Project Coordinator",website:"",startDate:"2013-10-01",endDate:"2015-12-01",summary:"Led club activities, managed and mentored members, and guided all technical projects from conception to completion.",highlights:["Delivered multiple robotics and automation projects including virtual telepresence robots, self-balancing and line-following robots, RC robots, and SCADA systems.","Developed standardized control APIs enabling seamless Bluetooth control across multiple clients.","Mentored members to complete projects successfully, improving both technical skills and club productivity."]}],cI=[{institution:"Kathmandu Engineering College",area:"Electronics and Communications Engineering",studyType:"Bachelor of Engineering",startDate:"2011-01-01",endDate:"2015-01-01",gpa:"",courses:[]}],hI={travel:{countriesVisited:["Austria","Belgium","Bosnia and Herz.","China","Croatia","Czechia","France","Germany","Hungary","India","Italy","Nepal","Netherlands","Qatar","Slovakia","Switzerland","Thailand","United Arab Emirates"]}},dI=[{title:"Running Nepal",description:"A comprehensive platform for the running community in Nepal, connecting runners, organizing events, and tracking achievements across the country.",url:"https://runningnepal.com/",image:"/images/projects/running-nepal-2.png",tags:["Community","Sports","Web Platform"]},{title:"Mercury",description:"Transform your GPX route files into stunning 3D terrain visualizations ready for 3D printing. Bring your running, hiking, and cycling adventures to life with beautiful bird's-eye views of the terrain you've traversed.",url:"https://mercury.runningnepal.com/",github:"https://github.com/rpidanny/mercury",image:"/images/projects/mercury.png",tags:["3D Printing","Sports","Adventure","Visualization"]},{title:"Darwin",description:"An elegant CLI wizard enhancing biotech research efficiency. Streamline your research with powerful tools for searching papers, downloading datasets, and natural language interactions.",url:"https://github.com/rpidanny/darwin",github:"https://github.com/rpidanny/darwin",image:"/images/projects/darwin.png",tags:["CLI","Biotech","Research","LLM","Agents"]}],fI={basics:sI,certifications:uI,work:lI,education:cI,interests:hI,projects:dI},pI=({quote:n})=>{const{quote:e,author:t}=n;return ne.jsx("footer",{className:"footer",children:ne.jsxs("div",{className:"quotes",children:[ne.jsx("div",{className:"quote-body",children:ne.jsxs("blockquote",{children:[" ",e," "]})}),ne.jsxs("div",{className:"quote-by",children:[" - ",t," "]})]})})};var sy={exports:{}};var O2;function mI(){return O2||(O2=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var o="",a=0;a<arguments.length;a++){var s=arguments[a];s&&(o=i(o,r(s)))}return o}function r(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var s in o)e.call(o,s)&&o[s]&&(a=i(a,s));return a}function i(o,a){return a?o?o+" "+a:o+a:o}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(sy)),sy.exports}var gI=mI();const ii=tu(gI);function iC(){var n=this.constructor.getDerivedStateFromProps(this.props,this.state);n!=null&&this.setState(n)}function oC(n){function e(t){var r=this.constructor.getDerivedStateFromProps(n,t);return r??null}this.setState(e.bind(this))}function aC(n,e){try{var t=this.props,r=this.state;this.props=n,this.state=e,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(t,r)}finally{this.props=t,this.state=r}}iC.__suppressDeprecationWarning=!0;oC.__suppressDeprecationWarning=!0;aC.__suppressDeprecationWarning=!0;function vI(n){var e=n.prototype;if(!e||!e.isReactComponent)throw new Error("Can only polyfill class components");if(typeof n.getDerivedStateFromProps!="function"&&typeof e.getSnapshotBeforeUpdate!="function")return n;var t=null,r=null,i=null;if(typeof e.componentWillMount=="function"?t="componentWillMount":typeof e.UNSAFE_componentWillMount=="function"&&(t="UNSAFE_componentWillMount"),typeof e.componentWillReceiveProps=="function"?r="componentWillReceiveProps":typeof e.UNSAFE_componentWillReceiveProps=="function"&&(r="UNSAFE_componentWillReceiveProps"),typeof e.componentWillUpdate=="function"?i="componentWillUpdate":typeof e.UNSAFE_componentWillUpdate=="function"&&(i="UNSAFE_componentWillUpdate"),t!==null||r!==null||i!==null){var o=n.displayName||n.name,a=typeof n.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+o+" uses "+a+" but also contains the following legacy lifecycles:"+(t!==null?`
  `+t:"")+(r!==null?`
  `+r:"")+(i!==null?`
  `+i:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof n.getDerivedStateFromProps=="function"&&(e.componentWillMount=iC,e.componentWillReceiveProps=oC),typeof e.getSnapshotBeforeUpdate=="function"){if(typeof e.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");e.componentWillUpdate=aC;var s=e.componentDidUpdate;e.componentDidUpdate=function(l,c,h){var f=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:h;s.call(this,l,c,f)}}return n}const yI=Object.freeze(Object.defineProperty({__proto__:null,polyfill:vI},Symbol.toStringTag,{value:"Module"})),bI=["xxl","xl","lg","md","sm","xs"],wI="xs",Xm=Ze.createContext({prefixes:{},breakpoints:bI,minBreakpoint:wI}),{Consumer:pJ,Provider:mJ}=Xm;function Wi(n,e){const{prefixes:t}=Ze.useContext(Xm);return n||t[e]||e}function _I(){const{breakpoints:n}=Ze.useContext(Xm);return n}function xI(){const{minBreakpoint:n}=Ze.useContext(Xm);return n}var uy={exports:{}},ly,L2;function SI(){if(L2)return ly;L2=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ly=n,ly}var cy,B2;function EI(){if(B2)return cy;B2=1;var n=SI();function e(){}function t(){}return t.resetWarningCache=e,cy=function(){function r(a,s,u,l,c,h){if(h!==n){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}r.isRequired=r;function i(){return r}var o={array:r,bigint:r,bool:r,func:r,number:r,object:r,string:r,symbol:r,any:r,arrayOf:i,element:r,elementType:r,instanceOf:i,node:r,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return o.PropTypes=o,o},cy}var U2;function Ym(){return U2||(U2=1,uy.exports=EI()()),uy.exports}var kI=Ym();const mc=tu(kI),CI=["as","disabled"];function TI(n,e){if(n==null)return{};var t={};for(var r in n)if({}.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function MI(n){return!n||n.trim()==="#"}function sC({tagName:n,disabled:e,href:t,target:r,rel:i,role:o,onClick:a,tabIndex:s=0,type:u}){n||(t!=null||r!=null||i!=null?n="a":n="button");const l={tagName:n};if(n==="button")return[{type:u||"button",disabled:e},l];const c=f=>{if((e||n==="a"&&MI(t))&&f.preventDefault(),e){f.stopPropagation();return}a?.(f)},h=f=>{f.key===" "&&(f.preventDefault(),c(f))};return n==="a"&&(t||(t="#"),e&&(t=void 0)),[{role:o??"button",disabled:void 0,tabIndex:e?void 0:s,href:t,target:n==="a"?r:void 0,"aria-disabled":e||void 0,rel:n==="a"?i:void 0,onClick:c,onKeyDown:h},l]}const RI=Ze.forwardRef((n,e)=>{let{as:t,disabled:r}=n,i=TI(n,CI);const[o,{tagName:a}]=sC(Object.assign({tagName:t,disabled:r},i));return ne.jsx(a,Object.assign({},i,o,{ref:e}))});RI.displayName="Button";const uC=Ze.forwardRef(({as:n,bsPrefix:e,variant:t="primary",size:r,active:i=!1,disabled:o=!1,className:a,...s},u)=>{const l=Wi(e,"btn"),[c,{tagName:h}]=sC({tagName:n,disabled:o,...s}),f=h;return ne.jsx(f,{...c,...s,ref:u,disabled:o,className:ii(a,l,i&&"active",t&&`${l}-${t}`,r&&`${l}-${r}`,s.href&&o&&"disabled")})});uC.displayName="Button";function AI(n,e){return Ze.Children.toArray(n).some(t=>Ze.isValidElement(t)&&t.type===e)}function II({as:n,bsPrefix:e,className:t,...r}){e=Wi(e,"col");const i=_I(),o=xI(),a=[],s=[];return i.forEach(u=>{const l=r[u];delete r[u];let c,h,f;typeof l=="object"&&l!=null?{span:c,offset:h,order:f}=l:c=l;const m=u!==o?`-${u}`:"";c&&a.push(c===!0?`${e}${m}`:`${e}${m}-${c}`),f!=null&&s.push(`order${m}-${f}`),h!=null&&s.push(`offset${m}-${h}`)}),[{...r,className:ii(t,...a,...s)},{as:n,bsPrefix:e,spans:a}]}const lC=Ze.forwardRef((n,e)=>{const[{className:t,...r},{as:i="div",bsPrefix:o,spans:a}]=II(n);return ne.jsx(i,{...r,ref:e,className:ii(t,!a.length&&o)})});lC.displayName="Col";var hy,z2;function cC(){if(z2)return hy;z2=1;var n=function(){};return hy=n,hy}cC();const DI={type:mc.string,tooltip:mc.bool,as:mc.elementType},Km=Ze.forwardRef(({as:n="div",className:e,type:t="valid",tooltip:r=!1,...i},o)=>ne.jsx(n,{...i,ref:o,className:ii(e,`${t}-${r?"tooltip":"feedback"}`)}));Km.displayName="Feedback";Km.propTypes=DI;const ja=Ze.createContext({}),fw=Ze.forwardRef(({id:n,bsPrefix:e,className:t,type:r="checkbox",isValid:i=!1,isInvalid:o=!1,as:a="input",...s},u)=>{const{controlId:l}=Ze.useContext(ja);return e=Wi(e,"form-check-input"),ne.jsx(a,{...s,ref:u,type:r,id:n||l,className:ii(t,e,i&&"is-valid",o&&"is-invalid")})});fw.displayName="FormCheckInput";const nm=Ze.forwardRef(({bsPrefix:n,className:e,htmlFor:t,...r},i)=>{const{controlId:o}=Ze.useContext(ja);return n=Wi(n,"form-check-label"),ne.jsx("label",{...r,ref:i,htmlFor:t||o,className:ii(e,n)})});nm.displayName="FormCheckLabel";const hC=Ze.forwardRef(({id:n,bsPrefix:e,bsSwitchPrefix:t,inline:r=!1,reverse:i=!1,disabled:o=!1,isValid:a=!1,isInvalid:s=!1,feedbackTooltip:u=!1,feedback:l,feedbackType:c,className:h,style:f,title:m="",type:g="checkbox",label:w,children:v,as:y="input",...x},E)=>{e=Wi(e,"form-check"),t=Wi(t,"form-switch");const{controlId:_}=Ze.useContext(ja),k=Ze.useMemo(()=>({controlId:n||_}),[_,n]),C=!v&&w!=null&&w!==!1||AI(v,nm),A=ne.jsx(fw,{...x,type:g==="switch"?"checkbox":g,ref:E,isValid:a,isInvalid:s,disabled:o,as:y});return ne.jsx(ja.Provider,{value:k,children:ne.jsx("div",{style:f,className:ii(h,C&&e,r&&`${e}-inline`,i&&`${e}-reverse`,g==="switch"&&t),children:v||ne.jsxs(ne.Fragment,{children:[A,C&&ne.jsx(nm,{title:m,children:w}),l&&ne.jsx(Km,{type:c,tooltip:u,children:l})]})})})});hC.displayName="FormCheck";const rm=Object.assign(hC,{Input:fw,Label:nm}),dC=Ze.forwardRef(({bsPrefix:n,type:e,size:t,htmlSize:r,id:i,className:o,isValid:a=!1,isInvalid:s=!1,plaintext:u,readOnly:l,as:c="input",...h},f)=>{const{controlId:m}=Ze.useContext(ja);return n=Wi(n,"form-control"),ne.jsx(c,{...h,type:e,size:r,ref:f,readOnly:l,id:i||m,className:ii(o,u?`${n}-plaintext`:n,t&&`${n}-${t}`,e==="color"&&`${n}-color`,a&&"is-valid",s&&"is-invalid")})});dC.displayName="FormControl";const NI=Object.assign(dC,{Feedback:Km}),fC=Ze.forwardRef(({className:n,bsPrefix:e,as:t="div",...r},i)=>(e=Wi(e,"form-floating"),ne.jsx(t,{ref:i,className:ii(n,e),...r})));fC.displayName="FormFloating";const pw=Ze.forwardRef(({controlId:n,as:e="div",...t},r)=>{const i=Ze.useMemo(()=>({controlId:n}),[n]);return ne.jsx(ja.Provider,{value:i,children:ne.jsx(e,{...t,ref:r})})});pw.displayName="FormGroup";const pC=Ze.forwardRef(({as:n="label",bsPrefix:e,column:t=!1,visuallyHidden:r=!1,className:i,htmlFor:o,...a},s)=>{const{controlId:u}=Ze.useContext(ja);e=Wi(e,"form-label");let l="col-form-label";typeof t=="string"&&(l=`${l} ${l}-${t}`);const c=ii(i,e,r&&"visually-hidden",t&&l);return o=o||u,t?ne.jsx(lC,{ref:s,as:"label",className:c,htmlFor:o,...a}):ne.jsx(n,{ref:s,className:c,htmlFor:o,...a})});pC.displayName="FormLabel";const mC=Ze.forwardRef(({bsPrefix:n,className:e,id:t,...r},i)=>{const{controlId:o}=Ze.useContext(ja);return n=Wi(n,"form-range"),ne.jsx("input",{...r,type:"range",ref:i,className:ii(e,n),id:t||o})});mC.displayName="FormRange";const gC=Ze.forwardRef(({bsPrefix:n,size:e,htmlSize:t,className:r,isValid:i=!1,isInvalid:o=!1,id:a,...s},u)=>{const{controlId:l}=Ze.useContext(ja);return n=Wi(n,"form-select"),ne.jsx("select",{...s,size:t,ref:u,className:ii(r,n,e&&`${n}-${e}`,i&&"is-valid",o&&"is-invalid"),id:a||l})});gC.displayName="FormSelect";const vC=Ze.forwardRef(({bsPrefix:n,className:e,as:t="small",muted:r,...i},o)=>(n=Wi(n,"form-text"),ne.jsx(t,{...i,ref:o,className:ii(e,n,r&&"text-muted")})));vC.displayName="FormText";const yC=Ze.forwardRef((n,e)=>ne.jsx(rm,{...n,ref:e,type:"switch"}));yC.displayName="Switch";const PI=Object.assign(yC,{Input:rm.Input,Label:rm.Label}),bC=Ze.forwardRef(({bsPrefix:n,className:e,children:t,controlId:r,label:i,...o},a)=>(n=Wi(n,"form-floating"),ne.jsxs(pw,{ref:a,className:ii(e,n),controlId:r,...o,children:[t,ne.jsx("label",{htmlFor:r,children:i})]})));bC.displayName="FloatingLabel";const FI={_ref:mc.any,validated:mc.bool,as:mc.elementType},mw=Ze.forwardRef(({className:n,validated:e,as:t="form",...r},i)=>ne.jsx(t,{...r,ref:i,className:ii(n,e&&"was-validated")}));mw.displayName="Form";mw.propTypes=FI;const wo=Object.assign(mw,{Group:pw,Control:NI,Floating:fC,Check:rm,Switch:PI,Label:pC,Text:vC,Range:mC,Select:gC,FloatingLabel:bC});var Vf={exports:{}},jf={exports:{}},W2;function hd(){return W2||(W2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(r){if(r==null)throw new TypeError("Expected a string but received a ".concat(r));if(r.constructor.name!=="String")throw new TypeError("Expected a string but received a ".concat(r.constructor.name))}n.exports=e.default,n.exports.default=e.default})(jf,jf.exports)),jf.exports}var qf={exports:{}},H2;function OI(){return H2||(H2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;function t(i){return Object.prototype.toString.call(i)==="[object RegExp]"}function r(i,o){for(var a=0;a<o.length;a++){var s=o[a];if(i===s||t(s)&&s.test(i))return!0}return!1}n.exports=e.default,n.exports.default=e.default})(qf,qf.exports)),qf.exports}var $f={exports:{}},G2;function LI(){return G2||(G2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=r(hd());function r(a){return a&&a.__esModule?a:{default:a}}function i(a){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},i(a)}function o(a,s){(0,t.default)(a);var u,l;i(s)==="object"?(u=s.min||0,l=s.max):(u=arguments[1],l=arguments[2]);var c=encodeURI(a).split(/%..|./).length-1;return c>=u&&(typeof l>"u"||c<=l)}n.exports=e.default,n.exports.default=e.default})($f,$f.exports)),$f.exports}var Xf={exports:{}},Yf={exports:{}},V2;function gw(){return V2||(V2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;for(var o in i)typeof r[o]>"u"&&(r[o]=i[o]);return r}n.exports=e.default,n.exports.default=e.default})(Yf,Yf.exports)),Yf.exports}var j2;function BI(){return j2||(j2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=i(hd()),r=i(gw());function i(s){return s&&s.__esModule?s:{default:s}}var o={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};function a(s,u){(0,t.default)(s),u=(0,r.default)(u,o),u.allow_trailing_dot&&s[s.length-1]==="."&&(s=s.substring(0,s.length-1)),u.allow_wildcard===!0&&s.indexOf("*.")===0&&(s=s.substring(2));var l=s.split("."),c=l[l.length-1];return u.require_tld&&(l.length<2||!u.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(c)||/\s/.test(c))||!u.allow_numeric_tld&&/^\d+$/.test(c)?!1:l.every(function(h){return!(h.length>63&&!u.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(h)||/[\uff01-\uff5e]/.test(h)||/^-|-$/.test(h)||!u.allow_underscores&&/_/.test(h))})}n.exports=e.default,n.exports.default=e.default})(Xf,Xf.exports)),Xf.exports}var Kf={exports:{}},q2;function UI(){return q2||(q2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=r(hd());function r(h){return h&&h.__esModule?h:{default:h}}function i(h){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},i(h)}var o="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",a="(".concat(o,"[.]){3}").concat(o),s=new RegExp("^".concat(a,"$")),u="(?:[0-9a-fA-F]{1,4})",l=new RegExp("^("+"(?:".concat(u,":){7}(?:").concat(u,"|:)|")+"(?:".concat(u,":){6}(?:").concat(a,"|:").concat(u,"|:)|")+"(?:".concat(u,":){5}(?::").concat(a,"|(:").concat(u,"){1,2}|:)|")+"(?:".concat(u,":){4}(?:(:").concat(u,"){0,1}:").concat(a,"|(:").concat(u,"){1,3}|:)|")+"(?:".concat(u,":){3}(?:(:").concat(u,"){0,2}:").concat(a,"|(:").concat(u,"){1,4}|:)|")+"(?:".concat(u,":){2}(?:(:").concat(u,"){0,3}:").concat(a,"|(:").concat(u,"){1,5}|:)|")+"(?:".concat(u,":){1}(?:(:").concat(u,"){0,4}:").concat(a,"|(:").concat(u,"){1,6}|:)|")+"(?::((?::".concat(u,"){0,5}:").concat(a,"|(?::").concat(u,"){1,7}|:))")+")(%[0-9a-zA-Z.]{1,})?$");function c(h){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,t.default)(h);var m=(i(f)==="object"?f.version:arguments[1])||"";return m?m.toString()==="4"?s.test(h):m.toString()==="6"?l.test(h):!1:c(h,{version:4})||c(h,{version:6})}n.exports=e.default,n.exports.default=e.default})(Kf,Kf.exports)),Kf.exports}var $2;function zI(){return $2||($2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=x;var t=u(hd()),r=u(OI()),i=u(LI()),o=u(BI()),a=u(UI()),s=u(gw());function u(E){return E&&E.__esModule?E:{default:E}}var l={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},c=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,h=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,f=/^[a-z\d]+$/,m=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,g=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,w=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,v=254;function y(E){var _=E.replace(/^"(.+)"$/,"$1");if(!_.trim())return!1;var k=/[\.";<>]/.test(_);if(k){if(_===E)return!1;var C=_.split('"').length===_.split('\\"').length;if(!C)return!1}return!0}function x(E,_){if((0,t.default)(E),_=(0,s.default)(_,l),_.require_display_name||_.allow_display_name){var k=E.match(c);if(k){var C=k[1];if(E=E.replace(C,"").replace(/(^<|>$)/g,""),C.endsWith(" ")&&(C=C.slice(0,-1)),!y(C))return!1}else if(_.require_display_name)return!1}if(!_.ignore_max_length&&E.length>v)return!1;var A=E.split("@"),I=A.pop(),T=I.toLowerCase();if(_.host_blacklist.length>0&&(0,r.default)(T,_.host_blacklist)||_.host_whitelist.length>0&&!(0,r.default)(T,_.host_whitelist))return!1;var R=A.join("@");if(_.domain_specific_validation&&(T==="gmail.com"||T==="googlemail.com")){R=R.toLowerCase();var N=R.split("+")[0];if(!(0,i.default)(N.replace(/\./g,""),{min:6,max:30}))return!1;for(var O=N.split("."),V=0;V<O.length;V++)if(!f.test(O[V]))return!1}if(_.ignore_max_length===!1&&(!(0,i.default)(R,{max:64})||!(0,i.default)(I,{max:254})))return!1;if(!(0,o.default)(I,{require_tld:_.require_tld,ignore_max_length:_.ignore_max_length,allow_underscores:_.allow_underscores})){if(!_.allow_ip_domain)return!1;if(!(0,a.default)(I)){if(!I.startsWith("[")||!I.endsWith("]"))return!1;var F=I.slice(1,-1);if(F.length===0||!(0,a.default)(F))return!1}}if(_.blacklisted_chars&&R.search(new RegExp("[".concat(_.blacklisted_chars,"]+"),"g"))!==-1)return!1;if(R[0]==='"'&&R[R.length-1]==='"')return R=R.slice(1,R.length-1),_.allow_utf8_local_part?w.test(R):m.test(R);for(var B=_.allow_utf8_local_part?g:h,U=R.split("."),P=0;P<U.length;P++)if(!B.test(U[P]))return!1;return!0}n.exports=e.default,n.exports.default=e.default})(Vf,Vf.exports)),Vf.exports}var WI=zI();const X2=tu(WI);var Jf={exports:{}},Y2;function HI(){return Y2||(Y2=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=i(hd()),r=i(gw());function i(s){return s&&s.__esModule?s:{default:s}}var o={ignore_whitespace:!1};function a(s,u){return(0,t.default)(s),u=(0,r.default)(u,o),(u.ignore_whitespace?s.trim().length:s.length)===0}n.exports=e.default,n.exports.default=e.default})(Jf,Jf.exports)),Jf.exports}var GI=HI();const Qf=tu(GI),VI=({email:n})=>{const[e,t]=Ze.useState({name:"",email:"",message:""}),[r,i]=Ze.useState({name:null,email:null,message:null}),[o,a]=Ze.useState(!1),s=c=>{const{name:h,value:f}=c.target;t(g=>({...g,[h]:f}));let m=null;switch(h){case"name":m=Qf(f)?"error":"success",i(g=>({...g,name:m}));break;case"email":m=X2(f)?"success":"error",i(g=>({...g,email:m}));break;case"message":m=Qf(f)?"error":"success",i(g=>({...g,message:m}));break}},u=()=>{const{name:c,email:h,message:f}=r;return c==="success"&&h==="success"&&f==="success"},l=()=>{if(u()){const{name:c,email:h,message:f}=e,m={from:h,to:n,subject:`Msg from: ${c}`,text:`Name: ${c}

Email: ${h}

Message: ${f}`};a(!0),fetch("https://dqf5ayzbgf.execute-api.eu-west-1.amazonaws.com/mabhishek/",{method:"POST",body:JSON.stringify(m),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(g=>{if(g.status===200)g.json().then(w=>{a(!1),t({name:"",email:"",message:""}),i({name:null,email:null,message:null}),window.alert("Message Sent!"),console.log(w)});else throw console.log(g),new Error("Email send failed.")}).catch(()=>{window.alert("Failed to send message. Please try sending me an email instead."),a(!1)})}else{const{name:c,email:h,message:f}=e;i({name:Qf(c)?"error":"success",email:X2(h)?"success":"error",message:Qf(f)?"error":"success"})}};return ne.jsx(Do.Fragment,{children:ne.jsxs("section",{className:"contact-section",id:"contact",children:[ne.jsx("div",{className:"contact-header",children:ne.jsxs("div",{className:"header-content",children:[ne.jsx("div",{className:"subtitle",children:"Say Hello"}),ne.jsx("h2",{children:"Contact"})]})}),ne.jsx("div",{className:"contact-container",children:ne.jsxs("div",{className:"content",children:[ne.jsxs("div",{className:"inner-title",children:[ne.jsx("h3",{children:"get in touch with me"}),ne.jsx("p",{children:"Let me now if you're interested in working with me."})]}),ne.jsx("div",{className:"inner-content ",children:ne.jsx("div",{className:"address",children:ne.jsxs(wo,{children:[ne.jsxs(wo.Group,{controlId:"formHorizontalname",children:[ne.jsx(wo.Label,{children:"Name"}),ne.jsx(wo.Control,{type:"text",placeholder:"Your Name",name:"name",value:e.name,onChange:s,isValid:r.name==="success",isInvalid:r.name==="error"})]}),ne.jsxs(wo.Group,{controlId:"formHorizontalEmail",children:[ne.jsx(wo.Label,{children:"Email"}),ne.jsx(wo.Control,{type:"email",placeholder:"Email",name:"email",value:e.email,onChange:s,isValid:r.email==="success",isInvalid:r.email==="error"})]}),ne.jsxs(wo.Group,{controlId:"formHorizontalMessage",children:[ne.jsx(wo.Label,{children:"Message"}),ne.jsx(wo.Control,{as:"textarea",rows:4,placeholder:"Message",name:"message",value:e.message,onChange:s,isValid:r.message==="success",isInvalid:r.message==="error"})]}),ne.jsx(wo.Group,{className:"mt-3",children:ne.jsx(uC,{className:"btnSend",disabled:o,onClick:o?void 0:l,children:o?"Sending email....":"Send"})})]})})})]})})]})})};var Ub=function(n,e){return Ub=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])},Ub(n,e)};function Yt(n,e){Ub(n,e);function t(){this.constructor=n}n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var No=function(){return No=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},No.apply(this,arguments)};function It(n,e,t,r){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(c){try{l(r.next(c))}catch(h){a(h)}}function u(c){try{l(r.throw(c))}catch(h){a(h)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((r=r.apply(n,[])).next())})}function Dt(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(c){l=[6,c],i=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function dy(){for(var n=0,e=0,t=arguments.length;e<t;e++)n+=arguments[e].length;for(var r=Array(n),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var wC=function(n,e){return(wC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Xa(n,e){function t(){this.constructor=n}wC(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Gt(n,e,t,r){return new(t||(t=Promise))(function(i,o){function a(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(a,s)}u((r=r.apply(n,[])).next())})}function Vt(n,e){var t,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return(function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([u,l])}}}var jI=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t=qI(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach(function(r){var i=r.split(":"),o=i[0],a=i[1];e.urlFlags[o]=(function(s,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error("Could not parse value flag value "+u+" for flag "+s+".")})(o,a)})}},n})();function qI(n){var e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];return(function(o,a,s){o[decodeURIComponent(a)]=decodeURIComponent(s||"")})(e,r[0],r[1]),r.join("=")}),e}var be=null;function $I(n){be=n}function zb(n,e,t){return Math.max(n,Math.min(e,t))}function _C(n){return n%2==0?n:n+1}function XI(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function ee(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Rn(n,e,t){t===void 0&&(t=""),ee(Gr(n,e),function(){return t+" Shapes "+n+" and "+e+" must match"})}function $c(n){ee(n!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Dc(n,e){if(e===void 0&&(e=[]),e==null&&(e=[]),Array.isArray(n)||Ha(n))for(var t=0;t<n.length;++t)Dc(n[t],e);else e.push(n);return e}function Pt(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function Gr(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function oo(n){return n%1==0}function YI(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function Wb(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function gc(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function K2(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise(function(r,i){var o=0,a=function(){if(n())r();else{var s=e(++o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function KI(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function Mr(n,e){var t=e.length;return ee((n=n==null?e.map(function(r,i){return i}):[].concat(n)).every(function(r){return r>=-t&&r<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n}),ee(n.every(function(r){return oo(r)}),function(){return"All values in axis param must be integers but got axis "+n}),n.map(function(r){return r<0?t+r:r})}function Bu(n,e){for(var t=[],r=[],i=e==null?null:Mr(e,n).sort(),o=0,a=0;a<n.length;++a){if(i!=null){if(i[o]===a&&n[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+n[a]+"' is not 1");(i[o]==null||i[o]>a)&&n[a]===1&&(t.push(n[a]),r.push(a)),i[o]<=a&&o++}n[a]!==1&&(t.push(n[a]),r.push(a))}return{newShape:t,keptDims:r}}function Hb(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function im(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function JI(n,e,t){if(e==="float32")for(var r=0;r<n.length;r++){var i=n[r];if(isNaN(i)||!isFinite(i))throw Error("The result of the '"+t+"' is "+i+".")}}function QI(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function ZI(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function eD(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function Ha(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function xC(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function tD(n){if(n==null)return 0;var e=0;return n.forEach(function(t){return e+=2*t.length}),e}function SC(n){return typeof n=="string"||n instanceof String}function nD(n){return typeof n=="boolean"}function rD(n){return typeof n=="number"}function dd(n){return Array.isArray(n)?dd(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":rD(n)?"float32":SC(n)?"string":nD(n)?"bool":"float32"}function Gb(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Vb(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function nl(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function EC(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Dc(n)),t&&QI(n,e),(function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function J2(n,e){if(n.length===0)return e[0];var t=n.reduce(function(r,i){return r*i});if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(f,m){return f*m});for(l=0;l<u;l++)s[l]=r(i+l*h,c,a)}return s})(0,n,e)}function kC(n,e){for(var t=fd(n,e),r=0;r<t.length;r++)t[r]=1;return t}function fd(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function om(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var n=process.hrtime();return 1e3*n[0]+n[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function CC(n){n.forEach(function(e){ee(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."})})}function TC(n,e){return be.platform.fetch(n,e)}var iD=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new oD)}return n.prototype.profileKernel=function(e,t){var r,i=this,o=this.backendTimer.time(function(){r=t()});return(Array.isArray(r)?r:[r]).forEach(function(a){var s=a.dataSync();JI(s,a.dtype,e),o.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),i.logger.logKernelProfile(e,a,s,u.kernelMs,l)})}),r},n})(),oD=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o){var a=gc(i+"ms",9),s=gc(e,25),u=t.rank,l=t.size,c=gc(t.shape.toString(),14);console.log("%c"+s+"	%c"+a+"	%c"+u+"D "+c+"	%c"+l+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},n})(),Q2=20,Dh=3,fy=7;function aD(n,e,t,r){var i=nl(e),o=(function(l,c,h,f){var m=Pt(c),g=f[f.length-1],w=new Array(g).fill(0),v=c.length,y=h==="complex64"?Ph(l):l;if(v>1)for(var x=0;x<m/g;x++)for(var E=x*g,_=0;_<g;_++)w[_]=Math.max(w[_],Nh(y[E+_],0,h).length);return w})(n,e,t,i),a=e.length,s=(function l(c,h,f,m,g,w){w===void 0&&(w=!0);var v=f==="complex64"?2:1,y=h[0],x=h.length;if(x===0){if(f==="complex64"){var E=Ph(c);return[Nh(E[0],0,f)]}return f==="bool"?[MC(c[0])]:[c[0].toString()]}if(x===1){if(y>Q2){var _=Dh*v,k=Array.from(c.slice(0,_)),C=Array.from(c.slice(y-Dh*v,y));return f==="complex64"&&(k=Ph(k),C=Ph(C)),["["+k.map(function(P,L){return Nh(P,g[L],f)}).join(", ")+", ..., "+C.map(function(P,L){return Nh(P,g[y-Dh+L],f)}).join(", ")+"]"]}var A=f==="complex64"?Ph(c):Array.from(c);return["["+A.map(function(P,L){return Nh(P,g[L],f)}).join(", ")+"]"]}var I=h.slice(1),T=m.slice(1),R=m[0]*v,N=[];if(y>Q2){for(var O=0;O<Dh;O++){var V=O*R,F=V+R;N.push.apply(N,l(c.slice(V,F),I,f,T,g,!1))}N.push("...");for(var O=y-Dh;O<y;O++){var V=O*R,F=V+R;N.push.apply(N,l(c.slice(V,F),I,f,T,g,O===y-1))}}else for(var O=0;O<y;O++){var V=O*R,F=V+R;N.push.apply(N,l(c.slice(V,F),I,f,T,g,O===y-1))}var B=x===2?",":"";N[0]="["+N[0]+B;for(var O=1;O<N.length-1;O++)N[O]=" "+N[O]+B;for(var U=`,
`,O=2;O<x;O++)U+=`
`;return N[N.length-1]=" "+N[N.length-1]+"]"+(w?"":U),N})(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Nh(n,e,t){return gc(Array.isArray(n)?parseFloat(n[0].toFixed(fy))+" + "+parseFloat(n[1].toFixed(fy))+"j":SC(n)?"'"+n+"'":t==="bool"?MC(n):parseFloat(n.toFixed(fy)).toString(),e)}function MC(n){return n===0?"false":"true"}function Ph(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var Jh=(function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=Pt(e),r!=null){var o=r.length;ee(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||im(t,this.size),this.strides=nl(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),ee(r.length===this.rank,function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return at.make(this.shape,{values:this.values},this.dtype)},n})(),Di=null,Me=null,RC=null,at=(function(){function n(e,t,r,i,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Pt(e),this.strides=nl(e),this.dataId=i??{},this.id=Di().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Di().registerTensor(this,o),r!=null&&Di().write(o,this.dataId,r)}return n.make=function(e,t,r,i){return new n(e,r,t.values,t.dataId,i)},n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),ee(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),Me.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return Gt(this,void 0,void 0,function(){var e;return Vt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Me.buffer(this.shape,this.dtype,e)]}})})},n.prototype.bufferSync=function(){return Me.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return Gt(this,void 0,void 0,function(){var e;return Vt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,J2(this.shape,e)]}})})},n.prototype.arraySync=function(){return J2(this.shape,this.dataSync())},n.prototype.data=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(e){return this.throwIfDisposed(),[2,Di().read(this.dataId)]})})},n.prototype.dataSync=function(){return this.throwIfDisposed(),Di().readSync(this.dataId)},n.prototype.dispose=function(){this.isDisposed||(Di().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),Me.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Me.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),Me.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),Me.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Me.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Me.clone(this)},n.prototype.oneHot=function(e,t,r){return this.throwIfDisposed(),Me.oneHot(this,e,t,r)},n.prototype.toString=function(e){return e===void 0&&(e=!1),aD(this.dataSync(),this.shape,this.dtype,e)},n.prototype.tile=function(e){return this.throwIfDisposed(),Me.tile(this,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Me.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Me.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Me.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),Me.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Me.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Me.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Me.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Me.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),Me.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),Me.unstack(this,e)},n.prototype.pad=function(e,t){return t===void 0&&(t=0),Me.pad(this,e,t)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),RC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.batchNorm=function(e,t,r,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),Me.batchNorm(this,e,t,r,i,o)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Me.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Me.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Me.cast(this,e)},n.prototype.add=function(e){return this.throwIfDisposed(),Me.add(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Me.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Me.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Me.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Me.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Me.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Me.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Me.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Me.mulStrict(this,e)},n.prototype.div=function(e){return this.throwIfDisposed(),Me.div(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Me.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Me.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Me.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Me.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Me.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Me.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Me.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Me.modStrict(this,e)},n.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Me.squaredDifference(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Me.squaredDifferenceStrict(this,e)},n.prototype.transpose=function(e){return this.throwIfDisposed(),Me.transpose(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Me.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Me.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Me.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Me.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Me.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Me.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Me.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Me.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Me.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Me.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Me.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Me.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Me.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Me.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Me.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Me.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Me.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Me.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Me.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Me.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Me.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Me.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Me.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Me.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Me.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Me.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Me.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Me.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Me.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Me.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Me.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Me.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Me.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Me.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Me.relu(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Me.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Me.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Me.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Me.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Me.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Me.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Me.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Me.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Me.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Me.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Me.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Me.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Me.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Me.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Me.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Me.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Me.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Me.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Me.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Me.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Me.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Me.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Me.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Me.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Me.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Me.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Me.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Me.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Me.conv1d(this,e,t,r,i,o,a)},n.prototype.conv2d=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Me.conv2d(this,e,t,r,i,o,a)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),Me.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Me.depthwiseConv2d(this,e,t,r,i,o,a)},n.prototype.separableConv2d=function(e,t,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),Me.separableConv2d(this,e,t,r,i,o,a)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),Me.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),Me.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),Me.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),Me.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),pd.variable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Me.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Me.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Me.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Me.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),Me.stridedSlice(this,e,t,r,i,o,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Me.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Me.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Me.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Me.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Me.spectral.irfft(this)},n})();Object.defineProperty(at,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var pd=(function(n){function e(t,r,i){r===void 0&&(r=!0);var o=n.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=r,o.name=i,o.name==null&&(o.name=Di().nextVariableId().toString());try{Di().registerVariable(o)}catch(a){throw Di().disposeTensor(o),a}return o}return Xa(e,n),e.variable=function(t,r,i,o){return r===void 0&&(r=!0),o!=null&&o!==t.dtype&&(t=t.asType(o)),new e(t,r,i)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Gr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Di().disposeTensor(this),this.dataId=t.dataId,Di().registerTensor(this)},e.prototype.dispose=function(){Di().disposeVariable(this),this.isDisposedInternal=!0},e})(at);Object.defineProperty(pd,Symbol.hasInstance,{value:function(n){return n instanceof at&&n.assign!=null&&n.assign instanceof Function}});var Z2,jb,qb,$b,Xb;pd.variable;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Z2||(Z2={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(jb||(jb={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(qb||(qb={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})($b||($b={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Xb||(Xb={}));var sD={float32:$b,int32:jb,bool:qb,complex64:Xb};function or(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return sD[n][e]}function py(n){return or(n,"int32")}function ur(n,e){if(n.dtype===e.dtype)return[n,e];var t=or(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function uD(n,e){ee(n.dtype===e.dtype,function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"})}function AC(n){var e=[];return(function t(r,i,o){if(r!=null){if(r instanceof at)return void i.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];o.has(l)||(o.add(l),t(l,i,o))}}}})(n,e,new Set),e}var my,eS=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),lD=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new eS}return n.prototype.ready=function(){return Gt(this,void 0,void 0,function(){var e,t,r;return Vt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return Gt(this,void 0,void 0,function(){var t,r,i;return Vt(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.profiler=new iD(this.backendInstance),[2,!0]}})})},n.prototype.initializeBackend=function(e){var t=this,r=ve.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority})},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,a=i.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){this.write(e,t,this.readSync(t))},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(r)},function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r})},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=at.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(r){return[r.toFloat()]}),t},n.prototype.runKernel=function(e,t,r){var i,o=this,a=[],s=this.isTapeOn(),u=this.state.activeScope!=null?this.state.activeScope.name:"",l=function(m){s&&(a=m.map(function(g){return o.keep(o.clone(g))}))},c=this.state.numBytes,h=this.state.numTensors;if(this.scopedRun(function(){return o.state.kernelDepth++},function(){return o.state.kernelDepth--},function(){i=o.ENV.getBool("DEBUG")?o.profiler.profileKernel(u,function(){return e(o.backend,l)}):e(o.backend,l)}),s){var f={id:this.state.nextTapeNodeId++,name:u,inputs:t,outputs:Array.isArray(i)?i:[i],saved:a};r!=null&&(f.gradient=function(m){return r(m,a)}),this.state.activeTape.push(f)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(m){return t[m].shape}),outputShape:Array.isArray(i)?i.map(function(m){return m.shape}):i.shape}),i},n.prototype.registerTensor=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*xC(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t??this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i,t!=null?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof pd||this.track(e)},n.prototype.registerVariable=function(e){if(this.state.registeredVariables[e.name]!=null)throw new Error("Variable with name "+e.name+" was already registered");this.state.registeredVariables[e.name]=e},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return Gt(this,void 0,void 0,function(){var t,r;return Vt(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]})})},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r){var i={};e.forEach(function(a,s){i[s]=a});var o={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:i,outputs:[t],gradient:function(a){var s=r(a),u={};return s.forEach(function(l,c){u[c]=function(){return l}}),u}};this.state.activeTape.push(o)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=AC(e),i=new Set(r.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),ee(t.length>0,function(){return"gradients() received an empty list of xs."}),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});ee(a instanceof at,function(){return"The result y returned by f() must be a tensor."});var s=(function(u,l,c){for(var h={},f={},m=0;m<l.length;m++)h[l[m].id]=!0;for(m=0;m<u.length;m++){var g=(C=u[m]).inputs;for(var w in g){for(var v=g[w],y=!1,x=0;x<l.length;x++)if(h[v.id]){C.outputs.forEach(function(R){return h[R.id]=!0}),y=!0,f[C.id]=!0;break}if(y)break}}var E={};E[c.id]=!0;var _={};for(m=u.length-1;m>=0;m--)for(g=(C=u[m]).inputs,x=0;x<C.outputs.length;x++)if(E[C.outputs[x].id]){for(var w in g)E[g[w].id]=!0,_[C.id]=!0;break}var k=[];for(m=0;m<u.length;m++){var C;if(f[(C=u[m]).id]&&_[C.id]){var A={};for(var w in C.inputs){var I=C.inputs[w];h[I.id]&&(A[w]=I)}var T=Object.assign({},C);T.inputs=A,T.outputs=C.outputs,k.push(T)}}return k})(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=kC(Pt(u),"float32"),at.make(u,{values:l})),(function(f,m,g){for(var w=function(y){var x=m[y],E=[];if(x.outputs.forEach(function(A){var I=f[A.id];if(I!=null)E.push(I);else{var T=at.make(A.shape,{values:fd(A.size,A.dtype)},A.dtype);E.push(T)}}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.name+".");var _=x.gradient(x.outputs.length===1?E[0]:E),k=function(A){if(!(A in _))throw new Error("Cannot backprop through input "+A+". Available gradients found: "+Object.keys(_)+".");var I=g(function(){return _[A]()});if(I.dtype!=="float32")throw new Error("Error in gradient for op "+x.name+". The gradient of input "+A+" must have 'float32' dtype, but has '"+I.dtype+"'");var T=x.inputs[A];if(!Gr(I.shape,T.shape))throw new Error("Error in gradient for op "+x.name+". The gradient of input '"+A+"' has shape '"+I.shape+"', which does not match the shape of the input '"+T.shape+"'");if(f[T.id]==null)f[T.id]=I;else{var R=f[T.id];f[T.id]=R.add(I),R.dispose()}};for(var C in x.inputs)k(C)},v=m.length-1;v>=0;v--)w(v)})(c,s,function(f){return o.tidy(f)});var h=t.map(function(f){return c[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var m in f.saved)f.saved[m].dispose()}),o.state.activeTape=null),{value:a,grads:h}})},n.prototype.customGrad=function(e){var t=this;return ee(Gb(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];ee(i.every(function(s){return s instanceof at}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),t.runKernel(function(s,u){return ee((r=e.apply(void 0,i.concat([u]))).value instanceof at,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),ee(Gb(r.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),r.value},a,function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];ee(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),ee(c.every(function(f){return f instanceof at}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(f,m){h[m]=function(){return f}}),h})}},n.prototype.write=function(e,t,r){var i=this.state.tensorInfo.get(t),o=i.backend;if(e=e||this.backend,i.dtype==="string"){var a=tD(r);this.state.numBytes+=a-i.bytes,i.bytes=a}e!==o&&(o.disposeData(t),i.backend=e,e.register(t,i.shape,i.dtype)),e.write(t,r)},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},n.prototype.time=function(e){return Gt(this,void 0,void 0,function(){var t,r;return Vt(this,function(i){switch(i.label){case 0:return t=om(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=om()-t,[2,r]}})})},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new eS,this.registry)this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),ve=(function(){var n=(function(){if(my==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}my=t}return my})();if(n._tfengine==null){var e=new jI(n);n._tfengine=new lD(e)}return $I(n._tfengine.ENV),Di=function(){return n._tfengine},n._tfengine})();function IC(){return typeof window<"u"||typeof WorkerGlobalScope<"u"}be.registerFlag("DEBUG",function(){return!1},function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),be.registerFlag("IS_BROWSER",function(){return IC()}),be.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),be.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),be.registerFlag("PROD",function(){return!1}),be.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return be.getBool("DEBUG")}),be.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),be.registerFlag("IS_TEST",function(){return!1});var Du={},gy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function cD(n,e){Du[n]=e}function pa(n){n in Du||(Du[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Du[t]},!1),t===1?r.getContext("webgl",gy)||r.getContext("experimental-webgl",gy):r.getContext("webgl2",gy)})(n));var e=Du[n];return e.isContextLost()?(delete Du[n],pa(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Du[n])}function Et(n,e,t){var r=t();return e&&(function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+pD(i,o))})(n),r}var hD=596e-10,dD=65504;function fD(n){return!!(be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||hD<Math.abs(n)&&Math.abs(n)<dD)}function pD(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function Zf(n,e,t){return Ya(n,e,function(){return n.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function mD(n,e,t){var r=Ya(n,e,function(){return n.createShader(n.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Et(n,e,function(){return n.shaderSource(r,t)}),Et(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function gD(n,e,t){var r=Ya(n,e,function(){return n.createShader(n.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Et(n,e,function(){return n.shaderSource(r,t)}),Et(n,e,function(){return n.compileShader(r)}),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(i,o){var a=vD.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(v,y){return gc((y+1).toString(),l)+v}),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var m=c.slice(0,s-1),g=c.slice(s-1,s),w=c.slice(s);console.log(m.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+gc(g[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var vy,yy,vD=/ERROR: [0-9]+:([0-9]+):/g;function yD(n,e){return Ya(n,e,function(){return n.createProgram()},"Unable to create WebGLProgram.")}function bD(n,e,t){if(Et(n,e,function(){return n.linkProgram(t)}),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function by(n,e,t){if(Et(n,e,function(){return n.validateProgram(t)}),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function wD(n,e,t){var r=Ya(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Et(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),Et(n,e,function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function _D(n,e,t){var r=Ya(n,e,function(){return n.createBuffer()},"Unable to create WebGLBuffer");return Et(n,e,function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)}),Et(n,e,function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)}),r}function xD(n,e){return Ya(n,e,function(){return n.createTexture()},"Unable to create WebGLTexture.")}function SD(n,e){var t=be.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function ED(n,e){return Ya(n,e,function(){return n.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function tS(n,e,t,r,i,o,a,s){var u=n.getAttribLocation(t,r);return u!==-1&&(Et(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,i)}),Et(n,e,function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,a,s)}),Et(n,e,function(){return n.enableVertexAttribArray(u)}),!0)}function kD(n,e,t,r){AD(n,r),Et(n,e,function(){return n.activeTexture(n.TEXTURE0+r)}),Et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)})}function CD(n,e,t,r){return Ya(n,e,function(){return n.getUniformLocation(t,r)},'uniform "'+r+'" not present in program.')}function TD(n,e,t){return n.getUniformLocation(e,t)}function MD(n,e,t,r,i,o){Et(n,e,function(){return kD(n,e,r,o)}),Et(n,e,function(){return n.uniform1i(i,o)})}function wy(n,e,t,r){Et(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)}),Et(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)})}function nS(n,e,t){Et(n,e,function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)}),Et(n,e,function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)})}function ep(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+RD(n,e))}function RD(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Ya(n,e,t,r){var i=Et(n,e,function(){return t()});if(i==null)throw new Error(r);return i}function AD(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function am(n,e){return e===void 0&&(e=2),Pt(n.slice(0,n.length-e))}function sm(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function _y(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[am(n)].concat(sm(n))),e}function ID(n,e){var t;e===void 0&&(e=!1);var r=be.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map(function(l,c){return c>=n.length-2?_C(n[c]):n[c]})).length===1&&(n=[2,n[0]])),n.length!==2){var i=Bu(n);n=i.newShape}var o=Pt(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=am(n),s=2,u=2;return n.length&&(s=(t=sm(n))[0],u=t[1]),Wb(o=a*(s/2)*(u/2)).map(function(l){return 2*l})}return Wb(o)}function tp(n){return n%2==0}function np(n,e){if(Gr(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||tp(t)&&tp(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&tp(n[0])&&tp(e[0])}function DD(n){if(vy==null){var e=pa(n);vy=e.getParameter(e.MAX_TEXTURE_SIZE)}return vy}function ND(n){if(yy==null){var e=pa(n);yy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,yy)}function PD(n){if(n===0)return 0;var e=pa(n);return Xu(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:Xu(e,"EXT_disjoint_timer_query")?1:0}function Xu(n,e){return n.getExtension(e)!=null}function rS(n){try{if(pa(n)!=null)return!0}catch{return!1}return!1}function FD(n){if(n===0)return!1;var e=pa(n);if(n===1){if(!Xu(e,"OES_texture_float"))return!1}else if(!Xu(e,"EXT_color_buffer_float"))return!1;return DC(e,n)}function OD(n){if(n===0)return!1;var e=pa(n);if(n===1){if(!Xu(e,"OES_texture_float")||!Xu(e,"WEBGL_color_buffer_float"))return!1}else if(!Xu(e,"EXT_color_buffer_float"))return!1;return DC(e,n)}function DC(n,e){var t=n.createFramebuffer(),r=n.createTexture();n.bindTexture(n.TEXTURE_2D,r);var i=e===2?n.RGBA32F:n.RGBA;n.texImage2D(n.TEXTURE_2D,0,i,1,1,0,n.RGBA,n.FLOAT,null),n.bindFramebuffer(n.FRAMEBUFFER,t),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,r,0);var o=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(r),n.deleteFramebuffer(t),o}function LD(n){return n===2&&pa(n).fenceSync!=null}function NC(n){be.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function At(n,e){return ve.tidy(n,e)}function yi(n){AC(n).forEach(function(e){return e.dispose()})}function BD(n){return ve.keep(n)}function Yb(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];be.getBool("IS_TEST")||console.warn.apply(console,n)}function nu(n){var e=n;if(Ha(n))return[n.length];if(!Array.isArray(n))return[];for(var t=[];Array.isArray(e)||Ha(e);)t.push(e.length),e=e[0];return Array.isArray(n)&&be.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function r(i,o,a){if(a=a||[],!Array.isArray(i)&&!Ha(i))return void ee(o.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});ee(o.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),ee(i.length===o[0],function(){return"Element arr["+a.join("][")+"] should have "+o[0]+" elements, but has "+i.length+" elements"});for(var s=o.slice(1),u=0;u<i.length;++u)r(i[u],s,a.concat(u))})(n,t,[]),t}function iS(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function J(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof at)return iS(r,n.dtype,e,t),n;var i=dd(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),iS(r,i,e,t),n==null||!Ha(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=nu(n);Ha(n)||Array.isArray(n)||(n=[n]);var s=i!=="string"?EC(n,i,be.getBool("DEBUG")):Dc(n);return at.make(a,{values:s},i)}function um(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map(function(i,o){return J(i,e+"["+o+"]",t)},r)}function PC(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function UD(n,e,t){for(var r=n.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?i.push(n[o++]):i.push(e[a++]);return i}function Lr(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map(function(o){return n[o]})]}function ao(n,e){return UD(n,e.map(function(t){return 1}),e)}function Ai(n,e,t){ee(PC(e,t),function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function ma(n,e){if(PC(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach(function(i){return t.push(i)}),t}function vw(n){return n.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ga(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function zD(n,e){var t=n[0].length;n.forEach(function(i,o){ee(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),ee(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var r=n[0];n.forEach(function(i,o){for(var a=0;a<t;a++)ee(a===e||i[a]===r[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."})})}function Nc(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function ue(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];ve.startScope(t);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ve.endScope(s),s}catch(u){throw ve.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}be.registerFlag("HAS_WEBGL",function(){return be.getNumber("WEBGL_VERSION")>0}),be.registerFlag("WEBGL_VERSION",function(){return rS(2)?2:rS(1)?1:0}),be.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return be.get("WEBGL_VERSION")===2}),be.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),be.registerFlag("WEBGL_PACK",function(){return be.getBool("HAS_WEBGL")}),be.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_CLIP",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_REDUCE",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_LAZILY_UNPACK",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_CONV_IM2COL",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return DD(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return ND(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var n=be.getNumber("WEBGL_VERSION");return n===0?0:PD(n)}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n}),be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return FD(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return OD(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return LD(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),RC=NC;var ti=ue({complex_:function(n,e){var t=J(n,"real","complex"),r=J(e,"imag","complex");return Rn(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),ve.runKernel(function(i){return i.complex(t,r)},{$real:t,$imag:r})}}),aa=ue({real_:function(n){var e=J(n,"input","real");return ve.runKernel(function(t){return t.real(e)},{$input:e})}}),zs=ue({imag_:function(n){var e=J(n,"input","imag");return ve.runKernel(function(t){return t.imag(e)},{$input:e})}});function di(n,e,t){return ru(n,e,nu(n),t)}function ru(n,e,t,r){if(r==null&&(r=dd(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Ha(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){CC(e);var i=Pt(e),o=Pt(t);ee(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==Pt(e.slice(a));ee(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return Ha(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?EC(n,r,be.getBool("DEBUG")):Dc(n),at.make(e,{values:n},r)}function dt(n,e){if((Ha(n)||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return ru(n,[],[],e)}function fi(n,e){$c(n);var t=nu(n);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ru(n,null,t,e)}function md(n,e,t){if($c(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=nu(n);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ru(n,e,r,t)}function yw(n,e,t){if($c(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=nu(n);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ru(n,e,r,t)}function ko(n,e,t){if($c(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=nu(n);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return ru(n,e,r,t)}function WD(n,e,t){if($c(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=nu(n);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return ru(n,e,r,t)}function HD(n,e,t){if($c(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=nu(n);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return ru(n,e=e||r,r,t)}function Xc(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Xc(n,"float32"),r=Wn(n,"float32");return ti(t,r)}var i=kC(Pt(n),e);return at.make(n,{values:i},e)}function Wn(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Wn(n,"float32"),r=Wn(n,"float32");return ti(t,r)}var i=fd(Pt(n),e);return at.make(n,{values:i},e)}function vc(n,e,t){return ve.runKernel(function(r){return r.fill(n,e,t)},{})}function GD(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return ve.runKernel(function(r){return r.linspace(n,e,t)},{})}function FC(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return Wn([0],r);var i=fd(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return fi(i,r)}var OC=ue({onesLike_:function(n){var e=J(n,"x","onesLike");if(e.dtype==="complex64"){var t=OC(aa(e)),r=pn(zs(e));return ti(t,r)}return ve.runKernel(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return pn(i)}}})}}),pn=ue({zerosLike_:function(n){var e=J(n,"x","zerosLike");return ve.runKernel(function(t){return t.zerosLike(e)},{$x:e},function(t,r){return{$x:function(){return pn(t)}}})}}),Vr=ue({concat_:function(n,e){e===void 0&&(e=0),ee(n.length>=1,function(){return"Pass at least one tensor to concat"});var t=um(n,"tensors","concat");e=Mr(e,t[0].shape)[0];var r=Nc(t.map(function(a){return a.shape}),e);if(Pt(r)===0)return di([],r);if((t=t.filter(function(a){return a.size>0})).length===1)return t[0];var i=t.map(function(a){return a.shape});zD(i,e);var o=t;return ve.runKernel(function(a){return a.concat(t,e)},o,function(a){var s=i.map(function(u){return u[e]});return bw(a,s,e).map(function(u){return function(){return u}})})}}),VD=ue({concat1d_:function(n){return Vr(n,0)}}),jD=ue({concat2d_:function(n,e){return Vr(n,e)}}),qD=ue({concat3d_:function(n,e){return Vr(n,e)}}),$D=ue({concat4d_:function(n,e){return Vr(n,e)}}),bw=ue({split_:function(n,e,t){t===void 0&&(t=0);var r,i=J(n,"x","split");return t=Mr(t,i.shape)[0],typeof e=="number"?(ee(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),r=new Array(e).fill(i.shape[t]/e)):(ee(i.shape[t]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),r=e),ve.runKernel(function(o){return o.split(i,r,t)},{$x:i},function(o){return{$x:function(){return Vr(o,t)}}})}});function rl(n,e){return n(e={exports:{}},e.exports),e.exports}var XD=rl(function(n){(function(e,t,r){function i(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var m=.02519603282416938*(u+=h.charCodeAt(f));m-=u=m>>>0,u=(m*=u)>>>0,u+=4294967296*(m-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,n)}),YD=rl(function(n){(function(e,t,r){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,n)}),KD=rl(function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,n)}),JD=rl(function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},(function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()})(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,n)}),QD=rl(function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,m=u.i;return u.w=h=h+1640531527|0,c=f[m+34&127],l=f[m=m+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[m]=c^l,u.i=m,c+(h^h>>>16)|0},(function(l,c){var h,f,m,g,w,v=[],y=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,y=Math.max(y,c.length)),m=0,g=-32;g<y;++g)c&&(f^=c.charCodeAt((g+32)%c.length)),g===0&&(w=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(w=w+1640531527|0,m=(h=v[127&g]^=f+w)==0?m+1:0);for(m>=128&&(v[127&(c&&c.length||0)]=-1),m=127,g=512;g>0;--g)f=v[m+34&127],h=v[m=m+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,v[m]=f^h;l.w=w,l.X=v,l.i=m})(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,n)}),ZD=rl(function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.b,f=u.c,m=u.d,g=u.a;return h=h<<25^h>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-m|0,u.d=m<<16^f>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,n)}),Nu=rl(function(n){(function(e,t){var r,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function f(y,x,E){var _=[],k=w((function I(T,R){var N,O=[],V=typeof T;if(R&&V=="object")for(N in T)try{O.push(I(T[N],R-1))}catch{}return O.length?O:V=="string"?T:T+"\0"})((x=x==1?{entropy:!0}:x||{}).entropy?[y,v(e)]:y??(function(){try{var I;return r&&(I=r.randomBytes)?I=I(o):(I=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(I)),v(I)}catch{var T=i.navigator,R=T&&T.plugins;return[+new Date,i,R,i.screen,v(e)]}})(),3),_),C=new m(_),A=function(){for(var I=C.g(a),T=u,R=0;I<l;)I=(I+R)*o,T*=o,R=C.g(1);for(;I>=c;)I/=2,T/=2,R>>>=1;return(I+R)/T};return A.int32=function(){return 0|C.g(4)},A.quick=function(){return C.g(4)/4294967296},A.double=A,w(v(C.S),e),(x.pass||E||function(I,T,R,N){return N&&(N.S&&g(N,C),I.state=function(){return g(C,{})}),R?(t[s]=I,T):I})(A,k,"global"in x?x.global:this==t,x.state)}function m(y){var x,E=y.length,_=this,k=0,C=_.i=_.j=0,A=_.S=[];for(E||(y=[E++]);k<o;)A[k]=k++;for(k=0;k<o;k++)A[k]=A[C=h&C+y[k%E]+(x=A[k])],A[C]=x;(_.g=function(I){for(var T,R=0,N=_.i,O=_.j,V=_.S;I--;)T=V[N=h&N+1],R=R*o+V[h&(V[N]=V[O=h&O+T])+(V[O]=T)];return _.i=N,_.j=O,R})(o)}function g(y,x){return x.i=y.i,x.j=y.j,x.S=y.S.slice(),x}function w(y,x){for(var E,_=y+"",k=0;k<_.length;)x[h&k]=h&(E^=19*x[h&k])+_.charCodeAt(k++);return v(x)}function v(y){return String.fromCharCode.apply(0,y)}if(t["seed"+s]=f,w(t.random(),e),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)});Nu.alea=XD,Nu.xor128=YD,Nu.xorwow=KD,Nu.xorshift7=JD,Nu.xor4096=QD,Nu.tychei=ZD;var ww=Nu.alea,LC=(function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=ww(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),eN=(function(){function n(e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1);var o=this;if(this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=ww(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})();function tn(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",CC(n),new Jh(n,e,t)}function tN(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var BC=ue({batchToSpaceND_:function(n,e,t){var r=J(n,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return ee(r.rank>=1+e.length,function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length}),ee(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),ee(r.shape[0]%i==0,function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),ve.runKernel(function(o){return o.batchToSpaceND(r,e,t)},{$x:r},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),nN=ue({cast_:function(n,e){var t=J(n,"x","cast");if(!ZI(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");return ve.runKernel(function(r){return r.cast(t,e)},{$x:t},function(r){return{$x:function(){return r.clone()}}})}}),rN=ue({clone_:function(n){var e=J(n,"x","clone",null);return ve.runKernel(function(t){return at.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),iN=ue({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=J(n,"x","cumsum"),o=ma([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=ga(1,i.rank)[0],u=ve.runKernel(function(l){return l.cumsum(a,s,t,r)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}});return o!=null&&(u=u.transpose(o)),u}}),oN=ue({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=J(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return ee(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape}),ee(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape}),ee(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape}),ve.runKernel(function(s){return s.depthToSpace(r,e,t)},{$x:r})}}),Zi=ue({expandDims_:function(n,e){e===void 0&&(e=0);var t=J(n,"x","expandDims",null);ee(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var r=t.shape.slice();return e<0&&(ee(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),r.splice(e,0,1),Ro(t,r)}}),UC=ue({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=tn([n,e],r),o=n<=e?n:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(n,e);if(t==null)return s;if(t.length===1)return yc(Zi(s,0),[t[0],1,1]);if(t.length===2)return yc(Zi(Zi(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return yc(Zi(Zi(Zi(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),aN=ue({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=J(n,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=ve.runKernel(function(l){return l.multinomial(s,r,e,t)},{logits2D:s});return a===1?u.as1D():u}}),Kb=ue({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=J(n,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),ve.runKernel(function(a){return a.oneHot(i,e,t,r)},{$indices:i},function(a){return{$indices:function(){return Wn(i.shape,"float32")}}}).reshape(o)}}),gd=ue({pad_:function(n,e,t){t===void 0&&(t=0);var r=J(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(o){return o[0]});return ve.runKernel(function(o){return o.pad(r,e,t)},{$x:r},function(o){return{$x:function(){return o.slice(i,r.shape)}}})}}),sN=ue({pad1d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),gd(n,[e],t)}}),uN=ue({pad2d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),gd(n,e,t)}}),lN=ue({pad3d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),gd(n,e,t)}}),cN=ue({pad4d_:function(n,e,t){return t===void 0&&(t=0),ee(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),gd(n,e,t)}}),hN=ue({rand_:function(n,e,t){var r=Pt(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return at.make(n,{values:i},t)}}),dN=ue({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new LC(e,t,r,!1,i),a=tn(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),zC=ue({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=tn(n,r),a=new eN(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Ro=ue({reshape_:function(n,e){var t=J(n,"x","reshape",null);return e=KI(e,t.size),ee(t.size===Pt(e),function(){return"new shape and old shape must have the same number of elements."}),ve.runKernel(function(r){return r.reshape(t,e)},{$x:t},function(r){return{$x:function(){return r.reshape(t.shape)}}})}}),WC=ue({spaceToBatchND_:function(n,e,t){var r=J(n,"x","spaceToBatchND");return ee(r.rank>=1+e.length,function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length}),ee(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),ee(r.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),ve.runKernel(function(i){return i.spaceToBatchND(r,e,t)},{$x:r},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),HC=ue({squeeze_:function(n,e){var t=J(n,"x","squeeze");return Ro(t,Bu(t.shape,e).newShape)}}),Po=ue({stack_:function(n,e){e===void 0&&(e=0);var t=um(n,"tensors","stack");if(ee(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;ee(e<=r,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){Rn(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){ee(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return Vr(a,e)}}),yc=ue({tile_:function(n,e){var t=J(n,"x","tile",null);return ee(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),ve.runKernel(function(r,i){var o=r.tile(t,e);return i([t]),o},{$x:t},function(r,i){var o=i[0];return{$x:function(){var a=pn(o);if(o.rank===1)for(var s=0;s<e[0];++s)a=a.add(r.slice([s*o.shape[0]],[o.shape[0]]));else if(o.rank===2)for(s=0;s<e[0];++s)for(var u=0;u<e[1];++u)a=a.add(r.slice([s*o.shape[0],u*o.shape[1]],[o.shape[0],o.shape[1]]));else if(o.rank===3)for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(var l=0;l<e[2];++l)a=a.add(r.slice([s*o.shape[0],u*o.shape[1],l*o.shape[2]],[o.shape[0],o.shape[1],o.shape[2]]));else{if(o.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+o.rank+" tensors yet.");for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(l=0;l<e[2];++l)for(var c=0;c<e[3];++c)a=a.add(r.slice([s*o.shape[0],u*o.shape[1],l*o.shape[2],c*o.shape[3]],[o.shape[0],o.shape[1],o.shape[2],o.shape[3]]))}return a}}})}}),fN=ue({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new LC(e,t,r,!0,i),a=tn(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Tr=ue({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=J(n,"x","unstack");return ee(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),ve.runKernel(function(r){return r.unstack(t,e)},{$x:t},function(r){return{$x:function(){return Po(r,e)}}})}}),pN=function(n,e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return Vt(this,function(f){switch(f.label){case 0:return t=J(n,"x","setdiff1d"),r=J(e,"y","setdiff1d"),ee(t.dtype===r.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."}),ee(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),ee(r.rank===1,function(){return"y should be 1D tensor, but got y ("+r.shape+")."}),[4,t.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new Jh([s],t.dtype),l=new Jh([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function lm(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([n[a+1]/e[a],e[a]]);i=i.concat(n.slice(o+1))}return i}function cm(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function hm(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function GC(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function VC(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}function jC(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=n.shape,s=t.slice();s.pop();var u=1;for(o=r;o<n.rank;++o)u*=a[o],s.push(a[o]);var l=nl(n.shape).map(function(c){return c/u}).concat([1]).slice(0,r);return[s,i,u,l]}var qC=30;function xy(n){return n<=qC?n:Vb(n,Math.floor(Math.sqrt(n)))}function mN(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}(function(r,i,o){var a=i.rank>1?i.shape[i.rank-1]:1,s=i.rank>1?i.rank-1:1,u="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+o.shape+", indices.shape: "+i.shape+", shape: "+r+", sliceDim: "+a+", and batchDim: "+s+".";if(o.rank<s)throw new Error(u+" update.rank < "+s+". ");if(r.length<a+(o.rank-s))throw new Error(u+" Output shape length < "+(a+(o.rank-s)));if(o.rank!==s+r.length-a)throw new Error(u+" update.rank != "+(s+r.length-a));for(var l=0;l<s;++l)if(o.shape[l]!==i.shape[l])throw new Error(u+" updates.shape["+l+"] ("+o.shape[l]+") != indices.shape["+l+"] ("+i.shape[l]+").");for(l=0;l<o.rank-s;++l)if(o.shape[l+s]!==r[l+a])throw new Error(u+" updates.shape["+(l+s)+"] ("+o.shape[l+s]+") != shape["+(l+s)+"] ("+r[l+s]+")")})(t,e,n)}function dm(n,e,t){for(var r=e.rank>1?e.shape[e.rank-1]:1,i=t.length,o=1,a=r;a<i;++a)o*=t[a];var s=r<1?1:r;return{sliceRank:r,numUpdates:e.size/s,sliceSize:o,strides:nl(t.slice(0,r)).concat([1]),outputSize:Pt(t)}}function _w(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),a!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],h=[],f=0;f<n.length;f++)l[f]=gN(i,e,r,n,f),c[f]=vN(o,t,r,n,f),u&1<<f&&(c[f]=l[f]+1,h.push(f));var m=new Array(n.length).fill(0);return m=m.map(function(g,w){for(var v=0,y=r[w]||1,x=l[w];!(y>0?x>=c[w]:x<=c[w]);x+=y)v+=1;return v}),[l,m,h]}function gN(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=zb(0,o,s-1)}function vN(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?zb(0,o,s):zb(-1,o,s-1)}function $C(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function XC(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function yN(n,e){ee(Gb(n),function(){return"The f passed in variableGrads(f) must be a function"}),ee(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof pd}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var r in e=[],ve.registeredVariables)e.push(ve.registeredVariables[r]);var i=t?e.filter(function(c){return!c.trainable}):null,o=e.length;ee((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=ve.gradients(n,e,null,!0),s=a.value,u=a.grads;ee(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),ee(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i?.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function vd(n){return ve.customGrad(n)}var iu=ue({softmax_:function(n,e){e===void 0&&(e=-1);var t=J(n,"logits","softmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return vd(function(r,i){var o=r.logSumExp([e],!0),a=r.toFloat().sub(o).exp();return i([a]),{value:a,gradFunc:function(s,u){var l=u[0],c=s.mul(l);return c.sub(c.sum([e],!0).mul(l))}}})(t)}}),bN=ue({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=J(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return vd(function(r,i){var o=r.max(e,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),YC=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.data.delete(e)},n})();function fc(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,a=n[o]||1;(e[e.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function lr(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function cn(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}function Qh(n,e,t,r,i,o,a){a===void 0&&(a="channelsLast");var s,u=fm(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,n[3],n[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,n[1],n[1]]}return yd(n,s,t,r,i,o,!1,a)}function yd(n,e,t,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],f=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],f=n[1],c=n[2],h=n[3]}var m,g=e[0],w=e[1],v=e[3],y=fm(t),x=y[0],E=y[1],_=fm(r),k=_[0],C=_[1],A=bc(g,k),I=bc(w,C),T=(function(F,B,U,P,L,H,W,z){var q,re,de;if(typeof F=="number"){var ye=F===0?"VALID":"NUMBER";q={top:F,bottom:F,left:F,right:F,type:ye};var te=(function(Y,ot,Ke,Xe,qe,Tt){qe==null&&(qe=wN(Y,ot,Xe));var Qe=Y[0],ft=Y[1],Mt=aS((Qe-ot+2*qe)/Xe+1,Tt);ee(oo(Mt),function(){return"The output # of rows ("+Mt+") must be an integer. Change the stride and/or zero pad parameters"});var Ut=aS((ft-ot+2*qe)/Xe+1,Tt);return ee(oo(Ut),function(){return"The output # of columns ("+Ut+") must be an integer. Change the stride and/or zero pad parameters"}),[Mt,Ut,Ke]})([B,U,1],H,1,P,F,z);re=te[0],de=te[1]}else if(F==="same"){re=Math.ceil(B/P),de=Math.ceil(U/L);var ie=Math.max(0,(re-1)*P+H-B),fe=Math.max(0,(de-1)*L+W-U),Re=Math.floor(ie/2),De=ie-Re,Be=Math.floor(fe/2),lt=fe-Be;q={top:Re,bottom:De,left:Be,right:lt,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);q={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((B-H+1)/P),de=Math.ceil((U-W+1)/L)}return{padInfo:q,outHeight:re,outWidth:de}})(i,c,h,x,E,A,I,o),R=T.padInfo,N=T.outHeight,O=T.outWidth,V=a?v*f:v;return s==="channelsFirst"?m=[l,V,N,O]:s==="channelsLast"&&(m=[l,N,O,V]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:f,outHeight:N,outWidth:O,outChannels:V,padInfo:R,strideHeight:x,strideWidth:E,filterHeight:g,filterWidth:w,effectiveFilterHeight:A,effectiveFilterWidth:I,dilationHeight:k,dilationWidth:C,inShape:n,outShape:m,filterShape:e}}function Sy(n,e,t,r,i,o,a){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],h=s[3],f=s[4];if(a==="channelsLast")u=n[0],l=n[1],c=n[2],h=n[3],f=n[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);u=n[0],f=n[1],l=n[2],c=n[3],h=n[4]}var m,g=e[0],w=e[1],v=e[2],y=e[4],x=oS(t),E=x[0],_=x[1],k=x[2],C=oS(r),A=C[0],I=C[1],T=C[2],R=(function(U,P,L,H,W,z,q,re,de,ye){var te,ie,fe,Re;if(U==="same"){ie=Math.ceil(P/W),fe=Math.ceil(L/z),Re=Math.ceil(H/q);var De=(ie-1)*W+re-P,Be=(fe-1)*z+de-L,lt=(Re-1)*q+ye-H,Y=Math.floor(De/2),ot=De-Y,Ke=Math.floor(Be/2),Xe=Be-Ke,qe=Math.floor(lt/2),Tt=lt-qe;te={top:Ke,bottom:Xe,left:qe,right:Tt,front:Y,back:ot,type:"SAME"}}else{if(U!=="valid")throw Error("Unknown padding parameter: "+U);te={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},ie=Math.ceil((P-re+1)/W),fe=Math.ceil((L-de+1)/z),Re=Math.ceil((H-ye+1)/q)}return{padInfo:te,outDepth:ie,outHeight:fe,outWidth:Re}})(i,l,c,h,E,_,k,bc(g,A),bc(w,I),bc(v,T)),N=R.padInfo,O=R.outDepth,V=R.outHeight,F=R.outWidth,B=o?y*f:y;return a==="channelsFirst"?m=[u,B,O,V,F]:a==="channelsLast"&&(m=[u,O,V,F,B]),{batchSize:u,dataFormat:a,inDepth:l,inHeight:c,inWidth:h,inChannels:f,outDepth:O,outHeight:V,outWidth:F,outChannels:B,padInfo:N,strideDepth:E,strideHeight:_,strideWidth:k,filterDepth:g,filterHeight:w,filterWidth:v,dilationDepth:A,dilationHeight:I,dilationWidth:T,inShape:n,outShape:m,filterShape:e}}function wN(n,e,t,r){r===void 0&&(r=1);var i=bc(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function fm(n){return typeof n=="number"?[n,n]:n}function oS(n){return typeof n=="number"?[n,n,n]:n}function bc(n,e){return e<=1?n:n+(n-1)*(e-1)}function aS(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function pm(n){var e=fm(n),t=e[0],r=e[1];return t===1&&r===1}function Xs(n,e){return pm(n)||pm(e)}function KC(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Wn(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!eD(n.dtype,e))return at.make(n.shape,{dataId:n.dataId},e);if(n.dtype==="complex64"){var a=t.real(n);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var s=dt(0,n.dtype);return o=t.notEqual(n,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function Jb(n,e){return at.make(e,{dataId:n.dataId},n.dtype)}function JC(n,e,t){var r=(e-n)/(t-1),i=fd(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return fi(i,"float32")}function Qb(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function sS(n,e){return{real:n[2*e],imag:n[2*e+1]}}function _N(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function xN(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function xw(n,e,t,r,i){for(var o=Array.from(e).map(function(m,g){return{score:m,boxIndex:g}}).filter(function(m){return m.score>i}).sort(function(m,g){return g.score-m.score}),a=[],s=0;s<o.length;s++){var u=o[s],l=u.score,c=u.boxIndex;if(l<i)break;for(var h=!1,f=a.length-1;f>=0;--f)if(SN(n,c,a[f])>=r){h=!0;break}if(!h&&(a.push(c),a.length>=t))break}return fi(a,"int32")}function SN(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),m=(s-o)*(u-a),g=(h-l)*(f-c);if(m<=0||g<=0)return 0;var w=Math.max(o,l),v=Math.max(a,c),y=Math.min(s,h),x=Math.min(u,f),E=Math.max(y-w,0)*Math.max(x-v,0);return E/(m+g-E)}function QC(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map(function(o){i[t]=o;var a=n.slice(r,i);return r[t]+=o,a})}function ZC(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=tn(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(n.rank),s=0;s<a.length;s++)a[s]=o[s]%n.shape[s];var u=n.locToIndex(a);i.values[r]=n.values[u]}return i.toTensor()}function eT(n,e,t,r,i){for(var o=e[e.length-1],a=[n.length/o,o],s=a[0],u=a[1],l=Hb(t,s*r),c=Hb("int32",s*r),h=0;h<s;h++){for(var f=h*u,m=n.subarray(f,f+u),g=[],w=0;w<m.length;w++)g.push({value:m[w],index:w});g.sort(function(_,k){return k.value-_.value});var v=h*r,y=l.subarray(v,v+r),x=c.subarray(v,v+r);for(w=0;w<r;w++)y[w]=g[w].value,x[w]=g[w].index}var E=e.slice();return E[E.length-1]=r,[di(l,E,t),di(c,E,"int32")]}function Sw(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=tn(n,"int32"),o=tn([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=i.indexToLoc(t[r]),s=r*n.length;o.values.set(a,s)}return o.toTensor()}var EN=(function(){return function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `}})(),kN=(function(){return function(n,e){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=n,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var r=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `}})(),CN=(function(){return function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,a=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}})();function tT(n,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return n+"."+t})}function pi(n,e){return e===1?[n]:tT(n,e)}function Ur(){var n,e,t,r,i,o,a,s,u,l;return be.getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0. || val < 0. || val == 0.) ? false : true;
      }
    `,u=`
      const float INFINITY = uintBitsToFloat(uint(0x7f800000));
    `,l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Hu(n,e,t){t===void 0&&(t="index");var r=nl(e);return r.map(function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"}).join("")}function Ew(n){var e=nl(n).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var nT=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function TN(n,e,t,r){var i=[];n.forEach(function(m){var g=Pt(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?i.push("uniform float "+m.name+(g>1?"["+g+"]":"")+";"):(i.push("uniform sampler2D "+m.name+";"),i.push("uniform int offset"+m.name+";"))});var o,a,s=i.join(`
`),u=n.map(function(m){return(function(g,w,v){v===void 0&&(v=!1);var y="";y+=v?rT(g):ic(g);var x=g.shapeInfo.logicalShape,E=w.logicalShape;return x.length<=E.length&&(y+=v?(function(_,k){var C,A=_.name,I=A.charAt(0).toUpperCase()+A.slice(1),T="get"+I+"AtOutCoords",R=_.shapeInfo.logicalShape.length,N=k.logicalShape.length,O=fc(_.shapeInfo.logicalShape,k.logicalShape),V=Pn(N),F=N-R,B=["x","y","z","w","u","v"];C=R===0?"":N<2&&O.length>=1?"coords = 0;":O.map(function(q){return"coords."+B[q+F]+" = 0;"}).join(`
`);var U="";U=N<2&&R>0?"coords":_.shapeInfo.logicalShape.map(function(q,re){return"coords."+B[re+F]}).join(", ");var P="return outputValue;",L=Pt(_.shapeInfo.logicalShape)===1,H=Pt(k.logicalShape)===1;if(R!==1||L||H){if(L&&!H)P=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(O.length){var W=R-2,z=R-1;O.indexOf(W)>-1&&O.indexOf(z)>-1?P="return vec4(outputValue.x);":O.indexOf(W)>-1?P="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(z)>-1&&(P="return vec4(outputValue.xx, outputValue.zz);")}}else P=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+V+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+I+"("+U+`);
      `+P+`
    }
  `})(g,w):(function(_,k){var C=_.name,A=C.charAt(0).toUpperCase()+C.slice(1),I="get"+A+"AtOutCoords",T=k.texShape,R=_.shapeInfo.texShape,N=_.shapeInfo.logicalShape.length,O=k.logicalShape.length;if(!_.shapeInfo.isUniform&&N===O&&_.shapeInfo.flatOffset==null&&Gr(R,T))return`
      float `+I+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var V,F=Pn(O),B=fc(_.shapeInfo.logicalShape,k.logicalShape),U=O-N,P=["x","y","z","w","u","v"];V=N===0?"":O<2&&B.length>=1?"coords = 0;":B.map(function(H){return"coords."+P[H+U]+" = 0;"}).join(`
`);var L="";return L=O<2&&N>0?"coords":_.shapeInfo.logicalShape.map(function(H,W){return"coords."+P[W+U]}).join(", "),`
    float `+I+`() {
      `+F+` coords = getOutputCoords();
      `+V+`
      return get`+A+"("+L+`);
    }
  `})(g,w)),y})(m,e,r)}).join(`
`),l=e.texShape,c=Ur(),h=(function(m){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+m.texture2D+`(textureSampler, uv).r;
    }
  `})(c),f=(function(m){return m.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+m.varyingFs+` vec2 resultUV;
    `+m.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    #define isnan(value) isnan_custom(value)
    `+m.defineSpecialNaN+`
    bvec4 isnan_custom(vec4 val) {
      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
    }

    `+m.defineSpecialInf+`
    `+m.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+MN+`
    `+RN+`
    `+AN+`
  `})(c);return e.isPacked?(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `})(0,g);case 2:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(Gr(_,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var A=Math.ceil(_[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=m,v=g,y=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],x=Math.ceil(w[2]/2),E=x*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(_,k){for(var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],A=Math.ceil(_[_.length-1]/2),I=A*Math.ceil(_[_.length-2]/2),T=I,R="",N="b, r, c",O=2;O<_.length-1;O++)T*=_[_.length-O-1],R=`
      int b`+O+" = index / "+T+`;
      index -= b`+O+" * "+T+`;
    `+R,N="b"+O+", "+N;return`
    ivec`+_.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+R+`

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec`+_.length+"("+N+`);
    }
  `})(m,g)}var w,v,y,x,E})(e.logicalShape,l),a=(function(m){return`
    void setOutput(vec4 val) {
      `+m.output+` = val;
    }
  `})(c)):(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(y,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `})(0,g);case 2:return(function(y,x){return Gr(y,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:y[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:y[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+y[1]+`;
      int c = index - r * `+y[1]+`;
      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=g,v=Hu(["r","c","d"],m),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(y,x){var E=Hu(["r","c","d","d2"],y);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+E+`
      return ivec4(r, c, d, d2);
    }
  `})(m,g);case 5:return(function(y,x){var E=Hu(["r","c","d","d2","d3"],y);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(m,g);case 6:return(function(y,x){var E=Hu(["r","c","d","d2","d3","d4"],y);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(m,g);default:throw new Error(m.length+"-D output sampling is not yet supported")}var w,v})(e.logicalShape,l),a=(function(m){return`
    void setOutput(float val) {
      `+m.output+` = vec4(val, 0, 0, 0);
    }
  `})(c)),r&&(f+=IN),[f,h,a,s,o,u,t].join(`
`)}function ic(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=Su(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Bl(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Su(r);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&Gr(r,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=Bu(r),c=l.newShape,h=l.keptDims,f=c;if(f.length<r.length){var m=oc(t,f);return`
      `+ic(m)+`
      float `+o+`(int row, int col) {
        return `+o+"("+ac(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Bl(t)+`
      }
    `;var g=a[0],w=a[1],v=Su(i);return w===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+g+", "+w+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[1]*r[2],s=r[2],u=Bu(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var f=oc(t,h);return`
        `+ic(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+ac(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Bl(t)+`
      }
    `;var m=t.shapeInfo.texShape,g=m[0],w=m[1],v=t.shapeInfo.flatOffset;if(w===a&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+g+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(w===s&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var y=Su(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+y+`;
        vec2 uv = uvFromFlat(`+g+", "+w+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=Bu(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var f=oc(t,c);return`
      `+ic(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+ac(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Bl(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,w=g[0],v=g[1];if(v===u&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=Su(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+v+", index + "+y+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=Bu(r),h=c.newShape,f=c.keptDims;if(h.length<r.length){var m=oc(t,h);return`
      `+ic(m)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+ac(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Bl(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,v=w[0],y=w[1];if(y===l&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===a&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=Su(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=Bu(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=oc(t,s);return`
      `+ic(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+ac(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,f=r[3]*h,m=r[2]*f,g=r[1]*m;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+g+", "+m+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Bl(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,y=v[0],x=v[1];if(x===g&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+m+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var E=Su(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+g+" + col * "+m+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+E+`;
      vec2 uv = uvFromFlat(`+y+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function rT(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Ur(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Ur();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `})(n);case 2:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=Ur();if(u!=null&&Gr(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],m=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+m+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `})(n);case 3:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=oc(i,c);return`
        `+rT(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+ac(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],m=l[1],g=Math.ceil(o[2]/2),w=g*Math.ceil(o[1]/2),v=Ur();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+m+", "+w+", "+g+`, b, row, col);
      return `+v.texture2D+"("+a+`, uv);
    }
  `})(n);default:return(function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],m=Math.ceil(o[a-1]/2),g=m*Math.ceil(o[a-2]/2),w="int b, int row, int col",v="b * "+g+" + (row / 2) * "+m+" + (col / 2)",y=2;y<a-1;y++)w="int b"+y+", "+w,g*=o[a-y-1],v="b"+y+" * "+g+" + "+v;var x=Ur();return`
    vec4 `+u+"("+w+`) {
      int index = `+v+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `})(n)}}var MN=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,RN=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,AN=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,IN=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Su(n){return"offset"+n}function Bl(n){var e=n.name,t=Pt(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Pn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function oc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function ac(n,e){return e.map(function(t){return n[t]}).join(", ")}var DN=(function(){return function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,ee(n.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Pn(l),h=pi("coords",l);if(o===1){var f=Pn(s=l+1);a=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var m=["x","y","z","w","u","v"].slice(0,s),g="."+m[s-1],w=m.map(function(I){return"int "+I}),v=pi("sourceLocR",s-1).concat("inIdx.r"),y=pi("sourceLocG",s-1).concat("inIdx.g"),x=pi("sourceLocB",s-1).concat("inIdx.b"),E=pi("sourceLocA",s-1).concat("inIdx.a"),_=t==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+E.join()+")));",C=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+E.join()+") : 0.)",A=r?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+A+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+_+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}})(),NN=(function(){return function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}})(),PN=(function(){return function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],cn(n,e),cn(n,t);var a="0.0";r!=null&&(cn(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(cn(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}})(),FN=(function(){return function(n,e,t,r,i,o){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],cn(n,e),cn(n,t);var a="vec4(0.0)";r!=null&&(cn(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(cn(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}})(),ON="return areal * breal - aimag * bimag;",LN="return areal * bimag + aimag * breal;",uS=(function(){return function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=cn(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}})(),Ey="return a + b;",ky="return a - b;",lS="return a * b;",jn=(function(){return function(n,e,t){this.variableNames=["A","B"],this.outputShape=cn(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}})(),Ma=(function(){return function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=cn(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||Pt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Pn(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=pi("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `}})(),BN=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, min, max));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"min"),r.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),UN=(function(){function n(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(min), vec4(max)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"min"),r.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),zN=(function(){return function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}})(),WN=(function(){return function(n){this.outputShape=[],this.outputShape=Nc(n,1),this.variableNames=n.map(function(s,u){return"T"+u});var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `}})(),HN=(function(){return function(n,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Nc(n,e);var t=this.outputShape,r=t.length,i=Pn(r),o=pi("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map(function(w,v){return"T"+v});var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var l=a[e],c="vec2("+a.slice(-2).join()+")",h=a.join(),f="if ("+l+" < "+s[0]+`)
          return getChannel(getT0(`+h+"), "+c+");";for(u=1;u<s.length;u++){var m=s[u-1];f+=`
        else if (`+l+" < "+s[u]+`) {
          `+l+" -= "+m+`;
          return getChannel(getT`+u+"("+h+"), "+c+`);
        }`}var g=s.length;f+=`
        else {
          `+l+" -= "+s[s.length-1]+`;
          return getChannel(getT`+g+"("+h+"), "+c+`);
        }`,this.userCode=`
      float getValue(`+a.map(function(w){return"int "+w})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);
        if (++`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }
        if (++`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }
        if (`+o[r-2]+" < "+t[r-2]+` &&
            --`+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}})(),GN=(function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),VN=(function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),jN=(function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),qN=(function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),$N=(function(){return function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),XN=(function(){return function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),YN=(function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.top,t=n.padInfo.left,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.filterHeight,u=n.filterWidth,l=4*Math.floor(n.inChannels/4),c=n.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+r+", "+i+`);
      const ivec2 pads = ivec2(`+e+", "+t+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`; wR++) {
          int xR = xRCorner + wR * `+o+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+u+`; wC++) {
            int xC = xCCorner + wC * `+a+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+l+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(c===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+l+`) *
                getW(wR, wC, `+l+`, d2);
            } else if (`+(c===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(c===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1),
                getX(batch, xR, xC, `+l+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2),
                getW(wR, wC, `+l+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),KN=(function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,f=n.filterWidth,m=4*Math.floor(n.inChannels/4),g=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),JN=(function(){return function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+r+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+h+`;
        int q = d2 - d1 * `+h+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+s+`;

          if (xR < 0 || xR >= `+e+`) {
            continue;
          }

          for (int wC = 0; wC < `+c+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+t+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}})(),QN=(function(){return function(n){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=n.outShape;for(var e=n.inHeight,t=n.inWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.strideHeight,a=n.strideWidth,s=n.dilationHeight,u=n.dilationWidth,l=n.filterHeight,c=n.filterWidth,h=c,f="int xR; int xC; int xCOffset;",m=0;m<l;m++)for(var g=0;g<c;g++)f+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<l;m++)for(var w=0;w<h;w++){if(f+=`
          xR = xRCorner + `+m*s+`;
          xC = xCCorner + `+(g=2*w)*u+`;
        `,a===1){if(g<c&&(f+=i%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+e+" && xC >= 0 && xC < "+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<c)){var v=i%2==0?_C(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(f+=`
                  xCOffset = xC + `+i%2+" + "+v+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,u>1&&(f+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+e+` &&
                      xCOffset >= 0 && xCOffset < `+t+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),f+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):f+=`
                  xCOffset = xC + `+v+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<c&&(f+=`
              if(xR >= 0 && xR < `+e+`) {
            `,i%2==1?(f+=`
                xCOffset = xC + 1 - `+a+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+t+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<c&&(f+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+a+`;
                  if(xCOffset >= 0 && xCOffset < `+t+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < `+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+a+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<c&&(f+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),f+="}");g<c&&(f+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<c&&(f+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<l;m++)for(g=0;g<c;g++)f+="result += xR"+m+"C"+g+" * wR"+m+"C"+g+";";this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+r+", "+i+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+f+`

        setOutput(result);
      }
    `}})(),ZN=(function(){return function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],a=n[1],s=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var f=r==="bilinear"?1:0,m=[a-1+".0",s-1+".0"],g=m[0],w=m[1],v=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],y=v[0],x=v[1],E=v[2],_=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],k=_[0],C=_[1],A=_[2];this.userCode=`
      const float height_ratio = float(`+y+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+C+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+A+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}})(),eP=(function(){return function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Pn(r)+` coords = getOutputCoords();
        int end = `+cS(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+cS(r,"coords")+` = idx;
          val += getX(`+(function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `}})();function cS(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var tP=(function(){return function(n,e){this.variableNames=["A"];var t=Ur();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Hu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `}})(),nP=(function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0;var t=Ur();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Hu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `}})(),rP=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),iP=(function(){return function(n){this.variableNames=["A"];var e=Ur();this.outputShape=n,this.userCode=`
      `+nT+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `}})(),oP=(function(){return function(n){this.variableNames=["A"],this.usesPackedTextures=!0;var e=Ur();this.outputShape=n,this.userCode=`
      `+nT+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `}})(),aP=(function(){return function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Ur(),i=e[0],o=e[1];this.outputShape=n;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Ew(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex /= 4;
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}})(),sP=(function(){return function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Ur(),i=e[0],o=e[1];this.outputShape=n;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);
    
              flatIndex /= 4;
              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Ew(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;
        
        `+a+`

        `+r.output+" = "+s+`;
      }
    `}})(),uP="return real * expR - imag * expI;",lP="return real * expI + imag * expR;",hS=(function(){return function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}})(),cP=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),hP=(function(){return function(n){this.variableNames=["A"];var e=Ur(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}})(),dP=(function(){return function(n){this.variableNames=["A"];var e=Ur(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `}})(),fP=(function(){return function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Pn(this.rank),o=(function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()})(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}})(),To,Ni,pP=(function(){return function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Pn(e.length),i=Pn(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}})();function Jm(n,e){return[e,n]}function Cy(n){var e=Pt(n);return Wb(Math.ceil(e/4))}function bd(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function mP(n,e){var t=Ur();return mD(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function gP(n,e){return wD(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function vP(n,e){return _D(n,e,new Uint16Array([0,1,2,2,1,3]))}function yP(n,e){var t,r,i,o,a,s,u,l,c=n;return be.getNumber("WEBGL_VERSION")===2?(t=c.R32F,r=c.R16F,i=c.RGBA16F,o=c.RGBA32F,a=c.RED,s=4,u=1,l=c.HALF_FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=c.RGBA,a=n.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function wd(n,e,t,r,i,o,a){SD(t,r);var s=xD(n,e),u=n.TEXTURE_2D;return Et(n,e,function(){return n.bindTexture(u,s)}),Et(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)}),Et(n,e,function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)}),Et(n,e,function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)}),Et(n,e,function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)}),Et(n,e,function(){return n.texImage2D(u,0,i,t,r,0,o,a,null)}),Et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)}),s}function bP(n,e,t,r,i){var o=Jm(t,r);return wd(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function wP(n,e,t,r,i){var o=Jm(t,r);return wd(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function _P(n,e,t,r,i){var o=Jm(t,r);return wd(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function xP(n,e,t,r,i){var o=bd(t,r);return wd(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function SP(n,e,t,r,i){var o=bd(t,r);return wd(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function EP(n,e,t,r){return Et(n,e,function(){return n.bindBuffer(n.ARRAY_BUFFER,r)}),tS(n,e,t,"clipSpacePos",r,3,20,0)&&tS(n,e,t,"uv",r,2,20,12)}function kP(n,e,t,r,i,o,a){var s,u,l;Et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(r*i*4),u=n.FLOAT,l=a.internalFormatPackedFloat),s.set(o),Et(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,s)}),Et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function CP(n,e,t,r){Et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,t)}),r.data instanceof Uint8Array?Et(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)}):Et(n,e,function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)}),Et(n,e,function(){return n.bindTexture(n.TEXTURE_2D,null)})}function TP(n,e,t,r,i){var o=n.createBuffer();Et(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)});var a=16*t*r;return Et(n,e,function(){return n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)}),Et(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)}),Et(n,e,function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)}),o}function MP(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function RP(n,e,t,r,i){var o=Jm(t,r),a=o[0],s=o[1],u=new Uint8Array(t*r*4);return Et(n,e,function(){return n.readPixels(0,0,a,s,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function AP(n,e,t,r,i,o,a,s){var u=n,l=new Float32Array((function(c,h){var f=bd(c,h);return f[0]*f[1]*4})(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function IP(n,e,t,r){var i=new Float32Array(t*r*4);return Et(n,e,function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)}),i}(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(To||(To={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Ni||(Ni={}));var DP=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=be.getNumber("WEBGL_VERSION");e!=null?(this.gl=e,cD(t,e)):this.gl=pa(t),be.getNumber("WEBGL_VERSION")===1?(this.textureFloatExtension=Zf(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=Zf(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=Zf(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=gP(this.gl,this.debug),this.indexBuffer=vP(this.gl,this.debug),this.framebuffer=ED(this.gl,this.debug),this.textureConfig=yP(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return be.getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Et(t,this.debug,function(){return t.finish()}),Et(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Et(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Et(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Et(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Et(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),bP(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),wP(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),_P(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),CP(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),kP(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),SP(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),xP(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(nS(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Et(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return RP(i.gl,i.debug,t,r,i.textureConfig)})},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,a){return AP(this.gl,e,0,0,0,o,a,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return MP(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=TP(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(be.getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,function(){return IP(i.gl,i.debug,t,r)})},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=gD(t,this.debug,e),i=mP(t,this.debug),o=yD(t,this.debug);return Et(t,this.debug,function(){return t.attachShader(o,i)}),Et(t,this.debug,function(){return t.attachShader(o,r)}),bD(t,this.debug,o),this.debug&&by(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=EP(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Et(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&by(this.gl,this.debug,this.program),Et(this.gl,this.debug,function(){return t.gl.useProgram(e)})},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?CD(this.gl,this.debug,e,t):TD(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),Et(this.gl,this.debug,function(){return r.gl.getAttribLocation(e,t)})},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),MD(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=bd(t,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&by(this.gl,this.debug,this.program),ep(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Et(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Et(this.gl,this.debug,function(){return e.gl.finish()})},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Zf(this.gl,this.debug,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return Gt(this,void 0,void 0,function(){var t=this;return Vt(this,function(r){switch(r.label){case 0:return[4,K2(function(){return t.disposed||t.isQueryAvailable(e,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return r.sent(),[2,this.getQueryTime(e,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise(function(r){t.addItemToPoll(function(){return e.isFencePassed()},function(){return r()})})},n.prototype.pollItems=function(){for(var e=(function(r){for(var i=0;i<r.length;++i){var o=r[i]();if(!o)break}return i-1})(this.itemsToPoll.map(function(r){return r.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||K2(function(){return r.pollItems(),r.itemsToPoll.length===0})},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),wy(this.gl,this.debug,e,this.framebuffer),this.debug&&ep(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(wy(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ep(this.gl)):nS(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;wy(i,this.debug,e,this.framebuffer),this.debug&&ep(i),this.outputTexture=e,Et(i,this.debug,function(){return i.viewport(0,0,t,r)}),Et(i,this.debug,function(){return i.scissor(0,0,t,r)})},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),Et(this.gl,this.debug,function(){return o.gl.scissor(e,t,r,i)})},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function dS(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach(function(t,r){var i=t.logicalShape,o=e[r],a=o.shape;if(!Gr(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!Gr(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var NP=(function(){return function(n,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=s.left,f=s.top,m=i*r,g=Ur();this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+n[1]+" || pos >= "+n[0]+`) continue;

            int offsetY = int(blockIndex / (`+u+")) * "+a+" - "+f+`;
            int d0 = offsetY + `+c+" * (pos / "+m+`);

            if(d0 >= `+e[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+h+`.);
            int d1 = offsetX + `+l+" * (int(mod(float(pos), "+m+".) / "+i+`.));

            if(d1 >= `+e[1]+` || d1 < 0) continue;

            vec2 innerDims = vec2(d1, int(mod(float(pos), `+i+`.)));
            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),
                                              int(innerDims.y)), innerDims);
          }
        }

        `+g.output+` = result;
      }
    `}})(),PP=(function(){return function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `}})(),FP=(function(){return function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}})(),OP=(function(){return function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `}})(),LP=(function(){return function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,a=i-1-n.padInfo.top,s=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}})(),Ty=(function(){return function(n,e,t,r,i,o){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=t?n[1]:n[2],s=Math.ceil(a/2),u=t?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",c=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",m="";o&&(f=`vec4 activation(vec4 x) {
        `+o+`
      }`,m="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),this.userCode=`
      `+f+`

      const float sharedDimension = `+s+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+s+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          result += (`+c[0]+" * "+h[0]+") + ("+c[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+m+`

        setOutput(result);
      }
    `}})(),BP=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),UP=(function(){return function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `}})(),zP=(function(){return function(n){this.variableNames=["A"],this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=pi("rc",e),r=Pn(e),i=(function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c})(e,n,t),o=(function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `})(e,n[n.length-1],n[n.length-2],t),a=(function(s,u){var l=s.length,c=(function(h,f){for(var m=[],g=0;g<=1;g++)for(var w=0;w<=1;w++){for(var v=(g===0?"r":"rp1")+", "+(w===0?"c":"cp1"),y=2;y<h;y++)v=f[f.length-1-y]+","+v;m.push(v)}return m})(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}}})(),WP=(function(){return function(n,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+n[l]+u[1]});var r=n.length,i=Pn(r),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,l){return u[0]+n[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}})(),HP=(function(){return function(n,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(v,y){return v[0]+n[y]+v[1]});for(var r=n.length,i=Pn(r),o=e.map(function(v){return v[0]}).join(","),a=e.map(function(v,y){return v[0]+n[y]}).join(","),s=pi("rc",r),u=pi("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",g=0,w=r===1?2:4;g<w;g++)m+=`
        `+h[g]+`
        if (`+f+`) {
          result[`+g+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+g+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `}})(),My=(function(){return function(n,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var r=n.filterWidth,i=n.strideHeight,o=n.strideWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=n.padInfo.top,h=n.padInfo.left;this.outputShape=n.outShape;var f=e==="avg",m="0.0";if(f||(m="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var g=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(g="avgValue / count");var w=4*Math.floor(r/4),v=r%4,y=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+w+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+y+`
          }

          int xC = xCCorner + `+w+`;
          if (`+(v===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+y+`
          } else if (`+(v===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+y+`
          } else if (`+(v===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+y+`
          }
        }
        setOutput(`+g+`);
      }
    `}}})(),GP=(function(){return function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var m="";i%t>0&&(m=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `}})(),VP=(function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Hu(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Ew(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `}})(),jP=(function(){return function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}})(),qP=(function(){return function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}})(),$P=(function(){return function(n,e,t,r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));
        
        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`; 
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}})(),XP=(function(){return function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}})(),YP=(function(){return function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}})(),KP=(function(){return function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map(function(o,a){return(function(s){return e.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"})(a)}).join(","),i=Pn(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `}})(),JP=(function(){return function(n,e){this.variableNames=["x"],this.usesPackedTextures=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=pi("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],a=Pn(t);function s(u){var l=n.map(function(c,h){return(function(f,m){return e.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+m[f]+" - 1":""+m[f]})(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(u){return s(u)})(r.slice())+`;
          if(`+i+`){
            result.g = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)})(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+(function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            if(`+i+`) {
              result.a = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `}})(),fS=(function(){return function(n,e,t,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Pn(i.length),u=Pn(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",m=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}})(),QP=(function(){return function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,a=o*Math.ceil(i/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `}})(),ZP=(function(){return function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<n&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=Pn(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}})(),eF=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Pn(this.rank),i="uniform int start["+this.rank+"];",o=(function(a){if(a===1)return"sourceLoc";if(a<=6)return Ry.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+Ry[s]+" = start["+s+"] + coords."+Ry[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),Ry=["x","y","z","w","u","v"],tF=(function(){function n(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=Pn(this.rank),r=pi("coords",this.rank),i=pi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+` 
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),nF=(function(){return function(n,e,t,r){this.variableNames=["x"];var i=t.filter(function(c,h){return r.indexOf(h)===-1});this.outputShape=i;var o=t.length,a=Pn(t.length),s=Pn(i.length),u="";if(o===1)u="coords * strides + begin";else{var l=0;u=t.map(function(c,h){return r.indexOf(h)===-1?(l++,i.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(l-1)+"] * strides["+h+"] + begin["+h+"]"):"begin["+h+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+n+`);
      `+a+" strides = "+a+"("+e+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+u+`));
      }
    `}})(),rF=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=pS(t,r),a=mS(e,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===Ni.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Ni.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Ni.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Ni.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Ni.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=mS(t,pS(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(r){e.gpgpu.deleteMatrixTexture(r)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function pS(n,e){if(n===To.UPLOAD)return Ni.PACKED_2X2_FLOAT32;if(n===To.RENDER||n==null)return e?be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Ni.PACKED_2X2_FLOAT32:Ni.PACKED_2X2_FLOAT16:be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Ni.UNPACKED_FLOAT32:Ni.UNPACKED_FLOAT16;if(n===To.DOWNLOAD||n===To.PIXELS)return Ni.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function mS(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var iF=(function(){return function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Pn(this.rank),o=(function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()})(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}})(),oF=(function(){return function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Pn(this.rank),o=(function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}})(),aF=(function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Pn(this.rank),o=tT("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }  
      setOutput(result);
    }
    `}})(),kw=1.7580993408473768,Cw=1.0507009873554805,Qt=(function(){return function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}})(),il="if (isnan(x)) return x;",sF="return x;",gS=il+`
  return (x < 0.0) ? 0.0 : x;
`,uF=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+kw+`;
  float scale = `+Cw+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,vS="return exp(x);",lF=il+`
  return sin(x);
`,cF=il+`
  return cos(x);
`,hF=il+`
  return atan(x);
`,dF=il+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,fF=il+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,pF="return x;",yS=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ay=(function(){return function(n,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}})(),mF=(function(){return function(n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=n;var e=n.length,t=pi("rc",e),r=Pn(e),i=(function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l})(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `}})(),rp={},gF=600,vF=(function(){function n(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!be.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var t=pa(be.getNumber("WEBGL_VERSION"));this.binaryCache=((r=be.getNumber("WEBGL_VERSION"))in rp||(rp[r]={}),rp[r]),this.gpgpu=new DP(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var r;this.textureManager=new rF(this.gpgpu),this.numMBBeforeWarning=be.global.screen==null?1024:be.global.screen.height*be.global.screen.width*window.devicePixelRatio*gF/1024/1024,this.texData=new YC(this,ve)}return n.prototype.register=function(e,t,r){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:r})},n.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r=[e.height,e.width],i=[e.height,e.width,t];if(be.getBool("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e.data instanceof Uint8Array))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o,a,s=this.makeTensorHandle(r,"int32");if(this.texData.get(s.dataId).usage=To.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(s.dataId),e),be.getBool("WEBGL_PACK")){o=new dP(i);var u=this.makePackedTensor(o.outputShape,s.dtype);a=this.compileAndRun(o,[s],u)}else o=new hP(i),a=this.compileAndRun(o,[s]);return this.disposeData(s.dataId),a},n.prototype.makeTensorHandle=function(e,t){var r={};return this.register(r,e,t),{dataId:r,shape:e,dtype:t}},n.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendWebGL.write(): values can not be null");if(be.getBool("DEBUG"))for(var r=0;r<t.length;r++){var i=t[r];if(!fD(i))throw Error("The value "+i+" cannot be represented on this device.")}var o=this.texData.get(e);if(o.dtype==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(e),o.usage=To.UPLOAD,o.values=t},n.prototype.readSync=function(e){var t=this.texData.get(e),r=t.values,i=t.dtype,o=t.complexTensors,a=t.slice,s=t.shape;if(a!=null){var u=new Qt(s,"return x;"),l=this.compileAndRun(u,[{dataId:e,shape:s,dtype:i}]),c=this.readSync(l.dataId);return l.dispose(),c}if(r!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return r;var h,f,m=this.activeTimers!=null;return m&&(h=performance.now()),i==="complex64"?f=Qb(o.real.dataSync(),o.imag.dataSync()):f=this.getValuesFromTexture(e),m&&(this.downloadWaitMs+=performance.now()-h),this.convertAndCacheOnCPU(e,f)},n.prototype.read=function(e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C;return Vt(this,function(A){switch(A.label){case 0:if(this.pendingRead.has(e))return r=this.pendingRead.get(e),[2,new Promise(function(I){return r.push(I)})];if(i=this.texData.get(e),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,s!=null)return c=new Qt(a,"return x;"),h=this.compileAndRun(c,[{dataId:e,shape:a,dtype:u}]),f=this.read(h.dataId),h.dispose(),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(e)];if(!be.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&be.getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,u!=="complex64"&&be.get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(e),e=g.dataId,w=this.texData.get(g.dataId),m=(t=this.gpgpu).createBufferFromTexture.apply(t,[w.texture].concat(Cy(a)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:A.sent(),A.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return y=A.sent(),x=y[0],E=y[1],v=Qb(x,E),[3,5];case 4:m==null?v=this.getValuesFromTexture(e):(_=Pt(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(m,_),this.disposeData(e)),A.label=5;case 5:return k=this.convertAndCacheOnCPU(e,v),C=this.pendingRead.get(e),this.pendingRead.delete(e),C.forEach(function(I){return I(k)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,k]}})})},n.prototype.getValuesFromTexture=function(e){var t,r=this,i=this.texData.get(e),o=i.shape,a=i.dtype,s=i.isPacked,u=Pt(o);if(be.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),c=this.texData.get(l.dataId),h=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[c.texture].concat(Cy(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=be.getBool("WEBGL_PACK")&&s===!0,m=f?_y(o):o,g=this.makeTensorHandle(m,"float32");g.size=Pt(o),this.texData.get(g.dataId).usage=To.DOWNLOAD;var w=At(function(){var x=f?new oP(m):new iP(m);return r.compileAndRun(x,[{shape:m,dtype:a,dataId:e}],g,null)}),v=this.texData.get(w.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),y},n.prototype.time=function(e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s,u;return Vt(this,function(l){switch(l.label){case 0:return t=this.activeTimers,r=[],i=!1,this.programTimersStack==null?(this.programTimersStack=r,i=!0):this.activeTimers.push(r),this.activeTimers=r,e(),o=Dc(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),a=Dc(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null}),this.activeTimers=t,i&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return s=l.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:XI(s),getExtraProfileInfo:function(){return s.map(function(c,h){return{name:a[h],ms:c}}).map(function(c){return c.name+": "+c.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},n.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},n.prototype.startTimer=function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},n.prototype.endTimer=function(e){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},n.prototype.getQueryTime=function(e){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(r){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},n.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},n.prototype.releaseGPUData=function(e){var t=this.texData.get(e),r=t.texture,i=t.dtype,o=t.texShape,a=t.usage,s=t.isPacked,u=t.slice,l=u&&u.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),r!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(r,o,a,s)));var h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},n.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},n.prototype.getCPUBackend=function(){return be.getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ve.findBackend("cpu")),this.cpuBackend):null},n.prototype.shouldExecuteOnCPU=function(e,t){var r=this;return t===void 0&&(t=128),this.getCPUBackend()!=null&&e.every(function(i){return r.texData.get(i.dataId).texture==null&&i.size<t})},n.prototype.getGPGPUContext=function(){return this.gpgpu},n.prototype.complex=function(e,t){var r=this.makeOutputArray(e.shape,"complex64");return this.texData.get(r.dataId).complexTensors={real:ve.keep(e.clone()),imag:ve.keep(t.clone())},r},n.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},n.prototype.slice=function(e,t,r){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,r);if(Pt(r)===0)return di([],r,e.dtype);var i=this.texData.get(e.dataId).isPacked,o=$C(e.shape,t,r);if(i||!o){var a=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new tF(r):new eF(r),s=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,s)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,r)},n.prototype.shallowSlice=function(e,t,r){var i=this.texData.get(e.dataId),o=at.make(r,{},e.dtype,this),a=this.texData.get(o.dataId);Object.assign(a,i),a.shape=r,a.dtype=e.dtype;var s=XC(t,e.strides);i.slice&&(s+=i.slice.flatOffset),a.slice={flatOffset:s,origDataId:i.slice&&i.slice.origDataId||e.dataId};var u=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,u+1),o},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u,l){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,r,i,o,a,s,u,l);var c=_w(e.shape,t,r,i,o,a,s,u,l),h=c[0],f=c[1],m=c[2],g=f.filter(function(v,y){return m.indexOf(y)===-1});if(g.some(function(v){return v===0}))return di([],g);var w=new nF(h,i,f,m);return this.compileAndRun(w,[e])},n.prototype.reverse=function(e,t){var r=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new JP(e.shape,t):new KP(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(e.length===1)return e[0];if(e.length>be.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(e.length/2),i=this.concat(e.slice(0,r),t),o=this.concat(e.slice(r),t);return this.concat([i,o],t)}if(be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new HN(e.map(function(c){return c.shape}),t);return this.compileAndRun(a,e)}var s=Nc(e.map(function(c){return c.shape}),t),u=e.map(function(c){return c.as2D(-1,Pt(c.shape.slice(t)))}),l=new WN(u.map(function(c){return c.shape}));return this.compileAndRun(l,u).reshape(s)},n.prototype.neg=function(e){var t=new Qt(e.shape,"return -x;");return this.compileAndRun(t,[e])},n.prototype.batchMatMul=function(e,t,r,i){var o=r?e.shape[2]:e.shape[1],a=i?t.shape[1]:t.shape[2],s=r?e.shape[1]:e.shape[2],u=e.shape[0];if((o===1||a===1)&&s>1e3){r&&(e=e.transpose([0,2,1])),i&&(t=t.transpose([0,2,1]));var l=a===1?e:e.as3D(u,s,1),c=a===1?2:1,h=a===1?t.as3D(u,1,s):t;return this.multiply(l,h).sum(c,!0)}var f=or(e.dtype,t.dtype),m=new Ty(e.shape,[u,o,a],r,i),g=this.makePackedTensor(m.outputShape,f);return this.compileAndRun(m,[e,t],g)},n.prototype.fusedBatchMatMul=function(e,t,r,i,o,a){var s=r?e.shape[2]:e.shape[1],u=i?t.shape[1]:t.shape[2],l=e.shape[0],c=or(e.dtype,t.dtype),h=new Ty(e.shape,[l,s,u],r,i,!!o,a?(function(g,w){if(g==="linear")return w?pF:sF;if(g==="relu")return w?yS:gS;throw new Error("Activation "+g+" has not been implemented for the WebGL backend.")})(a,!0):null),f=this.makePackedTensor(h.outputShape,c),m=[e,t];return o&&m.push(o),this.compileAndRun(h,m,f)},n.prototype.multiply=function(e,t){if(e.dtype==="complex64"){var r=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=new uS(ON,e.shape,t.shape),a=new uS(LN,e.shape,t.shape),s=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag),this.makeComplexComponentTensorHandle(t,i.complexTensors.real),this.makeComplexComponentTensorHandle(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l);return u.dispose(),l.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,lS,e.dtype);var h=new jn(lS,e.shape,t.shape),f=this.makeOutputArray(h.outputShape,e.dtype);return this.compileAndRun(h,[e,t],f)},n.prototype.batchNormalization=function(e,t,r,i,o,a){var s=[e,t,r],u=null;a!=null&&(u=a.shape,s.push(a));var l=null;if(o!=null&&(l=o.shape,s.push(o)),be.getBool("WEBGL_PACK_NORMALIZATION")){var c=new FN(e.shape,t.shape,r.shape,u,l,i);return this.compileAndRun(c,s)}var h=new PN(e.shape,t.shape,r.shape,u,l,i);return this.compileAndRun(h,s)},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){var a=be.getBool("WEBGL_PACK_NORMALIZATION")?new OP(e.shape,t,r,i,o):new PP(e.shape,t,r,i,o);return this.compileAndRun(a,[e])},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){var u=new FP(t.shape,i,o,a,s);return this.compileAndRun(u,[t,r,e])},n.prototype.tile=function(e,t){if(e.dtype==="string")return ZC(tn(e.shape,e.dtype,this.readSync(e.dataId)),t);var r=new iF(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.pad=function(e,t,r){var i=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HP(e.shape,t,r):new WP(e.shape,t,r);return this.compileAndRun(i,[e])},n.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var r=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new aF(e.shape,t):new oF(e.shape,t);return this.compileAndRun(r,[e])},n.prototype.gather=function(e,t,r){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,r);var i=new fP(e.shape,t.size,r);return this.compileAndRun(i,[e,t])},n.prototype.batchToSpaceND=function(e,t,r){ee(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(c,h){return c*h}),o=lm(e.shape,t,i),a=cm(o.length,t.length),s=hm(e.shape,t,i),u=GC(r,t.length),l=VC(s,r,t.length);return e.reshape(o).transpose(a).reshape(s).slice(u,l)},n.prototype.spaceToBatchND=function(e,t,r){ee(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,r);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var s=e.pad(o),u=lm(s.shape,t,i,!1),l=cm(u.length,t.length,!1),c=hm(s.shape,t,i,!1);return s.reshape(u).transpose(l).reshape(c)},n.prototype.reduce=function(e,t,r){var i=e.shape[0],o=e.shape[1],a=xy(o),s=new GP({windowSize:a,inSize:o,batchSize:i},t),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],r);return this.compileAndRun(s,[e],h),h.shape[1]===1?h:this.reduce(h,t,r)},n.prototype.argReduce=function(e,t,r){r===void 0&&(r=null);var i=e.shape[0],o=e.shape[1];r!=null&&(i=r.shape[0],o=r.shape[1]);var a=xy(o),s=new CN({windowSize:a,inSize:o,batchSize:i},t,r==null),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],"int32"),f=[e];return r!=null&&f.push(r),this.compileAndRun(s,f,h),h.shape[1]===1?h:this.argReduce(e,t,h)},n.prototype.argReducePacked=function(e,t,r){r===void 0&&(r=null);var i=r!=null?r.shape:e.shape,o=xy(i[i.length-1]),a=new DN(i,o,t,r==null),s=this.makePackedTensor(a.outputShape,"int32"),u=r==null?[e]:[e,r];return this.compileAndRun(a,u,s),s.rank===e.rank?this.argReducePacked(e,t,s):s},n.prototype.sum=function(e,t){Ai("sum",t,e.rank);var r=Lr(e.shape,t),i=r[0],o=Pt(r[1]),a=e.as2D(-1,o),s=py(e.dtype);return this.reduce(a,"sum",s).reshape(i)},n.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var r=Lr(e.shape,t),i=r[0],o=Pt(r[1]),a=e.as2D(-1,o),s=py(e.dtype);return this.reduce(a,"prod",s).reshape(i)},n.prototype.unsortedSegmentSum=function(e,t,r){var i=0,o=ma([i],e.rank),a=e;o!=null&&(a=e.transpose(o),i=ga(1,e.rank)[0]);var s=(function(f,m,g){for(var w=[],v=f.length,y=0;y<v;y++)y!==m?w.push(f[y]):w.push(g);return w})(a.shape,i,r),u=Pt([a.shape[i]]),l=a.as2D(-1,u),c=py(e.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",t,c,r).reshape(s);return o!=null&&(h=h.transpose(vw(o))),h},n.prototype.segOpCompute=function(e,t,r,i,o){var a=e.shape[0],s=e.shape[1],u=(function(g,w){var v,y=!1;for(g<=qC?(v=g,y=!0):v=Vb(g,Math.floor(Math.sqrt(g)));!y;)v>w||v===g?y=!0:v=Vb(g,v+1);return v})(s,o),l=new QP({windowSize:u,inSize:s,batchSize:a,numSegments:o},t),c=l.outputShape,h=c[0],f=c[1],m=this.makeOutputArray([h,f],i);return this.compileAndRun(l,[e,r],m),m.shape[1]===o?m:(r=FC(0,o).tile([s/u]),this.segOpCompute(m,t,r,i,o))},n.prototype.argMinMaxReduce=function(e,t,r){var i=[t];if(Ai("arg"+r.charAt(0).toUpperCase()+r.slice(1),i,e.rank),!be.getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Lr(e.shape,i),a=o[0],s=Pt(o[1]),u=e.as2D(-1,s);return this.argReduce(u,r).reshape(a)}return this.argReducePacked(e,r)},n.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},n.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},n.prototype.cumsum=function(e,t,r,i){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new eP(e.shape,r,i);return this.compileAndRun(o,[e])},n.prototype.equal=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(equal(a, b));
`,"bool");var r=new jn("return float(a == b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.notEqual=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(notEqual(a, b));
`,"bool");var r=new jn("return float(a != b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThan(a, b));
`,"bool");var r=new jn("return float(a < b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.lessEqual=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThanEqual(a, b));
`,"bool");var r=new jn("return float(a <= b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThan(a, b));
`,"bool");var r=new jn("return float(a > b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.greaterEqual=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var r=new jn("return float(a >= b);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.logicalNot=function(e){var t=new Qt(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},n.prototype.logicalAnd=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var r=new jn("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.logicalOr=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var r=new jn("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"bool");return this.compileAndRun(r,[e,t],i)},n.prototype.select=function(e,t,r){var i=new ZP(e.rank,t.shape,t.rank),o=this.makeOutputArray(i.outputShape,or(t.dtype,r.dtype));return this.compileAndRun(i,[e,t,r],o)},n.prototype.where=function(e){Yb("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Sw(e.shape,t)},n.prototype.topk=function(e,t,r){return eT(e.dataSync(),e.shape,e.dtype,t)},n.prototype.min=function(e,t){Ai("min",t,e.rank);var r=Lr(e.shape,t),i=r[0],o=Pt(r[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(i)},n.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.mod=function(e,t){var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Ai("max",t,e.rank);var r=Lr(e.shape,t),i=r[0],o=Pt(r[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(i)},n.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.all=function(e,t){Ai("all",t,e.rank);var r=Lr(e.shape,t),i=r[0],o=Pt(r[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(i)},n.prototype.any=function(e,t){Ai("any",t,e.rank);var r=Lr(e.shape,t),i=r[0],o=Pt(r[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(i)},n.prototype.squaredDifference=function(e,t){var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma("return (a - b) * (a - b);",e.shape,t.shape):new jn("return (a - b) * (a - b);",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.realDivide=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(b.x == 0.0) {
    result.x = NAN;
  } else if(a.x == b.x) {
    result.x = 1.;
  }
  if(b.y == 0.0) {
    result.y = NAN;
  } else if(a.y == b.y) {
    result.y = 1.;
  }
  if(b.z == 0.0) {
    result.z = NAN;
  } else if(a.z == b.z) {
    result.z = 1.;
  }
  if(b.w == 0.0) {
    result.w = NAN;
  } else if(a.w == b.w) {
    result.w = 1.;
  }
  
  return result;
`,"float32",!0);var r=new jn(`
if (b == 0.0) {
  return NAN;
} 
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e,t],i)},n.prototype.floorDiv=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var r=new jn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,t.shape),i=this.makeOutputArray(r.outputShape,"int32");return this.compileAndRun(r,[e,t],i)},n.prototype.add=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,Ey);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var r=or(e.dtype,t.dtype);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Ey,r);var i=new jn(Ey,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[e,t],o)},n.prototype.packedBinaryOp=function(e,t,r,i,o){o===void 0&&(o=!1);var a=new Ma(r,e.shape,t.shape,o),s=this.makePackedTensor(a.outputShape,i);return this.compileAndRun(a,[e,t],s)},n.prototype.complexSeparableBinaryOp=function(e,t,r){var i=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),s=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(h){var f=h[0],m=h[1],g=i.makeComplexComponentTensorHandle(e,f),w=i.makeComplexComponentTensorHandle(t,m),v=new jn(r,e.shape,t.shape),y=i.makeOutputArray(v.outputShape,or(f.dtype,m.dtype));return i.compileAndRun(v,[g,w],y)}),u=s[0],l=s[1],c=this.complex(u,l);return u.dispose(),l.dispose(),c},n.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},n.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>be.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),r=this.addN(e.slice(0,t)),i=this.addN(e.slice(t));return this.addN([r,i])}var o=e.map(function(c){return c.dtype}).reduce(function(c,h){return or(c,h)}),a=e.map(function(c){return c.shape}),s=be.getBool("WEBGL_PACK"),u=s?new kN(e[0].shape,a):new EN(e[0].shape,a),l=s?this.makePackedTensor(u.outputShape,o):this.makeOutputArray(u.outputShape,o);return this.compileAndRun(u,e,l)},n.prototype.subtract=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,ky);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var r=or(e.dtype,t.dtype);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,ky,e.dtype);var i=new jn(ky,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,r);return this.compileAndRun(i,[e,t],o)},n.prototype.pow=function(e,t){var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=r?new Ma(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,t.shape),o=or(e.dtype,t.dtype),a=r?this.makePackedTensor(i.outputShape,o):this.makeOutputArray(i.outputShape,o);return this.compileAndRun(i,[e,t],a)},n.prototype.ceil=function(e){var t=new Qt(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},n.prototype.floor=function(e){var t=new Qt(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},n.prototype.sign=function(e){var t=new Qt(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(t,[e])},n.prototype.isNaN=function(e){var t=new Qt(e.shape,"return float(isnan(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isInf=function(e){var t=new Qt(e.shape,"return float(isinf(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.isFinite=function(e){var t=new Qt(e.shape,"return float(!isnan(x) && !isinf(x));"),r=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],r)},n.prototype.round=function(e){var t=new Qt(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(t,[e])},n.prototype.exp=function(e){var t;return t=be.getBool("WEBGL_PACK")?new Ay(e.shape,vS):new Qt(e.shape,vS),this.compileAndRun(t,[e])},n.prototype.expm1=function(e){var t=new Qt(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},n.prototype.log=function(e){var t;return t=be.getBool("WEBGL_PACK")?new Ay(e.shape,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`):new Qt(e.shape,`if (x < 0.0) return NAN;
  return log(x);`),this.compileAndRun(t,[e])},n.prototype.log1p=function(e){var t=new Qt(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},n.prototype.sqrt=function(e){var t=new Qt(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},n.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Qt(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},n.prototype.square=function(e){var t=new Qt(e.shape,"return x * x;");return this.compileAndRun(t,[e])},n.prototype.reciprocal=function(e){var t=new Qt(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},n.prototype.relu=function(e){var t;return t=be.getBool("WEBGL_PACK")?new Ay(e.shape,yS):new Qt(e.shape,gS),this.compileAndRun(t,[e])},n.prototype.prelu=function(e,t){var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma(`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,e.shape,t.shape):new jn("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.elu=function(e){var t=new Qt(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},n.prototype.eluDer=function(e,t){var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,t.shape):new jn("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.selu=function(e){var t=new Qt(e.shape,uF);return this.compileAndRun(t,[e])},n.prototype.int=function(e){var t=new Qt(e.shape,"return float(int(x));"),r=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],r)},n.prototype.clip=function(e,t,r){var i,o=(i=be.getBool("WEBGL_PACK_CLIP")?new UN(e.shape):new BN(e.shape)).getCustomSetupFunc(t,r);return this.compileAndRun(i,[e],null,o)},n.prototype.abs=function(e){var t=new Qt(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},n.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),r=new zN(e.shape),i=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(r,i)},n.prototype.sigmoid=function(e){var t=new Qt(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},n.prototype.softplus=function(e){var t=new Qt(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(t,[e])},n.prototype.sin=function(e){var t=new Qt(e.shape,lF);return this.compileAndRun(t,[e])},n.prototype.cos=function(e){var t=new Qt(e.shape,cF);return this.compileAndRun(t,[e])},n.prototype.tan=function(e){var t=new Qt(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},n.prototype.asin=function(e){var t=new Qt(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},n.prototype.acos=function(e){var t=new Qt(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},n.prototype.atan=function(e){var t=new Qt(e.shape,hF);return this.compileAndRun(t,[e])},n.prototype.atan2=function(e,t){var r=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ma(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,t.shape);return this.compileAndRun(r,[e,t])},n.prototype.sinh=function(e){var t=new Qt(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},n.prototype.cosh=function(e){var t=new Qt(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},n.prototype.tanh=function(e){var t=new Qt(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(t,[e])},n.prototype.asinh=function(e){var t=new Qt(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},n.prototype.acosh=function(e){var t=new Qt(e.shape,dF);return this.compileAndRun(t,[e])},n.prototype.atanh=function(e){var t=new Qt(e.shape,fF);return this.compileAndRun(t,[e])},n.prototype.erf=function(e){var t=new Qt(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`);return this.compileAndRun(t,[e])},n.prototype.step=function(e,t){var r=new Qt(e.shape,(function(i){return i===void 0&&(i=0),il+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `})(t));return this.compileAndRun(r,[e])},n.prototype.conv2dByMatMul=function(e,t,r){var i=e.shape,o=this.texData.get(e.dataId),a=r.inChannels,s=i[0]*i[1]*i[2],u=r.outChannels,l=(s===1||u===1)&&a>1e3,c=i[2]%2!=0&&!!o.isPacked;if(l||!be.getBool("WEBGL_LAZILY_UNPACK")||!be.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!c){var h=this.reshape(e,[1,i[0]*i[1]*i[2],r.inChannels]),f=this.reshape(t,[1,r.inChannels,r.outChannels]);return this.reshape(this.batchMatMul(h,f,!1,!1),r.outShape)}var m=at.make([1,i[0]*i[1]*(i[2]+1),r.inChannels],{dataId:e.dataId},e.dtype,this),g=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,ee(np(o.shape,m.shape),function(){return"packed reshape "+o.shape+" to "+m.shape+" isn't free"});var w=this.reshape(t,[1,r.inChannels,r.outChannels]),v=this.batchMatMul(m,w,!1,!1),y=this.texData.get(v.dataId);return ee(y.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=g,y.shape=r.outShape,at.make(r.outShape,{dataId:v.dataId},v.dtype,this)},n.prototype.conv2dWithIm2Row=function(e,t,r){var i=r.filterWidth,o=r.filterHeight,a=r.inChannels,s=r.outWidth,u=r.outHeight,l=i*o*a,c=u*s,h=[l,c],f=e.squeeze([0]),m=t.reshape([1,l,-1]),g=new NP(h,f.shape,r),w=this.compileAndRun(g,[f]).reshape([1,h[0],h[1]]),v=new Ty(w.shape,[1,c,r.outChannels],!0,!1);return this.compileAndRun(v,[w,m]).reshape([1,u,s,r.outChannels])},n.prototype.conv2d=function(e,t,r){if(r.filterHeight===1&&r.filterWidth===1&&r.dilationHeight===1&&r.dilationWidth===1&&r.strideHeight===1&&r.strideWidth===1&&(r.padInfo.type==="SAME"||r.padInfo.type==="VALID"))return this.conv2dByMatMul(e,t,r);if(be.getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,t,r);var i=new YN(r);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerInput=function(e,t,r){var i=new VN(r);return this.compileAndRun(i,[e,t])},n.prototype.conv2dDerFilter=function(e,t,r){var i=new GN(r);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2D=function(e,t,r){var i;return be.getBool("WEBGL_PACK_DEPTHWISECONV")&&r.strideWidth<=2&&r.outChannels/r.inChannels==1?(i=new QN(r),this.compileAndRun(i,[e,t],this.makePackedTensor(r.outShape,e.dtype))):(i=new JN(r),this.compileAndRun(i,[e,t]))},n.prototype.depthwiseConv2DDerInput=function(e,t,r){var i=new XN(r);return this.compileAndRun(i,[e,t])},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){var i=new $N(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3d=function(e,t,r){var i=new KN(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerInput=function(e,t,r){var i=new qN(r);return this.compileAndRun(i,[e,t])},n.prototype.conv3dDerFilter=function(e,t,r){var i=new jN(r);return this.compileAndRun(i,[e,t])},n.prototype.maxPool=function(e,t){var r=new My(t,"max",!1),i=this.makeOutputArray(r.outputShape,e.dtype);return this.compileAndRun(r,[e],i)},n.prototype.avgPool=function(e,t){var r=new My(t,"avg",!1),i=this.makeOutputArray(r.outputShape,"float32");return this.compileAndRun(r,[e],i)},n.prototype.maxPoolBackprop=function(e,t,r,i){var o=new My(i,"max",!0),a=this.compileAndRun(o,[t]),s=new LP(i),u=this.makeOutputArray(s.outputShape,t.dtype),l=this.compileAndRun(s,[e,a],u);return a.dispose(),l},n.prototype.avgPoolBackprop=function(e,t,r){var i=new NN(r),o=this.makeOutputArray(i.outputShape,t.dtype);return this.compileAndRun(i,[e],o)},n.prototype.cast=function(e,t){return KC(e,t,this)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],i=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(i[o++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(r);for(a=0;a<l.length;a++)s[t]=a,l[a]=this.slice(e,s,u).reshape(i);return l},n.prototype.reshape=function(e,t){var r=this.texData.get(e.dataId);return!r.isPacked||np(e.shape,t)||r.texture!==null&&np(r.shape,t)?Jb(e,t):this.packedReshape(e,t)},n.prototype.resizeBilinear=function(e,t,r,i){var o=be.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new $P(e.shape,t,r,i):new qP(e.shape,t,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeBilinearBackprop=function(e,t,r){var i=new jP(e,t,r);return this.compileAndRun(i,[e])},n.prototype.resizeNearestNeighbor=function(e,t,r,i){var o=new YP(e.shape,t,r,i);return this.compileAndRun(o,[e])},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){var i=new XP(e,t,r);return this.compileAndRun(i,[e])},n.prototype.multinomial=function(e,t,r,i){var o=t?e:iu(e),a=o.shape[0],s=o.shape[1],u=new BP(a,s,r),l=this.makeOutputArray(u.outputShape,"int32"),c=u.getCustomSetupFunc(i);return this.compileAndRun(u,[o],l,c)},n.prototype.oneHot=function(e,t,r,i){var o=new UP(e.size,t,r,i);return this.compileAndRun(o,[e])},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return Yb("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),xw(e.dataSync(),t.dataSync(),r,i,o)},n.prototype.cropAndResize=function(e,t,r,i,o,a){var s=new ZN(e.shape,t.shape,i,o,a);return this.compileAndRun(s,[e,t,r])},n.prototype.depthToSpace=function(e,t,r){ee(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var i=e.shape[0],o=r==="NHWC"?e.shape[1]:e.shape[2],a=r==="NHWC"?e.shape[2]:e.shape[3],s=r==="NHWC"?e.shape[3]:e.shape[1],u=o*t,l=a*t,c=s/(t*t),h=new rP(r==="NHWC"?[i,u,l,c]:[i,c,u,l],t,r);return this.compileAndRun(h,[e])},n.prototype.split=function(e,t,r){return QC(e,t,r)},n.prototype.scatterND=function(e,t,r){var i=dm(0,e,r),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=[l/s,s],h=e.reshape([a,o]),f=t.reshape([a,s]);if(l===0)return Jb(di([]),r);var m=dt(0),g=new fS(a,o,h.rank,f.rank,u,c);return this.compileAndRun(g,[f,h,m]).reshape(r)},n.prototype.sparseToDense=function(e,t,r,i){var o=dm(0,e,r),a=o.sliceRank,s=o.numUpdates,u=o.strides,l=o.outputSize,c=new fS(s,a,e.rank,t.rank,u,[l,1],!1);return this.compileAndRun(c,[t,e,i]).reshape(r)},n.prototype.fft=function(e){return this.fftImpl(e,!1)},n.prototype.ifft=function(e){return this.fftImpl(e,!0)},n.prototype.fftImpl=function(e,t){var r=this.texData.get(e.dataId),i=new hS(uP,e.shape,t),o=new hS(lP,e.shape,t),a=[this.makeComplexComponentTensorHandle(e,r.complexTensors.real),this.makeComplexComponentTensorHandle(e,r.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),l=this.complex(s,u).as2D(e.shape[0],e.shape[1]);return s.dispose(),u.dispose(),l},n.prototype.gatherND=function(e,t){var r=t.shape,i=r[r.length-1],o=jC(e,t),a=o[0],s=o[1],u=o[2],l=o[3],c=t.reshape([s,i]),h=e.reshape([e.size/u,u]),f=new pP(i,l,[s,u]);return this.compileAndRun(f,[h,c]).reshape(a)},n.prototype.fill=function(e,t,r){if((r=r||dd(t))==="string"){var i=im(r,Pt(e));return i.fill(t),at.make(e,{values:i},r)}var o=new cP(e,t),a=o.getCustomSetupFunc(t),s=this.makeOutputArray(e,r);return this.compileAndRun(o,[],s,a)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},n.prototype.linspace=function(e,t,r){return JC(e,t,r)},n.prototype.makeOutputArray=function(e,t){return at.make(e,{},t,this)},n.prototype.makePackedTensor=function(e,t){var r=at.make(e,{},t,this);return this.texData.get(r.dataId).isPacked=!0,r},n.prototype.unpackTensor=function(e){var t=new mF(e.shape);return this.compileAndRun(t,[e],at.make(t.outputShape,{},e.dtype,this))},n.prototype.packTensor=function(e){var t=new zP(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype),null,!0)},n.prototype.packedReshape=function(e,t){var r=e.reshape([am(e.shape)].concat(sm(e.shape))),i=[am(t)].concat(sm(t)),o=new VP(i,r.shape);return this.compileAndRun(o,[r]).reshape(t)},n.prototype.decode=function(e){var t,r=this.texData.get(e),i=r.isPacked,o=r.shape,a=r.dtype,s=_y(o),u=Cy(o),l=this.makeTensorHandle(o,"float32");return this.texData.get(l.dataId).isPacked=!0,this.texData.get(l.dataId).dtype=a,this.texData.get(l.dataId).texShape=u.map(function(c){return 2*c}),t=i?new nP(s,u):new tP(s,u),this.compileAndRun(t,[{shape:s,dtype:a,dataId:e}],l,null,!0),l},n.prototype.compileAndRun=function(e,t,r,i,o){var a=this;if(o===void 0&&(o=!1),r==null&&(r=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),r.size===0)return this.texData.get(r.dataId).values=Hb(r.dtype,0),r;var s=t.map(function(m){if(m.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var g=a.texData.get(m.dataId);if(g.texture==null){if(!e.usesPackedTextures&&Pt(m.shape)<=be.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:m.shape,texData:null,isUniform:!0,uniformValues:g.values};e.usesPackedTextures&&(g.isPacked=!0,g.shape=m.shape)}else if(!!g.isPacked!=!!e.usesPackedTextures)m=g.isPacked?a.unpackTensor(m):a.packTensor(m),g=a.texData.get(m.dataId);else if(g.isPacked&&!np(g.shape,m.shape)){var w=m,v=m.shape;m.shape=g.shape,m=a.packedReshape(m,v),g=a.texData.get(m.dataId),w.shape=v}return a.uploadToGPU(m.dataId),{shape:m.shape,texData:g,isUniform:!1}});this.uploadToGPU(r.dataId);var u,l={shape:r.shape,texData:this.texData.get(r.dataId),isUniform:!1},c=(function(m,g,w){var v="";g.concat(w).forEach(function(E){var _=E.texData!=null&&E.texData.slice!=null&&E.texData.slice.flatOffset>0,k=E.isUniform?"uniform":E.texData.texShape;v+=E.shape+"_"+k+"_"+_});var y=m.userCode,x=m.constructor.name;return x+="_"+v+"_"+y})(e,s,l),h=this.getAndSaveBinary(c,function(){return(function(m,g,w,v){var y=g.userCode,x=w.map(function(O,V){var F={logicalShape:O.shape,texShape:O.isUniform?null:O.texData.texShape,isUniform:O.isUniform,isPacked:!O.isUniform&&O.texData.isPacked,flatOffset:null};return O.texData!=null&&O.texData.slice!=null&&O.texData.slice.flatOffset>0&&(F.flatOffset=O.texData.slice.flatOffset),{name:g.variableNames[V],shapeInfo:F}}),E=x.map(function(O){return O.shapeInfo}),_={logicalShape:v.shape,texShape:v.texData.texShape,isUniform:!1,isPacked:v.texData.isPacked,flatOffset:null},k=TN(x,_,y,g.usesPackedTextures),C=m.createProgram(k),A=null,I=m.getUniformLocation(C,"NAN",!1);be.getNumber("WEBGL_VERSION")===1&&(A=m.getUniformLocation(C,"INFINITY",!1));for(var T={},R=0;R<g.variableNames.length;R++){var N=g.variableNames[R];T[N]=m.getUniformLocation(C,N,!1),T["offset"+N]=m.getUniformLocation(C,"offset"+N,!1)}return{program:g,source:k,webGLProgram:C,uniformLocations:T,inShapeInfos:E,outShapeInfo:_,infLoc:A,nanLoc:I}})(a.gpgpu,e,s,l)}),f=this.activeTimers!=null;return f&&(u=this.startTimer()),(function(m,g,w,v,y){dS(g.inShapeInfos,w),dS([g.outShapeInfo],[v]);var x=v.texData.texture,E=v.texData.texShape;v.texData.isPacked?m.setOutputPackedMatrixTexture(x,E[0],E[1]):m.setOutputMatrixTexture(x,E[0],E[1]),m.setProgram(g.webGLProgram),be.getNumber("WEBGL_VERSION")===1&&g.infLoc!==null&&m.gl.uniform1f(g.infLoc,1/0),g.nanLoc!==null&&m.gl.uniform1f(g.nanLoc,NaN),w.forEach(function(_,k){var C=g.program.variableNames[k],A=g.uniformLocations[C],I=g.uniformLocations["offset"+C];if(A!=null)if(_.isUniform)if(Pt(_.shape)<2)m.gl.uniform1f(A,_.uniformValues[0]);else{var T=_.uniformValues;T instanceof Float32Array||(T=new Float32Array(T)),m.gl.uniform1fv(A,T)}else _.texData.slice!=null&&I!=null&&m.gl.uniform1i(I,_.texData.slice.flatOffset),m.setInputMatrixTexture(_.texData.texture,A,k)}),y?.(m,g.webGLProgram),m.executeProgram()})(this.gpgpu,h,s,l,i),f&&(u=this.endTimer(u),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(u)})),!be.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(r.dataId).isPacked&&o===!1?this.unpackTensor(r):r},n.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},n.prototype.getTextureManager=function(){return this.textureManager},n.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas!=null&&this.canvas.remove!=null?this.canvas.remove():this.canvas=null,this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},n.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=At(function(){var t=be.getBool("DEBUG");be.set("DEBUG",!1);var r=e.abs(dt(1e-8)).dataSync()[0];return be.set("DEBUG",t),r>0?32:16})),this.floatPrecisionValue},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.uploadToGPU=function(e){var t,r=this.texData.get(e),i=r.shape,o=r.dtype,a=r.values,s=r.texture,u=r.usage,l=r.isPacked;if(s==null){var c,h=this.activeTimers!=null;h&&(c=performance.now());var f=r.texShape;if(f==null&&(f=ID(i,l),r.texShape=f),a!=null){var m=_y(i),g=void 0,w=f[1],v=f[0],y=a instanceof Uint8Array;l?(w=(t=bd(f[0],f[1]))[0],v=t[1],g=new sP(m,[v,w],y)):g=new aP(m,[v,w],y);var x=this.makeTensorHandle([v,w],o);this.texData.get(x.dataId).usage=y?To.PIXELS:To.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),w,v,a);var E=this.makeTensorHandle(g.outputShape,x.dtype);E.size=Pt(g.outputShape),this.texData.get(E.dataId).isPacked=l,this.compileAndRun(g,[x],E);var _=this.texData.get(E.dataId);r.texture=_.texture,r.texShape=_.texShape,r.isPacked=_.isPacked,r.usage=_.usage,this.disposeData(x.dataId),this.texData.delete(E.dataId),r.values=null,h&&(this.uploadWaitMs+=performance.now()-c)}else{var k=this.acquireTexture(f,u,o,l);r.texture=k}}},n.prototype.convertAndCacheOnCPU=function(e,t){var r=this.texData.get(e),i=r.dtype;return this.releaseGPUData(e),t!=null&&(r.values=(function(o,a){if(a==="float32"||a==="complex64")return o;if(a==="int32"||a==="bool"){for(var s=a==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<s.length;++u)s[u]=Math.round(o[u]);return s}throw new Error("Unknown dtype "+a)})(t,i)),r.values},n.prototype.acquireTexture=function(e,t,r,i){if(this.numBytesInGPU+=this.computeBytes(e,r),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,i)},n.prototype.computeBytes=function(e,t){return e[0]*e[1]*xC(t)},n})();IC()&&ve.registerBackend("webgl",function(){return new vF},2);var yF=ue({abs_:function(n){var e=J(n,"x","abs");return e.dtype==="complex64"?ve.runKernel(function(t){return t.complexAbs(e)},{$x:e}):ve.runKernel(function(t,r){var i=t.abs(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.toFloat().step(-1))}}})}}),bF=ue({acos_:function(n){var e=J(n,"x","acos");return ve.runKernel(function(t,r){var i=t.acos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(dt(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),wF=ue({acosh_:function(n){var e=J(n,"x","acosh");return ve.runKernel(function(t,r){var i=t.acosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),_F=ue({asin_:function(n){var e=J(n,"x","asin");return ve.runKernel(function(t,r){var i=t.asin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(dt(1).sub(i.toFloat().square()).sqrt())}}})}}),xF=ue({asinh_:function(n){var e=J(n,"x","asinh");return ve.runKernel(function(t,r){var i=t.asinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.divStrict(dt(1).add(i.toFloat().square()).sqrt())}}})}}),SF=ue({atan_:function(n){var e=J(n,"x","atan");return ve.runKernel(function(t,r){var i=t.atan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),EF=ue({atanh_:function(n){var e=J(n,"x","atanh");return ve.runKernel(function(t,r){var i=t.atanh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(dt(1).sub(i.toFloat().square()))}}})}}),kF=ue({ceil_:function(n){var e=J(n,"x","ceil");return ve.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),Tw=ue({clipByValue_:function(n,e,t){var r=J(n,"x","clipByValue");return ee(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),ve.runKernel(function(i,o){var a=i.clip(r,e,t);return o([r]),a},{$x:r},function(i,o){var a=o[0];return{$x:function(){return i.where(a.greaterEqual(e).logicalAnd(a.lessEqual(t)),pn(i))}}})}}),CF=ue({cos_:function(n){var e=J(n,"x","cos");return ve.runKernel(function(t,r){var i=t.cos(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sin().neg().mul(t)}}})}}),TF=ue({cosh_:function(n){var e=J(n,"x","cosh");return ve.runKernel(function(t,r){var i=t.cosh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),MF=ue({erf_:function(n){var e=J(n,"x","erf");return ee(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),ve.runKernel(function(t,r){var i=t.erf(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),Zb=ue({exp_:function(n){var e=J(n,"x","exp");return ve.runKernel(function(t,r){var i=t.exp(e);return r([i]),i},{$x:e},function(t,r){return{$x:function(){return t.mulStrict(r[0])}}})}}),RF=ue({expm1_:function(n){var e=J(n,"x","expm1");return ve.runKernel(function(t,r){var i=t.expm1(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}})}}),AF=ue({floor_:function(n){var e=J(n,"x","floor");return ve.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),IF=ue({log_:function(n){var e=J(n,"x","log");return ve.runKernel(function(t,r){var i=t.log(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat())}}})}}),DF=ue({log1p_:function(n){var e=J(n,"x","log1p");return ve.runKernel(function(t,r){var i=t.log1p(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}})}}),NF=ue({logSigmoid_:function(n){var e=J(n,"x","logSigmoid");return ve.runKernel(function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),mm=ue({neg_:function(n){var e=J(n,"x","neg");return ve.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),PF=ue({reciprocal_:function(n){var e=J(n,"x","reciprocal");return ve.runKernel(function(t,r){var i=t.reciprocal(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}})}}),FF=ue({round_:function(n){var e=J(n,"x","round");return ve.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),iT=ue({rsqrt_:function(n){var e=J(n,"x","rsqrt");return ve.runKernel(function(t,r){var i=t.rsqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.pow(1.5).mul(2)).neg()}}})}}),oT=ue({sigmoid_:function(n){var e=J(n,"x","sigmoid");return ve.runKernel(function(t,r){var i=t.sigmoid(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.mul(dt(1).sub(i)))}}})}}),OF=ue({sign_:function(n){var e=J(n,"x","sign");return ve.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),LF=ue({isNaN_:function(n){var e=J(n,"x","isNaN");return ve.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),BF=ue({isInf_:function(n){var e=J(n,"x","isInf");return ve.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),UF=ue({isFinite_:function(n){var e=J(n,"x","isFinite");return ve.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),zF=ue({sin_:function(n){var e=J(n,"x","sin");return ve.runKernel(function(t,r){var i=t.sin(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cos().mul(t)}}})}}),WF=ue({sinh_:function(n){var e=J(n,"x","sinh");return ve.runKernel(function(t,r){var i=t.sinh(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),HF=ue({softplus_:function(n){var e=J(n,"x","softplus");return ve.runKernel(function(t,r){var i=t.softplus(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),GF=ue({sqrt_:function(n){var e=J(n,"x","sqrt");return ve.runKernel(function(t,r){var i=t.sqrt(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),VF=ue({square_:function(n){var e=J(n,"x","square");return ve.runKernel(function(t,r){return r([e]),t.square(e)},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mul(i.toFloat().mul(2))}}})}}),jF=ue({step_:function(n,e){e===void 0&&(e=0);var t=J(n,"x","step");return ve.runKernel(function(r){return r.step(t,e)},{$x:t},function(r){return{$x:function(){return pn(r)}}})}}),qF=ue({tan_:function(n){var e=J(n,"x","tan");return ve.runKernel(function(t,r){var i=t.tan(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}})}}),$F=ue({tanh_:function(n){var e=J(n,"x","tanh");return ve.runKernel(function(t,r){var i=t.tanh(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return dt(1).sub(i.square()).mulStrict(t)}}})}});function aT(n,e,t,r,i,o){var a,s,u=J(n,"x","batchNorm"),l=J(e,"mean","batchNorm"),c=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),r!=null&&(s=J(r,"offset","batchNorm")),ee(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ee(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),ee(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&ee(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&ee(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),_d(u,l,c,s,a,o)}function sT(n,e,t,r,i,o){var a,s,u=J(n,"x","batchNorm"),l=J(e,"mean","batchNorm"),c=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),r!=null&&(s=J(r,"offset","batchNorm")),ee(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),ee(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),ee(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&ee(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&ee(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),_d(u,l,c,s,a,o)}function uT(n,e,t,r,i,o){var a,s,u=J(n,"x","batchNorm"),l=J(e,"mean","batchNorm"),c=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),r!=null&&(s=J(r,"offset","batchNorm")),ee(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),ee(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),ee(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&ee(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&ee(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),_d(u,l,c,s,a,o)}function _d(n,e,t,r,i,o){o==null&&(o=.001);var a,s,u,l=J(n,"x","batchNorm"),c=J(e,"mean","batchNorm"),h=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),r!=null&&(s=J(r,"offset","batchNorm")),ee(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),ee(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),ee(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,ve.runKernel(function(f,m){var g=f.batchNormalization(u,ip(c),ip(h),o,ip(a),ip(s));return m([l,c,h,a]),g},{$x:l,$mean:c,$variance:h,$scale:a,$offset:s},function(f,m){var g=m,w=g[0],v=g[1],y=g[2],x=g[3],E=x??dt(1),_=lr(v.shape,u.shape),k=[];if(v.rank===1){for(var C=0;C<u.shape.length-1;++C)k.push(u.shape[C]);k.push(1)}var A=w.sub(v),I=f.mul(E),T=iT(y.add(dt(o))),R=T.mul(T).mul(T).mul(dt(-.5));return{$x:function(){return v.rank===1?f.mul(yc(T.as4D(1,1,1,v.shape[0]),k)).mul(E).reshape(w.shape):f.mul(T).mul(E).reshape(w.shape)},$mean:function(){var N=T.mul(dt(-1)).mul(I);return v.rank===1&&(N=N.sum(_)),N.reshape(v.shape)},$variance:function(){var N=R.mul(A).mul(I);return v.rank===1&&(N=N.sum(_)),N.reshape(v.shape)},$scale:function(){var N=A.mul(T),O=f.mul(N);return v.rank===1&&(O=O.sum(_)),O.reshape(v.shape)},$offset:function(){var N=f;return v.rank===1&&(N=N.sum(_)),N.reshape(v.shape)}}}).reshape(l.shape)}function ip(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function Qm(){NC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var XF=ue({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Qm(),aT(n,e,t,o,i,r)}}),YF=ue({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Qm(),sT(n,e,t,o,i,r)}}),KF=ue({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Qm(),uT(n,e,t,o,i,r)}}),JF=ue({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),Qm(),_d(n,e,t,o,i,r)}}),lT=ue({batchNorm_:_d}),QF=ue({batchNorm2d_:aT}),ZF=ue({batchNorm3d_:sT}),e5=ue({batchNorm4d_:uT});function cT(n,e,t,r,i,o){ee(n.length===e.rank,function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"});var a=n,s=e,u=!1;e.rank===3&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,n[0],n[1],n[2]]);var l=a[3],c=s.shape[3];ee(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),ee(s.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),ee(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}),ee(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),ee(c===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&ee(oo(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var h=yd(a,t.shape,r,1,i,o),f=ve.runKernel(function(m,g){var w=m.conv2dDerInput(s,t,h);return g([t,s]),w},{dy4D:s,filter:t},function(m,g){var w=g[0],v=g[1];return{dy4D:function(){return Ka(m,w,r,i,"NHWC",1,o)},filter:function(){return dT(m,v,w.shape,r,i,o)}}});return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function hT(n,e,t,r,i,o){var a=n;n.rank===3&&(a=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var s=e;s.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),ee(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),ee(s.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),ee(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),ee(a.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+t[2]+"."}),ee(s.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+t[3]+")."}),o!=null&&ee(oo(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var u=yd(a.shape,t,r,1,i,o);return ve.runKernel(function(l){return l.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function Iy(n){var e=(function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o})(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}var t5=ue({conv1d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=J(n,"x","conv1d"),u=J(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),ee(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),ee(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&ee(oo(r),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),ee(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),ee(Xs(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),ee(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),m=Ka(f,h,[1,t],r,"NHWC",[1,o],a);return c?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),Ka=ue({conv2d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=J(n,"x","conv2d"),u=J(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ee(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),ee(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&ee(oo(r),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}),ee(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),ee(Xs(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),ee(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var h=yd(l.shape,u.shape,t,o,r,a),f=ve.runKernel(function(m,g){var w=m.conv2d(l,u,h);return g([u,l]),w},{x:l,$filter:u},function(m,g){var w=g,v=w[0],y=w[1];return ee(pm(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return cT(y.shape,m,v,t,r)},$filter:function(){return hT(y,m,v.shape,t,r)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),n5=ue({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=J(n,"x","conv3d"),s=J(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),ee(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),ee(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),ee(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),ee((function(f,m){return Iy(f)||Iy(m)})(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),ee(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=Sy(u.shape,s.shape,t,o,r),h=ve.runKernel(function(f,m){var g=f.conv3d(u,s,c);return m([u,s]),g},{x:u,$filter:s},function(f,m){ee(Iy(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var g=m[0],w=m[1];return{x:function(){return(function(v,y,x,E,_){ee(v.length===y.rank,function(){return"Length of inShape ("+v.length+") and rank of dy ("+y.rank+") must match"});var k=v,C=y,A=!1;y.rank===4&&(A=!0,C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),k=[1,v[0],v[1],v[2],v[3]]);var I=k[4],T=C.shape[4];ee(k.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+k.length+"."}),ee(C.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+C.rank}),ee(x.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+x.rank}),ee(I===x.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+I+") must match input depth for filter "+x.shape[3]+"."}),ee(T===x.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+T+") must match output depth for filter "+x.shape[4]+"."});var R=Sy(k,x.shape,E,1,_),N=ve.runKernel(function(O){return O.conv3dDerInput(C,x,R)},{dy5D:C});return A?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N})(g.shape,f,w,t,r)},$filter:function(){return(function(v,y,x,E,_){var k=v;v.rank===4&&(k=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var C=y;C.rank===4&&(C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),ee(k.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."}),ee(C.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),ee(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),ee(k.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+x[3]+"."}),ee(C.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+x[4]+")."});var A=Sy(k.shape,x,E,1,_);return ve.runKernel(function(I){return I.conv3dDerFilter(k,C,A)},{x5D:k,dy5D:C})})(g,f,w.shape,t,r)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),dT=ue({conv2dDerFilter_:hT}),Mw=ue({depthwiseConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]);var s=J(n,"x","depthwiseConv2d"),u=J(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),ee(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),ee(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),ee(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),ee(Xs(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&ee(oo(r),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."});var h=yd(l.shape,u.shape,t,o,r,a,!0),f=ve.runKernel(function(m,g){var w=m.depthwiseConv2D(l,u,h);return g([l,u]),w},{x:l,$filter:u},function(m,g){ee(pm(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var w=g[0],v=g[1];return{x:function(){return(function(y,x,E,_){var k=x,C=!1;x.rank===3&&(C=!0,k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var A=ve.runKernel(function(I){return I.depthwiseConv2DDerInput(k,E,_)},{dy4D:k});return C?A.as3D(A.shape[1],A.shape[2],A.shape[3]):A})(w.shape,m,v,h)},$filter:function(){return(function(y,x,E,_){var k=y;y.rank===3&&(k=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]));var C=x;return C.rank===3&&(C=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),ve.runKernel(function(A){return A.depthwiseConv2DDerFilter(k,C,_)},{x4D:k,dy4D:C})})(w,m,v.shape,h)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),fT=ue({separableConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=J(n,"x","separableConv2d"),u=J(e,"depthwiseFilter","separableConv2d"),l=J(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");ee(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),ee(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),ee(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),ee(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),ee(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],m=u.shape[3];ee(l.shape[2]===f*m,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*m+", but got "+l.shape[2]+"."});var g=Mw(c,u,r,i,a,o),w=Ka(g,l,1,"valid",a);return h?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),r5=ue({conv2dTranspose_:function(n,e,t,r,i,o){return cT(t,J(n,"x","conv2dTranspose"),J(e,"filter","conv2dTranspose"),r,i,o)}}),Rw=ue({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=J(n,"a","matMul"),a=J(e,"b","matMul");i=ur(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),f=a.shape.slice(0,-2),m=Pt(h),g=Pt(f);ee(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),ee(Gr(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),ee(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var w=o.shape.slice(0,-2).concat([l,c]),v=t?o.as3D(m,s,l):o.as3D(m,l,s),y=r?a.as3D(g,c,u):a.as3D(g,u,c);return ve.runKernel(function(x,E){var _=x.batchMatMul(v,y,t,r);return E([v,y]),_},{$a:v,$b:y},function(x,E){var _=E,k=_[0],C=_[1];return t||r?!t&&r?{$a:function(){return x.matMul(C,!1,!1)},$b:function(){return x.matMul(k,!0,!1)}}:t&&!r?{$a:function(){return C.matMul(x,!1,!0)},$b:function(){return k.matMul(x,!1,!1)}}:{$a:function(){return C.matMul(x,!0,!0)},$b:function(){return x.matMul(k,!0,!0)}}:{$a:function(){return x.matMul(C,!1,!0)},$b:function(){return k.matMul(x,!0,!1)}}}).reshape(w)}}),i5=ue({dot_:function(n,e){var t=J(n,"t1","dot"),r=J(e,"t2","dot");ee(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return ee(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),o5=ue({outerProduct_:function(n,e){var t=J(n,"v1","outerProduct"),r=J(e,"v2","outerProduct");return ee(t.rank===1&&r.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."}),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),xd=ue({reverse_:function(n,e){var t=J(n,"x","reverse");if(t.rank===0)return t.clone();var r=Mr(e,t.shape);return ve.runKernel(function(i){return i.reverse(t,r)},{$x:t},function(i){return{$x:function(){return i.reverse(r)}}}).reshapeAs(t)}}),a5=ue({reverse1d_:function(n){var e=J(n,"x","reverse");return ee(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),xd(e,0)}}),s5=ue({reverse2d_:function(n,e){var t=J(n,"x","reverse");return ee(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),xd(t,e)}}),u5=ue({reverse3d_:function(n,e){var t=J(n,"x","reverse");return ee(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),xd(t,e)}}),l5=ue({reverse4d_:function(n,e){var t=J(n,"x","reverse");return ee(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),xd(t,e)}});function pT(n,e,t,r,i,o){var a=J(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),ee(Xs(t,r),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}),o!=null&&ee(oo(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Qh(s.shape,e,t,r,i,o),c=ve.runKernel(function(h,f){var m=h.maxPool(s,l);return f([s,m]),m},{x:s},function(h,f){var m=f[0],g=f[1];return{x:function(){return(function(w,v,y,x,E,_,k,C){var A=J(w,"dy","maxPoolBackprop"),I=J(v,"input","maxPoolBackprop"),T=J(y,"output","maxPoolBackprop");ee(I.rank===A.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+A.rank+")"}),ee(Xs(E,_),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+_+"'"}),ee(A.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+A.rank+"."}),ee(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."});var R=Qh(I.shape,x,E,_,k,C);return ve.runKernel(function(N){return N.maxPoolBackprop(A,I,T,R)},{$dy:A,$input:I})})(h,m,g,e,t,r,i)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function mT(n,e,t,r,i,o){var a=J(n,"x","avgPool","float32");ee(Xs(t,r),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&ee(oo(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Qh(s.shape,e,t,r,i,o),c=ve.runKernel(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return(function(f,m,g,w,v,y){var x=J(f,"dy","avgPoolBackprop"),E=J(m,"input","avgPoolBackprop");ee(E.rank===x.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+x.rank+")"}),ee(Xs(w,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+v+"'"});var _=E,k=x,C=!1;E.rank===3&&(C=!0,_=E.as4D(1,E.shape[0],E.shape[1],E.shape[2]),k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),ee(k.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),ee(_.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var A=Qh(_.shape,g,w,v,y),I=ve.runKernel(function(T){return T.avgPoolBackprop(k,_,A)},{dy4D:k,input4D:_});return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I})(h,s,e,t,r,i)}}});return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Pc=ue({maxPool_:function(n,e,t,r,i){return pT(n,e,t,1,r,i)}}),Sd=ue({avgPool_:function(n,e,t,r,i){return mT(n,e,t,1,r,i)}}),c5=ue({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=J(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),ee(Xs(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=Qh(s.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?(function(_,k){var C=_.map(function(T,R){return T+(T-1)*(k[R]-1)}).map(function(T){return T-1}),A=C.map(function(T){return Math.floor(T/2)}),I=C.map(function(T,R){return T-A[R]});return C.map(function(T,R){return[A[R],I[R]]})})([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,m=(function(_,k,C){var A=C.map(function(F){return F[0]}),I=C.map(function(F){return F[1]}),T=_.concat(A,I),R=k.map(function(F,B){return(F-T[B]%F)%F}),N=I.map(function(F,B){return F+R[B]}),O=k.map(function(F,B){return[A[B],N[B]]}),V=k.map(function(F,B){return[0,R[B]]});return[O,V]})([c.inHeight,c.inWidth],h,l),g=m[0],w=m[1],v=f?r:"valid",y=f?s:WC(s,h,g),x=(t==="avg"?function(){return mT(y,e,o,1,v)}:function(){return pT(y,e,o,1,v)})(),E=f?x:BC(x,h,w);return u?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),ha=ue({slice_:function(n,e,t){var r,i,o=J(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice(),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(s,u){return s>=0?s:(ee(s===-1,function(){return"Bad value in size"}),o.shape[u]-r[u])}),(function(s,u,l){ee(s.rank===u.length,function(){return"Error in slice"+s.rank+"D: Length of begin "+u+" must match the rank of the array ("+s.rank+")."}),ee(s.rank===l.length,function(){return"Error in slice"+s.rank+"D: Length of size "+l+" must match the rank of the array ("+s.rank+")."});for(var c=function(f){ee(u[f]+l[f]<=s.shape[f],function(){return"Error in slice"+s.rank+"D: begin["+f+"] + size["+f+"] ("+(u[f]+l[f])+") would overflow input.shape["+f+"] ("+s.shape[f]+")"})},h=0;h<s.rank;++h)c(h)})(o,r,i);var a=o.shape;return ve.runKernel(function(s){return s.slice(o,r,i)},{$x:o},function(s){for(var u=[],l=0;l<s.rank;l++)u.push([r[l],a[l]-r[l]-i[l]]);return{$x:function(){return s.pad(u)}}})}}),h5=ue({slice1d_:function(n,e,t){var r=J(n,"x","slice1d");return ee(r.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"}),ha(r,[e],[t])}}),d5=ue({slice2d_:function(n,e,t){var r=J(n,"x","slice2d");return ee(r.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"}),ha(r,e,t)}}),gT=ue({slice3d_:function(n,e,t){var r=J(n,"x","slice3d");return ee(r.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"}),ha(r,e,t)}}),f5=ue({slice4d_:function(n,e,t){var r=J(n,"x","slice4d");return ee(r.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"}),ha(r,e,t)}});function vT(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(ao(e.shape,r))),n.rank<t.rank&&(n=n.reshape(ao(n.shape,r))),{$x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var p5=ue({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","all","bool"),i=Mr(e,r.shape),o=i,a=ma(o,r.rank);a!=null&&(r=r.transpose(a),o=ga(o.length,r.rank));var s=ve.runKernel(function(l){return l.all(r,o)},{$x:r});if(t){var u=ao(s.shape,i);return s.reshape(u)}return s}}),m5=ue({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","any","bool"),i=Mr(e,r.shape),o=i,a=ma(o,r.rank);a!=null&&(r=r.transpose(a),o=ga(o.length,r.rank));var s=ve.runKernel(function(l){return l.any(r,o)},{$x:r});if(t){var u=ao(s.shape,i);return s.reshape(u)}return s}}),g5=ue({argMax_:function(n,e){e===void 0&&(e=0);var t=J(n,"x","argMax");e==null&&(e=0);var r=Mr(e,t.shape),i=ma(r,t.rank);return i!=null&&(t=t.transpose(i),r=ga(r.length,t.rank)),ve.runKernel(function(o,a){var s=o.argMax(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return pn(s)}}})}}),v5=ue({argMin_:function(n,e){e===void 0&&(e=0);var t=J(n,"x","argMin");e==null&&(e=0);var r=Mr(e,t.shape),i=ma(r,t.rank);return i!=null&&(t=t.transpose(i),r=ga(r.length,t.rank)),ve.runKernel(function(o,a){var s=o.argMin(t,r[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return pn(s)}}})}}),y5=ue({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","logSumExp"),i=Mr(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=ao(s.shape,i);return s.reshape(u)}return s}}),Zm=ue({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","max"),i=r,o=Mr(e,r.shape),a=o,s=ma(a,r.rank);s!=null&&(r=r.transpose(s),a=ga(a.length,r.rank));var u=ve.runKernel(function(c,h){var f=c.max(r,a);return h([i,f]),f},{$x:r},function(c,h){return vT(c,h[1],h[0],o,s)});if(t){var l=ao(u.shape,o);u=u.reshape(l)}return u}}),b5=ue({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","mean"),i=Mr(e,r.shape),o=Pt(Lr(r.shape,i)[1]);return vd(function(a){var s=dt(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Xc(a.shape,"float32")).div(o)}}})(r)}}),w5=ue({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","min"),i=r,o=Mr(e,r.shape),a=o,s=ma(a,r.rank);s!=null&&(r=r.transpose(s),a=ga(a.length,r.rank));var u=ve.runKernel(function(c,h){var f=c.min(r,a);return h([i,f]),f},{$x:r},function(c,h){return vT(c,h[1],h[0],o,s)});if(t){var l=ao(u.shape,o);u=u.reshape(l)}return u}}),_5=ue({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=Mr(e,(n=J(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=ao(i.shape,r));var a=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,t)}}}),yT=ue({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=Mr(e,r.shape);return vd(function(o){var a=ma(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=ga(s.length,o.rank));var l=ve.runKernel(function(h){return h.sum(u,s)},{permutedX:u});if(t){var c=ao(l.shape,i);l=l.reshape(c)}return{value:l,gradFunc:function(h){var f=o.shape.slice();return i.forEach(function(m){f[m]=1}),h.reshape(f).mul(Xc(o.shape,"float32"))}}})(r)}}),x5=ue({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=J(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=Mr(e,r.shape),o=ma(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=ga(a.length,r.rank));var u=ve.runKernel(function(c){return c.prod(s,a)},{permutedX:s});if(t){var l=ao(u.shape,i);u=u.reshape(l)}return u}}),bT=ue({equal_:function(n,e){var t,r=J(n,"a","equal"),i=J(e,"b","equal");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o){return o.equal(r,i)},{$a:r,$b:i})}}),S5=ue({equalStrict_:function(n,e){var t=J(n,"a","equalStrict"),r=J(e,"b","equalStrict");return Rn(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),E5=ue({greater_:function(n,e){var t,r=J(n,"a","greater"),i=J(e,"b","greater");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o){return o.greater(r,i)},{$a:r,$b:i})}}),wT=ue({greaterEqual_:function(n,e){var t,r=J(n,"a","greaterEqual"),i=J(e,"b","greaterEqual");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return pn(s)},$b:function(){return pn(u)}}})}}),k5=ue({greaterEqualStrict_:function(n,e){var t=J(n,"a","greaterEqualStrict"),r=J(e,"b","greaterEqualStrict");return Rn(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),C5=ue({greaterStrict_:function(n,e){var t=J(n,"a","greaterStrict"),r=J(e,"b","greaterStrict");return Rn(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),T5=ue({less_:function(n,e){var t,r=J(n,"a","less"),i=J(e,"b","less");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o){return o.less(r,i)},{$a:r,$b:i})}}),M5=ue({lessEqual_:function(n,e){var t,r=J(n,"a","lessEqual"),i=J(e,"b","lessEqual");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o){return o.lessEqual(r,i)},{$a:r,$b:i})}}),R5=ue({lessEqualStrict_:function(n,e){var t=J(n,"a","lessEqualStrict"),r=J(e,"b","lessEqualStrict");return Rn(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),A5=ue({lessStrict_:function(n,e){var t=J(n,"a","lessStrict"),r=J(e,"b","lessStrict");return Rn(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),I5=ue({notEqual_:function(n,e){var t,r=J(n,"a","notEqual"),i=J(e,"b","notEqual");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o){return o.notEqual(r,i)},{$a:r,$b:i})}}),D5=ue({notEqualStrict_:function(n,e){var t=J(n,"a","notEqualStrict"),r=J(e,"b","notEqualStrict");return Rn(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}}),wn=ue({add_:function(n,e){var t,r=J(n,"a","add"),i=J(e,"b","add");t=ur(r,i),r=t[0],i=t[1];var o=cn(r.shape,i.shape);return ve.runKernel(function(a){return a.add(r,i)},{$a:r,$b:i},function(a){return{$a:function(){var s=a,u=lr(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=a,u=lr(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}})}}),N5=ue({addN_:function(n){ee(Array.isArray(n),function(){return"The argument passed to tf.addN() must be a list of tensors"}),ee(n.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length});var e=n.map(function(i,o){return J(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Gr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var r=e;return ve.runKernel(function(i){return i.addN(e)},r,function(i){var o={};return e.forEach(function(a,s){o[s]=function(){return i.clone()}}),o})}}),P5=ue({addStrict_:function(n,e){var t=J(n,"a","addStrict"),r=J(e,"b","addStrict");return Rn(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),F5=ue({atan2_:function(n,e){var t,r=J(n,"a","atan2"),i=J(e,"b","atan2");t=ur(r,i),r=t[0],i=t[1];var o=cn(r.shape,i.shape);return ve.runKernel(function(a,s){var u=a.atan2(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=wn(u.square(),l.square()),h=a.mul(l.div(c)),f=lr(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=wn(u.square(),l.square()),h=mm(a.mul(u.div(c))),f=lr(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),Zo=ue({div_:function(n,e){var t,r=J(n,"a","div"),i=J(e,"b","div");if(t=ur(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return _T(r,i);var o=cn(r.shape,i.shape);return ve.runKernel(function(a,s){var u=a.realDivide(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.div(l.toFloat()),h=lr(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=lr(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}})}}),O5=ue({divStrict_:function(n,e){var t=J(n,"a","div"),r=J(e,"b","div");return Rn(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),_T=ue({floorDiv_:function(n,e){var t,r=J(n,"a","floorDiv"),i=J(e,"b","floorDiv");t=ur(r,i),r=t[0],i=t[1];var o=cn(r.shape,i.shape);return ve.runKernel(function(a,s){var u=a.floorDiv(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.div(l.toFloat()),h=lr(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=lr(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}})}}),Aw=ue({maximum_:function(n,e){var t,r=J(n,"a","maximum"),i=J(e,"b","maximum");return t=ur(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),cn(r.shape,i.shape),ve.runKernel(function(o,a){var s=o.maximum(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.greaterEqual(u).toFloat())},$b:function(){return o.mul(s.less(u).toFloat())}}})}}),L5=ue({maximumStrict_:function(n,e){var t=J(n,"a","maximumStrict"),r=J(e,"b","maximumStrict");return Rn(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),xT=ue({minimum_:function(n,e){var t,r=J(n,"a","minimum"),i=J(e,"b","minimum");return t=ur(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),cn(r.shape,i.shape),ve.runKernel(function(o,a){var s=o.minimum(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.lessEqual(u).toFloat())},$b:function(){return o.mul(s.greater(u).toFloat())}}})}}),B5=ue({minimumStrict_:function(n,e){var t=J(n,"a","minimumStrict"),r=J(e,"b","minimumStrict");return Rn(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),U5=ue({mod_:function(n,e){var t,r=J(n,"a","mod"),i=J(e,"b","mod");t=ur(r,i),r=t[0],i=t[1];var o=cn(r.shape,i.shape);return ve.runKernel(function(a,s){var u=a.mod(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=lr(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=lr(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),z5=ue({modStrict_:function(n,e){var t=J(n,"a","modStrict"),r=J(e,"b","modStrict");return Rn(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),Ua=ue({mul_:function(n,e){var t,r=J(n,"a","mul"),i=J(e,"b","mul");t=ur(r,i),r=t[0],i=t[1];var o=cn(r.shape,i.shape);return ve.runKernel(function(a,s){var u=a.multiply(r,i);return s([r,i]),u},{$a:r,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.mul(l.toFloat()),h=lr(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=lr(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),W5=ue({mulStrict_:function(n,e){var t=J(n,"a","mul"),r=J(e,"b","mul");return Rn(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),gm=ue({pow_:function(n,e){var t=J(n,"base","pow"),r=J(e,"exp","pow"),i=cn(t.shape,r.shape);return n=t.cast(or(t.dtype,r.dtype)),e=r.cast(or(t.dtype,r.dtype)),ve.runKernel(function(o,a){var s=o.pow(t,r);return a([t,r,s]),s},{$base:t,$exp:r},function(o,a){var s=a[0],u=a[1],l=a[2];return{$base:function(){var c=u.toFloat(),h=o.mul(c.mul(s.pow(c.sub(dt(1))))),f=lr(s.shape,i);return f.length>0&&(h=h.sum(f)),h.reshape(s.shape)},$exp:function(){var c=s.greater(0),h=s.log().where(c,pn(s)),f=o.mul(l.mul(h)),m=lr(u.shape,i);return m.length>0&&(f=f.sum(m)),f.reshape(u.shape)}}})}}),H5=ue({powStrict_:function(n,e){return Rn(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),G5=ue({squaredDifference_:function(n,e){var t,r=J(n,"a","squaredDifference"),i=J(e,"b","squaredDifference");return t=ur(r,i),r=t[0],i=t[1],cn(r.shape,i.shape),ve.runKernel(function(o,a){var s=o.squaredDifference(r,i);return a([r,i]),s},{$a:r,$b:i},function(o,a){var s=a[0],u=a[1],l=dt(2);return{$a:function(){return o.mul(s.sub(u).mul(l))},$b:function(){return o.mul(u.sub(s).mul(l))}}})}}),V5=ue({squaredDifferenceStrict_:function(n,e){var t=J(n,"a","squaredDifferenceStrict"),r=J(e,"b","squaredDifferenceStrict");return Rn(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),_i=ue({sub_:function(n,e){var t,r=J(n,"a","sub"),i=J(e,"b","sub");t=ur(r,i),r=t[0],i=t[1];var o=cn(r.shape,i.shape);return ve.runKernel(function(a){return a.subtract(r,i)},{$a:r,$b:i},function(a){return{$a:function(){var s=a,u=lr(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},$b:function(){var s=a,u=lr(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}})}}),j5=ue({subStrict_:function(n,e){var t=J(n,"a","subStrict"),r=J(e,"b","subStrict");return Rn(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Iw=ue({logicalAnd_:function(n,e){var t=J(n,"a","logicalAnd","bool"),r=J(e,"b","logicalAnd","bool");return cn(t.shape,r.shape),ve.runKernel(function(i){return i.logicalAnd(t,r)},{$a:t,$b:r})}}),q5=ue({logicalNot_:function(n){var e=J(n,"x","logicalNot","bool");return ve.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),ST=ue({logicalOr_:function(n,e){var t=J(n,"a","logicalOr","bool"),r=J(e,"b","logicalOr","bool");return cn(t.shape,r.shape),ve.runKernel(function(i){return i.logicalOr(t,r)},{$a:t,$b:r})}}),$5=ue({logicalXor_:function(n,e){var t=J(n,"a","logicalXor","bool"),r=J(e,"b","logicalXor","bool");return cn(t.shape,r.shape),ST(n,e).logicalAnd(Iw(n,e).logicalNot())}}),Zh=ue({where_:function(n,e,t){var r=J(e,"a","where"),i=J(t,"b","where"),o=J(n,"condition","where","bool");return Rn(r.shape,i.shape,"Error in where: "),o.rank===1?ee(o.shape[0]===r.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):Rn(o.shape,i.shape,"Error in where: "),ve.runKernel(function(a,s){var u=a.select(o,r,i);return s([o]),u},{$condition:o,$a:r,$b:i},function(a,s){var u=s[0];return{$condition:function(){return pn(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),X5=function(n){return Gt(this,void 0,void 0,function(){var e,t,r;return Vt(this,function(i){switch(i.label){case 0:return[4,(e=J(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Sw(e.shape,t),n!==e&&e.dispose(),[2,r]}})})},Y5=ue({elu_:function(n){var e=J(n,"x","elu");return ve.runKernel(function(t,r){var i=t.elu(e);return r([i]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return ve.runKernel(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),K5=ue({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=J(n,"x","leakyRelu");return Aw(dt(e).mul(t),t)}}),J5=ue({prelu_:function(n,e){var t=J(n,"x","prelu"),r=J(e,"alpha","prelu");return ve.runKernel(function(i,o){var a=i.prelu(t,r);return o([t,r]),a},{$x:t,$alpha:r},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{$x:function(){return Zh(u,i,i.mul(s))},$alpha:function(){var l=Zh(u,pn(i),i.mul(a)),c=lr(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}})}}),er=ue({relu_:function(n){var e=J(n,"x","relu");return e.dtype==="bool"?e.toInt():ve.runKernel(function(t,r){var i=t.relu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){return t.mulStrict(i.step().toFloat())}}})}}),Q5=ue({selu_:function(n){var e=J(n,"x","selu");return ve.runKernel(function(t,r){var i=t.selu(e);return r([e]),i},{$x:e},function(t,r){var i=r[0];return{$x:function(){var o=i.greater(dt(0)),a=dt(kw),s=dt(Cw),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return Zh(o,u,l)}}})}}),Ys=ue({transpose_:function(n,e){var t=J(n,"x","transpose");return e==null&&(e=t.shape.map(function(r,i){return i}).reverse()),ee(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(r){ee(r>=0&&r<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():ve.runKernel(function(r){return r.transpose(t,e)},{$x:t},function(r){var i=vw(e);return{$x:function(){return r.transpose(i)}}})}}),Z5=ue({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=J(n,"x","localResponseNormalization");ee(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),ee(oo(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=ve.runKernel(function(l,c){var h=l.localResponseNormalization4D(a,e,t,r,i);return c([a,h]),h},{x4D:a},function(l,c){var h=c[0],f=c[1];return{x4D:function(){return ve.runKernel(function(m){return m.LRNGrad(l,h,f,e,t,r,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),ET=ue({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=(function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(dt(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)})(n=J(n,"x","norm"),e,t),o=i.shape;if(r){var a=Mr(t,n.shape);o=ao(i.shape,a)}return i.reshape(o)}});function bS(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function wS(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var kT=ue({gather_:function(n,e,t){t===void 0&&(t=0);var r=J(n,"x","gather"),i=J(e,"indices","gather","int32");t=Mr(t,r.shape)[0];var o=(function(a,s,u){for(var l=a.shape[u],c=[],h=1,f=1,m=0;m<u;m++)c.push(a.shape[m]),h*=a.shape[m];for(m=0;m<s.rank;m++)c.push(s.shape[m]);for(m=u+1;m<a.rank;m++)c.push(a.shape[m]),f*=a.shape[m];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}})(r,i,t);return ve.runKernel(function(a,s){var u=a.gather(r,i.flatten(),t);return s([i]),u},{$x:r},function(a,s){var u=s[0];return{$x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),f=h.length,m=l.slice(t,l.length).slice(1),g=m.length,w=bS(0,f),v=bS(f+1,f+1+g),y=wS([h,[c],m]),x=a.reshape(y),E=u.reshape([c]),_=wS([[f],w,v]),k=x.transpose(_),C=CT(k,E,r.shape[t]),A=vw(_);return C=C.transpose(A)}}}).reshape(o.outputShape)}}),CT=ue({unsortedSegmentSum_:function(n,e,t){var r=J(n,"x","unsortedSegmentSum"),i=J(e,"segmentIds","unsortedSegmentSum","int32");return ee(oo(t),function(){return"numSegments must be of dtype int"}),ve.runKernel(function(o,a){var s=o.unsortedSegmentSum(r,i,t);return a([i]),s},{$x:r},function(o,a){var s=a[0];return{$x:function(){return(function(u,l){for(var c=Aw(l,pn(l)),h=kT(u,c),f=wT(l,dt(0,"int32")),m=h.rank-f.rank,g=0;g<m;++g)f=Zi(f,g+1);f=Iw(f,Xc(h.shape,"bool"));var w=pn(h);return Zh(f,h,w)})(o,s)}}})}}),eO=ue({basicLSTMCell_:function(n,e,t,r,i,o){var a=J(n,"forgetBias","basicLSTMCell"),s=J(e,"lstmKernel","basicLSTMCell"),u=J(t,"lstmBias","basicLSTMCell"),l=J(r,"data","basicLSTMCell"),c=J(i,"c","basicLSTMCell"),h=J(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(s).add(u),m=f.shape[0],g=f.shape[1]/4,w=[m,g],v=f.slice([0,0],w),y=f.slice([0,g],w),x=f.slice([0,2*g],w),E=f.slice([0,3*g],w),_=v.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid())),k=_.tanh().mulStrict(E.sigmoid());return[_,k]}}),tO=ue({multiRNNCell_:function(n,e,t,r){for(var i=J(e,"data","multiRNNCell"),o=um(t,"c","multiRNNCell"),a=um(r,"h","multiRNNCell"),s=i,u=[],l=0;l<n.length;l++){var c=n[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),nO=ue({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=J(n,"v","movingAverage"),a=J(e,"x","movingAverage"),s=J(t,"decay","movingAverage");uD(o,a),ee(Gr(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=dt(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){ee(r!=null,function(){return"When using zeroDebias: true, step is required."});var h=J(r,"step","movingAverage");c=c.div(u.sub(gm(s,h)))}return o.add(c)}}),rO=ue({stridedSlice_:function(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),a!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");var l=J(n,"x","stridedSlice");if(r.every(function(w){return w===1})){var c=_w(l.shape,e,t,r,i,o,a,s,u),h=c[0],f=c[1],m=c[2],g=f.filter(function(w,v){return m.indexOf(v)===-1});return ha(l,h,f).reshape(g)}return ve.runKernel(function(w){return w.stridedSlice(l,e,t,r,i,o,a,s,u)},{$x:l})}}),iO=ue({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=J(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=ve.runKernel(function(a){return a.topk(r,e,t)},{$x:r});return{values:o[0],indices:o[1]}}}),oO=ue({scatterND_:function(n,e,t){var r=J(n,"indices","scatterND","int32"),i=J(e,"updates","scatterND");return mN(i,r,t),ve.runKernel(function(o){return o.scatterND(r,i,t)},{$indices:r,$updates:i})}}),Dw=ue({fft_:function(n){ee(n.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ve.runKernel(function(i){return i.fft(r)},{input:n}).reshape(n.shape)}}),vm=ue({ifft_:function(n){ee(n.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."});var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return ve.runKernel(function(i){return i.ifft(r)},{input:n}).reshape(n.shape)}}),TT=ue({rfft_:function(n,e){ee(n.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+n.dtype});var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map(function(y){return 0}),a=n.shape.map(function(y){return y});a[n.shape.length-1]=e,t=n.slice(o,a),r=e}else if(e!=null&&e>r){var s=n.shape.map(function(y){return y});s[n.shape.length-1]=e-r,t=n.concat(Wn(s),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=ti(t,u).as2D(i,r),c=Dw(l),h=Math.floor(r/2)+1,f=aa(c),m=zs(c),g=f.split([h,r-h],f.shape.length-1),w=m.split([h,r-h],m.shape.length-1),v=t.shape.slice();return v[t.shape.length-1]=h,ti(g[0],w[0]).reshape(v)}}),MT=ue({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=vm(r);return aa(i)}var o=[t,2*(e-1)],a=aa(n).as2D(t,e),s=zs(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(dt(-1)),c=a.concat(u,1),h=s.concat(l,1);return r=ti(c,h).as2D(o[0],o[1]),i=vm(r),aa(i)}}),aO=Object.freeze({fft:Dw,ifft:vm,rfft:TT,irfft:MT}),sO=ue({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=J(n,"sparseIndices","sparseToDense","int32"),o=J(e,"sparseValues","sparseToDense"),a=J(r,"defaultValue","sparseToDense",o.dtype);return(function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var m=u.size;if(u.rank!==0&&(u.rank!==1||m!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,o,t,a),ve.runKernel(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),uO=ue({gatherND_:function(n,e){var t=J(e,"indices","gatherND","int32"),r=J(n,"x","gatherND");return ve.runKernel(function(i){return i.gatherND(r,t)},{$x:r,$indices:t})}}),lO=ue({dropout_:function(n,e,t,r){if(t!=null&&!Gr(n.shape,t))throw new Error("Non-default noise shape is not implemented yet: "+JSON.stringify(t));var i=zC(n.shape,0,1,"float32",r).greater(e);return i=i.div(_i(1,e)),n.mul(i)}});function RT(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var a=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(a)}return fi(i,"float32")}var zr,AT=ue({hannWindow_:function(n){return RT(n,.5,.5)}}),IT=ue({hammingWindow_:function(n){return RT(n,.54,.46)}}),DT=ue({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=n.size;)a.push(ha(n,o,e)),o+=t;if(r){var s=o+e-n.size,u=Vr([ha(n,o,e-s),vc([s],i)]);a.push(u)}return a.length===0?md([],[0,e]):Vr(a).as2D(a.length,e)}}),cO=Object.freeze({hannWindow:AT,hammingWindow:IT,frame:DT});(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(zr||(zr={}));var hO=ue({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=zr.SUM_BY_NONZERO_WEIGHTS);var i=J(n,"labels","absoluteDifference"),o=J(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=J(t,"weights","absoluteDifference")),Rn(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return Ja(s,a,r)}}),Ja=ue({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=zr.SUM_BY_NONZERO_WEIGHTS);var r=J(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=J(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===zr.NONE)return o;if(t===zr.SUM)return o.sum();if(t===zr.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(dt(a)):s}if(t===zr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(dt(r.size));var u=i.mul(Xc(r.shape)).notEqual(dt(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),dO=ue({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(n,"labels","cosineDistance"),a=J(e,"predictions","cosineDistance"),s=null;r!=null&&(s=J(r,"weights","cosineDistance")),Rn(o.shape,a.shape,"Error in cosineDistance: ");var u=dt(1).sub(o.mul(a).sum(t,!0));return Ja(u,s,i)}}),fO=ue({hingeLoss_:function(n,e,t,r){r===void 0&&(r=zr.SUM_BY_NONZERO_WEIGHTS);var i=J(n,"labels","hingeLoss"),o=J(e,"predictions","hingeLoss"),a=null;t!=null&&(a=J(t,"weights","hingeLoss")),Rn(i.shape,o.shape,"Error in hingeLoss: ");var s=dt(1);i=dt(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return Ja(u,a,r)}}),pO=ue({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(n,"labels","huberLoss"),a=J(e,"predictions","huberLoss"),s=null;t!=null&&(s=J(t,"weights","huberLoss")),Rn(o.shape,a.shape,"Error in huberLoss: ");var u=dt(r),l=a.sub(o).abs(),c=xT(l,u),h=l.sub(c),f=dt(.5).mul(c.square()).add(u.mul(h));return Ja(f,s,i)}}),mO=ue({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(n,"labels","logLoss"),a=J(e,"predictions","logLoss"),s=null;t!=null&&(s=J(t,"weights","logLoss")),Rn(o.shape,a.shape,"Error in logLoss: ");var u=dt(1),l=dt(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return Ja(c,s,i)}}),gO=ue({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=zr.SUM_BY_NONZERO_WEIGHTS);var i=J(n,"labels","meanSquaredError"),o=J(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=J(t,"weights","meanSquaredError")),Rn(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return Ja(s,a,r)}}),vO=ue({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(n,"multiClassLabels","sigmoidCrossEntropy"),a=J(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=J(t,"weights","sigmoidCrossEntropy")),Rn(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=dt(r),l=dt(1),c=dt(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=(function(f,m){var g=J(f,"labels","sigmoidCrossEntropyWithLogits"),w=J(m,"logits","sigmoidCrossEntropyWithLogits");Rn(g.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=w.relu(),y=w.mul(g),x=w.abs().neg().exp().log1p();return v.sub(y).add(x)})(o,a);return Ja(h,s,i)}}),yO=ue({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(n,"onehotLabels","softmaxCrossEntropy"),a=J(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=J(t,"weights","softmaxCrossEntropy")),Rn(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=dt(r),l=dt(1),c=dt(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=(function(f,m,g){if(g===void 0&&(g=-1),g===-1&&(g=m.rank-1),g!==m.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+m.rank+" and dim was "+g);return vd(function(w,v,y){var x=v.logSumExp([g],!0),E=v.toFloat().sub(x);return y([w,E]),{value:E.mul(w).neg().sum([g]),gradFunc:function(_,k){var C=k[0],A=k[1],I=ao(_.shape,[g]);return[_.reshape(I).mul(C.toFloat().sub(A.exp())),_.reshape(I).mul(A.exp().sub(C.toFloat()))]}}})(f,m)})(o,a);return Ja(h,s,i)}}),bO=Object.freeze({get Reduction(){return zr},absoluteDifference:hO,computeWeightedLoss:Ja,cosineDistance:dO,hingeLoss:fO,huberLoss:pO,logLoss:mO,meanSquaredError:gO,sigmoidCrossEntropy:vO,softmaxCrossEntropy:yO});function _S(n,e){return e===void 0&&(e=!1),ve.tidy(function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=UC(t),o=n.clone(),a=md([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,l=function(h){var f,m=o,g=s,w=i;f=ve.tidy(function(){var v=o.slice([h,h],[t-h,1]),y=v.norm(),x=o.slice([h,h],[1,1]),E=x.sign().neg(),_=x.sub(E.mul(y)),k=v.div(_);s=k.shape[0]===1?a.clone():a.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var C=E.matMul(_).div(y).neg(),A=o.slice([h,0],[t-h,r]),I=C.mul(s);o=h===0?A.sub(I.matMul(s.transpose().matMul(A))):o.slice([0,0],[h,r]).concat(A.sub(I.matMul(s.transpose().matMul(A))),0);var T=i.slice([0,h],[t,i.shape[1]-h]);return i=h===0?T.sub(T.matMul(s).matMul(I.transpose())):i.slice([0,0],[t,h]).concat(T.sub(T.matMul(s).matMul(I.transpose())),1),[s,o,i]}),s=f[0],o=f[1],i=f[2],yi([m,g,w])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]})}var wO=ue({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,ee(n!=null&&n.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=n[0].shape[0],r=function(u){ee(n[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"})},i=1;i<n.length;++i)r(i)}else e=!0,n=bw(n,n.shape[0],0).map(function(u){return HC(u,[0])});ee(n.length<=n[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."});var o=[],a=n,s=function(u){o.push(ve.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=yT(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(ET(l,"euclidean"))}))};for(i=0;i<n.length;++i)s(i);return e?Po(o,0):o}}),_O=ue({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return _S(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce(function(a,s){return a*s}),r=Tr(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach(function(a){var s=_S(a,e),u=s[0],l=s[1];i.push(u),o.push(l)}),[Po(i,0).reshape(n.shape),Po(o,0).reshape(n.shape)]}}),xO=Object.freeze({gramSchmidt:wO,qr:_O});function NT(n,e,t,r,i){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY);var o=n.shape[0];return t=Math.min(t,o),ee(0<=r&&r<=1,function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"}),ee(n.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"}),ee(n.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]}),ee(e.rank===1,function(){return"scores must be a 1D tensor"}),ee(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i}}var SO=ue({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=J(n,"images","resizeBilinear");ee(r.rank===3||r.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."}),ee(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=ve.runKernel(function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return ve.runKernel(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),EO=ue({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=J(n,"images","resizeNearestNeighbor");ee(r.rank===3||r.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."}),ee(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),ee(r.dtype==="float32"||r.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=ve.runKernel(function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return ve.runKernel(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),kO=ue({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=J(n,"boxes","nonMaxSuppression"),a=J(e,"scores","nonMaxSuppression"),s=NT(o,a,t,r,i);return t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,ve.runKernel(function(u){return u.nonMaxSuppression(o,a,t,r,i)},{$boxes:o})}}),CO=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Gt(this,void 0,void 0,function(){var o,a,s,u,l,c;return Vt(this,function(h){switch(h.label){case 0:return o=J(n,"boxes","nonMaxSuppressionAsync"),a=J(e,"scores","nonMaxSuppressionAsync"),s=NT(o,a,t,r,i),t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,o.data()];case 1:return u=h.sent(),[4,a.data()];case 2:return l=h.sent(),c=xw(u,l,t,r,i),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,c]}})})},TO=ue({cropAndResize_:function(n,e,t,r,i,o){var a=J(n,"image","cropAndResize","float32"),s=J(e,"boxes","cropAndResize","float32"),u=J(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return ee(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),ee(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),ee(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),ee(r.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."}),ee(r[0]>=1&&r[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+r}),ee(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),ve.runKernel(function(c,h){return c.cropAndResize(a,s,u,r,i,o)},{$image:a,$boxes:s})}}),PT=Object.freeze({resizeBilinear:SO,resizeNearestNeighbor:EO,nonMaxSuppression:kO,nonMaxSuppressionAsync:CO,cropAndResize:TO}),MO=ue({matMul_:function(n,e,t,r,i,o){var a;t===void 0&&(t=!1),r===void 0&&(r=!1),o===void 0&&(o="linear");var s=J(n,"a","fused matMul"),u=J(e,"b","fused matMul");a=ur(s,u),s=a[0],u=a[1];var l=t?s.shape[s.rank-2]:s.shape[s.rank-1],c=r?u.shape[u.rank-1]:u.shape[u.rank-2],h=t?s.shape[s.rank-1]:s.shape[s.rank-2],f=r?u.shape[u.rank-2]:u.shape[u.rank-1],m=s.shape.slice(0,-2),g=u.shape.slice(0,-2),w=Pt(m),v=Pt(g);ee(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),ee(Gr(m,g),function(){return"Error in fused matMul: outer dimensions ("+m+") and ("+g+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),ee(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+t+" and transposeB="+r+" must match."});var y,x=s.shape.slice(0,-2).concat([h,f]),E=t?s.as3D(w,l,h):s.as3D(w,h,l),_=r?u.as3D(v,f,c):u.as3D(v,c,f);i!=null&&cn(x,(y=ur(y=J(i,"bias","fused matMul"),s)[0]).shape);var k={$a:E,$b:_};return i!=null&&(k.$bias=y),ve.runKernel(function(C,A){var I=C.fusedBatchMatMul(E,_,t,r,y,o);return A([E,_,I]),I},k,function(C,A){var I,T=A[0],R=A[1],N=A[2];if(o==null||o==="linear")I=C;else{if(o!=="relu")throw new Error("Gradient for activation "+o+" has not been implemented yet.");I=C.mul(N.step())}var O={};return i!=null&&(O={$bias:function(){var V=I,F=lr(y.shape,I.shape);return F.length>0&&(V=V.sum(F)),V.reshape(y.shape)}}),Object.assign(t||r?!t&&r?{$a:function(){return I.matMul(R,!1,!1)},$b:function(){return I.matMul(T,!0,!1)}}:t&&!r?{$a:function(){return R.matMul(I,!1,!0)},$b:function(){return T.matMul(I,!1,!1)}}:{$a:function(){return R.matMul(I,!0,!0)},$b:function(){return I.matMul(T,!0,!0)}}:{$a:function(){return I.matMul(R,!1,!0)},$b:function(){return T.matMul(I,!0,!1)}},O)}).reshape(x)}}),RO=Object.freeze({matMul:MO}),AO=Object.freeze({image:PT,linalg:xO,losses:bO,spectral:aO,fused:RO,signal:cO,op:ue,batchNormalization2d:XF,batchNormalization3d:YF,batchNormalization4d:KF,batchNormalization:JF,batchNorm:lT,batchNorm2d:QF,batchNorm3d:ZF,batchNorm4d:e5,complex:ti,real:aa,imag:zs,concat:Vr,concat1d:VD,concat2d:jD,concat3d:qD,concat4d:$D,split:bw,conv1d:t5,conv2d:Ka,conv3d:n5,conv2dDerFilter:dT,depthwiseConv2d:Mw,separableConv2d:fT,conv2dTranspose:r5,matMul:Rw,dot:i5,outerProduct:o5,reverse:xd,reverse1d:a5,reverse2d:s5,reverse3d:u5,reverse4d:l5,maxPool:Pc,avgPool:Sd,pool:c5,slice:ha,slice1d:h5,slice2d:d5,slice3d:gT,slice4d:f5,abs:yF,acos:bF,acosh:wF,asin:_F,asinh:xF,atan:SF,atanh:EF,ceil:kF,clipByValue:Tw,cos:CF,cosh:TF,erf:MF,exp:Zb,expm1:RF,floor:AF,log:IF,log1p:DF,logSigmoid:NF,neg:mm,reciprocal:PF,round:FF,rsqrt:iT,sigmoid:oT,sign:OF,isNaN:LF,isInf:BF,isFinite:UF,sin:zF,sinh:WF,softplus:HF,sqrt:GF,square:VF,step:jF,tan:qF,tanh:$F,all:p5,any:m5,argMax:g5,argMin:v5,logSumExp:y5,max:Zm,mean:b5,min:w5,moments:_5,sum:yT,prod:x5,equal:bT,equalStrict:S5,greater:E5,greaterEqual:wT,greaterEqualStrict:k5,greaterStrict:C5,less:T5,lessEqual:M5,lessEqualStrict:R5,lessStrict:A5,notEqual:I5,notEqualStrict:D5,add:wn,addN:N5,addStrict:P5,atan2:F5,div:Zo,divStrict:O5,floorDiv:_T,maximum:Aw,maximumStrict:L5,minimum:xT,minimumStrict:B5,mod:U5,modStrict:z5,mul:Ua,mulStrict:W5,pow:gm,powStrict:H5,squaredDifference:G5,squaredDifferenceStrict:V5,sub:_i,subStrict:j5,elu:Y5,leakyRelu:K5,prelu:J5,relu:er,selu:Q5,logicalAnd:Iw,logicalNot:q5,logicalOr:ST,logicalXor:$5,where:Zh,whereAsync:X5,buffer:tn,print:tN,batchToSpaceND:BC,cast:nN,clone:rN,cumsum:iN,depthToSpace:oN,expandDims:Zi,eye:UC,multinomial:aN,oneHot:Kb,pad:gd,pad1d:sN,pad2d:uN,pad3d:lN,pad4d:cN,rand:hN,randomNormal:dN,randomUniform:zC,reshape:Ro,spaceToBatchND:WC,squeeze:HC,stack:Po,tile:yc,truncatedNormal:fN,unstack:Tr,setdiff1dAsync:pN,fill:vc,linspace:GD,ones:Xc,range:FC,scalar:dt,tensor:di,tensor1d:fi,tensor2d:md,tensor3d:yw,tensor4d:ko,tensor5d:WD,tensor6d:HD,zeros:Wn,onesLike:OC,zerosLike:pn,transpose:Ys,softmax:iu,logSoftmax:bN,localResponseNormalization:Z5,norm:ET,gather:kT,unsortedSegmentSum:CT,basicLSTMCell:eO,multiRNNCell:tO,movingAverage:nO,stridedSlice:rO,topk:iO,scatterND:oO,fft:Dw,ifft:vm,rfft:TT,irfft:MT,sparseToDense:sO,gatherND:uO,dropout:lO,hannWindow:AT,hammingWindow:IT,frame:DT}),IO=(function(){function n(){if(this.blockSize=48,this.firstUse=!0,be.get("IS_BROWSER")){var e=(function(){if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})();this.fromPixels2DContext=e.getContext("2d")}this.data=new YC(this,ve)}return n.prototype.register=function(e,t,r){if(this.firstUse&&(this.firstUse=!1,be.get("IS_NODE")&&Yb(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:r})},n.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},n.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var r,i;if(be.get("IS_NODE")&&e.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(e.getContext!=null)r=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData||e.data instanceof Uint8Array)r=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),r=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(t===4)i=new Int32Array(r);else{var o=e.width*e.height;i=new Int32Array(o*t);for(var a=0;a<o;a++)for(var s=0;s<t;++s)i[a*t+s]=r[4*a+s]}return yw(i,[e.height,e.width,t],"int32")},n.prototype.read=function(e){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){return[2,this.readSync(e)]})})},n.prototype.readSync=function(e){var t=this.data.get(e),r=t.dtype,i=t.complexTensors;return r==="complex64"?Qb(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},n.prototype.bufferSync=function(e){return tn(e.shape,e.dtype,this.readSync(e.dataId))},n.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},n.prototype.time=function(e){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(r){return t=om(),e(),[2,{kernelMs:om()-t}]})})},n.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},n.prototype.complex=function(e,t){var r=at.make(e.shape,{},"complex64");return this.data.get(r.dataId).complexTensors={real:ve.keep(e.clone()),imag:ve.keep(t.clone())},r},n.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},n.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},n.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(r){r!=null&&ee(r.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})},n.prototype.slice=function(e,t,r){if(this.assertNotComplex(e,"slice"),$C(e.shape,t,r)){var i=XC(t,e.strides),o=Pt(r);return di(this.readSync(e.dataId).subarray(i,i+o),r,e.dtype)}for(var a=tn(r,e.dtype),s=this.bufferSync(e),u=0;u<a.size;++u){var l=a.indexToLoc(u).map(function(c,h){return c+t[h]});a.values[u]=s.get.apply(s,l)}return a.toTensor()},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u,l){this.assertNotComplex(e,"stridedSlice");var c=_w(e.shape,t,r,i,o,a,s,u,l),h=c[0],f=c[1],m=c[2],g=f.filter(function(k,C){return m.indexOf(C)===-1});if(g.some(function(k){return k===0}))return di([],g);for(var w=tn(f,e.dtype),v=this.bufferSync(e),y=0;y<w.size;y++){for(var x=w.indexToLoc(y),E=new Array(x.length),_=0;_<E.length;_++)E[_]=x[_]*i[_]+h[_];w.set.apply(w,[v.get.apply(v,E)].concat(x))}return w.toTensor().reshape(g)},n.prototype.unstack=function(e,t){for(var r=e.shape[t],i=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(i[o++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(r);for(a=0;a<l.length;a++)s[t]=a,l[a]=this.slice(e,s,u).reshape(i);return l},n.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var r=tn(e.shape,e.dtype),i=this.bufferSync(e),o=function(s){var u=r.indexToLoc(s),l=u.slice();t.forEach(function(c){return l[c]=e.shape[c]-1-l[c]}),r.set.apply(r,[i.get.apply(i,l)].concat(u))},a=0;a<r.size;a++)o(a);return r.toTensor()},n.prototype.concat=function(e,t){var r=this;this.assertNotComplex(e,"concat");var i=e.map(function(c){var h=Pt(c.shape.slice(t));return c.as2D(-1,h)}),o=Nc(i.map(function(c){return c.shape}),1),a=tn(o,e[0].dtype).values;if(i[0].shape[0]===1){var s=0;i.forEach(function(c){a.set(r.readSync(c.dataId),s),s+=c.size})}else{var u=0;i.forEach(function(c){for(var h=r.readSync(c.dataId),f=0,m=0;m<c.shape[0];++m)for(var g=m*o[1]+u,w=0;w<c.shape[1];++w)a[g+w]=h[f++];u+=c.shape[1]})}var l=Nc(e.map(function(c){return c.shape}),t);return di(a,l,e[0].dtype)},n.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(dt(-1),e)},n.prototype.add=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,a){return{real:r+o,imag:i+a}}):this.broadcastedBinaryOp(e,t,or(e.dtype,t.dtype),function(r,i){return r+i})},n.prototype.addN=function(e){var t=this;this.assertNotComplex(e,"addN");for(var r=e.map(function(l){return t.readSync(l.dataId)}),i=tn(e[0].shape,e[0].dtype),o=i.values,a=0;a<e.length;a++)for(var s=r[a],u=0;u<o.length;u++)o[u]+=s[u];return i.toTensor()},n.prototype.subtract=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,a){return{real:r-o,imag:i-a}}):this.broadcastedBinaryOp(e,t,or(e.dtype,t.dtype),function(r,i){return r-i})},n.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.pow(r,i)})},n.prototype.batchMatMul=function(e,t,r,i){this.assertNotComplex([e,t],"matMul");for(var o=r?e.shape[1]:e.shape[2],a=r?e.shape[2]:e.shape[1],s=i?t.shape[1]:t.shape[2],u=e.shape[0],l=this.readSync(e.dataId),c=this.readSync(t.dataId),h=r?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=h[0],m=h[1],g=h[2],w=i?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=w[0],y=w[1],x=w[2],E=a*s,_=tn([u,a,s],e.dtype),k=_.values,C=this.blockSize,A=0;A<u;A++)for(var I=0;I<a;I+=C)for(var T=0;T<s;T+=C)for(var R=0;R<o;R+=C)for(var N=Math.min(I+C,a),O=Math.min(T+C,s),V=Math.min(R+C,o),F=I;F<N;F++)for(var B=T;B<O;B++){for(var U=0,P=R;P<V;P++)U+=l[A*f+F*m+P*g]*c[P*v+B*y+A*x];k[A*E+(F*s+B)]+=U}return _.toTensor()},n.prototype.fusedBatchMatMul=function(e,t,r,i,o,a){var s=this.batchMatMul(e,t,r,i);return o&&(s=this.add(s,o)),a&&(s=(function(u,l,c){if(l==="linear")return u.linear(c);if(l==="relu")return u.relu(c);throw new Error("Activation "+l+" has not been implemented for the CPU backend.")})(this,a,s)),s},n.prototype.multiply=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(r,i,o,a){return{real:r*o-i*a,imag:r*a+i*o}}):this.broadcastedBinaryOp(e,t,or(e.dtype,t.dtype),function(r,i){return r*i})},n.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(r,i){return r/i})},n.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(r,i){return Math.floor(r/i)})},n.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),Ai("sum",t,e.rank);for(var r=Lr(e.shape,t),i=r[0],o=r[1],a=Wn(i,or(e.dtype,"int32")),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=0,m=0;m<s;++m)f+=l[h+m];u[c]=f}return a},n.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var r=Lr(e.shape,t),i=r[0],o=r[1],a=Wn(i,or(e.dtype,"int32")),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=1,m=0;m<s;++m)f*=l[h+m];u[c]=f}return a},n.prototype.unsortedSegmentSum=function(e,t,r){this.assertNotComplex(e,"unsortedSegmentSum");for(var i=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<r;++a){var s=dt(a,"int32"),u=bT(s,t).asType("float32").mul(e).sum(0);i.push(u)}return Po(i)},n.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var r=[t];Ai("argMin",r,e.rank);for(var i=Lr(e.shape,r),o=i[0],a=i[1],s=Wn(o,"int32"),u=Pt(a),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0,w=0;w<u;++w){var v=c[f+w];v<m&&(m=v,g=w)}l[h]=g}return s},n.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var r=[t];Ai("argMax",r,e.rank);for(var i=Lr(e.shape,r),o=i[0],a=i[1],s=Wn(o,"int32"),u=Pt(a),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0,w=0;w<u;++w){var v=c[f+w];v>m&&(m=v,g=w)}l[h]=g}return s},n.prototype.cumsum=function(e,t,r,i){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=or(e.dtype,"int32"),a=Wn(e.shape,o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=e.shape[e.rank-1],c=i?function(w,v){return w+l-v-1}:function(w,v){return w+v},h=0;h<u.length;h+=l)for(var f=0;f<l;f++){var m=c(h,f);if(f===0)s[m]=r?0:u[m];else{var g=c(h,f-1);s[m]=r?u[g]+s[g]:u[m]+s[g]}}return a},n.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r===i?1:0})},n.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r!==i?1:0})},n.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r<i?1:0})},n.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r<=i?1:0})},n.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r>i?1:0})},n.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r>=i?1:0})},n.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)r[i]=t[i]?0:1;return at.make(e.shape,{values:r},"bool")},n.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r&&i})},n.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(r,i){return r||i})},n.prototype.select=function(e,t,r){this.assertNotComplex([e,t,r],"select");for(var i=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(r.dataId),s=Wn(t.shape,or(t.dtype,r.dtype)),u=this.readSync(s.dataId),l=0,c=e.rank===0||e.rank>1||t.rank===1?1:t.shape[1],h=0;h<i.length;h++)for(var f=0;f<c;f++)i[h]===1?u[l++]=o[h]:u[l++]=a[h];return s},n.prototype.where=function(e){this.assertNotComplex([e],"where");var t=this.readSync(e.dataId);return Sw(e.shape,t)},n.prototype.topk=function(e,t,r){return this.assertNotComplex(e,"topk"),eT(this.readSync(e.dataId),e.shape,e.dtype,t)},n.prototype.min=function(e,t){this.assertNotComplex(e,"min"),Ai("min",t,e.rank);for(var r=Lr(e.shape,t),i=r[0],o=r[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];g<f&&(f=g)}u[c]=f}return a},n.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.min(r,i)})},n.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){var o=r%i;return r<0&&i<0||r>=0&&i>=0?o:(o+i)%i})},n.prototype.max=function(e,t){this.assertNotComplex(e,"max"),Ai("max",t,e.rank);for(var r=Lr(e.shape,t),i=r[0],o=r[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];g>f&&(f=g)}u[c]=f}return a},n.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.max(r,i)})},n.prototype.all=function(e,t){this.assertNotComplex(e,"all"),Ai("all",t,e.rank);for(var r=Lr(e.shape,t),i=r[0],o=r[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];f=f&&g}u[c]=f}return a},n.prototype.any=function(e,t){this.assertNotComplex(e,"any"),Ai("any",t,e.rank);for(var r=Lr(e.shape,t),i=r[0],o=r[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];f=f||g}u[c]=f}return a},n.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){var o=r-i;return o*o})},n.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.ceil(t[i]);return at.make(e.shape,{values:r})},n.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.floor(t[i]);return at.make(e.shape,{values:r})},n.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)t[i]<0?r[i]=-1:t[i]>0?r[i]=1:r[i]=0;return at.make(e.shape,{values:r})},n.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isNaN(t[i])&&(r[i]=1);return at.make(e.shape,{values:r},"bool")},n.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)Math.abs(t[i])===1/0&&(r[i]=1);return at.make(e.shape,{values:r},"bool")},n.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),r=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isFinite(t[i])&&(r[i]=1);return at.make(e.shape,{values:r},"bool")},n.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=Math.floor(t[i]);t[i]-o<.5?r[i]=Math.floor(t[i]):t[i]-o>.5?r[i]=Math.ceil(t[i]):r[i]=o%2==0?o:o+1}return at.make(e.shape,{values:r})},n.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.exp(t[i]);return at.make(e.shape,{values:r})},n.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=Math.expm1(t[i]);return at.make(e.shape,{values:r})},n.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.log(o)}return at.make(e.shape,{values:r})},n.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.log1p(o)}return at.make(e.shape,{values:r})},n.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=Math.sqrt(o)}return at.make(e.shape,{values:r})},n.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=1/Math.sqrt(o)}return at.make(e.shape,{values:r})},n.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];r[i]=o*o}return at.make(e.shape,{values:r})},n.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=this.readSync(e.dataId),r=new Float32Array(t.length),i=0;i<t.length;++i)r[i]=1/t[i];return at.make(e.shape,{values:r})},n.prototype.linear=function(e){return e},n.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=Wn(e.shape,e.dtype),r=this.readSync(t.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)r[o]=Math.max(0,i[o]);return t},n.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return r<0?i*r:r})},n.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i];t[i]=o>=0?o:Math.exp(o)-1}return at.make(e.shape,{values:t})},n.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];r[a]=s>=1?o[a]:o[a]*(s+1)}return at.make(t.shape,{values:r})},n.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=kw,r=Cw,i=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var s=o[a];i[a]=s>=0?r*s:t*(Math.exp(s)-1)}return at.make(e.shape,{values:i})},n.prototype.clip=function(e,t,r){this.assertNotComplex(e,"clip");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var s=o[a];i[a]=s>r?r:s<t?t:s}return at.make(e.shape,{values:i})},n.prototype.abs=function(e){for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.abs(r[i]);return at.make(e.shape,{values:t})},n.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<e.size;++i){var o=r[2*i],a=r[2*i+1];t[i]=Math.hypot(o,a)}return at.make(e.shape,{values:t})},n.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=r[i];return at.make(e.shape,{values:t},"int32")},n.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=1/(1+Math.exp(-r[i]));return at.make(e.shape,{values:t})},n.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(11920928955078125e-23)+2,r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=i[o]>-t,s=i[o]<t,u=Math.exp(i[o]),l=void 0;l=s?u:a?i[o]:Math.log(1+u),r[o]=l}return at.make(e.shape,{values:r})},n.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.sin(r[i]);return at.make(e.shape,{values:t})},n.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.cos(r[i]);return at.make(e.shape,{values:t})},n.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.tan(r[i]);return at.make(e.shape,{values:t})},n.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.asin(r[i]);return at.make(e.shape,{values:t})},n.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.acos(r[i]);return at.make(e.shape,{values:t})},n.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.atan(r[i]);return at.make(e.shape,{values:t})},n.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(r,i){return Math.atan2(r,i)})},n.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.sinh(r[i]);return at.make(e.shape,{values:t})},n.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.cosh(r[i]);return at.make(e.shape,{values:t})},n.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=YI(r[i]);return at.make(e.shape,{values:t})},n.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.asinh(r[i]);return at.make(e.shape,{values:t})},n.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.acosh(r[i]);return at.make(e.shape,{values:t})},n.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i)t[i]=Math.atanh(r[i]);return at.make(e.shape,{values:t})},n.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),r=this.readSync(e.dataId),i=0;i<r.length;++i){var o=r[i],a=1/(1+.3275911*o);t[i]=1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o)}return at.make(e.shape,{values:t})},n.prototype.step=function(e,t){t===void 0&&(t=0),this.assertNotComplex(e,"step");for(var r=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=i[o];isNaN(a)?r[o]=NaN:r[o]=a>0?1:t}return at.make(e.shape,{values:r})},n.prototype.conv2d=function(e,t,r){this.assertNotComplex([e,t],"conv2d");for(var i=r.filterHeight,o=r.filterWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=tn(r.outShape,e.dtype),h=this.readSync(e.dataId),f=this.readSync(t.dataId),m=c.values,g=0;g<r.batchSize;++g)for(var w=g*e.strides[0],v=g*c.strides[0],y=0;y<r.outHeight;++y)for(var x=v+y*c.strides[1],E=y*r.strideHeight-l,_=0;_<i;_++){var k=E+_*a;if(!(k<0||k>=r.inHeight))for(var C=_*t.strides[0],A=w+k*e.strides[1],I=0;I<r.outWidth;++I)for(var T=x+I*r.outChannels,R=I*r.strideWidth-u,N=0;N<o;N++){var O=R+N*s;if(!(O<0||O>=r.inWidth))for(var V=C+N*t.strides[1],F=A+O*r.inChannels,B=V,U=0;U<r.inChannels;++U){for(var P=h[F+U],L=0;L<r.outChannels;++L)m[T+L]+=P*f[B+L];B+=r.outChannels}}}return c.toTensor()},n.prototype.conv3d=function(e,t,r){for(var i=r.filterDepth,o=r.filterHeight,a=r.filterWidth,s=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.padInfo.front,h=r.padInfo.left,f=r.padInfo.top,m=tn(r.outShape,e.dtype),g=this.readSync(e.dataId),w=this.readSync(t.dataId),v=m.values,y=0;y<r.batchSize;++y)for(var x=y*e.strides[0],E=y*m.strides[0],_=0;_<r.outDepth;++_)for(var k=E+_*m.strides[1],C=_*r.strideDepth-c,A=0;A<i;A++){var I=C+A*s;if(!(I<0||I>=r.inDepth))for(var T=A*t.strides[0],R=x+I*e.strides[1],N=0;N<r.outHeight;++N)for(var O=k+N*m.strides[2],V=N*r.strideHeight-f,F=0;F<o;F++){var B=V+F*u;if(!(B<0||B>=r.inHeight))for(var U=T+F*t.strides[1],P=R+B*e.strides[2],L=0;L<r.outWidth;++L)for(var H=O+L*r.outChannels,W=L*r.strideWidth-h,z=0;z<a;z++){var q=W+z*l;if(!(q<0||q>=r.inWidth))for(var re=U+z*t.strides[2],de=P+q*r.inChannels,ye=re,te=0;te<r.inChannels;++te){for(var ie=g[de+te],fe=0;fe<r.outChannels;++fe)v[H+fe]+=ie*w[ye+fe];ye+=r.outChannels}}}}return m.toTensor()},n.prototype.conv2dDerInput=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerInput");for(var i=tn(r.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=this.readSync(e.dataId),h=e.strides,f=h[0],m=h[1],g=h[2],w=this.readSync(t.dataId),v=t.strides,y=v[0],x=v[1],E=v[2],_=r.batchSize,k=r.filterHeight,C=r.filterWidth,A=r.inChannels,I=r.inHeight,T=r.inWidth,R=r.outChannels,N=r.outHeight,O=r.outWidth,V=r.strideHeight,F=r.strideWidth,B=k-1-r.padInfo.top,U=C-1-r.padInfo.left,P=0;P<_;++P)for(var L=0;L<A;++L)for(var H=0;H<I;++H)for(var W=H-B,z=Math.max(0,Math.ceil(W/V)),q=Math.min(N,(k+W)/V),re=0;re<T;++re){for(var de=re-U,ye=Math.max(0,Math.ceil(de/F)),te=Math.min(O,(C+de)/F),ie=0,fe=z;fe<q;++fe)for(var Re=fe*V-W,De=ye;De<te;++De)for(var Be=f*P+m*fe+g*De,lt=y*(k-1-Re)+x*(C-1-(De*F-de))+E*L,Y=0;Y<R;++Y)ie+=c[Be+Y]*w[lt+Y];o[s*P+u*H+l*re+L]=ie}return i.toTensor()},n.prototype.conv3dDerInput=function(e,t,r){for(var i=tn(r.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(e.dataId),f=e.strides,m=f[0],g=f[1],w=f[2],v=f[3],y=this.readSync(t.dataId),x=t.strides,E=x[0],_=x[1],k=x[2],C=x[3],A=r.batchSize,I=r.filterDepth,T=r.filterHeight,R=r.filterWidth,N=r.inChannels,O=r.inDepth,V=r.inHeight,F=r.inWidth,B=r.outChannels,U=r.outDepth,P=r.outHeight,L=r.outWidth,H=r.strideDepth,W=r.strideHeight,z=r.strideWidth,q=I-1-r.padInfo.front,re=T-1-r.padInfo.top,de=R-1-r.padInfo.left,ye=0;ye<A;++ye)for(var te=0;te<N;++te)for(var ie=0;ie<O;++ie)for(var fe=ie-q,Re=Math.max(0,Math.ceil(fe/H)),De=Math.min(U,(I+fe)/H),Be=0;Be<V;++Be)for(var lt=Be-re,Y=Math.max(0,Math.ceil(lt/W)),ot=Math.min(P,(T+lt)/W),Ke=0;Ke<F;++Ke){for(var Xe=Ke-de,qe=Math.max(0,Math.ceil(Xe/z)),Tt=Math.min(L,(R+Xe)/z),Qe=0,ft=Re;ft<De;++ft)for(var Mt=ft*H-fe,Ut=Y;Ut<ot;++Ut)for(var Q=Ut*W-lt,j=qe;j<Tt;++j)for(var me=m*ye+g*ft+w*Ut+v*j,Ae=E*(I-1-Mt)+_*(T-1-Q)+k*(R-1-(j*z-Xe))+C*te,Pe=0;Pe<B;++Pe)Qe+=h[me+Pe]*y[Ae+Pe];o[s*ye+u*ie+l*Be+c*Ke+te]=Qe}return i.toTensor()},n.prototype.conv2dDerFilter=function(e,t,r){this.assertNotComplex([e,t],"conv2dDerFilter");for(var i=r.strideHeight,o=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=tn(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=this.bufferSync(e),f=this.bufferSync(t),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((c-m)/i)),w=Math.min(r.outHeight,(r.inHeight+c-m)/i),v=0;v<s;++v)for(var y=Math.max(0,Math.ceil((l-v)/o)),x=Math.min(r.outWidth,(r.inWidth+l-v)/o),E=0;E<r.inChannels;++E)for(var _=0;_<r.outChannels;++_){for(var k=0,C=0;C<r.batchSize;++C)for(var A=g;A<w;++A)for(var I=m+A*i-c,T=y;T<x;++T){var R=v+T*o-l;k+=h.get(C,I,R,E)*f.get(C,A,T,_)}u.set(k,m,v,E,_)}return u.toTensor()},n.prototype.conv3dDerFilter=function(e,t,r){for(var i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.filterDepth,u=r.filterHeight,l=r.filterWidth,c=tn(r.filterShape,"float32"),h=c.values,f=c.strides,m=f[0],g=f[1],w=f[2],v=f[3],y=this.readSync(t.dataId),x=t.strides,E=x[0],_=x[1],k=x[2],C=x[3],A=this.readSync(e.dataId),I=e.strides,T=I[0],R=I[1],N=I[2],O=I[3],V=r.padInfo.front,F=r.padInfo.left,B=r.padInfo.top,U=0;U<s;++U)for(var P=Math.max(0,Math.ceil((V-U)/i)),L=Math.min(r.outDepth,(r.inDepth+V-U)/i),H=U*m,W=0;W<u;++W)for(var z=Math.max(0,Math.ceil((B-W)/o)),q=Math.min(r.outHeight,(r.inHeight+B-W)/o),re=W*g+H,de=0;de<l;++de)for(var ye=Math.max(0,Math.ceil((F-de)/a)),te=Math.min(r.outWidth,(r.inWidth+F-de)/a),ie=de*w+re,fe=0;fe<r.inChannels;++fe)for(var Re=fe*v+ie,De=0;De<r.outChannels;++De){for(var Be=0,lt=0;lt<r.batchSize;++lt)for(var Y=lt*T,ot=lt*E,Ke=P;Ke<L;++Ke)for(var Xe=(U+Ke*i-V)*R+Y,qe=Ke*_+ot,Tt=z;Tt<q;++Tt)for(var Qe=(W+Tt*o-B)*N+Xe,ft=Tt*k+qe,Mt=ye;Mt<te;++Mt){var Ut=Mt*C+ft;Be+=A[(de+Mt*a-F)*O+Qe+fe]*y[Ut+De]}h[Re+De]=Be}return c.toTensor()},n.prototype.depthwiseConv2D=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2D");for(var i=r.filterHeight,o=r.filterWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.padInfo.left,l=r.padInfo.top,c=r.outChannels/r.inChannels,h=tn(r.outShape,e.dtype),f=this.readSync(e.dataId),m=this.readSync(t.dataId),g=h.values,w=0;w<r.batchSize;++w)for(var v=w*e.strides[0],y=w*h.strides[0],x=0;x<r.outHeight;++x)for(var E=y+x*h.strides[1],_=x*r.strideHeight-u,k=0;k<i;++k){var C=_+k*a;if(!(C<0||C>=r.inHeight))for(var A=k*t.strides[0],I=v+C*e.strides[1],T=0;T<r.outWidth;++T)for(var R=E+T*h.strides[2],N=T*r.strideWidth-l,O=0;O<o;++O){var V=N+O*s;if(!(V<0||V>=r.inWidth))for(var F=A+O*t.strides[1],B=I+V*r.inChannels,U=R,P=F,L=0;L<r.inChannels;++L){for(var H=f[B+L],W=0;W<c;++W)g[U+W]+=H*m[P+W];U+=c,P+=c}}}return h.toTensor()},n.prototype.depthwiseConv2DDerInput=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var i=tn(r.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=this.readSync(e.dataId),h=e.strides,f=h[0],m=h[1],g=h[2],w=this.readSync(t.dataId),v=t.strides,y=v[0],x=v[1],E=v[2],_=r.batchSize,k=r.filterHeight,C=r.filterWidth,A=r.inChannels,I=r.inHeight,T=r.inWidth,R=r.outChannels,N=r.outHeight,O=r.outWidth,V=r.strideHeight,F=r.strideWidth,B=k-1-r.padInfo.top,U=C-1-r.padInfo.left,P=R/A,L=0;L<_;++L)for(var H=0;H<A;++H)for(var W=0;W<I;++W)for(var z=W-B,q=Math.max(0,Math.ceil(z/V)),re=Math.min(N,(k+z)/V),de=0;de<T;++de){for(var ye=de-U,te=Math.max(0,Math.ceil(ye/F)),ie=Math.min(O,(C+ye)/F),fe=0,Re=q;Re<re;++Re)for(var De=Re*V-z,Be=te;Be<ie;++Be)for(var lt=f*L+m*Re+g*Be,Y=y*(k-1-De)+x*(C-1-(Be*F-ye))+E*H,ot=0;ot<P;++ot)fe+=c[lt+(H*P+ot)]*w[Y+ot];o[s*L+u*W+l*de+H]=fe}return i.toTensor()},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var i=r.strideHeight,o=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=tn(r.filterShape,"float32"),l=r.padInfo.left,c=r.padInfo.top,h=r.outChannels/r.inChannels,f=this.bufferSync(e),m=this.bufferSync(t),g=0;g<a;++g)for(var w=Math.max(0,Math.ceil((c-g)/i)),v=Math.min(r.outHeight,(r.inHeight+c-g)/i),y=0;y<s;++y)for(var x=Math.max(0,Math.ceil((l-y)/o)),E=Math.min(r.outWidth,(r.inWidth+l-y)/o),_=0;_<r.outChannels;++_){for(var k=Math.trunc(_/h),C=_%h,A=0,I=0;I<r.batchSize;++I)for(var T=w;T<v;++T)for(var R=g+T*i-c,N=x;N<E;++N){var O=y+N*o-l;A+=f.get(I,R,O,k)*m.get(I,T,N,_)}u.set(A,g,y,k,C)}return u.toTensor()},n.prototype.tile=function(e,t){return this.assertNotComplex(e,"tile"),ZC(this.bufferSync(e),t)},n.prototype.pad=function(e,t,r){this.assertNotComplex(e,"pad");var i=t.map(function(h,f){return h[0]+e.shape[f]+h[1]}),o=t.map(function(h){return h[0]}),a=this.bufferSync(e),s=tn(i,e.dtype);r!==0&&s.values.fill(r);for(var u=0;u<e.size;u++){var l=a.indexToLoc(u),c=l.map(function(h,f){return h+o[f]});s.set.apply(s,[a.get.apply(a,l)].concat(c))}return s.toTensor()},n.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var r=new Array(e.rank),i=0;i<r.length;i++)r[i]=e.shape[t[i]];var o=this.readSync(e.dataId),a=tn(r,e.dtype),s=this.bufferSync(e);for(i=0;i<e.size;++i){for(var u=s.indexToLoc(i),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[t[c]];var h=a.locToIndex(l);a.values[h]=o[i]}return a.toTensor()},n.prototype.gather=function(e,t,r){this.assertNotComplex([e,t],"gather");var i=e.shape.slice(),o=this.readSync(t.dataId);i[r]=o.length;for(var a=tn(i,e.dtype),s=this.bufferSync(e),u=0;u<a.size;++u){var l=a.indexToLoc(u),c=l.slice();c[r]=o[l[r]];var h=s.locToIndex(c);a.values[u]=s.values[h]}return a.toTensor()},n.prototype.batchToSpaceND=function(e,t,r){this.assertNotComplex([e],"batchToSpaceND");var i=t.reduce(function(c,h){return c*h}),o=lm(e.shape,t,i),a=cm(o.length,t.length),s=hm(e.shape,t,i),u=GC(r,t.length),l=VC(s,r,t.length);return e.reshape(o).transpose(a).reshape(s).slice(u,l)},n.prototype.spaceToBatchND=function(e,t,r){this.assertNotComplex([e],"spaceToBatchND");var i=t.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,r);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var s=e.pad(o),u=lm(s.shape,t,i,!1),l=cm(u.length,t.length,!1),c=hm(s.shape,t,i,!1);return s.reshape(u).transpose(l).reshape(c)},n.prototype.pool=function(e,t,r){this.assertNotComplex(e,"pool");for(var i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,f=r==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=tn(t.outShape,e.dtype),w=g.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],y=t.outShape[2]*t.outShape[3],x=t.outShape[3],E=0;E<t.batchSize;++E)for(var _=E*v,k=E*e.strides[0],C=0;C<t.inChannels;++C)for(var A=0;A<t.outHeight;++A)for(var I=A*i-c,T=Math.max(0,I),R=Math.min(t.inHeight,u+I),N=_+A*y,O=0;O<t.outWidth;++O){for(var V=O*o-h,F=Math.max(0,V),B=Math.min(t.inWidth,l+V),U=f,P=0,L=0,H=T;H<R;H+=a){for(var W=k+H*e.strides[1],z=F;z<B;z+=s){var q=m[W+z*e.strides[2]+C];r==="max"&&q>U?U=q:r==="avg"&&(P+=q,L++)}if(isNaN(U))break}w[N+O*x+C]=r==="avg"?P/L:U}return g.toTensor()},n.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},n.prototype.maxPoolPositions=function(e,t){for(var r=tn(t.outShape,"int32"),i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,f=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var w=0;w<t.outHeight;++w){for(var v=w*i-c,y=v;y<0;)y+=a;for(var x=Math.min(t.inHeight,u+v),E=0;E<t.outWidth;++E){for(var _=E*o-h,k=_;k<0;)k+=s;for(var C=Math.min(t.inWidth,l+_),A=Number.NEGATIVE_INFINITY,I=-1,T=y;T<x;T+=a)for(var R=T-v,N=k;N<C;N+=s){var O=N-_,V=f.get(m,T,N,g);V>A&&(A=V,I=R*l+O)}r.set(I,m,w,E,g)}}return r.toTensor()},n.prototype.maxPoolBackprop=function(e,t,r,i){this.assertNotComplex([t,r],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,i),a=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,m=c-1-i.padInfo.top,g=tn(t.shape,"float32"),w=this.bufferSync(o),v=this.bufferSync(e),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var E=0;E<i.inHeight;++E)for(var _=0;_<i.inWidth;++_){for(var k=E-m,C=_-f,A=0,I=0;I<c;I+=u){var T=(k+I)/a;if(!(T<0||T>=i.outHeight||Math.floor(T)!==T))for(var R=0;R<h;R+=l){var N=(C+R)/s;if(!(N<0||N>=i.outWidth||Math.floor(N)!==N)){var O=c*h-1-w.get(y,T,N,x)===I*h+R?1:0;O!==0&&(A+=v.get(y,T,N,x)*O)}}}g.set(A,y,E,_,x)}return g.toTensor()},n.prototype.avgPoolBackprop=function(e,t,r){this.assertNotComplex([e,t],"avgPoolBackprop");for(var i=r.strideHeight,o=r.strideWidth,a=r.filterHeight,s=r.filterWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=h-1-r.padInfo.left,m=c-1-r.padInfo.top,g=tn(t.shape,"float32"),w=1/(a*s),v=this.bufferSync(e),y=0;y<r.batchSize;++y)for(var x=0;x<r.inChannels;++x)for(var E=0;E<r.inHeight;++E)for(var _=0;_<r.inWidth;++_){for(var k=E-m,C=_-f,A=0,I=0;I<c;I+=u){var T=(k+I)/i;if(!(T<0||T>=r.outHeight||Math.floor(T)!==T))for(var R=0;R<h;R+=l){var N=(C+R)/o;N<0||N>=r.outWidth||Math.floor(N)!==N||(A+=v.get(y,T,N,x))}}g.set(A*w,y,E,_,x)}return g.toTensor()},n.prototype.cast=function(e,t){return KC(e,t,this)},n.prototype.reshape=function(e,t){return Jb(e,t)},n.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},n.prototype.resizeBilinear=function(e,t,r,i){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=this.readSync(e.dataId),h=new Float32Array(Pt([a,t,r,l])),f=[i&&t>1?s-1:s,i&&r>1?u-1:u],m=[i&&t>1?t-1:t,i&&r>1?r-1:r],g=0,w=f[0]/m[0],v=f[1]/m[1],y=0;y<a;y++)for(var x=0;x<t;x++)for(var E=w*x,_=Math.floor(E),k=E-_,C=Math.min(s-1,Math.ceil(E)),A=y*e.strides[0]+_*e.strides[1],I=y*e.strides[0]+C*e.strides[1],T=0;T<r;T++)for(var R=v*T,N=Math.floor(R),O=R-N,V=Math.min(u-1,Math.ceil(R)),F=A+N*e.strides[2],B=I+N*e.strides[2],U=A+ +V*e.strides[2],P=I+V*e.strides[2],L=0;L<l;L++){var H=c[F+L],W=c[B+L],z=H+(c[U+L]-H)*O,q=z+(W+(c[P+L]-W)*O-z)*k;h[g++]=q}return di(h,[a,t,r,l])},n.prototype.resizeBilinearBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],f=new Float32Array(o*a*s*u),m=[r&&c>1?a-1:a,r&&h>1?s-1:s],g=[r&&c>1?c-1:c,r&&h>1?h-1:h],w=m[0]/g[0],v=m[1]/g[1],y=this.readSync(e.dataId),x=0,E=0;E<o;E++)for(var _=E*t.strides[0],k=0;k<c;k++)for(var C=k*w,A=Math.floor(C),I=Math.min(Math.ceil(C),a-1),T=_+A*t.strides[1],R=_+I*t.strides[1],N=C-A,O=1-N,V=0;V<h;V++)for(var F=V*v,B=Math.floor(F),U=Math.min(Math.ceil(F),s-1),P=F-B,L=1-P,H=T+B*t.strides[2],W=T+U*t.strides[2],z=R+B*t.strides[2],q=R+U*t.strides[2],re=O*L,de=O*P,ye=N*L,te=N*P,ie=0;ie<u;ie++){var fe=y[x++];f[H+ie]+=fe*re,f[W+ie]+=fe*de,f[z+ie]+=fe*ye,f[q+ie]+=fe*te}return ko(f,[o,s,a,u],t.dtype)},n.prototype.resizeNearestNeighbor=function(e,t,r,i){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=this.readSync(e.dataId),h=new Float32Array(a*t*r*l),f=[i&&t>1?s-1:s,i&&r>1?u-1:u],m=[i&&t>1?t-1:t,i&&r>1?r-1:r],g=f[0]/m[0],w=f[1]/m[1],v=0,y=0;y<a;y++)for(var x=y*e.strides[0],E=0;E<t;E++)for(var _=g*E,k=x+Math.min(s-1,i?Math.round(_):Math.floor(_))*e.strides[1],C=0;C<r;C++)for(var A=w*C,I=k+Math.min(u-1,i?Math.round(A):Math.floor(A))*e.strides[2],T=0;T<l;T++){var R=c[I+T];h[v++]=R}return di(h,[a,t,r,l],e.dtype)},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],f=new Float32Array(o*a*s*u),m=this.readSync(e.dataId),g=[r&&c>1?a-1:a,r&&h>1?s-1:s],w=[r&&c>1?c-1:c,r&&h>1?h-1:h],v=g[0]/w[0],y=g[1]/w[1],x=1/v,E=1/y,_=2*Math.ceil(x)+2,k=2*Math.ceil(E)+2,C=0;C<o;C++)for(var A=C*t.strides[0],I=0;I<a;I++)for(var T=A+I*t.strides[1],R=Math.floor(I*x),N=Math.floor(R-_/2),O=0;O<s;O++)for(var V=T+O*t.strides[2],F=Math.floor(O*E),B=Math.floor(F-k/2),U=0;U<u;U++){for(var P=0,L=0;L<_;L++){var H=L+N;if(!(H<0||H>=c)){var W=A+H*e.strides[1],z=H*v;if(I===Math.min(a-1,r?Math.round(z):Math.floor(z)))for(var q=0;q<k;q++){var re=q+B;if(!(re<0||re>=h)){var de=W+re*e.strides[2],ye=re*y;O===Math.min(s-1,r?Math.round(ye):Math.floor(ye))&&(P+=m[de+U])}}}}f[V+U]=P}return ko(f,t.shape,t.dtype)},n.prototype.batchNormalization=function(e,t,r,i,o,a){this.assertNotComplex([e,t,r,o,a],"batchNorm");for(var s=this.readSync(e.dataId),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),h=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(s.length),m=h.length,g=c.length,w=l.length,v=u.length,y=0,x=0,E=0,_=0,k=0;k<s.length;++k)f[k]=h[y++]+(s[k]-u[x++])*c[E++]/Math.sqrt(l[_++]+i),y>=m&&(y=0),x>=v&&(x=0),E>=g&&(E=0),_>=w&&(_=0);return ko(f,e.shape)},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],s=a-1,u=this.readSync(e.dataId),l=e.size,c=new Float32Array(l);function h(w){for(var v=w%a,y=w-v+Math.max(0,v-t),x=w-v+Math.min(v+t,s),E=0;y<=x;y++){var _=u[y];E+=_*_}return E}for(var f=0;f<l;f++){var m=h(f),g=u[f]*Math.pow(r+i*m,-o);c[f]=g}return ko(c,e.shape)},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){this.assertNotComplex(e,"LRNGrad");for(var u=e.shape[3],l=this.readSync(e.dataId),c=this.readSync(t.dataId),h=this.readSync(r.dataId),f=new Float32Array(e.size),m=e.size,g=0;g<m;g++){for(var w=g%u,v=g-w+Math.max(0,w-i),y=g-w+Math.min(u,w+i+1),x=0,E=v;E<y;E++)x+=Math.pow(c[E],2);for(x=a*x+o,E=v;E<y;E++){var _=-2*a*s*c[E]*h[g]/x;g===E&&(_+=Math.pow(x,-s)),_*=l[g],f[E]+=_}}return ko(f,e.shape)},n.prototype.multinomial=function(e,t,r,i){this.assertNotComplex(e,"multinomial");for(var o=t?e:iu(e),a=o.shape[0],s=o.shape[1],u=Wn([a,r],"int32"),l=this.readSync(u.dataId),c=this.readSync(o.dataId),h=0;h<a;++h){var f=h*s,m=new Float32Array(s-1);m[0]=c[f];for(var g=1;g<m.length;++g)m[g]=m[g-1]+c[f+g];for(var w=ww(i.toString()),v=h*r,y=0;y<r;++y){var x=w();l[v+y]=m.length;for(var E=0;E<m.length;E++)if(x<m[E]){l[v+y]=E;break}}}return u},n.prototype.oneHot=function(e,t,r,i){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(i);for(var a=this.readSync(e.dataId),s=0;s<e.size;++s)a[s]>=0&&a[s]<t&&(o[s*t+a[s]]=r);return md(o,[e.size,t],"int32")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return this.assertNotComplex(e,"nonMaxSuppression"),xw(this.readSync(e.dataId),this.readSync(t.dataId),r,i,o)},n.prototype.fft=function(e){return this.fftBatch(e,!1)},n.prototype.ifft=function(e){return this.fftBatch(e,!0)},n.prototype.fftBatch=function(e,t){for(var r=e.shape[0],i=e.shape[1],o=tn(e.shape,"float32"),a=tn(e.shape,"float32"),s=aa(e).as2D(r,i),u=zs(e).as2D(r,i),l=0;l<r;l++)for(var c=s.slice([l,0],[1,i]),h=u.slice([l,0],[1,i]),f=ti(c,h),m=this.readSync(this.fftImpl(f,t).dataId),g=0;g<i;g++){var w=sS(m,g);o.values[l*i+g]=w.real,a.values[l*i+g]=w.imag}return ti(o.toTensor(),a.toTensor()).as2D(r,i)},n.prototype.fftImpl=function(e,t){var r=e.as1D(),i=r.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(r,i,t).as2D(e.shape[0],e.shape[1]);return t&&(o=ti(aa(o).div(dt(i)),zs(o).div(dt(i)))),o}var a=this.readSync(e.dataId),s=(function(u){for(var l=new Float32Array(u.length/2),c=new Float32Array(u.length/2),h=0;h<u.length;h+=2)l[h/2]=u[h],c[h/2]=u[h+1];return{real:l,imag:c}})(this.fourierTransformByMatmul(a,i,t));return ti(s.real,s.imag).as2D(e.shape[0],e.shape[1])},n.prototype.isExponentOf2=function(e){return(e&e-1)==0},n.prototype.fftRadix2=function(e,t,r){if(t===1)return e;var i=this.readSync(e.dataId),o=t/2,a=(function(v){for(var y=Math.ceil(v.length/4),x=new Float32Array(y),E=new Float32Array(y),_=0;_<v.length;_+=4)x[Math.floor(_/4)]=v[_],E[Math.floor(_/4)]=v[_+1];return{real:x,imag:E}})(i),s=ti(a.real,a.imag).as1D(),u=(function(v){for(var y=Math.floor(v.length/4),x=new Float32Array(y),E=new Float32Array(y),_=2;_<v.length;_+=4)x[Math.floor(_/4)]=v[_],E[Math.floor(_/4)]=v[_+1];return{real:x,imag:E}})(i),l=ti(u.real,u.imag).as1D();s=this.fftRadix2(s,o,r),l=this.fftRadix2(l,o,r);var c=(function(v,y){for(var x=new Float32Array(v/2),E=new Float32Array(v/2),_=0;_<Math.ceil(v/2);_++){var k=(y?2:-2)*Math.PI*(_/v);x[_]=Math.cos(k),E[_]=Math.sin(k)}return{real:x,imag:E}})(t,r),h=ti(c.real,c.imag).mul(l),f=s.add(h),m=s.sub(h),g=aa(f).concat(aa(m)),w=zs(f).concat(zs(m));return ti(g,w).as1D()},n.prototype.fourierTransformByMatmul=function(e,t,r){for(var i=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,s=0,u=0;u<t;u++){var l=xN(o*u,t,r),c=sS(e,u);a+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}r&&(a/=t,s/=t),_N(i,a,s,o)}return i},n.prototype.depthToSpace=function(e,t,r){ee(r==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+r}),ee(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var i=e.shape[0],o=e.shape[1],a=e.shape[2],s=e.shape[3],u=o*t,l=a*t,c=s/(t*t),h=this.readSync(e.dataId),f=new Float32Array(i*u*l*c),m=0,g=0;g<i;++g)for(var w=0;w<u;++w)for(var v=Math.floor(w/t),y=w%t,x=0;x<l;++x)for(var E=Math.floor(x/t),_=(y*t+x%t)*c,k=0;k<c;++k){var C=k+_+s*(E+a*(v+o*g));f[m++]=h[C]}return ko(f,[i,u,l,c])},n.prototype.broadcastedBinaryOp=function(e,t,r,i){var o=cn(e.shape,t.shape),a=tn(o,r),s=this.readSync(e.dataId),u=this.readSync(t.dataId),l=fc(e.shape,o),c=fc(t.shape,o),h=a.values;if(l.length+c.length===0)for(var f=0;f<h.length;++f)h[f]=i(s[f%s.length],u[f%u.length]);else{var m=this.bufferSync(e),g=this.bufferSync(t),w=function(v){var y=a.indexToLoc(v),x=y.slice(-e.rank);l.forEach(function(C){return x[C]=0});var E=m.locToIndex(x),_=y.slice(-t.rank);c.forEach(function(C){return _[C]=0});var k=g.locToIndex(_);h[v]=i(s[E],u[k])};for(f=0;f<h.length;++f)w(f)}return a.toTensor()},n.prototype.broadcastedBinaryComplexOp=function(e,t,r){var i=cn(e.shape,t.shape),o=tn(i,"float32"),a=tn(i,"float32"),s=this.readSync(e.dataId),u=this.readSync(t.dataId),l=fc(e.shape,i),c=fc(t.shape,i),h=o.values,f=a.values;if(l.length+c.length===0)for(var m=0;m<h.length;m++){var g=m%s.length,w=m%u.length,v=r(s[2*g],s[2*g+1],u[2*w],u[2*w+1]);h[m]=v.real,f[m]=v.imag}else{var y=this.bufferSync(this.data.get(e.dataId).complexTensors.real),x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),E=function(_){var k=o.indexToLoc(_),C=k.slice(-e.rank);l.forEach(function(N){return C[N]=0});var A=y.locToIndex(C),I=k.slice(-t.rank);c.forEach(function(N){return I[N]=0});var T=x.locToIndex(I),R=r(s[2*A],s[2*A+1],u[2*T],u[2*T+1]);h[_]=R.real,f[_]=R.imag};for(m=0;m<h.length;m++)E(m)}return this.complex(o.toTensor(),a.toTensor())},n.prototype.split=function(e,t,r){return QC(e,t,r)},n.prototype.dispose=function(){},n.prototype.floatPrecision=function(){return 32},n.prototype.epsilon=function(){return 1e-7},n.prototype.cropAndResize=function(e,t,r,i,o,a){for(var s=e.shape,u=s[0],l=s[1],c=s[2],h=s[3],f=t.shape[0],m=i[0],g=i[1],w=tn([f,m,g,h],e.dtype),v=this.readSync(t.dataId),y=this.readSync(r.dataId),x=this.readSync(e.dataId),E=e.strides,_=w.strides,k=0;k<f;k++){var C=4*k,A=v[C],I=v[C+1],T=v[C+2],R=v[C+3],N=y[k];if(!(N>=u))for(var O=m>1?(T-A)*(l-1)/(m-1):0,V=g>1?(R-I)*(c-1)/(g-1):0,F=0;F<m;F++){var B=m>1?A*(l-1)+F*O:.5*(A+T)*(l-1);if(B<0||B>l-1)for(var U=0;U<g;U++)for(var P=0;P<h;P++){var L=P+U*_[2]+F*_[1]+k*_[0];w.values[L]=a}else if(o==="bilinear"){var H=Math.floor(B),W=Math.ceil(B),z=B-H;for(U=0;U<g;U++)if((De=g>1?I*(c-1)+U*V:.5*(I+R)*(c-1))<0||De>c-1)for(P=0;P<h;P++)L=P+U*_[2]+F*_[1]+k*_[0],w.values[L]=a;else{var q=Math.floor(De),re=Math.ceil(De),de=De-q;for(P=0;P<h;P++){var ye=x[L=P+q*E[2]+H*E[1]+N*E[0]],te=x[L=P+re*E[2]+H*E[1]+N*E[0]],ie=x[L=P+q*E[2]+W*E[1]+N*E[0]],fe=ye+(te-ye)*de,Re=ie+(x[L=P+re*E[2]+W*E[1]+N*E[0]]-ie)*de;L=P+U*_[2]+F*_[1]+k*_[0],w.values[L]=fe+(Re-fe)*z}}}else for(U=0;U<g;++U){var De;if((De=g>1?I*(c-1)+U*V:.5*(I+R)*(c-1))<0||De>c-1)for(P=0;P<h;P++)L=P+U*_[2]+F*_[1]+k*_[0],w.values[L]=a;else{var Be=Math.round(De),lt=Math.round(B);for(P=0;P<h;P++){var Y=P+Be*E[2]+lt*E[1]+N*E[0],ot=P+U*_[2]+F*_[1]+k*_[0];w.values[ot]=x[Y]}}}}}return w.toTensor()},n.prototype.sparseToDense=function(e,t,r,i){var o=dm(0,e,r),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize;return this.scatter(e,t,r,c,u,s,a,l,i,!1)},n.prototype.gatherND=function(e,t){var r=t.shape,i=r[r.length-1],o=jC(e,t),a=o[0],s=o[1],u=o[2],l=o[3];if(s===0)return di([],a,e.dtype);for(var c=new Jh([s,u],e.dtype),h=this.readSync(t.dataId),f=this.readSync(e.dataId),m=0;m<s;m++){for(var g=[],w=0,v=0;v<i;v++){var y=h[m*i+v];w+=y*l[v],g.push(y)}if(w<0||w>=e.size/u)throw new Error("Invalid indices: "+g+" does not index into "+e.shape);for(var x=0;x<u;x++)c.values[m*u+x]=f[w*u+x]}return c.toTensor().reshape(a)},n.prototype.scatterND=function(e,t,r){var i=dm(0,e,r),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=dt(0);return this.scatter(e,t,r,l,s,a,o,u,c,!0)},n.prototype.fill=function(e,t,r){var i=im(r=r||dd(t),Pt(e));return i.fill(t),at.make(e,{values:i},r)},n.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},n.prototype.zerosLike=function(e){var t=im(e.dtype,Pt(e.shape));return at.make(e.shape,{values:t},e.dtype)},n.prototype.linspace=function(e,t,r){return JC(e,t,r)},n.prototype.scatter=function(e,t,r,i,o,a,s,u,l,c){var h=[i/o,o],f=this.readSync(e.dataId),m=this.readSync(t.dataId);if(i===0)return di([],r,t.dtype);var g=new Jh(h,t.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var w=0;w<a;w++){for(var v=[],y=0,x=0;x<s;x++){var E=f[w*s+x];v.push(E),y+=E*u[x]}if(y<0||y>=i/o)throw new Error("Invalid indices: "+v+" does not index into "+r);for(var _=0;_<o;_++)c?g.values[y*o+_]+=m[w*o+_]:g.values[y*o+_]=t.rank===0?m[0]:m[w*o+_]}return g.toTensor().reshape(r)},n})();ve.registerBackend("cpu",function(){return new IO},1);var DO=(function(){function n(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}return n.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},n.prototype.decodeUTF8=function(e){return this.textDecoder.decode(e)},n.prototype.fetch=function(e,t){return fetch(e,t)},n})();be.get("IS_BROWSER")&&be.setPlatform("browser",new DO);var Dy,NO=function(){return require("node-fetch")},PO=(function(){function n(){var e=require("util");this.textEncoder=new e.TextEncoder,this.textDecoder=new e.TextDecoder}return n.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},n.prototype.decodeUTF8=function(e){return e.length===0?"":this.textDecoder.decode(e)},n.prototype.fetch=function(e,t){return be.global.fetch!=null?be.global.fetch(e,t):(Dy==null&&(Dy=NO()),Dy(e,t))},n})();be.get("IS_NODE")&&be.setPlatform("node",new PO);var e0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function xS(n){return e0?Buffer.byteLength(n):new Blob([n]).size}function FO(n){var e=0;n.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),r=0;return n.forEach(function(i){t.set(new Uint8Array(i),r),r+=i.byteLength}),t.buffer}function eg(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:xS(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:xS(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Zu=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach(function(o){var a=o(e,r);a!==null&&i.push(a)}),i},n})(),SS="://",FT=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){ee(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(SS)&&(e=e.slice(0,e.indexOf(SS))),ee(e.length>0,function(){return"scheme must not be an empty string."});var r=n.getInstance();ee(r.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})(),Gu="models_store",Ws="model_info_store";function OT(){if(!be.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function t0(n){var e=n.result;e.createObjectStore(Gu,{keyPath:"modelPath"}),e.createObjectStore(Ws,{keyPath:"modelPath"})}var wc=(function(){function n(e){if(this.indexedDB=OT(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},n.prototype.load=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},n.prototype.databaseAction=function(e,t){var r=this;return new Promise(function(i,o){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return t0(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(Gu,"readonly"),l=u.objectStore(Gu).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(w){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=eg(t),f=s.transaction(Ws,"readwrite"),m=f.objectStore(Ws),g=m.put({modelPath:r.modelPath,modelArtifactsInfo:h});g.onsuccess=function(){var w=(c=s.transaction(Gu,"readwrite")).objectStore(Gu).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});w.onsuccess=function(){return i({modelArtifactsInfo:h})},w.onerror=function(v){var y=(m=f.objectStore(Ws)).delete(r.modelPath);y.onsuccess=function(){return s.close(),o(w.error)},y.onerror=function(x){return s.close(),o(w.error)}}},g.onerror=function(w){return s.close(),o(g.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},n.URL_SCHEME="indexeddb://",n})(),ES=function(n){return be.getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(wc.URL_SCHEME)?(e=n.slice(wc.URL_SCHEME.length),new wc(e)):null;var e};Zu.registerSaveRouter(ES),Zu.registerLoadRouter(ES);var OO=(function(){function n(){this.indexedDB=OT()}return n.prototype.listModels=function(){return Gt(this,void 0,void 0,function(){var e=this;return Vt(this,function(t){return[2,new Promise(function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return t0(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(Ws,"readonly"),u=s.objectStore(Ws).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},n.prototype.removeModel=function(e){return Gt(this,void 0,void 0,function(){var t=this;return Vt(this,function(r){var i;return e=(i=e).startsWith(wc.URL_SCHEME)?i.slice(wc.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return t0(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Ws,"readwrite"),h=c.objectStore(Ws),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var m=h.delete(e),g=function(){var w=(u=l.transaction(Gu,"readwrite")).objectStore(Gu).delete(e);w.onsuccess=function(){return o(f.result.modelArtifactsInfo)},w.onerror=function(v){return a(f.error)}};m.onsuccess=g,m.onerror=function(w){return g(),l.close(),a(f.error)}},f.onerror=function(m){return l.close(),a(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},n})();if(be.getBool("IS_BROWSER"))try{FT.registerManager(wc.URL_SCHEME,new OO)}catch{}var La="/",sc="tensorflowjs_models",LT="info",LO="model_topology",BO="weight_specs",UO="weight_data",zO="model_metadata";function BT(n){return{info:[sc,n,LT].join(La),topology:[sc,n,LO].join(La),weightSpecs:[sc,n,BO].join(La),weightData:[sc,n,UO].join(La),modelMetadata:[sc,n,zO].join(La)}}function WO(n){var e=n.split(La);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(La)}var _c=(function(){function n(e){if(!be.getBool("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=BT(this.modelPath)}return n.prototype.save=function(e){return Gt(this,void 0,void 0,function(){var t,r,i;return Vt(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=eg(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(a=e.weightData,e0?Buffer.from(a).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(a))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}var a;return[2]})})},n.prototype.load=function(){return Gt(this,void 0,void 0,function(){var e,t,r,i,o,a,s;return Vt(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(l){if(e0){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),m=0;m<h.length;++m)f.set([h.charCodeAt(m)],m);return f.buffer})(s),[2,t]})})},n.URL_SCHEME="localstorage://",n})(),kS=function(n){return be.getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(_c.URL_SCHEME)?(e=n.slice(_c.URL_SCHEME.length),new _c(e)):null;var e};Zu.registerSaveRouter(kS),Zu.registerLoadRouter(kS);var HO=(function(){function n(){ee(be.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),ee(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return n.prototype.listModels=function(){return Gt(this,void 0,void 0,function(){var e,t,r,i,o,a;return Vt(this,function(s){for(e={},t=sc+La,r=La+LT,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(a=WO(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},n.prototype.removeModel=function(e){return Gt(this,void 0,void 0,function(){var t,r;return Vt(this,function(i){var o;if(e=(o=e).startsWith(_c.URL_SCHEME)?o.slice(_c.URL_SCHEME.length):o,t=BT(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]})})},n})();if(be.getBool("IS_BROWSER"))try{FT.registerManager(_c.URL_SCHEME,new HO)}catch{}var GO="model",VO=".json",jO=".weights.bin";function CS(n){return new Promise(function(e){return setTimeout(e)}).then(n)}var Ny=(function(){function n(e){if(!be.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=GO),this.modelTopologyFileName=e+VO,this.weightDataFileName=e+jO}return n.prototype.save=function(e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s;return Vt(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,CS(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,CS(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:eg(e)}]}})})},n.URL_SCHEME="downloads://",n})();function TS(n,e,t,r){(function(o){ee(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(n),(function(o,a){ee(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),ee(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),ee(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})})(t=t??0,r=r??1);var i=0;return Promise.all(n.map(function(o){return o.then(function(a){var s=t+ ++i/n.length*(r-t);return e(s),a}),o}))}function qO(n,e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c;return Vt(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?TC:e.fetchFunc,r=n.map(function(f){return t(f,e.requestInit)}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,TS(r,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,TS(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}Zu.registerSaveRouter(function(n){return be.getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ny.URL_SCHEME)?(e=n.slice(Ny.URL_SCHEME.length),e===void 0&&(e="model"),new Ny(e)):null;var e});var UT=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(ee(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=TC,ee(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&ee(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return Gt(this,void 0,void 0,function(){var t,r,i,o;return Vt(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:eg(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},n.prototype.load=function(){return Gt(this,void 0,void 0,function(){var e,t,r,i,o,a,s,u;return Vt(this,function(l){switch(l.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=l.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");l.label=2;case 2:return l.trys.push([2,4,,5]),[4,e.json()];case 3:return t=l.sent(),[3,5];case 4:throw l.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:u=l.sent(),a=u[0],s=u[1],l.label=7;case 7:return[2,{modelTopology:i,weightSpecs:a,weightData:s}]}})})},n.prototype.loadWeights=function(e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,f;return Vt(this,function(m){switch(m.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(g){var w=g.lastIndexOf("/"),v=g.lastIndexOf("?"),y=g.substring(0,w),x=v>w?g.substring(v):"";return[y+"/",x]})(t),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach(function(g){g.paths.forEach(function(w){h.push(a+w+o)})}),[4,qO(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=m.sent(),[2,[s,FO(f)]]}})})},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function MS(n){return n.match(UT.URL_SCHEME_REGEX)!=null}var RS=function(n,e){return(Array.isArray(n)?n.every(function(t){return MS(t)}):MS(n))?$O(n,{onProgress:e}):null};function $O(n,e){return new UT(n,e)}Zu.registerSaveRouter(RS),Zu.registerLoadRouter(RS);ue({confusionMatrix_:function(n,e,t){var r=J(n,"labels","confusionMatrix"),i=J(e,"predictions","confusionMatrix");ee(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),ee(r.rank===1,function(){return"Expected the rank of labels to be 1, but got "+r.rank}),ee(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),ee(r.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),ee(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=Kb(r.asType("int32"),t),a=Kb(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var XO=ue({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return ve.fromPixels(n,e)}}),YO=Object.freeze({toPixels:function(n,e){return Gt(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,A,I;return Vt(this,function(T){switch(T.label){case 0:if(t=J(n,"img","toPixels"),n instanceof at||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=T.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=T.sent(),h=c[0],f=c[1],m=h[0],g=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(m<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+m+" - "+g+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(m<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+m+" - "+g+"].")}for(w=t.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),y=0;y<i*o;++y)x=void 0,E=void 0,_=void 0,k=void 0,a===1?(x=s[y]*w,E=s[y]*w,_=s[y]*w,k=255):a===3?(x=s[3*y]*w,E=s[3*y+1]*w,_=s[3*y+2]*w,k=255):a===4&&(x=s[4*y]*w,E=s[4*y+1]*w,_=s[4*y+2]*w,k=s[4*y+3]*w),v[0+(C=4*y)]=Math.round(x),v[C+1]=Math.round(E),v[C+2]=Math.round(_),v[C+3]=Math.round(k);return e!=null&&(e.width=o,e.height=i,A=e.getContext("2d"),I=new ImageData(v,o,i),A.putImageData(I,0,0)),t!==n&&t.dispose(),[2,v]}})})},fromPixels:XO}),KO=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),JO=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function ol(n){ee(n.className!=null,function(){return"Class being registered does not have the static className property defined."}),ee(typeof n.className=="string",function(){return"className is required to be a string, but got type "+typeof n.className}),ee(n.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),JO.register(n)}var al=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Xa(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return yi(s),r?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return yN(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&yi(this.iterations_)},e.prototype.saveIterations=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:dt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Gt(this,void 0,void 0,function(){var r;return Vt(this,function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e})(KO);Object.defineProperty(al,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var QO=(function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=ve.backend.epsilon()),o}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:At(function(){return pn(a).variable(!1)})}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:At(function(){return pn(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;At(function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(f);var m=h.mul(-r.learningRate).add(a);a.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(yi(this.accumulatedGrads.map(function(t){return t.variable})),yi(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){var r;return Vt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="AdadeltaOptimizer",e})(al);ol(QO);var ZO=(function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:At(function(){return vc(a.shape,r.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable;At(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(ve.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&yi(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(al);ol(ZO);var eL=(function(n){function e(t,r,i,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],At(function(){a.accBeta1=dt(r).variable(),a.accBeta2=dt(i).variable()}),o==null&&(a.epsilon=ve.backend.epsilon()),a}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);At(function(){var o=_i(1,r.accBeta1),a=_i(1,r.accBeta2);i.forEach(function(s,u){var l=ve.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:At(function(){return pn(l).variable(!1)})}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:At(function(){return pn(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,m=h.mul(r.beta1).add(c.mul(1-r.beta1)),g=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),w=m.div(o),v=g.div(a);h.assign(m),f.assign(g);var y=w.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(y)}}),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&yi(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&yi(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){var r,i=this;return Vt(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),At(function(){i.accBeta1.assign(gm(i.beta1,i.iterations_+1)),i.accBeta2.assign(gm(i.beta2,i.iterations_+1))}),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(r,2*r).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(al);ol(eL);var tL=(function(n){function e(t,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],At(function(){s.iteration=dt(0).variable(),s.accBeta1=dt(r).variable()}),o==null&&(s.epsilon=ve.backend.epsilon()),s}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);At(function(){var o=_i(1,r.accBeta1),a=Zo(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach(function(s,u){var l=ve.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:pn(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:pn(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,m=h.mul(r.beta1).add(c.mul(1-r.beta1)),g=f.mul(r.beta2),w=c.abs(),v=g.maximum(w);h.assign(m),f.assign(v);var y=a.div(o).mul(m.div(v.add(r.epsilon))).add(l);l.assign(y)}}),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&yi(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&yi(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(r){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(al);ol(tL);var zT=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=ve.registeredVariables[i];At(function(){var u=r.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=BD(dt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(al);ol(zT);var nL=(function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=dt(o.momentum),o}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:At(function(){return pn(a).variable(!1)})});var s=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&At(function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&yi(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(r){return{name:r.originalName,tensor:r.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="MomentumOptimizer",e})(zT);ol(nL);var rL=(function(n){function e(t,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=n.call(this)||this;return s.learningRate=t,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=ve.backend.epsilon()),s}return Xa(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:At(function(){return pn(a).variable(!1)})}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:At(function(){return pn(a).variable(!1)})}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:At(function(){return pn(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;At(function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,f=h.mul(r.decay).add(s.mul(1-r.decay)),m=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(m);var g=a.sub(m);a.assign(g)}else{var w=u.mul(r.decay).add(s.square().mul(1-r.decay));m=l.mul(r.momentum).add(s.mul(r.learningRate).div(w.add(r.epsilon).sqrt())),u.assign(w),l.assign(m),g=a.sub(m),a.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&yi(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&yi(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&yi(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){var r;return Vt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(r,2*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(al);ol(rL);Me=AO;var WT=function(n,e){return(WT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,r){t.__proto__=r}||function(t,r){for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])})(n,e)};function Uo(n,e){function t(){this.constructor=n}WT(n,e),n.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function wt(n,e,t,r){return new(t||(t=Promise))((function(i,o){function a(l){try{u(r.next(l))}catch(c){o(c)}}function s(l){try{u(r.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t((function(c){c(l.value)})).then(a,s)}u((r=r.apply(n,[])).next())}))}function _t(n,e){var t,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return(function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,r&&(i=2&c[0]?r.return:c[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,c[1])).done)return i;switch(r=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,r=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(n,a)}catch(h){c=[6,h],r=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([u,l])}}}var iL=(function(){function n(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return n.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},n.prototype.registerFlag=function(e,t,r){if(this.flagRegistry[e]={evaluationFn:t,setHook:r},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},n.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},n.prototype.getNumber=function(e){return this.get(e)},n.prototype.getBool=function(e){return this.get(e)},n.prototype.getFlags=function(){return this.flags},Object.defineProperty(n.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),n.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},n.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},n.prototype.setFlags=function(e){this.flags=Object.assign({},e)},n.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},n.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,r,i=(t=this.global.location.search,r={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return oL(r,a[0],a[1]),a.join("=")})),r);"tfjsflags"in i&&i.tfjsflags.split(",").forEach((function(o){var a=o.split(":"),s=a[0],u=a[1];e.urlFlags[s]=(function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")})(s,u)}))}},n})();function oL(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Ne(){return HT}var HT=null,ym=new Map,n0=new Map;function GT(n,e){var t=jT(n,e);return ym.get(t)}function AS(n){return n0.get(n)}function IS(n){for(var e=ym.entries(),t=[];;){var r=e.next(),i=r.done,o=r.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===n&&t.push(s)}return t}function VT(n){var e=n.kernelName,t=n.backendName,r=jT(e,t);if(ym.has(r))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");ym.set(r,n)}function aL(n){var e=n.kernelName;n0.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),n0.set(e,n)}function jT(n,e){return e+"_"+n}function r0(n,e,t){return Math.max(n,Math.min(e,t))}function qT(n){return n%2==0?n:n+1}function sL(n){for(var e=0,t=0;t<n.length;t++)e+=n[t];return e}function K(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function En(n,e,t){t===void 0&&(t=""),K(wr(n,e),(function(){return t+" Shapes "+n+" and "+e+" must match"}))}function Yc(n){K(n!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function Fc(n,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(n)||ca(n)&&!t)for(var r=0;r<n.length;++r)Fc(n[r],e,t);else e.push(n);return e}function bt(n){if(n.length===0)return 1;for(var e=n[0],t=1;t<n.length;t++)e*=n[t];return e}function wr(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function Jn(n){return n%1==0}function uL(n){if(Math.tanh!=null)return Math.tanh(n);if(n===1/0)return 1;if(n===-1/0)return-1;var e=Math.exp(2*n);return(e-1)/(e+1)}function i0(n){var e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function xc(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function DS(n,e,t){return e===void 0&&(e=function(r){return 0}),new Promise((function(r,i){var o=0,a=function(){if(n())r();else{o++;var s=e(o);t!=null&&o>=t?i():setTimeout(a,s)}};a()}))}function lL(n,e){for(var t=1,r=-1,i=0;i<n.length;++i)if(n[i]>=0)t*=n[i];else if(n[i]===-1){if(r!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+i);r=i}else if(n[i]<0)throw Error("Shapes can not be < 0. Found "+n[i]+" at dim "+i);if(r===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+n);return n}if(t===0)throw Error("Cannot infer the missing size in ["+n+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=n.slice();return o[r]=e/t,o}function dr(n,e){var t=e.length;return K((n=n==null?e.map((function(r,i){return i})):[].concat(n)).every((function(r){return r>=-t&&r<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+n})),K(n.every((function(r){return Jn(r)})),(function(){return"All values in axis param must be integers but got axis "+n})),n.map((function(r){return r<0?t+r:r}))}function Uu(n,e){for(var t=[],r=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:dr(e,n).sort(),a=0,s=0;s<n.length;++s){if(o!=null){if(o[a]===s&&n[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+n[s]+"' is not 1");(o[a]==null||o[a]>s)&&n[s]===1&&(t.push(n[s]),r.push(s)),o[a]<=s&&a++}n[s]!==1&&(t.push(n[s]),r.push(s))}return{newShape:t,keptDims:r}}function Oc(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else{if(n!=="bool")throw new Error("Unknown data type "+n);t=new Uint8Array(e)}return t}function bm(n,e){var t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else{if(n!=="string")throw new Error("Unknown data type "+n);t=new Array(e)}return t}function cL(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function hL(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function dL(n,e){return e!=="complex64"&&(e!=="float32"||n==="complex64")&&(e!=="int32"||n==="float32"||n==="complex64")&&(e!=="bool"||n!=="bool")}function ca(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array}function $T(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error("Unknown dtype "+n)}function fL(n){if(n==null)return 0;var e=0;return n.forEach((function(t){return e+=t.length})),e}function Nw(n){return typeof n=="string"||n instanceof String}function pL(n){return typeof n=="boolean"}function mL(n){return typeof n=="number"}function Ed(n){return Array.isArray(n)?Ed(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array?"int32":mL(n)?"float32":Nw(n)?"string":pL(n)?"bool":"float32"}function o0(n){return!!(n&&n.constructor&&n.call&&n.apply)}function a0(n,e){for(var t=e;t<n;++t)if(n%t==0)return t;return n}function Ui(n){var e=n.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=n[e-1];for(var r=e-3;r>=0;--r)t[r]=t[r+1]*n[r+1];return t}function XT(n,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Fc(n)),t&&cL(n,e),(function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"})(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){for(var r=new Uint8Array(n.length),i=0;i<r.length;++i)Math.round(n[i])!==0&&(r[i]=1);return r}throw new Error("Unknown data type "+e)}function NS(n,e){if(n.length===0)return e[0];var t=n.reduce((function(r,i){return r*i}));if(t===0)return[];if(t!==e.length)throw new Error("["+n+"] does not match the input size.");return(function r(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce((function(f,m){return f*m}));for(l=0;l<u;l++)s[l]=r(i+l*h,c,a)}return s})(0,n,e)}function YT(n,e){for(var t=kd(n,e),r=0;r<t.length;r++)t[r]=1;return t}function kd(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error("Unknown data type "+e)}function ea(){return Ne().platform.now()}function KT(n){n.forEach((function(e){K(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+n+"]."}))}))}function gL(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ne().platform.encode(n,e)}function wm(n,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ne().platform.decode(n,e)}function s0(n,e,t){if(e===0)return 0;if(e===1)return n[0];for(var r=n[n.length-1],i=0;i<n.length-1;++i)r+=t[i]*n[i];return r}function JT(n,e,t){if(e===0)return[];if(e===1)return[n];for(var r=new Array(e),i=0;i<r.length-1;++i)r[i]=Math.floor(n/t[i]),n-=r[i]*t[i];return r[r.length-1]=n,r}var vL=(function(){function n(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new yL)}return n.prototype.profileKernel=function(e,t,r){var i,o=this,a=this.backendTimer.time((function(){i=r()}));return i.forEach((function(s){s.data().then((function(u){(function(l,c,h){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var m=l[f];if(isNaN(m)||!isFinite(m))return console.warn("Found "+m+" in the result of '"+h+"'"),!0}})(u,s.dtype,e),a.then((function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,s,u,l.kernelMs,t,c)}))}))})),i},n})(),yL=(function(){function n(){}return n.prototype.logKernelProfile=function(e,t,r,i,o,a){var s=typeof i=="number"?xc(i+"ms",9):i.error,u=xc(e,25),l=t.rank,c=t.size,h=xc(t.shape.toString(),14),f="";for(var m in o){var g=o[m].shape||t.shape,w=g.length;f+=m+": "+w+"D "+(w>0?g:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+h+"	%c"+c+"	%c"+f+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},n})(),PS=20,Fh=3,Py=7;function bL(n,e,t,r){var i=Ui(e),o=(function(l,c,h,f){var m=bt(c),g=f[f.length-1],w=new Array(g).fill(0),v=c.length,y=h==="complex64"?Lh(l):l;if(v>1)for(var x=0;x<m/g;x++)for(var E=x*g,_=0;_<g;_++)w[_]=Math.max(w[_],Oh(y[E+_],0,h).length);return w})(n,e,t,i),a=e.length,s=(function l(c,h,f,m,g,w){w===void 0&&(w=!0);var v=f==="complex64"?2:1,y=h[0],x=h.length;if(x===0)return f==="complex64"?[Oh(Lh(c)[0],0,f)]:f==="bool"?[QT(c[0])]:[c[0].toString()];if(x===1){if(y>PS){var E=Fh*v,_=Array.from(c.slice(0,E)),k=Array.from(c.slice((y-Fh)*v,y*v));return f==="complex64"&&(_=Lh(_),k=Lh(k)),["["+_.map((function(B,U){return Oh(B,g[U],f)})).join(", ")+", ..., "+k.map((function(B,U){return Oh(B,g[y-Fh+U],f)})).join(", ")+"]"]}return["["+(f==="complex64"?Lh(c):Array.from(c)).map((function(B,U){return Oh(B,g[U],f)})).join(", ")+"]"]}var C=h.slice(1),A=m.slice(1),I=m[0]*v,T=[];if(y>PS){for(var R=0;R<Fh;R++){var N=(O=R*I)+I;T.push.apply(T,l(c.slice(O,N),C,f,A,g,!1))}for(T.push("..."),R=y-Fh;R<y;R++)N=(O=R*I)+I,T.push.apply(T,l(c.slice(O,N),C,f,A,g,R===y-1))}else for(R=0;R<y;R++){var O;N=(O=R*I)+I,T.push.apply(T,l(c.slice(O,N),C,f,A,g,R===y-1))}var V=x===2?",":"";for(T[0]="["+T[0]+V,R=1;R<T.length-1;R++)T[R]=" "+T[R]+V;var F=`,
`;for(R=2;R<x;R++)F+=`
`;return T[T.length-1]=" "+T[T.length-1]+"]"+(w?"":F),T})(n,e,t,i,o),u=["Tensor"];return r&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(l){return"    "+l})).join(`
`)),u.join(`
`)}function Oh(n,e,t){return xc(Array.isArray(n)?parseFloat(n[0].toFixed(Py))+" + "+parseFloat(n[1].toFixed(Py))+"j":Nw(n)?"'"+n+"'":t==="bool"?QT(n):parseFloat(n.toFixed(Py)).toString(),e)}function QT(n){return n===0?"false":"true"}function Lh(n){for(var e=[],t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}var ed=(function(){function n(e,t,r){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=bt(e),r!=null){var o=r.length;K(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||bm(t,this.size),this.strides=Ui(e)}return n.prototype.set=function(e){for(var t=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];r.length===0&&(r=[0]),K(r.length===this.rank,(function(){return"The number of provided coordinates ("+r.length+") must match the rank ("+t.rank+")"}));var o=this.locToIndex(r);this.values[o]=e},n.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var r=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[r]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}r++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},n.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],r=0;r<e.length-1;++r)t+=this.strides[r]*e[r];return t},n.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),r=0;r<t.length-1;++r)t[r]=Math.floor(e/this.strides[r]),e-=t[r]*this.strides[r];return t[t.length-1]=e,t},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.toTensor=function(){return ra().makeTensor(this.values,this.shape,this.dtype)},n})(),ra=null,Ie=null,ZT=null,Nn=(function(){function n(e,t,r,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=bt(e),this.strides=Ui(e),this.dataId=r,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return n.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},n.prototype.asScalar=function(){return this.throwIfDisposed(),K(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},n.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},n.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},n.prototype.as3D=function(e,t,r){return this.throwIfDisposed(),this.reshape([e,t,r])},n.prototype.as4D=function(e,t,r,i){return this.throwIfDisposed(),this.reshape([e,t,r,i])},n.prototype.as5D=function(e,t,r,i,o){return this.throwIfDisposed(),this.reshape([e,t,r,i,o])},n.prototype.asType=function(e){return this.throwIfDisposed(),Ie.cast(this,e)},Object.defineProperty(n.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),n.prototype.buffer=function(){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ie.buffer(this.shape,this.dtype,e)]}}))}))},n.prototype.bufferSync=function(){return Ie.buffer(this.shape,this.dtype,this.dataSync())},n.prototype.array=function(){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,NS(this.shape,e)]}}))}))},n.prototype.arraySync=function(){return NS(this.shape,this.dataSync())},n.prototype.data=function(){return wt(this,void 0,void 0,(function(){var e,t;return _t(this,(function(r){switch(r.label){case 0:return this.throwIfDisposed(),e=ra().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=r.sent();try{return[2,t.map((function(i){return wm(i)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}r.label=2;case 2:return[2,e]}}))}))},n.prototype.dataSync=function(){this.throwIfDisposed();var e=ra().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return wm(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},n.prototype.bytes=function(){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,ra().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},n.prototype.dispose=function(){this.isDisposed||(ra().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(n.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),n.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},n.prototype.toFloat=function(){return this.asType("float32")},n.prototype.toInt=function(){return this.asType("int32")},n.prototype.toBool=function(){return this.asType("bool")},n.prototype.print=function(e){return e===void 0&&(e=!1),Ie.print(this,e)},n.prototype.reshape=function(e){return this.throwIfDisposed(),Ie.reshape(this,e)},n.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},n.prototype.expandDims=function(e){return e===void 0&&(e=0),Ie.expandDims(this,e)},n.prototype.cumsum=function(e,t,r){return e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1),Ie.cumsum(this,e,t,r)},n.prototype.squeeze=function(e){return this.throwIfDisposed(),Ie.squeeze(this,e)},n.prototype.clone=function(){return this.throwIfDisposed(),Ie.clone(this)},n.prototype.toString=function(e){return e===void 0&&(e=!1),bL(this.dataSync(),this.shape,this.dtype,e)},n.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ie.gather(this,e,t)},n.prototype.matMul=function(e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!1),this.throwIfDisposed(),Ie.matMul(this,e,t,r)},n.prototype.dot=function(e){return this.throwIfDisposed(),Ie.dot(this,e)},n.prototype.norm=function(e,t,r){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1),this.throwIfDisposed(),Ie.norm(this,e,t,r)},n.prototype.slice=function(e,t){return this.throwIfDisposed(),Ie.slice(this,e,t)},n.prototype.reverse=function(e){return this.throwIfDisposed(),Ie.reverse(this,e)},n.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof n&&(e=[e]),Ie.concat([this].concat(e),t)},n.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ie.split(this,e,t)},n.prototype.stack=function(e,t){return t===void 0&&(t=0),Ie.stack([this,e],t)},n.prototype.unstack=function(e){return e===void 0&&(e=0),Ie.unstack(this,e)},n.prototype.batchNormalization=function(e,t,r,i,o){return r===void 0&&(r=.001),ZT("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,r)},n.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.all(this,e,t)},n.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.any(this,e,t)},n.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.logSumExp(this,e,t)},n.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.sum(this,e,t)},n.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.prod(this,e,t)},n.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.mean(this,e,t)},n.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.min(this,e,t)},n.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.max(this,e,t)},n.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ie.argMin(this,e)},n.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ie.argMax(this,e)},n.prototype.cast=function(e){return this.throwIfDisposed(),Ie.cast(this,e)},n.prototype.addStrict=function(e){return this.throwIfDisposed(),Ie.addStrict(this,e)},n.prototype.atan2=function(e){return this.throwIfDisposed(),Ie.atan2(this,e)},n.prototype.sub=function(e){return this.throwIfDisposed(),Ie.sub(this,e)},n.prototype.subStrict=function(e){return this.throwIfDisposed(),Ie.subStrict(this,e)},n.prototype.pow=function(e){return this.throwIfDisposed(),Ie.pow(this,e)},n.prototype.powStrict=function(e){return this.throwIfDisposed(),Ie.powStrict(this,e)},n.prototype.mul=function(e){return this.throwIfDisposed(),Ie.mul(this,e)},n.prototype.mulStrict=function(e){return this.throwIfDisposed(),Ie.mulStrict(this,e)},n.prototype.floorDiv=function(e){return this.throwIfDisposed(),Ie.floorDiv(this,e)},n.prototype.divStrict=function(e){return this.throwIfDisposed(),Ie.divStrict(this,e)},n.prototype.minimum=function(e){return this.throwIfDisposed(),Ie.minimum(this,e)},n.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Ie.minimumStrict(this,e)},n.prototype.maximum=function(e){return this.throwIfDisposed(),Ie.maximum(this,e)},n.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Ie.maximumStrict(this,e)},n.prototype.mod=function(e){return this.throwIfDisposed(),Ie.mod(this,e)},n.prototype.modStrict=function(e){return this.throwIfDisposed(),Ie.modStrict(this,e)},n.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Ie.squaredDifferenceStrict(this,e)},n.prototype.notEqual=function(e){return this.throwIfDisposed(),Ie.notEqual(this,e)},n.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Ie.notEqualStrict(this,e)},n.prototype.less=function(e){return this.throwIfDisposed(),Ie.less(this,e)},n.prototype.lessStrict=function(e){return this.throwIfDisposed(),Ie.lessStrict(this,e)},n.prototype.equal=function(e){return this.throwIfDisposed(),Ie.equal(this,e)},n.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ie.equalStrict(this,e)},n.prototype.lessEqual=function(e){return this.throwIfDisposed(),Ie.lessEqual(this,e)},n.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Ie.lessEqualStrict(this,e)},n.prototype.greater=function(e){return this.throwIfDisposed(),Ie.greater(this,e)},n.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Ie.greaterStrict(this,e)},n.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ie.greaterEqual(this,e)},n.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ie.greaterEqualStrict(this,e)},n.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ie.logicalAnd(this,e)},n.prototype.logicalOr=function(e){return this.throwIfDisposed(),Ie.logicalOr(this,e)},n.prototype.logicalNot=function(){return this.throwIfDisposed(),Ie.logicalNot(this)},n.prototype.logicalXor=function(e){return this.throwIfDisposed(),Ie.logicalXor(this,e)},n.prototype.where=function(e,t){return this.throwIfDisposed(),Ie.where(e,this,t)},n.prototype.neg=function(){return this.throwIfDisposed(),Ie.neg(this)},n.prototype.ceil=function(){return this.throwIfDisposed(),Ie.ceil(this)},n.prototype.floor=function(){return this.throwIfDisposed(),Ie.floor(this)},n.prototype.sign=function(){return this.throwIfDisposed(),Ie.sign(this)},n.prototype.isNaN=function(){return this.throwIfDisposed(),Ie.isNaN(this)},n.prototype.isInf=function(){return this.throwIfDisposed(),Ie.isInf(this)},n.prototype.isFinite=function(){return this.throwIfDisposed(),Ie.isFinite(this)},n.prototype.exp=function(){return this.throwIfDisposed(),Ie.exp(this)},n.prototype.expm1=function(){return this.throwIfDisposed(),Ie.expm1(this)},n.prototype.log=function(){return this.throwIfDisposed(),Ie.log(this)},n.prototype.log1p=function(){return this.throwIfDisposed(),Ie.log1p(this)},n.prototype.sqrt=function(){return this.throwIfDisposed(),Ie.sqrt(this)},n.prototype.rsqrt=function(){return this.throwIfDisposed(),Ie.rsqrt(this)},n.prototype.square=function(){return this.throwIfDisposed(),Ie.square(this)},n.prototype.reciprocal=function(){return this.throwIfDisposed(),Ie.reciprocal(this)},n.prototype.abs=function(){return this.throwIfDisposed(),Ie.abs(this)},n.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ie.clipByValue(this,e,t)},n.prototype.relu=function(){return this.throwIfDisposed(),Ie.relu(this)},n.prototype.relu6=function(){return this.throwIfDisposed(),Ie.relu6(this)},n.prototype.elu=function(){return this.throwIfDisposed(),Ie.elu(this)},n.prototype.selu=function(){return this.throwIfDisposed(),Ie.selu(this)},n.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Ie.leakyRelu(this,e)},n.prototype.prelu=function(e){return this.throwIfDisposed(),Ie.prelu(this,e)},n.prototype.sigmoid=function(){return this.throwIfDisposed(),Ie.sigmoid(this)},n.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ie.logSigmoid(this)},n.prototype.softplus=function(){return this.throwIfDisposed(),Ie.softplus(this)},n.prototype.zerosLike=function(){return this.throwIfDisposed(),Ie.zerosLike(this)},n.prototype.onesLike=function(){return this.throwIfDisposed(),Ie.onesLike(this)},n.prototype.sin=function(){return this.throwIfDisposed(),Ie.sin(this)},n.prototype.cos=function(){return this.throwIfDisposed(),Ie.cos(this)},n.prototype.tan=function(){return this.throwIfDisposed(),Ie.tan(this)},n.prototype.asin=function(){return this.throwIfDisposed(),Ie.asin(this)},n.prototype.acos=function(){return this.throwIfDisposed(),Ie.acos(this)},n.prototype.atan=function(){return this.throwIfDisposed(),Ie.atan(this)},n.prototype.sinh=function(){return this.throwIfDisposed(),Ie.sinh(this)},n.prototype.cosh=function(){return this.throwIfDisposed(),Ie.cosh(this)},n.prototype.tanh=function(){return this.throwIfDisposed(),Ie.tanh(this)},n.prototype.asinh=function(){return this.throwIfDisposed(),Ie.asinh(this)},n.prototype.acosh=function(){return this.throwIfDisposed(),Ie.acosh(this)},n.prototype.atanh=function(){return this.throwIfDisposed(),Ie.atanh(this)},n.prototype.erf=function(){return this.throwIfDisposed(),Ie.erf(this)},n.prototype.round=function(){return this.throwIfDisposed(),Ie.round(this)},n.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Ie.step(this,e)},n.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ie.softmax(this,e)},n.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ie.logSoftmax(this,e)},n.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ie.image.resizeBilinear(this,e,t)},n.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ie.image.resizeNearestNeighbor(this,e,t)},n.prototype.conv1d=function(e,t,r,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Ie.conv1d(this,e,t,r,i,o,a)},n.prototype.conv2d=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Ie.conv2d(this,e,t,r,i,o,a)},n.prototype.conv2dTranspose=function(e,t,r,i,o){return this.throwIfDisposed(),Ie.conv2dTranspose(this,e,t,r,i,o)},n.prototype.depthwiseConv2D=function(e,t,r,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Ie.depthwiseConv2d(this,e,t,r,i,o,a)},n.prototype.separableConv2d=function(e,t,r,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),Ie.separableConv2d(this,e,t,r,i,o,a)},n.prototype.avgPool=function(e,t,r,i){return this.throwIfDisposed(),Ie.avgPool(this,e,t,r,i)},n.prototype.maxPool=function(e,t,r,i){return this.throwIfDisposed(),Ie.maxPool(this,e,t,r,i)},n.prototype.localResponseNormalization=function(e,t,r,i){return e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5),Ie.localResponseNormalization(this,e,t,r,i)},n.prototype.pool=function(e,t,r,i,o){return this.throwIfDisposed(),Ie.pool(this,e,t,r,i,o)},n.prototype.variable=function(e,t,r){return e===void 0&&(e=!0),this.throwIfDisposed(),ra().makeVariable(this,e,t,r)},n.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Ie.unsortedSegmentSum(this,e,t)},n.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Ie.batchToSpaceND(this,e,t)},n.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Ie.spaceToBatchND(this,e,t)},n.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Ie.topk(this,e,t)},n.prototype.stridedSlice=function(e,t,r,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),Ie.stridedSlice(this,e,t,r,i,o,a,s,u)},n.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ie.depthToSpace(this,e,t)},n.prototype.fft=function(){return this.throwIfDisposed(),Ie.spectral.fft(this)},n.prototype.ifft=function(){return this.throwIfDisposed(),Ie.spectral.ifft(this)},n.prototype.rfft=function(){return this.throwIfDisposed(),Ie.spectral.rfft(this)},n.prototype.irfft=function(){return this.throwIfDisposed(),Ie.spectral.irfft(this)},n})();Object.defineProperty(Nn,Symbol.hasInstance,{value:function(n){return!!n&&n.dataId!=null&&n.shape!=null&&n.dtype!=null}});var FS,u0,l0,c0,h0,Lc=(function(n){function e(t,r,i,o){var a=n.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=r,a.name=i,a}return Uo(e,n),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!wr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");ra().disposeTensor(this),this.dataId=t.dataId,ra().incRef(this,null)},e.prototype.dispose=function(){ra().disposeVariable(this),this.isDisposedInternal=!0},e})(Nn);Object.defineProperty(Lc,Symbol.hasInstance,{value:function(n){return n instanceof Nn&&n.assign!=null&&n.assign instanceof Function}}),(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(FS||(FS={})),(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(u0||(u0={})),(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(l0||(l0={})),(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(c0||(c0={})),(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(h0||(h0={}));var wL={float32:c0,int32:u0,bool:l0,complex64:h0};function kr(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error("Can not upcast "+n+" with "+e)}return wL[n][e]}function Fy(n){return kr(n,"int32")}function Gn(n,e){if(n.dtype===e.dtype)return[n,e];var t=kr(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function _L(n,e){K(n.dtype===e.dtype,(function(){return"The dtypes of the first("+n.dtype+") and second("+e.dtype+") input must match"}))}function e3(n){var e=[];return(function t(r,i,o){if(r!=null){if(r instanceof Nn)return void i.push(r);if(a=r,!(!Array.isArray(a)&&typeof a!="object")){var a,s=r;for(var u in s){var l=s[u];o.has(l)||(o.add(l),t(l,i,o))}}}})(n,e,new Set),e}var Oy,OS=(function(){function n(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return n.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},n})(),xL=(function(){function n(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new OS}return n.prototype.ready=function(){return wt(this,void 0,void 0,(function(){var e,t,r;return _t(this,(function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(r=e[t],[4,this.initializeBackend(r).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(r)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(n.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),n.prototype.backendNames=function(){return Object.keys(this.registryFactory)},n.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},n.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},n.prototype.registerBackend=function(e,t,r){return r===void 0&&(r=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:r},!0)},n.prototype.setBackend=function(e){return wt(this,void 0,void 0,(function(){var t,r,i;return _t(this,(function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),r=t.success,t.asyncInit?[4,r]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=r,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new vL(this.backendInstance),[2,!0]}}))}))},n.prototype.setupRegisteredKernels=function(){var e=this;IS(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},n.prototype.disposeRegisteredKernels=function(e){var t=this;IS(e).forEach((function(r){r.disposeFunc!=null&&r.disposeFunc(t.registry[e])}))},n.prototype.initializeBackend=function(e){var t=this,r=this.registryFactory[e];if(r==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=r.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then((function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)})).catch((function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},n.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},n.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,r){return e.registryFactory[r].priority-e.registryFactory[t].priority}))},n.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var r=e[t],i=this.initializeBackend(r),o=i.success,a=i.asyncInit;if(a||o)return{name:r,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},n.prototype.moveData=function(e,t){var r=this.state.tensorInfo.get(t),i=r.backend,o=this.readSync(t);i.disposeData(t),r.backend=e,e.move(t,o,r.shape,r.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},n.prototype.tidy=function(e,t){var r,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun((function(){return i.startScope(o)}),(function(){return i.endScope(r)}),(function(){return(r=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r}))},n.prototype.scopedRun=function(e,t,r){e();try{var i=r();return t(),i}catch(o){throw t(),o}},n.prototype.nextTensorId=function(){return n.nextTensorId++},n.prototype.nextVariableId=function(){return n.nextVariableId++},n.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),r={x:e};return this.addTapeNode(this.state.activeScope.name,r,[t],(function(i){return{x:function(){return i.toFloat()}}}),[],{}),t},n.prototype.runKernel=function(e,t,r,i,o){return this.runKernelFunc(null,t,null,e,r,i,o)},n.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},n.prototype.checkKernelForMemLeak=function(e,t,r){var i=this.backend.numDataIds(),o=0;r.forEach((function(u){o+=u.dtype==="complex64"?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},n.prototype.runKernelFunc=function(e,t,r,i,o,a,s){var u,l=this,c=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var f,m=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var w,v=GT(i,this.backendName);if(v!=null)f=function(){var x=l.backend.numDataIds();w=v.kernelFunc({inputs:t,attrs:o,backend:l.backend});var E=Array.isArray(w)?w:[w];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,E);var _=E.map((function(A){var I=A.dataId,T=A.shape,R=A.dtype;return l.makeTensorFromDataId(I,T,R)}));if(h){var k=l.getTensorsForGradient(i,t,_);if(k==null){s==null&&(s=[]);var C=_.filter((function(A,I){return s[I]}));k=(a||[]).slice().concat(C)}c=l.saveTensorsForBackwardMode(k)}return _};else{var y=function(x){h&&(c=x.map((function(E){return l.keep(l.clone(E))})))};f=function(){var x=l.backend.numDataIds();w=l.tidy((function(){return e(l.backend,y)}));var E=Array.isArray(w)?w:[w];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,E),E}}return this.scopedRun((function(){return l.state.kernelDepth++}),(function(){return l.state.kernelDepth--}),(function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,t,(function(){return f()})):f()})),h&&this.addTapeNode(i,t,u,r,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(x){return t[x].shape})),outputShapes:u.map((function(x){return x.shape}))}),Array.isArray(w)?u:u[0]},n.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(r){return t.keep(t.clone(r))}))},n.prototype.getTensorsForGradient=function(e,t,r){var i=AS(e);if(i!=null){var o=i.inputsToSave||[],a=i.outputsToSave||[],s=void 0;i.saveAllInputs?(K(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),s=Object.keys(t).map((function(l){return t[l]}))):s=o.map((function(l){return t[l]}));var u=r.filter((function(l,c){return a[c]}));return s.concat(u)}return null},n.prototype.makeTensor=function(e,t,r,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");r=r||"float32",i=i||this.backend;var o=e;r==="string"&&Nw(e[0])&&(o=e.map((function(c){return gL(c)})));var a=i.write(o,t,r),s=new Nn(t,r,a,this.nextTensorId());if(this.incRef(s,i),r==="string"){var u=this.state.tensorInfo.get(a),l=fL(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},n.prototype.makeTensorFromDataId=function(e,t,r,i){var o=new Nn(t,r=r||"float32",e,this.nextTensorId());return this.incRef(o,i),o},n.prototype.makeVariable=function(e,t,r,i){t===void 0&&(t=!0),r=r||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Lc(e,t,r,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},n.prototype.incRef=function(e,t){var r=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,r===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*$T(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Lc||this.track(e)},n.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},n.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},n.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},n.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},n.prototype.profile=function(e){return wt(this,void 0,void 0,(function(){var t,r;return _t(this,(function(i){return this.state.profiling=!0,t=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(o){return o.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-r,[2,this.state.activeProfile]}))}))},n.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},n.prototype.addTapeNode=function(e,t,r,i,o,a){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:r,saved:o},l=AS(e);l!=null&&(i=l.gradFunc),i!=null&&(u.gradient=function(c){return c=c.map((function(h,f){if(h==null){var m=r[f],g=kd(m.size,m.dtype);return s.makeTensor(g,m.shape,m.dtype)}return h})),i(c.length>1?c:c[0],o,a)}),this.state.activeTape.push(u)},n.prototype.keep=function(e){return e.kept=!0,e},n.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},n.prototype.endTape=function(){this.state.gradientDepth--},n.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},n.prototype.endScope=function(e){for(var t=this,r=e3(e),i=new Set(r.map((function(u){return u.id}))),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach((function(u){u.kept||u.scopeId!==s.id||t.track(u)}))},n.prototype.gradients=function(e,t,r,i){var o=this;if(i===void 0&&(i=!1),K(t.length>0,(function(){return"gradients() received an empty list of xs."})),r!=null&&r.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+r.dtype+"'");var a=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",e)}));K(a instanceof Nn,(function(){return"The result y returned by f() must be a tensor."}));var s=(function(u,l,c){for(var h={},f={},m=0;m<l.length;m++)h[l[m].id]=!0;for(m=0;m<u.length;m++){var g=(C=u[m]).inputs;for(var w in g){for(var v=g[w],y=!1,x=0;x<l.length;x++)if(h[v.id]){C.outputs.forEach((function(R){return h[R.id]=!0})),y=!0,f[C.id]=!0;break}if(y)break}}var E={};E[c.id]=!0;var _={};for(m=u.length-1;m>=0;m--)for(g=(C=u[m]).inputs,x=0;x<C.outputs.length;x++)if(E[C.outputs[x].id]){for(var w in g)E[g[w].id]=!0,_[C.id]=!0;break}var k=[];for(m=0;m<u.length;m++){var C;if(f[(C=u[m]).id]&&_[C.id]){var A={};for(var w in C.inputs){var I=C.inputs[w];h[I.id]&&(A[w]=I)}var T=Object.assign({},C);T.inputs=A,T.outputs=C.outputs,k.push(T)}}return k})(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var u,l,c={};c[a.id]=r??(u=a.shape,l=YT(bt(u),"float32"),le.makeTensor(l,u,"float32")),(function(f,m,g){for(var w=function(y){var x=m[y],E=[];if(x.outputs.forEach((function(A){var I=f[A.id];I!=null?E.push(I):E.push(null)})),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var _=x.gradient(E),k=function(A){if(!(A in _))throw new Error("Cannot backprop through input "+A+". Available gradients found: "+Object.keys(_)+".");var I=g((function(){return _[A]()}));if(I.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+A+" must have 'float32' dtype, but has '"+I.dtype+"'");var T=x.inputs[A];if(!wr(I.shape,T.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+A+"' has shape '"+I.shape+"', which does not match the shape of the input '"+T.shape+"'");if(f[T.id]==null)f[T.id]=I;else{var R=f[T.id];f[T.id]=R.add(I),R.dispose()}};for(var C in x.inputs)k(C)},v=m.length-1;v>=0;v--)w(v)})(c,s,(function(f){return o.tidy(f)}));var h=t.map((function(f){return c[f.id]}));return o.state.gradientDepth===0&&(o.state.activeTape.forEach((function(f){for(var m=0,g=f.saved;m<g.length;m++)g[m].dispose()})),o.state.activeTape=null),{value:a,grads:h}}))},n.prototype.customGrad=function(e){var t=this;return K(o0(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var r,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];K(i.every((function(s){return s instanceof Nn})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return i.forEach((function(s,u){a[u]=s})),t.runKernelFunc((function(s,u){return K((r=e.apply(void 0,i.concat([u]))).value instanceof Nn,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),K(o0(r.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),r.value}),a,(function(s,u){var l=r.gradFunc(s,u),c=Array.isArray(l)?l:[l];K(c.length===i.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),K(c.every((function(f){return f instanceof Nn})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var h={};return c.forEach((function(f,m){h[m]=function(){return f}})),h}))}},n.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},n.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},n.prototype.time=function(e){return wt(this,void 0,void 0,(function(){var t,r;return _t(this,(function(i){switch(i.label){case 0:return t=ea(),[4,this.backend.time(e)];case 1:return(r=i.sent()).wallMs=ea()-t,[2,r]}}))}))},n.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(n.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),n.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new OS,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},n.nextTensorId=0,n.nextVariableId=0,n})(),le=(function(){var n=(function(){if(Oy==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}Oy=t}return Oy})();if(n._tfengine==null){var e=new iL(n);n._tfengine=new xL(e)}return(function(t){HT=t})(n._tfengine.ENV),ra=function(){return n._tfengine},n._tfengine})();function t3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ra=Ne();Ra.registerFlag("DEBUG",(function(){return!1}),(function(n){n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ra.registerFlag("IS_BROWSER",(function(){return t3()})),Ra.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Ra.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ra.registerFlag("PROD",(function(){return!1})),Ra.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ra.getBool("DEBUG")})),Ra.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ra.registerFlag("IS_TEST",(function(){return!1}));var td,Oi,Pi,Pu={},Ly={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function SL(n,e){Pu[n]=e}function va(n){n in Pu||(Pu[n]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var r=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return r.addEventListener("webglcontextlost",(function(i){i.preventDefault(),delete Pu[t]}),!1),t===1?r.getContext("webgl",Ly)||r.getContext("experimental-webgl",Ly):r.getContext("webgl2",Ly)})(n));var e=Pu[n];return e.isContextLost()?(delete Pu[n],va(n)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Pu[n])}function tg(n,e){return[e,n]}function qh(n){var e=bt(n);return i0(Math.ceil(e/4))}function Cd(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function Pw(n,e){var t,r,i,o,a,s,u,l,c,h=n;return Ne().getNumber("WEBGL_VERSION")===2?(t=h.R32F,r=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(t=n.RGBA,r=n.RGBA,i=n.RGBA,o=h.RGBA,a=n.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=n.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:n.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function kt(n,e,t){var r=t();return e&&(function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+TL(i,o))})(n),r}(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(td||(td={})),(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Oi||(Oi={})),(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Pi||(Pi={}));var EL=596e-10,kL=65504;function CL(n){return!!(Ne().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||EL<Math.abs(n)&&Math.abs(n)<kL)}function TL(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function op(n,e,t){return Qa(n,e,(function(){return n.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function ML(n,e,t){var r=Qa(n,e,(function(){return n.createShader(n.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(kt(n,e,(function(){return n.shaderSource(r,t)})),kt(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function RL(n,e,t){var r=Qa(n,e,(function(){return n.createShader(n.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(kt(n,e,(function(){return n.shaderSource(r,t)})),kt(n,e,(function(){return n.compileShader(r)})),n.getShaderParameter(r,n.COMPILE_STATUS)===!1)throw(function(i,o){var a=AL.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map((function(v,y){return xc((y+1).toString(),l)+v})),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var m=c.slice(0,s-1),g=c.slice(s-1,s),w=c.slice(s);console.log(m.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+xc(g[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))})(t,n.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var By,Uy,AL=/ERROR: [0-9]+:([0-9]+):/g;function IL(n,e){return Qa(n,e,(function(){return n.createProgram()}),"Unable to create WebGLProgram.")}function DL(n,e,t){if(kt(n,e,(function(){return n.linkProgram(t)})),n.getProgramParameter(t,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function zy(n,e,t){if(kt(n,e,(function(){return n.validateProgram(t)})),n.getProgramParameter(t,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function NL(n,e,t){var r=Qa(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return kt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),kt(n,e,(function(){return n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function PL(n,e,t){var r=Qa(n,e,(function(){return n.createBuffer()}),"Unable to create WebGLBuffer");return kt(n,e,(function(){return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r)})),kt(n,e,(function(){return n.bufferData(n.ELEMENT_ARRAY_BUFFER,t,n.STATIC_DRAW)})),r}function FL(n,e){return Qa(n,e,(function(){return n.createTexture()}),"Unable to create WebGLTexture.")}function OL(n,e){var t=Ne().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){var r="["+n+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(n>t||e>t)throw r="["+n+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function LL(n,e){return Qa(n,e,(function(){return n.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function LS(n,e,t,r,i,o,a,s){var u=n.getAttribLocation(t,r);return u!==-1&&(kt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,i)})),kt(n,e,(function(){return n.vertexAttribPointer(u,o,n.FLOAT,!1,a,s)})),kt(n,e,(function(){return n.enableVertexAttribArray(u)})),!0)}function BL(n,e,t,r){GL(n,r),kt(n,e,(function(){return n.activeTexture(n.TEXTURE0+r)})),kt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)}))}function UL(n,e,t,r){return Qa(n,e,(function(){return n.getUniformLocation(t,r)}),'uniform "'+r+'" not present in program.')}function zL(n,e,t){return n.getUniformLocation(e,t)}function WL(n,e,t,r,i,o){kt(n,e,(function(){return BL(n,e,r,o)})),kt(n,e,(function(){return n.uniform1i(i,o)}))}function Wy(n,e,t,r){kt(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,r)})),kt(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}))}function BS(n,e,t){kt(n,e,(function(){return n.bindFramebuffer(n.FRAMEBUFFER,t)})),kt(n,e,(function(){return n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0)}))}function ap(n){var e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+HL(n,e))}function HL(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Qa(n,e,t,r){var i=kt(n,e,(function(){return t()}));if(i==null)throw new Error(r);return i}function GL(n,e){var t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+n.TEXTURE0;if(r<n.TEXTURE0||r>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function _m(n,e){return e===void 0&&(e=2),bt(n.slice(0,n.length-e))}function xm(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Hy(n){var e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[_m(n)].concat(xm(n))),e}function VL(n,e){var t;e===void 0&&(e=!1);var r=Ne().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,(n=n.map((function(l,c){return c>=n.length-2?qT(n[c]):n[c]}))).length===1&&(n=[2,n[0]])),n.length!==2){var i=Uu(n);n=i.newShape}var o=bt(n);if(n.length<=1&&o<=r)return[1,o];if(n.length===2&&n[0]<=r&&n[1]<=r)return n;if(n.length===3&&n[0]*n[1]<=r&&n[2]<=r)return[n[0]*n[1],n[2]];if(n.length===3&&n[0]<=r&&n[1]*n[2]<=r)return[n[0],n[1]*n[2]];if(n.length===4&&n[0]*n[1]*n[2]<=r&&n[3]<=r)return[n[0]*n[1]*n[2],n[3]];if(n.length===4&&n[0]<=r&&n[1]*n[2]*n[3]<=r)return[n[0],n[1]*n[2]*n[3]];if(e){var a=_m(n),s=2,u=2;return n.length&&(s=(t=xm(n))[0],u=t[1]),i0(o=a*(s/2)*(u/2)).map((function(l){return 2*l}))}return i0(o)}function sp(n){return n%2==0}function up(n,e){if(wr(n=n.slice(-2),e=e.slice(-2))||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){var t=n.slice(-1)[0],r=e.slice(-1)[0];if(t===r||sp(t)&&sp(r)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&sp(n[0])&&sp(e[0])}function jL(n){if(By==null){var e=va(n);By=e.getParameter(e.MAX_TEXTURE_SIZE)}return By}function qL(n){if(Uy==null){var e=va(n);Uy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Uy)}function $L(n){if(n===0)return 0;var e=va(n);return no(e,"EXT_disjoint_timer_query_webgl2")&&n===2?2:no(e,"EXT_disjoint_timer_query")?1:0}function no(n,e){return n.getExtension(e)!=null}function US(n){try{if(va(n)!=null)return!0}catch{return!1}return!1}function XL(n){if(n===0)return!1;var e=va(n);if(n===1){if(!no(e,"OES_texture_float"))return!1}else if(!no(e,"EXT_color_buffer_float"))return!1;return d0(e)}function YL(n){if(n===0)return!1;var e=va(n);if(n!==1){if(no(e,"EXT_color_buffer_float"))return d0(e);if(no(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(r,i){var o=Pw(r,i),a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texImage2D(r.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,s),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,a,0);var u=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(a),r.deleteFramebuffer(s),u})(e,t)}return!1}return!!no(e,"OES_texture_float")&&!!no(e,"WEBGL_color_buffer_float")&&d0(e)}function d0(n){var e=Pw(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,r),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);var i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(r),i}function KL(n){return n===2&&va(n).fenceSync!=null}var $t=Ne();function n3(n){Ne().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(n+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function _n(n,e){return le.tidy(n,e)}function bi(n){e3(n).forEach((function(e){return e.dispose()}))}function JL(n){return le.keep(n)}function Sm(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];Ne().getBool("IS_TEST")||console.warn.apply(console,n)}function ou(n,e){var t=n;if(ca(n))return e==="string"?[]:[n.length];if(!Array.isArray(n))return[];for(var r=[];Array.isArray(t)||ca(t)&&e!=="string";)r.push(t.length),t=t[0];return Array.isArray(n)&&Ne().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!ca(o))return void K(a.length===0,(function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"}));K(a.length>0,(function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"})),K(o.length===a[0],(function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"}));for(var u=a.slice(1),l=0;l<o.length;++l)i(o[l],u,s.concat(l))})(n,r,[]),r}function zS(n,e,t,r){if(n!=null&&(n!=="numeric"&&n!==e||n==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+r+"' must be "+n+" tensor, but got "+e+" tensor")}function X(n,e,t,r){if(r===void 0&&(r="numeric"),n instanceof Nn)return zS(r,n.dtype,e,t),n;var i=Ed(n);if(i!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(i=r),zS(r,i,e,t),n==null||!ca(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){var o=n==null?"null":n.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=ou(n,i);ca(n)||Array.isArray(n)||(n=[n]);var s=i!=="string"?XT(n,i,Ne().getBool("DEBUG")):Fc(n,[],!0);return le.makeTensor(s,a,i)}function Em(n,e,t,r){if(r===void 0&&(r="numeric"),!Array.isArray(n))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return n.map((function(i,o){return X(i,e+"["+o+"]",t)}),r)}function r3(n,e){for(var t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function QL(n,e,t){for(var r=n.length+e.length,i=[],o=0,a=0,s=0;s<r;s++)t.indexOf(s)===-1?i.push(n[o++]):i.push(e[a++]);return i}function Br(n,e){for(var t=[],r=n.length,i=0;i<r;i++)e.indexOf(i)===-1&&t.push(n[i]);return[t,e.map((function(o){return n[o]}))]}function xi(n,e){return QL(n,e.map((function(t){return 1})),e)}function Ii(n,e,t){K(r3(e,t),(function(){return n+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function ya(n,e){if(r3(n,e))return null;for(var t=[],r=0;r<e;++r)n.indexOf(r)===-1&&t.push(r);return n.forEach((function(i){return t.push(i)})),t}function Fw(n){return n.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function ba(n,e){for(var t=[],r=e-n;r<e;++r)t.push(r);return t}function ZL(n,e){var t=n[0].length;n.forEach((function(i,o){K(i.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"}))})),K(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var r=n[0];n.forEach((function(i,o){for(var a=0;a<t;a++)K(a===e||i[a]===r[a],(function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function Bc(n,e){for(var t=n[0].slice(),r=1;r<n.length;r++)t[e]+=n[r][e];return t}function oe(n){var e=Object.keys(n);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],r=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];le.startScope(t);try{var s=r.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),le.endScope(s),s}catch(u){throw le.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}$t.registerFlag("HAS_WEBGL",(function(){return $t.getNumber("WEBGL_VERSION")>0})),$t.registerFlag("WEBGL_VERSION",(function(){return US(2)?2:US(1)?1:0})),$t.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return $t.get("WEBGL_VERSION")===2})),$t.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),$t.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),$t.registerFlag("WEBGL_PACK",(function(){return $t.getBool("HAS_WEBGL")})),$t.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_CLIP",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),$t.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_REDUCE",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_CONV_IM2COL",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return jL($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return qL($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var n=$t.getNumber("WEBGL_VERSION");return n===0?0:$L(n)})),$t.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return $t.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(n=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))));var n})),$t.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return XL($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!$t.getBool("WEBGL_FORCE_F16_TEXTURES")&&$t.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),$t.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return YL($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return KL($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return $t.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),ZT=n3;var Er=oe({complex_:function(n,e){var t=X(n,"real","complex"),r=X(e,"imag","complex");return En(t.shape,r.shape,"real and imag shapes, "+t.shape+" and "+r.shape+", must match in call to tf.complex()."),le.runKernelFunc((function(i){return i.complex(t,r)}),{$real:t,$imag:r})}}),to=oe({real_:function(n){var e=X(n,"input","real");return le.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),ia=oe({imag_:function(n){var e=X(n,"input","imag");return le.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function Cr(n,e,t){return au(n,e,ou(n,t),t)}function au(n,e,t,r){if(r==null&&(r=Ed(n)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ca(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){KT(e);var i=bt(e),o=bt(t);K(i===o,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o}));for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==bt(e.slice(a));K(t[a]===e[a]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return ca(n)||Array.isArray(n)||(n=[n]),e=e||t,n=r!=="string"?XT(n,r,Ne().getBool("DEBUG")):Fc(n,[],!0),le.makeTensor(n,e,r)}function Ct(n,e){if((ca(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&ca(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return au(n,[],[],e)}function Bo(n,e){Yc(n);var t=ou(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return au(n,null,t,e)}function Yu(n,e,t){if(Yc(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var r=ou(n,t);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return au(n,e,r,t)}function i3(n,e,t){if(Yc(n),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var r=ou(n,t);if(r.length!==3&&r.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return au(n,e,r,t)}function ta(n,e,t){if(Yc(n),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var r=ou(n,t);if(r.length!==4&&r.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return au(n,e,r,t)}function eB(n,e,t){if(Yc(n),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var r=ou(n,t);if(r.length!==5&&r.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return au(n,e,r,t)}function tB(n,e,t){if(Yc(n),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var r=ou(n,t);if(r.length!==6&&r.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(r.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return au(n,e=e||r,r,t)}function nB(n,e,t,r){return e===void 0&&(e=!0),le.makeVariable(n,e,t,r)}function Kc(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Kc(n,"float32"),r=Xn(n,"float32");return Er(t,r)}var i=YT(bt(n),e);return le.makeTensor(i,n,e)}function Xn(n,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Xn(n,"float32"),r=Xn(n,"float32");return Er(t,r)}var i=kd(bt(n),e);return le.makeTensor(i,n,e)}function Ku(n,e,t){return le.runKernelFunc((function(r){return r.fill(n,e,t)}),{})}function rB(n,e,t){if(t<=0)throw new Error("The number of values should be positive.");return le.runKernelFunc((function(r){return r.linspace(n,e,t)}),{})}function km(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t===0)throw new Error("Cannot have a step of zero");if(n===e||n<e&&t<0||e<n&&t>1)return Xn([0],r);var i=kd(Math.abs(Math.ceil((e-n)/t)),r);e<n&&t===1&&(t=-1),i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return Bo(i,r)}var o3=oe({onesLike_:function(n){var e=X(n,"x","onesLike");if(e.dtype==="complex64"){var t=o3(to(e)),r=hn(ia(e));return Er(t,r)}return le.runKernelFunc((function(i){return i.onesLike(e)}),{x:e},(function(i,o){return{x:function(){return hn(i)}}}),"OnesLike")}}),hn=oe({zerosLike_:function(n){var e=X(n,"x","zerosLike");return le.runKernelFunc((function(t){return t.zerosLike(e)}),{x:e},(function(t,r){return{x:function(){return hn(t)}}}),"ZerosLike")}}),so=oe({concat_:function(n,e){e===void 0&&(e=0),K(n.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=Em(n,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")})),e=dr(e,t[0].shape)[0];var r=Bc(t.map((function(s){return s.shape})),e);if(bt(r)===0)return Cr([],r);if((t=t.filter((function(s){return s.size>0}))).length===1)return t[0];var i=t.map((function(s){return s.shape}));ZL(i,e);var o=t,a={axis:e};return le.runKernelFunc((function(s){return s.concat(t,e)}),o,(function(s){var u=i.map((function(l){return l[e]}));return Ow(s,u,e).map((function(l){return function(){return l}}))}),"Concat",a)}}),iB=oe({concat1d_:function(n){return so(n,0)}}),oB=oe({concat2d_:function(n,e){return so(n,e)}}),aB=oe({concat3d_:function(n,e){return so(n,e)}}),sB=oe({concat4d_:function(n,e){return so(n,e)}}),Ow=oe({split_:function(n,e,t){t===void 0&&(t=0);var r,i=X(n,"x","split");return t=dr(t,i.shape)[0],typeof e=="number"?(K(i.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(i.shape[t]/e)):(K(i.shape[t]===e.reduce((function(o,a){return o+a})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),le.runKernelFunc((function(o){return o.split(i,r,t)}),{$x:i},(function(o){return{$x:function(){return so(o,t)}}}))}});function Xt(n,e,t){return e===void 0&&(e="float32"),e=e||"float32",KT(n),new ed(n,e,t)}function uB(n,e){e===void 0&&(e=!1),console.log(n.toString(e))}var a3=oe({batchToSpaceND_:function(n,e,t){var r=X(n,"x","batchToSpaceND"),i=e.reduce((function(o,a){return o*a}));return K(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),K(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),K(r.shape[0]%i==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i})),le.runKernelFunc((function(o){return o.batchToSpaceND(r,e,t)}),{$x:r},(function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}}))}}),lB=oe({cast_:function(n,e){var t=X(n,"x","cast");if(!hL(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var r={dtype:e};return le.runKernelFunc((function(i){return i.cast(t,e)}),{x:t},(function(i){return{x:function(){return i.clone()}}}),"Cast",r)}}),cB=oe({cumsum_:function(n,e,t,r){e===void 0&&(e=0),t===void 0&&(t=!1),r===void 0&&(r=!1);var i=X(n,"x","cumsum"),o=ya([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=ba(1,i.rank)[0],u=le.runKernelFunc((function(l){return l.cumsum(a,s,t,r)}),{permutedX:a},(function(l){return{permutedX:function(){return l.cumsum(e,t,!r)}}}));return o!=null&&(u=u.transpose(o)),u}}),hB=oe({depthToSpace_:function(n,e,t){t===void 0&&(t="NHWC");var r=X(n,"x","depthToSpace"),i=t==="NHWC"?r.shape[1]:r.shape[2],o=t==="NHWC"?r.shape[2]:r.shape[3],a=t==="NHWC"?r.shape[3]:r.shape[1];return K(i*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+r.shape})),K(o*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+r.shape})),K(a%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+r.shape})),le.runKernelFunc((function(s){return s.depthToSpace(r,e,t)}),{$x:r})}}),Bs=oe({expandDims_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","expandDims",null);K(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=t.shape.slice();return e<0&&(K(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),r.splice(e,0,1),Oa(t,r)}}),Oa=oe({reshape_:function(n,e){var t=X(n,"x","reshape",null);e=lL(e,t.size),K(t.size===bt(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return le.runKernelFunc((function(i){return i.reshape(t,e)}),{x:t},(function(i){return{x:function(){return i.reshape(t.shape)}}}),"Reshape",r)}}),s3=oe({spaceToBatchND_:function(n,e,t){var r=X(n,"x","spaceToBatchND");return K(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),K(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),K(r.shape.reduce((function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),le.runKernelFunc((function(i){return i.spaceToBatchND(r,e,t)}),{$x:r},(function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}}))}}),u3=oe({squeeze_:function(n,e){var t=X(n,"x","squeeze");return Oa(t,Uu(t.shape,e).newShape)}}),Ks=oe({stack_:function(n,e){e===void 0&&(e=0);var t=Em(n,"tensors","stack");if(K(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var r=t[0].rank,i=t[0].shape,o=t[0].dtype;K(e<=r,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(s){En(i,s.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(s){K(o===s.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var a=t.map((function(s){return s.expandDims(e)}));return so(a,e)}}),ng=oe({unstack_:function(n,e){e===void 0&&(e=0),e=e||0;var t=X(n,"x","unstack");K(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var r={axis:e};return le.runKernelFunc((function(i){return i.unstack(t,e)}),{x:t},(function(i){return{x:function(){return Ks(i,e)}}}),"Unpack",r)}}),dB=function(n,e){return wt(this,void 0,void 0,(function(){var t,r,i,o,a,s,u,l,c,h;return _t(this,(function(f){switch(f.label){case 0:return t=X(n,"x","setdiff1d"),r=X(e,"y","setdiff1d"),K(t.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+r.dtype+")."})),K(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),K(r.rank===1,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,t.data()];case 1:return i=f.sent(),[4,r.data()];case 2:for(o=f.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new ed([s],t.dtype),l=new ed([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}}))}))};function Cm(n,e,t,r){r===void 0&&(r=!0);var i=[];if(r)(i=i.concat(e.slice(0))).push(n[0]/t),i=i.concat(n.slice(1));else{i=i.concat(n[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([n[a+1]/e[a],e[a]]);i=i.concat(n.slice(o+1))}return i}function Tm(n,e,t){t===void 0&&(t=!0);var r=[];if(t){r.push(e);for(var i=e+1;i<n;++i)i<=2*e?(r.push(i),r.push(i-(e+1))):r.push(i)}else{var o=[],a=[];for(i=1;i<n;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);r.push.apply(r,o),r.push(0),r.push.apply(r,a)}return r}function Mm(n,e,t,r){r===void 0&&(r=!0);var i=[];r?i.push(n[0]/t):i.push(n[0]*t);for(var o=1;o<n.length;++o)o<=e.length?r?i.push(e[o-1]*n[o]):i.push(n[o]/e[o-1]):i.push(n[o]);return i}function l3(n,e){for(var t=[0],r=0;r<e;++r)t.push(n[r][0]);return t}function c3(n,e,t){for(var r=n.slice(0,1),i=0;i<t;++i)r.push(n[i+1]-e[i][0]-e[i][1]);return r}var h3="Add",rg="Div",ig="SquaredDifference",d3="BroadcastTo",f3="OneHot",p3="Identity",m3="Tile",g3="PadV2",uo=oe({add_:function(n,e){var t,r=X(n,"a","add"),i=X(e,"b","add");t=Gn(r,i),r=t[0],i=t[1];var o={a:r,b:i};return le.runKernelFunc((function(a,s){var u=a.add(r,i);return s([r,i]),u}),o,null,h3)}});function Hs(n,e){for(var t=n.length,r=[],i=0;i<t;i++){var o=t-1-i,a=n[o]||1;(e[e.length-1-i]||1)>1&&a===1&&r.unshift(o)}return r}function ar(n,e){for(var t=[],r=0;r<e.length;r++){var i=n[n.length-r-1],o=e.length-r-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function on(n,e){for(var t=[],r=Math.max(n.length,e.length),i=0;i<r;i++){var o=n[n.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+n+" and "+e+".");t.unshift(o)}}return t}var fB=oe({abs_:function(n){var e=X(n,"x","abs");return e.dtype==="complex64"?le.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):le.runKernelFunc((function(t,r){var i=t.abs(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}}),"Abs")}}),pB=oe({acos_:function(n){var e=X(n,"x","acos");return le.runKernelFunc((function(t,r){var i=t.acos(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ct(1).sub(i.toFloat().square()).sqrt()).neg()}}}))}}),mB=oe({acosh_:function(n){var e=X(n,"x","acosh");return le.runKernelFunc((function(t,r){var i=t.acosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}}))}}),gB=oe({asin_:function(n){var e=X(n,"x","asin");return le.runKernelFunc((function(t,r){var i=t.asin(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ct(1).sub(i.toFloat().square()).sqrt())}}}))}}),vB=oe({asinh_:function(n){var e=X(n,"x","asinh");return le.runKernelFunc((function(t,r){var i=t.asinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.divStrict(Ct(1).add(i.toFloat().square()).sqrt())}}}))}}),yB=oe({atan_:function(n){var e=X(n,"x","atan");return le.runKernelFunc((function(t,r){var i=t.atan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}}))}}),bB=oe({atanh_:function(n){var e=X(n,"x","atanh");return le.runKernelFunc((function(t,r){var i=t.atanh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(Ct(1).sub(i.toFloat().square()))}}}))}}),wB=oe({ceil_:function(n){var e=X(n,"x","ceil");return le.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),_B=oe({clipByValue_:function(n,e,t){var r=X(n,"x","clipByValue");K(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var i=[r],o={min:e,max:t};return le.runKernelFunc((function(a,s){var u=a.clip(r,e,t);return s([r]),u}),{x:r},(function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),hn(a))}}}),"ClipByValue",o,i)}}),xB=oe({cos_:function(n){var e=X(n,"x","cos"),t=[e];return le.runKernelFunc((function(r,i){var o=r.cos(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(r)}}}),"Cos",{},t)}}),SB=oe({cosh_:function(n){var e=X(n,"x","cosh");return le.runKernelFunc((function(t,r){var i=t.cosh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}}))}}),EB=oe({erf_:function(n){var e=X(n,"x","erf");return K(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),le.runKernelFunc((function(t,r){var i=t.erf(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),kB=oe({exp_:function(n){var e=X(n,"x","exp");return le.runKernelFunc((function(t,r){var i=t.exp(e);return r([i]),i}),{x:e},(function(t,r){return{x:function(){return t.mulStrict(r[0])}}}),"Exp",{},[],[!0])}}),CB=oe({expm1_:function(n){var e=X(n,"x","expm1");return le.runKernelFunc((function(t,r){var i=t.expm1(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.exp())}}}))}}),TB=oe({floor_:function(n){var e=X(n,"x","floor");return le.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),MB=oe({log_:function(n){var e=X(n,"x","log"),t=[e];return le.runKernelFunc((function(r,i){var o=r.log(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return r.div(o.toFloat())}}}),"Log",{},t)}}),RB=oe({log1p_:function(n){var e=X(n,"x","log1p");return le.runKernelFunc((function(t,r){var i=t.log1p(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.add(1))}}}))}}),AB=oe({logSigmoid_:function(n){var e=X(n,"x","logSigmoid");return le.runKernelFunc((function(t,r){var i=t.softplus(e.neg()).neg();return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}}))}}),Lw=oe({neg_:function(n){var e=X(n,"x","neg"),t=[e];return le.runKernelFunc((function(r){return r.neg(e)}),{x:e},(function(r){return{x:function(){return r.neg()}}}),"Neg",{},t)}}),IB=oe({reciprocal_:function(n){var e=X(n,"x","reciprocal");return le.runKernelFunc((function(t,r){var i=t.reciprocal(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.square().neg())}}}))}}),DB=oe({round_:function(n){var e=X(n,"x","round");return le.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),v3=oe({rsqrt_:function(n){var e=X(n,"x","rsqrt"),t=[e];return le.runKernelFunc((function(r,i){var o=r.rsqrt(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return r.div(o.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),NB=oe({sigmoid_:function(n){var e=X(n,"x","sigmoid");return le.runKernelFunc((function(t,r){var i=t.sigmoid(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mul(i.mul(Ct(1).sub(i)))}}}),"Sigmoid")}}),PB=oe({sign_:function(n){var e=X(n,"x","sign");return le.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),FB=oe({isNaN_:function(n){var e=X(n,"x","isNaN");return le.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),OB=oe({isInf_:function(n){var e=X(n,"x","isInf");return le.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),LB=oe({isFinite_:function(n){var e=X(n,"x","isFinite");return le.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),BB=oe({sin_:function(n){var e=X(n,"x","sin"),t=[e];return le.runKernelFunc((function(r,i){var o=r.sin(e);return i([e]),o}),{x:e},(function(r,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(r)}}}),"Sin",{},t)}}),UB=oe({sinh_:function(n){var e=X(n,"x","sinh");return le.runKernelFunc((function(t,r){var i=t.sinh(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}}))}}),zB=oe({softplus_:function(n){var e=X(n,"x","softplus");return le.runKernelFunc((function(t,r){var i=t.softplus(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.mul(i.sigmoid())}}}))}}),WB=oe({sqrt_:function(n){var e=X(n,"x","sqrt");return le.runKernelFunc((function(t,r){var i=t.sqrt(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}}))}}),HB=oe({step_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","step");return le.runKernelFunc((function(r){return r.step(t,e)}),{$x:t},(function(r){return{$x:function(){return hn(r)}}}))}}),GB=oe({tan_:function(n){var e=X(n,"x","tan");return le.runKernelFunc((function(t,r){var i=t.tan(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return t.div(i.cos().square())}}}))}}),VB=oe({tanh_:function(n){var e=X(n,"x","tanh");return le.runKernelFunc((function(t,r){var i=t.tanh(e);return r([i]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return Ct(1).sub(i.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}}),jB=oe({addStrict_:function(n,e){var t=X(n,"a","addStrict"),r=X(e,"b","addStrict");return En(t.shape,r.shape,"Error in addStrict: "),t.add(r)}}),qB=oe({atan2_:function(n,e){var t,r=X(n,"a","atan2"),i=X(e,"b","atan2");t=Gn(r,i),r=t[0],i=t[1];var o=on(r.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.atan2(r,i);return s([r,i]),u}),{$a:r,$b:i},(function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=uo(u.square(),l.square()),h=a.mul(l.div(c)),f=ar(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=uo(u.square(),l.square()),h=Lw(a.mul(u.div(c))),f=ar(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}}))}}),$B=oe({divStrict_:function(n,e){var t=X(n,"a","div"),r=X(e,"b","div");return En(t.shape,r.shape,"Error in divideStrict: "),t.div(r)}}),y3=oe({floorDiv_:function(n,e){var t,r=X(n,"a","floorDiv"),i=X(e,"b","floorDiv");t=Gn(r,i),r=t[0],i=t[1];var o=on(r.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.floorDiv(r,i);return s([r,i]),u}),{a:r,b:i},(function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=ar(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=ar(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}}),"FloorDiv")}}),Bw=oe({maximum_:function(n,e){var t,r=X(n,"a","maximum"),i=X(e,"b","maximum");return t=Gn(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),on(r.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.maximum(r,i);return a([r,i]),s}),{a:r,b:i},(function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}}),"Maximum")}}),XB=oe({maximumStrict_:function(n,e){var t=X(n,"a","maximumStrict"),r=X(e,"b","maximumStrict");return En(t.shape,r.shape,"Error in maximumStrict: "),t.maximum(r)}}),b3=oe({minimum_:function(n,e){var t,r=X(n,"a","minimum"),i=X(e,"b","minimum");return t=Gn(r,i),r=t[0],i=t[1],r.dtype==="bool"&&(r=r.toInt(),i=i.toInt()),on(r.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.minimum(r,i);return a([r,i]),s}),{a:r,b:i},(function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}}),"Minimum")}}),YB=oe({minimumStrict_:function(n,e){var t=X(n,"a","minimumStrict"),r=X(e,"b","minimumStrict");return En(t.shape,r.shape,"Error in minimumStrict: "),t.minimum(r)}}),KB=oe({mod_:function(n,e){var t,r=X(n,"a","mod"),i=X(e,"b","mod");t=Gn(r,i),r=t[0],i=t[1];var o=on(r.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.mod(r,i);return s([r,i]),u}),{$a:r,$b:i},(function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=ar(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=ar(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}}))}}),JB=oe({modStrict_:function(n,e){var t=X(n,"a","modStrict"),r=X(e,"b","modStrict");return En(t.shape,r.shape,"Error in modStrict: "),t.mod(r)}}),$n=oe({mul_:function(n,e){var t,r=X(n,"a","mul"),i=X(e,"b","mul");t=Gn(r,i),r=t[0],i=t[1];var o=on(r.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.multiply(r,i);return s([r,i]),u}),{a:r,b:i},(function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),h=ar(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=ar(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}}),"Mul")}}),QB=oe({mulStrict_:function(n,e){var t=X(n,"a","mul"),r=X(e,"b","mul");return En(t.shape,r.shape,"Error in multiplyStrict: "),t.mul(r)}}),Rm=oe({pow_:function(n,e){var t,r=X(n,"base","pow"),i=X(e,"exp","pow");t=Gn(r,i),r=t[0],i=t[1];var o=on(r.shape,i.shape),a=[r,i];return le.runKernelFunc((function(s,u){var l=s.pow(r,i);return u([r,i,l]),l}),{a:r,b:i},(function(s,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var f=c.toFloat(),m=s.mul(f.mul(l.pow(f.sub(Ct(1))))),g=ar(l.shape,o);return g.length>0&&(m=m.sum(g)),m.reshape(l.shape)},b:function(){var f=l.greater(0),m=l.log().where(f,hn(l)),g=s.mul(h.mul(m)),w=ar(c.shape,o);return w.length>0&&(g=g.sum(w)),g.reshape(c.shape)}}}),"Pow",{},a,[!0])}}),ZB=oe({powStrict_:function(n,e){return En(n.shape,e.shape,"Error in powStrict: "),n.pow(e)}}),e6=oe({squaredDifferenceStrict_:function(n,e){var t=X(n,"a","squaredDifferenceStrict"),r=X(e,"b","squaredDifferenceStrict");return En(t.shape,r.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(r)}}),Fo=oe({sub_:function(n,e){var t,r=X(n,"a","sub"),i=X(e,"b","sub");t=Gn(r,i),r=t[0],i=t[1];var o=on(r.shape,i.shape);return le.runKernelFunc((function(a){return a.subtract(r,i)}),{a:r,b:i},(function(a){return{a:function(){var s=a,u=ar(r.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)},b:function(){var s=a,u=ar(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}}),"Sub")}}),t6=oe({subStrict_:function(n,e){var t=X(n,"a","subStrict"),r=X(e,"b","subStrict");return En(t.shape,r.shape,"Error in subStrict: "),t.sub(r)}}),Js=oe({div_:function(n,e){var t,r=X(n,"a","div"),i=X(e,"b","div");if(t=Gn(r,i),r=t[0],i=t[1],r.dtype==="int32"&&i.dtype==="int32")return y3(r,i);var o={a:r,b:i};return le.runKernelFunc((function(a,s){var u=a.realDivide(r,i);return s([r,i]),u}),o,null,rg,{})}});function w3(n,e){if(n.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+n.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>n.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+n.rank);if(n.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+n.shape+".");for(var t=e.shape,r=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=n.shape,s=t.slice();s.pop();var u=1;for(o=r;o<n.rank;++o)u*=a[o],s.push(a[o]);var l=Ui(n.shape).map((function(c){return c/u})).concat([1]).slice(0,r);return[s,i,u,l]}var _3=30;function Gy(n){return n<=_3?n:a0(n,Math.floor(Math.sqrt(n)))}function n6(n,e,t){var r=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+n+", sliceDim: "+r+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(n.length<r+(t.rank-i))throw new Error(o+" Output shape length < "+(r+(t.rank-i)));if(t.rank!==i+n.length-r)throw new Error(o+" update.rank != "+(i+n.length-r));for(var a=0;a<i;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==n[a+r])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+n[a+i]+")")}function r6(n,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(n.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+n.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(n.size===0)throw new Error("Updates specified for empty output. updates shape: "+n.shape)}n6(t,e,n)}function Am(n,e,t){for(var r=e.shape.length,i=r>1?e.shape[r-1]:1,o=t.length,a=1,s=i;s<o;++s)a*=t[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:bt(e.shape)/u,sliceSize:a,strides:Ui(t.slice(0,i)).concat([1]),outputSize:bt(t)}}function i6(n,e,t){K(n.rank===e.length,(function(){return"Error in slice"+n.rank+"D: Length of begin "+e+" must match the rank of the array ("+n.rank+")."})),K(n.rank===t.length,(function(){return"Error in slice"+n.rank+"D: Length of size "+t+" must match the rank of the array ("+n.rank+")."}));for(var r=function(o){K(e[o]+t[o]<=n.shape[o],(function(){return"Error in slice"+n.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+n.shape[o]+")"}))},i=0;i<n.rank;++i)r(i)}function WS(n){for(var e=[],t=0;n>0;)1&n&&e.push(t),n/=2,t++;return e}function Uw(n,e,t){for(var r=[],i=0;i<n.length;i++)r[i]=Math.ceil((e[i]-n[i])/t[i]);return r}function o6(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=r0(0,o,s-1)}function a6(n,e,t,r,i){var o=e[i],a=t[i]||1;(n&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[i];return o<0&&(o+=s),o=a>0?r0(0,o,s):r0(-1,o,s-1)}function x3(n,e,t){for(var r=t.length,i=0;i<t.length;i++)if(t[i]>1){r=i;break}for(i=r+1;i<t.length;i++)if(e[i]>0||t[i]!==n[i])return!1;return!0}function S3(n,e){for(var t=n.length>0?n[n.length-1]:1,r=0;r<n.length-1;r++)t+=n[r]*e[r];return t}function s6(n,e){K(o0(n),(function(){return"The f passed in variableGrads(f) must be a function"})),K(e==null||Array.isArray(e)&&e.every((function(c){return c instanceof Lc})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var r in e=[],le.registeredVariables)e.push(le.registeredVariables[r]);var i=t?e.filter((function(c){return!c.trainable})):null,o=e.length;K((e=e.filter((function(c){return c.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."}));var a=le.gradients(n,e,null,!0),s=a.value,u=a.grads;K(u.some((function(c){return c!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),K(s.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var l={};return e.forEach((function(c,h){u[h]!=null&&(l[c.name]=u[h])})),i?.forEach((function(c){return l[c.name]=null})),{value:s,grads:l}}function og(n){return le.customGrad(n)}var ag=oe({softmax_:function(n,e){e===void 0&&(e=-1);var t=X(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return le.runKernelFunc((function(r,i){var o=r.softmax(t,e);return i([o]),o}),{logits:t},(function(r,i){var o=i[0],a=r.mul(o);return{logits:function(){return a.sub(a.sum([e],!0).mul(o))}}}),"Softmax",{dim:e},[],[!0])}}),u6=oe({logSoftmax_:function(n,e){e===void 0&&(e=-1);var t=X(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return og((function(r,i){var o=r.max(e,!0),a=r.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}}))(t)}}),Co=oe({transpose_:function(n,e){var t=X(n,"x","transpose");if(e==null&&(e=t.shape.map((function(i,o){return o})).reverse()),K(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(i){K(i>=0&&i<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var r={perm:e};return le.runKernelFunc((function(i){return i.transpose(t,e)}),{x:t},null,"Transpose",r)}}),E3=(function(){function n(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return n.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},n.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},n.prototype.has=function(e){return this.data.has(e)},n.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},n.prototype.numDataIds=function(){return this.dataIdsCount},n})(),k3=(function(){function n(){}return n.prototype.time=function(e){return xe("time")},n.prototype.read=function(e){return xe("read")},n.prototype.readSync=function(e){return xe("readSync")},n.prototype.numDataIds=function(){return xe("numDataIds")},n.prototype.disposeData=function(e){return xe("disposeData")},n.prototype.write=function(e,t,r){return xe("write")},n.prototype.move=function(e,t,r,i){return xe("move")},n.prototype.memory=function(){return xe("memory")},n.prototype.floatPrecision=function(){return xe("floatPrecision")},n.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},n.prototype.batchMatMul=function(e,t,r,i){return xe("batchMatMul")},n.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,xe("fusedBatchMatMul")},n.prototype.slice=function(e,t,r){return xe("slice")},n.prototype.stridedSlice=function(e,t,r,i){return xe("stridedSlice")},n.prototype.unstack=function(e,t){return xe("unstack")},n.prototype.reverse=function(e,t){return xe("reverse")},n.prototype.concat=function(e,t){return xe("concat")},n.prototype.neg=function(e){return xe("neg")},n.prototype.add=function(e,t){return xe("add")},n.prototype.addN=function(e){return xe("addN")},n.prototype.subtract=function(e,t){return xe("subtract")},n.prototype.multiply=function(e,t){return xe("multiply")},n.prototype.realDivide=function(e,t){return xe("realDivide")},n.prototype.floorDiv=function(e,t){return xe("floorDiv")},n.prototype.sum=function(e,t){return xe("sum")},n.prototype.prod=function(e,t){return xe("prod")},n.prototype.unsortedSegmentSum=function(e,t,r){return xe("unsortedSegmentSum")},n.prototype.argMin=function(e,t){return xe("argMin")},n.prototype.argMax=function(e,t){return xe("argMax")},n.prototype.equal=function(e,t){return xe("equal")},n.prototype.notEqual=function(e,t){return xe("notEqual")},n.prototype.less=function(e,t){return xe("less")},n.prototype.lessEqual=function(e,t){return xe("lessEqual")},n.prototype.greater=function(e,t){return xe("greater")},n.prototype.greaterEqual=function(e,t){return xe("greaterEqual")},n.prototype.logicalNot=function(e){return xe("logicalNot")},n.prototype.logicalAnd=function(e,t){return xe("logicalAnd")},n.prototype.logicalOr=function(e,t){return xe("logicalOr")},n.prototype.where=function(e){return xe("where")},n.prototype.select=function(e,t,r){return xe("select")},n.prototype.topk=function(e,t,r){return xe("topk")},n.prototype.min=function(e,t){return xe("min")},n.prototype.minimum=function(e,t){return xe("minimum")},n.prototype.mod=function(e,t){return xe("mod")},n.prototype.max=function(e,t){return xe("max")},n.prototype.maximum=function(e,t){return xe("maximum")},n.prototype.all=function(e,t){return xe("all")},n.prototype.any=function(e,t){return xe("any")},n.prototype.squaredDifference=function(e,t){return xe("squaredDifference")},n.prototype.ceil=function(e){return xe("ceil")},n.prototype.floor=function(e){return xe("floor")},n.prototype.round=function(e){return xe("round")},n.prototype.sign=function(e){return xe("sign")},n.prototype.isNaN=function(e){return xe("isNaN")},n.prototype.isInf=function(e){return xe("isInf")},n.prototype.isFinite=function(e){return xe("isFinite")},n.prototype.pow=function(e,t){return xe("pow")},n.prototype.exp=function(e){return xe("exp")},n.prototype.expm1=function(e){return xe("expm1")},n.prototype.softmax=function(e,t){return xe("softmax")},n.prototype.log=function(e){return xe("log")},n.prototype.log1p=function(e){return xe("log1p")},n.prototype.sqrt=function(e){return xe("sqrt")},n.prototype.rsqrt=function(e){return xe("rsqrt")},n.prototype.square=function(e){return xe("square")},n.prototype.reciprocal=function(e){return xe("reciprocal")},n.prototype.relu=function(e){return xe("relu")},n.prototype.relu6=function(e){return xe("relu6")},n.prototype.prelu=function(e,t){return xe("prelu")},n.prototype.elu=function(e){return xe("elu")},n.prototype.eluDer=function(e,t){return xe("eluDer")},n.prototype.selu=function(e){return xe("selu")},n.prototype.int=function(e){return xe("int")},n.prototype.clip=function(e,t,r){return xe("clip")},n.prototype.abs=function(e){return xe("abs")},n.prototype.complexAbs=function(e){return xe("complexAbs")},n.prototype.sigmoid=function(e){return xe("sigmoid")},n.prototype.softplus=function(e){return xe("softplus")},n.prototype.sin=function(e){return xe("sin")},n.prototype.cos=function(e){return xe("cos")},n.prototype.tan=function(e){return xe("tan")},n.prototype.asin=function(e){return xe("asin")},n.prototype.acos=function(e){return xe("acos")},n.prototype.atan=function(e){return xe("atan")},n.prototype.atan2=function(e,t){return xe("atan2")},n.prototype.sinh=function(e){return xe("sinh")},n.prototype.cosh=function(e){return xe("cosh")},n.prototype.tanh=function(e){return xe("tanh")},n.prototype.asinh=function(e){return xe("asinh")},n.prototype.acosh=function(e){return xe("acosh")},n.prototype.atanh=function(e){return xe("atanh")},n.prototype.erf=function(e){return xe("erf")},n.prototype.step=function(e,t){return xe("step")},n.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xe("fusedConv2d")},n.prototype.conv2d=function(e,t,r){return xe("conv2d")},n.prototype.conv2dDerInput=function(e,t,r){return xe("conv2dDerInput")},n.prototype.conv2dDerFilter=function(e,t,r){return xe("conv2dDerFilter")},n.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xe("fusedDepthwiseConv2D")},n.prototype.depthwiseConv2D=function(e,t,r){return xe("depthwiseConv2D")},n.prototype.depthwiseConv2DDerInput=function(e,t,r){return xe("depthwiseConv2DDerInput")},n.prototype.depthwiseConv2DDerFilter=function(e,t,r){return xe("depthwiseConv2DDerFilter")},n.prototype.conv3d=function(e,t,r){return xe("conv3d")},n.prototype.conv3dDerInput=function(e,t,r){return xe("conv3dDerInput")},n.prototype.conv3dDerFilter=function(e,t,r){return xe("conv3dDerFilter")},n.prototype.maxPool=function(e,t){return xe("maxPool")},n.prototype.maxPoolBackprop=function(e,t,r,i){return xe("maxPoolBackprop")},n.prototype.avgPool=function(e,t){return xe("avgPool")},n.prototype.avgPoolBackprop=function(e,t,r){return xe("avgPoolBackprop")},n.prototype.avgPool3d=function(e,t){return xe("avgPool3d")},n.prototype.avgPool3dBackprop=function(e,t,r){return xe("avgPool3dBackprop")},n.prototype.maxPool3d=function(e,t){return xe("maxPool3d")},n.prototype.maxPool3dBackprop=function(e,t,r,i){return xe("maxPool3dBackprop")},n.prototype.reshape=function(e,t){return xe("reshape")},n.prototype.cast=function(e,t){return xe("cast")},n.prototype.tile=function(e,t){return xe("tile")},n.prototype.pad=function(e,t,r){return xe("pad")},n.prototype.transpose=function(e,t){return xe("transpose")},n.prototype.gather=function(e,t,r){return xe("gather")},n.prototype.gatherND=function(e,t){return xe("gatherND")},n.prototype.scatterND=function(e,t,r){return xe("scatterND")},n.prototype.batchToSpaceND=function(e,t,r){return xe("batchToSpaceND")},n.prototype.spaceToBatchND=function(e,t,r){return xe("spaceToBatchND")},n.prototype.resizeBilinear=function(e,t,r,i){return xe("resizeBilinear")},n.prototype.resizeBilinearBackprop=function(e,t,r){return xe("resizeBilinearBackprop")},n.prototype.resizeNearestNeighbor=function(e,t,r,i){return xe("resizeNearestNeighbor")},n.prototype.resizeNearestNeighborBackprop=function(e,t,r){return xe("resizeNearestNeighborBackprop")},n.prototype.batchNormalization=function(e,t,r,i,o,a){return xe("batchNormalization")},n.prototype.localResponseNormalization4D=function(e,t,r,i,o){return xe("localResponseNormalization4D")},n.prototype.LRNGrad=function(e,t,r,i,o,a,s){return xe("LRNGrad")},n.prototype.multinomial=function(e,t,r,i){return xe("multinomial")},n.prototype.oneHot=function(e,t,r,i){return xe("oneHot")},n.prototype.cumsum=function(e,t,r,i){return xe("cumsum")},n.prototype.nonMaxSuppression=function(e,t,r,i,o){return xe("nonMaxSuppression")},n.prototype.fft=function(e){return xe("fft")},n.prototype.ifft=function(e){return xe("ifft")},n.prototype.complex=function(e,t){return xe("complex")},n.prototype.real=function(e){return xe("real")},n.prototype.imag=function(e){return xe("imag")},n.prototype.cropAndResize=function(e,t,r,i,o,a){return xe("cropAndResize")},n.prototype.depthToSpace=function(e,t,r){return xe("depthToSpace")},n.prototype.split=function(e,t,r){return xe("split")},n.prototype.sparseToDense=function(e,t,r,i){return xe("sparseToDense")},n.prototype.diag=function(e){return xe("diag")},n.prototype.fill=function(e,t,r){return xe("fill")},n.prototype.onesLike=function(e){return xe("onesLike")},n.prototype.zerosLike=function(e){return xe("zerosLike")},n.prototype.linspace=function(e,t,r){return xe("linspace")},n.prototype.dispose=function(){return xe("dispose")},n})();function xe(n){throw new Error("'"+n+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function el(n,e,t,r,i,o,a){a===void 0&&(a="channelsLast");var s,u=Nm(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,n[3],n[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,n[1],n[1]]}return sl(n,s,t,r,i,o,!1,a)}function Im(n,e,t,r,i,o,a){a===void 0&&(a="NDHWC");var s,u,l=f0(e),c=l[0],h=l[1],f=l[2];if(a==="NDHWC")u="channelsLast",s=[c,h,f,n[4],n[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,h,f,n[1],n[1]]}return Dm(n,s,t,r,i,!1,u,o)}function sl(n,e,t,r,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(s==="channelsLast")l=n[0],c=n[1],h=n[2],f=n[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=n[0],f=n[1],c=n[2],h=n[3]}var m,g=e[0],w=e[1],v=e[3],y=Nm(t),x=y[0],E=y[1],_=Nm(r),k=_[0],C=_[1],A=Sc(g,k),I=Sc(w,C),T=(function(F,B,U,P,L,H,W,z){var q,re,de;if(typeof F=="number"){q={top:F,bottom:F,left:F,right:F,type:F===0?"VALID":"NUMBER"};var ye=(function(Be,lt,Y,ot,Ke){ot==null&&(ot=C3(Be,lt,Y));var Xe=Be[0],qe=Be[1],Tt=$h((Xe-lt+2*ot)/Y+1,Ke);K(Jn(Tt),(function(){return"The output # of rows ("+Tt+") must be an integer. Change the stride and/or zero pad parameters"}));var Qe=$h((qe-lt+2*ot)/Y+1,Ke);return K(Jn(Qe),(function(){return"The output # of columns ("+Qe+") must be an integer. Change the stride and/or zero pad parameters"})),[Tt,Qe]})([B,U],H,P,F,z);re=ye[0],de=ye[1]}else if(F==="same"){re=Math.ceil(B/P),de=Math.ceil(U/L);var te=Math.max(0,(re-1)*P+H-B),ie=Math.max(0,(de-1)*L+W-U),fe=Math.floor(te/2),Re=te-fe,De=Math.floor(ie/2);q={top:fe,bottom:Re,left:De,right:ie-De,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);q={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((B-H+1)/P),de=Math.ceil((U-W+1)/L)}return{padInfo:q,outHeight:re,outWidth:de}})(i,c,h,x,E,A,I,o),R=T.padInfo,N=T.outHeight,O=T.outWidth,V=a?v*f:v;return s==="channelsFirst"?m=[l,V,N,O]:s==="channelsLast"&&(m=[l,N,O,V]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:f,outHeight:N,outWidth:O,outChannels:V,padInfo:R,strideHeight:x,strideWidth:E,filterHeight:g,filterWidth:w,effectiveFilterHeight:A,effectiveFilterWidth:I,dilationHeight:k,dilationWidth:C,inShape:n,outShape:m,filterShape:e}}function Dm(n,e,t,r,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3],m=u[4];if(a==="channelsLast")l=n[0],c=n[1],h=n[2],f=n[3],m=n[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=n[0],m=n[1],c=n[2],h=n[3],f=n[4]}var g,w=e[0],v=e[1],y=e[2],x=e[4],E=f0(t),_=E[0],k=E[1],C=E[2],A=f0(r),I=A[0],T=A[1],R=A[2],N=Sc(w,I),O=Sc(v,T),V=Sc(y,R),F=(function(W,z,q,re,de,ye,te,ie,fe,Re,De){var Be,lt,Y,ot;if(typeof W=="number"){Be={top:W,bottom:W,left:W,right:W,front:W,back:W,type:W===0?"VALID":"NUMBER"};var Ke=(function(j,me,Ae,Pe,ke,Ue){ke==null&&(ke=C3(j,me,Pe));var _e=j[0],rt=j[1],Je=j[2],Oe=$h((_e-me+2*ke)/Pe+1,Ue);K(Jn(Oe),(function(){return"The output # of depths ("+Oe+") must be an integer. Change the stride and/or zero pad parameters"}));var $e=$h((rt-me+2*ke)/Pe+1,Ue);K(Jn($e),(function(){return"The output # of rows ("+$e+") must be an integer. Change the stride and/or zero pad parameters"}));var pt=$h((Je-me+2*ke)/Pe+1,Ue);return K(Jn(pt),(function(){return"The output # of columns ("+pt+") must be an integer. Change the stride and/or zero pad parameters"})),[Oe,$e,pt,Ae]})([z,q,re,1],ie,1,de,W,De);lt=Ke[0],Y=Ke[1],ot=Ke[2]}else if(W==="same"){lt=Math.ceil(z/de),Y=Math.ceil(q/ye),ot=Math.ceil(re/te);var Xe=(lt-1)*de+ie-z,qe=(Y-1)*ye+fe-q,Tt=(ot-1)*te+Re-re,Qe=Math.floor(Xe/2),ft=Xe-Qe,Mt=Math.floor(qe/2),Ut=qe-Mt,Q=Math.floor(Tt/2);Be={top:Mt,bottom:Ut,left:Q,right:Tt-Q,front:Qe,back:ft,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);Be={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},lt=Math.ceil((z-ie+1)/de),Y=Math.ceil((q-fe+1)/ye),ot=Math.ceil((re-Re+1)/te)}return{padInfo:Be,outDepth:lt,outHeight:Y,outWidth:ot}})(i,c,h,f,_,k,C,N,O,V,s),B=F.padInfo,U=F.outDepth,P=F.outHeight,L=F.outWidth,H=o?x*m:x;return a==="channelsFirst"?g=[l,H,U,P,L]:a==="channelsLast"&&(g=[l,U,P,L,H]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:f,inChannels:m,outDepth:U,outHeight:P,outWidth:L,outChannels:H,padInfo:B,strideDepth:_,strideHeight:k,strideWidth:C,filterDepth:w,filterHeight:v,filterWidth:y,effectiveFilterDepth:N,effectiveFilterHeight:O,effectiveFilterWidth:V,dilationDepth:I,dilationHeight:T,dilationWidth:R,inShape:n,outShape:g,filterShape:e}}function C3(n,e,t,r){r===void 0&&(r=1);var i=Sc(e,r);return Math.floor((n[0]*(t-1)-t+i)/2)}function Nm(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function f0(n){return typeof n=="number"?[n,n,n]:n}function Sc(n,e){return e<=1?n:n+(n-1)*(e-1)}function $h(n,e){if(!e)return n;switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error("Unknown roundingMode "+e)}}function Uc(n){var e=Nm(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function ni(n,e){return Uc(n)||Uc(e)}function zw(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+n)}function T3(n,e,t){if(e==="complex64"){if(n.dtype==="complex64")return n.clone();var r=Xn(n.shape),i=n.toFloat(),o=t.complex(i,r);return r.dispose(),i.dispose(),o}if(!dL(n.dtype,e))return le.makeTensorFromDataId(n.dataId,n.shape,e);if(n.dtype==="complex64"){var a=t.real(n);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(n);if(e==="bool"){var s=Ct(0,n.dtype);return o=t.notEqual(n,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+n.dtype+" to "+e)}function p0(n,e){return le.makeTensorFromDataId(n.dataId,e,n.dtype)}function M3(n,e,t){var r=(e-n)/(t-1),i=kd(t,"float32");i[0]=n;for(var o=1;o<i.length;o++)i[o]=i[o-1]+r;return Bo(i,"float32")}function m0(n,e){if(n.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+n.length+", imag: "+e.length+".");for(var t=new Float32Array(2*n.length),r=0;r<t.length;r+=2)t[r]=n[r/2],t[r+1]=e[r/2];return t}function HS(n,e){return{real:n[2*e],imag:n[2*e+1]}}function l6(n,e,t,r){n[2*r]=e,n[2*r+1]=t}function c6(n,e,t){var r=(t?2:-2)*Math.PI*(n/e);return{real:Math.cos(r),imag:Math.sin(r)}}function h6(n,e,t){var r=(function(o,a,s){return(function(u,l,c){for(var h=0,f=u.length,m=0,g=!1;h<f;){var w=c(l,u[m=h+(f-h>>>1)]);w>0?h=m+1:(f=m,g=!w)}return g?h:-h-1})(o,a,s||d6)})(n,e,t),i=r<0?-(r+1):r;n.splice(i,0,e)}function d6(n,e){return n>e?1:n<e?-1:0}function Ww(n,e,t,r,i){return R3(n,e,t,r,i,0).selectedIndices}function Hw(n,e,t,r,i,o){var a=R3(n,e,t,r,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function R3(n,e,t,r,i,o,a,s){s===void 0&&(s=!1);for(var u=Array.from(e).map((function(_,k){return{score:_,boxIndex:k,suppressBeginIndex:0}})).filter((function(_){return _.score>i})).sort(GS),l=o>0?-.5/o:0,c=[],h=[];c.length<t&&u.length>0;){var f=u.pop(),m=f.score,g=f.boxIndex,w=f.suppressBeginIndex;if(m<i)break;for(var v=!1,y=c.length-1;y>=w;--y){var x=f6(n,g,c[y]);if(x>=r){v=!0;break}if(f.score=f.score*p6(r,l,x),f.score<=i)break}f.suppressBeginIndex=c.length,v||(f.score===m?(c.push(g),h.push(f.score)):f.score>i&&h6(u,f,GS))}var E=c.length;return s&&(c.fill(0,E),h.fill(0,E)),{selectedIndices:Bo(c,"int32"),selectedScores:Bo(h,"float32"),numValidOutputs:Ct(E,"int32")}}function f6(n,e,t){var r=n.subarray(4*e,4*e+4),i=n.subarray(4*t,4*t+4),o=Math.min(r[0],r[2]),a=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),m=(s-o)*(u-a),g=(h-l)*(f-c);if(m<=0||g<=0)return 0;var w=Math.max(o,l),v=Math.max(a,c),y=Math.min(s,h),x=Math.min(u,f),E=Math.max(y-w,0)*Math.max(x-v,0);return E/(m+g-E)}function p6(n,e,t){var r=Math.exp(e*t*t);return t<=n?r:0}function GS(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}function A3(n,e,t){var r=new Array(n.rank).fill(0),i=n.shape.slice();return e.map((function(o){i[t]=o;var a=n.slice(r,i);return r[t]+=o,a}))}function I3(n,e){for(var t=new Array(n.rank),r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];var i=Xt(t,n.dtype);for(r=0;r<i.values.length;++r){for(var o=i.indexToLoc(r),a=new Array(n.rank),s=0;s<a.length;s++)a[s]=o[s]%n.shape[s];var u=n.locToIndex(a);i.values[r]=n.values[u]}return i.toTensor()}function D3(n,e,t,r,i){for(var o=e[e.length-1],a=[n.length/o,o],s=a[0],u=a[1],l=Oc(t,s*r),c=Oc("int32",s*r),h=0;h<s;h++){for(var f=h*u,m=n.subarray(f,f+u),g=[],w=0;w<m.length;w++)g.push({value:m[w],index:w});g.sort((function(_,k){return k.value-_.value}));var v=h*r,y=l.subarray(v,v+r),x=c.subarray(v,v+r);for(w=0;w<r;w++)y[w]=g[w].value,x[w]=g[w].index}var E=e.slice();return E[E.length-1]=r,[Cr(l,E,t),Cr(c,E,"int32")]}function Gw(n,e){for(var t=[],r=0;r<e.length;r++)e[r]&&t.push(r);var i=Xt(n,"int32"),o=Xt([t.length,n.length],"int32");for(r=0;r<t.length;r++){var a=i.indexToLoc(t[r]),s=r*n.length;o.values.set(a,s)}return o.toTensor()}var m6=function(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((function(i,o){return"T"+o}));var t=[];this.variableNames.forEach((function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+r+`;
        setOutput(result);
      }
    `},g6=function(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((function(i,o){return"T"+o}));var t=[];this.variableNames.forEach((function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")}));var r=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+r+`;
        setOutput(result);
      }
    `},v6=function(n,e,t){this.variableNames=["A"];var r=n.windowSize,i=n.batchSize,o=n.inSize,a=Math.ceil(o/r);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+r+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+r+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function N3(n,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return n+"."+t}))}function mi(n,e){return e===1?[n]:N3(n,e)}function Wr(){var n,e,t,r,i,o,a,s,u,l;return Ne().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",r="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",r="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:r,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function Vu(n,e,t){t===void 0&&(t="index");var r=Ui(e);return r.map((function(i,o){return"int "+n[o]+" = "+t+" / "+i+"; "+(o===r.length-1?"int "+n[o+1]+" = "+t+" - "+n[o]+" * "+i:"index -= "+n[o]+" * "+i)+";"})).join("")}function Vw(n){var e=Ui(n).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var P3=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function y6(n,e,t,r){var i=[];n.forEach((function(m){var g=bt(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?i.push("uniform float "+m.name+(g>1?"["+g+"]":"")+";"):(i.push("uniform sampler2D "+m.name+";"),i.push("uniform int offset"+m.name+";"))}));var o,a,s=i.join(`
`),u=n.map((function(m){return(function(g,w,v){v===void 0&&(v=!1);var y="";y+=v?F3(g):uc(g);var x=g.shapeInfo.logicalShape,E=w.logicalShape;return x.length<=E.length&&(y+=v?(function(_,k){var C,A=_.name,I=A.charAt(0).toUpperCase()+A.slice(1),T="get"+I+"AtOutCoords",R=_.shapeInfo.logicalShape.length,N=k.logicalShape.length,O=Hs(_.shapeInfo.logicalShape,k.logicalShape),V=Fn(N),F=N-R,B=["x","y","z","w","u","v"];C=R===0?"":N<2&&O.length>=1?"coords = 0;":O.map((function(q){return"coords."+B[q+F]+" = 0;"})).join(`
`);var U="";U=N<2&&R>0?"coords":_.shapeInfo.logicalShape.map((function(q,re){return"coords."+B[re+F]})).join(", ");var P="return outputValue;",L=bt(_.shapeInfo.logicalShape)===1,H=bt(k.logicalShape)===1;if(R!==1||L||H){if(L&&!H)P=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(O.length){var W=R-2,z=R-1;O.indexOf(W)>-1&&O.indexOf(z)>-1?P="return vec4(outputValue.x);":O.indexOf(W)>-1?P="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(z)>-1&&(P="return vec4(outputValue.xx, outputValue.zz);")}}else P=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+V+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+I+"("+U+`);
      `+P+`
    }
  `})(g,w):(function(_,k){var C=_.name,A=C.charAt(0).toUpperCase()+C.slice(1),I="get"+A+"AtOutCoords",T=k.texShape,R=_.shapeInfo.texShape,N=_.shapeInfo.logicalShape.length,O=k.logicalShape.length;if(!_.shapeInfo.isUniform&&N===O&&_.shapeInfo.flatOffset==null&&wr(R,T))return`
      float `+I+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var V,F=Fn(O),B=Hs(_.shapeInfo.logicalShape,k.logicalShape),U=O-N,P=["x","y","z","w","u","v"];V=N===0?"":O<2&&B.length>=1?"coords = 0;":B.map((function(H){return"coords."+P[H+U]+" = 0;"})).join(`
`);var L="";return L=O<2&&N>0?"coords":_.shapeInfo.logicalShape.map((function(H,W){return"coords."+P[W+U]})).join(", "),`
    float `+I+`() {
      `+F+` coords = getOutputCoords();
      `+V+`
      return get`+A+"("+L+`);
    }
  `})(g,w)),y})(m,e,r)})).join(`
`),l=e.texShape,c=Wr(),h=(function(m){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+m.texture2D+`(textureSampler, uv).r;
    }
  `})(c),f=(function(m){return m.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+m.varyingFs+` vec2 resultUV;
    `+m.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+m.defineSpecialNaN+`
    `+m.defineSpecialInf+`
    `+m.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+b6+`
    `+w6+`
    `+_6+`
  `})(c);return e.isPacked?(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `})(0,g);case 2:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(wr(_,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var A=Math.ceil(_[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=m,v=g,y=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],x=Math.ceil(w[2]/2),E=x*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(_,k){for(var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],A=Math.ceil(_[_.length-1]/2),I=A*Math.ceil(_[_.length-2]/2),T=I,R="",N="b, r, c",O=2;O<_.length-1;O++)T*=_[_.length-O-1],R=`
      int b`+O+" = index / "+T+`;
      index -= b`+O+" * "+T+`;
    `+R,N="b"+O+", "+N;return`
    ivec`+_.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+R+`

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+A+`);
      int c = imod(index, `+A+`) * 2;

      return ivec`+_.length+"("+N+`);
    }
  `})(m,g)}var w,v,y,x,E})(e.logicalShape,l),a=(function(m){return`
    void setOutput(vec4 val) {
      `+m.output+` = val;
    }
  `})(c)):(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(y,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `})(0,g);case 2:return(function(y,x){return wr(y,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:y[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:y[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+y[1]+`;
      int c = index - r * `+y[1]+`;
      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=g,v=Vu(["r","c","d"],m),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(y,x){var E=Vu(["r","c","d","d2"],y);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+E+`
      return ivec4(r, c, d, d2);
    }
  `})(m,g);case 5:return(function(y,x){var E=Vu(["r","c","d","d2","d3"],y);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(m,g);case 6:return(function(y,x){var E=Vu(["r","c","d","d2","d3","d4"],y);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(m,g);default:throw new Error(m.length+"-D output sampling is not yet supported")}var w,v})(e.logicalShape,l),a=(function(m){return`
    void setOutput(float val) {
      `+m.output+` = vec4(val, 0, 0, 0);
    }
  `})(c)),r&&(f+=x6),[f,h,a,s,o,u,t].join(`
`)}function uc(n){var e=n.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+r+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=Eu(r);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 1:return(function(t){var r=t.name,i="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Ul(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+r+`, halfCR);
      }
    `;var u=Eu(r);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+r+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+r+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+r+`, uv);
    }
  `})(n);case 2:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&wr(r,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=Uu(r),c=l.newShape,h=l.keptDims,f=c;if(f.length<r.length){var m=lc(t,f);return`
      `+uc(m)+`
      float `+o+`(int row, int col) {
        return `+o+"("+cc(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+r[1]+`, 1)));
        `+Ul(t)+`
      }
    `;var g=a[0],w=a[1],v=Eu(i);return w===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+r[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+r[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+g+", "+w+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(n);case 3:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[1]*r[2],s=r[2],u=Uu(r),l=u.newShape,c=u.keptDims,h=l;if(h.length<r.length){var f=lc(t,h);return`
        `+uc(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+cc(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Ul(t)+`
      }
    `;var m=t.shapeInfo.texShape,g=m[0],w=m[1],v=t.shapeInfo.flatOffset;if(w===a&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+g+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(w===s&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+r[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var y=Eu(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+y+`;
        vec2 uv = uvFromFlat(`+g+", "+w+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(n);case 4:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[3],s=r[2]*a,u=r[1]*s,l=Uu(r),c=l.newShape,h=l.keptDims;if(c.length<r.length){var f=lc(t,c);return`
      `+uc(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+cc(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Ul(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,w=g[0],v=g[1];if(v===u&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+r[1]*r[2]+", "+r[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=Eu(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+v+", index + "+y+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 5:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=r[4],s=r[3]*a,u=r[2]*s,l=r[1]*u,c=Uu(r),h=c.newShape,f=c.keptDims;if(h.length<r.length){var m=lc(t,h);return`
      `+uc(m)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+cc(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Ul(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,v=w[0],y=w[1];if(y===l&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===a&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]+`,
               `+r[2]*r[3]+", "+r[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=Eu(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);case 6:return(function(t){var r=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=Uu(r),s=a.newShape,u=a.keptDims;if(s.length<r.length){var l=lc(t,s);return`
      `+uc(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+cc(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=r[5],h=r[4]*c,f=r[3]*h,m=r[2]*f,g=r[1]*m;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+g+", "+m+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Ul(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,y=v[0],x=v[1];if(x===g&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+m+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+r[1]*r[2]*r[3]*r[4]+`,
               `+r[2]*r[3]*r[4]+`,
               `+r[3]*r[4]+`,
               `+r[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var E=Eu(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+g+" + col * "+m+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+E+`;
      vec2 uv = uvFromFlat(`+y+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(n);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function F3(n){var e,t,r;switch(n.shapeInfo.logicalShape.length){case 0:return e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),r=Wr(),`
    vec4 `+t+`() {
      return `+r.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Wr();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `})(n);case 2:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=Wr();if(u!=null&&wr(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],m=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+m+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `})(n);case 3:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=lc(i,c);return`
        `+F3(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+cc(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],m=l[1],g=Math.ceil(o[2]/2),w=g*Math.ceil(o[1]/2),v=Wr();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+m+", "+w+", "+g+`, b, row, col);
      return `+v.texture2D+"("+a+`, uv);
    }
  `})(n);default:return(function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],m=Math.ceil(o[a-1]/2),g=m*Math.ceil(o[a-2]/2),w="int b, int row, int col",v="b * "+g+" + (row / 2) * "+m+" + (col / 2)",y=2;y<a-1;y++)w="int b"+y+", "+w,g*=o[a-y-1],v="b"+y+" * "+g+" + "+v;var x=Wr();return`
    vec4 `+u+"("+w+`) {
      int index = `+v+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `})(n)}}var b6=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,w6=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,_6=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,x6=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Eu(n){return"offset"+n}function Ul(n){var e=n.name,t=bt(n.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Fn(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error("GPU for rank "+n+" is not yet supported")}function lc(n,e){var t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function cc(n,e){return e.map((function(t){return n[t]})).join(", ")}var S6=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,K(n.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var i=n[n.length-1],o=Math.ceil(i/e);this.outputShape=n.slice(0,-1),o>1&&this.outputShape.push(o),r||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Fn(l),h=mi("coords",l);if(o===1){var f=Fn(s=l+1);a=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var m=["x","y","z","w","u","v"].slice(0,s),g="."+m[s-1],w=m.map((function(I){return"int "+I})),v=mi("sourceLocR",s-1).concat("inIdx.r"),y=mi("sourceLocG",s-1).concat("inIdx.g"),x=mi("sourceLocB",s-1).concat("inIdx.b"),E=mi("sourceLocA",s-1).concat("inIdx.a"),_=t==="max"?"greaterThan":"lessThan",k=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+E.join()+")));",C=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+E.join()+") : 0.)",A=r?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+A+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+_+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},E6=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterHeight,u=n.effectiveFilterWidth,l=s-1-n.padInfo.top,c=u-1-n.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},k6=function(n){this.variableNames=["dy"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=c-1-n.padInfo.front,g=h-1-n.padInfo.top,w=f-1-n.padInfo.left,v=1/(e*t*r);this.userCode=`
      const ivec3 pads = ivec3(`+m+", "+g+", "+w+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},C6=function(n,e,t,r,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],on(n,e),on(n,t);var a="0.0";r!=null&&(on(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(on(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},T6=function(n,e,t,r,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],on(n,e),on(n,t);var a="vec4(0.0)";r!=null&&(on(n,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(on(n,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},M6="return areal * breal - aimag * bimag;",R6="return areal * bimag + aimag * breal;",VS=function(n,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=on(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+n+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},Vy="return a + b;",jy="return a - b;",jS="return a * b;",A6=`
if (a == b) {
  return 1.0;
};
return a / b;`,O3="return (a < 0.) ? b * a : a;",qn=function(n,e,t){this.variableNames=["A","B"],this.outputShape=on(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+n+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},I6=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,L3=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Jo=function(n,e,t,r){r===void 0&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=on(e,t);var i=this.outputShape.length,o="";if(r)if(i===0||bt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Fn(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=mi("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+n+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},D6=(function(){function n(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),N6=(function(){function n(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return n.prototype.getCustomSetupFunc=function(e,t){var r=this;return function(i,o){r.minLoc==null&&(r.minLoc=i.getUniformLocationNoThrow(o,"minVal"),r.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(r.minLoc,e),i.gl.uniform1f(r.maxLoc,t)}},n})(),P6=function(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},F6=function(n){this.outputShape=[],this.outputShape=Bc(n,1),this.variableNames=n.map((function(s,u){return"T"+u}));var e=new Array(n.length-1);e[0]=n[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+n[t][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];r.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];r.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+r.join(`
        `)+`
      }
    `},O6=function(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Bc(n,e);var t=this.outputShape,r=t.length,i=Fn(r),o=mi("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=n.map((function(v,y){return"T"+y}));var s=new Array(n.length-1);s[0]=n[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+n[u][e];var l=a[e],c=a.slice(-2),h=a.join(),f="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var m=s[u-1];f+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+lp(a,l,m)+`),
            vec2(`+lp(c,l,m)+`));
        }`}var g=s.length,w=s[s.length-1];f+=`
        return getChannel(
          getT`+g+"("+lp(a,l,w)+`),
          vec2(`+lp(c,l,w)+"));",this.userCode=`
      float getValue(`+a.map((function(v){return"int "+v}))+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[r-1]+" = "+o[r-1]+` + 1;
        if (`+o[r-1]+" < "+t[r-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[r-2]+" = "+o[r-2]+` + 1;
        if (`+o[r-2]+" < "+t[r-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[r-1]+" = "+o[r-1]+` - 1;
        if (`+o[r-2]+" < "+t[r-2]+` &&
            `+o[r-1]+" < "+t[r-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function lp(n,e,t){var r=n.indexOf(e);return n.map((function(i,o){return o===r?i+" - "+t:i})).join()}var L6=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},B6=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,s=t-1-n.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},U6=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.padInfo.front,o=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yF = 0; yF < `+n.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+n.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+n.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+n.outWidth+`; yC++) {
                int xC = wC + yC * `+r+" - "+a+`;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},z6=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterDepth,t=n.filterHeight,r=n.filterWidth,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=e-1-n.padInfo.front,u=t-1-n.padInfo.top,l=r-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+n.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+r+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+r+` - 1 - wC;

              for (int d2 = 0; d2 < `+n.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},W6=function(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;var e=n.strideHeight,t=n.strideWidth,r=n.padInfo.top,i=n.padInfo.left,o=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+n.batchSize+`; b++) {
          for (int yR = 0; yR < `+n.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+r+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+n.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},H6=function(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;var e=n.filterHeight,t=n.filterWidth,r=n.strideHeight,i=n.strideWidth,o=e-1-n.padInfo.top,a=t-1-n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+r+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},qS=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.padInfo.top,o=n.padInfo.left,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterHeight,h=n.filterWidth,f=4*Math.floor(n.inChannels/4),m=n.inChannels%4,g=n.dataFormat==="channelsLast",w=g?1:2,v=g?2:3,y=g?3:1,x="",E="";t&&(x=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,E="result = activation(result);");var _=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+y+`];

        ivec2 xRCCorner =
            ivec2(coords[`+w+"], coords["+v+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+n.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+g+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(m===1)+`) {

              if (`+g+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(m===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+g+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(m===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+g+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+_+`
        `+E+`
        setOutput(result);
      }
    `},G6=function(n){this.variableNames=["x","W"],this.outputShape=n.outShape;var e=n.padInfo.front,t=n.padInfo.top,r=n.padInfo.left,i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.filterDepth,h=n.filterHeight,f=n.filterWidth,m=4*Math.floor(n.inChannels/4),g=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+r+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},$S=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.outputShape=n.outShape;var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,f=n.filterHeight,m=n.filterWidth,g=n.outChannels/n.inChannels,w="",v="";t&&(w=r?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,v="result = activation(result);");var y=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+g+`;
        int q = d2 - d1 * `+g+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+y+`
        `+v+`
        setOutput(result);
      }
    `},XS=function(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=null),r===void 0&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;for(var i=n.inHeight,o=n.inWidth,a=n.padInfo.top,s=n.padInfo.left,u=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,h=n.dilationWidth,f=n.filterHeight,m=n.filterWidth,g=m,w="int xR; int xC; int xCOffset;",v=0;v<f;v++)for(var y=0;y<m;y++)w+=`
          vec4 xTexelR`+v+"C"+2*y+` = vec4(0.);
          vec4 wR`+v+"C"+y+` = vec4(0.);
          vec4 xR`+v+"C"+y+" = vec4(0.);";for(v=0;v<f;v++)for(var x=0;x<g;x++){if(w+=`
          xR = xRCorner + `+v*c+`;
          xC = xCCorner + `+(y=2*x)*h+`;
        `,l===1){if(y<m&&(w+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+v+"C"+y+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+v+"C"+y+" = vec4(previous.zw, xTexelR"+v+"C"+y+`.xy);
                } else {
                  xR`+v+"C"+y+" = vec4(0, 0, xTexelR"+v+"C"+y+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                xR`+v+"C"+y+" = xTexelR"+v+"C"+y+`;
              `,y+1<m)){var E=s%2==0?qT(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(w+=`
                  xCOffset = xC + `+s%2+" + "+E+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(w+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+v+"C"+y+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+v+"C"+y+` = vec4(0.);
                    }
                  `),w+=`
                  xR`+v+"C"+(y+1)+` = vec4(
                    xTexelR`+v+"C"+y+".zw, xTexelR"+v+"C"+(y+2)+`.xy);
                `):w+=`
                  xCOffset = xC + `+E+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+v+"C"+(y+1)+" = xTexelR"+v+"C"+(y+2)+`;
                `}}else y<m&&(w+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(w+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+v+"C"+(y+2)+` = vec4(0.);
                }

                xR`+v+"C"+y+` = vec4(
                  xTexelR`+v+"C"+y+".zw, xTexelR"+v+"C"+(y+2)+`.zw);
              `,y+1<m&&(w+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+v+"C"+(y+1)+" = vec4(xTexelR"+v+"C"+(y+2)+`.xy, final.xy);
                `)):(w+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+(y+2)+` = vec4(0.);
                }

                xR`+v+"C"+y+` = vec4(
                  xTexelR`+v+"C"+y+".xy, xTexelR"+v+"C"+(y+2)+`.xy);
              `,y+1<m&&(w+=`
                  xR`+v+"C"+(y+1)+` = vec4(
                    xTexelR`+v+"C"+y+".zw, xTexelR"+v+"C"+(y+2)+`.zw);
                `)),w+="}");y<m&&(w+=`
            vec4 wTexelR`+v+"C"+y+" = getW("+v+", "+y+`, d1, q);
            wR`+v+"C"+y+" = vec4(wTexelR"+v+"C"+y+".xz, wTexelR"+v+"C"+y+`.xz);
          `,y+1<m&&(w+=`
              vec4 wTexelR`+v+"C"+(y+1)+" = getW("+v+", "+(y+1)+`, d1, q);
              wR`+v+"C"+(y+1)+` =
                vec4(wTexelR`+v+"C"+(y+1)+".xz, wTexelR"+v+"C"+(y+1)+".xz);"))}for(v=0;v<f;v++)for(y=0;y<m;y++)w+="dotProd += xR"+v+"C"+y+" * wR"+v+"C"+y+";";var _="",k="";t&&(_=r?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,k="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+_+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+w+`

        vec4 result = dotProd;
        `+C+`
        `+k+`
        setOutput(result);
      }
    `},V6=function(n,e,t,r,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=n[0],a=n[1],s=n[2],u=n[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var f=r==="bilinear"?1:0,m=[a-1+".0",s-1+".0"],g=m[0],w=m[1],v=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],y=v[0],x=v[1],E=v[2],_=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],k=_[0],C=_[1],A=_[2];this.userCode=`
      const float height_ratio = float(`+y+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+C+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+A+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},j6=function(n,e,t){this.variableNames=["x"],this.outputShape=n;var r=n.length,i=n[n.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Fn(r)+` coords = getOutputCoords();
        int end = `+YS(r,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+YS(r,"coords")+` = idx;
          val += getX(`+(function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")})(r,"coords")+`);
        }
        setOutput(val);
      }
    `};function YS(n,e){if(n===1)return""+e;if(n===2)return e+".y";if(n===3)return e+".z";if(n===4)return e+".w";throw Error("Cumulative sum for rank "+n+" is not yet supported")}var q6=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=td.DENSE;var e=qh(n),t=Wr();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Vu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},$6=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=td.DENSE;var e=qh(n),t=Wr();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+Vu(["r","c","d"],n)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},X6=(function(){function n(e,t,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return n.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},n.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},n.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},n.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},n.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},n})(),Y6=function(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},K6=function(n){this.variableNames=["A"],this.outTexUsage=Oi.DOWNLOAD;var e=Wr();this.outputShape=n,this.userCode=`
      `+P3+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},J6=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Oi.DOWNLOAD;var e=Wr();this.outputShape=n,this.userCode=`
      `+P3+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},Q6=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var r=Wr(),i=e[0],o=e[1];this.outputShape=n;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Vw(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+r.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+r.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},Z6=function(n,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=Wr(),i=e[0],o=e[1];this.outputShape=n;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+n[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+n[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+r.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Vw(n)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+r.output+" = "+s+`;
      }
    `},eU="return real * expR - imag * expI;",tU="return real * expI + imag * expR;",KS=function(n,e,t){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?r+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+n+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+r+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+r+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},nU=(function(){function n(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.valueLoc==null&&(t.valueLoc=r.getUniformLocationNoThrow(i,"value")),r.gl.uniform1f(t.valueLoc,e)}},n})(),rU=function(n,e,t){this.variableNames=["A","indices"];var r=n.slice();r[t]=e,this.outputShape=r,this.rank=r.length;var i=Fn(this.rank),o=(function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()})(n,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},iU=function(n,e,t){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var r=Fn(e.length),i=Fn(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+r+" strides = "+r+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function oU(n,e){var t=Wr();return ML(n,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function aU(n,e){return NL(n,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function sU(n,e){return PL(n,e,new Uint16Array([0,1,2,2,1,3]))}function Td(n,e,t,r,i,o,a){OL(t,r);var s=FL(n,e),u=n.TEXTURE_2D;return kt(n,e,(function(){return n.bindTexture(u,s)})),kt(n,e,(function(){return n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)})),kt(n,e,(function(){return n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)})),kt(n,e,(function(){return n.texParameteri(u,n.TEXTURE_MIN_FILTER,n.NEAREST)})),kt(n,e,(function(){return n.texParameteri(u,n.TEXTURE_MAG_FILTER,n.NEAREST)})),kt(n,e,(function(){return n.texImage2D(u,0,i,t,r,0,o,a,null)})),kt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)})),s}function uU(n,e,t,r,i){var o=tg(t,r);return Td(n,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,n.FLOAT)}function lU(n,e,t,r,i){var o=tg(t,r);return Td(n,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function cU(n,e,t,r,i){var o=tg(t,r);return Td(n,e,o[0],o[1],n.RGBA,n.RGBA,n.UNSIGNED_BYTE)}function hU(n,e,t,r,i){var o=Cd(t,r);return Td(n,e,o[0],o[1],i.internalFormatPackedFloat,n.RGBA,n.FLOAT)}function dU(n,e,t,r,i){var o=Cd(t,r);return Td(n,e,o[0],o[1],i.internalFormatPackedHalfFloat,n.RGBA,i.textureTypeHalfFloat)}function fU(n,e,t,r){return kt(n,e,(function(){return n.bindBuffer(n.ARRAY_BUFFER,r)})),LS(n,e,t,"clipSpacePos",r,3,20,0)&&LS(n,e,t,"uv",r,2,20,12)}function pU(n,e,t,r,i,o,a){var s,u,l;kt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),o instanceof Uint8Array?(s=new Uint8Array(r*i*4),u=n.UNSIGNED_BYTE,l=n.RGBA):(s=new Float32Array(r*i*4),u=n.FLOAT,l=a.internalFormatPackedFloat),s.set(o),kt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,l,r,i,0,n.RGBA,u,s)})),kt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function mU(n,e,t,r){kt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,t)})),r.data instanceof Uint8Array?kt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r.width,r.height,0,n.RGBA,n.UNSIGNED_BYTE,r.data)})):kt(n,e,(function(){return n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,r)})),kt(n,e,(function(){return n.bindTexture(n.TEXTURE_2D,null)}))}function gU(n,e,t,r,i){var o=n.createBuffer();kt(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,o)}));var a=16*t*r;return kt(n,e,(function(){return n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)})),kt(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,0)})),kt(n,e,(function(){return n.bindBuffer(n.PIXEL_PACK_BUFFER,null)})),o}function vU(n,e,t){var r=n,i=new Float32Array(t);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,i),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i}function yU(n,e,t,r,i){var o=tg(t,r),a=o[0],s=o[1],u=new Uint8Array(t*r*4);return kt(n,e,(function(){return n.readPixels(0,0,a,s,i.downloadTextureFormat,n.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function bU(n,e,t,r,i,o,a,s){var u=n,l=new Float32Array((function(c,h){var f=Cd(c,h);return f[0]*f[1]*4})(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function wU(n,e,t,r){var i=new Float32Array(t*r*4);return kt(n,e,(function(){return n.readPixels(0,0,r,t,n.RGBA,n.FLOAT,i)})),i}var _U=(function(){function n(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Ne().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,SL(t,e)):this.gl=va(t);var r="WEBGL_color_buffer_float";if(Ne().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=op(this.gl,this.debug,"OES_texture_float"),no(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=op(this.gl,this.debug,"OES_texture_half_float");else if(Ne().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),no(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=op(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Ne().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",no(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!no(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=aU(this.gl,this.debug),this.indexBuffer=sU(this.gl,this.debug),this.framebuffer=LL(this.gl,this.debug),this.textureConfig=Pw(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(n.prototype,"debug",{get:function(){return Ne().getBool("DEBUG")},enumerable:!0,configurable:!0}),n.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;kt(t,this.debug,(function(){return t.finish()})),kt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),kt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),kt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),kt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),kt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},n.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),uU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),lU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),cU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),mU(this.gl,this.debug,e,t)},n.prototype.uploadDenseMatrixToTexture=function(e,t,r,i){this.throwIfDisposed(),pU(this.gl,this.debug,e,t,r,i,this.textureConfig)},n.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),dU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),hU(this.gl,this.debug,e,t,this.textureConfig)},n.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(BS(this.gl,this.debug,this.framebuffer),this.outputTexture=null),kt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},n.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return yU(i.gl,i.debug,t,r,i.textureConfig)}))},n.prototype.downloadPackedMatrixFromBuffer=function(e,t,r,i,o,a){return bU(this.gl,e,0,0,0,o,a,this.textureConfig)},n.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return vU(this.gl,e,t)},n.prototype.createBufferFromTexture=function(e,t,r){this.bindTextureToFrameBuffer(e);var i=gU(this.gl,this.debug,t,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},n.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},n.prototype.createFence=function(e){var t,r,i=this;if(Ne().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),r=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),r=function(){return i.isQueryAvailable(t,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):r=function(){return!0};return{query:t,isFencePassed:r}},n.prototype.downloadMatrixFromPackedTexture=function(e,t,r){var i=this;return this.downloadMatrixDriver(e,(function(){return wU(i.gl,i.debug,t,r)}))},n.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,r=RL(t,this.debug,e),i=oU(t,this.debug),o=IL(t,this.debug);return kt(t,this.debug,(function(){return t.attachShader(o,i)})),kt(t,this.debug,(function(){return t.attachShader(o,r)})),DL(t,this.debug,o),this.debug&&zy(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=fU(t,this.debug,this.program,this.vertexBuffer)),o},n.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&kt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},n.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&zy(this.gl,this.debug,this.program),kt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},n.prototype.getUniformLocation=function(e,t,r){return r===void 0&&(r=!0),this.throwIfDisposed(),r?UL(this.gl,this.debug,e,t):zL(this.gl,e,t)},n.prototype.getAttributeLocation=function(e,t){var r=this;return this.throwIfDisposed(),kt(this.gl,this.debug,(function(){return r.gl.getAttribLocation(e,t)}))},n.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},n.prototype.setInputMatrixTexture=function(e,t,r){this.throwIfDisposed(),this.throwIfNoProgram(),WL(this.gl,this.debug,this.program,e,t,r)},n.prototype.setOutputMatrixTexture=function(e,t,r){this.setOutputMatrixTextureDriver(e,r,t)},n.prototype.setOutputPackedMatrixTexture=function(e,t,r){this.throwIfDisposed();var i=Cd(t,r),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},n.prototype.setOutputMatrixWriteRegion=function(e,t,r,i){this.setOutputMatrixWriteRegionDriver(r,e,i,t)},n.prototype.setOutputPackedMatrixWriteRegion=function(e,t,r,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},n.prototype.debugValidate=function(){this.program!=null&&zy(this.gl,this.debug,this.program),ap(this.gl)},n.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),kt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},n.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),kt(this.gl,this.debug,(function(){return e.gl.finish()}))},n.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=op(this.gl,this.debug,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},n.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},n.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},n.prototype.beginQuery=function(){if(Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),r=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,r),r}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},n.prototype.endQuery=function(){if(Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,r=this.getQueryTimerExtensionWebGL2();t.endQuery(r.TIME_ELAPSED_EXT)}},n.prototype.waitForQueryAndGetTime=function(e){return wt(this,void 0,void 0,(function(){var t=this;return _t(this,(function(r){switch(r.label){case 0:return[4,DS((function(){return t.disposed||t.isQueryAvailable(e,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return r.sent(),[2,this.getQueryTime(e,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},n.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var r=this.gl;return r.getQueryParameter(e,r.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},n.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var r=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=r.getQueryParameter(e,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},n.prototype.pollFence=function(e){var t=this;return new Promise((function(r){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return r()}))}))},n.prototype.pollItems=function(){for(var e=(function(r){for(var i=0;i<r.length&&r[i]();++i);return i-1})(this.itemsToPoll.map((function(r){return r.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},n.prototype.addItemToPoll=function(e,t){var r=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||DS((function(){return r.pollItems(),r.itemsToPoll.length===0}))},n.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Wy(this.gl,this.debug,e,this.framebuffer),this.debug&&ap(this.gl)},n.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Wy(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ap(this.gl)):BS(this.gl,this.debug,this.framebuffer)},n.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var r=t();return this.unbindTextureToFrameBuffer(),r},n.prototype.setOutputMatrixTextureDriver=function(e,t,r){this.throwIfDisposed();var i=this.gl;Wy(i,this.debug,e,this.framebuffer),this.debug&&ap(i),this.outputTexture=e,kt(i,this.debug,(function(){return i.viewport(0,0,t,r)})),kt(i,this.debug,(function(){return i.scissor(0,0,t,r)}))},n.prototype.setOutputMatrixWriteRegionDriver=function(e,t,r,i){var o=this;this.throwIfDisposed(),kt(this.gl,this.debug,(function(){return o.gl.scissor(e,t,r,i)}))},n.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},n.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},n})();function JS(n,e){if(n.length!==e.length)throw Error("Binary was compiled with "+n.length+" inputs, but was executed with "+e.length+" inputs");n.forEach((function(t,r){var i=t.logicalShape,o=e[r],a=o.shape;if(!wr(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!wr(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}}))}var xU=function(n,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var r=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=t.dataFormat,f=s.left,m=s.top,g=i*r,w=Wr(),v=h==="channelsLast",y=v?0:1,x=v?1:2,E="",_=0;_<=1;_++)for(var k=0;k<=1;k++)E+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+_+`;

          if(blockIndex < `+n[1]+" && pos < "+n[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+m+`;
            d0 = offsetY + `+c+" * (pos / "+g+`);

            if(d0 < `+e[y]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+g+".) / "+i+`.));

              if(d1 < `+e[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+v+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*_+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*_+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+E+`

        `+w.output+` = result;
      }
    `},SU=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},EU=function(n,e,t,r,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=t,this.alpha=r,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+r+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+r+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},kU=function(n,e,t,r,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=n[3]-1;this.outputShape=n;var u="float("+t+") + float("+r+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},CU=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideHeight,t=n.strideWidth,r=n.dilationHeight,i=n.effectiveFilterHeight,o=n.effectiveFilterWidth,a=i-1-n.padInfo.top,s=o-1-n.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+r+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},TU=function(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;var e=n.strideDepth,t=n.strideHeight,r=n.strideWidth,i=n.dilationDepth,o=n.dilationHeight,a=n.dilationWidth,s=n.effectiveFilterDepth,u=n.effectiveFilterHeight,l=n.effectiveFilterWidth,c=s-1-n.padInfo.front,h=u-1-n.padInfo.top,f=l-1-n.padInfo.left,m=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+n.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+n.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+r+`.0;

              if (dyC < 0.0 || dyC >= `+n.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+m+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},qy=function(n,e,t,r,i,o,a){t===void 0&&(t=!1),r===void 0&&(r=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?n[1]:n[2],u=Math.ceil(s/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=r?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";o&&(m=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,g="result = activation(result);");var w=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+w+`

        `+g+`

        setOutput(result);
      }
    `},MU=(function(){function n(e,t,r){this.variableNames=["probs"],this.outputShape=[e,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;return function(r,i){t.seedLoc==null&&(t.seedLoc=r.getUniformLocation(i,"seed")),r.gl.uniform1f(t.seedLoc,e)}},n})(),RU=function(n,e,t,r){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+r+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},AU=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;var e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=mi("rc",e),r=Fn(e),i=(function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c})(e,n,t),o=(function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `})(e,n[n.length-1],n[n.length-2],t),a=(function(s,u){var l=s.length,c=(function(h,f){for(var m=[],g=0;g<=1;g++)for(var w=0;w<=1;w++){for(var v=(g===0?"r":"rp1")+", "+(w===0?"c":"cp1"),y=2;y<h;y++)v=f[f.length-1-y]+","+v;m.push(v)}return m})(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"})(n,t);this.userCode=`
        void main() {
          `+r+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},IU=function(n,e,t){this.variableNames=["x"],this.outputShape=e.map((function(u,l){return u[0]+n[l]+u[1]}));var r=n.length,i=Fn(r),o=e.map((function(u){return u[0]})).join(","),a=e.map((function(u,l){return u[0]+n[l]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=r!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},DU=function(n,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(v,y){return v[0]+n[y]+v[1]}));for(var r=n.length,i=Fn(r),o=e.map((function(v){return v[0]})).join(","),a=e.map((function(v,y){return v[0]+n[y]})).join(","),s=mi("rc",r),u=mi("source",r),l=s[r-1]+" < "+this.outputShape[r-1],c=r===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[r-1]+` += 1;
       if(`+l+`) {
      `,r===1?"":`}
       rc = outputLoc;
       `+s[r-2]+` += 1;
       if(`+s[r-2]+" < "+this.outputShape[r-2]+") {",r===1?"":"  "+s[r-1]+` += 1;
         if(`+l+") {"],f=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",g=0,w=r===1?2:4;g<w;g++)m+=`
        `+h[g]+`
        if (`+f+`) {
          result[`+g+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+g+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;m+=r===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `},Xh=function(n,e,t,r,i){if(r===void 0&&(r=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,a=n.strideHeight,s=n.strideWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;var g=e==="avg",w="((batch  * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + d",v="(xR * "+n.inWidth+" + xC) * "+n.inChannels+" + d",y="0.0";if(g||(y="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+s+`);
        const ivec2 pads = ivec2(`+f+", "+m+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+n.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(r?i?w:v:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var E=4*Math.floor(o/4),_=o%4,k=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+f+", "+m+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+u+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+n.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+E+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+k+`
          }

          int xC = xCCorner + `+E+`;
          if (`+(_===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(_===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(_===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+k+`
          }
        }
        setOutput(`+x+`);
      }
    `}},$y=function(n,e,t,r,i){if(r===void 0&&(r=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=n.filterWidth,a=n.strideDepth,s=n.strideHeight,u=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,h=n.dilationWidth,f=n.effectiveFilterDepth,m=n.effectiveFilterHeight,g=n.effectiveFilterWidth,w=n.padInfo.front,v=n.padInfo.top,y=n.padInfo.left;this.outputShape=n.outShape;var x=e==="avg",E="0.0";if(x||(E="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+s+", "+u+`);
        const ivec3 pads = ivec3(`+w+", "+v+", "+y+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+f+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+n.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+m+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+n.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+g+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+n.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(r?i?"(((batch * "+n.inDepth+" + xD) * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"((xD * "+n.inHeight+" + xR) * "+n.inWidth+" + xC) * "+n.inChannels+" + ch":"wD * "+m+" * "+g+` +
                      wR * `+g+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(_="avgValue / count");var k=4*Math.floor(o/4),C=o%4,A=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+s+", "+u+`);
      const ivec3 pads = ivec3(`+w+", "+v+", "+y+`);
      const float initializationValue = `+E+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+n.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+E+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+n.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+m+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+n.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+k+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+A+`
            }

            int xC = xCCorner + `+k+`;
            if (`+(C===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+A+`
            } else if (`+(C===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+A+`
            } else if (`+(C===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+A+`
            }
          }
          setOutput(`+_+`);
        }
      }
    `}},NU=function(n,e){this.variableNames=["x"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=Math.ceil(i/t);this.outputShape=[r,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var m="";i%t>0&&(m=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},PU=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;for(var t="",r=0;r<4;r++){var i="thisRC = rc;";r%2==1&&(i+="thisRC.z += 1;"),r>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+r+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(r>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+Vu(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Vw(n)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+n[1]+`;
        int cols = `+n[2]+`;

        `+t+`

        setOutput(result);
      }
    `},FU=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},OU=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},LU=function(n,e,t,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},BU=function(n,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,i=r[1],o=r[2],a=n.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},UU=function(n,e,t,r){this.variableNames=["A"],this.outputShape=[];var i=n[0],o=n[1],a=n[2],s=n[3];this.outputShape=[i,e,t,s];var u=[r&&e>1?o-1:o,r&&t>1?a-1:a],l=[r&&e>1?e-1:e,r&&t>1?t-1:t],c=r?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},zU=function(n,e){this.variableNames=["x"];var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=n,t!==1){var r=n.map((function(o,a){return(function(s){return e.indexOf(s)!==-1&&n[s]!==1?n[s]+" - coords["+s+"] - 1":"coords["+s+"]"})(a)})).join(","),i=Fn(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+r+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+n[0]+` - coord - 1));
        }
      `},WU=function(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=n.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=n;var r=mi("rc",t),i=r[t-1]+" + 1 < "+this.outputShape[t-1],o=r[t-2]+" + 1 < "+this.outputShape[t-2],a=Fn(t);function s(u){var l=n.map((function(c,h){return(function(f,m){return e.indexOf(f)!==-1&&n[f]!==1?n[f]+" - "+m[f]+" - 1":""+m[f]})(h,u)}));return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+n[0]+` - rc - 1),
            `+n[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+n[0]+` - (rc  + 1) - 1),
                `+n[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(u){return s(u)})(r.slice())+`;
          if(`+i+`){
            result.g = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)})(r.slice())+`;
          }
          if(`+o+`) {
            result.b = `+(function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            if(`+i+`) {
              result.a = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)})(r.slice())+`;
            }
          }
          setOutput(result);
        }
    `},QS=function(n,e,t,r,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Fn(i.length),u=Fn(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";r===1?h="i":r===2&&(h="i, coords[1]");var f="getUpdates("+h+")",m=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+n+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},HU=function(n,e){this.variableNames=["x","segmentIds"];var t=n.windowSize,r=n.batchSize,i=n.inSize,o=n.numSegments,a=o*Math.ceil(i/t);this.outputShape=[r,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},GU=function(n,e,t){var r,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",r="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<n&&a.push(""+o[u]);r=a.join(),i=s.join()}var l=Fn(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+r+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},VU=(function(){function n(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,r=Fn(this.rank),i="uniform int start["+this.rank+"];",o=(function(a){if(a===1)return"sourceLoc";if(a<=6)return Xy.slice(0,a).map((function(s){return"sourceLoc."+s})).join(",");throw Error("Slicing for rank "+a+" is not yet supported")})(this.rank);t=`
        `+r+` sourceLoc;
        `+r+` coords = getOutputCoords();
        `+e.map((function(a,s){return"sourceLoc."+Xy[s]+" = start["+s+"] + coords."+Xy[s]+";"})).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),Xy=["x","y","z","w","u","v"],jU=(function(){function n(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Fn(this.rank),r=mi("coords",this.rank),i=mi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+r[this.rank-1]+`;
      if (++`+r[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+r[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(c,h){return"start["+h+"]"})).join()+");":e.map((function(c,h){return i[h]+" = "+r[h]+" + start["+h+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return n.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(r,i){t.startLoc==null&&(t.startLoc=r.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||r.gl.uniform1iv(t.startLoc,e)}},n})(),qU=function(n,e,t){this.variableNames=["x"],this.outputShape=t;var r=t.length,i=Fn(t.length),o=Fn(t.length),a="";if(r===1)a="coords * strides + begin";else{var s=0;a=t.map((function(u,l){return s++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"})).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+n+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},$U=(function(){function n(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return n.prototype.acquireTexture=function(e,t,r){var i,o=ZS(t,r),a=eE(e,o,r);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===Pi.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Pi.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Pi.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Pi.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Pi.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},n.prototype.releaseTexture=function(e,t,r,i){if(this.freeTextures!=null){var o=eE(t,ZS(r,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},n.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},n.prototype.getNumUsedTextures=function(){return this.numUsedTextures},n.prototype.getNumFreeTextures=function(){return this.numFreeTextures},n.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(r){e.gpgpu.deleteMatrixTexture(r)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(i){e.gpgpu.deleteMatrixTexture(i)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},n})();function ZS(n,e){if(n===Oi.UPLOAD)return Pi.PACKED_2X2_FLOAT32;if(n===Oi.RENDER||n==null)return(function(t){return Ne().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Pi.PACKED_2X2_FLOAT32:Pi.UNPACKED_FLOAT32:t?Pi.PACKED_2X2_FLOAT16:Pi.UNPACKED_FLOAT16})(e);if(n===Oi.DOWNLOAD||n===Oi.PIXELS)return Pi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+n)}function eE(n,e,t){return n[0]+"_"+n[1]+"_"+e+"_"+t}var XU=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[r]*e[r];this.outputShape=t,this.rank=t.length;var i=Fn(this.rank),o=(function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()})(n);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},jw=1.7580993408473768,qw=1.0507009873554805,Kt=function(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},zo="if (isnan(x)) return x;",YU="return x;",tE="return abs(x);",B3=zo+`
  return (x < 0.0) ? 0.0 : x;
`,U3=zo+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,z3="return (x >= 0.0) ? x : (exp(x) - 1.0);",KU=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+jw+`;
  float scale = `+qw+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,nE="return -x;",rE="return ceil(x);",iE="return floor(x);",oE="return exp(x);",aE="return exp(x) - 1.0;",JU=zo+`
  return sin(x);
`,QU=zo+`
  return cos(x);
`,ZU=zo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,e8=zo+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,t8=zo+`
  return atan(x);
`,n8=zo+"return log(x + sqrt(x * x + 1.0));",r8=zo+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,i8=zo+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,cp="return x;",o8="return x;",W3=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,H3=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,G3=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Bh=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},a8=function(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;var e=n.length,t=mi("rc",e),r=Fn(e),i=(function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l})(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+r+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},hp={};function dp(n,e){if(e===void 0&&(e=!1),n==="linear")return e?o8:YU;if(n==="relu")return e?W3:B3;if(n==="elu")return e?G3:z3;if(n==="relu6")return e?H3:U3;if(n==="prelu")return e?L3:O3;throw new Error("Activation "+n+" has not been implemented for the WebGL backend.")}var s8=600,u8=(function(n){function e(t){var r,i=n.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!Ne().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=va(Ne().getNumber("WEBGL_VERSION"));i.binaryCache=((r=Ne().getNumber("WEBGL_VERSION"))in hp||(hp[r]={}),hp[r]),i.gpgpu=new _U(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new $U(i.gpgpu),i.numMBBeforeWarning=Ne().global.screen==null?1024:Ne().global.screen.height*Ne().global.screen.width*window.devicePixelRatio*s8/1024/1024,i.texData=new E3(i,le),i}return Uo(e,n),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,r,i){if(Ne().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:r,dtype:i,values:t,usage:Oi.UPLOAD}),o},e.prototype.move=function(t,r,i,o){if(Ne().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:r,usage:Oi.UPLOAD})},e.prototype.readSync=function(t){var r=this.texData.get(t),i=r.values,o=r.dtype,a=r.complexTensors,s=r.slice,u=r.shape,l=r.isPacked;if(s!=null){var c=void 0;c=l?new Bh(u,cp):new Kt(u,cp);var h=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:o}],o),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var m,g,w=this.activeTimers!=null;return w&&(m=ea()),o==="complex64"?g=m0(a.real.dataSync(),a.imag.dataSync()):g=this.getValuesFromTexture(t),w&&(this.downloadWaitMs+=ea()-m),this.convertAndCacheOnCPU(t,g)},e.prototype.read=function(t){return wt(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,A,I;return _t(this,(function(T){switch(T.label){case 0:if(this.pendingRead.has(t))return r=this.pendingRead.get(t),[2,new Promise((function(R){return r.push(R)}))];if(i=this.texData.get(t),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,s!=null)return h=void 0,h=c?new Bh(a,cp):new Kt(a,cp),f=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:u}],u),m=this.read(f.dataId),this.disposeData(f.dataId),[2,m];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Ne().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ne().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return g=null,u!=="complex64"&&Ne().get("WEBGL_BUFFER_SUPPORTED")&&(w=this.decode(t),v=this.texData.get(w.dataId),g=(I=this.gpgpu).createBufferFromTexture.apply(I,[v.texture].concat(qh(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:T.sent(),T.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return x=T.sent(),E=x[0],_=x[1],y=m0(E,_),[3,5];case 4:g==null?y=this.getValuesFromTexture(t):(k=bt(a),y=this.gpgpu.downloadFloat32MatrixFromBuffer(g,k)),T.label=5;case 5:return w!=null&&this.disposeData(w.dataId),C=this.convertAndCacheOnCPU(t,y),A=this.pendingRead.get(t),this.pendingRead.delete(t),A.forEach((function(R){return R(C)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,C]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var r=0;r<t.length;r++){var i=t[r];if(!CL(i))throw Ne().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.isPacked,u=bt(o);if(Ne().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),h=(r=this.gpgpu).downloadMatrixFromPackedTexture.apply(r,[c.texture].concat(qh(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=Ne().getBool("WEBGL_PACK")&&s===!0,m=f?Hy(o):o,g=f?new J6(m):new K6(m),w=this.runWebGLProgram(g,[{shape:m,dtype:a,dataId:t}],"float32"),v=this.texData.get(w.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(w.dataId),y},e.prototype.time=function(t){return wt(this,void 0,void 0,(function(){var r,i,o,a,s,u,l;return _t(this,(function(c){switch(c.label){case 0:return r=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),a=Fc(this.activeTimers.map((function(h){return h.query}))).filter((function(h){return h!=null})),s=Fc(this.activeTimers.map((function(h){return h.name}))).filter((function(h){return h!=null})),this.activeTimers=r,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=sL(l),u.getExtraProfileInfo=function(){return l.map((function(h,f){return{name:s[f],ms:h}})).map((function(h){return h.name+": "+h.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:ea(),endMs:null}},e.prototype.endTimer=function(t){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=ea(),t)},e.prototype.getQueryTime=function(t){return wt(this,void 0,void 0,(function(){var r;return _t(this,(function(i){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(r=t).endMs-r.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var r=this.texData.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var r=this.texData.get(t),i=r.texture,o=r.dtype,a=r.texShape,s=r.usage,u=r.isPacked,l=r.slice,c=l&&l.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var f=this.texData.get(t);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Ne().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=le.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,r){var i=this;return r===void 0&&(r=128),this.getCPUBackend()!=null&&t.every((function(o){return i.texData.get(o.dataId).texture==null&&bt(o.shape)<r}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,r){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:le.keep(t.clone()),imag:le.keep(r.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,r,i);if(bt(i)===0)return Cr([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,a=x3(t.shape,r,i);if(o||!a){var s=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jU(i):new VU(i),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,r,i)},e.prototype.shallowSlice=function(t,r,i){var o=this.texData.get(t.dataId),a=this.makeOutput(i,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=t.dtype;var u=S3(r,t.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},e.prototype.stridedSlice=function(t,r,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,r,i,o);var a=Uw(r,i,o);if(a.some((function(u){return u===0})))return Cr([],a);var s=new qU(r,o,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,r){var i=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new WU(t.shape,r):new zU(t.shape,r);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,r){if(t[0].dtype==="complex64"){var i=t.map((function(m){return to(m)})),o=t.map((function(m){return ia(m)}));return Er(this.concat(i,r),this.concat(o,r))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,r);if(t.length===1)return t[0];if(t.length>Ne().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),r),u=this.concat(t.slice(a),r);return this.concat([s,u],r)}if(Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new O6(t.map((function(m){return m.shape})),r);return this.compileAndRun(l,t)}var c=Bc(t.map((function(m){return m.shape})),r),h=t.map((function(m){return m.as2D(-1,bt(m.shape.slice(r)))})),f=new F6(h.map((function(m){return m.shape})));return this.compileAndRun(f,h).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,nE,t.dtype);var r=new Kt(t.shape,nE);return this.compileAndRun(r,[t])},e.prototype.batchMatMul=function(t,r,i,o){var a=i?t.shape[2]:t.shape[1],s=o?r.shape[1]:r.shape[2],u=i?t.shape[1]:t.shape[2],l=t.shape[0];if((a===1||s===1)&&u>1e3){i&&(t=Co(t,[0,2,1])),o&&(r=Co(r,[0,2,1]));var c=s===1?t:t.as3D(l,u,1),h=s===1?2:1,f=s===1?r.as3D(l,1,u):r;return this.multiply(c,f).sum(h,!0)}var m=kr(t.dtype,r.dtype),g=new qy(t.shape,[l,a,s],i,o);return this.compileAndRun(g,[t,r],m)},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=o?r.shape[2]:r.shape[1],h=a?i.shape[1]:i.shape[2],f=r.shape[0],m=kr(r.dtype,i.dtype),g=s!=null,w=l!=null,v=u?dp(u,!0):null,y=new qy(r.shape,[f,c,h],o,a,g,v,w),x=[r,i];return s&&x.push(s),l&&x.push(l),this.compileAndRun(y,x,m)},e.prototype.multiply=function(t,r){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(r.dataId),a=new VS(M6,t.shape,r.shape),s=new VS(R6,t.shape,r.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(r,o.complexTensors.real),this.makeComplexComponentTensorInfo(r,o.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.multiply(t,r);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,jS,t.dtype);var f=new qn(jS,t.shape,r.shape);return this.compileAndRun(f,[t,r],t.dtype)},e.prototype.batchNormalization=function(t,r,i,o,a,s){var u=[t,r,i],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),Ne().getBool("WEBGL_PACK_NORMALIZATION")){var h=new T6(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(h,u)}var f=new C6(t.shape,r.shape,i.shape,l,c,o);return this.compileAndRun(f,u)},e.prototype.localResponseNormalization4D=function(t,r,i,o,a){var s=Ne().getBool("WEBGL_PACK_NORMALIZATION")?new kU(t.shape,r,i,o,a):new SU(t.shape,r,i,o,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,r,i,o,a,s,u){var l=new EU(r.shape,o,a,s,u);return this.compileAndRun(l,[r,i,t])},e.prototype.tile=function(t,r){if(t.dtype==="string"){var i=this.readSync(t.dataId).map((function(a){return wm(a)}));return I3(Xt(t.shape,t.dtype,i),r)}var o=new XU(t.shape,r);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,r,i){var o=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new DU(t.shape,r,i):new IU(t.shape,r,i);return this.compileAndRun(o,[t])},e.prototype.gather=function(t,r,i){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.gather(t,r,i);var o=new rU(t.shape,r.size,i);return this.compileAndRun(o,[t,r])},e.prototype.batchToSpaceND=function(t,r,i){K(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var o=r.reduce((function(h,f){return h*f})),a=Cm(t.shape,r,o),s=Tm(a.length,r.length),u=Mm(t.shape,r,o),l=l3(i,r.length),c=c3(u,i,r.length);return Co(t.reshape(a),s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){K(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var o=r.reduce((function(f,m){return f*m})),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=Cm(u.shape,r,o,!1),c=Tm(l.length,r.length,!1),h=Mm(u.shape,r,o,!1);return Co(u.reshape(l),c).reshape(h)},e.prototype.reduce=function(t,r,i){var o=t.shape[0],a=t.shape[1],s=Gy(a),u=new NU({windowSize:s,inSize:a,batchSize:o},r),l=this.compileAndRun(u,[t],i);return l.shape[1]===1?l:this.reduce(l,r,i)},e.prototype.argReduce=function(t,r,i){i===void 0&&(i=null);var o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=Gy(a),u=new v6({windowSize:s,inSize:a,batchSize:o},r,i==null),l=[t];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,r,c)},e.prototype.argReducePacked=function(t,r,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,a=Gy(o[o.length-1]),s=new S6(o,a,r,i==null),u=i==null?[t]:[t,i],l=this.compileAndRun(s,u,"int32");return l.rank===t.rank?this.argReducePacked(t,r,l):l},e.prototype.sum=function(t,r){Ii("sum",r,t.rank);var i=Br(t.shape,r),o=i[0],a=bt(i[1]),s=t.as2D(-1,a),u=Fy(t.dtype);return this.reduce(s,"sum",u).reshape(o)},e.prototype.prod=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,r);var i=Br(t.shape,r),o=i[0],a=bt(i[1]),s=t.as2D(-1,a),u=Fy(t.dtype);return this.reduce(s,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,r,i){var o=0,a=ya([o],t.rank),s=t;a!=null&&(s=Co(t,a),o=ba(1,t.rank)[0]);var u=(function(m,g,w){for(var v=[],y=m.length,x=0;x<y;x++)x!==g?v.push(m[x]):v.push(w);return v})(s.shape,o,i),l=bt([s.shape[o]]),c=s.as2D(-1,l),h=Fy(t.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",r,h,i).reshape(u);return a!=null&&(f=Co(f,Fw(a))),f},e.prototype.segOpCompute=function(t,r,i,o,a){var s=t.shape[0],u=t.shape[1],l=(function(f,m){var g,w=!1;for(f<=_3?(g=f,w=!0):g=a0(f,Math.floor(Math.sqrt(f)));!w;)g>m||g===f?w=!0:g=a0(f,g+1);return g})(u,a),c=new HU({windowSize:l,inSize:u,batchSize:s,numSegments:a}),h=this.compileAndRun(c,[t,i],o);return h.shape[1]===a?h:(i=km(0,a).tile([u/l]),this.segOpCompute(h,r,i,o,a))},e.prototype.argMinMaxReduce=function(t,r,i){var o=[r];if(Ii("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!Ne().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=Br(t.shape,o),s=a[0],u=bt(a[1]),l=t.as2D(-1,u);return this.argReduce(l,i).reshape(s)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,r){return this.argMinMaxReduce(t,r,"min")},e.prototype.argMax=function(t,r){return this.argMinMaxReduce(t,r,"max")},e.prototype.cumsum=function(t,r,i,o){if(r!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+r);var a=new j6(t.shape,i,o);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(equal(a, b));
`,"bool");var i=new qn("return float(a == b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.notEqual=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(notEqual(a, b));
`,"bool");var i=new qn("return float(a != b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.less=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.less(t,r);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThan(a, b));
`,"bool");var i=new qn("return float(a < b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.lessEqual=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new qn("return float(a <= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greater=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.greater(t,r);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new qn("return float(a > b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.greaterEqual=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new qn("return float(a >= b);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalNot=function(t){var r=new Kt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(r,[t])},e.prototype.logicalAnd=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new qn("return float(a >= 1.0 && b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.logicalOr=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new qn("return float(a >= 1.0 || b >= 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r],"bool")},e.prototype.select=function(t,r,i){var o=new GU(t.rank,r.shape,r.rank);return this.compileAndRun(o,[t,r,i],kr(r.dtype,i.dtype))},e.prototype.where=function(t){Sm("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var r=t.dataSync();return Gw(t.shape,r)},e.prototype.topk=function(t,r,i){return D3(t.dataSync(),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Ii("min",r,t.rank);var i=Br(t.shape,r),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},e.prototype.minimum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.minimum(t,r);var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new qn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.mod=function(t,r){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new qn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.max=function(t,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,r);Ii("max",r,t.rank);var i=Br(t.shape,r),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},e.prototype.maximum=function(t,r){if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.maximum(t,r);var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new qn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.all=function(t,r){Ii("all",r,t.rank);var i=Br(t.shape,r),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},e.prototype.any=function(t,r){Ii("any",r,t.rank);var i=Br(t.shape,r),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},e.prototype.floorDiv=function(t,r){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new qn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,r.shape);return this.compileAndRun(i,[t,r],"int32")},e.prototype.add=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,Vy);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.add(t,r);var i=kr(t.dtype,r.dtype);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,Vy,i);var o=new qn(Vy,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.packedUnaryOp=function(t,r,i){var o=new Bh(t.shape,r);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,r,i,o,a){a===void 0&&(a=!1);var s=new Jo(i,t.shape,r.shape,a);return this.compileAndRun(s,[t,r],o)},e.prototype.complexSeparableBinaryOp=function(t,r,i){var o=this,a=this.texData.get(t.dataId),s=this.texData.get(r.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map((function(f){var m=f[0],g=f[1],w=o.makeComplexComponentTensorInfo(t,m),v=o.makeComplexComponentTensorInfo(r,g),y=new qn(i,t.shape,r.shape);return o.compileAndRun(y,[w,v],kr(m.dtype,g.dtype))})),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,r){return{dataId:r.dataId,dtype:r.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Ne().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var r=Math.floor(t.length/2),i=this.addN(t.slice(0,r)),o=this.addN(t.slice(r));return this.addN([i,o])}var a=t.map((function(l){return l.dtype})).reduce((function(l,c){return kr(l,c)})),s=t.map((function(l){return l.shape})),u=Ne().getBool("WEBGL_PACK")?new g6(t[0].shape,s):new m6(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,r){if(t.dtype==="complex64"&&r.dtype==="complex64")return this.complexSeparableBinaryOp(t,r,jy);if(this.shouldExecuteOnCPU([t,r]))return this.cpuBackend.subtract(t,r);var i=kr(t.dtype,r.dtype);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,r,jy,t.dtype);var o=new qn(jy,t.shape,r.shape);return this.compileAndRun(o,[t,r],i)},e.prototype.pow=function(t,r){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new qn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,r.shape),o=kr(t.dtype,r.dtype);return this.compileAndRun(i,[t,r],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,rE,t.dtype);var r=new Kt(t.shape,rE);return this.compileAndRun(r,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,iE,t.dtype);var r=new Kt(t.shape,iE);return this.compileAndRun(r,[t])},e.prototype.sign=function(t){var r=new Kt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(r,[t])},e.prototype.isNaN=function(t){var r=new Kt(t.shape,"return float(isnan(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isInf=function(t){var r=new Kt(t.shape,"return float(isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.isFinite=function(t){var r=new Kt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(r,[t],"bool")},e.prototype.round=function(t){var r=new Kt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(r,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,oE,t.dtype);var r=new Kt(t.shape,oE);return this.compileAndRun(r,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,aE,t.dtype);var r=new Kt(t.shape,aE);return this.compileAndRun(r,[t])},e.prototype.softmax=function(t,r){var i=dr([r],t.shape),o=this.max(t,i),a=xi(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return Js(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var r=new Kt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(r,[t])},e.prototype.log1p=function(t){var r=new Kt(t.shape,"return log(1.0 + x);");return this.compileAndRun(r,[t])},e.prototype.sqrt=function(t){var r=new Kt(t.shape,"return sqrt(x);");return this.compileAndRun(r,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var r=new Kt(t.shape,"return inversesqrt(x);");return this.compileAndRun(r,[t])},e.prototype.reciprocal=function(t){var r=new Kt(t.shape,"return 1.0 / x;");return this.compileAndRun(r,[t])},e.prototype.relu=function(t){var r;return r=Ne().getBool("WEBGL_PACK")?new Bh(t.shape,W3):new Kt(t.shape,B3),this.compileAndRun(r,[t])},e.prototype.relu6=function(t){var r;return r=Ne().getBool("WEBGL_PACK")?new Bh(t.shape,H3):new Kt(t.shape,U3),this.compileAndRun(r,[t])},e.prototype.prelu=function(t,r){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(L3,t.shape,r.shape):new qn(O3,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.elu=function(t){if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,G3,t.dtype);var r=new Kt(t.shape,z3);return this.compileAndRun(r,[t])},e.prototype.eluDer=function(t,r){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,r.shape):new qn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.selu=function(t){var r=new Kt(t.shape,KU);return this.compileAndRun(r,[t])},e.prototype.int=function(t){var r=new Kt(t.shape,"return float(int(x));");return this.compileAndRun(r,[t],"int32")},e.prototype.clip=function(t,r,i){var o,a=(o=Ne().getBool("WEBGL_PACK_CLIP")?new N6(t.shape):new D6(t.shape)).getCustomSetupFunc(r,i);return this.compileAndRun(o,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,tE,t.dtype);var r=new Kt(t.shape,tE);return this.compileAndRun(r,[t])},e.prototype.complexAbs=function(t){var r=this.texData.get(t.dataId),i=new P6(t.shape),o=[this.makeComplexComponentTensorInfo(t,r.complexTensors.real),this.makeComplexComponentTensorInfo(t,r.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var r=new Kt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(r,[t])},e.prototype.softplus=function(t){var r=new Kt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(r,[t])},e.prototype.sin=function(t){var r=new Kt(t.shape,JU);return this.compileAndRun(r,[t])},e.prototype.cos=function(t){var r=new Kt(t.shape,QU);return this.compileAndRun(r,[t])},e.prototype.tan=function(t){var r=new Kt(t.shape,"return tan(x);");return this.compileAndRun(r,[t])},e.prototype.asin=function(t){var r=new Kt(t.shape,ZU);return this.compileAndRun(r,[t])},e.prototype.acos=function(t){var r=new Kt(t.shape,e8);return this.compileAndRun(r,[t])},e.prototype.atan=function(t){var r=new Kt(t.shape,t8);return this.compileAndRun(r,[t])},e.prototype.atan2=function(t,r){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,r.shape):new qn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,r.shape);return this.compileAndRun(i,[t,r])},e.prototype.sinh=function(t){var r=new Kt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.cosh=function(t){var r=new Kt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(r,[t])},e.prototype.tanh=function(t){var r=new Kt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(r,[t])},e.prototype.asinh=function(t){var r=new Kt(t.shape,n8);return this.compileAndRun(r,[t])},e.prototype.acosh=function(t){var r=new Kt(t.shape,r8);return this.compileAndRun(r,[t])},e.prototype.atanh=function(t){var r=new Kt(t.shape,i8);return this.compileAndRun(r,[t])},e.prototype.erf=function(t){var r=new Kt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(r,[t])},e.prototype.step=function(t,r){var i=new Kt(t.shape,(function(o){return o===void 0&&(o=0),zo+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `})(r));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,r,i,o,a,s){var u=t.shape,l=this.texData.get(t.dataId),c=i.inChannels,h=u[0]*u[1]*u[2],f=i.outChannels,m=i.dataFormat==="channelsLast",g=(h===1||f===1)&&c>1e3,w=u[2]%2!=0&&!!l.isPacked;if(g||!Ne().getBool("WEBGL_LAZILY_UNPACK")||!Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!w){var v=m?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],y=this.reshape(t,[1,v,i.inChannels]),x=this.reshape(r,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var E=m?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),_={dataId:t.dataId,shape:[1,E,i.inChannels],dtype:t.dtype},k=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,K(up(l.shape,_.shape),(function(){return"packed reshape "+l.shape+" to "+_.shape+" isn't free"}));var C=this.reshape(r,[1,i.inChannels,i.outChannels]),A=this.fusedBatchMatMul({a:_,b:C,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),I=this.texData.get(A.dataId);return K(I.isPacked,(function(){return"batchMatMul result is expected to be packed"})),l.shape=k,I.shape=i.outShape,le.makeTensorFromDataId(A.dataId,i.outShape,A.dtype)},e.prototype.conv2dWithIm2Row=function(t,r,i,o,a,s){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,h=i.outWidth,f=i.outHeight,m=i.dataFormat==="channelsLast",g=u*l*c,w=f*h,v=[g,w],y=t.squeeze([0]),x=r.reshape([1,g,-1]),E=new xU(v,y.shape,i),_=this.compileAndRun(E,[y]).reshape([1,v[0],v[1]]),k=o!=null,C=s!=null,A=a?dp(a,!0):null,I=new qy(_.shape,[1,w,i.outChannels],!0,!1,k,A,C),T=[_,x];o&&T.push(o),C&&T.push(s);var R=this.compileAndRun(I,T);return m?R.reshape([1,f,h,i.outChannels]):R.reshape([1,i.outChannels,f,h])},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(r,i,o,a,s,u);if(Ne().getBool("WEBGL_CONV_IM2COL")&&r.shape[0]===1)return this.conv2dWithIm2Row(r,i,o,a,s,u);var l=a!=null,c=u!=null,h=s?dp(s,!1):null,f=new qS(o,l,h,c),m=[r,i];return a&&m.push(a),u&&m.push(u),this.compileAndRun(f,m)},e.prototype.conv2d=function(t,r,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,r,i);if(Ne().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,r,i);var o=new qS(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerInput=function(t,r,i){var o=new B6(i);return this.compileAndRun(o,[t,r])},e.prototype.conv2dDerFilter=function(t,r,i){var o=new L6(i);return this.compileAndRun(o,[t,r])},e.prototype.fusedDepthwiseConv2D=function(t){var r,i=t.input,o=t.filter,a=t.convInfo,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=Ne().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?dp(u,c):null,f=[i,o],m=s!=null,g=l!=null;return m&&f.push(s),g&&f.push(l),c?(r=new XS(a,m,h,g),this.compileAndRun(r,f)):(r=new $S(a,m,h,g),this.compileAndRun(r,f))},e.prototype.depthwiseConv2D=function(t,r,i){var o;return Ne().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new XS(i),this.compileAndRun(o,[t,r])):(o=new $S(i),this.compileAndRun(o,[t,r]))},e.prototype.depthwiseConv2DDerInput=function(t,r,i){var o=new H6(i);return this.compileAndRun(o,[t,r])},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){var o=new W6(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3d=function(t,r,i){var o=new G6(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerInput=function(t,r,i){var o=new z6(i);return this.compileAndRun(o,[t,r])},e.prototype.conv3dDerFilter=function(t,r,i){var o=new U6(i);return this.compileAndRun(o,[t,r])},e.prototype.maxPool=function(t,r){var i=new Xh(r,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,r){var i=new Xh(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,r,i,o){var a=new Xh(o,"max",!0),s=this.compileAndRun(a,[r]),u=new CU(o),l=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),l},e.prototype.avgPoolBackprop=function(t,r,i){var o=new E6(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.cast=function(t,r){return T3(t,r,this)},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.avgPool3d=function(t,r){var i=new $y(r,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,r,i){var o=new k6(i);return this.compileAndRun(o,[t],r.dtype)},e.prototype.maxPool3d=function(t,r){var i=new $y(r,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,r,i,o){var a=new $y(o,"max",!0),s=this.compileAndRun(a,[r]),u=new TU(o),l=this.compileAndRun(u,[t,s],r.dtype);return s.dispose(),l},e.prototype.reshape=function(t,r){var i=this.texData.get(t.dataId);if(i.isPacked&&!up(t.shape,r)&&(i.texture===null||!up(i.shape,r))){var o=this.packedReshape(t,r);return le.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return p0(t,r)},e.prototype.resizeBilinear=function(t,r,i,o){var a=Ne().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new LU(t.shape,r,i,o):new OU(t.shape,r,i,o);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,r,i){var o=new FU(t,r,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,r,i,o){var a=new UU(t.shape,r,i,o);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){var o=new BU(t,r,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,r,i,o){var a=r?t:ag(t),s=a.shape[0],u=a.shape[1],l=new MU(s,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[a],"int32",c)},e.prototype.oneHot=function(t,r,i,o){var a=new RU(t.size,r,i,o);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var r=new Y6(t.size);return this.compileAndRun(r,[t])},e.prototype.nonMaxSuppression=function(t,r,i,o,a){return Sm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ww(t.dataSync(),r.dataSync(),i,o,a)},e.prototype.cropAndResize=function(t,r,i,o,a,s){var u=new V6(t.shape,r.shape,o,a,s);return this.compileAndRun(u,[t,r,i],"float32")},e.prototype.depthToSpace=function(t,r,i){K(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));var o=t.shape[0],a=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],l=a*r,c=s*r,h=u/(r*r),f=new X6(i==="NHWC"?[o,l,c,h]:[o,h,l,c],r,i);return this.compileAndRun(f,[t])},e.prototype.split=function(t,r,i){return A3(t,r,i)},e.prototype.scatterND=function(t,r,i){var o=Am(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=[c/u,u],f=t.reshape([s,a]),m=r.reshape([s,u]);if(c===0)return p0(Cr([]),i);var g=Ct(0),w=new QS(s,a,f.rank,m.rank,l,h);return this.compileAndRun(w,[m,f,g]).reshape(i)},e.prototype.sparseToDense=function(t,r,i,o){var a=Am(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,h=new QS(u,s,t.rank,r.rank,l,[c,1]);return this.compileAndRun(h,[r,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,r){var i=this.texData.get(t.dataId),o=new KS(eU,t.shape,r),a=new KS(tU,t.shape,r),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=w3(t,r),s=a[0],u=a[1],l=a[2],c=a[3],h=r.reshape([u,o]),f=t.reshape([t.size/l,l]),m=new iU(o,c,[u,l]);return this.compileAndRun(m,[f,h]).reshape(s)},e.prototype.fill=function(t,r,i){if((i=i||Ed(r))==="string"){var o=bm(i,bt(t));return o.fill(r),le.makeTensor(o,t,i,this)}var a=new nU(t,r),s=a.getCustomSetupFunc(r);return this.compileAndRun(a,[],i,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,r,i){return M3(t,r,i)},e.prototype.makeTensorInfo=function(t,r){var i=this.write(null,t,r);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:r}},e.prototype.makeOutput=function(t,r){var i=this.makeTensorInfo(t,r).dataId;return le.makeTensorFromDataId(i,t,r,this)},e.prototype.unpackTensor=function(t){var r=new a8(t.shape);return this.runWebGLProgram(r,[t],t.dtype)},e.prototype.packTensor=function(t){var r=new AU(t.shape);return this.runWebGLProgram(r,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,r){var i=[_m(t.shape)].concat(xm(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[_m(r)].concat(xm(r)),s=new PU(a,i),u=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:r,dtype:u.dtype}},e.prototype.decode=function(t){var r,i=this.texData.get(t),o=i.isPacked,a=i.shape,s=i.dtype,u=Hy(a);return r=o?new $6(u):new q6(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(r,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,r,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,i),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===td.DENSE){var c=qh(t.outputShape);l.texShape=c.map((function(E){return 2*E}))}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),bt(u.shape)===0)return l.values=Oc(u.dtype,0),u;var h=[],f=r.map((function(E){if(E.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var _=s.texData.get(E.dataId);if(_.texture==null){if(!t.packedInputs&&bt(E.shape)<=Ne().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:E.shape,texData:null,isUniform:!0,uniformValues:_.values};t.packedInputs&&(_.isPacked=!0,_.shape=E.shape)}else if(!!_.isPacked!=!!t.packedInputs)E=_.isPacked?s.unpackTensor(E):s.packTensor(E),h.push(E),_=s.texData.get(E.dataId);else if(_.isPacked&&!up(_.shape,E.shape)){var k=E,C=E.shape;E.shape=_.shape,E=s.packedReshape(E,C),h.push(E),_=s.texData.get(E.dataId),k.shape=C}return s.uploadToGPU(E.dataId),{shape:E.shape,texData:_,isUniform:!1}}));this.uploadToGPU(u.dataId);var m,g={shape:u.shape,texData:l,isUniform:!1},w=(function(E,_,k){var C="";_.concat(k).forEach((function(T){var R=T.texData!=null&&T.texData.slice!=null&&T.texData.slice.flatOffset>0,N=T.isUniform?"uniform":T.texData.texShape;C+=T.shape+"_"+N+"_"+R}));var A=E.userCode,I=E.constructor.name;return I+="_"+C+"_"+A})(t,f,g),v=this.getAndSaveBinary(w,(function(){return(function(E,_,k,C){var A=_.userCode,I=k.map((function(L,H){var W={logicalShape:L.shape,texShape:L.isUniform?null:L.texData.texShape,isUniform:L.isUniform,isPacked:!L.isUniform&&L.texData.isPacked,flatOffset:null};return L.texData!=null&&L.texData.slice!=null&&L.texData.slice.flatOffset>0&&(W.flatOffset=L.texData.slice.flatOffset),{name:_.variableNames[H],shapeInfo:W}})),T=I.map((function(L){return L.shapeInfo})),R={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},N=y6(I,R,A,_.packedInputs),O=E.createProgram(N),V=null,F=E.getUniformLocation(O,"NAN",!1);Ne().getNumber("WEBGL_VERSION")===1&&(V=E.getUniformLocation(O,"INFINITY",!1));for(var B={},U=0;U<_.variableNames.length;U++){var P=_.variableNames[U];B[P]=E.getUniformLocation(O,P,!1),B["offset"+P]=E.getUniformLocation(O,"offset"+P,!1)}return{program:_,source:N,webGLProgram:O,uniformLocations:B,inShapeInfos:T,outShapeInfo:R,infLoc:V,nanLoc:F}})(s.gpgpu,t,f,g)})),y=this.activeTimers!=null;if(y&&(m=this.startTimer()),(function(E,_,k,C,A){JS(_.inShapeInfos,k),JS([_.outShapeInfo],[C]);var I=C.texData.texture,T=C.texData.texShape;C.texData.isPacked?E.setOutputPackedMatrixTexture(I,T[0],T[1]):E.setOutputMatrixTexture(I,T[0],T[1]),E.setProgram(_.webGLProgram),Ne().getNumber("WEBGL_VERSION")===1&&_.infLoc!==null&&E.gl.uniform1f(_.infLoc,1/0),_.nanLoc!==null&&E.gl.uniform1f(_.nanLoc,NaN),k.forEach((function(R,N){var O=_.program.variableNames[N],V=_.uniformLocations[O],F=_.uniformLocations["offset"+O];if(V!=null)if(R.isUniform)if(bt(R.shape)<2)E.gl.uniform1f(V,R.uniformValues[0]);else{var B=R.uniformValues;B instanceof Float32Array||(B=new Float32Array(B)),E.gl.uniform1fv(V,B)}else R.texData.slice!=null&&F!=null&&E.gl.uniform1i(F,R.texData.slice.flatOffset),E.setInputMatrixTexture(R.texData.texture,V,N)})),A?.(E,_.webGLProgram),E.executeProgram()})(this.gpgpu,v,f,g,o),h.forEach((function(E){return s.disposeData(E.dataId)})),y&&(m=this.endTimer(m),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(m)})),!Ne().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},e.prototype.compileAndRun=function(t,r,i,o,a){a===void 0&&(a=!1),i=i||r[0].dtype;var s=this.runWebGLProgram(t,r,i,o,a);return le.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,r){return t in this.binaryCache||(this.binaryCache[t]=r()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Ne().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(r){t.gpgpu.deleteProgram(t.binaryCache[r].webGLProgram),delete t.binaryCache[r]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=_n((function(){if(!Ne().get("WEBGL_RENDER_FLOAT32_ENABLED")){var r=Ne().getBool("DEBUG");Ne().set("DEBUG",!1);var i=t.abs(Ct(1e-8)).dataSync()[0];if(Ne().set("DEBUG",r),i>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var r,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var h,f=this.activeTimers!=null;f&&(h=ea());var m=i.texShape;if(m==null&&(m=VL(o,c),i.texShape=m),s!=null){var g=Hy(o),w=void 0,v=m[1],y=m[0],x=s instanceof Uint8Array;c?(v=(r=Cd(m[0],m[1]))[0],y=r[1],w=new Z6(g,[y,v],x)):w=new Q6(g,[y,v],x);var E=this.makeTensorInfo([y,v],a);this.texData.get(E.dataId).usage=x?Oi.PIXELS:Oi.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(E.dataId),v,y,s);var _=this.runWebGLProgram(w,[E],a,null,!0),k=this.texData.get(_.dataId);i.texture=k.texture,i.texShape=k.texShape,i.isPacked=k.isPacked,i.usage=k.usage,this.disposeData(E.dataId),this.texData.delete(_.dataId),i.values=null,f&&(this.uploadWaitMs+=ea()-h)}else{var C=this.acquireTexture(m,l,a,c);i.texture=C}}},e.prototype.convertAndCacheOnCPU=function(t,r){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),r!=null&&(i.values=(function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)})(r,o)),i.values},e.prototype.acquireTexture=function(t,r,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,r,o)},e.prototype.computeBytes=function(t,r){return t[0]*t[1]*$T(r)},e})(k3);t3()&&le.registerBackend("webgl",(function(){return new u8}),2);function ul(n,e){return n(e={exports:{}},e.exports),e.exports}var l8=ul((function(n){(function(e,t,r){function i(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var m=.02519603282416938*(u+=h.charCodeAt(f));m-=u=m>>>0,u=(m*=u)>>>0,u+=4294967296*(m-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,n)})),c8=ul((function(n){(function(e,t,r){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,n)})),h8=ul((function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,n)})),d8=ul((function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},(function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()})(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,n)})),f8=ul((function(n){(function(e,t,r){function i(s){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,m=u.i;return u.w=h=h+1640531527|0,c=f[m+34&127],l=f[m=m+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[m]=c^l,u.i=m,c+(h^h>>>16)|0},(function(l,c){var h,f,m,g,w,v=[],y=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,y=Math.max(y,c.length)),m=0,g=-32;g<y;++g)c&&(f^=c.charCodeAt((g+32)%c.length)),g===0&&(w=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(w=w+1640531527|0,m=(h=v[127&g]^=f+w)==0?m+1:0);for(m>=128&&(v[127&(c&&c.length||0)]=-1),m=127,g=512;g>0;--g)f=v[m+34&127],h=v[m=m+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,v[m]=f^h;l.w=w,l.X=v,l.i=m})(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,n)})),p8=ul((function(n){(function(e,t,r){function i(s){var u=this,l="";u.next=function(){var h=u.b,f=u.c,m=u.d,g=u.a;return h=h<<25^h>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-m|0,u.d=m<<16^f>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,n)})),Fu=ul((function(n){(function(e,t){var r,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function f(y,x,E){var _=[],k=w((function I(T,R){var N,O=[],V=typeof T;if(R&&V=="object")for(N in T)try{O.push(I(T[N],R-1))}catch{}return O.length?O:V=="string"?T:T+"\0"})((x=x==1?{entropy:!0}:x||{}).entropy?[y,v(e)]:y??(function(){try{var I;return r&&(I=r.randomBytes)?I=I(o):(I=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(I)),v(I)}catch{var T=i.navigator,R=T&&T.plugins;return[+new Date,i,R,i.screen,v(e)]}})(),3),_),C=new m(_),A=function(){for(var I=C.g(a),T=u,R=0;I<l;)I=(I+R)*o,T*=o,R=C.g(1);for(;I>=c;)I/=2,T/=2,R>>>=1;return(I+R)/T};return A.int32=function(){return 0|C.g(4)},A.quick=function(){return C.g(4)/4294967296},A.double=A,w(v(C.S),e),(x.pass||E||function(I,T,R,N){return N&&(N.S&&g(N,C),I.state=function(){return g(C,{})}),R?(t[s]=I,T):I})(A,k,"global"in x?x.global:this==t,x.state)}function m(y){var x,E=y.length,_=this,k=0,C=_.i=_.j=0,A=_.S=[];for(E||(y=[E++]);k<o;)A[k]=k++;for(k=0;k<o;k++)A[k]=A[C=h&C+y[k%E]+(x=A[k])],A[C]=x;(_.g=function(I){for(var T,R=0,N=_.i,O=_.j,V=_.S;I--;)T=V[N=h&N+1],R=R*o+V[h&(V[N]=V[O=h&O+T])+(V[O]=T)];return _.i=N,_.j=O,R})(o)}function g(y,x){return x.i=y.i,x.j=y.j,x.S=y.S.slice(),x}function w(y,x){for(var E,_=y+"",k=0;k<_.length;)x[h&k]=h&(E^=19*x[h&k])+_.charCodeAt(k++);return v(x)}function v(y){return String.fromCharCode.apply(0,y)}if(t["seed"+s]=f,w(t.random(),e),n.exports){n.exports=f;try{r=require("crypto")}catch{}}})([],Math)}));Fu.alea=l8,Fu.xor128=c8,Fu.xorwow=h8,Fu.xorshift7=d8,Fu.xor4096=f8,Fu.tychei=p8;var sg=Fu.alea,m8=oe({addN_:function(n){K(Array.isArray(n),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),K(n.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+n.length}));var e=n.map((function(i,o){return X(i,"tensors"+o,"addN")})),t=e[0];e.forEach((function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(i){if(!wr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return le.runKernelFunc((function(i,o){return i.addN(e)}),r,null,"AddN")}});function ug(){n3("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function V3(n){return n.rank===0||n.rank===1?n.as4D(1,1,1,n.size):n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}function j3(n,e,t,r,i,o){o==null&&(o=.001);var a,s,u=X(n,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");i!=null&&(a=X(i,"scale","batchNorm")),r!=null&&(s=X(r,"offset","batchNorm")),K(l.rank===c.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),K(s==null||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),K(a==null||l.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h={x:u,scale:a,offset:s,mean:l,variance:c},f={varianceEpsilon:o};return le.runKernelFunc((function(m,g){var w=V3(u),v=m.batchNormalization(w,fp(l),fp(c),o,fp(a),fp(s));return g([u,l,c,a]),v}),h,null,"FusedBatchNorm",f).reshape(u.shape)}function fp(n){return n==null?null:n.rank===0?n.as1D():n.rank===1?n:n.rank===2?n.as4D(1,1,n.shape[0],n.shape[1]):n.rank===3?n.as4D(1,n.shape[0],n.shape[1],n.shape[2]):n}var g8=oe({batchNormalization_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),ug(),j3(n,e,t,o,i,r)}}),Md=oe({batchNorm_:j3});function q3(n,e,t,r,i,o){var a,s,u=X(n,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");return i!=null&&(a=X(i,"scale","batchNorm")),r!=null&&(s=X(r,"offset","batchNorm")),K(u.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),K(l.rank===2||l.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."})),K(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."})),a!=null&&K(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),s!=null&&K(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Md(u,l,c,s,a,o)}var v8=oe({batchNormalization2d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),ug(),q3(n,e,t,o,i,r)}}),y8=oe({batchNorm2d_:q3});function $3(n,e,t,r,i,o){var a,s,u=X(n,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");return i!=null&&(a=X(i,"scale","batchNorm")),r!=null&&(s=X(r,"offset","batchNorm")),K(u.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),K(l.rank===3||l.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."})),K(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."})),a!=null&&K(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),s!=null&&K(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Md(u,l,c,s,a,o)}var b8=oe({batchNormalization3d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),ug(),$3(n,e,t,o,i,r)}}),w8=oe({batchNorm3d_:$3});function X3(n,e,t,r,i,o){var a,s,u=X(n,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");return i!=null&&(a=X(i,"scale","batchNorm")),r!=null&&(s=X(r,"offset","batchNorm")),K(u.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),K(l.rank===4||l.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."})),K(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."})),a!=null&&K(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),s!=null&&K(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Md(u,l,c,s,a,o)}var _8=oe({batchNormalization4d_:function(n,e,t,r,i,o){return r===void 0&&(r=.001),ug(),X3(n,e,t,o,i,r)}}),x8=oe({batchNorm4d_:X3}),Y3=oe({broadcastTo_:function(n,e){var t=X(n,"broadcastTo","x"),r=t.shape;if(e.some((function(h){return!(h>0)||h%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=t.shape,a=Array.from(e),s=e.length-1;s>=0;s--)if(o[s]===e[s])a[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=a.map((function(h,f){return h>1?f:-1})).filter((function(h){return h>=0}));if(u.length===0)return t.clone();var l={x:t},c={shape:e,inputShape:o};return le.runKernelFunc((function(h){return h.tile(t,a)}),l,(function(h){return{x:function(){return h.sum(u,!0)}}}),d3,c)}}),S8=oe({clone_:function(n){var e=X(n,"x","clone",null);return le.runKernelFunc((function(){return le.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{x:e},null,p3)}}),lg=oe({logicalAnd_:function(n,e){var t=X(n,"a","logicalAnd","bool"),r=X(e,"b","logicalAnd","bool");return on(t.shape,r.shape),le.runKernelFunc((function(i){return i.logicalAnd(t,r)}),{a:t,b:r},null,"LogicalAnd")}}),E8=oe({logicalNot_:function(n){var e=X(n,"x","logicalNot","bool");return le.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),K3=oe({logicalOr_:function(n,e){var t=X(n,"a","logicalOr","bool"),r=X(e,"b","logicalOr","bool");return on(t.shape,r.shape),le.runKernelFunc((function(i){return i.logicalOr(t,r)}),{$a:t,$b:r})}}),k8=oe({logicalXor_:function(n,e){var t=X(n,"a","logicalXor","bool"),r=X(e,"b","logicalXor","bool");return on(t.shape,r.shape),K3(n,e).logicalAnd(lg(n,e).logicalNot())}}),tl=oe({where_:function(n,e,t){var r=X(e,"a","where"),i=X(t,"b","where"),o=X(n,"condition","where","bool");return En(r.shape,i.shape,"Error in where: "),o.rank===1?K(o.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):En(o.shape,i.shape,"Error in where: "),le.runKernelFunc((function(a,s){var u=a.select(o,r,i);return s([o]),u}),{$condition:o,$a:r,$b:i},(function(a,s){var u=s[0];return{$condition:function(){return hn(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}}))}}),J3=function(n){return wt(this,void 0,void 0,(function(){var e,t,r;return _t(this,(function(i){switch(i.label){case 0:return[4,(e=X(n,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),r=Gw(e.shape,t),n!==e&&e.dispose(),[2,r]}}))}))},Q3=oe({divNoNan_:function(n,e){var t,r=X(n,"a","div"),i=X(e,"b","div");r=(t=Gn(r,i))[0],i=t[1];var o=Js(r,i),a=hn(o),s=i.equal(a);return tl(s,a,o)}}),Ec=oe({tile_:function(n,e){var t=X(n,"x","tile",null);K(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var r=[t],i={x:t},o={reps:e};return le.runKernelFunc((function(a,s){var u=a.tile(t,e);return s([t]),u}),i,null,m3,o,r)}}),Z3=oe({eye_:function(n,e,t,r){r===void 0&&(r="float32"),e==null&&(e=n);for(var i=Xt([n,e],r),o=n<=e?n:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(n,e);if(t==null)return s;if(t.length===1)return Ec(Bs(s,0),[t[0],1,1]);if(t.length===2)return Ec(Bs(Bs(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return Ec(Bs(Bs(Bs(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),C8=oe({multinomial_:function(n,e,t,r){r===void 0&&(r=!1);var i=X(n,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=le.runKernelFunc((function(l){return l.multinomial(s,r,e,t)}),{logits2D:s});return a===1?u.as1D():u}}),Pm=oe({oneHot_:function(n,e,t,r){if(t===void 0&&(t=1),r===void 0&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=X(n,"indices","oneHot","int32"),o=i.shape.concat([e]),a={indices:i=i.flatten()},s={depth:e,onValue:t,offValue:r};return le.runKernelFunc((function(u,l){return l([i]),u.oneHot(i,e,t,r)}),a,null,f3,s).reshape(o)}}),Za=oe({pad_:function(n,e,t){t===void 0&&(t=0);var r=X(n,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t},o={x:r};return le.runKernelFunc((function(a,s){return s([r]),a.pad(r,e,t)}),o,null,g3,i)}}),T8=oe({pad1d_:function(n,e,t){return t===void 0&&(t=0),K(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),Za(n,[e],t)}}),M8=oe({pad2d_:function(n,e,t){return t===void 0&&(t=0),K(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Za(n,e,t)}}),R8=oe({pad3d_:function(n,e,t){return t===void 0&&(t=0),K(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Za(n,e,t)}}),A8=oe({pad4d_:function(n,e,t){return t===void 0&&(t=0),K(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Za(n,e,t)}}),I8=oe({rand_:function(n,e,t){var r=bt(n),i=null;if(t==null||t==="float32")i=new Float32Array(r);else if(t==="int32")i=new Int32Array(r);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(r)}for(var o=0;o<r;o++)i[o]=e();return le.makeTensor(i,n,t)}}),$w=(function(){function n(e,t,r,i,o){this.mean=e,this.stdDev=t,this.dtype=r,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=sg(a.toString())}return n.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,r,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,r=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(r)||(this.nextVal=this.convertValue(r)),this.convertValue(t)},n.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},n.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},n})(),D8=(function(){function n(e,t,r,i){this.alpha=e,this.beta=1/t,this.dtype=r;var o=i||Math.random();this.randu=sg(o.toString()),this.randn=new $w(0,1,r,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return n.prototype.nextValue=function(){for(var e,t,r,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,t=1-.331*(e=i*i)*e,r=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<r)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},n.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},n})(),N8=(function(){function n(e,t,r,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=r,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=sg(i)}return n.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},n.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},n})(),P8=oe({randomGamma_:function(n,e,t,r,i){if(t===void 0&&(t=1),r===void 0&&(r="float32"),t==null&&(t=1),r==null&&(r="float32"),r!=="float32"&&r!=="int32")throw new Error("Unsupported data type "+r);for(var o=new D8(e,t,r,i),a=Xt(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),F8=oe({randomNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type "+r);for(var o=new $w(e,t,r,!1,i),a=Xt(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),eM=oe({randomUniform_:function(n,e,t,r,i){e===void 0&&(e=0),t===void 0&&(t=1),r===void 0&&(r="float32");for(var o=Xt(n,r),a=new N8(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),tM=oe({square_:function(n){var e=X(n,"x","square"),t=[e];return le.runKernelFunc((function(r,i){return i([e]),r.square(e)}),{x:e},null,"Square",{},t,[])}}),nM=oe({squaredDifference_:function(n,e){var t,r=X(n,"a","squaredDifference"),i=X(e,"b","squaredDifference");t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape);var o={a:r,b:i},a=[r,i];return le.runKernelFunc((function(s,u){var l=s.squaredDifference(r,i);return u([r,i]),l}),o,(function(s,u){var l=u[0],c=u[1],h=Ct(2);return{a:function(){return s.mul(l.sub(c).mul(h))},b:function(){return s.mul(c.sub(l).mul(h))}}}),ig,{},a,[])}}),O8=oe({truncatedNormal_:function(n,e,t,r,i){if(e===void 0&&(e=0),t===void 0&&(t=1),r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");for(var o=new $w(e,t,r,!0,i),a=Xt(n,r),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),rM=oe({equal_:function(n,e){var t,r=X(n,"a","equal"),i=X(e,"b","equal");return t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape),le.runKernelFunc((function(o){return o.equal(r,i)}),{$a:r,$b:i})}}),L8=oe({equalStrict_:function(n,e){var t=X(n,"a","equalStrict"),r=X(e,"b","equalStrict");return En(t.shape,r.shape,"Error in equalStrict: "),t.equal(r)}}),B8=oe({greater_:function(n,e){var t,r=X(n,"a","greater"),i=X(e,"b","greater");return t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape),le.runKernelFunc((function(o){return o.greater(r,i)}),{a:r,b:i},null,"Greater")}}),iM=oe({greaterEqual_:function(n,e){var t,r=X(n,"a","greaterEqual"),i=X(e,"b","greaterEqual");return t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.greaterEqual(r,i);return a([r,i]),s}),{a:r,b:i},(function(o,a){var s=a[0],u=a[1];return{a:function(){return hn(s)},b:function(){return hn(u)}}}),"GreaterEqual")}}),U8=oe({greaterEqualStrict_:function(n,e){var t=X(n,"a","greaterEqualStrict"),r=X(e,"b","greaterEqualStrict");return En(t.shape,r.shape,"Error in greaterEqualStrict: "),t.greaterEqual(r)}}),z8=oe({greaterStrict_:function(n,e){var t=X(n,"a","greaterStrict"),r=X(e,"b","greaterStrict");return En(t.shape,r.shape,"Error in greaterStrict: "),t.greater(r)}}),W8=oe({less_:function(n,e){var t,r=X(n,"a","less"),i=X(e,"b","less");return t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape),le.runKernelFunc((function(o){return o.less(r,i)}),{a:r,b:i},null,"Less")}}),H8=oe({lessEqual_:function(n,e){var t,r=X(n,"a","lessEqual"),i=X(e,"b","lessEqual");return t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.lessEqual(r,i);return a([r,i]),s}),{a:r,b:i},null,"LessEqual")}}),G8=oe({lessEqualStrict_:function(n,e){var t=X(n,"a","lessEqualStrict"),r=X(e,"b","lessEqualStrict");return En(t.shape,r.shape,"Error in lessEqualStrict: "),t.lessEqual(r)}}),V8=oe({lessStrict_:function(n,e){var t=X(n,"a","lessStrict"),r=X(e,"b","lessStrict");return En(t.shape,r.shape,"Error in lessStrict: "),t.less(r)}}),j8=oe({notEqual_:function(n,e){var t,r=X(n,"a","notEqual"),i=X(e,"b","notEqual");return t=Gn(r,i),r=t[0],i=t[1],on(r.shape,i.shape),le.runKernelFunc((function(o){return o.notEqual(r,i)}),{a:r,b:i},null,"NotEqual")}}),q8=oe({notEqualStrict_:function(n,e){var t=X(n,"a","notEqualStrict"),r=X(e,"b","notEqualStrict");return En(t.shape,r.shape,"Error in notEqualStrict: "),t.notEqual(r)}});function sE(n,e){for(var t=[],r=n;r<e;++r)t.push(r);return t}function uE(n){for(var e=[],t=0;t<n.length;++t)for(var r=0;r<n[t].length;++r)e.push(n[t][r]);return e}var Xw=oe({gather_:function(n,e,t){t===void 0&&(t=0);var r=X(n,"x","gather"),i=X(e,"indices","gather","int32");t=dr(t,r.shape)[0];var o=(function(a,s,u){for(var l=a.shape[u],c=[],h=1,f=1,m=0;m<u;m++)c.push(a.shape[m]),h*=a.shape[m];for(m=0;m<s.rank;m++)c.push(s.shape[m]);for(m=u+1;m<a.rank;m++)c.push(a.shape[m]),f*=a.shape[m];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}})(r,i,t);return le.runKernelFunc((function(a,s){var u=a.gather(r,i.flatten(),t);return s([i]),u}),{x:r,indices:i},(function(a,s){var u=s[0];return{x:function(){var l=r.shape,c=u.size,h=l.slice(0,t),f=h.length,m=l.slice(t,l.length).slice(1),g=m.length,w=sE(0,f),v=sE(f+1,f+1+g),y=uE([h,[c],m]),x=a.reshape(y),E=u.reshape([c]),_=uE([[f],w,v]),k=x.transpose(_),C=oM(k,E,r.shape[t]),A=Fw(_);return C=C.transpose(A)},indices:function(){return u}}}),"Gather",{axis:t}).reshape(o.outputShape)}}),oM=oe({unsortedSegmentSum_:function(n,e,t){var r=X(n,"x","unsortedSegmentSum"),i=X(e,"segmentIds","unsortedSegmentSum","int32");return K(Jn(t),(function(){return"numSegments must be of dtype int"})),le.runKernelFunc((function(o,a){var s=o.unsortedSegmentSum(r,i,t);return a([i]),s}),{$x:r},(function(o,a){var s=a[0];return{$x:function(){return(function(u,l){for(var c=Bw(l,hn(l)),h=Xw(u,c),f=iM(l,Ct(0,"int32")),m=h.rank-f.rank,g=0;g<m;++g)f=Bs(f,g+1);f=lg(f,Kc(h.shape,"bool"));var w=hn(h);return tl(f,h,w)})(o,s)}}}))}}),$8=function(n,e,t){return wt(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c,h,f,m,g,w;return _t(this,(function(v){switch(v.label){case 0:for(r=X(n,"tensor","boolMask"),i=X(e,"mask","boolMask","bool"),o=t??0,a=i.rank,s=r.shape,K(a>0,(function(){return"mask cannot be scalar"})),En(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+a;l++)u*=s[l];return c=s.slice(0,o).concat([u],s.slice(o+a)),h=r.reshape(c),f=i.reshape([-1]),[4,J3(f)];case 1:return m=v.sent(),g=m.squeeze([1]),w=Xw(h,g,o),n!==r&&r.dispose(),e!==i&&i.dispose(),g.dispose(),h.dispose(),f.dispose(),m.dispose(),[2,w]}}))}))};function aM(n,e,t,r,i,o,a){o===void 0&&(o="NHWC"),K(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var s=n,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,n[0],n[1],n[2]]),K(s.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),K(u.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),K(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var c=o==="NHWC"?s[3]:s[1],h=o==="NHWC"?u.shape[3]:u.shape[1];K(c===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."})),K(h===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."})),a!=null&&K(Jn(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var f=zw(o),m=sl(s,t.shape,r,1,i,a,!1,f),g=le.runKernelFunc((function(w,v){var y=w.conv2dDerInput(u,t,m);return v([t,u]),y}),{dy4D:u,filter:t},(function(w,v){var y=v[0],x=v[1];return{dy4D:function(){return ll(w,y,r,i,o,1,a)},filter:function(){return Yw(w,x,y.shape,r,i,o,a)}}}));return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function Yy(n){var e=(function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o})(n),t=e[0],r=e[1],i=e[2];return t===1&&r===1&&i===1}function sM(n,e,t,r,i){K(n.length===e.rank,(function(){return"Length of inShape ("+n.length+") and rank of dy ("+e.rank+") must match"}));var o=n,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,n[0],n[1],n[2],n[3]]);var u=o[4],l=a.shape[4];K(o.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."})),K(a.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),K(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),K(u===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."})),K(l===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."}));var c=Dm(o,t.shape,r,1,i),h=le.runKernelFunc((function(f){return f.conv3dDerInput(a,t,c)}),{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var X8=oe({conv1d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=X(n,"x","conv1d"),u=X(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),K(l.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."})),K(u.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),a!=null&&K(Jn(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."})),K(l.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),K(ni(t,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"})),K(i==="NWC",(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),m=ll(f,h,[1,t],r,"NHWC",[1,o],a);return c?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),ll=oe({conv2d_:function(n,e,t,r,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=X(n,"x","conv2d"),u=X(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),K(l.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."})),K(u.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),a!=null&&K(Jn(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var h=i==="NHWC"?l.shape[3]:l.shape[1];K(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),K(ni(t,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}));var f=zw(i),m=sl(l.shape,u.shape,t,o,r,a,!1,f),g=[u,l],w=le.runKernelFunc((function(v,y){var x=v.conv2d(l,u,m);return y([u,l]),x}),{x:l,filter:u},(function(v,y){var x=y,E=x[0],_=x[1];return K(Uc(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return uM(_.shape,v,E,t,r,i)},filter:function(){return Yw(_,v,E.shape,t,r,i)}}}),"Conv2D",m,g);return c?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),Y8=oe({conv3d_:function(n,e,t,r,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=X(n,"x","conv3d"),s=X(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),K(u.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),K(s.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),K(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),K((function(f,m){return Yy(f)||Yy(m)})(t,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),K(i==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var c=Dm(u.shape,s.shape,t,o,r),h=le.runKernelFunc((function(f,m){var g=f.conv3d(u,s,c);return m([u,s]),g}),{x:u,$filter:s},(function(f,m){K(Yy(o),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}));var g=m[0],w=m[1];return{x:function(){return sM(g.shape,f,w,t,r)},$filter:function(){return(function(v,y,x,E,_){var k=v;v.rank===4&&(k=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var C=y;C.rank===4&&(C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),K(k.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."})),K(C.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."})),K(x.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."})),K(k.shape[4]===x[3],(function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+x[3]+"."})),K(C.shape[4]===x[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+x[4]+")."}));var A=Dm(k.shape,x,E,1,_);return le.runKernelFunc((function(I){return I.conv3dDerFilter(k,C,A)}),{x5D:k,dy5D:C})})(g,f,w.shape,t,r)}}}));return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Yw=oe({conv2dDerFilter_:function(n,e,t,r,i,o,a){o===void 0&&(o="NHWC");var s=n;n.rank===3&&(s=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),K(s.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),K(u.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),K(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var l=o==="NHWC"?s.shape[3]:s.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];K(l===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."})),K(c===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."})),a!=null&&K(Jn(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=zw(o),f=sl(s.shape,t,r,1,i,a,!1,h);return le.runKernelFunc((function(m){return m.conv2dDerFilter(s,u,f)}),{x4D:s,dy4D:u})}}),uM=oe({conv2dDerInput_:aM}),Kw=oe({depthwiseConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]);var s=X(n,"x","depthwiseConv2d"),u=X(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),K(l.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."})),K(u.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),K(l.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),o==null&&(o=[1,1]),K(ni(t,o),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),a!=null&&K(Jn(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+r+"."}));var h=sl(l.shape,u.shape,t,o,r,a,!0),f=[l,u],m=le.runKernelFunc((function(g,w){var v=g.depthwiseConv2D(l,u,h);return w([l,u]),v}),{x:l,filter:u},(function(g,w){K(Uc(o),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"}));var v=w[0],y=w[1];return{x:function(){return lM(v.shape,g,y,h)},filter:function(){return cM(v,g,y.shape,h)}}}),"DepthwiseConv2dNative",h,f);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),lM=oe({depthwiseConv2dDerInput_:function(n,e,t,r){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=le.runKernelFunc((function(s){return s.depthwiseConv2DDerInput(i,t,r)}),{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),cM=oe({depthwiseConv2dDerFilter_:function(n,e,t,r){var i=n;n.rank===3&&(i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),le.runKernelFunc((function(a){return a.depthwiseConv2DDerFilter(i,o,r)}),{x4D:i,dy4D:o})}}),hM=oe({separableConv2d_:function(n,e,t,r,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=X(n,"x","separableConv2d"),u=X(e,"depthwiseFilter","separableConv2d"),l=X(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");K(c.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."})),K(u.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),K(l.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),K(l.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."})),K(l.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."}));var f=u.shape[2],m=u.shape[3];K(l.shape[2]===f*m,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*m+", but got "+l.shape[2]+"."}));var g=Kw(c,u,r,i,a,o),w=ll(g,l,1,"valid",a);return h?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),K8=oe({conv2dTranspose_:function(n,e,t,r,i,o){return aM(t,X(n,"x","conv2dTranspose"),X(e,"filter","conv2dTranspose"),r,i,"NHWC",o)}}),J8=oe({conv3dTranspose_:function(n,e,t,r,i){return sM(t,X(n,"x","conv3dTranspose"),X(e,"filter","conv3dTranspose"),r,i)}}),dM=oe({matMul_:function(n,e,t,r){var i;t===void 0&&(t=!1),r===void 0&&(r=!1);var o=X(n,"a","matMul"),a=X(e,"b","matMul");i=Gn(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=r?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=r?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),f=a.shape.slice(0,-2),m=bt(h),g=bt(f);K(o.rank>=2&&a.rank>=2&&o.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."})),K(wr(h,f),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."})),K(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+r+" must match."}));var w=o.shape.slice(0,-2).concat([l,c]),v=t?o.as3D(m,s,l):o.as3D(m,l,s),y=r?a.as3D(g,c,u):a.as3D(g,u,c),x={transposeA:t,transposeB:r};return le.runKernelFunc((function(E,_){var k=E.batchMatMul(v,y,t,r);return _([v,y]),k}),{a:v,b:y},(function(E,_){var k=_,C=k[0],A=k[1];return t||r?!t&&r?{a:function(){return E.matMul(A,!1,!1)},b:function(){return E.matMul(C,!0,!1)}}:t&&!r?{a:function(){return A.matMul(E,!1,!0)},b:function(){return C.matMul(E,!1,!1)}}:{a:function(){return A.matMul(E,!0,!0)},b:function(){return E.matMul(C,!0,!0)}}:{a:function(){return E.matMul(A,!1,!0)},b:function(){return C.matMul(E,!0,!1)}}}),"BatchMatMul",x).reshape(w)}}),Q8=oe({dot_:function(n,e){var t=X(n,"t1","dot"),r=X(e,"t2","dot");K(!(t.rank!==1&&t.rank!==2||r.rank!==1&&r.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+r.rank+"."}));var i=t.rank===1?t.size:t.shape[1],o=r.rank===1?r.size:r.shape[0];return K(i===o,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."})),t.rank===1&&r.rank===1?t.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():t.rank===1&&r.rank===2?t.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():t.rank===2&&r.rank===1?t.matMul(r.as2D(-1,1)).as1D():t.matMul(r.as2D(r.shape[0],r.shape[1]))}}),Z8=oe({outerProduct_:function(n,e){var t=X(n,"v1","outerProduct"),r=X(e,"v2","outerProduct");return K(t.rank===1&&r.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+r.rank+"."})),t.as2D(-1,1).matMul(r.as2D(1,-1))}}),Rd=oe({reverse_:function(n,e){var t=X(n,"x","reverse");if(t.rank===0)return t.clone();var r=dr(e,t.shape);return le.runKernelFunc((function(i){return i.reverse(t,r)}),{$x:t},(function(i){return{$x:function(){return i.reverse(r)}}})).reshapeAs(t)}}),e7=oe({reverse1d_:function(n){var e=X(n,"x","reverse");return K(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),Rd(e,0)}}),t7=oe({reverse2d_:function(n,e){var t=X(n,"x","reverse");return K(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),Rd(t,e)}}),n7=oe({reverse3d_:function(n,e){var t=X(n,"x","reverse");return K(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),Rd(t,e)}}),r7=oe({reverse4d_:function(n,e){var t=X(n,"x","reverse");return K(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),Rd(t,e)}});function fM(n,e,t,r,i,o){var a=X(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),K(s.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),K(ni(t,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"})),o!=null&&K(Jn(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var l=el(s.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&wr(l.inShape,l.outShape))return a.clone();var c=[s],h=le.runKernelFunc((function(f,m){var g=f.maxPool(s,l);return m([s,g]),g}),{x:s},(function(f,m){var g=m[0],w=m[1];return{x:function(){return(function(v,y,x,E,_,k,C,A){var I=X(v,"dy","maxPoolBackprop"),T=X(y,"input","maxPoolBackprop"),R=X(x,"output","maxPoolBackprop");K(T.rank===I.rank,(function(){return"Rank of input ("+T.rank+") does not match rank of dy ("+I.rank+")"})),K(ni(_,k),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+k+"'"})),K(I.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."})),K(T.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+T.rank+"."}));var N=el(T.shape,E,_,k,C,A);return le.runKernelFunc((function(O){return O.maxPoolBackprop(I,T,R,N)}),{$dy:I,$input:T})})(f,g,w,e,t,r,i)}}}),"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function pM(n,e,t,r,i,o){var a=X(n,"x","avgPool","float32");K(ni(t,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+r+"'"}));var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),K(s.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),o!=null&&K(Jn(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var l=el(s.shape,e,t,r,i,o);if(l.filterWidth===1&&l.filterHeight===1&&wr(l.inShape,l.outShape))return a.clone();var c=le.runKernelFunc((function(h){return h.avgPool(s,l)}),{x:s},(function(h){return{x:function(){return(function(f,m,g,w,v,y){var x=X(f,"dy","avgPoolBackprop"),E=X(m,"input","avgPoolBackprop");K(E.rank===x.rank,(function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+x.rank+")"})),K(ni(w,v),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+v+"'"}));var _=E,k=x,C=!1;E.rank===3&&(C=!0,_=E.as4D(1,E.shape[0],E.shape[1],E.shape[2]),k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),K(k.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."})),K(_.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."}));var A=el(_.shape,g,w,v,y),I=le.runKernelFunc((function(T){return T.avgPoolBackprop(k,_,A)}),{dy4D:k,input4D:_});return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I})(h,s,e,t,r,i)}}}),"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Ri=oe({maxPool_:function(n,e,t,r,i){return fM(n,e,t,1,r,i)}}),i7=oe({avgPool_:function(n,e,t,r,i){return pM(n,e,t,1,r,i)}}),o7=oe({pool_:function(n,e,t,r,i,o){i==null&&(i=[1,1]),o==null&&(o=1),r===0&&(r="valid");var a=X(n,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),K(ni(o,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}));var l,c=el(s.shape,e,o,i,r),h=[c.dilationHeight,c.dilationWidth];l=r==="same"?(function(_,k){var C=_.map((function(T,R){return T+(T-1)*(k[R]-1)})).map((function(T){return T-1})),A=C.map((function(T){return Math.floor(T/2)})),I=C.map((function(T,R){return T-A[R]}));return C.map((function(T,R){return[A[R],I[R]]}))})([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,m=(function(_,k,C){var A=C.map((function(F){return F[0]})),I=C.map((function(F){return F[1]})),T=_.concat(A,I),R=k.map((function(F,B){return(F-T[B]%F)%F})),N=I.map((function(F,B){return F+R[B]})),O=k.map((function(F,B){return[A[B],N[B]]})),V=k.map((function(F,B){return[0,R[B]]}));return[O,V]})([c.inHeight,c.inWidth],h,l),g=m[0],w=m[1],v=f?r:"valid",y=f?s:s3(s,h,g),x=(t==="avg"?function(){return pM(y,e,o,1,v)}:function(){return fM(y,e,o,1,v)})(),E=f?x:a3(x,h,w);return u?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),a7=oe({maxPool3d_:function(n,e,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=X(n,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),K(u.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),K(o==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),K(ni(t,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),i!=null&&K(Jn(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var c=Im(u.shape,e,t,a,r,i,o),h=le.runKernelFunc((function(f,m){var g=f.maxPool3d(u,c);return m([u,g]),g}),{x:u},(function(f,m){var g=m[0],w=m[1];return{x:function(){return(function(v,y,x,E,_,k,C,A){var I=X(v,"dy","maxPool3dBackprop"),T=X(y,"input","maxPool3dBackprop"),R=X(x,"output","maxPool3dBackprop"),N=I,O=T,V=R,F=!1;T.rank===4&&(F=!0,N=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),O=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),V=R.as5D(1,R.shape[0],R.shape[1],R.shape[2],R.shape[3])),K(N.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."})),K(O.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."})),K(V.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+V.rank+"."})),k==null&&(k=[1,1,1]),K(ni(_,k),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+k+"'"})),A!=null&&K(Jn(C),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+A+" but got pad "+C+"."}));var B=Im(O.shape,E,_,k,C,A),U=le.runKernelFunc((function(P){return P.maxPool3dBackprop(N,O,V,B)}),{dy5D:N,input5D:O});return F?U.as4D(U.shape[1],U.shape[2],U.shape[3],U.shape[4]):U})(f,g,w,e,t,a,r,i)}}}));return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),s7=oe({avgPool3d_:function(n,e,t,r,i,o,a){o===void 0&&(o="NDHWC");var s=X(n,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),K(u.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),K(o==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),K(ni(t,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),i!=null&&K(Jn(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var c=Im(u.shape,e,t,a,r,i,o),h=le.runKernelFunc((function(f){return f.avgPool3d(u,c)}),{x:u},(function(f){return{x:function(){return(function(m,g,w,v,y,x,E){var _=X(m,"dy","avgPool3dBackprop"),k=X(g,"input","avgPool3dBackprop"),C=_,A=k,I=!1;k.rank===4&&(I=!0,C=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),A=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),K(C.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."})),K(A.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+A.rank+"."})),y==null&&(y=[1,1,1]),K(ni(v,y),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+y+"'"})),E!=null&&K(Jn(x),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+x+"."}));var T=Im(A.shape,w,v,y,x,E),R=le.runKernelFunc((function(N){return N.avgPool3dBackprop(C,A,T)}),{dy5D:C,input5D:A});return I?R.as4D(R.shape[1],R.shape[2],R.shape[3],R.shape[4]):R})(f,u,e,t,a,r,i)}}}));return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),u7=oe({maxPoolWithArgmax_:function(n,e,t,r,i){i===void 0&&(i=!1);var o=X(n,"x","maxPoolWithArgmax"),a={filterSize:e,strides:t,pad:r,includeBatchInIndex:i},s=le.runKernel("MaxPoolWithArgmax",{x:o},a);return{result:s[0],indexes:s[1]}}}),Qs=oe({slice_:function(n,e,t){var r,i,o=X(n,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(r=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach((function(u){K(u!==-1,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map((function(u,l){return u>=0?u:(K(u===-1,(function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."})),o.shape[l]-r[l])})),i6(o,r,i);var a=o.shape,s={begin:r,size:i};return le.runKernelFunc((function(u){return u.slice(o,r,i)}),{x:o},(function(u){for(var l=[],c=0;c<u.rank;c++)l.push([r[c],a[c]-r[c]-i[c]]);return{x:function(){return Za(u,l)}}}),"Slice",s)}}),l7=oe({slice1d_:function(n,e,t){var r=X(n,"x","slice1d");return K(r.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Qs(r,[e],[t])}}),c7=oe({slice2d_:function(n,e,t){var r=X(n,"x","slice2d");return K(r.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Qs(r,e,t)}}),h7=oe({slice3d_:function(n,e,t){var r=X(n,"x","slice3d");return K(r.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Qs(r,e,t)}}),d7=oe({slice4d_:function(n,e,t){var r=X(n,"x","slice4d");return K(r.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Qs(r,e,t)}});function mM(n,e,t,r,i){return e.rank<t.rank&&(e=e.reshape(xi(e.shape,r))),n.rank<t.rank&&(n=n.reshape(xi(n.shape,r))),{x:function(){var o=n.mul(t.equal(e).cast(n.dtype));return i==null?o:o.transpose(i)}}}var f7=oe({all_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","all","bool"),i=dr(e,r.shape),o=i,a=ya(o,r.rank);a!=null&&(r=r.transpose(a),o=ba(o.length,r.rank));var s=le.runKernelFunc((function(l){return l.all(r,o)}),{$x:r});if(t){var u=xi(s.shape,i);return s.reshape(u)}return s}}),p7=oe({any_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","any","bool"),i=dr(e,r.shape),o=i,a=ya(o,r.rank);a!=null&&(r=r.transpose(a),o=ba(o.length,r.rank));var s=le.runKernelFunc((function(l){return l.any(r,o)}),{$x:r});if(t){var u=xi(s.shape,i);return s.reshape(u)}return s}}),m7=oe({argMax_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","argMax");e==null&&(e=0);var r=dr(e,t.shape),i=ya(r,t.rank);i!=null&&(t=t.transpose(i),r=ba(r.length,t.rank));var o={axis:r[0]},a=[t];return le.runKernelFunc((function(s,u){var l=s.argMax(t,r[0]);return u([t]),l}),{x:t},(function(s,u){var l=u[0];return{x:function(){return hn(l)}}}),"ArgMax",o,a)}}),g7=oe({argMin_:function(n,e){e===void 0&&(e=0);var t=X(n,"x","argMin");e==null&&(e=0);var r=dr(e,t.shape),i=ya(r,t.rank);return i!=null&&(t=t.transpose(i),r=ba(r.length,t.rank)),le.runKernelFunc((function(o,a){var s=o.argMin(t,r[0]);return a([t]),s}),{$x:t},(function(o,a){var s=a[0];return{$x:function(){return hn(s)}}}))}}),v7=oe({logSumExp_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","logSumExp"),i=dr(e,r.shape),o=r.max(i,!0),a=r.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=xi(s.shape,i);return s.reshape(u)}return s}}),y7=oe({max_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","max"),i=r,o=dr(e,r.shape),a=o,s=ya(a,r.rank);s!=null&&(r=r.transpose(s),a=ba(a.length,r.rank));var u=[r],l=le.runKernelFunc((function(h,f){var m=h.max(r,a);return f([i,m]),m}),{x:r},(function(h,f){return mM(h,f[1],f[0],o,s)}),"Max",{axes:a},u,[!0]);if(t){var c=xi(l.shape,o);l=l.reshape(c)}return l}}),b7=oe({mean_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","mean"),i=dr(e,r.shape),o=bt(Br(r.shape,i)[1]);return og((function(a){var s=Ct(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach((function(c){l[c]=1})),u.reshape(l).mul(Kc(a.shape,"float32")).div(o)}}}))(r)}}),w7=oe({min_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","min"),i=r,o=dr(e,r.shape),a=o,s=ya(a,r.rank);s!=null&&(r=r.transpose(s),a=ba(a.length,r.rank));var u=[r],l=le.runKernelFunc((function(h,f){var m=h.min(r,a);return f([i,m]),m}),{x:r},(function(h,f){return mM(h,f[1],f[0],o,s)}),"Min",{axes:a},u,[!0]);if(t){var c=xi(l.shape,o);l=l.reshape(c)}return l}}),_7=oe({moments_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=dr(e,(n=X(n,"x","moments")).shape),i=n.mean(r,t),o=i.shape;t||(o=xi(i.shape,r));var a=n.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(r,t)}}}),Us=oe({sum_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","sum");r.dtype==="bool"&&(r=r.toInt());var i=dr(e,r.shape);return og((function(o){var a=ya(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=ba(s.length,o.rank));var l=function(m){var g=o.shape.slice();return i.forEach((function(w){g[w]=1})),m.reshape(g).mul(Kc(o.shape,"float32"))},c={axes:s},h=le.runKernelFunc((function(m){return m.sum(u,s)}),{x:u},(function(m){return{x:function(){return l(m)}}}),"Sum",c);if(t){var f=xi(h.shape,i);h=h.reshape(f)}return{value:h,gradFunc:l}}))(r)}}),x7=oe({prod_:function(n,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var r=X(n,"x","prod");r.dtype==="bool"&&(r=r.toInt());var i=dr(e,r.shape),o=ya(i,r.rank),a=i,s=r;o!=null&&(s=r.transpose(o),a=ba(a.length,r.rank));var u=le.runKernelFunc((function(c){return c.prod(s,a)}),{permutedX:s});if(t){var l=xi(u.shape,i);u=u.reshape(l)}return u}}),gM=oe({elu_:function(n){var e=X(n,"x","elu");return le.runKernelFunc((function(t,r){var i=t.elu(e);return r([i]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){return le.runKernelFunc((function(o){return o.eluDer(t,i)}),{dy:t,y:i})}}}))}}),S7=oe({leakyRelu_:function(n,e){e===void 0&&(e=.2);var t=X(n,"x","leakyRelu");return Bw(Ct(e).mul(t),t)}}),vM=oe({prelu_:function(n,e){var t=X(n,"x","prelu"),r=X(e,"alpha","prelu");return le.runKernelFunc((function(i,o){var a=i.prelu(t,r);return o([t,r]),a}),{x:t,alpha:r},(function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return tl(u,i,i.mul(s))},alpha:function(){var l=tl(u,hn(i),i.mul(a)),c=ar(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}}),"Prelu")}}),cg=oe({relu_:function(n){var e=X(n,"x","relu");return e.dtype==="bool"?e.toInt():le.runKernelFunc((function(t,r){var i=t.relu(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}}),"Relu")}}),yM=oe({relu6_:function(n){var e=X(n,"x","relu6");return e.dtype==="bool"?e.toInt():le.runKernelFunc((function(t,r){var i=t.relu6(e);return r([e]),i}),{x:e},(function(t,r){var i=r[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}}),"Relu6")}}),E7=oe({selu_:function(n){var e=X(n,"x","selu");return le.runKernelFunc((function(t,r){var i=t.selu(e);return r([e]),i}),{$x:e},(function(t,r){var i=r[0];return{$x:function(){var o=i.greater(Ct(0)),a=Ct(jw),s=Ct(qw),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return tl(o,u,l)}}}))}}),k7=oe({localResponseNormalization_:function(n,e,t,r,i){e===void 0&&(e=5),t===void 0&&(t=1),r===void 0&&(r=1),i===void 0&&(i=.5);var o=X(n,"x","localResponseNormalization");K(o.rank===4||o.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."})),K(Jn(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=le.runKernelFunc((function(l,c){var h=l.localResponseNormalization4D(a,e,t,r,i);return c([a,h]),h}),{x4D:a},(function(l,c){var h=c[0],f=c[1];return{x4D:function(){return le.runKernelFunc((function(m){return m.LRNGrad(l,h,f,e,t,r,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),bM=oe({norm_:function(n,e,t,r){e===void 0&&(e="euclidean"),t===void 0&&(t=null),r===void 0&&(r=!1);var i=(function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(Ct(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)})(n=X(n,"x","norm"),e,t),o=i.shape;if(r){var a=dr(t,n.shape);o=xi(i.shape,a)}return i.reshape(o)}}),C7=oe({basicLSTMCell_:function(n,e,t,r,i,o){var a=X(n,"forgetBias","basicLSTMCell"),s=X(e,"lstmKernel","basicLSTMCell"),u=X(t,"lstmBias","basicLSTMCell"),l=X(r,"data","basicLSTMCell"),c=X(i,"c","basicLSTMCell"),h=X(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(s).add(u),m=f.shape[0],g=f.shape[1]/4,w=[m,g],v=f.slice([0,0],w),y=f.slice([0,g],w),x=f.slice([0,2*g],w),E=f.slice([0,3*g],w),_=v.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid())),k=_.tanh().mulStrict(E.sigmoid());return[_,k]}}),T7=oe({multiRNNCell_:function(n,e,t,r){for(var i=X(e,"data","multiRNNCell"),o=Em(t,"c","multiRNNCell"),a=Em(r,"h","multiRNNCell"),s=i,u=[],l=0;l<n.length;l++){var c=n[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),M7=oe({movingAverage_:function(n,e,t,r,i){i===void 0&&(i=!0);var o=X(n,"v","movingAverage"),a=X(e,"x","movingAverage"),s=X(t,"decay","movingAverage");_L(o,a),K(wr(o.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var u=Ct(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){K(r!=null,(function(){return"When using zeroDebias: true, step is required."}));var h=X(r,"step","movingAverage");c=c.div(u.sub(Rm(s,h)))}return o.add(c)}}),R7=oe({stridedSlice_:function(n,e,t,r,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),r==null&&(r=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=X(n,"x","stridedSlice"),c=WS(s),h=l.shape.slice();c.forEach((function(v){e[v]=0,t[v]=1,h.splice(v,0,1)})),l=l.reshape(h);for(var f=0;f<l.rank;f++)e[f]=o6(i,e,r,l.shape,f),t[f]=a6(o,t,r,l.shape,f),r[f]=r[f]||1;var m=WS(u);m.forEach((function(v){t[v]=e[v]+1,r[v]=1}));var g=Uw(e,t,r),w=g.filter((function(v,y){return m.indexOf(y)===-1}));return r.every((function(v){return v===1}))?Qs(l,e,g).reshape(w):le.runKernelFunc((function(v){return v.stridedSlice(l,e,t,r)}),{$x:l}).reshape(w)}}),A7=oe({topk_:function(n,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var r=X(n,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=r.shape[r.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=le.runKernelFunc((function(a){return a.topk(r,e,t)}),{$x:r});return{values:o[0],indices:o[1]}}}),I7=oe({scatterND_:function(n,e,t){var r=X(n,"indices","scatterND","int32"),i=X(e,"updates","scatterND");return r6(i,r,t),le.runKernelFunc((function(o){return o.scatterND(r,i,t)}),{indices:r,updates:i},null,"ScatterNd",{shape:t})}}),Jw=oe({fft_:function(n){K(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return le.runKernelFunc((function(i){return i.fft(r)}),{input:n}).reshape(n.shape)}}),Fm=oe({ifft_:function(n){K(n.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+n.dtype+"."}));var e=n.shape[n.shape.length-1],t=n.size/e,r=n.as2D(t,e);return le.runKernelFunc((function(i){return i.ifft(r)}),{input:n}).reshape(n.shape)}}),Qw=oe({rfft_:function(n,e){K(n.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+n.dtype}));var t,r=n.shape[n.shape.length-1],i=n.size/r;if(e!=null&&e<r){var o=n.shape.map((function(y){return 0})),a=n.shape.map((function(y){return y}));a[n.shape.length-1]=e,t=n.slice(o,a),r=e}else if(e!=null&&e>r){var s=n.shape.map((function(y){return y}));s[n.shape.length-1]=e-r,t=n.concat(Xn(s),n.shape.length-1),r=e}else t=n;var u=t.zerosLike(),l=Er(t,u).as2D(i,r),c=Jw(l),h=Math.floor(r/2)+1,f=to(c),m=ia(c),g=f.split([h,r-h],f.shape.length-1),w=m.split([h,r-h],m.shape.length-1),v=t.shape.slice();return v[t.shape.length-1]=h,Er(g[0],w[0]).reshape(v)}}),wM=oe({irfft_:function(n){var e=n.shape[n.shape.length-1],t=n.size/e;if(e<=2){var r=n.as2D(t,e),i=Fm(r);return to(i)}var o=[t,2*(e-1)],a=to(n).as2D(t,e),s=ia(n).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(Ct(-1)),c=a.concat(u,1),h=s.concat(l,1);return r=Er(c,h).as2D(o[0],o[1]),i=Fm(r),to(i)}}),D7=Object.freeze({fft:Jw,ifft:Fm,rfft:Qw,irfft:wM}),N7=oe({sparseToDense_:function(n,e,t,r){r===void 0&&(r=0);var i=X(n,"sparseIndices","sparseToDense","int32"),o=X(e,"sparseValues","sparseToDense"),a=X(r,"defaultValue","sparseToDense",o.dtype);return(function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var m=u.size;if(u.rank!==0&&(u.rank!==1||m!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,o,t,a),le.runKernelFunc((function(s){return s.sparseToDense(i,o,t,a)}),{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),P7=oe({gatherND_:function(n,e){var t=X(e,"indices","gatherND","int32"),r=X(n,"x","gatherND");return le.runKernelFunc((function(i){return i.gatherND(r,t)}),{x:r,indices:t},null,"GatherNd")}}),F7=oe({diag_:function(n){var e=X(n,"x","diag").flatten(),t=n.shape.concat(n.shape);return le.runKernelFunc((function(r){return r.diag(e)}),{$x:e}).reshape(t)}}),O7=oe({dropout_:function(n,e,t,r){var i=X(n,"x","dropout");if(K(i.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),K(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return n instanceof Nn?i.clone():i;var o=(function(u,l){if(l==null)return u.shape.slice();if(wr(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l})(i,t),a=1-e,s=eM(o,0,1,"float32",r).add(a).floor().div(a);return i.mul(s)}});function _M(n,e,t){for(var r=1-n%2,i=new Float32Array(n),o=0;o<n;++o){var a=2*Math.PI*o/(n+r-1);i[o]=e-t*Math.cos(a)}return Bo(i,"float32")}var Zw=oe({hannWindow_:function(n){return _M(n,.5,.5)}}),xM=oe({hammingWindow_:function(n){return _M(n,.54,.46)}}),e_=oe({frame_:function(n,e,t,r,i){r===void 0&&(r=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=n.size;)a.push(Qs(n,o,e)),o+=t;if(r)for(;o<n.size;){var s=o+e-n.size,u=so([Qs(n,o,e-s),Ku([s],i)]);a.push(u),o+=t}return a.length===0?Yu([],[0,e]):so(a).as2D(a.length,e)}}),SM=oe({stft_:function(n,e,t,r,i){var o;i===void 0&&(i=Zw),r==null&&(o=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=e_(n,e,t),s=$n(a,i(e)),u=[],l=0;l<a.shape[0];l++)u.push(Qw(s.slice([l,0],[1,e]),r));return so(u)}}),L7=Object.freeze({hannWindow:Zw,hammingWindow:xM,frame:e_,stft:SM}),Hr,B7=function(n,e,t){return t===void 0&&(t=1),wt(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c,h,f,m,g,w,v;return _t(this,(function(y){switch(y.label){case 0:return r=X(n,"predictions","inTopK"),i=X(e,"targets","inTopK"),K(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),K(r.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+i.rank})),En(r.shape.slice(0,r.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=r.shape[r.shape.length-1],K(t>0&&t<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t})),[4,r.data()];case 1:return a=y.sent(),[4,i.data()];case 2:for(s=y.sent(),u=[a.length/o,o],c=u[1],h=Oc("bool",l=u[0]),f=0;f<l;f++){for(m=f*c,g=a.subarray(m,m+c),w=[],v=0;v<g.length;v++)w.push({value:g[v],index:v});for(w.sort((function(x,E){return E.value-x.value})),h[f]=0,v=0;v<t;v++)if(w[v].index===s[f]){h[f]=1;break}}return n!==r&&r.dispose(),e!==i&&i.dispose(),[2,Cr(h,i.shape,"bool")]}}))}))};(function(n){n[n.NONE=0]="NONE",n[n.MEAN=1]="MEAN",n[n.SUM=2]="SUM",n[n.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Hr||(Hr={}));var U7=oe({absoluteDifference_:function(n,e,t,r){r===void 0&&(r=Hr.SUM_BY_NONZERO_WEIGHTS);var i=X(n,"labels","absoluteDifference"),o=X(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=X(t,"weights","absoluteDifference")),En(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return es(s,a,r)}}),es=oe({computeWeightedLoss_:function(n,e,t){t===void 0&&(t=Hr.SUM_BY_NONZERO_WEIGHTS);var r=X(n,"losses","computeWeightedLoss"),i=null;e!=null&&(i=X(e,"weights","computeWeightedLoss"));var o=i==null?r:r.mul(i);if(t===Hr.NONE)return o;if(t===Hr.SUM)return o.sum();if(t===Hr.MEAN){if(i==null)return o.mean();var a=r.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(Ct(a)):s}if(t===Hr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Ct(r.size));var u=i.mul(Kc(r.shape)).notEqual(Ct(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),z7=oe({cosineDistance_:function(n,e,t,r,i){i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"labels","cosineDistance"),a=X(e,"predictions","cosineDistance"),s=null;r!=null&&(s=X(r,"weights","cosineDistance")),En(o.shape,a.shape,"Error in cosineDistance: ");var u=Ct(1).sub(o.mul(a).sum(t,!0));return es(u,s,i)}}),W7=oe({hingeLoss_:function(n,e,t,r){r===void 0&&(r=Hr.SUM_BY_NONZERO_WEIGHTS);var i=X(n,"labels","hingeLoss"),o=X(e,"predictions","hingeLoss"),a=null;t!=null&&(a=X(t,"weights","hingeLoss")),En(i.shape,o.shape,"Error in hingeLoss: ");var s=Ct(1);i=Ct(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return es(u,a,r)}}),H7=oe({huberLoss_:function(n,e,t,r,i){r===void 0&&(r=1),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"labels","huberLoss"),a=X(e,"predictions","huberLoss"),s=null;t!=null&&(s=X(t,"weights","huberLoss")),En(o.shape,a.shape,"Error in huberLoss: ");var u=Ct(r),l=a.sub(o).abs(),c=b3(l,u),h=l.sub(c),f=Ct(.5).mul(c.square()).add(u.mul(h));return es(f,s,i)}}),G7=oe({logLoss_:function(n,e,t,r,i){r===void 0&&(r=1e-7),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"labels","logLoss"),a=X(e,"predictions","logLoss"),s=null;t!=null&&(s=X(t,"weights","logLoss")),En(o.shape,a.shape,"Error in logLoss: ");var u=Ct(1),l=Ct(r),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return es(c,s,i)}}),V7=oe({meanSquaredError_:function(n,e,t,r){r===void 0&&(r=Hr.SUM_BY_NONZERO_WEIGHTS);var i=X(n,"labels","meanSquaredError"),o=X(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=X(t,"weights","meanSquaredError")),En(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return es(s,a,r)}}),j7=oe({sigmoidCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"multiClassLabels","sigmoidCrossEntropy"),a=X(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=X(t,"weights","sigmoidCrossEntropy")),En(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Ct(r),l=Ct(1),c=Ct(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=(function(f,m){var g=X(f,"labels","sigmoidCrossEntropyWithLogits"),w=X(m,"logits","sigmoidCrossEntropyWithLogits");En(g.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=w.relu(),y=w.mul(g),x=w.abs().neg().exp().log1p();return v.sub(y).add(x)})(o,a);return es(h,s,i)}}),q7=oe({softmaxCrossEntropy_:function(n,e,t,r,i){r===void 0&&(r=0),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(n,"onehotLabels","softmaxCrossEntropy"),a=X(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=X(t,"weights","softmaxCrossEntropy")),En(o.shape,a.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Ct(r),l=Ct(1),c=Ct(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=(function(f,m,g){if(g===void 0&&(g=-1),g===-1&&(g=m.rank-1),g!==m.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+m.rank+" and dim was "+g);return og((function(w,v,y){var x=v.logSumExp([g],!0),E=v.toFloat().sub(x);return y([w,E]),{value:E.mul(w).neg().sum([g]),gradFunc:function(_,k){var C=k[0],A=k[1],I=xi(_.shape,[g]);return[_.reshape(I).mul(C.toFloat().sub(A.exp())),_.reshape(I).mul(A.exp().sub(C.toFloat()))]}}}))(f,m)})(o,a);return es(h,s,i)}}),$7=Object.freeze({get Reduction(){return Hr},absoluteDifference:U7,computeWeightedLoss:es,cosineDistance:z7,hingeLoss:W7,huberLoss:H7,logLoss:G7,meanSquaredError:V7,sigmoidCrossEntropy:j7,softmaxCrossEntropy:q7});function lE(n,e){return e===void 0&&(e=!1),le.tidy((function(){if(n.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+n.shape.length+"D Tensor.");for(var t=n.shape[0],r=n.shape[1],i=Z3(t),o=n.clone(),a=Yu([[1]],[1,1]),s=a.clone(),u=t>=r?r:t,l=function(h){var f,m=o,g=s,w=i;f=le.tidy((function(){var v=o.slice([h,h],[t-h,1]),y=v.norm(),x=o.slice([h,h],[1,1]),E=Yu([[-1]]).where(x.greater(0),Yu([[1]])),_=x.sub(E.mul(y)),k=v.div(_);s=k.shape[0]===1?a.clone():a.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var C=E.matMul(_).div(y).neg(),A=o.slice([h,0],[t-h,r]),I=C.mul(s),T=s.transpose();if(h===0)o=A.sub(I.matMul(T.matMul(A)));else{var R=A.sub(I.matMul(T.matMul(A)));o=o.slice([0,0],[h,r]).concat(R,0)}var N=I.transpose(),O=i.slice([0,h],[t,i.shape[1]-h]);if(h===0)i=O.sub(O.matMul(s).matMul(N));else{var V=O.sub(O.matMul(s).matMul(N));i=i.slice([0,0],[t,h]).concat(V,1)}return[s,o,i]})),s=f[0],o=f[1],i=f[2],bi([m,g,w])},c=0;c<u;++c)l(c);return!e&&t>r&&(i=i.slice([0,0],[t,r]),o=o.slice([0,0],[r,r])),[i,o]}))}var X7=oe({bandPart_:function(n,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var r=X(n,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var i=r.shape,o=r.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=km(0,a,1,"int32").reshape([-1,1]),l=km(0,s,1,"int32"),c=Fo(u,l),h=lg(c.lessEqual(Ct(+e,"int32")),c.greaterEqual(Ct(-t,"int32"))),f=Xn([a,s],r.dtype);return Ks(ng(r.reshape([-1,a,s])).map((function(m){return tl(h,m,f)}))).reshape(i)}}),Y7=oe({gramSchmidt_:function(n){var e;if(Array.isArray(n)){e=!1,K(n!=null&&n.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=n[0].shape[0],r=function(u){K(n[u].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+n[u].shape[0]+" vs. "+t+")"}))},i=1;i<n.length;++i)r(i)}else e=!0,n=Ow(n,n.shape[0],0).map((function(u){return u3(u,[0])}));K(n.length<=n[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+n.length+") exceeds number of dimensions ("+n[0].shape[0]+")."}));var o=[],a=n,s=function(u){o.push(le.tidy((function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=Us(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(bM(l,"euclidean"))})))};for(i=0;i<n.length;++i)s(i);return e?Ks(o,0):o}}),K7=oe({qr_:function(n,e){if(e===void 0&&(e=!1),n.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+n.rank);if(n.rank===2)return lE(n,e);var t=n.shape.slice(0,n.shape.length-2).reduce((function(a,s){return a*s})),r=ng(n.reshape([t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),i=[],o=[];return r.forEach((function(a){var s=lE(a,e),u=s[0],l=s[1];i.push(u),o.push(l)})),[Ks(i,0).reshape(n.shape),Ks(o,0).reshape(n.shape)]}}),J7=Object.freeze({bandPart:X7,gramSchmidt:Y7,qr:K7});function hg(n,e,t,r,i,o){r==null&&(r=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=n.shape[0];return t=Math.min(t,a),K(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),K(n.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+n.rank+"'"})),K(n.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+n.shape[1]})),K(e.rank===1,(function(){return"scores must be a 1D tensor"})),K(e.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]})),K(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"})),{maxOutputSize:t,iouThreshold:r,scoreThreshold:i,softNmsSigma:o}}var Q7=oe({resizeBilinear_:function(n,e,t){t===void 0&&(t=!1);var r=X(n,"images","resizeBilinear");K(r.rank===3||r.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),K(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=le.runKernelFunc((function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)}),{x:i},(function(l,c){return{x:function(){return le.runKernelFunc((function(h){return h.resizeBilinearBackprop(l,c[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Z7=oe({resizeNearestNeighbor_:function(n,e,t){t===void 0&&(t=!1);var r=X(n,"images","resizeNearestNeighbor");K(r.rank===3||r.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),K(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),K(r.dtype==="float32"||r.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=r,o=!1;r.rank===3&&(o=!0,i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var a=e[0],s=e[1],u=le.runKernelFunc((function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)}),{batchImages:i},(function(l,c){return{batchImages:function(){return le.runKernelFunc((function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)}),{})}}}));return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),e9=oe({nonMaxSuppression_:function(n,e,t,r,i){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=X(n,"boxes","nonMaxSuppression"),a=X(e,"scores","nonMaxSuppression"),s=hg(o,a,t,r,i);t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:r,scoreThreshold:i};return le.runKernelFunc((function(l){return l.nonMaxSuppression(o,a,t,r,i)}),{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),t9=function(n,e,t,r,i){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),wt(this,void 0,void 0,(function(){var o,a,s,u,l,c,h;return _t(this,(function(f){switch(f.label){case 0:return o=X(n,"boxes","nonMaxSuppressionAsync"),a=X(e,"scores","nonMaxSuppressionAsync"),s=hg(o,a,t,r,i),t=s.maxOutputSize,r=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],h=Ww(l,c,t,r,i),o!==n&&o.dispose(),a!==e&&a.dispose(),[2,h]}}))}))},n9=oe({nonMaxSuppressionWithScore_:function(n,e,t,r,i,o){r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=X(n,"boxes","nonMaxSuppression"),s=X(e,"scores","nonMaxSuppression"),u=hg(a,s,t,r,i,o),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=le.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),r9=function(n,e,t,r,i,o){return r===void 0&&(r=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),wt(this,void 0,void 0,(function(){var a,s,u,l,c,h,f;return _t(this,(function(m){switch(m.label){case 0:return a=X(n,"boxes","nonMaxSuppressionAsync"),s=X(e,"scores","nonMaxSuppressionAsync"),u=hg(a,s,t,r,i,o),t=u.maxOutputSize,r=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=m.sent(),c=l[0],h=l[1],f=Hw(c,h,t,r,i,o),a!==n&&a.dispose(),s!==e&&s.dispose(),[2,f]}}))}))},i9=oe({cropAndResize_:function(n,e,t,r,i,o){var a=X(n,"image","cropAndResize"),s=X(e,"boxes","cropAndResize","float32"),u=X(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return K(a.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),K(s.rank===2&&s.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."})),K(u.rank===1&&u.shape[0]===l,(function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."})),K(r.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),K(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),K(i==="bilinear"||i==="nearest",(function(){return"method must be bilinear or nearest, but was "+i})),le.runKernelFunc((function(c,h){return c.cropAndResize(a,s,u,r,i,o)}),{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:r})}}),EM=Object.freeze({resizeBilinear:Q7,resizeNearestNeighbor:Z7,nonMaxSuppression:e9,nonMaxSuppressionAsync:t9,nonMaxSuppressionWithScore:n9,nonMaxSuppressionWithScoreAsync:r9,cropAndResize:i9}),t_=function(n,e){return!(n>0)||e==="linear"},n_=function(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return n.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},r_=function(n,e){var t=e,r=ar(n.shape,e.shape);return r.length>0&&(t=t.sum(r)),t.reshape(n.shape)},i_=function(n,e,t){if(e==="linear")return n;if(e==="relu")return cg(n);if(e==="elu")return gM(n);if(e==="relu6")return yM(n);if(e==="prelu")return vM(n,t);throw new Error("Unknown fused activation "+e+".")},o9=oe({fusedMatMul_:function(n){var e,t=n.a,r=n.b,i=n.transposeA,o=i!==void 0&&i,a=n.transposeB,s=a!==void 0&&a,u=n.bias,l=n.activation,c=l===void 0?"linear":l,h=n.preluActivationWeights;if(t_(le.state.gradientDepth,c)===!1){var f=dM(t,r,o,s);return u!=null&&(f=uo(f,u)),i_(f,c,h)}var m=X(t,"a","fused matMul"),g=X(r,"b","fused matMul");e=Gn(m,g),m=e[0],g=e[1];var w=o?m.shape[m.rank-2]:m.shape[m.rank-1],v=s?g.shape[g.rank-1]:g.shape[g.rank-2],y=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=s?g.shape[g.rank-2]:g.shape[g.rank-1],E=m.shape.slice(0,-2),_=g.shape.slice(0,-2),k=bt(E),C=bt(_);K(m.rank>=2&&g.rank>=2&&m.rank===g.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+m.rank+" and "+g.rank+"."})),K(wr(E,_),(function(){return"Error in fused matMul: outer dimensions ("+E+") and ("+_+") of Tensors with shapes "+m.shape+" and "+g.shape+" must match."})),K(w===v,(function(){return"Error in fused matMul: inner shapes ("+w+") and ("+v+") of Tensors with shapes "+m.shape+" and "+g.shape+" and transposeA="+o+" and transposeB="+s+" must match."}));var A,I,T=m.shape.slice(0,-2).concat([y,x]),R=o?m.as3D(k,w,y):m.as3D(k,y,w),N=s?g.as3D(C,x,v):g.as3D(C,v,x);u!=null&&on(T,(A=Gn(A=X(u,"bias","fused matMul"),m)[0]).shape),h!=null&&(I=X(h,"prelu weights","fused matMul"));var O={a:R,b:N};u!=null&&(O.bias=A),h!=null&&(O.preluActivationWeights=I);var V=[R,N];return le.runKernelFunc((function(F,B){var U=F.fusedBatchMatMul({a:R,b:N,transposeA:o,transposeB:s,bias:A,activation:c,preluActivationWeights:I});return B([R,N,U]),U}),O,(function(F,B){var U=B[0],P=B[1],L=B[2],H=n_(F,L,c),W={};return u!=null&&(W={bias:function(){return r_(A,H)}}),Object.assign(o||s?!o&&s?{a:function(){return H.matMul(P,!1,!1)},b:function(){return H.matMul(U,!0,!1)}}:o&&!s?{a:function(){return P.matMul(H,!1,!0)},b:function(){return U.matMul(H,!1,!1)}}:{a:function(){return P.matMul(H,!0,!0)},b:function(){return H.matMul(U,!0,!0)}}:{a:function(){return H.matMul(P,!1,!0)},b:function(){return U.matMul(H,!0,!1)}},W)}),"_FusedMatMul",{transposeA:o,transposeB:s,activation:c},V,[!0]).reshape(T)}}),a9=oe({fusedConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,a=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,f=h===void 0?"linear":h,m=n.preluActivationWeights;if(f=f||"linear",t_(le.state.gradientDepth,f)===!1){var g=ll(e,t,r,i,a,u,l);return c!=null&&(g=uo(g,c)),i_(g,f,m)}var w=X(e,"x","conv2d"),v=X(t,"filter","conv2d"),y=w,x=!1;w.rank===3&&(x=!0,y=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),K(y.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."})),K(v.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."})),l!=null&&K(Jn(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."})),K(y.shape[3]===v.shape[2],(function(){return"Error in conv2d: depth of input ("+y.shape[3]+") must match input depth for filter "+v.shape[2]+"."})),K(ni(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),K(a==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var E,_,k=sl(y.shape,v.shape,r,u,i,l);c!=null&&(E=Gn(E=X(c,"bias","fused conv2d"),w)[0],on(k.outShape,E.shape)),m!=null&&(_=X(m,"prelu weights","fused conv2d"));var C={x:y,filter:v};c!=null&&(C.bias=E),m!=null&&(C.preluActivationWeights=_);var A=[v,y],I=le.runKernelFunc((function(T,R){var N=T.fusedConv2d({input:y,filter:v,convInfo:k,bias:E,activation:f,preluActivationWeights:_});return R([v,y,N]),N}),C,(function(T,R){var N=R,O=N[0],V=N[1],F=N[2],B=n_(T,F,f);K(Uc(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var U={};return c!=null&&(U={bias:function(){return r_(E,B)}}),Object.assign({x:function(){return uM(V.shape,B,O,r,i)},filter:function(){return Yw(V,B,O.shape,r,i)}},U)}),"FusedConv2D",{convInfo:k,activation:f},A,[!0]);return x?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),s9=oe({fusedDepthwiseConv2d_:function(n){var e=n.x,t=n.filter,r=n.strides,i=n.pad,o=n.dataFormat,a=o===void 0?"NHWC":o,s=n.dilations,u=s===void 0?[1,1]:s,l=n.dimRoundingMode,c=n.bias,h=n.activation,f=h===void 0?"linear":h,m=n.preluActivationWeights;if(t_(le.state.gradientDepth,f)===!1){var g=Kw(e,t,r,i,a,u,l);return c!=null&&(g=uo(g,c)),i_(g,f,m)}var w=X(e,"x","depthwiseConv2d"),v=X(t,"filter","depthwiseConv2d"),y=w,x=!1;w.rank===3&&(x=!0,y=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),K(y.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+y.rank+"."})),K(v.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."})),K(y.shape[3]===v.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+y.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."})),u==null&&(u=[1,1]),K(ni(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),l!=null&&K(Jn(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."}));var E,_,k=sl(y.shape,v.shape,r,u,i,l,!0);c!=null&&(E=Gn(E=X(c,"bias","fused conv2d"),w)[0],on(k.outShape,E.shape)),m!=null&&(_=X(m,"prelu weights","fused depthwiseConv2d"));var C={x:y,filter:v};c!=null&&(C.bias=E),m!=null&&(C.preluActivationWeights=_);var A=[v,y],I=le.runKernelFunc((function(T,R){var N=T.fusedDepthwiseConv2D({input:y,filter:v,convInfo:k,bias:E,activation:f,preluActivationWeights:_});return R([v,y,N]),N}),C,(function(T,R){K(Uc(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var N=R[0],O=R[1],V=R[2],F=n_(T,V,f),B={};return c!=null&&(B={bias:function(){return r_(E,F)}}),Object.assign({x:function(){return lM(O.shape,F,N,k)},filter:function(){return cM(O,F,N.shape,k)}},B)}),"FusedDepthwiseConv2D",{convInfo:k,activation:f},A,[!0]);return x?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),u9=Object.freeze({matMul:o9,conv2d:a9,depthwiseConv2d:s9}),l9=Object.freeze({image:EM,linalg:J7,losses:$7,spectral:D7,fused:u9,signal:L7,add:uo,addN:m8,batchNorm:Md,batchNormalization:g8,batchNorm2d:y8,batchNormalization2d:v8,batchNorm3d:w8,batchNormalization3d:b8,batchNorm4d:x8,batchNormalization4d:_8,broadcastTo:Y3,clone:S8,div:Js,divNoNan:Q3,eye:Z3,multinomial:C8,oneHot:Pm,pad:Za,pad1d:T8,pad2d:M8,pad3d:R8,pad4d:A8,rand:I8,randomGamma:P8,randomNormal:F8,randomUniform:eM,square:tM,squaredDifference:nM,tile:Ec,truncatedNormal:O8,conv1d:X8,conv2d:ll,conv3d:Y8,depthwiseConv2d:Kw,separableConv2d:hM,conv2dTranspose:K8,conv3dTranspose:J8,op:oe,booleanMaskAsync:$8,complex:Er,real:to,imag:ia,concat:so,concat1d:iB,concat2d:oB,concat3d:aB,concat4d:sB,split:Ow,matMul:dM,dot:Q8,outerProduct:Z8,reverse:Rd,reverse1d:e7,reverse2d:t7,reverse3d:n7,reverse4d:r7,maxPool:Ri,avgPool:i7,pool:o7,maxPool3d:a7,avgPool3d:s7,maxPoolWithArgmax:u7,slice:Qs,slice1d:l7,slice2d:c7,slice3d:h7,slice4d:d7,abs:fB,acos:pB,acosh:mB,asin:gB,asinh:vB,atan:yB,atanh:bB,ceil:wB,clipByValue:_B,cos:xB,cosh:SB,erf:EB,exp:kB,expm1:CB,floor:TB,log:MB,log1p:RB,logSigmoid:AB,neg:Lw,reciprocal:IB,round:DB,rsqrt:v3,sigmoid:NB,sign:PB,isNaN:FB,isInf:OB,isFinite:LB,sin:BB,sinh:UB,softplus:zB,sqrt:WB,step:HB,tan:GB,tanh:VB,all:f7,any:p7,argMax:m7,argMin:g7,logSumExp:v7,max:y7,mean:b7,min:w7,moments:_7,sum:Us,prod:x7,equal:rM,equalStrict:L8,greater:B8,greaterEqual:iM,greaterEqualStrict:U8,greaterStrict:z8,less:W8,lessEqual:H8,lessEqualStrict:G8,lessStrict:V8,notEqual:j8,notEqualStrict:q8,addStrict:jB,atan2:qB,divStrict:$B,floorDiv:y3,maximum:Bw,maximumStrict:XB,minimum:b3,minimumStrict:YB,mod:KB,modStrict:JB,mul:$n,mulStrict:QB,pow:Rm,powStrict:ZB,squaredDifferenceStrict:e6,sub:Fo,subStrict:t6,elu:gM,leakyRelu:S7,prelu:vM,relu:cg,relu6:yM,selu:E7,logicalAnd:lg,logicalNot:E8,logicalOr:K3,logicalXor:k8,where:tl,whereAsync:J3,buffer:Xt,print:uB,batchToSpaceND:a3,cast:lB,cumsum:cB,depthToSpace:hB,expandDims:Bs,reshape:Oa,spaceToBatchND:s3,squeeze:u3,stack:Ks,unstack:ng,setdiff1dAsync:dB,fill:Ku,linspace:rB,ones:Kc,range:km,scalar:Ct,tensor:Cr,tensor1d:Bo,tensor2d:Yu,tensor3d:i3,tensor4d:ta,tensor5d:eB,tensor6d:tB,variable:nB,zeros:Xn,onesLike:o3,zerosLike:hn,transpose:Co,softmax:ag,logSoftmax:u6,localResponseNormalization:k7,norm:bM,gather:Xw,unsortedSegmentSum:oM,basicLSTMCell:C7,multiRNNCell:T7,movingAverage:M7,stridedSlice:R7,topk:A7,scatterND:I7,fft:Jw,ifft:Fm,rfft:Qw,irfft:wM,sparseToDense:N7,gatherND:P7,diag:F7,dropout:O7,hannWindow:Zw,hammingWindow:xM,frame:e_,stft:SM,inTopKAsync:B7});function Le(n,e){Array.isArray(n)||(n=[n]),n.forEach((function(t){t!=null&&K(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function g0(n,e,t,r,i,o){for(var a=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=i.padInfo.top,m=i.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Xt(i.outShape,t),v=w.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],x=i.outShape[2]*i.outShape[3],E=i.outShape[3],_=0;_<i.batchSize;++_)for(var k=_*y,C=_*r[0],A=0;A<i.inChannels;++A)for(var I=0;I<i.outHeight;++I)for(var T=I*a-f,R=Math.max(0,T),N=Math.min(i.inHeight,c+T),O=k+I*x,V=0;V<i.outWidth;++V){for(var F=V*s-m,B=Math.max(0,F),U=Math.min(i.inWidth,h+F),P=g,L=0,H=0,W=R;W<N;W+=u){for(var z=C+W*r[1],q=B;q<U;q+=l){var re=n[z+q*r[2]+A];o==="max"&&re>P?P=re:o==="avg"&&(L+=re,H++)}if(isNaN(P))break}v[O+V*E+A]=o==="avg"?L/H:P}return w}function kM(n,e,t,r,i,o){i===void 0&&(i=!1),o===void 0&&(o=!1);for(var a=Xt(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=r.padInfo.top,g=r.padInfo.left,w=Xt(e,t,n),v=0;v<r.batchSize;++v)for(var y=0;y<r.inChannels;++y)for(var x=0;x<r.outHeight;++x){for(var E=x*s-m,_=E;_<0;)_+=l;for(var k=Math.min(r.inHeight,h+E),C=0;C<r.outWidth;++C){for(var A=C*u-g,I=A;I<0;)I+=c;for(var T=Math.min(r.inWidth,f+A),R=Number.NEGATIVE_INFINITY,N=-1,O=_;O<k;O+=l)for(var V=O-E,F=I;F<T;F+=c){var B=F-A,U=w.get(v,O,F,y);U>R&&(R=U,N=i?o?((v*r.inHeight+O)*r.inWidth+F)*r.inChannels+y:(O*r.inWidth+F)*r.inChannels+y:V*f+B)}a.set(N,v,x,C,y)}}return a}function Ky(n,e,t,r){if(t==="linear")return n.linear(e);if(t==="relu")return n.relu(e);if(t==="elu")return n.elu(e);if(t==="relu6")return n.relu6(e);if(t==="prelu")return n.prelu(e,r);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var c9=(function(n){function e(){var t=n.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new E3(t,le),t}return Uo(e,n),e.prototype.write=function(t,r,i){this.firstUse&&(this.firstUse=!1,Ne().get("IS_NODE")&&Sm(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,r,i,o){this.data.set(t,{values:r,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(r){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var r=this.data.get(t),i=r.dtype,o=r.complexTensors;return i==="complex64"?m0(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var r=this.readSync(t.dataId),i=r;if(t.dtype==="string")try{i=r.map((function(o){return wm(o)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Xt(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,r,i){var o=this.write(t,r,i);return le.makeTensorFromDataId(o,r,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var r=this.data.get(t).complexTensors;r!=null&&(r.real.dispose(),r.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return wt(this,void 0,void 0,(function(){var r;return _t(this,(function(i){return r=ea(),t(),[2,{kernelMs:ea()-r}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,r){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:le.keep(t.clone()),imag:le.keep(r.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,r,i){if(Le(t,"slice"),x3(t.shape,r,i)){var o=S3(r,t.strides),a=bt(i);return Cr(this.readSync(t.dataId).subarray(o,o+a),i,t.dtype)}for(var s=Xt(i,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l).map((function(h,f){return h+r[f]}));s.values[l]=u.get.apply(u,c)}return s.toTensor()},e.prototype.stridedSlice=function(t,r,i,o){Le(t,"stridedSlice");var a=Uw(r,i,o);if(a.some((function(m){return m===0})))return Cr([],a);for(var s=Xt(a,t.dtype),u=this.bufferSync(t),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),h=new Array(c.length),f=0;f<h.length;f++)h[f]=c[f]*o[f]+r[f];s.set.apply(s,[u.get.apply(u,h)].concat(c))}return s.toTensor()},e.prototype.diag=function(t){for(var r=this.readSync(t.dataId),i=Xt([t.size,t.size],t.dtype),o=i.values,a=0;a<r.length;a++)o[a*t.size+a]=r[a];return i.toTensor()},e.prototype.unstack=function(t,r){for(var i=t.shape[r],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==r&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[r]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[r]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.reverse=function(t,r){Le(t,"reverse");for(var i=Xt(t.shape,t.dtype),o=this.bufferSync(t),a=function(u){var l=i.indexToLoc(u),c=l.slice();r.forEach((function(h){return c[h]=t.shape[h]-1-c[h]})),i.set.apply(i,[o.get.apply(o,c)].concat(l))},s=0;s<i.size;s++)a(s);return i.toTensor()},e.prototype.concat=function(t,r){var i=this;if(t[0].dtype==="complex64"){var o=t.map((function(m){return to(m)})),a=t.map((function(m){return ia(m)}));return Er(this.concat(o,r),this.concat(a,r))}var s=t.map((function(m){var g=bt(m.shape.slice(r));return m.as2D(-1,g)})),u=Bc(s.map((function(m){return m.shape})),1),l=Xt(u,t[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach((function(m){l.set(i.readSync(m.dataId),c),c+=m.size}))}else{var h=0;s.forEach((function(m){for(var g=i.readSync(m.dataId),w=0,v=0;v<m.shape[0];++v)for(var y=v*u[1]+h,x=0;x<m.shape[1];++x)l[y+x]=g[w++];h+=m.shape[1]}))}var f=Bc(t.map((function(m){return m.shape})),r);return Cr(l,f,t[0].dtype)},e.prototype.neg=function(t){return Le(t,"neg"),this.multiply(Ct(-1),t)},e.prototype.add=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,o,a,s){return{real:i+a,imag:o+s}})):this.broadcastedBinaryOp(t,r,kr(t.dtype,r.dtype),(function(i,o){return i+o}))},e.prototype.addN=function(t){var r=this;Le(t,"addN");for(var i=t.map((function(c){return r.readSync(c.dataId)})),o=Xt(t[0].shape,t[0].dtype),a=o.values,s=0;s<t.length;s++)for(var u=i[s],l=0;l<a.length;l++)a[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(t,r){var i=dr([r],t.shape),o=this.max(t,i),a=xi(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return Js(u,l)},e.prototype.subtract=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,o,a,s){return{real:i-a,imag:o-s}})):this.broadcastedBinaryOp(t,r,kr(t.dtype,r.dtype),(function(i,o){return i-o}))},e.prototype.pow=function(t,r){return Le([t,r],"pow"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.pow(i,o)}))},e.prototype.batchMatMul=function(t,r,i,o){Le([t,r],"matMul");for(var a=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],u=o?r.shape[1]:r.shape[2],l=t.shape[0],c=this.readSync(t.dataId),h=this.readSync(r.dataId),f=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],m=f[0],g=f[1],w=f[2],v=o?[1,r.strides[1],r.strides[0]]:[r.strides[1],1,r.strides[0]],y=v[0],x=v[1],E=v[2],_=s*u,k=Xt([l,s,u],t.dtype),C=k.values,A=this.blockSize,I=0;I<l;I++)for(var T=0;T<s;T+=A)for(var R=0;R<u;R+=A)for(var N=0;N<a;N+=A)for(var O=Math.min(T+A,s),V=Math.min(R+A,u),F=Math.min(N+A,a),B=T;B<O;B++)for(var U=R;U<V;U++){for(var P=0,L=N;L<F;L++)P+=c[I*m+B*g+L*w]*h[L*y+U*x+I*E];C[I*_+(B*u+U)]+=P}return k.toTensor()},e.prototype.fusedBatchMatMul=function(t){var r=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(r,i,o,a);return s&&(c=this.add(c,s)),u&&(c=Ky(this,c,u,l)),c},e.prototype.multiply=function(t,r){return t.dtype==="complex64"||r.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),r.cast("complex64"),(function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}})):this.broadcastedBinaryOp(t,r,kr(t.dtype,r.dtype),(function(i,o){return i*o}))},e.prototype.floorDiv=function(t,r){return Le([t,r],"floorDiv"),this.broadcastedBinaryOp(t,r,"int32",(function(i,o){return Math.floor(i/o)}))},e.prototype.sum=function(t,r){Le(t,"sum"),Ii("sum",r,t.rank);for(var i=Br(t.shape,r),o=i[0],a=i[1],s=Xn(o,kr(t.dtype,"int32")),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=0,g=0;g<u;++g)m+=c[f+g];l[h]=m}return s},e.prototype.prod=function(t,r){Le(t,"sum");for(var i=Br(t.shape,r),o=i[0],a=i[1],s=Xn(o,kr(t.dtype,"int32")),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=1,g=0;g<u;++g)m*=c[f+g];l[h]=m}return s},e.prototype.unsortedSegmentSum=function(t,r,i){Le(t,"unsortedSegmentSum");for(var o=[],a=t.rank-r.rank,s=0;s<a;++s)r=r.expandDims(s+1);for(s=0;s<i;++s){var u=Ct(s,"int32"),l=rM(u,r).asType("float32").mul(t).sum(0);o.push(l)}return Ks(o)},e.prototype.argMin=function(t,r){Le(t,"argMin");var i=[r];Ii("argMin",i,t.rank);for(var o=Br(t.shape,i),a=o[0],s=o[1],u=Xn(a,"int32"),l=bt(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),f=0;f<c.length;++f){for(var m=f*l,g=h[m],w=0,v=0;v<l;++v){var y=h[m+v];y<g&&(g=y,w=v)}c[f]=w}return u},e.prototype.argMax=function(t,r){Le(t,"argMax");var i=[r];Ii("argMax",i,t.rank);for(var o=Br(t.shape,i),a=o[0],s=o[1],u=Xn(a,"int32"),l=bt(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),f=0;f<c.length;++f){for(var m=f*l,g=h[m],w=0,v=0;v<l;++v){var y=h[m+v];y>g&&(g=y,w=v)}c[f]=w}return u},e.prototype.cumsum=function(t,r,i,o){if(Le(t,"cumsum"),r!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+r);for(var a=kr(t.dtype,"int32"),s=Xn(t.shape,a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],h=o?function(v,y){return v+c-y-1}:function(v,y){return v+y},f=0;f<l.length;f+=c)for(var m=0;m<c;m++){var g=h(f,m);if(m===0)u[g]=i?0:l[g];else{var w=h(f,m-1);u[g]=i?l[w]+u[w]:l[g]+u[w]}}return s},e.prototype.equal=function(t,r){return Le([t,r],"equal"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i===o?1:0}))},e.prototype.notEqual=function(t,r){return Le([t,r],"notEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i!==o?1:0}))},e.prototype.less=function(t,r){return Le([t,r],"less"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i<o?1:0}))},e.prototype.lessEqual=function(t,r){return Le([t,r],"lessEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i<=o?1:0}))},e.prototype.greater=function(t,r){return Le([t,r],"greater"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i>o?1:0}))},e.prototype.greaterEqual=function(t,r){return Le([t,r],"greaterEqual"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i>=o?1:0}))},e.prototype.logicalNot=function(t){Le(t,"logicalNot");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)i[o]=r[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,r){return Le([t,r],"logicalAnd"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i&&o}))},e.prototype.logicalOr=function(t,r){return Le([t,r],"logicalOr"),this.broadcastedBinaryOp(t,r,"bool",(function(i,o){return i||o}))},e.prototype.select=function(t,r,i){Le([t,r,i],"select");for(var o=this.readSync(t.dataId),a=this.readSync(r.dataId),s=this.readSync(i.dataId),u=Xn(r.shape,kr(r.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,h=t.rank===0||t.rank>1||r.rank===1?1:bt(r.shape.slice(1)),f=0;f<o.length;f++)for(var m=0;m<h;m++)o[f]===1?l[c++]=a[f]:l[c++]=s[f];return u},e.prototype.where=function(t){Le([t],"where");var r=this.readSync(t.dataId);return Gw(t.shape,r)},e.prototype.topk=function(t,r,i){return Le(t,"topk"),D3(this.readSync(t.dataId),t.shape,t.dtype,r)},e.prototype.min=function(t,r){Le(t,"min"),Ii("min",r,t.rank);for(var i=Br(t.shape,r),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];w<m&&(m=w)}l[h]=m}return s},e.prototype.minimum=function(t,r){return Le([t,r],"minimum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.min(i,o)}))},e.prototype.mod=function(t,r){return Le([t,r],"mod"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o}))},e.prototype.max=function(t,r){Le(t,"max"),Ii("max",r,t.rank);for(var i=Br(t.shape,r),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];w>m&&(m=w)}l[h]=m}return s},e.prototype.maximum=function(t,r){return Le([t,r],"maximum"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.max(i,o)}))},e.prototype.all=function(t,r){Le(t,"all"),Ii("all",r,t.rank);for(var i=Br(t.shape,r),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];m=m&&w}l[h]=m}return s},e.prototype.any=function(t,r){Le(t,"any"),Ii("any",r,t.rank);for(var i=Br(t.shape,r),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];m=m||w}l[h]=m}return s},e.prototype.squaredDifference=function(t,r){return Le([t,r],"squaredDifference"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){var a=i-o;return a*a}))},e.prototype.ceil=function(t){Le(t,"ceil");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.ceil(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Le(t,"floor");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.floor(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Le(t,"x");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)r[o]<0?i[o]=-1:r[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Le(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isNaN(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Le(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Math.abs(r[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Le(t,"x");for(var r=this.readSync(t.dataId),i=new Uint8Array(r.length),o=0;o<r.length;++o)Number.isFinite(r[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Le(t,"round");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=Math.floor(r[o]);r[o]-a<.5?i[o]=Math.floor(r[o]):r[o]-a>.5?i[o]=Math.ceil(r[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Le(t,"exp");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.exp(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Le(t,"expm1");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=Math.expm1(r[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Le(t,"log");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Le(t,"log1p");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.log1p(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Le(t,"sqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Le(t,"rsqrt");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o){var a=r[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Le(t,"reciprocal");for(var r=this.readSync(t.dataId),i=new Float32Array(r.length),o=0;o<r.length;++o)i[o]=1/r[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Le(t,"relu");for(var r=Xn(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return r},e.prototype.relu6=function(t){Le(t,"relu");for(var r=Xn(t.shape,t.dtype),i=this.readSync(r.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return r},e.prototype.prelu=function(t,r){return Le([t,r],"prelu"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return i<0?o*i:i}))},e.prototype.elu=function(t){Le(t,"elu");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];r[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(r,t.shape,"float32")},e.prototype.eluDer=function(t,r){Le([t,r],"eluDer");for(var i=new Float32Array(r.size),o=this.readSync(r.dataId),a=this.readSync(t.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,r.shape,"float32")},e.prototype.selu=function(t){Le(t,"selu");for(var r=jw,i=qw,o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:r*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,r,i){Le(t,"clip");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<r?r:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.abs(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var a=i[2*o],s=i[2*o+1];r[o]=Math.hypot(a,s)}return this.makeOutput(r,t.shape,"float32")},e.prototype.int=function(t){Le(t,"int");for(var r=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=i[o];return this.makeOutput(r,t.shape,"int32")},e.prototype.sigmoid=function(t){Le(t,"sigmoid");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(r,t.shape,"float32")},e.prototype.softplus=function(t){Le(t,"softplus");for(var r=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a]>-r,u=o[a]<r,l=Math.exp(o[a]),c=void 0;c=u?l:s?o[a]:Math.log(1+l),i[a]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Le(t,"sin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cos=function(t){Le(t,"cos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tan=function(t){Le(t,"tan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.tan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asin=function(t){Le(t,"asin");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asin(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acos=function(t){Le(t,"acos");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acos(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan=function(t){Le(t,"atan");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atan(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atan2=function(t,r){return Le([t,r],"atan2"),this.broadcastedBinaryOp(t,r,t.dtype,(function(i,o){return Math.atan2(i,o)}))},e.prototype.sinh=function(t){Le(t,"sinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.sinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.cosh=function(t){Le(t,"cosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.cosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.tanh=function(t){Le(t,"tanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=uL(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.asinh=function(t){Le(t,"asinh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.asinh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.acosh=function(t){Le(t,"acosh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.acosh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.atanh=function(t){Le(t,"atanh");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)r[o]=Math.atanh(i[o]);return this.makeOutput(r,t.shape,"float32")},e.prototype.erf=function(t){Le(t,"erf");for(var r=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);r[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(r,t.shape,"float32")},e.prototype.step=function(t,r){r===void 0&&(r=0),Le(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:r}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.conv2d(r,i,o);return a&&(l=this.add(l,a)),s&&(l=Ky(this,l,s,u)),l},e.prototype.conv2d=function(t,r,i){Le([t,r],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.dataFormat==="channelsLast",f=Xt(i.outShape,t.dtype),m=t.strides[0],g=h?t.strides[1]:t.strides[2],w=h?t.strides[2]:1,v=h?1:t.strides[1],y=f.strides[0],x=h?f.strides[1]:f.strides[2],E=h?f.strides[2]:1,_=h?1:f.strides[1],k=this.readSync(t.dataId),C=this.readSync(r.dataId),A=f.values,I=0;I<i.batchSize;++I)for(var T=I*m,R=I*y,N=0;N<i.outHeight;++N)for(var O=R+N*x,V=N*i.strideHeight-c,F=0;F<o;F++){var B=V+F*s;if(!(B<0||B>=i.inHeight))for(var U=F*r.strides[0],P=T+B*g,L=0;L<i.outWidth;++L)for(var H=O+L*E,W=L*i.strideWidth-l,z=0;z<a;z++){var q=W+z*u;if(!(q<0||q>=i.inWidth))for(var re=P+q*w,de=U+z*r.strides[1],ye=0;ye<i.inChannels;++ye){for(var te=k[re+ye*v],ie=0;ie<i.outChannels;++ie)A[H+ie*_]+=te*C[de+ie];de+=i.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(t,r,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.front,f=i.padInfo.left,m=i.padInfo.top,g=Xt(i.outShape,t.dtype),w=this.readSync(t.dataId),v=this.readSync(r.dataId),y=g.values,x=0;x<i.batchSize;++x)for(var E=x*t.strides[0],_=x*g.strides[0],k=0;k<i.outDepth;++k)for(var C=_+k*g.strides[1],A=k*i.strideDepth-h,I=0;I<o;I++){var T=A+I*u;if(!(T<0||T>=i.inDepth))for(var R=I*r.strides[0],N=E+T*t.strides[1],O=0;O<i.outHeight;++O)for(var V=C+O*g.strides[2],F=O*i.strideHeight-m,B=0;B<a;B++){var U=F+B*l;if(!(U<0||U>=i.inHeight))for(var P=R+B*r.strides[1],L=N+U*t.strides[2],H=0;H<i.outWidth;++H)for(var W=V+H*i.outChannels,z=H*i.strideWidth-f,q=0;q<s;q++){var re=z+q*c;if(!(re<0||re>=i.inWidth))for(var de=P+q*r.strides[2],ye=L+re*i.inChannels,te=de,ie=0;ie<i.inChannels;++ie){for(var fe=w[ye+ie],Re=0;Re<i.outChannels;++Re)y[W+Re]+=fe*v[te+Re];te+=i.outChannels}}}}return g.toTensor()},e.prototype.conv2dDerInput=function(t,r,i){Le([t,r],"conv2dDerInput");for(var o=Xt(i.inShape,"float32"),a=o.values,s=this.readSync(t.dataId),u=this.readSync(r.dataId),l=r.strides,c=l[0],h=l[1],f=l[2],m=i.batchSize,g=i.filterHeight,w=i.filterWidth,v=i.inChannels,y=i.inHeight,x=i.inWidth,E=i.outChannels,_=i.outHeight,k=i.outWidth,C=i.strideHeight,A=i.strideWidth,I=i.dataFormat,T=g-1-i.padInfo.top,R=w-1-i.padInfo.left,N=I==="channelsLast",O=o.strides[0],V=N?o.strides[1]:o.strides[2],F=N?o.strides[2]:1,B=N?1:o.strides[1],U=t.strides[0],P=N?t.strides[1]:t.strides[2],L=N?t.strides[2]:1,H=N?1:t.strides[1],W=0;W<m;++W)for(var z=0;z<v;++z)for(var q=0;q<y;++q)for(var re=q-T,de=Math.max(0,Math.ceil(re/C)),ye=Math.min(_,(g+re)/C),te=0;te<x;++te){for(var ie=te-R,fe=Math.max(0,Math.ceil(ie/A)),Re=Math.min(k,(w+ie)/A),De=0,Be=de;Be<ye;++Be)for(var lt=Be*C-re,Y=fe;Y<Re;++Y)for(var ot=U*W+P*Be+L*Y,Ke=c*(g-1-lt)+h*(w-1-(Y*A-ie))+f*z,Xe=0;Xe<E;++Xe)De+=s[ot+H*Xe]*u[Ke+Xe];a[O*W+V*q+F*te+B*z]=De}return o.toTensor()},e.prototype.conv3dDerInput=function(t,r,i){for(var o=Xt(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=s[3],f=this.readSync(t.dataId),m=t.strides,g=m[0],w=m[1],v=m[2],y=m[3],x=this.readSync(r.dataId),E=r.strides,_=E[0],k=E[1],C=E[2],A=E[3],I=i.batchSize,T=i.filterDepth,R=i.filterHeight,N=i.filterWidth,O=i.inChannels,V=i.inDepth,F=i.inHeight,B=i.inWidth,U=i.outChannels,P=i.outDepth,L=i.outHeight,H=i.outWidth,W=i.strideDepth,z=i.strideHeight,q=i.strideWidth,re=T-1-i.padInfo.front,de=R-1-i.padInfo.top,ye=N-1-i.padInfo.left,te=0;te<I;++te)for(var ie=0;ie<O;++ie)for(var fe=0;fe<V;++fe)for(var Re=fe-re,De=Math.max(0,Math.ceil(Re/W)),Be=Math.min(P,(T+Re)/W),lt=0;lt<F;++lt)for(var Y=lt-de,ot=Math.max(0,Math.ceil(Y/z)),Ke=Math.min(L,(R+Y)/z),Xe=0;Xe<B;++Xe){for(var qe=Xe-ye,Tt=Math.max(0,Math.ceil(qe/q)),Qe=Math.min(H,(N+qe)/q),ft=0,Mt=De;Mt<Be;++Mt)for(var Ut=Mt*W-Re,Q=ot;Q<Ke;++Q)for(var j=Q*z-Y,me=Tt;me<Qe;++me)for(var Ae=g*te+w*Mt+v*Q+y*me,Pe=_*(T-1-Ut)+k*(R-1-j)+C*(N-1-(me*q-qe))+A*ie,ke=0;ke<U;++ke)ft+=f[Ae+ke]*x[Pe+ke];a[u*te+l*fe+c*lt+h*Xe+ie]=ft}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,r,i){Le([t,r],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=Xt(i.filterShape,"float32"),h=i.padInfo.left,f=i.padInfo.top,m=this.bufferSync(t),g=this.bufferSync(r),w=0;w<s;++w)for(var v=Math.max(0,Math.ceil((f-w)/o)),y=Math.min(i.outHeight,(i.inHeight+f-w)/o),x=0;x<u;++x)for(var E=Math.max(0,Math.ceil((h-x)/a)),_=Math.min(i.outWidth,(i.inWidth+h-x)/a),k=0;k<i.inChannels;++k)for(var C=0;C<i.outChannels;++C){for(var A=0,I=0;I<i.batchSize;++I)for(var T=v;T<y;++T)for(var R=w+T*o-f,N=E;N<_;++N){var O=x+N*a-h;A+=l?m.get(I,R,O,k)*g.get(I,T,N,C):m.get(I,k,R,O)*g.get(I,C,T,N)}c.set(A,w,x,k,C)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,r,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=Xt(i.filterShape,"float32"),f=h.values,m=h.strides,g=m[0],w=m[1],v=m[2],y=m[3],x=this.readSync(r.dataId),E=r.strides,_=E[0],k=E[1],C=E[2],A=E[3],I=this.readSync(t.dataId),T=t.strides,R=T[0],N=T[1],O=T[2],V=T[3],F=i.padInfo.front,B=i.padInfo.left,U=i.padInfo.top,P=0;P<u;++P)for(var L=Math.max(0,Math.ceil((F-P)/o)),H=Math.min(i.outDepth,(i.inDepth+F-P)/o),W=P*g,z=0;z<l;++z)for(var q=Math.max(0,Math.ceil((U-z)/a)),re=Math.min(i.outHeight,(i.inHeight+U-z)/a),de=z*w+W,ye=0;ye<c;++ye)for(var te=Math.max(0,Math.ceil((B-ye)/s)),ie=Math.min(i.outWidth,(i.inWidth+B-ye)/s),fe=ye*v+de,Re=0;Re<i.inChannels;++Re)for(var De=Re*y+fe,Be=0;Be<i.outChannels;++Be){for(var lt=0,Y=0;Y<i.batchSize;++Y)for(var ot=Y*R,Ke=Y*_,Xe=L;Xe<H;++Xe)for(var qe=(P+Xe*o-F)*N+ot,Tt=Xe*k+Ke,Qe=q;Qe<re;++Qe)for(var ft=(z+Qe*a-U)*O+qe,Mt=Qe*C+Tt,Ut=te;Ut<ie;++Ut){var Q=Ut*A+Mt;lt+=I[(ye+Ut*s-B)*V+ft+Re]*x[Q+Be]}f[De+Be]=lt}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var r=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(r,i,o);return a&&(l=this.add(l,a)),s&&(l=Ky(this,l,s,u)),l},e.prototype.depthwiseConv2D=function(t,r,i){Le([t,r],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.outChannels/i.inChannels,f=Xt(i.outShape,t.dtype),m=this.readSync(t.dataId),g=this.readSync(r.dataId),w=f.values,v=0;v<i.batchSize;++v)for(var y=v*t.strides[0],x=v*f.strides[0],E=0;E<i.outHeight;++E)for(var _=x+E*f.strides[1],k=E*i.strideHeight-l,C=0;C<o;++C){var A=k+C*s;if(!(A<0||A>=i.inHeight))for(var I=C*r.strides[0],T=y+A*t.strides[1],R=0;R<i.outWidth;++R)for(var N=_+R*f.strides[2],O=R*i.strideWidth-c,V=0;V<a;++V){var F=O+V*u;if(!(F<0||F>=i.inWidth))for(var B=I+V*r.strides[1],U=T+F*i.inChannels,P=N,L=B,H=0;H<i.inChannels;++H){for(var W=m[U+H],z=0;z<h;++z)w[P+z]+=W*g[L+z];P+=h,L+=h}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,r,i){Le([t,r],"depthwiseConv2DDerInput");for(var o=Xt(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=this.readSync(t.dataId),f=t.strides,m=f[0],g=f[1],w=f[2],v=this.readSync(r.dataId),y=r.strides,x=y[0],E=y[1],_=y[2],k=i.batchSize,C=i.filterHeight,A=i.filterWidth,I=i.inChannels,T=i.inHeight,R=i.inWidth,N=i.outChannels,O=i.outHeight,V=i.outWidth,F=i.strideHeight,B=i.strideWidth,U=C-1-i.padInfo.top,P=A-1-i.padInfo.left,L=N/I,H=0;H<k;++H)for(var W=0;W<I;++W)for(var z=0;z<T;++z)for(var q=z-U,re=Math.max(0,Math.ceil(q/F)),de=Math.min(O,(C+q)/F),ye=0;ye<R;++ye){for(var te=ye-P,ie=Math.max(0,Math.ceil(te/B)),fe=Math.min(V,(A+te)/B),Re=0,De=re;De<de;++De)for(var Be=De*F-q,lt=ie;lt<fe;++lt)for(var Y=m*H+g*De+w*lt,ot=x*(C-1-Be)+E*(A-1-(lt*B-te))+_*W,Ke=0;Ke<L;++Ke)Re+=h[Y+(W*L+Ke)]*v[ot+Ke];a[u*H+l*z+c*ye+W]=Re}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,r,i){Le([t,r],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=Xt(i.filterShape,"float32"),c=i.padInfo.left,h=i.padInfo.top,f=i.outChannels/i.inChannels,m=this.bufferSync(t),g=this.bufferSync(r),w=0;w<s;++w)for(var v=Math.max(0,Math.ceil((h-w)/o)),y=Math.min(i.outHeight,(i.inHeight+h-w)/o),x=0;x<u;++x)for(var E=Math.max(0,Math.ceil((c-x)/a)),_=Math.min(i.outWidth,(i.inWidth+c-x)/a),k=0;k<i.outChannels;++k){for(var C=Math.trunc(k/f),A=k%f,I=0,T=0;T<i.batchSize;++T)for(var R=v;R<y;++R)for(var N=w+R*o-h,O=E;O<_;++O){var V=x+O*a-c;I+=m.get(T,N,V,C)*g.get(T,R,O,k)}l.set(I,w,x,C,A)}return l.toTensor()},e.prototype.tile=function(t,r){return Le(t,"tile"),I3(this.bufferSync(t),r)},e.prototype.pad=function(t,r,i){Le(t,"pad");var o=r.map((function(f,m){return f[0]+t.shape[m]+f[1]})),a=r.map((function(f){return f[0]})),s=this.bufferSync(t),u=Xt(o,t.dtype);i!==0&&u.values.fill(i);for(var l=0;l<t.size;l++){var c=s.indexToLoc(l),h=c.map((function(f,m){return f+a[m]}));u.set.apply(u,[s.get.apply(s,c)].concat(h))}return u.toTensor()},e.prototype.gather=function(t,r,i){Le([t,r],"gather");var o=t.shape.slice(),a=this.readSync(r.dataId);o[i]=a.length;for(var s=Xt(o,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l),h=c.slice();h[i]=a[c[i]];var f=u.locToIndex(h);s.values[l]=u.values[f]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,r,i){Le([t],"batchToSpaceND");var o=r.reduce((function(h,f){return h*f})),a=Cm(t.shape,r,o),s=Tm(a.length,r.length),u=Mm(t.shape,r,o),l=l3(i,r.length),c=c3(u,i,r.length);return Co(t.reshape(a),s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,r,i){Le([t],"spaceToBatchND");var o=r.reduce((function(f,m){return f*m})),a=[[0,0]];a.push.apply(a,i);for(var s=1+r.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=Cm(u.shape,r,o,!1),c=Tm(l.length,r.length,!1),h=Mm(u.shape,r,o,!1);return Co(u.reshape(l),c).reshape(h)},e.prototype.maxPool=function(t,r){return Le(t,"maxPool"),g0(this.readSync(t.dataId),t.shape,t.dtype,t.strides,r,"max").toTensor()},e.prototype.maxPoolBackprop=function(t,r,i,o){Le([r,i],"maxPoolBackprop");for(var a=this.readSync(r.dataId),s=Xt(o.outShape,r.dtype,kM(a,r.shape,r.dtype,o).values),u=o.strideHeight,l=o.strideWidth,c=o.dilationHeight,h=o.dilationWidth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=m-1-o.padInfo.left,w=f-1-o.padInfo.top,v=Xt(r.shape,"float32"),y=this.bufferSync(t),x=0;x<o.batchSize;++x)for(var E=0;E<o.inChannels;++E)for(var _=0;_<o.inHeight;++_)for(var k=0;k<o.inWidth;++k){for(var C=_-w,A=k-g,I=0,T=0;T<f;T+=c){var R=(C+T)/u;if(!(R<0||R>=o.outHeight||Math.floor(R)!==R))for(var N=0;N<m;N+=h){var O=(A+N)/l;if(!(O<0||O>=o.outWidth||Math.floor(O)!==O)){var V=f*m-1-s.get(x,R,O,E)===T*m+N?1:0;V!==0&&(I+=y.get(x,R,O,E)*V)}}}v.set(I,x,_,k,E)}return v.toTensor()},e.prototype.avgPoolBackprop=function(t,r,i){Le([t,r],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,f=i.effectiveFilterWidth,m=f-1-i.padInfo.left,g=h-1-i.padInfo.top,w=Xt(r.shape,"float32"),v=1/(s*u),y=this.bufferSync(t),x=0;x<i.batchSize;++x)for(var E=0;E<i.inChannels;++E)for(var _=0;_<i.inHeight;++_)for(var k=0;k<i.inWidth;++k){for(var C=_-g,A=k-m,I=0,T=0;T<h;T+=l){var R=(C+T)/o;if(!(R<0||R>=i.outHeight||Math.floor(R)!==R))for(var N=0;N<f;N+=c){var O=(A+N)/a;O<0||O>=i.outWidth||Math.floor(O)!==O||(I+=y.get(x,R,O,E))}}w.set(I*v,x,_,k,E)}return w.toTensor()},e.prototype.pool3d=function(t,r,i){Le(t,"pool3d");for(var o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.front,w=r.padInfo.top,v=r.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),E=Xt(r.outShape,t.dtype),_=E.values,k=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],C=r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[3]*r.outShape[4],I=r.outShape[4],T=0;T<r.batchSize;++T)for(var R=T*k,N=T*t.strides[0],O=0;O<r.inChannels;++O)for(var V=0;V<r.outDepth;++V){for(var F=V*o-g,B=F;B<0;)B+=u;for(var U=Math.min(r.inDepth,h+F),P=R+V*C,L=0;L<r.outHeight;++L){for(var H=L*a-w,W=H;W<0;)W+=l;for(var z=Math.min(r.inHeight,f+H),q=P+L*A,re=0;re<r.outWidth;++re){for(var de=re*s-v,ye=de;ye<0;)ye+=c;for(var te=Math.min(r.inWidth,m+de),ie=q+re*I,fe=y,Re=0,De=0,Be=B;Be<U;Be+=u){for(var lt=N+Be*t.strides[1],Y=W;Y<z;Y+=l){for(var ot=lt+Y*t.strides[2],Ke=ye;Ke<te;Ke+=c){var Xe=x[ot+Ke*t.strides[3]+O];if(i==="max"&&Xe>fe?fe=Xe:i==="avg"&&(Re+=Xe,De++),isNaN(fe))break}if(isNaN(fe))break}if(isNaN(fe))break}_[ie+O]=i==="avg"?Re/De:fe}}}return E.toTensor()},e.prototype.avgPool3d=function(t,r){return Le(t,"avgPool3d"),this.pool3d(t,r,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,r,i){Le([t,r],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=i.dilationDepth,f=i.dilationHeight,m=i.dilationWidth,g=i.effectiveFilterDepth,w=i.effectiveFilterHeight,v=i.effectiveFilterWidth,y=g-1-i.padInfo.front,x=v-1-i.padInfo.left,E=w-1-i.padInfo.top,_=Xt(r.shape,"float32"),k=1/(u*l*c),C=this.bufferSync(t),A=0;A<i.batchSize;++A)for(var I=0;I<i.inChannels;++I)for(var T=0;T<i.inDepth;++T)for(var R=0;R<i.inHeight;++R)for(var N=0;N<i.inWidth;++N){for(var O=T-y,V=R-E,F=N-x,B=0,U=0;U<g;U+=h){var P=(O+U)/o;if(!(P<0||P>=i.outDepth||Math.floor(P)!==P))for(var L=0;L<w;L+=f){var H=(V+L)/a;if(!(H<0||H>=i.outHeight||Math.floor(H)!==H))for(var W=0;W<v;W+=m){var z=(F+W)/s;z<0||z>=i.outWidth||Math.floor(z)!==z||(B+=C.get(A,P,H,z,I))}}}_.set(B*k,A,T,R,N,I)}return _.toTensor()},e.prototype.maxPool3d=function(t,r){return Le(t,"maxPool3d"),this.pool3d(t,r,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,r){for(var i=Xt(r.outShape,"int32"),o=r.strideDepth,a=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,l=r.dilationHeight,c=r.dilationWidth,h=r.effectiveFilterDepth,f=r.effectiveFilterHeight,m=r.effectiveFilterWidth,g=r.padInfo.front,w=r.padInfo.top,v=r.padInfo.left,y=this.bufferSync(t),x=0;x<r.batchSize;++x)for(var E=0;E<r.inChannels;++E)for(var _=0;_<r.outDepth;++_){for(var k=_*o-g,C=k;C<0;)C+=u;for(var A=Math.min(r.inDepth,h+k),I=0;I<r.outHeight;++I){for(var T=I*a-w,R=T;R<0;)R+=l;for(var N=Math.min(r.inHeight,f+T),O=0;O<r.outWidth;++O){for(var V=O*s-v,F=V;F<0;)F+=c;for(var B=Math.min(r.inWidth,m+V),U=Number.NEGATIVE_INFINITY,P=-1,L=C;L<A;L+=u)for(var H=L-k,W=R;W<N;W+=l)for(var z=W-T,q=F;q<B;q+=c){var re=q-V,de=y.get(x,L,W,q,E);de>=U&&(U=de,P=H*f*m+z*f+re)}i.set(P,x,_,I,O,E)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,r,i,o){Le([r,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(r,o),s=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,f=o.dilationWidth,m=o.effectiveFilterDepth,g=o.effectiveFilterHeight,w=o.effectiveFilterWidth,v=m-1-o.padInfo.front,y=w-1-o.padInfo.left,x=g-1-o.padInfo.top,E=Xt(r.shape,"float32"),_=this.bufferSync(a),k=this.bufferSync(t),C=0;C<o.batchSize;++C)for(var A=0;A<o.inChannels;++A)for(var I=0;I<o.inDepth;++I)for(var T=0;T<o.inHeight;++T)for(var R=0;R<o.inWidth;++R){for(var N=I-v,O=T-x,V=R-y,F=0,B=0;B<m;B+=c){var U=(N+B)/s;if(!(U<0||U>=o.outDepth||Math.floor(U)!==U))for(var P=0;P<g;P+=h){var L=(O+P)/u;if(!(L<0||L>=o.outHeight||Math.floor(L)!==L))for(var H=0;H<w;H+=f){var W=(V+H)/l;if(!(W<0||W>=o.outWidth||Math.floor(W)!==W)){var z=m*g*w-1-_.get(C,U,L,W,A)===B*g*w+P*w+H?1:0;z!==0&&(F+=k.get(C,U,L,W,A)*z)}}}}E.set(F,C,I,T,R,A)}return E.toTensor()},e.prototype.cast=function(t,r){return T3(t,r,this)},e.prototype.reshape=function(t,r){return p0(t,r)},e.prototype.avgPool=function(t,r){return Le(t,"avgPool"),Le(t,"maxPool"),g0(this.readSync(t.dataId),t.shape,t.dtype,t.strides,r,"avg").toTensor().toFloat()},e.prototype.resizeBilinear=function(t,r,i,o){Le(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),f=new Float32Array(bt([s,r,i,c])),m=[o&&r>1?u-1:u,o&&i>1?l-1:l],g=[o&&r>1?r-1:r,o&&i>1?i-1:i],w=0,v=m[0]/g[0],y=m[1]/g[1],x=0;x<s;x++)for(var E=0;E<r;E++)for(var _=v*E,k=Math.floor(_),C=_-k,A=Math.min(u-1,Math.ceil(_)),I=x*t.strides[0]+k*t.strides[1],T=x*t.strides[0]+A*t.strides[1],R=0;R<i;R++)for(var N=y*R,O=Math.floor(N),V=N-O,F=Math.min(l-1,Math.ceil(N)),B=I+O*t.strides[2],U=T+O*t.strides[2],P=I+F*t.strides[2],L=T+F*t.strides[2],H=0;H<c;H++){var W=h[B+H],z=h[U+H],q=W+(h[P+H]-W)*V,re=q+(z+(h[L+H]-z)*V-q)*C;f[w++]=re}return Cr(f,[s,r,i,c])},e.prototype.resizeBilinearBackprop=function(t,r,i){Le([t,r],"resizeBilinearBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],f=c[2],m=new Float32Array(a*s*u*l),g=[i&&h>1?s-1:s,i&&f>1?u-1:u],w=[i&&h>1?h-1:h,i&&f>1?f-1:f],v=g[0]/w[0],y=g[1]/w[1],x=this.readSync(t.dataId),E=0,_=0;_<a;_++)for(var k=_*r.strides[0],C=0;C<h;C++)for(var A=C*v,I=Math.floor(A),T=Math.min(Math.ceil(A),s-1),R=k+I*r.strides[1],N=k+T*r.strides[1],O=A-I,V=1-O,F=0;F<f;F++)for(var B=F*y,U=Math.floor(B),P=Math.min(Math.ceil(B),u-1),L=B-U,H=1-L,W=R+U*r.strides[2],z=R+P*r.strides[2],q=N+U*r.strides[2],re=N+P*r.strides[2],de=V*H,ye=V*L,te=O*H,ie=O*L,fe=0;fe<l;fe++){var Re=x[E++];m[W+fe]+=Re*de,m[z+fe]+=Re*ye,m[q+fe]+=Re*te,m[re+fe]+=Re*ie}return ta(m,[a,u,s,l],r.dtype)},e.prototype.resizeNearestNeighbor=function(t,r,i,o){Le(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),f=new Float32Array(s*r*i*c),m=[o&&r>1?u-1:u,o&&i>1?l-1:l],g=[o&&r>1?r-1:r,o&&i>1?i-1:i],w=m[0]/g[0],v=m[1]/g[1],y=0,x=0;x<s;x++)for(var E=x*t.strides[0],_=0;_<r;_++)for(var k=w*_,C=E+Math.min(u-1,o?Math.round(k):Math.floor(k))*t.strides[1],A=0;A<i;A++)for(var I=v*A,T=C+Math.min(l-1,o?Math.round(I):Math.floor(I))*t.strides[2],R=0;R<c;R++){var N=h[T+R];f[y++]=N}return Cr(f,[s,r,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,r,i){Le([t,r],"resizeNearestNeighborBackprop");for(var o=r.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],f=c[2],m=new Float32Array(a*s*u*l),g=this.readSync(t.dataId),w=[i&&h>1?s-1:s,i&&f>1?u-1:u],v=[i&&h>1?h-1:h,i&&f>1?f-1:f],y=w[0]/v[0],x=w[1]/v[1],E=1/y,_=1/x,k=2*Math.ceil(E)+2,C=2*Math.ceil(_)+2,A=0;A<a;A++)for(var I=A*r.strides[0],T=0;T<s;T++)for(var R=I+T*r.strides[1],N=Math.floor(T*E),O=Math.floor(N-k/2),V=0;V<u;V++)for(var F=R+V*r.strides[2],B=Math.floor(V*_),U=Math.floor(B-C/2),P=0;P<l;P++){for(var L=0,H=0;H<k;H++){var W=H+O;if(!(W<0||W>=h)){var z=I+W*t.strides[1],q=W*y;if(T===Math.min(s-1,i?Math.round(q):Math.floor(q)))for(var re=0;re<C;re++){var de=re+U;if(!(de<0||de>=f)){var ye=z+de*t.strides[2],te=de*x;V===Math.min(u-1,i?Math.round(te):Math.floor(te))&&(L+=g[ye+P])}}}}m[F+P]=L}return ta(m,r.shape,r.dtype)},e.prototype.batchNormalization=function(t,r,i,o,a,s){Le([t,r,i,a,s],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=this.readSync(i.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),m=new Float32Array(u.length),g=f.length,w=h.length,v=c.length,y=l.length,x=0,E=0,_=0,k=0,C=0;C<u.length;++C)m[C]=f[x++]+(u[C]-l[E++])*h[_++]/Math.sqrt(c[k++]+o),x>=g&&(x=0),E>=y&&(E=0),_>=w&&(_=0),k>=v&&(k=0);return ta(m,t.shape)},e.prototype.localResponseNormalization4D=function(t,r,i,o,a){Le(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,l=this.readSync(t.dataId),c=t.size,h=new Float32Array(c);function f(v){for(var y=v%s,x=v-y+Math.max(0,y-r),E=v-y+Math.min(y+r,u),_=0;x<=E;x++){var k=l[x];_+=k*k}return _}for(var m=0;m<c;m++){var g=f(m),w=l[m]*Math.pow(i+o*g,-a);h[m]=w}return ta(h,t.shape)},e.prototype.LRNGrad=function(t,r,i,o,a,s,u){Le(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),h=this.readSync(r.dataId),f=this.readSync(i.dataId),m=new Float32Array(t.size),g=t.size,w=0;w<g;w++){for(var v=w%l,y=w-v+Math.max(0,v-o),x=w-v+Math.min(l,v+o+1),E=0,_=y;_<x;_++)E+=Math.pow(h[_],2);for(E=s*E+a,_=y;_<x;_++){var k=-2*s*u*h[_]*f[w]/E;w===_&&(k+=Math.pow(E,-u)),k*=c[w],m[_]+=k}}return ta(m,t.shape)},e.prototype.multinomial=function(t,r,i,o){Le(t,"multinomial");for(var a=r?t:ag(t),s=a.shape[0],u=a.shape[1],l=Xn([s,i],"int32"),c=this.readSync(l.dataId),h=this.readSync(a.dataId),f=0;f<s;++f){var m=f*u,g=new Float32Array(u-1);g[0]=h[m];for(var w=1;w<g.length;++w)g[w]=g[w-1]+h[m+w];for(var v=sg(o.toString()),y=f*i,x=0;x<i;++x){var E=v();c[y+x]=g.length;for(var _=0;_<g.length;_++)if(E<g[_]){c[y+x]=_;break}}}return l},e.prototype.oneHot=function(t,r,i,o){Le(t,"oneHot");var a=new Float32Array(t.size*r);a.fill(o);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<r&&(a[u*r+s[u]]=i);return Yu(a,[t.size,r],"int32")},e.prototype.nonMaxSuppression=function(t,r,i,o,a){return Le(t,"nonMaxSuppression"),Ww(this.readSync(t.dataId),this.readSync(r.dataId),i,o,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,r){for(var i=t.shape[0],o=t.shape[1],a=Xt(t.shape,"float32"),s=Xt(t.shape,"float32"),u=to(t).as2D(i,o),l=ia(t).as2D(i,o),c=0;c<i;c++)for(var h=u.slice([c,0],[1,o]),f=l.slice([c,0],[1,o]),m=Er(h,f),g=this.readSync(this.fftImpl(m,r).dataId),w=0;w<o;w++){var v=HS(g,w);a.values[c*o+w]=v.real,s.values[c*o+w]=v.imag}return Er(a.toTensor(),s.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,r){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,r).as2D(t.shape[0],t.shape[1]);return r&&(a=Er(to(a).div(Ct(o)),ia(a).div(Ct(o)))),a}var s=this.readSync(t.dataId),u=(function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],h[f/2]=l[f+1];return{real:c,imag:h}})(this.fourierTransformByMatmul(s,o,r));return Er(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,r,i){if(r===1)return t;var o=this.readSync(t.dataId),a=r/2,s=(function(y){for(var x=Math.ceil(y.length/4),E=new Float32Array(x),_=new Float32Array(x),k=0;k<y.length;k+=4)E[Math.floor(k/4)]=y[k],_[Math.floor(k/4)]=y[k+1];return{real:E,imag:_}})(o),u=Er(s.real,s.imag).as1D(),l=(function(y){for(var x=Math.floor(y.length/4),E=new Float32Array(x),_=new Float32Array(x),k=2;k<y.length;k+=4)E[Math.floor(k/4)]=y[k],_[Math.floor(k/4)]=y[k+1];return{real:E,imag:_}})(o),c=Er(l.real,l.imag).as1D();u=this.fftRadix2(u,a,i),c=this.fftRadix2(c,a,i);var h=(function(y,x){for(var E=new Float32Array(y/2),_=new Float32Array(y/2),k=0;k<Math.ceil(y/2);k++){var C=(x?2:-2)*Math.PI*(k/y);E[k]=Math.cos(C),_[k]=Math.sin(C)}return{real:E,imag:_}})(r,i),f=Er(h.real,h.imag).mul(c),m=u.add(f),g=u.sub(f),w=to(m).concat(to(g)),v=ia(m).concat(ia(g));return Er(w,v).as1D()},e.prototype.fourierTransformByMatmul=function(t,r,i){for(var o=new Float32Array(2*r),a=0;a<r;a++){for(var s=0,u=0,l=0;l<r;l++){var c=c6(a*l,r,i),h=HS(t,l);s+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}i&&(s/=r,u/=r),l6(o,s,u,a)}return o},e.prototype.depthToSpace=function(t,r,i){K(i==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i})),K(r>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+r}));for(var o=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],l=a*r,c=s*r,h=u/(r*r),f=this.readSync(t.dataId),m=new Float32Array(o*l*c*h),g=0,w=0;w<o;++w)for(var v=0;v<l;++v)for(var y=Math.floor(v/r),x=v%r,E=0;E<c;++E)for(var _=Math.floor(E/r),k=(x*r+E%r)*h,C=0;C<h;++C){var A=C+k+u*(_+s*(y+a*w));m[g++]=f[A]}return ta(m,[o,l,c,h])},e.prototype.broadcastedBinaryOp=function(t,r,i,o){var a=on(t.shape,r.shape),s=Xt(a,i),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=Hs(t.shape,a),h=Hs(r.shape,a),f=s.values;if(c.length+h.length===0)for(var m=0;m<f.length;++m)f[m]=o(u[m%u.length],l[m%l.length]);else{var g=this.bufferSync(t),w=this.bufferSync(r),v=function(y){var x=s.indexToLoc(y),E=x.slice(-t.rank);c.forEach((function(A){return E[A]=0}));var _=g.locToIndex(E),k=x.slice(-r.rank);h.forEach((function(A){return k[A]=0}));var C=w.locToIndex(k);f[y]=o(u[_],l[C])};for(m=0;m<f.length;++m)v(m)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,r,i){var o=on(t.shape,r.shape),a=Xt(o,"float32"),s=Xt(o,"float32"),u=this.readSync(t.dataId),l=this.readSync(r.dataId),c=Hs(t.shape,o),h=Hs(r.shape,o),f=a.values,m=s.values;if(c.length+h.length===0)for(var g=0;g<f.length;g++){var w=g%u.length,v=g%l.length,y=i(u[2*w],u[2*w+1],l[2*v],l[2*v+1]);f[g]=y.real,m[g]=y.imag}else{var x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),E=this.bufferSync(this.data.get(r.dataId).complexTensors.real),_=function(k){var C=a.indexToLoc(k),A=C.slice(-t.rank);c.forEach((function(O){return A[O]=0}));var I=x.locToIndex(A),T=C.slice(-r.rank);h.forEach((function(O){return T[O]=0}));var R=E.locToIndex(T),N=i(u[2*I],u[2*I+1],l[2*R],l[2*R+1]);f[k]=N.real,m[k]=N.imag};for(g=0;g<f.length;g++)_(g)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,r,i){return A3(t,r,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,r,i,o,a,s){for(var u=t.shape,l=u[0],c=u[1],h=u[2],f=u[3],m=r.shape[0],g=o[0],w=o[1],v=Xt([m,g,w,f],"float32"),y=this.readSync(r.dataId),x=this.readSync(i.dataId),E=this.readSync(t.dataId),_=t.strides,k=v.strides,C=0;C<m;C++){var A=4*C,I=y[A],T=y[A+1],R=y[A+2],N=y[A+3],O=x[C];if(!(O>=l))for(var V=g>1?(R-I)*(c-1)/(g-1):0,F=w>1?(N-T)*(h-1)/(w-1):0,B=0;B<g;B++){var U=g>1?I*(c-1)+B*V:.5*(I+R)*(c-1);if(U<0||U>c-1)for(var P=0;P<w;P++)for(var L=0;L<f;L++){var H=L+P*k[2]+B*k[1]+C*k[0];v.values[H]=s}else if(a==="bilinear"){var W=Math.floor(U),z=Math.ceil(U),q=U-W;for(P=0;P<w;P++)if((Be=w>1?T*(h-1)+P*F:.5*(T+N)*(h-1))<0||Be>h-1)for(L=0;L<f;L++)H=L+P*k[2]+B*k[1]+C*k[0],v.values[H]=s;else{var re=Math.floor(Be),de=Math.ceil(Be),ye=Be-re;for(L=0;L<f;L++){var te=E[H=L+re*_[2]+W*_[1]+O*_[0]],ie=E[H=L+de*_[2]+W*_[1]+O*_[0]],fe=E[H=L+re*_[2]+z*_[1]+O*_[0]],Re=te+(ie-te)*ye,De=fe+(E[H=L+de*_[2]+z*_[1]+O*_[0]]-fe)*ye;H=L+P*k[2]+B*k[1]+C*k[0],v.values[H]=Re+(De-Re)*q}}}else for(P=0;P<w;++P){var Be;if((Be=w>1?T*(h-1)+P*F:.5*(T+N)*(h-1))<0||Be>h-1)for(L=0;L<f;L++)H=L+P*k[2]+B*k[1]+C*k[0],v.values[H]=s;else{var lt=Math.round(Be),Y=Math.round(U);for(L=0;L<f;L++){var ot=L+lt*_[2]+Y*_[1]+O*_[0],Ke=L+P*k[2]+B*k[1]+C*k[0];v.values[Ke]=E[ot]}}}}}return v.toTensor()},e.prototype.sparseToDense=function(t,r,i,o){var a=Am(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,h=a.outputSize;return this.scatter(t,r,i,h,l,u,s,c,o,!1)},e.prototype.gatherND=function(t,r){var i=r.shape,o=i[i.length-1],a=w3(t,r),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return Cr([],s,t.dtype);for(var h=new ed([u,l],t.dtype),f=this.readSync(r.dataId),m=this.readSync(t.dataId),g=0;g<u;g++){for(var w=[],v=0,y=0;y<o;y++){var x=f[g*o+y];v+=x*c[y],w.push(x)}if(v<0||v>=t.size/l)throw new Error("Invalid indices: "+w+" does not index into "+t.shape);for(var E=0;E<l;E++)h.values[g*l+E]=m[v*l+E]}return h.toTensor().reshape(s)},e.prototype.scatterND=function(t,r,i){var o=Am(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=Ct(0);return this.scatter(t,r,i,c,u,s,a,l,h,!0)},e.prototype.fill=function(t,r,i){var o=bm(i=i||Ed(r),bt(t));return o.fill(r),le.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var r=bm(t.dtype,bt(t.shape));return this.makeOutput(r,t.shape,t.dtype)},e.prototype.linspace=function(t,r,i){return M3(t,r,i)},e.prototype.scatter=function(t,r,i,o,a,s,u,l,c,h){var f=[o/a,a],m=this.readSync(t.dataId),g=this.readSync(r.dataId);if(o===0)return Cr([],i,r.dtype);var w=new ed(f,r.dtype);w.values.fill(this.readSync(c.dataId)[0]);for(var v=0;v<s;v++){for(var y=[],x=0,E=0;E<u;E++){var _=m[v*u+E];y.push(_),x+=_*l[E]}if(x<0||x>=o/a)throw new Error("Invalid indices: "+y+" does not index into "+i);for(var k=0;k<a;k++)h?w.values[x*a+k]+=g[v*a+k]:w.values[x*a+k]=r.rank===0?g[0]:g[v*a+k]}return w.toTensor().reshape(i)},e})(k3);function CM(n,e){return{kernelName:n,backendName:"cpu",kernelFunc:function(t){var r=t.inputs,i=t.backend,o=r,a=o.a,s=o.b,u=i;Le([a,s],n);var l=u.data.get(a.dataId).values,c=u.data.get(s.dataId).values,h=e(a.shape,s.shape,l,c,a.dtype),f=h[0],m=h[1];return{dataId:u.write(f,m,a.dtype),shape:m,dtype:a.dtype}}}}function TM(n){return function(e,t,r,i,o){var a=on(e,t),s=a.length,u=Ui(a),l=Oc(o,bt(a)),c=e.length,h=t.length,f=Ui(e),m=Ui(t),g=Hs(e,a),w=Hs(t,a);if(g.length+w.length===0)for(var v=0;v<l.length;++v)l[v]=n(r[v%r.length],i[v%i.length]);else{var y=function(x){var E=JT(x,s,u),_=E.slice(-c);g.forEach((function(I){return _[I]=0}));var k=s0(_,c,f),C=E.slice(-h);w.forEach((function(I){return C[I]=0}));var A=s0(C,h,m);l[x]=n(r[k],i[A])};for(v=0;v<l.length;++v)y(v)}return[l,a]}}le.registerBackend("cpu",(function(){return new c9}),1);var h9=TM((function(n,e){return n/e})),d9=CM(rg,h9),f9={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t,a=o.filterSize,s=o.strides,u=o.pad,l=o.includeBatchInIndex,c=r;Le(i,"MaxPoolWithArgmax");var h=c.data.get(i.dataId).values,f=el(i.shape,a,s,[1,1],u),m=(function(x,E,_,k,C){var A=g0(x,0,_,Ui(E),C,"max"),I=kM(x,E,_,C,!0,k);return[A.values,I.values]})(h,i.shape,i.dtype,l,f),g=m[0],w=m[1],v=c.write(g,f.outShape,i.dtype),y=c.write(w,f.outShape,i.dtype);return[{dataId:v,shape:f.outShape,dtype:i.dtype},{dataId:y,shape:f.outShape,dtype:"int32"}]}},p9={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,f=t;Le(o,"NonMaxSuppressionWithScore");var m=Hw(f.data.get(o.dataId).values,f.data.get(a.dataId).values,u,l,c,h);return[m.selectedIndices,m.selectedScores]}},m9={kernelName:"Square",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t;Le(r,"square");for(var o=i.data.get(r.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},g9=TM((function(n,e){var t=n-e;return t*t}));function MM(n,e,t,r,i){for(var o=bt(e),a=e.length,s=Ui(e),u=Ui(i),l=Oc(t,bt(i)),c=0;c<o;++c){for(var h=JT(c,a,s),f=new Array(h.length),m=0;m<f.length;m++)f[m]=h[r[m]];l[s0(f,a,u)]=n[c]}return l}for(var Jy=0,cE=[p9,m9,CM(ig,g9),d9,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t.perm,a=r;Le(i,"transpose");for(var s=i.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=i.shape[o[l]];var c=MM(a.data.get(i.dataId).values,i.shape,i.dtype,o,u);return{dataId:a.write(c,u,i.dtype),shape:u,dtype:i.dtype}}},f9];Jy<cE.length;Jy++)VT(cE[Jy]);var zl,v9=function(n){this.variableNames=["A"];var e=Wr(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+r+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},y9=function(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Wr(),t=n[0],r=n[1];this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+r+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `},b9=function(n,e){this.variableNames=["A"];for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];this.outputShape=t,this.rank=t.length;var i=Fn(this.rank),o=(function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},w9=function(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(n.length),r=0;r<t.length;r++)t[r]=n[e[r]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Fn(this.rank),o=N3("rc",this.rank),a=new Array(this.rank);for(r=0;r<e.length;r++)a[e[r]]=o[r];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `};for(var Qy=0,hE=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs,i=e.pixels,o=r.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],h=[c,l],f=[c,l,o];(s||a)&&(zl==null&&(zl=document.createElement("canvas").getContext("2d")),zl.canvas.width=l,zl.canvas.height=c,zl.drawImage(i,0,0,l,c),i=zl.canvas);var m=t.makeTensorInfo(h,"int32");t.texData.get(m.dataId).usage=Oi.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),i);var g=Ne().getBool("WEBGL_PACK")?new y9(f):new v9(f),w=t.runWebGLProgram(g,[m],"int32");return t.disposeData(m.dataId),w}},{kernelName:rg,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e;return(function(i,o,a){var s=new qn(A6,i.shape,o.shape);return Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(s=new Jo(I6,i.shape,o.shape,!0)),a.runWebGLProgram(s,[i,o],"float32")})(r.a,r.b,t)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=n.attrs;Sm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=r,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,f=t,m=Hw(f.readSync(o.dataId),f.readSync(a.dataId),u,l,c,h);return[m.selectedIndices,m.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e.x,i=t,o=new Kt(r.shape,"return x * x;");return i.runWebGLProgram(o,[r],r.dtype)}},{kernelName:ig,backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.backend,r=e,i=r.a,o=r.b,a=t,s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Jo("return (a - b) * (a - b);",i.shape,o.shape):new qn("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(n){for(var e,t=n.inputs,r=n.attrs,i=n.backend,o=t.x,a=r.perm,s=i,u=o.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=o.shape[a[c]];if(s.shouldExecuteOnCPU([o])){var h=MM(s.texData.get(o.dataId).values,o.shape,o.dtype,a,l);e=s.makeTensorInfo(l,o.dtype),s.texData.get(e.dataId).values=h}else e=(function(f,m,g){var w=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new w9(f.shape,m):new b9(f.shape,m);return g.runWebGLProgram(w,[f],f.dtype)})(o,a,s);return e}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(n){var e=n.inputs,t=n.attrs,r=n.backend,i=e.x,o=t,a=o.filterSize,s=o.strides,u=o.pad,l=o.includeBatchInIndex,c=r;K(i.shape.length===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."}));var h=[1,1];K(ni(s,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+h+"'"}));var f=el(i.shape,a,s,h,u),m=(function(g,w,v,y){var x=new Xh(v,"max",!1),E=y.runWebGLProgram(x,[g],"float32");return x=new Xh(v,"max",!0,!0,w),[E,y.runWebGLProgram(x,[g],"float32")]})(i,l,f,c);return[m[0],m[1]]}}];Qy<hE.length;Qy++)VT(hE[Qy]);for(var Zy=0,dE=[{kernelName:h3,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=on(t.shape,r.shape);return{a:function(){var o=n,a=ar(t.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(t.shape)},b:function(){var o=n,a=ar(r.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(n,e){var t={};return e.forEach((function(r,i){t[i]=function(){return n.clone()}})),t}},{kernelName:d3,gradFunc:function(n,e,t){for(var r=t,i=r.inputShape,o=r.shape,a=Array.from(o),s=i.length-1;s>=0;s--)if(i[s]===o[s])a[s]=1;else if(i[s]!==1)throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+o+"].");var u=[];for(s=0;s<a.length;s++)a[s]>1&&u.push(s);return{x:function(){return n.sum(u,!0)}}}},{kernelName:rg,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=on(t.shape,r.shape);return{a:function(){var o=Js(n,r.toFloat()),a=ar(t.shape,i);return a.length>0?Us(o,a).reshape(t.shape):o},b:function(){var o=n.mul(t.toFloat()),a=ar(r.shape,i);a.length>0&&(o=Us(o,a).reshape(r.shape));var s=tM(r);return Lw(Js(o,s.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(n,e,t){var r=t.varianceEpsilon,i=e[0],o=e[1],a=e[2],s=e[3],u=V3(i),l=s??Ct(1),c=ar(o.shape,u.shape),h=[];if(o.rank===1){for(var f=0;f<u.shape.length-1;++f)h.push(u.shape[f]);h.push(1)}var m=Fo(i,o),g=$n(n,l),w=v3(uo(a,Ct(r))),v=$n($n($n(w,w),w),Ct(-.5));return{x:function(){return o.rank===1?Oa($n($n(n,Ec(w.as4D(1,1,1,o.shape[0]),h)),l),i.shape):Oa($n($n(n,w),l),i.shape)},mean:function(){var y=$n($n(w,Ct(-1)),g);return o.rank===1&&(y=Us(y,c)),Oa(y,o.shape)},variance:function(){var y=$n($n(v,m),g);return o.rank===1&&(y=Us(y,c)),Oa(y,o.shape)},scale:function(){var y=$n(m,w),x=$n(n,y);return o.rank===1&&(x=Us(x,c)),Oa(x,o.shape)},offset:function(){var y=n;return o.rank===1&&(y=Us(y,c)),Oa(y,o.shape)}}}},{kernelName:p3,gradFunc:function(n){return{x:function(){return n.toFloat()}}}},{kernelName:f3,inputsToSave:["indices"],gradFunc:function(n,e){var t=e[0];return{indices:function(){return Xn(t.shape,"float32")}}}},{kernelName:g3,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],i=t.paddings.map((function(o){return o[0]}));return{x:function(){return n.slice(i,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(n,e){var t=e[0];return{x:function(){return n.mul(t.toFloat().mul(2))}}}},{kernelName:ig,inputsToSave:["a","b"],gradFunc:function(n,e){var t=e[0],r=e[1],i=Ct(2);return{a:function(){return $n(n,$n(i,Fo(t,r)))},b:function(){return $n(n,$n(i,Fo(r,t)))}}}},{kernelName:m3,inputsToSave:["x"],gradFunc:function(n,e,t){var r=e[0],i=t.reps;return{x:function(){var o=hn(r);if(r.rank===1)for(var a=0;a<i[0];++a)o=o.add(n.slice([a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(a=0;a<i[0];++a)for(var s=0;s<i[1];++s)o=o.add(n.slice([a*r.shape[0],s*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(a=0;a<i[0];++a)for(s=0;s<i[1];++s)for(var u=0;u<i[2];++u)o=o.add(n.slice([a*r.shape[0],s*r.shape[1],u*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(r.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(a=0;a<i[0];++a)for(s=0;s<i[1];++s)for(u=0;u<i[2];++u)for(var l=0;l<i[3];++l)o=o.add(n.slice([a*r.shape[0],s*r.shape[1],u*r.shape[2],l*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return o}}}},{kernelName:"Transpose",gradFunc:function(n,e,t){var r=Fw(t.perm);return{x:function(){return Co(n,r)}}}}];Zy<dE.length;Zy++)aL(dE[Zy]);var _9=(function(){function n(){}return n.prototype.fetch=function(e,t){return fetch(e,t)},n.prototype.now=function(){return performance.now()},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},n})();Ne().get("IS_BROWSER")&&Ne().setPlatform("browser",new _9);var eb,x9=function(){return require("node-fetch")},S9=(function(){function n(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return n.prototype.fetch=function(e,t){return Ne().global.fetch!=null?Ne().global.fetch(e,t):(eb==null&&(eb=x9()),eb(e,t))},n.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},n.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},n.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},n})();Ne().get("IS_NODE")&&Ne().setPlatform("node",new S9);var v0={float32:4,int32:4,uint16:2,uint8:1,bool:1},Om=4;function RM(n,e){for(var t={},r=0,i=function(s){var u=s.name,l=s.dtype,c=s.shape,h=bt(c),f=void 0;if("quantization"in s){var m=s.quantization;if(m.dtype!=="uint8"&&m.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+m.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var g=v0[m.dtype],w=n.slice(r,r+h*g),v=m.dtype==="uint8"?new Uint8Array(w):new Uint16Array(w);if(l==="float32")f=Float32Array.from(v,(function(C){return C*m.scale+m.min}));else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(v,(function(C){return Math.round(C*m.scale+m.min)}))}r+=h*g}else if(l==="string"){var y=bt(s.shape);f=[];for(var x=0;x<y;x++){var E=new Uint32Array(n.slice(r,r+Om))[0];r+=Om;var _=new Uint8Array(n.slice(r,r+E));f.push(_),r+=E}}else{var k=v0[l];if(w=n.slice(r,r+h*k),l==="float32")f=new Float32Array(w);else if(l==="int32")f=new Int32Array(w);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(w)}r+=h*k}t[u]=Cr(f,c,l)},o=0,a=e;o<a.length;o++)i(a[o]);return t}function E9(n){if(n===null)throw new Error("Invalid input value: "+JSON.stringify(n));var e=0,t=[];n.forEach((function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)}));var r=new Uint8Array(e),i=0;return t.forEach((function(o){r.set(new Uint8Array(o.buffer),i),i+=o.byteLength})),r.buffer}var y0=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function fE(n){return y0?Buffer.byteLength(n):new Blob([n]).size}function o_(n){var e=0;n.forEach((function(i){e+=i.byteLength}));var t=new Uint8Array(e),r=0;return n.forEach((function(i){t.set(new Uint8Array(i),r),r+=i.byteLength})),t.buffer}function pE(n){for(n=n.trim();n.endsWith("/");)n=n.slice(0,n.length-1);var e=n.split("/");return e[e.length-1]}function Ad(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:fE(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:fE(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:n.weightData.byteLength}}var Li=(function(){function n(){this.saveRouters=[],this.loadRouters=[]}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerSaveRouter=function(e){n.getInstance().saveRouters.push(e)},n.registerLoadRouter=function(e){n.getInstance().loadRouters.push(e)},n.getSaveHandlers=function(e){return n.getHandlers(e,"save")},n.getLoadHandlers=function(e,t){return n.getHandlers(e,"load",t)},n.getHandlers=function(e,t,r){var i=[];return(t==="load"?n.getInstance().loadRouters:n.getInstance().saveRouters).forEach((function(o){var a=o(e,r);a!==null&&i.push(a)})),i},n})(),kc="://",js=(function(){function n(){this.managers={}}return n.getInstance=function(){return n.instance==null&&(n.instance=new n),n.instance},n.registerManager=function(e,t){K(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(kc)&&(e=e.slice(0,e.indexOf(kc))),K(e.length>0,(function(){return"scheme must not be an empty string."}));var r=n.getInstance();K(r.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=t},n.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},n.getSchemes=function(){return Object.keys(this.getInstance().managers)},n})();function Kp(n){if(n.indexOf(kc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+js.getSchemes().join(","));return{scheme:n.split(kc)[0],path:n.split(kc)[1]}}function mE(n,e,t){return t===void 0&&(t=!1),wt(this,void 0,void 0,(function(){var r,i,o,a,s,u,l,c,h;return _t(this,(function(f){switch(f.label){case 0:return K(n!==e,(function(){return"Old path and new path are the same: '"+n+"'"})),K((r=Li.getLoadHandlers(n)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+n+"."})),K(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+n+"."})),i=r[0],K((o=Li.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),K(o.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),a=o[0],s=Kp(n).scheme,u=Kp(n).path,l=s===Kp(n).scheme,[4,i.load()];case 1:return c=f.sent(),t&&l?[4,js.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(c)];case 4:return h=f.sent(),!t||l?[3,6]:[4,js.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var ju="models_store",Gs="model_info_store";function AM(){if(!Ne().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var n=window||self,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function b0(n){var e=n.result;e.createObjectStore(ju,{keyPath:"modelPath"}),e.createObjectStore(Gs,{keyPath:"modelPath"})}var Cc=(function(){function n(e){if(this.indexedDB=AM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return n.prototype.save=function(e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},n.prototype.load=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},n.prototype.databaseAction=function(e,t){var r=this;return new Promise((function(i,o){var a=r.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return b0(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(ju,"readonly"),l=u.objectStore(ju).get(r.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+r.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(w){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=Ad(t),f=s.transaction(Gs,"readwrite"),m=f.objectStore(Gs),g=m.put({modelPath:r.modelPath,modelArtifactsInfo:h});g.onsuccess=function(){var w=(c=s.transaction(ju,"readwrite")).objectStore(ju).put({modelPath:r.modelPath,modelArtifacts:t,modelArtifactsInfo:h});w.onsuccess=function(){return i({modelArtifactsInfo:h})},w.onerror=function(v){var y=(m=f.objectStore(Gs)).delete(r.modelPath);y.onsuccess=function(){return s.close(),o(w.error)},y.onerror=function(x){return s.close(),o(w.error)}}},g.onerror=function(w){return s.close(),o(g.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}}))},n.URL_SCHEME="indexeddb://",n})(),gE=function(n){return Ne().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Cc.URL_SCHEME)?(e=n.slice(Cc.URL_SCHEME.length),new Cc(e)):null;var e};Li.registerSaveRouter(gE),Li.registerLoadRouter(gE);var k9=(function(){function n(){this.indexedDB=AM()}return n.prototype.listModels=function(){return wt(this,void 0,void 0,(function(){var e=this;return _t(this,(function(t){return[2,new Promise((function(r,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return b0(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(Gs,"readonly"),u=s.objectStore(Gs).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}r(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}}))]}))}))},n.prototype.removeModel=function(e){return wt(this,void 0,void 0,(function(){var t=this;return _t(this,(function(r){var i;return e=(i=e).startsWith(Cc.URL_SCHEME)?i.slice(Cc.URL_SCHEME.length):i,[2,new Promise((function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return b0(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Gs,"readwrite"),h=c.objectStore(Gs),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var m=h.delete(e),g=function(){var w=(u=l.transaction(ju,"readwrite")).objectStore(ju).delete(e);w.onsuccess=function(){return o(f.result.modelArtifactsInfo)},w.onerror=function(v){return a(f.error)}};m.onsuccess=g,m.onerror=function(w){return g(),l.close(),a(f.error)}},f.onerror=function(m){return l.close(),a(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}}))]}))}))},n})();if(Ne().getBool("IS_BROWSER"))try{js.registerManager(Cc.URL_SCHEME,new k9)}catch{}var Ba="/",hc="tensorflowjs_models",IM="info",C9="model_topology",T9="weight_specs",M9="weight_data",R9="model_metadata";function DM(n){return{info:[hc,n,IM].join(Ba),topology:[hc,n,C9].join(Ba),weightSpecs:[hc,n,T9].join(Ba),weightData:[hc,n,M9].join(Ba),modelMetadata:[hc,n,R9].join(Ba)}}function A9(n){var e=n.split(Ba);if(e.length<3)throw new Error("Invalid key format: "+n);return e.slice(1,e.length-1).join(Ba)}var Tc=(function(){function n(e){if(!Ne().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=DM(this.modelPath)}return n.prototype.save=function(e){return wt(this,void 0,void 0,(function(){var t,r,i;return _t(this,(function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),r=JSON.stringify(e.weightSpecs),i=Ad(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,(function(a){if(y0)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]}))}))},n.prototype.load=function(){return wt(this,void 0,void 0,(function(){var e,t,r,i,o,a,s;return _t(this,(function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(r=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=r,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(l){if(y0){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),m=0;m<h.length;++m)f.set([h.charCodeAt(m)],m);return f.buffer})(s),[2,t]}))}))},n.URL_SCHEME="localstorage://",n})(),vE=function(n){return Ne().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Tc.URL_SCHEME)?(e=n.slice(Tc.URL_SCHEME.length),new Tc(e)):null;var e};Li.registerSaveRouter(vE),Li.registerLoadRouter(vE);var I9=(function(){function n(){K(Ne().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),K(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return n.prototype.listModels=function(){return wt(this,void 0,void 0,(function(){var e,t,r,i,o,a;return _t(this,(function(s){for(e={},t=hc+Ba,r=Ba+IM,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(r)&&(a=A9(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]}))}))},n.prototype.removeModel=function(e){return wt(this,void 0,void 0,(function(){var t,r;return _t(this,(function(i){var o;if(e=(o=e).startsWith(Tc.URL_SCHEME)?o.slice(Tc.URL_SCHEME.length):o,t=DM(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return r=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,r]}))}))},n})();if(Ne().getBool("IS_BROWSER"))try{js.registerManager(Tc.URL_SCHEME,new I9)}catch{}var D9="model",N9=".json",P9=".weights.bin";function yE(n){return new Promise((function(e){return setTimeout(e)})).then(n)}var tb=(function(){function n(e){if(!Ne().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(n.URL_SCHEME)&&(e=e.slice(n.URL_SCHEME.length)),e!=null&&e.length!==0||(e=D9),this.modelTopologyFileName=e+N9,this.weightDataFileName=e+P9}return n.prototype.save=function(e){return wt(this,void 0,void 0,(function(){var t,r,i,o,a,s;return _t(this,(function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return r=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:r},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,yE((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,yE((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Ad(e)}]}}))}))},n.URL_SCHEME="downloads://",n})(),F9=(function(){function n(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return n.prototype.load=function(){return wt(this,void 0,void 0,(function(){var e,t,r=this;return _t(this,(function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(o,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&o({modelTopology:c});var h=l.weightsManifest;if(h!=null){var f;try{f=r.checkManifestAndWeightFiles(h,t)}catch(v){return void a(v)}var m=[],g=[],w=[];h.forEach((function(v){v.paths.forEach((function(y){g.push(y),w.push(null)})),m.push.apply(m,v.weights)})),h.forEach((function(v){v.paths.forEach((function(y){var x=new FileReader;x.onload=function(E){var _=E.target.result,k=g.indexOf(y);w[k]=_,w.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:m,weightData:o_(w),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},x.onerror=function(E){return a("Failed to weights data from file of path '"+y+"'.")},x.readAsArrayBuffer(f[y])}))}))}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)}))]}))}))},n.prototype.checkManifestAndWeightFiles=function(e,t){for(var r=[],i=t.map((function(u){return pE(u.name)})),o={},a=0,s=e;a<s.length;a++)s[a].paths.forEach((function(u){var l=pE(u);if(r.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(r.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=t[i.indexOf(l)]}));if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+r.length+") and the number of weight files provided ("+t.length+").");return o},n})();function bE(n,e,t,r){(function(o){K(o!=null&&Array.isArray(o)&&o.length>0,(function(){return"promises must be a none empty array"}))})(n),(function(o,a){K(o>=0&&o<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o})),K(a>=0&&a<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a})),K(a>=o,(function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a}))})(t=t??0,r=r??1);var i=0;return Promise.all(n.map((function(o){return o.then((function(a){var s=t+ ++i/n.length*(r-t);return e(s),a})),o})))}function NM(n,e){return wt(this,void 0,void 0,(function(){var t,r,i,o,a,s,u,l,c;return _t(this,(function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Ne().platform.fetch:e.fetchFunc,r=n.map((function(f){return t(f,e.requestInit,{isBinary:!0})})),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(r)];case 1:return a=h.sent(),[3,4];case 2:return[4,bE(r,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map((function(f){return f.arrayBuffer()})),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,bE(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}}))}))}function wE(n){var e=this;return function(t,r,i){return r===void 0&&(r=""),wt(e,void 0,void 0,(function(){var o,a,s,u,l,c,h,f,m,g;return _t(this,(function(w){switch(w.label){case 0:if(o=t.map((function(){return!1})),a={},s=i!=null?i.map((function(){return!1})):[],u=[],t.forEach((function(v,y){var x=0;v.weights.forEach((function(E){var _="quantization"in E?E.quantization.dtype:E.dtype,k=v0[_]*bt(E.shape),C=function(){o[y]=!0,a[y]==null&&(a[y]=[]),a[y].push({manifestEntry:E,groupOffset:x,sizeBytes:k})};i!=null?i.forEach((function(A,I){A===E.name&&(C(),s[I]=!0)})):C(),u.push(E.name),x+=k}))})),!s.every((function(v){return v})))throw l=i.filter((function(v,y){return!s[y]})),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce((function(v,y,x){return y&&v.push(x),v}),[]),h=[],c.forEach((function(v){t[v].paths.forEach((function(y){var x=r+(r.endsWith("/")?"":"/")+y;h.push(x)}))})),[4,n(h)];case 1:return f=w.sent(),m={},g=0,c.forEach((function(v){for(var y=t[v].paths.length,x=0,E=0;E<y;E++)x+=f[g+E].byteLength;for(var _=new ArrayBuffer(x),k=new Uint8Array(_),C=0,A=0;A<y;A++){var I=new Uint8Array(f[g+A]);k.set(I,C),C+=I.byteLength}a[v].forEach((function(T){var R=RM(_.slice(T.groupOffset,T.groupOffset+T.sizeBytes),[T.manifestEntry]);for(var N in R)m[N]=R[N]})),g+=y})),[2,m]}}))}))}}Li.registerSaveRouter((function(n){return Ne().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(tb.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new tb(e)})(n.slice(tb.URL_SCHEME.length)):null}));var PM=(function(){function n(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(K(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=Ne().platform.fetch,K(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&K(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return n.prototype.save=function(e){return wt(this,void 0,void 0,(function(){var t,r,i,o;return _t(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:r},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:Ad(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}}))}))},n.prototype.load=function(){return wt(this,void 0,void 0,(function(){var e,t,r,i,o,a,s,u,l,c,h,f;return _t(this,(function(m){switch(m.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=m.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");m.label=2;case 2:return m.trys.push([2,4,,5]),[4,e.json()];case 3:return t=m.sent(),[3,5];case 4:throw m.sent(),r="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 5:if(i=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,l=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=m.sent(),c=f[0],h=f[1],m.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}}))}))},n.prototype.loadWeights=function(e){return wt(this,void 0,void 0,(function(){var t,r,i,o,a,s,u,l,c,h,f;return _t(this,(function(m){switch(m.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,r=(function(g){var w=g.lastIndexOf("/"),v=g.lastIndexOf("?"),y=g.substring(0,w),x=v>w?g.substring(v):"";return[y+"/",x]})(t),i=r[0],o=r[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach((function(g){g.paths.forEach((function(w){h.push(a+w+o)}))})),[4,NM(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=m.sent(),[2,[s,o_(f)]]}}))}))},n.URL_SCHEME_REGEX=/^https?:\/\//,n})();function w0(n){return n.match(PM.URL_SCHEME_REGEX)!=null}var _E=function(n,e){return typeof fetch>"u"?null:(Array.isArray(n)?n.every((function(t){return w0(t)})):w0(n))?_0(n,{onProgress:e}):null};function _0(n,e){return new PM(n,e)}Li.registerSaveRouter(_E),Li.registerLoadRouter(_E);var nb=(function(){function n(e){this.modelArtifacts=e}return n.prototype.load=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,this.modelArtifacts]}))}))},n})(),O9=(function(){function n(e){this.saveHandler=e}return n.prototype.save=function(e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return[2,this.saveHandler(e)]}))}))},n})(),FM=Object.freeze({browserFiles:function(n){return new F9(n)},browserHTTPRequest:function(n,e){return _0(n,e)},concatenateArrayBuffers:o_,decodeWeights:RM,encodeWeights:function(n,e){return wt(this,void 0,void 0,(function(){var t,r,i,o,a,s=this;return _t(this,(function(u){switch(u.label){case 0:for(t=[],r=[],i=Array.isArray(n)?n.map((function(l){return l.name})):Object.keys(n),o=function(l){var c=i[l],h=Array.isArray(n)?n[l].tensor:n[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var f={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var m=new Promise((function(g){return wt(s,void 0,void 0,(function(){var w,v,y,x,E,_,k;return _t(this,(function(C){switch(C.label){case 0:return[4,h.bytes()];case 1:for(w=C.sent(),v=w.reduce((function(A,I){return A+I.length}),0)+Om*w.length,y=new Uint8Array(v),x=0,E=0;E<w.length;E++)_=w[E],k=new Uint8Array(new Uint32Array([_.length]).buffer),y.set(k,x),x+=Om,y.set(_,x),x+=_.length;return g(y),[2]}}))}))}));r.push(m)}else r.push(h.data());e!=null&&(f.group=e),t.push(f)},a=0;a<i.length;++a)o(a);return[4,Promise.all(r)];case 1:return[2,{data:E9(u.sent()),specs:t}]}}))}))},fromMemory:function(n,e,t,r){return arguments.length===1?n.modelTopology!=null||n.weightSpecs!=null?new nb(n):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nb({modelTopology:n})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new nb({modelTopology:n,weightSpecs:e,weightData:t,trainingConfig:r}))},getLoadHandlers:function(n,e){return Li.getLoadHandlers(n,e)},getModelArtifactsInfoForJSON:Ad,getSaveHandlers:function(n){return Li.getSaveHandlers(n)},http:_0,isHTTPScheme:w0,loadWeights:function(n,e,t,r){return e===void 0&&(e=""),wt(this,void 0,void 0,(function(){return _t(this,(function(i){return[2,wE((function(o){return NM(o,{requestInit:r})}))(n,e,t)]}))}))},registerLoadRouter:function(n){return Li.registerLoadRouter(n)},registerSaveRouter:function(n){return Li.registerSaveRouter(n)},weightsLoaderFactory:wE,withSaveHandler:function(n){return new O9(n)},copyModel:function(n,e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return[2,mE(n,e,!1)]}))}))},listModels:function(){return wt(this,void 0,void 0,(function(){var n,e,t,r,i,o,a;return _t(this,(function(s){switch(s.label){case 0:n=js.getSchemes(),e={},t=0,r=n,s.label=1;case 1:return t<r.length?(i=r[t],[4,js.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+kc+a]=o[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(n,e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return[2,mE(n,e,!0)]}))}))},removeModel:function(n){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){return e=Kp(n),[2,js.getManager(e.scheme).removeModel(e.path)]}))}))}}),Wl;oe({confusionMatrix_:function(n,e,t){var r=X(n,"labels","confusionMatrix"),i=X(e,"predictions","confusionMatrix");K(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),K(r.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),K(i.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),K(r.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),K(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var o=Pm(r.asType("int32"),t),a=Pm(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var L9=oe({fromPixels_:function(n,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(n==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,r=!1,i=!1,o=!1,a=!1;if(n.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&n instanceof ImageData)r=!0;else if(typeof HTMLVideoElement<"u"&&n instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement)o=!0;else{if(n.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+n.constructor.name);a=!0}if(i&&i&&n.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(GT("FromPixels",le.backendName)!=null)return le.runKernel("FromPixels",{pixels:n},{numChannels:e});var s,u,l=i?[n.videoWidth,n.videoHeight]:[n.width,n.height],c=l[0],h=l[1];if(a?s=n.getContext("2d").getImageData(0,0,c,h).data:r||t?s=n.data:(o||i)&&(Wl==null&&(Wl=document.createElement("canvas").getContext("2d")),Wl.canvas.width=c,Wl.canvas.height=h,Wl.drawImage(n,0,0,c,h),s=Wl.getImageData(0,0,c,h).data),e===4)u=new Int32Array(s);else{var f=c*h;u=new Int32Array(f*e);for(var m=0;m<f;m++)for(var g=0;g<e;++g)u[m*e+g]=s[4*m+g]}return i3(u,[h,c,e],"int32")}}),OM=Object.freeze({toPixels:function(n,e){return wt(this,void 0,void 0,(function(){var t,r,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,A,I;return _t(this,(function(T){switch(T.label){case 0:if(t=X(n,"img","toPixels"),n instanceof Nn||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(r=t.shape.slice(0,2),i=r[0],o=r[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=T.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=T.sent(),h=c[0],f=c[1],m=h[0],g=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(m<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+m+" - "+g+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(m<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+m+" - "+g+"].")}for(w=t.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),y=0;y<i*o;++y)x=void 0,E=void 0,_=void 0,k=void 0,a===1?(x=s[y]*w,E=s[y]*w,_=s[y]*w,k=255):a===3?(x=s[3*y]*w,E=s[3*y+1]*w,_=s[3*y+2]*w,k=255):a===4&&(x=s[4*y]*w,E=s[4*y+1]*w,_=s[4*y+2]*w,k=s[4*y+3]*w),v[(C=4*y)+0]=Math.round(x),v[C+1]=Math.round(E),v[C+2]=Math.round(_),v[C+3]=Math.round(k);return e!=null&&(e.width=o,e.height=i,A=e.getContext("2d"),I=new ImageData(v,o,i),A.putImageData(I,0,0)),t!==n&&t.dispose(),[2,v]}}))}))},fromPixels:L9}),B9=(function(){function n(){}return n.prototype.getClassName=function(){return this.constructor.className},n.fromConfig=function(e,t){return new e(t)},n})(),U9=(function(){function n(){this.classNameMap={}}return n.getMap=function(){return n.instance==null&&(n.instance=new n),n.instance},n.register=function(e){n.getMap().classNameMap[e.className]=[e,e.fromConfig]},n})();function cl(n){K(n.className!=null,(function(){return"Class being registered does not have the static className property defined."})),K(typeof n.className=="string",(function(){return"className is required to be a string, but got type "+typeof n.className})),K(n.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),U9.register(n)}var hl=(function(n){function e(){return n!==null&&n.apply(this,arguments)||this}return Uo(e,n),e.prototype.minimize=function(t,r,i){r===void 0&&(r=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map((function(l){return{name:l.name,tensor:s[l.name]}}));this.applyGradients(u)}else this.applyGradients(s);return bi(s),r?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,r){return s6(t,r)},e.prototype.dispose=function(){this.iterations_!=null&&bi(this.iterations_)},e.prototype.saveIterations=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ct(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(r){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return wt(this,void 0,void 0,(function(){var r;return _t(this,(function(i){switch(i.label){case 0:return r=this,[4,t[0].tensor.data()];case 1:return r.iterations_=i.sent()[0],[2,t.slice(1)]}}))}))},e})(B9);Object.defineProperty(hl,Symbol.hasInstance,{value:function(n){return n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null}});var z9=(function(n){function e(t,r,i){i===void 0&&(i=null);var o=n.call(this)||this;return o.learningRate=t,o.rho=r,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=le.backend.epsilon()),o}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:_n((function(){return hn(a).variable(!1)}))}),r.accumulatedUpdates[o]==null&&(r.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:_n((function(){return hn(a).variable(!1)}))});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable,l=r.accumulatedUpdates[o].variable;_n((function(){var c=u.mul(r.rho).add(s.square().mul(1-r.rho)),h=l.add(r.epsilon).sqrt().div(u.add(r.epsilon).sqrt()).mul(s),f=l.mul(r.rho).add(h.square().mul(1-r.rho));u.assign(c),l.assign(f);var m=h.mul(-r.learningRate).add(a);a.assign(m)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(bi(this.accumulatedGrads.map((function(t){return t.variable}))),bi(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){var t;return _t(this,(function(r){switch(r.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){var r;return _t(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=t.length/2,this.accumulatedGrads=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.rho,r.epsilon)},e.className="Adadelta",e})(hl);cl(z9);var W9=(function(n){function e(t,r){r===void 0&&(r=.1);var i=n.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=r,i.accumulatedGrads=[],i}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];r.accumulatedGrads[o]==null&&(r.accumulatedGrads[o]={originalName:i+"/accumulator",variable:_n((function(){return Ku(a.shape,r.initialAccumulatorValue).variable(!1)}))});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedGrads[o].variable;_n((function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(le.backend.epsilon()).sqrt()).mul(-r.learningRate).add(a);a.assign(c)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&bi(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulatedGrads=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,r){return new t(r.learningRate,r.initialAccumulatorValue)},e.className="Adagrad",e})(hl);cl(W9);var H9=(function(n){function e(t,r,i,o){o===void 0&&(o=null);var a=n.call(this)||this;return a.learningRate=t,a.beta1=r,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],_n((function(){a.accBeta1=Ct(r).variable(),a.accBeta2=Ct(i).variable()})),o==null&&(a.epsilon=le.backend.epsilon()),a}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);_n((function(){var o=Fo(1,r.accBeta1),a=Fo(1,r.accBeta2);i.forEach((function(s,u){var l=le.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:_n((function(){return hn(l).variable(!1)}))}),r.accumulatedSecondMoment[u]==null&&(r.accumulatedSecondMoment[u]={originalName:s+"/v",variable:_n((function(){return hn(l).variable(!1)}))});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedSecondMoment[u].variable,m=h.mul(r.beta1).add(c.mul(1-r.beta1)),g=f.mul(r.beta2).add(c.square().mul(1-r.beta2)),w=m.div(o),v=g.div(a);h.assign(m),f.assign(g);var y=w.div(v.sqrt().add(r.epsilon)).mul(-r.learningRate).add(l);l.assign(y)}})),r.accBeta1.assign(r.accBeta1.mul(r.beta1)),r.accBeta2.assign(r.accBeta2.mul(r.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&bi(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&bi(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){var t;return _t(this,(function(r){switch(r.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){var r,i=this;return _t(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),_n((function(){i.accBeta1.assign(Rm(i.beta1,i.iterations_+1)),i.accBeta2.assign(Rm(i.beta2,i.iterations_+1))})),r=t.length/2,this.accumulatedFirstMoment=t.slice(0,r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(r,2*r).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon)},e.className="Adam",e})(hl);cl(H9);var G9=(function(n){function e(t,r,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=n.call(this)||this;return s.learningRate=t,s.beta1=r,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],_n((function(){s.iteration=Ct(0).variable(),s.accBeta1=Ct(r).variable()})),o==null&&(s.epsilon=le.backend.epsilon()),s}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this,i=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);_n((function(){var o=Fo(1,r.accBeta1),a=Js(-r.learningRate,r.iteration.mul(r.decay).add(1));i.forEach((function(s,u){var l=le.registeredVariables[s];r.accumulatedFirstMoment[u]==null&&(r.accumulatedFirstMoment[u]={originalName:s+"/m",variable:hn(l).variable(!1)}),r.accumulatedWeightedInfNorm[u]==null&&(r.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:hn(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=r.accumulatedFirstMoment[u].variable,f=r.accumulatedWeightedInfNorm[u].variable,m=h.mul(r.beta1).add(c.mul(1-r.beta1)),g=f.mul(r.beta2),w=c.abs(),v=g.maximum(w);h.assign(m),f.assign(v);var y=a.div(o).mul(m.div(v.add(r.epsilon))).add(l);l.assign(y)}})),r.iteration.assign(r.iteration.add(1)),r.accBeta1.assign(r.accBeta1.mul(r.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&bi(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&bi(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(r){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,r){return new t(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)},e.className="Adamax",e})(hl);cl(G9);var LM=(function(n){function e(t){var r=n.call(this)||this;return r.learningRate=t,r.setLearningRate(t),r}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=le.registeredVariables[i];_n((function(){var u=r.c.mul(a).add(s);s.assign(u)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=JL(Ct(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=r.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,r){return new t(r.learningRate)},e.className="SGD",e})(hl);cl(LM);var V9=(function(n){function e(t,r,i){i===void 0&&(i=!1);var o=n.call(this,t)||this;return o.learningRate=t,o.momentum=r,o.useNesterov=i,o.accumulations=[],o.m=Ct(o.momentum),o}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];r.accumulations[o]==null&&(r.accumulations[o]={originalName:i+"/momentum",variable:_n((function(){return hn(a).variable(!1)}))});var s=r.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&_n((function(){var l,c=r.m.mul(s).add(u);l=r.useNesterov?r.c.mul(u.add(c.mul(r.m))).add(a):r.c.mul(c).add(a),s.assign(c),a.assign(l)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&bi(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(r){return{name:r.originalName,tensor:r.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),this.accumulations=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,r){return new t(r.learningRate,r.momentum,r.useNesterov)},e.className="Momentum",e})(LM);cl(V9);var j9=(function(n){function e(t,r,i,o,a){r===void 0&&(r=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=n.call(this)||this;if(s.learningRate=t,s.decay=r,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=le.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Uo(e,n),e.prototype.applyGradients=function(t){var r=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];r.accumulatedMeanSquares[o]==null&&(r.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:_n((function(){return hn(a).variable(!1)}))}),r.accumulatedMoments[o]==null&&(r.accumulatedMoments[o]={originalName:i+"/momentum",variable:_n((function(){return hn(a).variable(!1)}))}),r.accumulatedMeanGrads[o]==null&&r.centered&&(r.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:_n((function(){return hn(a).variable(!1)}))});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=r.accumulatedMeanSquares[o].variable,l=r.accumulatedMoments[o].variable;_n((function(){var c=u.mul(r.decay).add(s.square().mul(1-r.decay));if(r.centered){var h=r.accumulatedMeanGrads[o].variable,f=h.mul(r.decay).add(s.mul(1-r.decay)),m=l.mul(r.momentum).add(s.mul(r.learningRate).div(c.sub(f.square().add(r.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(m);var g=a.sub(m);a.assign(g)}else{var w=u.mul(r.decay).add(s.square().mul(1-r.decay));m=l.mul(r.momentum).add(s.mul(r.learningRate).div(w.add(r.epsilon).sqrt())),u.assign(w),l.assign(m),g=a.sub(m),a.assign(g)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&bi(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&bi(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&bi(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){var t;return _t(this,(function(r){switch(r.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[r.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){var r;return _t(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),r=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(r,2*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*r,3*r).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,r){return new t(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)},e.className="RMSProp",e})(hl);cl(j9);Nn.prototype.add=function(n){return uo(this,n)},Nn.prototype.broadcastTo=function(n){return Y3(this,n)},Nn.prototype.div=function(n){return Js(this,n)},Nn.prototype.divNoNan=function(n){return Q3(this,n)},Nn.prototype.squaredDifference=function(n){return nM(this,n)},Nn.prototype.tile=function(n){return Ec(this,n)},Nn.prototype.oneHot=function(n,e,t){return e===void 0&&(e=1),t===void 0&&(t=0),Pm(this,n,e,t)},Nn.prototype.transpose=function(n){return Co(this,n)},Nn.prototype.pad=function(n,e){return Za(this,n,e)},Nn.prototype.batchNorm=function(n,e,t,r,i){return Md(this,n,e,t,r,i)},Ie=l9;var Mc=(function(){function n(e,t){if(!Ju(e)||!Ju(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),n.prototype.reverse=function(){return new n(1/this.width,1/this.height)},n})(),yn=(function(){function n(e,t){this._x=e,this._y=t}return Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),n.prototype.add=function(e){return new n(this.x+e.x,this.y+e.y)},n.prototype.sub=function(e){return new n(this.x-e.x,this.y-e.y)},n.prototype.mul=function(e){return new n(this.x*e.x,this.y*e.y)},n.prototype.div=function(e){return new n(this.x/e.x,this.y/e.y)},n.prototype.abs=function(){return new n(Math.abs(this.x),Math.abs(this.y))},n.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},n.prototype.floor=function(){return new n(Math.floor(this.x),Math.floor(this.y))},n})();function dg(n,e){return n instanceof Nn&&n.shape.length===e}function q9(n){return dg(n,2)}function fg(n){return dg(n,3)}function qs(n){return dg(n,4)}function $9(n){return n%1!==0}function xE(n){return n%2===0}function a_(n,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(n*t)/t}function SE(n){return n&&n.width&&n.height}function X9(n,e){var t=n.width,r=n.height,i=e/Math.max(r,t);return new Mc(Math.round(t*i),Math.round(r*i))}function s_(n){return n.reduce(function(e,t){return e.add(t)},new yn(0,0)).div(new yn(n.length,n.length))}function nd(n,e,t){return Array(n).fill(0).map(function(r,i){return e+i*t})}function Ju(n){return!!n&&n!==1/0&&n!==-1/0&&!isNaN(n)||n===0}function EE(n){return Ju(n)&&0<=n&&n<=1}var da=(function(){function n(e,t){t===void 0&&(t=!0);var r=e||{},i=[r.left,r.top,r.right,r.bottom].every(Ju),o=[r.x,r.y,r.width,r.height].every(Ju);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(r));var a=o?[r.x,r.y,r.width,r.height]:[r.left,r.top,r.right-r.left,r.bottom-r.top],s=a[0],u=a[1],l=a[2],c=a[3];n.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",t),this._x=s,this._y=u,this._width=l,this._height=c}return n.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(Ju)},n.assertIsValidBox=function(e,t,r){if(r===void 0&&(r=!1),!n.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!r&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(n.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topLeft",{get:function(){return new yn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"topRight",{get:function(){return new yn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomLeft",{get:function(){return new yn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"bottomRight",{get:function(){return new yn(this.right,this.bottom)},enumerable:!0,configurable:!0}),n.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=e[0],r=e[1],i=e[2],o=e[3];return new n({x:t,y:r,width:i,height:o})},n.prototype.toSquare=function(){var e=this,t=e.x,r=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(t-=a/2,i+=a),o<i&&(r-=a/2,o+=a),new n({x:t,y:r,width:i,height:o})},n.prototype.rescale=function(e){var t=SE(e)?e.width:e,r=SE(e)?e.height:e;return new n({x:this.x*t,y:this.y*r,width:this.width*t,height:this.height*r})},n.prototype.pad=function(e,t){var r=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=r[0],o=r[1],a=r[2],s=r[3];return new n({x:i,y:o,width:a,height:s})},n.prototype.clipAtImageBorders=function(e,t){var r=this,i=r.x,o=r.y,a=r.right,s=r.bottom,u=Math.max(i,0),l=Math.max(o,0),c=a-u,h=s-l,f=Math.min(c,e-u),m=Math.min(h,t-l);return new n({x:u,y:l,width:f,height:m}).floor()},n.prototype.shift=function(e,t){var r=this,i=r.width,o=r.height,a=this.x+e,s=this.y+t;return new n({x:a,y:s,width:i,height:o})},n.prototype.padAtBorders=function(e,t){var r=this.width+1,i=this.height+1,o=1,a=1,s=r,u=i,l=this.left,c=this.top,h=this.right,f=this.bottom;return h>t&&(s=-h+t+r,h=t),f>e&&(u=-f+e+i,f=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:o,edx:s,y:c,ey:f,x:l,ex:h,w:r,h:i}},n.prototype.calibrate=function(e){return new n({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},n})(),pg=(function(n){Yt(e,n);function e(t,r,i,o,a){return a===void 0&&(a=!1),n.call(this,{left:t,top:r,right:i,bottom:o},a)||this}return e})(da),kE=(function(n){Yt(e,n);function e(t,r){var i=n.call(this,t)||this;return i._label=r,i}return e.assertIsValidLabeledBox=function(t,r){if(da.assertIsValidBox(t,r),!Ju(t.label))throw new Error(r+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(da),BM=(function(){function n(e,t,r,i,o){this._imageDims=new Mc(o.width,o.height),this._score=e,this._classScore=t,this._className=r,this._box=new da(i).rescale(this._imageDims)}return Object.defineProperty(n.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativeBox",{get:function(){return new da(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new n(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},n})();(function(n){Yt(e,n);function e(t,r,i,o){var a=n.call(this,t,r)||this;return a._score=i,a._classScore=o,a}return e.assertIsValidPredictedBox=function(t,r){if(kE.assertIsValidLabeledBox(t,r),!EE(t.score)||!EE(t.classScore))throw new Error(r+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(kE);var u_=(function(n){Yt(e,n);function e(t,r,i,o,a){return a===void 0&&(a=!1),n.call(this,{x:t,y:r,width:i,height:o},a)||this}return e})(da);function UM(){var n=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:n,readFile:e}}function zM(n){var e="";if(!n)try{n=require("fs")}catch(r){e=r.toString()}var t=n?function(r){return new Promise(function(i,o){n.readFile(r,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function WM(){var n=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(n)return new n;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},r=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=zM();return No({Canvas:n||(function(){function a(){}return a})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function a(){}return a})(),Image:e||(function(){function a(){}return a})(),ImageData:global.ImageData||(function(){function a(){}return a})(),Video:global.HTMLVideoElement||(function(){function a(){}return a})(),createCanvasElement:t,createImageElement:r,fetch:i},o)}function HM(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function GM(){return typeof global=="object"&&typeof require=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var ir;function Y9(){if(!ir)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ir}function x0(n){ir=n}function l_(){HM()&&x0(UM()),GM()&&x0(WM())}function K9(n){if(ir||l_(),!ir)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=n.Canvas,t=e===void 0?ir.Canvas:e,r=n.Image,i=r===void 0?ir.Image:r;ir.Canvas=t,ir.Image=i,ir.createCanvasElement=n.createCanvasElement||(function(){return new t}),ir.createImageElement=n.createImageElement||(function(){return new i}),ir.ImageData=n.ImageData||ir.ImageData,ir.Video=n.Video||ir.Video,ir.fetch=n.fetch||ir.fetch,ir.readFile=n.readFile||ir.readFile}var qr={getEnv:Y9,setEnv:x0,initialize:l_,createBrowserEnv:UM,createFileSystem:zM,createNodejsEnv:WM,monkeyPatch:K9,isBrowser:HM,isNodejs:GM};l_();function c_(n){return!qr.isNodejs()&&typeof n=="string"?document.getElementById(n):n}function fa(n){var e=qr.getEnv(),t=e.Canvas,r=e.CanvasRenderingContext2D;if(n instanceof r)return n;var i=c_(n);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var za;(function(n){n.TOP_LEFT="TOP_LEFT",n.TOP_RIGHT="TOP_RIGHT",n.BOTTOM_LEFT="BOTTOM_LEFT",n.BOTTOM_RIGHT="BOTTOM_RIGHT"})(za||(za={}));var h_=(function(){function n(e){e===void 0&&(e={});var t=e.anchorPosition,r=e.backgroundColor,i=e.fontColor,o=e.fontSize,a=e.fontStyle,s=e.padding;this.anchorPosition=t||za.TOP_LEFT,this.backgroundColor=r||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=s||4}return n})(),d_=(function(){function n(e,t,r){r===void 0&&(r={}),this.text=typeof e=="string"?[e]:e instanceof n?e.text:e,this.anchor=t,this.options=new h_(r)}return n.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(r){return e.measureText(r).width}).reduce(function(r,i){return r<i?i:r},0)+2*t},n.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,r=e.padding;return this.text.length*t+2*r},n.prototype.getUpperLeft=function(e,t){var r=this.options.anchorPosition,i=r===za.BOTTOM_RIGHT||r===za.TOP_RIGHT,o=r===za.BOTTOM_LEFT||r===za.BOTTOM_RIGHT,a=this.measureWidth(e),s=this.measureHeight(),u=i?this.anchor.x-a:this.anchor.x,l=o?this.anchor.y-s:this.anchor.y;if(t){var c=t.width,h=t.height,f=Math.max(Math.min(u,c-a),0),m=Math.max(Math.min(l,h-s),0);return{x:f,y:m}}return{x:u,y:l}},n.prototype.draw=function(e){var t=c_(e),r=fa(t),i=this.options,o=i.backgroundColor,a=i.fontColor,s=i.fontSize,u=i.fontStyle,l=i.padding;r.font=s+"px "+u;var c=this.measureWidth(r),h=this.measureHeight();r.fillStyle=o;var f=this.getUpperLeft(r,t);r.fillRect(f.x,f.y,c,h),r.fillStyle=a,this.text.forEach(function(m,g){var w=l+f.x,v=l+f.y+(g+1)*s;r.fillText(m,w,v)})},n})(),VM=(function(){function n(e){e===void 0&&(e={});var t=e.boxColor,r=e.lineWidth,i=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=r||2,this.label=i;var a={anchorPosition:za.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new h_(Object.assign({},a,o))}return n})(),jM=(function(){function n(e,t){t===void 0&&(t={}),this.box=new da(e),this.options=new VM(t)}return n.prototype.draw=function(e){var t=fa(e),r=this.options,i=r.boxColor,o=r.lineWidth,a=this.box,s=a.x,u=a.y,l=a.width,c=a.height;t.strokeStyle=i,t.lineWidth=o,t.strokeRect(s,u,l,c);var h=this.options.label;h&&new d_([h],{x:s-o/2,y:u},this.options.drawLabelOptions).draw(e)},n})();const J9=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return za},DrawBox:jM,DrawBoxOptions:VM,DrawTextField:d_,DrawTextFieldOptions:h_},Symbol.toStringTag,{value:"Module"}));function Oo(n,e,t,r){return t===void 0&&(t="same"),r===void 0&&(r=!1),_n(function(){var i=uo(ll(n,e.filters,[1,1],t),e.bias);return r?cg(i):i})}function ts(n,e){Object.keys(n).forEach(function(t){e.some(function(r){return r.originalPath===t})||n[t].dispose()})}function mg(n,e){return function(t,r,i,o){var a=ta(n(t*r*i*i),[i,i,t,r]),s=Bo(n(r));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function f_(n,e){return function(t,r,i){var o=Yu(n(t*r),[t,r]),a=Bo(n(r));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var qM=(function(){function n(e,t,r){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=r}return n})();function p_(n,e){return function(t,r,i){var o=ta(n(9*t),[3,3,t,1]),a=ta(n(t*r),[1,1,t,r]),s=Bo(n(r));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new qM(o,a,s)}}function m_(n){return function(e){var t=n(e+"/depthwise_filter",4),r=n(e+"/pointwise_filter",4),i=n(e+"/bias",1);return new qM(t,r,i)}}function su(n,e){return function(t,r,i){var o=n[t];if(!dg(o,r))throw new Error("expected weightMap["+t+"] to be a Tensor"+r+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function ns(n){var e=n;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function r(){return e}return{extractWeights:t,getRemainingWeights:r}}function $M(n,e){var t=e+"-weights_manifest.json";if(!n)return{modelBaseUri:"",manifestUri:t};if(n==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var r=n.startsWith("http://")?"http://":n.startsWith("https://")?"https://":"";n=n.replace(r,"");var i=n.split("/").filter(function(s){return s}),o=n.endsWith(".json")?i[i.length-1]:t,a=r+(n.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=n.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function XM(n){var e=qr.getEnv(),t=e.Image,r=e.Video;return n instanceof t&&n.complete||n instanceof r&&n.readyState>=3}function Q9(n){return new Promise(function(e,t){if(n instanceof qr.getEnv().Canvas||XM(n))return e();function r(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",r),o.currentTarget.removeEventListener("error",i),t(o))}n.addEventListener("load",r),n.addEventListener("error",i)})}function YM(n){var e=qr.getEnv(),t=e.Image,r=e.Video;return n instanceof t?new Mc(n.naturalWidth,n.naturalHeight):n instanceof r?new Mc(n.videoWidth,n.videoHeight):new Mc(n.width,n.height)}function gg(n){var e=n.width,t=n.height,r=qr.getEnv().createCanvasElement,i=r();return i.width=e,i.height=t,i}function g_(n,e){var t=qr.getEnv().ImageData;if(!(n instanceof t)&&!XM(n))throw new Error("createCanvasFromMedia - media has not finished loading yet");var r=YM(n),i=r.width,o=r.height,a=gg({width:i,height:o});return n instanceof t?fa(a).putImageData(n,0,0):fa(a).drawImage(n,0,0,i,o),a}function Z9(n,e){return It(this,void 0,void 0,function(){var t,r;return Dt(this,function(i){switch(i.label){case 0:return t=qr.getEnv().fetch,[4,t(n,e)];case 1:if(r=i.sent(),!(r.status<400))throw new Error("failed to fetch: ("+r.status+") "+r.statusText+", from url: "+r.url);return[2,r]}})})}function ez(n){return It(this,void 0,void 0,function(){return Dt(this,function(e){switch(e.label){case 0:return[4,Z9(n)];case 1:return[2,e.sent().json()]}})})}function tz(n,e){return It(this,void 0,void 0,function(){var t,r,i,o,a,s;return Dt(this,function(u){switch(u.label){case 0:return t=qr.getEnv().createCanvasElement(),r=n.shape.slice(qs(n)?1:0),i=r[0],o=r[1],a=r[2],s=_n(function(){return n.as3D(i,o,a).toInt()}),[4,OM.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function nz(n,e,t){t===void 0&&(t=!1);var r=qr.getEnv(),i=r.Image,o=r.Canvas;if(!(n instanceof i||n instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=YM(n),s=e/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=gg({width:e,height:e}),h=n instanceof o?n:g_(n),f=Math.abs(u-l)/2,m=t&&u<l?f:0,g=t&&l<u?f:0;return fa(c).drawImage(h,m,g,u,l),c}function CE(n){var e=qr.getEnv(),t=e.Image,r=e.Canvas,i=e.Video;return n instanceof t||n instanceof r||n instanceof i}function rz(n,e){return It(this,void 0,void 0,function(){var t,r,i,o;return Dt(this,function(a){switch(a.label){case 0:return t=$M(n,e),r=t.manifestUri,i=t.modelBaseUri,[4,ez(r)];case 1:return o=a.sent(),[2,FM.loadWeights(o,i)]}})})}function iz(n,e){return e===void 0&&(e=!1),_n(function(){var t=n.shape.slice(1),r=t[0],i=t[1];if(r===i)return n;var o=Math.abs(r-i),a=Math.round(o*(e?.5:1)),s=r>i?2:1,u=function(m){var g=n.shape.slice();return g[s]=m,Ku(g,0)},l=u(a),c=o-l.shape[s],h=e&&c?u(c):null,f=[h,n,l].filter(function(m){return!!m}).map(function(m){return m.toFloat()});return so(f,s)})}var Lm=(function(){function n(e,t){var r=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(fg(i)){r._imageTensors[o]=i,r._inputDimensions[o]=i.shape;return}if(qs(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");r._imageTensors[o]=i,r._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof qr.getEnv().Canvas?i:g_(i);r._canvases[o]=s,r._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(n.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"reshapedInputDimensions",{get:function(){var e=this;return nd(this.batchSize,0,1).map(function(t,r){return e.getReshapedInputDimensions(r)})},enumerable:!0,configurable:!0}),n.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},n.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},n.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},n.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},n.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),r=this.getInputHeight(e);return X9({width:t,height:r},this.inputSize)},n.prototype.toBatchTensor=function(e,t){var r=this;return t===void 0&&(t=!0),this._inputSize=e,_n(function(){var i=nd(r.batchSize,0,1).map(function(a){var s=r.getInput(a);if(s instanceof Nn){var u=qs(s)?s:s.expandDims();return u=iz(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=EM.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof qr.getEnv().Canvas)return OM.fromPixels(nz(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=Ks(i.map(function(a){return a.toFloat()})).as4D(r.batchSize,e,e,3);return o})},n})();function _r(n){return It(this,void 0,void 0,function(){var e,t,r;return Dt(this,function(i){switch(i.label){case 0:if(n instanceof Lm)return[2,n];if(e=Array.isArray(n)?n:[n],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(n)?" at input index "+o+":":""},r=e.map(c_),r.forEach(function(o,a){if(!CE(o)&&!fg(o)&&!qs(o))throw typeof e[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(qs(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(r.map(function(o){return CE(o)&&Q9(o)}))];case 1:return i.sent(),[2,new Lm(r,Array.isArray(n))]}})})}var rs=(function(){function n(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(n.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),n.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),r=t.obj,i=t.objProp;return r[i]},n.prototype.reassignParamFromPath=function(e,t){var r=this.traversePropertyPath(e),i=r.obj,o=r.objProp;i[o].dispose(),i[o]=t},n.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var r=t.paramPath;return{path:r,tensor:e.getParamFromPath(r)}})},n.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Lc})},n.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Lc)})},n.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var r=t.path,i=t.tensor;e.reassignParamFromPath(r,i.variable())})},n.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var r=t.path,i=t.tensor,o=Cr(i.dataSync());i.dispose(),e.reassignParamFromPath(r,o)})},n.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},n.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},n.prototype.load=function(e){return It(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},n.prototype.loadFromUri=function(e){return It(this,void 0,void 0,function(){var t;return Dt(this,function(r){switch(r.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,rz(e,this.getDefaultModelName())];case 1:return t=r.sent(),this.loadFromWeightMap(t),[2]}})})},n.prototype.loadFromDisk=function(e){return It(this,void 0,void 0,function(){var t,r,i,o,a,s,u,l,c,h;return Dt(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=qr.getEnv().readFile,r=$M(e,this.getDefaultModelName()),i=r.manifestUri,o=r.modelBaseUri,a=function(m){return Promise.all(m.map(function(g){return t(g).then(function(w){return w.buffer})}))},s=FM.weightsLoaderFactory(a),c=(l=JSON).parse,[4,t(i)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,s(u,o)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},n.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.extractWeights=function(e){var t=this.extractParams(e),r=t.paramMappings,i=t.params;this._paramMappings=r,this._params=i},n.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),r=t.obj,i=t.objProp;if(!r||!i||!(r[i]instanceof Nn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:r,objProp:i}},n})();function oz(n,e,t){t===void 0&&(t=!0);var r=Math.max(0,Math.min(n.right,e.right)-Math.max(n.left,e.left)),i=Math.max(0,Math.min(n.bottom,e.bottom)-Math.max(n.top,e.top)),o=r*i;return t?o/(n.area+e.area-o):o/Math.min(n.area,e.area)}function rd(n,e,t,r){r===void 0&&(r=!0);for(var i=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var u=i,l=[],c=0;c<u.length;c++){var h=u[c],f=n[s],m=n[h];l.push(oz(f,m,r))}i=i.filter(function(g,w){return l[w]<=t})};i.length>0;)a();return o}function Id(n,e){return _n(function(){var t=e[0],r=e[1],i=e[2],o=Ku(dy(n.shape.slice(0,3),[1]),t),a=Ku(dy(n.shape.slice(0,3),[1]),r),s=Ku(dy(n.shape.slice(0,3),[1]),i),u=so([o,a,s],3);return Fo(n,u)})}function rb(n){return 1/(1+Math.exp(-n))}var pp=function(n){return typeof n=="number"};function az(n){if(!n)throw new Error("invalid config: "+n);if(typeof n.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+n.withSeparableConvs);if(!pp(n.iouThreshold)||n.iouThreshold<0||n.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+n.iouThreshold);if(!Array.isArray(n.classes)||!n.classes.length||!n.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(n.classes));if(!Array.isArray(n.anchors)||!n.anchors.length||!n.anchors.map(function(e){return e||{}}).every(function(e){return pp(e.x)&&pp(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(n.anchors));if(n.meanRgb&&(!Array.isArray(n.meanRgb)||n.meanRgb.length!==3||!n.meanRgb.every(pp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(n.meanRgb))}function v_(n){return _n(function(){var e=$n(n,Ct(.10000000149011612));return uo(cg(Fo(n,e)),e)})}function Ts(n,e){return _n(function(){var t=Za(n,[[0,0],[1,1],[1,1],[0,0]]);return t=ll(t,e.conv.filters,[1,1],"valid"),t=Fo(t,e.bn.sub),t=$n(t,e.bn.truediv),t=uo(t,e.conv.bias),v_(t)})}function Ms(n,e){return _n(function(){var t=Za(n,[[0,0],[1,1],[1,1],[0,0]]);return t=hM(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=uo(t,e.bias),v_(t)})}function sz(n,e){var t=mg(n,e);function r(a,s){var u=Bo(n(a)),l=Bo(n(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function i(a,s,u){var l=t(a,s,3,u+"/conv"),c=r(s,u+"/bn");return{conv:l,bn:c}}var o=p_(n,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function uz(n,e,t,r){var i=ns(n),o=i.extractWeights,a=i.getRemainingWeights,s=[],u=sz(o,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,f;if(e.withSeparableConvs){var m=r[0],g=r[1],w=r[2],v=r[3],y=r[4],x=r[5],E=r[6],_=r[7],k=r[8],C=e.isFirstLayerConv2d?l(m,g,3,"conv0"):h(m,g,"conv0"),A=h(g,w,"conv1"),I=h(w,v,"conv2"),T=h(v,y,"conv3"),R=h(y,x,"conv4"),N=h(x,E,"conv5"),O=_?h(E,_,"conv6"):void 0,V=k?h(_,k,"conv7"):void 0,F=l(k||_||E,5*t,1,"conv8");f={conv0:C,conv1:A,conv2:I,conv3:T,conv4:R,conv5:N,conv6:O,conv7:V,conv8:F}}else{var m=r[0],g=r[1],w=r[2],v=r[3],y=r[4],x=r[5],E=r[6],_=r[7],k=r[8],C=c(m,g,"conv0"),A=c(g,w,"conv1"),I=c(w,v,"conv2"),T=c(v,y,"conv3"),R=c(y,x,"conv4"),N=c(x,E,"conv5"),O=c(E,_,"conv6"),V=c(_,k,"conv7"),F=l(k,5*t,1,"conv8");f={conv0:C,conv1:A,conv2:I,conv3:T,conv4:R,conv5:N,conv6:O,conv7:V,conv8:F}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}function lz(n,e){var t=su(n,e);function r(s){var u=t(s+"/sub",1),l=t(s+"/truediv",1);return{sub:u,truediv:l}}function i(s){var u=t(s+"/filters",4),l=t(s+"/bias",1);return{filters:u,bias:l}}function o(s){var u=i(s+"/conv"),l=r(s+"/bn");return{conv:u,bn:l}}var a=m_(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function cz(n,e){var t=[],r=lz(n,t),i=r.extractConvParams,o=r.extractConvWithBatchNormParams,a=r.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return ts(n,t),{params:s,paramMappings:t}}var TE;(function(n){n[n.XS=224]="XS",n[n.SM=320]="SM",n[n.MD=416]="MD",n[n.LG=608]="LG"})(TE||(TE={}));var y_=(function(){function n(e){var t=e===void 0?{}:e,r=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=r||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(n.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),n})(),KM=(function(n){Yt(e,n);function e(t){var r=n.call(this,"TinyYolov2")||this;return az(t),r._config=t,r}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,r){var i=Ts(t,r.conv0);return i=Ri(i,[2,2],[2,2],"same"),i=Ts(i,r.conv1),i=Ri(i,[2,2],[2,2],"same"),i=Ts(i,r.conv2),i=Ri(i,[2,2],[2,2],"same"),i=Ts(i,r.conv3),i=Ri(i,[2,2],[2,2],"same"),i=Ts(i,r.conv4),i=Ri(i,[2,2],[2,2],"same"),i=Ts(i,r.conv5),i=Ri(i,[2,2],[1,1],"same"),i=Ts(i,r.conv6),i=Ts(i,r.conv7),Oo(i,r.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,r){var i=this.config.isFirstLayerConv2d?v_(Oo(t,r.conv0,"valid",!1)):Ms(t,r.conv0);return i=Ri(i,[2,2],[2,2],"same"),i=Ms(i,r.conv1),i=Ri(i,[2,2],[2,2],"same"),i=Ms(i,r.conv2),i=Ri(i,[2,2],[2,2],"same"),i=Ms(i,r.conv3),i=Ri(i,[2,2],[2,2],"same"),i=Ms(i,r.conv4),i=Ri(i,[2,2],[2,2],"same"),i=Ms(i,r.conv5),i=Ri(i,[2,2],[1,1],"same"),i=r.conv6?Ms(i,r.conv6):i,i=r.conv7?Ms(i,r.conv7):i,Oo(i,r.conv8,"valid",!1)},e.prototype.forwardInput=function(t,r){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return _n(function(){var a=t.toBatchTensor(r,!1).toFloat();return a=i.config.meanRgb?Id(a,i.config.meanRgb):a,a=a.div(Ct(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},e.prototype.forward=function(t,r){return It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,_r(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,r){return r===void 0&&(r={}),It(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,f,m,g,w,v,y,x=this;return Dt(this,function(E){switch(E.label){case 0:return i=new y_(r),o=i.inputSize,a=i.scoreThreshold,[4,_r(t)];case 1:return s=E.sent(),[4,this.forwardInput(s,o)];case 2:return u=E.sent(),l=_n(function(){return ng(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return h=E.sent(),u.dispose(),l.dispose(),f=h.map(function(_){return _.box}),m=h.map(function(_){return _.score}),g=h.map(function(_){return _.classScore}),w=h.map(function(_){return x.config.classes[_.label]}),v=rd(f.map(function(_){return _.rescale(o)}),m,this.config.iouThreshold,!0),y=v.map(function(_){return new BM(m[_],g[_],w[_],f[_],c)}),[2,y]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return cz(t,this.config)},e.prototype.extractParams=function(t){var r=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=r?r.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return uz(t,this.config,this.boxEncodingSize,r)},e.prototype.extractBoxes=function(t,r,i){return It(this,void 0,void 0,function(){var o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,A,I,T,R,N,O,V,F,B,U,P,L=this;return Dt(this,function(H){switch(H.label){case 0:return o=r.width,a=r.height,s=Math.max(o,a),u=s/o,l=s/a,c=t.shape[1],h=this.config.anchors.length,f=_n(function(){var W=t.reshape([c,c,h,L.boxEncodingSize]),z=W.slice([0,0,0,0],[c,c,h,4]),q=W.slice([0,0,0,4],[c,c,h,1]),re=L.withClassScores?ag(W.slice([0,0,0,5],[c,c,h,L.config.classes.length]),3):Ct(0);return[z,q,re]}),m=f[0],g=f[1],w=f[2],v=[],[4,g.array()];case 1:return y=H.sent(),[4,m.array()];case 2:x=H.sent(),E=0,H.label=3;case 3:if(!(E<c))return[3,12];_=0,H.label=4;case 4:if(!(_<c))return[3,11];k=0,H.label=5;case 5:return k<h?(C=rb(y[E][_][k][0]),!i||C>i?(A=(_+rb(x[E][_][k][0]))/c*u,I=(E+rb(x[E][_][k][1]))/c*l,T=Math.exp(x[E][_][k][2])*this.config.anchors[k].x/c*u,R=Math.exp(x[E][_][k][3])*this.config.anchors[k].y/c*l,N=A-T/2,O=I-R/2,V={row:E,col:_,anchor:k},this.withClassScores?[4,this.extractPredictedClass(w,V)]:[3,7]):[3,9]):[3,10];case 6:return P=H.sent(),[3,8];case 7:P={classScore:1,label:0},H.label=8;case 8:F=P,B=F.classScore,U=F.label,v.push(No({box:new pg(N,O,N+T,O+R),score:C,classScore:C*B,label:U},V)),H.label=9;case 9:return k++,[3,5];case 10:return _++,[3,4];case 11:return E++,[3,3];case 12:return m.dispose(),g.dispose(),w.dispose(),[2,v]}})})},e.prototype.extractPredictedClass=function(t,r){return It(this,void 0,void 0,function(){var i,o,a,s;return Dt(this,function(u){switch(u.label){case 0:return i=r.row,o=r.col,a=r.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[i][o][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(rs);function Ls(n,e,t){if(t===void 0&&(t=!1),n.beginPath(),e.slice(1).forEach(function(o,a){var s=o.x,u=o.y,l=e[a];n.moveTo(l.x,l.y),n.lineTo(s,u)}),t){var r=e[e.length-1],i=e[0];if(!r||!i)return;n.moveTo(r.x,r.y),n.lineTo(i.x,i.y)}n.stroke()}var lo=(function(n){Yt(e,n);function e(t,r,i){return n.call(this,t,t,"",r,i)||this}return e.prototype.forSize=function(t,r){var i=n.prototype.forSize.call(this,t,r),o=i.score,a=i.relativeBox,s=i.imageDims;return new e(o,a,s)},e})(BM);function Bm(n){return n.detection instanceof lo}function b_(n,e){var t={detection:e};return Object.assign({},n,t)}function hz(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var i=r instanceof lo?r.score:Bm(r)?r.detection.score:void 0,o=r instanceof lo?r.box:Bm(r)?r.detection.box:new da(r),a=i?""+a_(i):void 0;new jM(o,{label:a}).draw(n)})}function Bi(n,e,t){return At(function(){var r=fT(n,e.depthwise_filter,e.pointwise_filter,t,"same");return r=wn(r,e.bias),r})}function ib(n,e,t){return t===void 0&&(t=!1),At(function(){var r=er(t?wn(Ka(n,e.conv0.filters,[2,2],"same"),e.conv0.bias):Bi(n,e.conv0,[2,2])),i=Bi(r,e.conv1,[1,1]),o=er(wn(r,i)),a=Bi(o,e.conv2,[1,1]);return er(wn(r,wn(i,a)))})}function mp(n,e,t,r){return t===void 0&&(t=!1),r===void 0&&(r=!0),At(function(){var i=er(t?wn(Ka(n,e.conv0.filters,r?[2,2]:[1,1],"same"),e.conv0.bias):Bi(n,e.conv0,r?[2,2]:[1,1])),o=Bi(i,e.conv1,[1,1]),a=er(wn(i,o)),s=Bi(a,e.conv2,[1,1]),u=er(wn(i,wn(o,s))),l=Bi(u,e.conv3,[1,1]);return er(wn(i,wn(o,wn(s,l))))})}function JM(n,e){var t=mg(n,e),r=p_(n,e);function i(a,s,u,l){l===void 0&&(l=!1);var c=l?t(a,s,3,u+"/conv0"):r(a,s,u+"/conv0"),h=r(s,s,u+"/conv1"),f=r(s,s,u+"/conv2");return{conv0:c,conv1:h,conv2:f}}function o(a,s,u,l){l===void 0&&(l=!1);var c=i(a,s,u,l),h=c.conv0,f=c.conv1,m=c.conv2,g=r(s,s,u+"/conv3");return{conv0:h,conv1:f,conv2:m,conv3:g}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function dz(n){var e=[],t=ns(n),r=t.extractWeights,i=t.getRemainingWeights,o=JM(r,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function QM(n){return function(e){var t=n(e+"/filters",4),r=n(e+"/bias",1);return{filters:t,bias:r}}}function ZM(n,e){var t=su(n,e),r=QM(t),i=m_(t);function o(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2");return{conv0:l,conv1:c,conv2:h}}function a(s,u){u===void 0&&(u=!1);var l=u?r(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2"),f=i(s+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function fz(n){var e=[],t=ZM(n,e).extractDenseBlock4Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return ts(n,e),{params:r,paramMappings:e}}var eR=(function(n){Yt(e,n);function e(){return n.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceFeatureExtractor - load model before inference");return At(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Id(i,o).div(dt(255)),s=mp(a,r.dense0,!0);return s=mp(s,r.dense1),s=mp(s,r.dense2),s=mp(s,r.dense3),s=Sd(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return fz(t)},e.prototype.extractParams=function(t){return dz(t)},e})(rs);function sa(n,e){return At(function(){return wn(Rw(n,e.weights),e.bias)})}function pz(n,e,t){var r=[],i=ns(n),o=i.extractWeights,a=i.getRemainingWeights,s=f_(o,r),u=s(e,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:r,params:{fc:u}}}function mz(n){var e=[],t=su(n,e);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:r("fc")};return ts(n,e),{params:i,paramMappings:e}}function tR(n){var e={},t={};return Object.keys(n).forEach(function(r){var i=r.startsWith("fc")?t:e;i[r]=n[r]}),{featureExtractorMap:e,classifierMap:t}}var nR=(function(n){Yt(e,n);function e(t,r){var i=n.call(this,t)||this;return i._faceFeatureExtractor=r,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return At(function(){var o=t instanceof Lm?r.faceFeatureExtractor.forwardInput(t):t;return sa(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return pz(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var r=tR(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),mz(o)},e.prototype.extractParams=function(t){var r=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*r+i,a=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e})(rs),ME=["neutral","happy","sad","angry","fearful","disgusted","surprised"],w_=(function(){function n(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);ME.forEach(function(r,i){t[r]=e[i]})}return n.prototype.asSortedArray=function(){var e=this;return ME.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,r){return r.probability-t.probability})},n})(),gz=(function(n){Yt(e,n);function e(t){return t===void 0&&(t=new eR),n.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var r=this;return At(function(){return iu(r.runNet(t))})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return It(this,void 0,void 0,function(){var r,i,o,a,s=this;return Dt(this,function(u){switch(u.label){case 0:return[4,_r(t)];case 1:return r=u.sent(),[4,this.forwardInput(r)];case 2:return i=u.sent(),[4,Promise.all(Tr(i).map(function(l){return It(s,void 0,void 0,function(){var c;return Dt(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),a=o.map(function(l){return new w_(l)}),[2,r.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})(nR);function vz(n){return n.expressions instanceof w_}function rR(n,e){var t={expressions:e};return Object.assign({},n,t)}function yz(n,e,t,r){t===void 0&&(t=.1);var i=Array.isArray(e)?e:[e];i.forEach(function(o){var a=o instanceof w_?o:vz(o)?o.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=a.asSortedArray(),u=s.filter(function(h){return h.probability>t}),l=Bm(o)?o.detection.box.bottomLeft:r||new yn(0,0),c=new d_(u.map(function(h){return h.expression+" ("+a_(h.probability)+")"}),l);c.draw(n)})}function bz(n){var e=n.map(function(s){return s.x}),t=n.map(function(s){return s.y}),r=e.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new pg(r,i,o,a)}var wz=.5,_z=.43,xz=.45,id=(function(){function n(e,t,r){r===void 0&&(r=new yn(0,0));var i=t.width,o=t.height;this._imgDims=new Mc(i,o),this._shift=r,this._positions=e.map(function(a){return a.mul(new yn(i,o)).add(r)})}return Object.defineProperty(n.prototype,"shift",{get:function(){return new yn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new yn(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),n.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},n.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new yn(e,t))},n.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},n.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var r=e instanceof lo?e.box.floor():new da(e);return this.shiftBy(r.x,r.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},n.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],r=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},a=(o(t)+o(r))/2,s=Math.floor(a/xz),u=s_(e),l=Math.floor(Math.max(0,u.x-wz*s)),c=Math.floor(Math.max(0,u.y-_z*s));return new u_(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},n.prototype.alignMinBbox=function(e){var t=bz(this.positions);return t.pad(t.width*e,t.height*e)},n.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},n})(),iR=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(s_)},e})(id);function oR(n){return Bm(n)&&n.landmarks instanceof id&&n.unshiftedLandmarks instanceof id&&n.alignedRect instanceof lo}function __(n,e){var t=n.detection.box,r=e.shiftBy(t.x,t.y),i=r.align(),o=n.detection.imageDims,a=new lo(n.detection.score,i.rescale(o.reverse()),o),s={landmarks:r,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},n,s)}var aR=(function(){function n(e){e===void 0&&(e={});var t=e.drawLines,r=t===void 0?!0:t,i=e.drawPoints,o=i===void 0?!0:i,a=e.lineWidth,s=e.lineColor,u=e.pointSize,l=e.pointColor;this.drawLines=r,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=l||"rgba(255, 0, 255, 1)"}return n})(),sR=(function(){function n(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new aR(t)}return n.prototype.draw=function(e){var t=fa(e),r=this.options,i=r.drawLines,o=r.drawPoints,a=r.lineWidth,s=r.lineColor,u=r.pointSize,l=r.pointColor;if(i&&this.faceLandmarks instanceof iR&&(t.strokeStyle=s,t.lineWidth=a,Ls(t,this.faceLandmarks.getJawOutline()),Ls(t,this.faceLandmarks.getLeftEyeBrow()),Ls(t,this.faceLandmarks.getRightEyeBrow()),Ls(t,this.faceLandmarks.getNose()),Ls(t,this.faceLandmarks.getLeftEye(),!0),Ls(t,this.faceLandmarks.getRightEye(),!0),Ls(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=l,t.fillStyle=l;var c=function(h){t.beginPath(),t.arc(h.x,h.y,u,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(c)}},n})();function Sz(n,e){var t=Array.isArray(e)?e:[e];t.forEach(function(r){var i=r instanceof id?r:oR(r)?r.landmarks:void 0;if(!i)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new sR(i).draw(n)})}const Ez=Object.freeze(Object.defineProperty({__proto__:null,DrawFaceLandmarks:sR,DrawFaceLandmarksOptions:aR,drawContour:Ls,drawDetections:hz,drawFaceExpressions:yz,drawFaceLandmarks:Sz},Symbol.toStringTag,{value:"Module"}));function kz(n,e){var t=mg(n,e),r=p_(n,e);function i(a,s,u){var l=r(a,s,u+"/separable_conv0"),c=r(s,s,u+"/separable_conv1"),h=t(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function o(a,s){var u=r(a,a,s+"/separable_conv0"),l=r(a,a,s+"/separable_conv1"),c=r(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:r,extractReductionBlockParams:i,extractMainBlockParams:o}}function Cz(n,e){var t=[],r=ns(n),i=r.extractWeights,o=r.getRemainingWeights,a=kz(i,t),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),m=l(64,128,"entry_flow/reduction_block_1"),g={conv_in:h,reduction_block_0:f,reduction_block_1:m},w={};nd(e,0,1).forEach(function(E){w["main_block_"+E]=c(128,"middle_flow/main_block_"+E)});var v=l(128,256,"exit_flow/reduction_block"),y=u(256,512,"exit_flow/separable_conv"),x={reduction_block:v,separable_conv:y};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:g,middle_flow:w,exit_flow:x}}}function Tz(n,e){var t=su(n,e),r=QM(t),i=m_(t);function o(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=r(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=i(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:r,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function Mz(n,e){var t=[],r=Tz(n,t),i=r.extractConvParams,o=r.extractSeparableConvParams,a=r.extractReductionBlockParams,s=r.extractMainBlockParams,u=i("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};nd(e,0,1).forEach(function(v){f["main_block_"+v]=s("middle_flow/main_block_"+v)});var m=a("exit_flow/reduction_block"),g=o("exit_flow/separable_conv"),w={reduction_block:m,separable_conv:g};return ts(n,t),{params:{entry_flow:h,middle_flow:f,exit_flow:w},paramMappings:t}}function uR(n,e,t){return wn(Ka(n,e.filters,t,"same"),e.bias)}function ob(n,e,t){t===void 0&&(t=!0);var r=t?er(n):n;return r=Bi(r,e.separable_conv0,[1,1]),r=Bi(er(r),e.separable_conv1,[1,1]),r=Pc(r,[3,3],[2,2],"same"),r=wn(r,uR(n,e.expansion_conv,[2,2])),r}function Rz(n,e){var t=Bi(er(n),e.separable_conv0,[1,1]);return t=Bi(er(t),e.separable_conv1,[1,1]),t=Bi(er(t),e.separable_conv2,[1,1]),t=wn(t,n),t}var Az=(function(n){Yt(e,n);function e(t){var r=n.call(this,"TinyXception")||this;return r._numMainBlocks=t,r}return e.prototype.forwardInput=function(t){var r=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return At(function(){var o=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Id(o,a).div(dt(256)),u=er(uR(s,i.entry_flow.conv_in,[2,2]));return u=ob(u,i.entry_flow.reduction_block_0,!1),u=ob(u,i.entry_flow.reduction_block_1),nd(r._numMainBlocks,0,1).forEach(function(l){u=Rz(u,i.middle_flow["main_block_"+l])}),u=ob(u,i.exit_flow.reduction_block),u=er(Bi(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Mz(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return Cz(t,this._numMainBlocks)},e})(rs);function Iz(n){var e=[],t=ns(n),r=t.extractWeights,i=t.getRemainingWeights,o=f_(r,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function Dz(n){var e=[],t=su(n,e);function r(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:r("fc/age"),gender:r("fc/gender")}};return ts(n,e),{params:i,paramMappings:e}}var Um;(function(n){n.FEMALE="female",n.MALE="male"})(Um||(Um={}));var Nz=(function(n){Yt(e,n);function e(t){t===void 0&&(t=new Az(2));var r=n.call(this,"AgeGenderNet")||this;return r._faceFeatureExtractor=t,r}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var r=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return At(function(){var o=t instanceof Lm?r.faceFeatureExtractor.forwardInput(t):t,a=Sd(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=sa(a,i.fc.age).as1D(),u=sa(a,i.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(t){var r=this;return At(function(){var i=r.runNet(t),o=i.age,a=i.gender;return{age:o,gender:iu(a)}})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return It(this,void 0,void 0,function(){var r,i,o,a,s,u,l=this;return Dt(this,function(c){switch(c.label){case 0:return[4,_r(t)];case 1:return r=c.sent(),[4,this.forwardInput(r)];case 2:return i=c.sent(),o=Tr(i.age),a=Tr(i.gender),s=o.map(function(h,f){return{ageTensor:h,genderTensor:a[f]}}),[4,Promise.all(s.map(function(h){var f=h.ageTensor,m=h.genderTensor;return It(l,void 0,void 0,function(){var g,w,v,y,x;return Dt(this,function(E){switch(E.label){case 0:return[4,f.data()];case 1:return g=E.sent()[0],[4,m.data()];case 2:return w=E.sent()[0],v=w>.5,y=v?Um.MALE:Um.FEMALE,x=v?w:1-w,f.dispose(),m.dispose(),[2,{age:g,gender:y,genderProbability:x}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,r.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),n.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var r=this.extractClassifierParams(t),i=r.params,o=r.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return Iz(t)},e.prototype.extractParamsFromWeigthMap=function(t){var r=tR(t),i=r.featureExtractorMap,o=r.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),Dz(o)},e.prototype.extractParams=function(t){var r=1539,i=t.slice(0,t.length-r),o=t.slice(t.length-r);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e})(rs),Pz=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],s_([t[3],t[4]])]},e})(id),RE=(function(){function n(e,t){this._label=e,this._distance=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),n.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+a_(this.distance)+")":"")},n})(),ab=(function(){function n(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(r){return!(r instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(n.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),n})();function x_(n,e){return It(this,void 0,void 0,function(){var t,r,i,o,a,s,u;return Dt(this,function(l){switch(l.label){case 0:return t=qr.getEnv().Canvas,r=n,n instanceof t?[3,5]:[4,_r(n)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(a=o,[3,4]):[3,2];case 2:return[4,tz(o)];case 3:a=l.sent(),l.label=4;case 4:r=a,l.label=5;case 5:return s=fa(r),u=e.map(function(c){return c instanceof lo?c.forSize(r.width,r.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(r.width,r.height)}),[2,u.map(function(c){var h=c.x,f=c.y,m=c.width,g=c.height,w=gg({width:m,height:g});return fa(w).putImageData(s.getImageData(h,f,m,g),0,0),w})]}})})}function S_(n,e){return It(this,void 0,void 0,function(){return Dt(this,function(t){if(!fg(n)&&!qs(n))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(qs(n)&&n.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,At(function(){var r=n.shape.slice(qs(n)?1:0),i=r[0],o=r[1],a=r[2],s=e.map(function(l){return l instanceof lo?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=s.map(function(l){var c=l.x,h=l.y,f=l.width,m=l.height;return gT(n.as3D(i,o,a),[h,c,0],[m,f,a])});return u})]})})}var lR=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.postProcess=function(t,r,i){var o=i.map(function(s){var u=s.width,l=s.height,c=r/Math.max(l,u);return{width:u*c,height:l*c}}),a=o.length;return At(function(){var s=function(f,m){return Po([vc([68],f),vc([68],m)],1).as2D(1,136).as1D()},u=function(f,m){var g=o[f],w=g.width,v=g.height;return m(w,v)?Math.abs(w-v)/2:0},l=function(f){return u(f,function(m,g){return m<g})},c=function(f){return u(f,function(m,g){return g<m})},h=t.mul(vc([a,136],r)).sub(Po(Array.from(Array(a),function(f,m){return s(l(m),c(m))}))).div(Po(Array.from(Array(a),function(f,m){return s(o[m].width,o[m].height)})));return h})},e.prototype.forwardInput=function(t){var r=this;return At(function(){var i=r.runNet(t);return r.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return It(this,void 0,void 0,function(){var r,i,o,a=this;return Dt(this,function(s){switch(s.label){case 0:return[4,_r(t)];case 1:return r=s.sent(),i=At(function(){return Tr(a.forwardInput(r))}),[4,Promise.all(i.map(function(u,l){return It(a,void 0,void 0,function(){var c,h,f,m,g;return Dt(this,function(w){switch(w.label){case 0:return f=(h=Array).from,[4,u.data()];case 1:return c=f.apply(h,[w.sent()]),m=c.filter(function(v,y){return xE(y)}),g=c.filter(function(v,y){return!xE(y)}),[2,new iR(Array(68).fill(0).map(function(v,y){return new yn(m[y],g[y])}),{height:r.getInputHeight(l),width:r.getInputWidth(l)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})(nR),cR=(function(n){Yt(e,n);function e(t){return t===void 0&&(t=new eR),n.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(lR);function Fz(n){var e=[],t=ZM(n,e).extractDenseBlock3Params,r={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return ts(n,e),{params:r,paramMappings:e}}function Oz(n){var e=[],t=ns(n),r=t.extractWeights,i=t.getRemainingWeights,o=JM(r,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var Lz=(function(n){Yt(e,n);function e(){return n.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("TinyFaceFeatureExtractor - load model before inference");return At(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Id(i,o).div(dt(255)),s=ib(a,r.dense0,!0);return s=ib(s,r.dense1),s=ib(s,r.dense2),s=Sd(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Fz(t)},e.prototype.extractParams=function(t){return Oz(t)},e})(rs),Bz=(function(n){Yt(e,n);function e(t){return t===void 0&&(t=new Lz),n.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(lR);(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(cR);function Uz(n,e){return wn(Ua(n,e.weights),e.biases)}function E_(n,e,t,r,i){i===void 0&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=Ka(n,a,t,i);return u=wn(u,s),u=Uz(u,e.scale),r?er(u):u}function zz(n,e){return E_(n,e,[1,1],!0)}function hR(n,e){return E_(n,e,[1,1],!1)}function dR(n,e){return E_(n,e,[2,2],!0,"valid")}function Wz(n,e){function t(s,u,l){var c=n(s),h=c.length/(u*l*l);if($9(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return At(function(){return Ys(ko(c,[u,h,l,l]),[2,3,1,0])})}function r(s,u,l,c){var h=t(s,u,l),f=fi(n(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:f}}function i(s,u){var l=fi(n(s)),c=fi(n(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(s,u,l,c){var h=r(s,u,l,c+"/conv"),f=i(u,c+"/scale");return{conv:h,scale:f}}function a(s,u,l,c,h){h===void 0&&(h=!1);var f=o((h?.5:1)*s,u,l,c+"/conv1"),m=o(s,u,l,c+"/conv2");return{conv1:f,conv2:m}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function Hz(n){var e=ns(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=Wz(t,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),m=s(36864,64,3,"conv64_1"),g=s(36864,64,3,"conv64_2"),w=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),E=s(589824,256,3,"conv256_down",!0),_=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),A=At(function(){return Ys(md(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),r().length!==0)throw new Error("weights remaing after extract: "+r().length);var I={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:f,conv64_1:m,conv64_2:g,conv64_3:w,conv128_down:v,conv128_1:y,conv128_2:x,conv256_down:E,conv256_1:_,conv256_2:k,conv256_down_out:C,fc:A};return{params:I,paramMappings:i}}function Gz(n,e){var t=su(n,e);function r(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function i(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),l=r(a);return{conv:{filters:s,bias:u},scale:l}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function Vz(n){var e=[],t=Gz(n,e),r=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=r("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),h=i("conv64_2"),f=i("conv64_3"),m=i("conv128_down"),g=i("conv128_1"),w=i("conv128_2"),v=i("conv256_down"),y=i("conv256_1"),x=i("conv256_2"),E=i("conv256_down_out"),_=n.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!q9(_))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);var k={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:f,conv128_down:m,conv128_1:g,conv128_2:w,conv256_down:v,conv256_1:y,conv256_2:x,conv256_down_out:E,fc:_};return ts(n,e),{params:k,paramMappings:e}}function Xo(n,e){var t=zz(n,e.conv1);return t=hR(t,e.conv2),t=wn(t,n),t=er(t),t}function gp(n,e){var t=dR(n,e.conv1);t=hR(t,e.conv2);var r=Sd(n,2,2,"valid"),i=Wn(r.shape),o=r.shape[3]!==t.shape[3],a=r.shape[1]!==t.shape[1]||r.shape[2]!==t.shape[2];if(a){var s=t.shape.slice();s[1]=1;var u=Wn(s);t=Vr([t,u],1);var l=t.shape.slice();l[2]=1;var c=Wn(l);t=Vr([t,c],2)}return r=o?Vr([r,i],3):r,t=wn(r,t),t=er(t),t}var jz=(function(n){Yt(e,n);function e(){return n.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("FaceRecognitionNet - load model before inference");return At(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=Id(i,o).div(dt(256)),s=dR(a,r.conv32_down);s=Pc(s,3,2,"valid"),s=Xo(s,r.conv32_1),s=Xo(s,r.conv32_2),s=Xo(s,r.conv32_3),s=gp(s,r.conv64_down),s=Xo(s,r.conv64_1),s=Xo(s,r.conv64_2),s=Xo(s,r.conv64_3),s=gp(s,r.conv128_down),s=Xo(s,r.conv128_1),s=Xo(s,r.conv128_2),s=gp(s,r.conv256_down),s=Xo(s,r.conv256_1),s=Xo(s,r.conv256_2),s=gp(s,r.conv256_down_out);var u=s.mean([1,2]),l=Rw(u,r.fc);return l})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return It(this,void 0,void 0,function(){var r,i,o,a=this;return Dt(this,function(s){switch(s.label){case 0:return[4,_r(t)];case 1:return r=s.sent(),i=At(function(){return Tr(a.forwardInput(r))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,r.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Vz(t)},e.prototype.extractParams=function(t){return Hz(t)},e})(rs);function fR(n,e){var t={descriptor:e};return Object.assign({},n,t)}var pR=(function(){function n(e){var t=e===void 0?{}:e,r=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=r||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(n.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),n})();function qz(n,e){function t(u,l){var c=ko(n(9*u),[3,3,u,1]),h=fi(n(u)),f=fi(n(u)),m=fi(n(u)),g=fi(n(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:m,batch_norm_variance:g}}function r(u,l,c,h,f){var m=ko(n(u*l*c*c),[c,c,u,l]),g=fi(n(l));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:m,bias:g}}function i(u,l,c,h){var f=r(u,l,c,h,!0),m=f.filters,g=f.bias;return{filters:m,batch_norm_offset:g}}function o(u,l,c){var h=t(u,c+"/depthwise_conv"),f=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function a(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),m=o(256,256,"mobilenetv1/conv_5"),g=o(256,512,"mobilenetv1/conv_6"),w=o(512,512,"mobilenetv1/conv_7"),v=o(512,512,"mobilenetv1/conv_8"),y=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),E=o(512,512,"mobilenetv1/conv_11"),_=o(512,1024,"mobilenetv1/conv_12"),k=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:m,conv_6:g,conv_7:w,conv_8:v,conv_9:y,conv_10:x,conv_11:E,conv_12:_,conv_13:k}}function s(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),f=i(256,128,1,"prediction_layer/conv_4"),m=i(128,256,3,"prediction_layer/conv_5"),g=i(256,64,1,"prediction_layer/conv_6"),w=i(64,128,3,"prediction_layer/conv_7"),v=r(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),y=r(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=r(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),E=r(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),_=r(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=r(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=r(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),A=r(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),I=r(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),T=r(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),R=r(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=r(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),O={box_encoding_predictor:v,class_predictor:y},V={box_encoding_predictor:x,class_predictor:E},F={box_encoding_predictor:_,class_predictor:k},B={box_encoding_predictor:C,class_predictor:A},U={box_encoding_predictor:I,class_predictor:T},P={box_encoding_predictor:R,class_predictor:N};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:m,conv_6:g,conv_7:w,box_predictor_0:O,box_predictor_1:V,box_predictor_2:F,box_predictor_3:B,box_predictor_4:U,box_predictor_5:P}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function $z(n){var e=[],t=ns(n),r=t.extractWeights,i=t.getRemainingWeights,o=qz(r,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),l=s(),c=yw(r(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:e}}function Xz(n,e){var t=su(n,e);function r(l,c,h){var f=t(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),m=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:m}}function i(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",m=c+"/pointwise_conv",g=t(h+"/depthwise_weights",4,f+"/filters"),w=t(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),v=t(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),y=t(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),x=t(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:g,batch_norm_scale:w,batch_norm_offset:v,batch_norm_mean:y,batch_norm_variance:x},pointwise_conv:r("MobilenetV1",l,m)}}function o(){return{conv_0:r("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(l,c){var h=t(l+"/weights",4,c+"/filters"),f=t(l+"/biases",1,c+"/bias");return{filters:h,bias:f}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:r("Prediction",0,"prediction_layer/conv_0"),conv_1:r("Prediction",1,"prediction_layer/conv_1"),conv_2:r("Prediction",2,"prediction_layer/conv_2"),conv_3:r("Prediction",3,"prediction_layer/conv_3"),conv_4:r("Prediction",4,"prediction_layer/conv_4"),conv_5:r("Prediction",5,"prediction_layer/conv_5"),conv_6:r("Prediction",6,"prediction_layer/conv_6"),conv_7:r("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function Yz(n){var e=[],t=Xz(n,e),r=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=n["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!fg(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:r(),prediction_layer:i(),output_layer:{extra_dim:o}};return ts(n,e),{params:a,paramMappings:e}}function Qo(n,e,t){return At(function(){var r=Ka(n,e.filters,t,"same");return r=wn(r,e.batch_norm_offset),Tw(r,0,6)})}var Kz=.0010000000474974513;function Jz(n,e,t){return At(function(){var r=Mw(n,e.filters,t,"same");return r=lT(r,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,Kz),Tw(r,0,6)})}function Qz(n){return[2,4,6,12].some(function(e){return e===n})?[2,2]:[1,1]}function Zz(n,e){return At(function(){var t=null,r=Qo(n,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,a){var s=a+1,u=Qz(s);r=Jz(r,o.depthwise_conv,u),r=Qo(r,o.pointwise_conv,[1,1]),s===11&&(t=r)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:r,conv11:t}})}function eW(n,e,t,r,i){var o=n.shape[0],a=Math.min(t,o),s=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>i}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=r?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var h=c.score,f=l.length-1;f>=0;--f){var m=tW(n,c.boxIndex,l[f]);if(m!==0&&(c.score*=u(m),c.score<=i))break}h===c.score&&l.push(c.boxIndex)}}),l}function tW(n,e,t){var r=n.arraySync(),i=Math.min(r[e][0],r[e][2]),o=Math.min(r[e][1],r[e][3]),a=Math.max(r[e][0],r[e][2]),s=Math.max(r[e][1],r[e][3]),u=Math.min(r[t][0],r[t][2]),l=Math.min(r[t][1],r[t][3]),c=Math.max(r[t][0],r[t][2]),h=Math.max(r[t][1],r[t][3]),f=(a-i)*(s-o),m=(c-u)*(h-l);if(f<=0||m<=0)return 0;var g=Math.max(i,u),w=Math.max(o,l),v=Math.min(a,c),y=Math.min(s,h),x=Math.max(v-g,0)*Math.max(y-w,0);return x/(f+m-x)}function nW(n){var e=Tr(Ys(n,[1,0])),t=[_i(e[2],e[0]),_i(e[3],e[1])],r=[wn(e[0],Zo(t[0],dt(2))),wn(e[1],Zo(t[1],dt(2)))];return{sizes:t,centers:r}}function rW(n,e){var t=nW(n),r=t.sizes,i=t.centers,o=Tr(Ys(e,[1,0])),a=Zo(Ua(Zb(Zo(o[2],dt(5))),r[0]),dt(2)),s=wn(Ua(Zo(o[0],dt(10)),r[0]),i[0]),u=Zo(Ua(Zb(Zo(o[3],dt(5))),r[1]),dt(2)),l=wn(Ua(Zo(o[1],dt(10)),r[1]),i[1]);return Ys(Po([_i(s,a),_i(l,u),wn(s,a),wn(l,u)]),[1,0])}function iW(n,e,t){return At(function(){var r=n.shape[0],i=rW(Ro(yc(t.extra_dim,[r,1,1]),[-1,4]),Ro(n,[-1,4]));i=Ro(i,[r,i.shape[0]/r,4]);var o=oT(ha(e,[0,0,1],[-1,-1,-1])),a=ha(o,[0,0,0],[-1,-1,1]);a=Ro(a,[r,a.shape[1]]);var s=Tr(i),u=Tr(a);return{boxes:s,scores:u}})}function Hl(n,e){return At(function(){var t=n.shape[0],r=Ro(Oo(n,e.box_encoding_predictor),[t,-1,1,4]),i=Ro(Oo(n,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:r,classPrediction:i}})}function oW(n,e,t){return At(function(){var r=Qo(n,t.conv_0,[1,1]),i=Qo(r,t.conv_1,[2,2]),o=Qo(i,t.conv_2,[1,1]),a=Qo(o,t.conv_3,[2,2]),s=Qo(a,t.conv_4,[1,1]),u=Qo(s,t.conv_5,[2,2]),l=Qo(u,t.conv_6,[1,1]),c=Qo(l,t.conv_7,[2,2]),h=Hl(e,t.box_predictor_0),f=Hl(n,t.box_predictor_1),m=Hl(i,t.box_predictor_2),g=Hl(a,t.box_predictor_3),w=Hl(u,t.box_predictor_4),v=Hl(c,t.box_predictor_5),y=Vr([h.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding,w.boxPredictionEncoding,v.boxPredictionEncoding],1),x=Vr([h.classPrediction,f.classPrediction,m.classPrediction,g.classPrediction,w.classPrediction,v.classPrediction],1);return{boxPredictions:y,classPredictions:x}})}var vg=(function(){function n(e){var t=e===void 0?{}:e,r=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=r||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(n.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),n})(),mR=(function(n){Yt(e,n);function e(){return n.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var r=this.params;if(!r)throw new Error("SsdMobilenetv1 - load model before inference");return At(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=_i(Ua(i,dt(.007843137718737125)),dt(1)),a=Zz(o,r.mobilenetv1),s=oW(a.out,a.conv11,r.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return iW(u,l,r.output_layer)})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var r;return Dt(this,function(i){switch(i.label){case 0:return r=this.forwardInput,[4,_r(t)];case 1:return[2,r.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,r){return r===void 0&&(r={}),It(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,A,I;return Dt(this,function(T){switch(T.label){case 0:return i=new vg(r),o=i.maxResults,a=i.minConfidence,[4,_r(t)];case 1:for(s=T.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,h=l[0],f=c[0],m=1;m<l.length;m++)l[m].dispose(),c[m].dispose();return v=(w=Array).from,[4,f.data()];case 2:return g=v.apply(w,[T.sent()]),y=.5,x=eW(h,g,o,y,a),E=s.getReshapedInputDimensions(0),_=s.inputSize,k=_/E.width,C=_/E.height,A=h.arraySync(),I=x.map(function(R){var N=[Math.max(0,A[R][0]),Math.min(1,A[R][2])].map(function(P){return P*C}),O=N[0],V=N[1],F=[Math.max(0,A[R][1]),Math.min(1,A[R][3])].map(function(P){return P*k}),B=F[0],U=F[1];return new lo(g[R],new u_(B,O,U-B,V-O),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,I]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Yz(t)},e.prototype.extractParams=function(t){return $z(t)},e})(rs);(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e})(mR);var gR=(function(n){Yt(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(y_),Dd=(function(){function n(){}return n.prototype.then=function(e){return It(this,void 0,void 0,function(){var t;return Dt(this,function(r){switch(r.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[r.sent()])]}})})},n.prototype.run=function(){return It(this,void 0,void 0,function(){return Dt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},n})();function yg(n,e,t,r,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),It(this,void 0,void 0,function(){var o,a,s,u,l;return Dt(this,function(c){switch(c.label){case 0:return o=n.map(function(h){return oR(h)?i(h):h.detection}),s=r,s?[3,5]:e instanceof at?[4,S_(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,x_(e,o)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,t(a)];case 6:return l=c.sent(),a.forEach(function(h){return h instanceof at&&h.dispose()}),[2,l]}})})}function k_(n,e,t,r,i){return It(this,void 0,void 0,function(){var o=this;return Dt(this,function(a){return[2,yg([n],e,function(s){return It(o,void 0,void 0,function(){return Dt(this,function(u){return[2,t(s[0])]})})},r,i)]})})}function aW(n){return At(function(){return Po(Tr(n,3).reverse(),3)})}var vp=2,zm=12;function sW(n,e){var t=mg(n,e),r=f_(n,e);function i(l,c){var h=fi(n(l));return e.push({paramPath:c}),h}function o(l,c,h){h===void 0&&(h=!1);var f=t(l[0],l[1],3,c+"/conv1"),m=i(l[1],c+"/prelu1_alpha"),g=t(l[1],l[2],3,c+"/conv2"),w=i(l[2],c+"/prelu2_alpha"),v=t(l[2],l[3],h?2:3,c+"/conv3"),y=i(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:m,conv2:g,prelu2_alpha:w,conv3:v,prelu3_alpha:y}}function a(){var l=o([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return No({},l,{conv4_1:c,conv4_2:h})}function s(){var l=o([3,28,48,64],"rnet",!0),c=r(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),f=r(128,2,"rnet/fc2_1"),m=r(128,4,"rnet/fc2_2");return No({},l,{fc1:c,prelu4_alpha:h,fc2_1:f,fc2_2:m})}function u(){var l=o([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),f=r(1152,256,"onet/fc1"),m=i(256,"onet/prelu5_alpha"),g=r(256,2,"onet/fc2_1"),w=r(256,4,"onet/fc2_2"),v=r(256,10,"onet/fc2_3");return No({},l,{conv4:c,prelu4_alpha:h,fc1:f,prelu5_alpha:m,fc2_1:g,fc2_2:w,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function uW(n){var e=ns(n),t=e.extractWeights,r=e.getRemainingWeights,i=[],o=sW(t,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,l=a(),c=s(),h=u();if(r().length!==0)throw new Error("weights remaing after extract: "+r().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:i}}function lW(n,e){var t=su(n,e);function r(c){var h=t(c+"/weights",4,c+"/filters"),f=t(c+"/bias",1);return{filters:h,bias:f}}function i(c){var h=t(c+"/weights",2),f=t(c+"/bias",1);return{weights:h,bias:f}}function o(c){return t(c,1)}function a(c){var h=r(c+"/conv1"),f=o(c+"/prelu1_alpha"),m=r(c+"/conv2"),g=o(c+"/prelu2_alpha"),w=r(c+"/conv3"),v=o(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:m,prelu2_alpha:g,conv3:w,prelu3_alpha:v}}function s(){var c=a("pnet"),h=r("pnet/conv4_1"),f=r("pnet/conv4_2");return No({},c,{conv4_1:h,conv4_2:f})}function u(){var c=a("rnet"),h=i("rnet/fc1"),f=o("rnet/prelu4_alpha"),m=i("rnet/fc2_1"),g=i("rnet/fc2_2");return No({},c,{fc1:h,prelu4_alpha:f,fc2_1:m,fc2_2:g})}function l(){var c=a("onet"),h=r("onet/conv4"),f=o("onet/prelu4_alpha"),m=i("onet/fc1"),g=o("onet/prelu5_alpha"),w=i("onet/fc2_1"),v=i("onet/fc2_2"),y=i("onet/fc2_3");return No({},c,{conv4:h,prelu4_alpha:f,fc1:m,prelu5_alpha:g,fc2_1:w,fc2_2:v,fc2_3:y})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function cW(n){var e=[],t=lW(n,e),r=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,a=r(),s=i(),u=o();return ts(n,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function S0(n,e){var t=e[0],r=e[1];return{height:Math.floor(t*n),width:Math.floor(r*n)}}function hW(n,e,t){for(var r=t[0],i=t[1],o=zm/n,a=[],s=Math.min(r,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s=s*e,u+=1;return a}var C_=(function(n){Yt(e,n);function e(t,r,i,o){return n.call(this,{left:t,top:r,right:i,bottom:o},!0)||this}return e})(da);function vR(n){return At(function(){return Ua(_i(n,dt(127.5)),dt(.0078125))})}function Rc(n,e){return At(function(){return wn(er(n),Ua(e,mm(er(mm(n)))))})}function T_(n,e,t){return t===void 0&&(t=!1),At(function(){var r=Oo(n,e.conv1,"valid");return r=Rc(r,e.prelu1_alpha),r=Pc(r,t?[2,2]:[3,3],[2,2],"same"),r=Oo(r,e.conv2,"valid"),r=Rc(r,e.prelu2_alpha),r=t?r:Pc(r,[3,3],[2,2],"valid"),r=Oo(r,e.conv3,"valid"),r=Rc(r,e.prelu3_alpha),r})}function dW(n,e){return At(function(){var t=T_(n,e,!0),r=Oo(t,e.conv4_1,"valid"),i=Zi(Zm(r,3),3),o=iu(_i(r,i),3),a=Oo(t,e.conv4_2,"valid");return{prob:o,regions:a}})}function fW(n,e){return At(function(){var t=S0(e,n.shape.slice(1)),r=t.height,i=t.width,o=PT.resizeBilinear(n,[r,i]),a=vR(o);return Ys(a,[0,2,1,3])})}function pW(n,e,t,r){for(var i=[],o=n.arraySync(),a=0;a<n.shape[0];a++)for(var s=0;s<n.shape[1];s++)o[a][s]>=r&&i.push(new yn(s,a));var u=i.map(function(l){var c=new pg(Math.round((l.y*vp+1)/t),Math.round((l.x*vp+1)/t),Math.round((l.y*vp+zm)/t),Math.round((l.x*vp+zm)/t)),h=o[l.y][l.x],f=e.arraySync(),m=new C_(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:h,region:m}});return u}function mW(n,e,t,r,i){i.stage1=[];var o=e.map(function(f){return At(function(){var m={scale:f},g=fW(n,f),w=Date.now(),v=dW(g,r),y=v.prob,x=v.regions;m.pnet=Date.now()-w;var E=Tr(Tr(y,3)[1])[0],_=Tr(x)[0];return{scoresTensor:E,regionsTensor:_,scale:f,statsForScale:m}})}),a=o.map(function(f){var m=f.scoresTensor,g=f.regionsTensor,w=f.scale,v=f.statsForScale,y=pW(m,g,w,t);if(m.dispose(),g.dispose(),!y.length)return i.stage1.push(v),[];var x=Date.now(),E=rd(y.map(function(_){return _.cell}),y.map(function(_){return _.score}),.5);return v.nms=Date.now()-x,v.numBoxes=E.length,i.stage1.push(v),E.map(function(_){return y[_]})}),s=a.reduce(function(f,m){return f.concat(m)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),h=rd(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-c,l=h.map(function(f){return s[f].score}),u=h.map(function(f){return s[f]}).map(function(f){var m=f.cell,g=f.region;return new pg(m.left+g.left*m.width,m.top+g.top*m.height,m.right+g.right*m.width,m.bottom+g.bottom*m.height).toSquare().round()})}return{boxes:u,scores:l}}function yR(n,e,t){var r=t.width,i=t.height;return It(this,void 0,void 0,function(){var o,a,s,u=this;return Dt(this,function(l){switch(l.label){case 0:return o=fa(n),[4,Promise.all(e.map(function(c){return It(u,void 0,void 0,function(){var h,f,m,g,w,v,y,x;return Dt(this,function(E){return h=c.padAtBorders(n.height,n.width),f=h.y,m=h.ey,g=h.x,w=h.ex,v=g-1,y=f-1,x=o.getImageData(v,y,w-v,m-y),[2,qr.isNodejs()?g_(x):createImageBitmap(x)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var h=gg({width:r,height:i}),f=fa(h);f.drawImage(c,0,0,r,i);for(var m=f.getImageData(0,0,r,i).data,g=[],w=0;w<m.length;w+=4)g.push(m[w+2]),g.push(m[w+1]),g.push(m[w]);s.push(g)}),[2,s.map(function(c){var h=At(function(){var f=Ys(ko(c,[1,r,i,3]),[0,2,1,3]).toFloat();return vR(f)});return h})]}})})}function gW(n,e){return At(function(){var t=T_(n,e),r=Ro(t,[t.shape[0],e.fc1.weights.shape[0]]),i=sa(r,e.fc1),o=Rc(i,e.prelu4_alpha),a=sa(o,e.fc2_1),s=Zi(Zm(a,1),1),u=iu(_i(a,s),1),l=sa(o,e.fc2_2),c=Tr(u,1)[1];return{scores:c,regions:l}})}function vW(n,e,t,r,i){return It(this,void 0,void 0,function(){var o,a,s,u,l,c,h,f,m,g,w,v,y,x;return Dt(this,function(E){switch(E.label){case 0:return o=Date.now(),[4,yR(n,e,{width:24,height:24})];case 1:return a=E.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(_){var k=gW(_,r);return _.dispose(),k}),i.stage2_rnet=Date.now()-o,u=s.length>1?Vr(s.map(function(_){return _.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[E.sent()]),u.dispose(),f=l.map(function(_,k){return{score:_,idx:k}}).filter(function(_){return _.score>t}).map(function(_){var k=_.idx;return k}),m=f.map(function(_){return e[_]}),g=f.map(function(_){return l[_]}),w=[],v=[],m.length>0&&(o=Date.now(),y=rd(m,g,.7),i.stage2_nms=Date.now()-o,x=y.map(function(_){var k=s[f[_]].regions.arraySync();return new C_(k[0][0],k[0][1],k[0][2],k[0][3])}),v=y.map(function(_){return g[_]}),w=y.map(function(_,k){return m[_].calibrate(x[k])})),s.forEach(function(_){_.regions.dispose(),_.scores.dispose()}),[2,{boxes:w,scores:v}]}})})}function yW(n,e){return At(function(){var t=T_(n,e);t=Pc(t,[2,2],[2,2],"same"),t=Oo(t,e.conv4,"valid"),t=Rc(t,e.prelu4_alpha);var r=Ro(t,[t.shape[0],e.fc1.weights.shape[0]]),i=sa(r,e.fc1),o=Rc(i,e.prelu5_alpha),a=sa(o,e.fc2_1),s=Zi(Zm(a,1),1),u=iu(_i(a,s),1),l=sa(o,e.fc2_2),c=sa(o,e.fc2_3),h=Tr(u,1)[1];return{scores:h,regions:l,points:c}})}function bW(n,e,t,r,i){return It(this,void 0,void 0,function(){var o,a,s,u,l,c,h,f,m,g,w,v,y,x,E;return Dt(this,function(_){switch(_.label){case 0:return o=Date.now(),[4,yR(n,e,{width:48,height:48})];case 1:return a=_.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(k){var C=yW(k,r);return k.dispose(),C}),i.stage3_onet=Date.now()-o,u=s.length>1?Vr(s.map(function(k){return k.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[_.sent()]),u.dispose(),f=l.map(function(k,C){return{score:k,idx:C}}).filter(function(k){return k.score>t}).map(function(k){var C=k.idx;return C}),m=f.map(function(k){var C=s[k].regions.arraySync();return new C_(C[0][0],C[0][1],C[0][2],C[0][3])}),g=f.map(function(k,C){return e[k].calibrate(m[C])}),w=f.map(function(k){return l[k]}),v=[],y=[],x=[],g.length>0&&(o=Date.now(),E=rd(g,w,.7,!1),i.stage3_nms=Date.now()-o,v=E.map(function(k){return g[k]}),y=E.map(function(k){return w[k]}),x=E.map(function(k,C){return Array(5).fill(0).map(function(A,I){var T=s[k].points.arraySync();return new yn(T[0][I]*(v[C].width+1)+v[C].left,T[0][I+5]*(v[C].height+1)+v[C].top)})})),s.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:v,scores:y,points:x}]}})})}var wW=(function(n){Yt(e,n);function e(){return n.call(this,"Mtcnn")||this}return e.prototype.forwardInput=function(t,r){return r===void 0&&(r={}),It(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,A,I;return Dt(this,function(T){switch(T.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=At(function(){return aW(Zi(YO.fromPixels(o)).toFloat())}),l=function(R){return u.dispose(),a.total=Date.now()-s,R},c=u.shape.slice(1),h=c[0],f=c[1],m=new pR(r),g=m.minFaceSize,w=m.scaleFactor,v=m.maxNumScales,y=m.scoreThresholds,x=m.scaleSteps,E=(x||hW(g,w,[h,f])).filter(function(R){var N=S0(R,[h,f]);return Math.min(N.width,N.height)>zm}).slice(0,v),a.scales=E,a.pyramid=E.map(function(R){return S0(R,[h,f])}),_=Date.now(),[4,mW(u,E,y[0],i.pnet,a)];case 1:return k=T.sent(),a.total_stage1=Date.now()-_,k.boxes.length?(a.stage2_numInputBoxes=k.boxes.length,_=Date.now(),[4,vW(o,k.boxes,y[1],i.rnet,a)]):[2,l({results:[],stats:a})];case 2:return C=T.sent(),a.total_stage2=Date.now()-_,C.boxes.length?(a.stage3_numInputBoxes=C.boxes.length,_=Date.now(),[4,bW(o,C.boxes,y[2],i.onet,a)]):[2,l({results:[],stats:a})];case 3:return A=T.sent(),a.total_stage3=Date.now()-_,I=A.boxes.map(function(R,N){return __(b_({},new lo(A.scores[N],new u_(R.left/f,R.top/h,R.width/f,R.height/h),{height:h,width:f})),new Pz(A.points[N].map(function(O){return O.sub(new yn(R.left,R.top)).div(new yn(R.width,R.height))}),{width:R.width,height:R.height}))}),[2,l({results:I,stats:a})]}})})},e.prototype.forward=function(t,r){return r===void 0&&(r={}),It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,_r(t)];case 1:return[4,i.apply(this,[o.sent(),r])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,r){return r===void 0&&(r={}),It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,_r(t)];case 1:return[2,i.apply(this,[o.sent(),r])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return cW(t)},e.prototype.extractParams=function(t){return uW(t)},e})(rs),_W=.4,xW=[new yn(1.603231,2.094468),new yn(6.041143,7.080126),new yn(2.882459,3.518061),new yn(4.266906,5.178857),new yn(9.041765,10.66308)],SW=[117.001,114.697,97.404],EW=(function(n){Yt(e,n);function e(){var t=this,r={withSeparableConvs:!0,iouThreshold:_W,classes:["face"],anchors:xW,meanRgb:SW,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=n.call(this,r)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new lo(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(KM),kW=.4,CW=[new yn(.738768,.874946),new yn(2.42204,2.65704),new yn(4.30971,7.04493),new yn(10.246,4.59428),new yn(12.6868,11.8741)],TW=[new yn(1.603231,2.094468),new yn(6.041143,7.080126),new yn(2.882459,3.518061),new yn(4.266906,5.178857),new yn(9.041765,10.66308)],MW=[117.001,114.697,97.404],RW="tiny_yolov2_model",AW="tiny_yolov2_separable_conv_model",IW=(function(n){Yt(e,n);function e(t){t===void 0&&(t=!0);var r=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:kW,classes:["face"]},t?{anchors:TW,meanRgb:MW}:{anchors:CW,withClassScores:!0});return r=n.call(this,i)||this,r}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,r){return It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,r)];case 1:return i=o.sent(),[2,i.map(function(a){return new lo(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?AW:RW},e.prototype.extractParamsFromWeigthMap=function(t){return n.prototype.extractParamsFromWeigthMap.call(this,t)},e})(KM),gi={ssdMobilenetv1:new mR,tinyFaceDetector:new EW,tinyYolov2:new IW,mtcnn:new wW,faceLandmark68Net:new cR,faceLandmark68TinyNet:new Bz,faceRecognitionNet:new jz,faceExpressionNet:new gz,ageGenderNet:new Nz};function bR(n,e){var t={age:e};return Object.assign({},n,t)}function wR(n,e,t){var r={gender:e,genderProbability:t};return Object.assign({},n,r)}var _R=(function(n){Yt(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e})(Dd),M_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r,i=this;return Dt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,yg(t,this.input,function(a){return It(i,void 0,void 0,function(){return Dt(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return gi.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){return rR(a,r[s])})]}})})},e.prototype.withAgeAndGender=function(){return new D_(this,this.input)},e})(_R),R_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r;return Dt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,k_(t,this.input,function(o){return gi.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return r=i.sent(),[2,rR(t,r)]}})})},e.prototype.withAgeAndGender=function(){return new N_(this,this.input)},e})(_R),A_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new P_(this,this.input)},e.prototype.withFaceDescriptors=function(){return new O_(this,this.input)},e})(M_),I_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new F_(this,this.input)},e.prototype.withFaceDescriptor=function(){return new L_(this,this.input)},e})(R_),xR=(function(n){Yt(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.extractedFaces=i,o}return e})(Dd),D_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r,i=this;return Dt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,yg(t,this.input,function(a){return It(i,void 0,void 0,function(){return Dt(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return gi.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return r=o.sent(),[2,t.map(function(a,s){var u=r[s],l=u.age,c=u.gender,h=u.genderProbability;return bR(wR(a,c,h),l)})]}})})},e.prototype.withFaceExpressions=function(){return new M_(this,this.input)},e})(xR),N_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r,i,o,a;return Dt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,k_(t,this.input,function(u){return gi.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return r=s.sent(),i=r.age,o=r.gender,a=r.genderProbability,[2,bR(wR(t,o,a),i)]}})})},e.prototype.withFaceExpressions=function(){return new R_(this,this.input)},e})(xR),P_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new A_(this,this.input)},e.prototype.withFaceDescriptors=function(){return new O_(this,this.input)},e})(D_),F_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new I_(this,this.input)},e.prototype.withFaceDescriptor=function(){return new L_(this,this.input)},e})(N_),SR=(function(n){Yt(e,n);function e(t,r){var i=n.call(this)||this;return i.parentTask=t,i.input=r,i}return e})(Dd),O_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r;return Dt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,yg(t,this.input,function(o){return Promise.all(o.map(function(a){return gi.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return r=i.sent(),[2,r.map(function(o,a){return fR(t[a],o)})]}})})},e.prototype.withFaceExpressions=function(){return new A_(this,this.input)},e.prototype.withAgeAndGender=function(){return new P_(this,this.input)},e})(SR),L_=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r;return Dt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,k_(t,this.input,function(o){return gi.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return r=i.sent(),[2,fR(t,r)]}})})},e.prototype.withFaceExpressions=function(){return new I_(this,this.input)},e.prototype.withAgeAndGender=function(){return new F_(this,this.input)},e})(SR),ER=(function(n){Yt(e,n);function e(t,r,i){var o=n.call(this)||this;return o.parentTask=t,o.input=r,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?gi.faceLandmark68TinyNet:gi.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(Dd),DW=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r,i,o,a,s=this;return Dt(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),r=t.map(function(l){return l.detection}),this.input instanceof at?[4,S_(this.input,r)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,x_(this.input,r)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),i.forEach(function(l){return l instanceof at&&l.dispose()}),[2,t.map(function(l,c){return __(l,a[c])})]}})})},e.prototype.withFaceExpressions=function(){return new A_(this,this.input)},e.prototype.withAgeAndGender=function(){return new P_(this,this.input)},e.prototype.withFaceDescriptors=function(){return new O_(this,this.input)},e})(ER),NW=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r,i,o,a;return Dt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(r=t.detection,this.input instanceof at?[4,S_(this.input,[r])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,x_(this.input,[r])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(u){return u instanceof at&&u.dispose()}),[2,__(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new I_(this,this.input)},e.prototype.withAgeAndGender=function(){return new F_(this,this.input)},e.prototype.withFaceDescriptor=function(){return new L_(this,this.input)},e})(ER),kR=(function(n){Yt(e,n);function e(t,r){r===void 0&&(r=new vg);var i=n.call(this)||this;return i.input=t,i.options=r,i}return e})(Dd),PW=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r,i,o;return Dt(this,function(a){switch(a.label){case 0:return t=this,r=t.input,i=t.options,i instanceof pR?[4,gi.mtcnn.forward(r,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof gR?function(s){return gi.tinyFaceDetector.locateFaces(s,i)}:i instanceof vg?function(s){return gi.ssdMobilenetv1.locateFaces(s,i)}:i instanceof y_?function(s){return gi.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(r)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(r){return It(t,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i.map(function(a){return b_({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new DW(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new M_(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new D_(this.runAndExtendWithFaceDetections(),this.input)},e})(kR),FW=(function(n){Yt(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,r;return Dt(this,function(i){switch(i.label){case 0:return[4,new PW(this.input,this.options)];case 1:return t=i.sent(),r=t[0],t.forEach(function(o){o.score>r.score&&(r=o)}),[2,r]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(r){return It(t,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,r(i?b_({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new NW(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new R_(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new N_(this.runAndExtendWithFaceDetection(),this.input)},e})(kR);function OW(n,e){return e===void 0&&(e=new vg),new FW(n,e)}function LW(n,e){if(n.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(n),r=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-r[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function n(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var r=Array.isArray(e)?e:[e];if(!r.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=r.map(function(a){if(a instanceof ab)return a;if(a instanceof Float32Array)return new ab(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new ab(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(n.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),n.prototype.computeMeanDistance=function(e,t){return t.map(function(r){return LW(r,e)}).reduce(function(r,i){return r+i},0)/(t.length||1)},n.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(r){var i=r.descriptors,o=r.label;return new RE(o,t.computeMeanDistance(e,i))}).reduce(function(r,i){return r.distance<i.distance?r:i})},n.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new RE("unknown",t.distance)},n})();No({},J9,Ez);const Nd="180",BW=0,AE=1,UW=2,CR=1,zW=2,Fa=3,qa=0,br=1,Fi=2,wi=0,Ac=1,IE=2,DE=3,NE=4,WW=5,zu=100,HW=101,GW=102,VW=103,jW=104,qW=200,$W=201,XW=202,YW=203,E0=204,k0=205,KW=206,JW=207,QW=208,ZW=209,eH=210,tH=211,nH=212,rH=213,iH=214,C0=0,Wm=1,T0=2,zc=3,M0=4,R0=5,A0=6,I0=7,TR=0,oH=1,aH=2,Ga=0,sH=1,uH=2,lH=3,cH=4,hH=5,dH=6,fH=7,MR=300,Wc=301,Hc=302,D0=303,N0=304,bg=306,P0=1e3,qu=1001,F0=1002,Lo=1003,pH=1004,yp=1005,vi=1006,sb=1007,$u=1008,$r=1009,RR=1010,AR=1011,od=1012,B_=1013,Zs=1014,Wa=1015,Pd=1016,U_=1017,z_=1018,Gc=1020,IR=35902,DR=35899,NR=1021,PR=1022,Ao=1023,ad=1026,Vc=1027,FR=1028,W_=1029,OR=1030,H_=1031,G_=1033,Jp=33776,Qp=33777,Zp=33778,em=33779,O0=35840,L0=35841,B0=35842,U0=35843,z0=36196,W0=37492,H0=37496,G0=37808,V0=37809,j0=37810,q0=37811,$0=37812,X0=37813,Y0=37814,K0=37815,J0=37816,Q0=37817,Z0=37818,ew=37819,tw=37820,nw=37821,rw=36492,iw=36494,ow=36495,aw=36283,sw=36284,uw=36285,lw=36286,Fd=3200,mH=3201,gH=0,vH=1,oa="",Cn="srgb",eu="srgb-linear",Hm="linear",Mn="srgb",Gl=7680,PE=519,yH=512,bH=513,wH=514,LR=515,_H=516,xH=517,SH=518,EH=519,FE=35044,OE="300 es",ua=2e3,Gm=2001;class is{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){const r=this._listeners;return r===void 0?!1:r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){const r=this._listeners;if(r===void 0)return;const i=r[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const r=t[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,a=i.length;o<a;o++)i[o].call(this,e);e.target=null}}}const Fr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let LE=1234567;const Yh=Math.PI/180,sd=180/Math.PI;function Jc(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(Fr[n&255]+Fr[n>>8&255]+Fr[n>>16&255]+Fr[n>>24&255]+"-"+Fr[e&255]+Fr[e>>8&255]+"-"+Fr[e>>16&15|64]+Fr[e>>24&255]+"-"+Fr[t&63|128]+Fr[t>>8&255]+"-"+Fr[t>>16&255]+Fr[t>>24&255]+Fr[r&255]+Fr[r>>8&255]+Fr[r>>16&255]+Fr[r>>24&255]).toLowerCase()}function sn(n,e,t){return Math.max(e,Math.min(t,n))}function V_(n,e){return(n%e+e)%e}function kH(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function CH(n,e,t){return n!==e?(t-n)/(e-n):0}function Kh(n,e,t){return(1-t)*n+t*e}function TH(n,e,t,r){return Kh(n,e,1-Math.exp(-t*r))}function MH(n,e=1){return e-Math.abs(V_(n,e*2)-e)}function RH(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function AH(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function IH(n,e){return n+Math.floor(Math.random()*(e-n+1))}function DH(n,e){return n+Math.random()*(e-n)}function NH(n){return n*(.5-Math.random())}function PH(n){n!==void 0&&(LE=n);let e=LE+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function FH(n){return n*Yh}function OH(n){return n*sd}function LH(n){return(n&n-1)===0&&n!==0}function BH(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function UH(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function zH(n,e,t,r,i){const o=Math.cos,a=Math.sin,s=o(t/2),u=a(t/2),l=o((e+r)/2),c=a((e+r)/2),h=o((e-r)/2),f=a((e-r)/2),m=o((r-e)/2),g=a((r-e)/2);switch(i){case"XYX":n.set(s*c,u*h,u*f,s*l);break;case"YZY":n.set(u*f,s*c,u*h,s*l);break;case"ZXZ":n.set(u*h,u*f,s*c,s*l);break;case"XZX":n.set(s*c,u*g,u*m,s*l);break;case"YXY":n.set(u*m,s*c,u*g,s*l);break;case"ZYZ":n.set(u*g,u*m,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function dc(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Zr(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const Ki={DEG2RAD:Yh,RAD2DEG:sd,generateUUID:Jc,clamp:sn,euclideanModulo:V_,mapLinear:kH,inverseLerp:CH,lerp:Kh,damp:TH,pingpong:MH,smoothstep:RH,smootherstep:AH,randInt:IH,randFloat:DH,randFloatSpread:NH,seededRandom:PH,degToRad:FH,radToDeg:OH,isPowerOfTwo:LH,ceilPowerOfTwo:BH,floorPowerOfTwo:UH,setQuaternionFromProperEuler:zH,normalize:Zr,denormalize:dc};class Wt{constructor(e=0,t=0){Wt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=sn(this.x,e.x,t.x),this.y=sn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=sn(this.x,e,t),this.y=sn(this.y,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(sn(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(sn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*r-a*i+e.x,this.y=o*i+a*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Od{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,a,s){let u=r[i+0],l=r[i+1],c=r[i+2],h=r[i+3];const f=o[a+0],m=o[a+1],g=o[a+2],w=o[a+3];if(s===0){e[t+0]=u,e[t+1]=l,e[t+2]=c,e[t+3]=h;return}if(s===1){e[t+0]=f,e[t+1]=m,e[t+2]=g,e[t+3]=w;return}if(h!==w||u!==f||l!==m||c!==g){let v=1-s;const y=u*f+l*m+c*g+h*w,x=y>=0?1:-1,E=1-y*y;if(E>Number.EPSILON){const k=Math.sqrt(E),C=Math.atan2(k,y*x);v=Math.sin(v*C)/k,s=Math.sin(s*C)/k}const _=s*x;if(u=u*v+f*_,l=l*v+m*_,c=c*v+g*_,h=h*v+w*_,v===1-s){const k=1/Math.sqrt(u*u+l*l+c*c+h*h);u*=k,l*=k,c*=k,h*=k}}e[t]=u,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,r,i,o,a){const s=r[i],u=r[i+1],l=r[i+2],c=r[i+3],h=o[a],f=o[a+1],m=o[a+2],g=o[a+3];return e[t]=s*g+c*h+u*m-l*f,e[t+1]=u*g+c*f+l*h-s*m,e[t+2]=l*g+c*m+s*f-u*h,e[t+3]=c*g-s*h-u*f-l*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,o=e._z,a=e._order,s=Math.cos,u=Math.sin,l=s(r/2),c=s(i/2),h=s(o/2),f=u(r/2),m=u(i/2),g=u(o/2);switch(a){case"XYZ":this._x=f*c*h+l*m*g,this._y=l*m*h-f*c*g,this._z=l*c*g+f*m*h,this._w=l*c*h-f*m*g;break;case"YXZ":this._x=f*c*h+l*m*g,this._y=l*m*h-f*c*g,this._z=l*c*g-f*m*h,this._w=l*c*h+f*m*g;break;case"ZXY":this._x=f*c*h-l*m*g,this._y=l*m*h+f*c*g,this._z=l*c*g+f*m*h,this._w=l*c*h-f*m*g;break;case"ZYX":this._x=f*c*h-l*m*g,this._y=l*m*h+f*c*g,this._z=l*c*g-f*m*h,this._w=l*c*h+f*m*g;break;case"YZX":this._x=f*c*h+l*m*g,this._y=l*m*h+f*c*g,this._z=l*c*g-f*m*h,this._w=l*c*h-f*m*g;break;case"XZY":this._x=f*c*h-l*m*g,this._y=l*m*h-f*c*g,this._z=l*c*g+f*m*h,this._w=l*c*h+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],a=t[1],s=t[5],u=t[9],l=t[2],c=t[6],h=t[10],f=r+s+h;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(c-u)*m,this._y=(o-l)*m,this._z=(a-i)*m}else if(r>s&&r>h){const m=2*Math.sqrt(1+r-s-h);this._w=(c-u)/m,this._x=.25*m,this._y=(i+a)/m,this._z=(o+l)/m}else if(s>h){const m=2*Math.sqrt(1+s-r-h);this._w=(o-l)/m,this._x=(i+a)/m,this._y=.25*m,this._z=(u+c)/m}else{const m=2*Math.sqrt(1+h-r-s);this._w=(a-i)/m,this._x=(o+l)/m,this._y=(u+c)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<1e-8?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(sn(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,a=e._w,s=t._x,u=t._y,l=t._z,c=t._w;return this._x=r*c+a*s+i*l-o*u,this._y=i*c+a*u+o*s-r*l,this._z=o*c+a*l+r*u-i*s,this._w=a*c-r*s-i*u-o*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,a=this._w;let s=a*e._w+r*e._x+i*e._y+o*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=r,this._y=i,this._z=o,this;const u=1-s*s;if(u<=Number.EPSILON){const m=1-t;return this._w=m*a+t*this._w,this._x=m*r+t*this._x,this._y=m*i+t*this._y,this._z=m*o+t*this._z,this.normalize(),this}const l=Math.sqrt(u),c=Math.atan2(l,s),h=Math.sin((1-t)*c)/l,f=Math.sin(t*c)/l;return this._w=a*h+this._w*f,this._x=r*h+this._x*f,this._y=i*h+this._y*f,this._z=o*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),o=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Te{constructor(e=0,t=0,r=0){Te.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(BE.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(BE.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,a=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*a,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*a,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*a,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,a=e.y,s=e.z,u=e.w,l=2*(a*i-s*r),c=2*(s*t-o*i),h=2*(o*r-a*t);return this.x=t+u*l+a*h-s*c,this.y=r+u*c+s*l-o*h,this.z=i+u*h+o*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=sn(this.x,e.x,t.x),this.y=sn(this.y,e.y,t.y),this.z=sn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=sn(this.x,e,t),this.y=sn(this.y,e,t),this.z=sn(this.z,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(sn(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,a=t.x,s=t.y,u=t.z;return this.x=i*u-o*s,this.y=o*a-r*u,this.z=r*s-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return ub.copy(this).projectOnVector(e),this.sub(ub)}reflect(e){return this.sub(ub.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(sn(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ub=new Te,BE=new Od;class Jt{constructor(e,t,r,i,o,a,s,u,l){Jt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,a,s,u,l)}set(e,t,r,i,o,a,s,u,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=o,c[5]=u,c[6]=r,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,a=r[0],s=r[3],u=r[6],l=r[1],c=r[4],h=r[7],f=r[2],m=r[5],g=r[8],w=i[0],v=i[3],y=i[6],x=i[1],E=i[4],_=i[7],k=i[2],C=i[5],A=i[8];return o[0]=a*w+s*x+u*k,o[3]=a*v+s*E+u*C,o[6]=a*y+s*_+u*A,o[1]=l*w+c*x+h*k,o[4]=l*v+c*E+h*C,o[7]=l*y+c*_+h*A,o[2]=f*w+m*x+g*k,o[5]=f*v+m*E+g*C,o[8]=f*y+m*_+g*A,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-r*o*c+r*s*u+i*o*l-i*a*u}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*a-s*l,f=s*u-c*o,m=l*o-a*u,g=t*h+r*f+i*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/g;return e[0]=h*w,e[1]=(i*l-c*r)*w,e[2]=(s*r-i*a)*w,e[3]=f*w,e[4]=(c*t-i*u)*w,e[5]=(i*o-s*t)*w,e[6]=m*w,e[7]=(r*u-l*t)*w,e[8]=(a*t-r*o)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,a,s){const u=Math.cos(o),l=Math.sin(o);return this.set(r*u,r*l,-r*(u*a+l*s)+a+e,-i*l,i*u,-i*(-l*a+u*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(lb.makeScale(e,t)),this}rotate(e){return this.premultiply(lb.makeRotation(-e)),this}translate(e,t){return this.premultiply(lb.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const lb=new Jt;function BR(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Vm(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function WH(){const n=Vm("canvas");return n.style.display="block",n}const UE={};function ud(n){n in UE||(UE[n]=!0,console.warn(n))}function HH(n,e,t){return new Promise(function(r,i){function o(){switch(n.clientWaitSync(e,n.SYNC_FLUSH_COMMANDS_BIT,0)){case n.WAIT_FAILED:i();break;case n.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:r()}}setTimeout(o,t)})}const zE=new Jt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),WE=new Jt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function GH(){const n={enabled:!0,workingColorSpace:eu,spaces:{},convert:function(i,o,a){return this.enabled===!1||o===a||!o||!a||(this.spaces[o].transfer===Mn&&(i.r=Va(i.r),i.g=Va(i.g),i.b=Va(i.b)),this.spaces[o].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[o].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Mn&&(i.r=Ic(i.r),i.g=Ic(i.g),i.b=Ic(i.b))),i},workingToColorSpace:function(i,o){return this.convert(i,this.workingColorSpace,o)},colorSpaceToWorking:function(i,o){return this.convert(i,o,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===oa?Hm:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,o=this.workingColorSpace){return i.fromArray(this.spaces[o].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,o,a){return i.copy(this.spaces[o].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,o){return ud("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),n.workingToColorSpace(i,o)},toWorkingColorSpace:function(i,o){return ud("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),n.colorSpaceToWorking(i,o)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],r=[.3127,.329];return n.define({[eu]:{primaries:e,whitePoint:r,transfer:Hm,toXYZ:zE,fromXYZ:WE,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Cn},outputColorSpaceConfig:{drawingBufferColorSpace:Cn}},[Cn]:{primaries:e,whitePoint:r,transfer:Mn,toXYZ:zE,fromXYZ:WE,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Cn}}}),n}const gn=GH();function Va(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Ic(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Vl;class VH{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let r;if(e instanceof HTMLCanvasElement)r=e;else{Vl===void 0&&(Vl=Vm("canvas")),Vl.width=e.width,Vl.height=e.height;const i=Vl.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),r=Vl}return r.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Vm("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let a=0;a<o.length;a++)o[a]=Va(o[a]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(Va(t[r]/255)*255):t[r]=Va(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let jH=0;class j_{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:jH++}),this.uuid=Jc(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let a=0,s=i.length;a<s;a++)i[a].isDataTexture?o.push(cb(i[a].image)):o.push(cb(i[a]))}else o=cb(i);r.url=o}return t||(e.images[this.uuid]=r),r}}function cb(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?VH.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let qH=0;const hb=new Te;class jr extends is{constructor(e=jr.DEFAULT_IMAGE,t=jr.DEFAULT_MAPPING,r=qu,i=qu,o=vi,a=$u,s=Ao,u=$r,l=jr.DEFAULT_ANISOTROPY,c=oa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:qH++}),this.uuid=Jc(),this.name="",this.source=new j_(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=u,this.offset=new Wt(0,0),this.repeat=new Wt(1,1),this.center=new Wt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(hb).x}get height(){return this.source.getSize(hb).y}get depth(){return this.source.getSize(hb).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&r&&i.isVector2&&r.isVector2||i&&r&&i.isVector3&&r.isVector3||i&&r&&i.isMatrix3&&r.isMatrix3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==MR)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case P0:e.x=e.x-Math.floor(e.x);break;case qu:e.x=e.x<0?0:1;break;case F0:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case P0:e.y=e.y-Math.floor(e.y);break;case qu:e.y=e.y<0?0:1;break;case F0:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}jr.DEFAULT_IMAGE=null;jr.DEFAULT_MAPPING=MR;jr.DEFAULT_ANISOTROPY=1;class Hn{constructor(e=0,t=0,r=0,i=1){Hn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=this.w,a=e.elements;return this.x=a[0]*t+a[4]*r+a[8]*i+a[12]*o,this.y=a[1]*t+a[5]*r+a[9]*i+a[13]*o,this.z=a[2]*t+a[6]*r+a[10]*i+a[14]*o,this.w=a[3]*t+a[7]*r+a[11]*i+a[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,o;const u=e.elements,l=u[0],c=u[4],h=u[8],f=u[1],m=u[5],g=u[9],w=u[2],v=u[6],y=u[10];if(Math.abs(c-f)<.01&&Math.abs(h-w)<.01&&Math.abs(g-v)<.01){if(Math.abs(c+f)<.1&&Math.abs(h+w)<.1&&Math.abs(g+v)<.1&&Math.abs(l+m+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const E=(l+1)/2,_=(m+1)/2,k=(y+1)/2,C=(c+f)/4,A=(h+w)/4,I=(g+v)/4;return E>_&&E>k?E<.01?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(E),i=C/r,o=A/r):_>k?_<.01?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(_),r=C/i,o=I/i):k<.01?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(k),r=A/o,i=I/o),this.set(r,i,o,t),this}let x=Math.sqrt((v-g)*(v-g)+(h-w)*(h-w)+(f-c)*(f-c));return Math.abs(x)<.001&&(x=1),this.x=(v-g)/x,this.y=(h-w)/x,this.z=(f-c)/x,this.w=Math.acos((l+m+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=sn(this.x,e.x,t.x),this.y=sn(this.y,e.y,t.y),this.z=sn(this.z,e.z,t.z),this.w=sn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=sn(this.x,e,t),this.y=sn(this.y,e,t),this.z=sn(this.z,e,t),this.w=sn(this.w,e,t),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(sn(r,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class $H extends is{constructor(e=1,t=1,r={}){super(),r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:vi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},r),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=r.depth,this.scissor=new Hn(0,0,e,t),this.scissorTest=!1,this.viewport=new Hn(0,0,e,t);const i={width:e,height:t,depth:r.depth},o=new jr(i);this.textures=[];const a=r.count;for(let s=0;s<a;s++)this.textures[s]=o.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this._setTextureOptions(r),this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=r.depthTexture,this.samples=r.samples,this.multiview=r.multiview}_setTextureOptions(e={}){const t={minFilter:vi,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let r=0;r<this.textures.length;r++)this.textures[r].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,o=this.textures.length;i<o;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,r=e.textures.length;t<r;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new j_(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ri extends $H{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class UR extends jr{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Lo,this.minFilter=Lo,this.wrapR=qu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class XH extends jr{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Lo,this.minFilter=Lo,this.wrapR=qu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ld{constructor(e=new Te(1/0,1/0,1/0),t=new Te(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(_o.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(_o.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=_o.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let a=0,s=o.count;a<s;a++)e.isMesh===!0?e.getVertexPosition(a,_o):_o.fromBufferAttribute(o,a),_o.applyMatrix4(e.matrixWorld),this.expandByPoint(_o);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),bp.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),bp.copy(r.boundingBox)),bp.applyMatrix4(e.matrixWorld),this.union(bp)}const i=e.children;for(let o=0,a=i.length;o<a;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,_o),_o.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Uh),wp.subVectors(this.max,Uh),jl.subVectors(e.a,Uh),ql.subVectors(e.b,Uh),$l.subVectors(e.c,Uh),Rs.subVectors(ql,jl),As.subVectors($l,ql),ku.subVectors(jl,$l);let t=[0,-Rs.z,Rs.y,0,-As.z,As.y,0,-ku.z,ku.y,Rs.z,0,-Rs.x,As.z,0,-As.x,ku.z,0,-ku.x,-Rs.y,Rs.x,0,-As.y,As.x,0,-ku.y,ku.x,0];return!db(t,jl,ql,$l,wp)||(t=[1,0,0,0,1,0,0,0,1],!db(t,jl,ql,$l,wp))?!1:(_p.crossVectors(Rs,As),t=[_p.x,_p.y,_p.z],db(t,jl,ql,$l,wp))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,_o).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(_o).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Aa[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Aa[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Aa[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Aa[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Aa[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Aa[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Aa[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Aa[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Aa),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Aa=[new Te,new Te,new Te,new Te,new Te,new Te,new Te,new Te],_o=new Te,bp=new Ld,jl=new Te,ql=new Te,$l=new Te,Rs=new Te,As=new Te,ku=new Te,Uh=new Te,wp=new Te,_p=new Te,Cu=new Te;function db(n,e,t,r,i){for(let o=0,a=n.length-3;o<=a;o+=3){Cu.fromArray(n,o);const s=i.x*Math.abs(Cu.x)+i.y*Math.abs(Cu.y)+i.z*Math.abs(Cu.z),u=e.dot(Cu),l=t.dot(Cu),c=r.dot(Cu);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}const YH=new Ld,zh=new Te,fb=new Te;class q_{constructor(e=new Te,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):YH.setFromPoints(e).getCenter(r);let i=0;for(let o=0,a=e.length;o<a;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;zh.subVectors(e,this.center);const t=zh.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(zh,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(fb.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(zh.copy(e.center).add(fb)),this.expandByPoint(zh.copy(e.center).sub(fb))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Ia=new Te,pb=new Te,xp=new Te,Is=new Te,mb=new Te,Sp=new Te,gb=new Te;class KH{constructor(e=new Te,t=new Te(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ia)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ia.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ia.copy(this.origin).addScaledVector(this.direction,t),Ia.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){pb.copy(e).add(t).multiplyScalar(.5),xp.copy(t).sub(e).normalize(),Is.copy(this.origin).sub(pb);const o=e.distanceTo(t)*.5,a=-this.direction.dot(xp),s=Is.dot(this.direction),u=-Is.dot(xp),l=Is.lengthSq(),c=Math.abs(1-a*a);let h,f,m,g;if(c>0)if(h=a*u-s,f=a*s-u,g=o*c,h>=0)if(f>=-g)if(f<=g){const w=1/c;h*=w,f*=w,m=h*(h+a*f+2*s)+f*(a*h+f+2*u)+l}else f=o,h=Math.max(0,-(a*f+s)),m=-h*h+f*(f+2*u)+l;else f=-o,h=Math.max(0,-(a*f+s)),m=-h*h+f*(f+2*u)+l;else f<=-g?(h=Math.max(0,-(-a*o+s)),f=h>0?-o:Math.min(Math.max(-o,-u),o),m=-h*h+f*(f+2*u)+l):f<=g?(h=0,f=Math.min(Math.max(-o,-u),o),m=f*(f+2*u)+l):(h=Math.max(0,-(a*o+s)),f=h>0?o:Math.min(Math.max(-o,-u),o),m=-h*h+f*(f+2*u)+l);else f=a>0?-o:o,h=Math.max(0,-(a*f+s)),m=-h*h+f*(f+2*u)+l;return r&&r.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(pb).addScaledVector(xp,f),m}intersectSphere(e,t){Ia.subVectors(e.center,this.origin);const r=Ia.dot(this.direction),i=Ia.dot(Ia)-r*r,o=e.radius*e.radius;if(i>o)return null;const a=Math.sqrt(o-i),s=r-a,u=r+a;return u<0?null:s<0?this.at(u,t):this.at(s,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,o,a,s,u;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,f=this.origin;return l>=0?(r=(e.min.x-f.x)*l,i=(e.max.x-f.x)*l):(r=(e.max.x-f.x)*l,i=(e.min.x-f.x)*l),c>=0?(o=(e.min.y-f.y)*c,a=(e.max.y-f.y)*c):(o=(e.max.y-f.y)*c,a=(e.min.y-f.y)*c),r>a||o>i||((o>r||isNaN(r))&&(r=o),(a<i||isNaN(i))&&(i=a),h>=0?(s=(e.min.z-f.z)*h,u=(e.max.z-f.z)*h):(s=(e.max.z-f.z)*h,u=(e.min.z-f.z)*h),r>u||s>i)||((s>r||r!==r)&&(r=s),(u<i||i!==i)&&(i=u),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,Ia)!==null}intersectTriangle(e,t,r,i,o){mb.subVectors(t,e),Sp.subVectors(r,e),gb.crossVectors(mb,Sp);let a=this.direction.dot(gb),s;if(a>0){if(i)return null;s=1}else if(a<0)s=-1,a=-a;else return null;Is.subVectors(this.origin,e);const u=s*this.direction.dot(Sp.crossVectors(Is,Sp));if(u<0)return null;const l=s*this.direction.dot(mb.cross(Is));if(l<0||u+l>a)return null;const c=-s*Is.dot(gb);return c<0?null:this.at(c/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class sr{constructor(e,t,r,i,o,a,s,u,l,c,h,f,m,g,w,v){sr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,a,s,u,l,c,h,f,m,g,w,v)}set(e,t,r,i,o,a,s,u,l,c,h,f,m,g,w,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=r,y[12]=i,y[1]=o,y[5]=a,y[9]=s,y[13]=u,y[2]=l,y[6]=c,y[10]=h,y[14]=f,y[3]=m,y[7]=g,y[11]=w,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new sr().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Xl.setFromMatrixColumn(e,0).length(),o=1/Xl.setFromMatrixColumn(e,1).length(),a=1/Xl.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*a,t[9]=r[9]*a,t[10]=r[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,a=Math.cos(r),s=Math.sin(r),u=Math.cos(i),l=Math.sin(i),c=Math.cos(o),h=Math.sin(o);if(e.order==="XYZ"){const f=a*c,m=a*h,g=s*c,w=s*h;t[0]=u*c,t[4]=-u*h,t[8]=l,t[1]=m+g*l,t[5]=f-w*l,t[9]=-s*u,t[2]=w-f*l,t[6]=g+m*l,t[10]=a*u}else if(e.order==="YXZ"){const f=u*c,m=u*h,g=l*c,w=l*h;t[0]=f+w*s,t[4]=g*s-m,t[8]=a*l,t[1]=a*h,t[5]=a*c,t[9]=-s,t[2]=m*s-g,t[6]=w+f*s,t[10]=a*u}else if(e.order==="ZXY"){const f=u*c,m=u*h,g=l*c,w=l*h;t[0]=f-w*s,t[4]=-a*h,t[8]=g+m*s,t[1]=m+g*s,t[5]=a*c,t[9]=w-f*s,t[2]=-a*l,t[6]=s,t[10]=a*u}else if(e.order==="ZYX"){const f=a*c,m=a*h,g=s*c,w=s*h;t[0]=u*c,t[4]=g*l-m,t[8]=f*l+w,t[1]=u*h,t[5]=w*l+f,t[9]=m*l-g,t[2]=-l,t[6]=s*u,t[10]=a*u}else if(e.order==="YZX"){const f=a*u,m=a*l,g=s*u,w=s*l;t[0]=u*c,t[4]=w-f*h,t[8]=g*h+m,t[1]=h,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=m*h+g,t[10]=f-w*h}else if(e.order==="XZY"){const f=a*u,m=a*l,g=s*u,w=s*l;t[0]=u*c,t[4]=-h,t[8]=l*c,t[1]=f*h+w,t[5]=a*c,t[9]=m*h-g,t[2]=g*h-m,t[6]=s*c,t[10]=w*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(JH,e,QH)}lookAt(e,t,r){const i=this.elements;return Ti.subVectors(e,t),Ti.lengthSq()===0&&(Ti.z=1),Ti.normalize(),Ds.crossVectors(r,Ti),Ds.lengthSq()===0&&(Math.abs(r.z)===1?Ti.x+=1e-4:Ti.z+=1e-4,Ti.normalize(),Ds.crossVectors(r,Ti)),Ds.normalize(),Ep.crossVectors(Ti,Ds),i[0]=Ds.x,i[4]=Ep.x,i[8]=Ti.x,i[1]=Ds.y,i[5]=Ep.y,i[9]=Ti.y,i[2]=Ds.z,i[6]=Ep.z,i[10]=Ti.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,a=r[0],s=r[4],u=r[8],l=r[12],c=r[1],h=r[5],f=r[9],m=r[13],g=r[2],w=r[6],v=r[10],y=r[14],x=r[3],E=r[7],_=r[11],k=r[15],C=i[0],A=i[4],I=i[8],T=i[12],R=i[1],N=i[5],O=i[9],V=i[13],F=i[2],B=i[6],U=i[10],P=i[14],L=i[3],H=i[7],W=i[11],z=i[15];return o[0]=a*C+s*R+u*F+l*L,o[4]=a*A+s*N+u*B+l*H,o[8]=a*I+s*O+u*U+l*W,o[12]=a*T+s*V+u*P+l*z,o[1]=c*C+h*R+f*F+m*L,o[5]=c*A+h*N+f*B+m*H,o[9]=c*I+h*O+f*U+m*W,o[13]=c*T+h*V+f*P+m*z,o[2]=g*C+w*R+v*F+y*L,o[6]=g*A+w*N+v*B+y*H,o[10]=g*I+w*O+v*U+y*W,o[14]=g*T+w*V+v*P+y*z,o[3]=x*C+E*R+_*F+k*L,o[7]=x*A+E*N+_*B+k*H,o[11]=x*I+E*O+_*U+k*W,o[15]=x*T+E*V+_*P+k*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],a=e[1],s=e[5],u=e[9],l=e[13],c=e[2],h=e[6],f=e[10],m=e[14],g=e[3],w=e[7],v=e[11],y=e[15];return g*(+o*u*h-i*l*h-o*s*f+r*l*f+i*s*m-r*u*m)+w*(+t*u*m-t*l*f+o*a*f-i*a*m+i*l*c-o*u*c)+v*(+t*l*h-t*s*m-o*a*h+r*a*m+o*s*c-r*l*c)+y*(-i*s*c-t*u*h+t*s*f+i*a*h-r*a*f+r*u*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],m=e[11],g=e[12],w=e[13],v=e[14],y=e[15],x=h*v*l-w*f*l+w*u*m-s*v*m-h*u*y+s*f*y,E=g*f*l-c*v*l-g*u*m+a*v*m+c*u*y-a*f*y,_=c*w*l-g*h*l+g*s*m-a*w*m-c*s*y+a*h*y,k=g*h*u-c*w*u-g*s*f+a*w*f+c*s*v-a*h*v,C=t*x+r*E+i*_+o*k;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/C;return e[0]=x*A,e[1]=(w*f*o-h*v*o-w*i*m+r*v*m+h*i*y-r*f*y)*A,e[2]=(s*v*o-w*u*o+w*i*l-r*v*l-s*i*y+r*u*y)*A,e[3]=(h*u*o-s*f*o-h*i*l+r*f*l+s*i*m-r*u*m)*A,e[4]=E*A,e[5]=(c*v*o-g*f*o+g*i*m-t*v*m-c*i*y+t*f*y)*A,e[6]=(g*u*o-a*v*o-g*i*l+t*v*l+a*i*y-t*u*y)*A,e[7]=(a*f*o-c*u*o+c*i*l-t*f*l-a*i*m+t*u*m)*A,e[8]=_*A,e[9]=(g*h*o-c*w*o-g*r*m+t*w*m+c*r*y-t*h*y)*A,e[10]=(a*w*o-g*s*o+g*r*l-t*w*l-a*r*y+t*s*y)*A,e[11]=(c*s*o-a*h*o-c*r*l+t*h*l+a*r*m-t*s*m)*A,e[12]=k*A,e[13]=(c*w*i-g*h*i+g*r*f-t*w*f-c*r*v+t*h*v)*A,e[14]=(g*s*i-a*w*i-g*r*u+t*w*u+a*r*v-t*s*v)*A,e[15]=(a*h*i-c*s*i+c*r*u-t*h*u-a*r*f+t*s*f)*A,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,a=e.x,s=e.y,u=e.z,l=o*a,c=o*s;return this.set(l*a+r,l*s-i*u,l*u+i*s,0,l*s+i*u,c*s+r,c*u-i*a,0,l*u-i*s,c*u+i*a,o*u*u+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,a){return this.set(1,r,o,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,a=t._y,s=t._z,u=t._w,l=o+o,c=a+a,h=s+s,f=o*l,m=o*c,g=o*h,w=a*c,v=a*h,y=s*h,x=u*l,E=u*c,_=u*h,k=r.x,C=r.y,A=r.z;return i[0]=(1-(w+y))*k,i[1]=(m+_)*k,i[2]=(g-E)*k,i[3]=0,i[4]=(m-_)*C,i[5]=(1-(f+y))*C,i[6]=(v+x)*C,i[7]=0,i[8]=(g+E)*A,i[9]=(v-x)*A,i[10]=(1-(f+w))*A,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=Xl.set(i[0],i[1],i[2]).length();const a=Xl.set(i[4],i[5],i[6]).length(),s=Xl.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],xo.copy(this);const l=1/o,c=1/a,h=1/s;return xo.elements[0]*=l,xo.elements[1]*=l,xo.elements[2]*=l,xo.elements[4]*=c,xo.elements[5]*=c,xo.elements[6]*=c,xo.elements[8]*=h,xo.elements[9]*=h,xo.elements[10]*=h,t.setFromRotationMatrix(xo),r.x=o,r.y=a,r.z=s,this}makePerspective(e,t,r,i,o,a,s=ua,u=!1){const l=this.elements,c=2*o/(t-e),h=2*o/(r-i),f=(t+e)/(t-e),m=(r+i)/(r-i);let g,w;if(u)g=o/(a-o),w=a*o/(a-o);else if(s===ua)g=-(a+o)/(a-o),w=-2*a*o/(a-o);else if(s===Gm)g=-a/(a-o),w=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=h,l[9]=m,l[13]=0,l[2]=0,l[6]=0,l[10]=g,l[14]=w,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,r,i,o,a,s=ua,u=!1){const l=this.elements,c=2/(t-e),h=2/(r-i),f=-(t+e)/(t-e),m=-(r+i)/(r-i);let g,w;if(u)g=1/(a-o),w=a/(a-o);else if(s===ua)g=-2/(a-o),w=-(a+o)/(a-o);else if(s===Gm)g=-1/(a-o),w=-o/(a-o);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return l[0]=c,l[4]=0,l[8]=0,l[12]=f,l[1]=0,l[5]=h,l[9]=0,l[13]=m,l[2]=0,l[6]=0,l[10]=g,l[14]=w,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const Xl=new Te,xo=new sr,JH=new Te(0,0,0),QH=new Te(1,1,1),Ds=new Te,Ep=new Te,Ti=new Te,HE=new sr,GE=new Od;class $a{constructor(e=0,t=0,r=0,i=$a.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],a=i[4],s=i[8],u=i[1],l=i[5],c=i[9],h=i[2],f=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(sn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-sn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,m),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(sn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-sn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(sn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,m));break;case"XZY":this._z=Math.asin(-sn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return HE.makeRotationFromQuaternion(e),this.setFromRotationMatrix(HE,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return GE.setFromEuler(this),this.setFromQuaternion(GE,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}$a.DEFAULT_ORDER="XYZ";class zR{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let ZH=0;const VE=new Te,Yl=new Od,Da=new sr,kp=new Te,Wh=new Te,eG=new Te,tG=new Od,jE=new Te(1,0,0),qE=new Te(0,1,0),$E=new Te(0,0,1),XE={type:"added"},nG={type:"removed"},Kl={type:"childadded",child:null},vb={type:"childremoved",child:null};class zi extends is{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:ZH++}),this.uuid=Jc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=zi.DEFAULT_UP.clone();const e=new Te,t=new $a,r=new Od,i=new Te(1,1,1);function o(){r.setFromEuler(t,!1)}function a(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new sr},normalMatrix:{value:new Jt}}),this.matrix=new sr,this.matrixWorld=new sr,this.matrixAutoUpdate=zi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zR,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Yl.setFromAxisAngle(e,t),this.quaternion.multiply(Yl),this}rotateOnWorldAxis(e,t){return Yl.setFromAxisAngle(e,t),this.quaternion.premultiply(Yl),this}rotateX(e){return this.rotateOnAxis(jE,e)}rotateY(e){return this.rotateOnAxis(qE,e)}rotateZ(e){return this.rotateOnAxis($E,e)}translateOnAxis(e,t){return VE.copy(e).applyQuaternion(this.quaternion),this.position.add(VE.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(jE,e)}translateY(e){return this.translateOnAxis(qE,e)}translateZ(e){return this.translateOnAxis($E,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Da.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?kp.copy(e):kp.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Wh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Da.lookAt(Wh,kp,this.up):Da.lookAt(kp,Wh,this.up),this.quaternion.setFromRotationMatrix(Da),i&&(Da.extractRotation(i.matrixWorld),Yl.setFromRotationMatrix(Da),this.quaternion.premultiply(Yl.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(XE),Kl.child=e,this.dispatchEvent(Kl),Kl.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(nG),vb.child=e,this.dispatchEvent(vb),vb.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Da.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Da.multiply(e.parent.matrixWorld)),e.applyMatrix4(Da),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(XE),Kl.child=e,this.dispatchEvent(Kl),Kl.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const a=this.children[r].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wh,e,eG),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Wh,tG,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(s=>({...s,boundingBox:s.boundingBox?s.boundingBox.toJSON():void 0,boundingSphere:s.boundingSphere?s.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(s=>({...s})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function o(s,u){return s[u.uuid]===void 0&&(s[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const u=s.shapes;if(Array.isArray(u))for(let l=0,c=u.length;l<c;l++){const h=u[l];o(e.shapes,h)}else o(e.shapes,u)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let u=0,l=this.material.length;u<l;u++)s.push(o(e.materials,this.material[u]));i.material=s}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let s=0;s<this.animations.length;s++){const u=this.animations[s];i.animations.push(o(e.animations,u))}}if(t){const s=a(e.geometries),u=a(e.materials),l=a(e.textures),c=a(e.images),h=a(e.shapes),f=a(e.skeletons),m=a(e.animations),g=a(e.nodes);s.length>0&&(r.geometries=s),u.length>0&&(r.materials=u),l.length>0&&(r.textures=l),c.length>0&&(r.images=c),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),m.length>0&&(r.animations=m),g.length>0&&(r.nodes=g)}return r.object=i,r;function a(s){const u=[];for(const l in s){const c=s[l];delete c.metadata,u.push(c)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}zi.DEFAULT_UP=new Te(0,1,0);zi.DEFAULT_MATRIX_AUTO_UPDATE=!0;zi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const So=new Te,Na=new Te,yb=new Te,Pa=new Te,Jl=new Te,Ql=new Te,YE=new Te,bb=new Te,wb=new Te,_b=new Te,xb=new Hn,Sb=new Hn,Eb=new Hn;class Mo{constructor(e=new Te,t=new Te,r=new Te){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),So.subVectors(e,t),i.cross(So);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,r,i,o){So.subVectors(i,t),Na.subVectors(r,t),yb.subVectors(e,t);const a=So.dot(So),s=So.dot(Na),u=So.dot(yb),l=Na.dot(Na),c=Na.dot(yb),h=a*l-s*s;if(h===0)return o.set(0,0,0),null;const f=1/h,m=(l*u-s*c)*f,g=(a*c-s*u)*f;return o.set(1-m-g,g,m)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,Pa)===null?!1:Pa.x>=0&&Pa.y>=0&&Pa.x+Pa.y<=1}static getInterpolation(e,t,r,i,o,a,s,u){return this.getBarycoord(e,t,r,i,Pa)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(o,Pa.x),u.addScaledVector(a,Pa.y),u.addScaledVector(s,Pa.z),u)}static getInterpolatedAttribute(e,t,r,i,o,a){return xb.setScalar(0),Sb.setScalar(0),Eb.setScalar(0),xb.fromBufferAttribute(e,t),Sb.fromBufferAttribute(e,r),Eb.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(xb,o.x),a.addScaledVector(Sb,o.y),a.addScaledVector(Eb,o.z),a}static isFrontFacing(e,t,r,i){return So.subVectors(r,t),Na.subVectors(e,t),So.cross(Na).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return So.subVectors(this.c,this.b),Na.subVectors(this.a,this.b),So.cross(Na).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Mo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Mo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,o){return Mo.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}containsPoint(e){return Mo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Mo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,o=this.c;let a,s;Jl.subVectors(i,r),Ql.subVectors(o,r),bb.subVectors(e,r);const u=Jl.dot(bb),l=Ql.dot(bb);if(u<=0&&l<=0)return t.copy(r);wb.subVectors(e,i);const c=Jl.dot(wb),h=Ql.dot(wb);if(c>=0&&h<=c)return t.copy(i);const f=u*h-c*l;if(f<=0&&u>=0&&c<=0)return a=u/(u-c),t.copy(r).addScaledVector(Jl,a);_b.subVectors(e,o);const m=Jl.dot(_b),g=Ql.dot(_b);if(g>=0&&m<=g)return t.copy(o);const w=m*l-u*g;if(w<=0&&l>=0&&g<=0)return s=l/(l-g),t.copy(r).addScaledVector(Ql,s);const v=c*g-m*h;if(v<=0&&h-c>=0&&m-g>=0)return YE.subVectors(o,i),s=(h-c)/(h-c+(m-g)),t.copy(i).addScaledVector(YE,s);const y=1/(v+w+f);return a=w*y,s=f*y,t.copy(r).addScaledVector(Jl,a).addScaledVector(Ql,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const WR={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ns={h:0,s:0,l:0},Cp={h:0,s:0,l:0};function kb(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class Sn{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Cn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,gn.colorSpaceToWorking(this,t),this}setRGB(e,t,r,i=gn.workingColorSpace){return this.r=e,this.g=t,this.b=r,gn.colorSpaceToWorking(this,i),this}setHSL(e,t,r,i=gn.workingColorSpace){if(e=V_(e,1),t=sn(t,0,1),r=sn(r,0,1),t===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+t):r+t-r*t,a=2*r-o;this.r=kb(a,o,e+1/3),this.g=kb(a,o,e),this.b=kb(a,o,e-1/3)}return gn.colorSpaceToWorking(this,i),this}setStyle(e,t=Cn){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const a=i[1],s=i[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],a=o.length;if(a===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Cn){const r=WR[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Va(e.r),this.g=Va(e.g),this.b=Va(e.b),this}copyLinearToSRGB(e){return this.r=Ic(e.r),this.g=Ic(e.g),this.b=Ic(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cn){return gn.workingToColorSpace(Or.copy(this),e),Math.round(sn(Or.r*255,0,255))*65536+Math.round(sn(Or.g*255,0,255))*256+Math.round(sn(Or.b*255,0,255))}getHexString(e=Cn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=gn.workingColorSpace){gn.workingToColorSpace(Or.copy(this),t);const r=Or.r,i=Or.g,o=Or.b,a=Math.max(r,i,o),s=Math.min(r,i,o);let u,l;const c=(s+a)/2;if(s===a)u=0,l=0;else{const h=a-s;switch(l=c<=.5?h/(a+s):h/(2-a-s),a){case r:u=(i-o)/h+(i<o?6:0);break;case i:u=(o-r)/h+2;break;case o:u=(r-i)/h+4;break}u/=6}return e.h=u,e.s=l,e.l=c,e}getRGB(e,t=gn.workingColorSpace){return gn.workingToColorSpace(Or.copy(this),t),e.r=Or.r,e.g=Or.g,e.b=Or.b,e}getStyle(e=Cn){gn.workingToColorSpace(Or.copy(this),e);const t=Or.r,r=Or.g,i=Or.b;return e!==Cn?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(Ns),this.setHSL(Ns.h+e,Ns.s+t,Ns.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(Ns),e.getHSL(Cp);const r=Kh(Ns.h,Cp.h,t),i=Kh(Ns.s,Cp.s,t),o=Kh(Ns.l,Cp.l,t);return this.setHSL(r,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*r+o[6]*i,this.g=o[1]*t+o[4]*r+o[7]*i,this.b=o[2]*t+o[5]*r+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Or=new Sn;Sn.NAMES=WR;let rG=0;class Qc extends is{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:rG++}),this.uuid=Jc(),this.name="",this.type="Material",this.blending=Ac,this.side=qa,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=E0,this.blendDst=k0,this.blendEquation=zu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Sn(0,0,0),this.blendAlpha=0,this.depthFunc=zc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=PE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Gl,this.stencilZFail=Gl,this.stencilZPass=Gl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(r.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(r.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Ac&&(r.blending=this.blending),this.side!==qa&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==E0&&(r.blendSrc=this.blendSrc),this.blendDst!==k0&&(r.blendDst=this.blendDst),this.blendEquation!==zu&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==zc&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==PE&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Gl&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Gl&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Gl&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(o){const a=[];for(const s in o){const u=o[s];delete u.metadata,a.push(u)}return a}if(t){const o=i(e.textures),a=i(e.images);o.length>0&&(r.textures=o),a.length>0&&(r.images=a)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class HR extends Qc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new $a,this.combine=TR,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Zn=new Te,Tp=new Wt;let iG=0;class io{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:iG++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=FE,this.updateRanges=[],this.gpuType=Wa,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)Tp.fromBufferAttribute(this,t),Tp.applyMatrix3(e),this.setXY(t,Tp.x,Tp.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)Zn.fromBufferAttribute(this,t),Zn.applyMatrix3(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)Zn.fromBufferAttribute(this,t),Zn.applyMatrix4(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)Zn.fromBufferAttribute(this,t),Zn.applyNormalMatrix(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)Zn.fromBufferAttribute(this,t),Zn.transformDirection(e),this.setXYZ(t,Zn.x,Zn.y,Zn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=dc(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Zr(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=dc(t,this.array)),t}setX(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=dc(t,this.array)),t}setY(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=dc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=dc(t,this.array)),t}setW(e,t){return this.normalized&&(t=Zr(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),i=Zr(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=Zr(t,this.array),r=Zr(r,this.array),i=Zr(i,this.array),o=Zr(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==FE&&(e.usage=this.usage),e}}class GR extends io{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class VR extends io{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class Qu extends io{constructor(e,t,r){super(new Float32Array(e),t,r)}}let oG=0;const Ji=new sr,Cb=new zi,Zl=new Te,Mi=new Ld,Hh=new Ld,yr=new Te;class uu extends is{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:oG++}),this.uuid=Jc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(BR(e)?VR:GR)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new Jt().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ji.makeRotationFromQuaternion(e),this.applyMatrix4(Ji),this}rotateX(e){return Ji.makeRotationX(e),this.applyMatrix4(Ji),this}rotateY(e){return Ji.makeRotationY(e),this.applyMatrix4(Ji),this}rotateZ(e){return Ji.makeRotationZ(e),this.applyMatrix4(Ji),this}translate(e,t,r){return Ji.makeTranslation(e,t,r),this.applyMatrix4(Ji),this}scale(e,t,r){return Ji.makeScale(e,t,r),this.applyMatrix4(Ji),this}lookAt(e){return Cb.lookAt(e),Cb.updateMatrix(),this.applyMatrix4(Cb.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Zl).negate(),this.translate(Zl.x,Zl.y,Zl.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const r=[];for(let i=0,o=e.length;i<o;i++){const a=e[i];r.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Qu(r,3))}else{const r=Math.min(e.length,t.count);for(let i=0;i<r;i++){const o=e[i];t.setXYZ(i,o.x,o.y,o.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ld);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Te(-1/0,-1/0,-1/0),new Te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const o=t[r];Mi.setFromBufferAttribute(o),this.morphTargetsRelative?(yr.addVectors(this.boundingBox.min,Mi.min),this.boundingBox.expandByPoint(yr),yr.addVectors(this.boundingBox.max,Mi.max),this.boundingBox.expandByPoint(yr)):(this.boundingBox.expandByPoint(Mi.min),this.boundingBox.expandByPoint(Mi.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new q_);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Te,1/0);return}if(e){const r=this.boundingSphere.center;if(Mi.setFromBufferAttribute(e),t)for(let o=0,a=t.length;o<a;o++){const s=t[o];Hh.setFromBufferAttribute(s),this.morphTargetsRelative?(yr.addVectors(Mi.min,Hh.min),Mi.expandByPoint(yr),yr.addVectors(Mi.max,Hh.max),Mi.expandByPoint(yr)):(Mi.expandByPoint(Hh.min),Mi.expandByPoint(Hh.max))}Mi.getCenter(r);let i=0;for(let o=0,a=e.count;o<a;o++)yr.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(yr));if(t)for(let o=0,a=t.length;o<a;o++){const s=t[o],u=this.morphTargetsRelative;for(let l=0,c=s.count;l<c;l++)yr.fromBufferAttribute(s,l),u&&(Zl.fromBufferAttribute(e,l),yr.add(Zl)),i=Math.max(i,r.distanceToSquared(yr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new io(new Float32Array(4*r.count),4));const a=this.getAttribute("tangent"),s=[],u=[];for(let I=0;I<r.count;I++)s[I]=new Te,u[I]=new Te;const l=new Te,c=new Te,h=new Te,f=new Wt,m=new Wt,g=new Wt,w=new Te,v=new Te;function y(I,T,R){l.fromBufferAttribute(r,I),c.fromBufferAttribute(r,T),h.fromBufferAttribute(r,R),f.fromBufferAttribute(o,I),m.fromBufferAttribute(o,T),g.fromBufferAttribute(o,R),c.sub(l),h.sub(l),m.sub(f),g.sub(f);const N=1/(m.x*g.y-g.x*m.y);isFinite(N)&&(w.copy(c).multiplyScalar(g.y).addScaledVector(h,-m.y).multiplyScalar(N),v.copy(h).multiplyScalar(m.x).addScaledVector(c,-g.x).multiplyScalar(N),s[I].add(w),s[T].add(w),s[R].add(w),u[I].add(v),u[T].add(v),u[R].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let I=0,T=x.length;I<T;++I){const R=x[I],N=R.start,O=R.count;for(let V=N,F=N+O;V<F;V+=3)y(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const E=new Te,_=new Te,k=new Te,C=new Te;function A(I){k.fromBufferAttribute(i,I),C.copy(k);const T=s[I];E.copy(T),E.sub(k.multiplyScalar(k.dot(T))).normalize(),_.crossVectors(C,T);const N=_.dot(u[I])<0?-1:1;a.setXYZW(I,E.x,E.y,E.z,N)}for(let I=0,T=x.length;I<T;++I){const R=x[I],N=R.start,O=R.count;for(let V=N,F=N+O;V<F;V+=3)A(e.getX(V+0)),A(e.getX(V+1)),A(e.getX(V+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new io(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let f=0,m=r.count;f<m;f++)r.setXYZ(f,0,0,0);const i=new Te,o=new Te,a=new Te,s=new Te,u=new Te,l=new Te,c=new Te,h=new Te;if(e)for(let f=0,m=e.count;f<m;f+=3){const g=e.getX(f+0),w=e.getX(f+1),v=e.getX(f+2);i.fromBufferAttribute(t,g),o.fromBufferAttribute(t,w),a.fromBufferAttribute(t,v),c.subVectors(a,o),h.subVectors(i,o),c.cross(h),s.fromBufferAttribute(r,g),u.fromBufferAttribute(r,w),l.fromBufferAttribute(r,v),s.add(c),u.add(c),l.add(c),r.setXYZ(g,s.x,s.y,s.z),r.setXYZ(w,u.x,u.y,u.z),r.setXYZ(v,l.x,l.y,l.z)}else for(let f=0,m=t.count;f<m;f+=3)i.fromBufferAttribute(t,f+0),o.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),c.subVectors(a,o),h.subVectors(i,o),c.cross(h),r.setXYZ(f+0,c.x,c.y,c.z),r.setXYZ(f+1,c.x,c.y,c.z),r.setXYZ(f+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)yr.fromBufferAttribute(e,t),yr.normalize(),e.setXYZ(t,yr.x,yr.y,yr.z)}toNonIndexed(){function e(s,u){const l=s.array,c=s.itemSize,h=s.normalized,f=new l.constructor(u.length*c);let m=0,g=0;for(let w=0,v=u.length;w<v;w++){s.isInterleavedBufferAttribute?m=u[w]*s.data.stride+s.offset:m=u[w]*c;for(let y=0;y<c;y++)f[g++]=l[m++]}return new io(f,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new uu,r=this.index.array,i=this.attributes;for(const s in i){const u=i[s],l=e(u,r);t.setAttribute(s,l)}const o=this.morphAttributes;for(const s in o){const u=[],l=o[s];for(let c=0,h=l.length;c<h;c++){const f=l[c],m=e(f,r);u.push(m)}t.morphAttributes[s]=u}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let s=0,u=a.length;s<u;s++){const l=a[s];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const l in u)u[l]!==void 0&&(e[l]=u[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const u in r){const l=r[u];e.data.attributes[u]=l.toJSON(e.data)}const i={};let o=!1;for(const u in this.morphAttributes){const l=this.morphAttributes[u],c=[];for(let h=0,f=l.length;h<f;h++){const m=l[h];c.push(m.toJSON(e.data))}c.length>0&&(i[u]=c,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere=s.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone());const i=e.attributes;for(const l in i){const c=i[l];this.setAttribute(l,c.clone(t))}const o=e.morphAttributes;for(const l in o){const c=[],h=o[l];for(let f=0,m=h.length;f<m;f++)c.push(h[f].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];this.addGroup(h.start,h.count,h.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const KE=new sr,Tu=new KH,Mp=new q_,JE=new Te,Rp=new Te,Ap=new Te,Ip=new Te,Tb=new Te,Dp=new Te,QE=new Te,Np=new Te;class Io extends zi{constructor(e=new uu,t=new HR){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=i.length;o<a;o++){const s=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,o=r.morphAttributes.position,a=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(o&&s){Dp.set(0,0,0);for(let u=0,l=o.length;u<l;u++){const c=s[u],h=o[u];c!==0&&(Tb.fromBufferAttribute(h,e),a?Dp.addScaledVector(Tb,c):Dp.addScaledVector(Tb.sub(t),c))}t.add(Dp)}return t}raycast(e,t){const r=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),Mp.copy(r.boundingSphere),Mp.applyMatrix4(o),Tu.copy(e.ray).recast(e.near),!(Mp.containsPoint(Tu.origin)===!1&&(Tu.intersectSphere(Mp,JE)===null||Tu.origin.distanceToSquared(JE)>(e.far-e.near)**2))&&(KE.copy(o).invert(),Tu.copy(e.ray).applyMatrix4(KE),!(r.boundingBox!==null&&Tu.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,Tu)))}_computeIntersections(e,t,r){let i;const o=this.geometry,a=this.material,s=o.index,u=o.attributes.position,l=o.attributes.uv,c=o.attributes.uv1,h=o.attributes.normal,f=o.groups,m=o.drawRange;if(s!==null)if(Array.isArray(a))for(let g=0,w=f.length;g<w;g++){const v=f[g],y=a[v.materialIndex],x=Math.max(v.start,m.start),E=Math.min(s.count,Math.min(v.start+v.count,m.start+m.count));for(let _=x,k=E;_<k;_+=3){const C=s.getX(_),A=s.getX(_+1),I=s.getX(_+2);i=Pp(this,y,e,r,l,c,h,C,A,I),i&&(i.faceIndex=Math.floor(_/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),w=Math.min(s.count,m.start+m.count);for(let v=g,y=w;v<y;v+=3){const x=s.getX(v),E=s.getX(v+1),_=s.getX(v+2);i=Pp(this,a,e,r,l,c,h,x,E,_),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}else if(u!==void 0)if(Array.isArray(a))for(let g=0,w=f.length;g<w;g++){const v=f[g],y=a[v.materialIndex],x=Math.max(v.start,m.start),E=Math.min(u.count,Math.min(v.start+v.count,m.start+m.count));for(let _=x,k=E;_<k;_+=3){const C=_,A=_+1,I=_+2;i=Pp(this,y,e,r,l,c,h,C,A,I),i&&(i.faceIndex=Math.floor(_/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),w=Math.min(u.count,m.start+m.count);for(let v=g,y=w;v<y;v+=3){const x=v,E=v+1,_=v+2;i=Pp(this,a,e,r,l,c,h,x,E,_),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}}}function aG(n,e,t,r,i,o,a,s){let u;if(e.side===br?u=r.intersectTriangle(a,o,i,!0,s):u=r.intersectTriangle(i,o,a,e.side===qa,s),u===null)return null;Np.copy(s),Np.applyMatrix4(n.matrixWorld);const l=t.ray.origin.distanceTo(Np);return l<t.near||l>t.far?null:{distance:l,point:Np.clone(),object:n}}function Pp(n,e,t,r,i,o,a,s,u,l){n.getVertexPosition(s,Rp),n.getVertexPosition(u,Ap),n.getVertexPosition(l,Ip);const c=aG(n,e,t,r,Rp,Ap,Ip,QE);if(c){const h=new Te;Mo.getBarycoord(QE,Rp,Ap,Ip,h),i&&(c.uv=Mo.getInterpolatedAttribute(i,s,u,l,h,new Wt)),o&&(c.uv1=Mo.getInterpolatedAttribute(o,s,u,l,h,new Wt)),a&&(c.normal=Mo.getInterpolatedAttribute(a,s,u,l,h,new Te),c.normal.dot(r.direction)>0&&c.normal.multiplyScalar(-1));const f={a:s,b:u,c:l,normal:new Te,materialIndex:0};Mo.getNormal(Rp,Ap,Ip,f.normal),c.face=f,c.barycoord=h}return c}class Bd extends uu{constructor(e=1,t=1,r=1,i=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:a};const s=this;i=Math.floor(i),o=Math.floor(o),a=Math.floor(a);const u=[],l=[],c=[],h=[];let f=0,m=0;g("z","y","x",-1,-1,r,t,e,a,o,0),g("z","y","x",1,-1,r,t,-e,a,o,1),g("x","z","y",1,1,e,r,t,i,a,2),g("x","z","y",1,-1,e,r,-t,i,a,3),g("x","y","z",1,-1,e,t,r,i,o,4),g("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(u),this.setAttribute("position",new Qu(l,3)),this.setAttribute("normal",new Qu(c,3)),this.setAttribute("uv",new Qu(h,2));function g(w,v,y,x,E,_,k,C,A,I,T){const R=_/A,N=k/I,O=_/2,V=k/2,F=C/2,B=A+1,U=I+1;let P=0,L=0;const H=new Te;for(let W=0;W<U;W++){const z=W*N-V;for(let q=0;q<B;q++){const re=q*R-O;H[w]=re*x,H[v]=z*E,H[y]=F,l.push(H.x,H.y,H.z),H[w]=0,H[v]=0,H[y]=C>0?1:-1,c.push(H.x,H.y,H.z),h.push(q/A),h.push(1-W/I),P+=1}}for(let W=0;W<I;W++)for(let z=0;z<A;z++){const q=f+z+B*W,re=f+z+B*(W+1),de=f+(z+1)+B*(W+1),ye=f+(z+1)+B*W;u.push(q,re,ye),u.push(re,de,ye),L+=6}s.addGroup(m,L,T),m+=L,f+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Bd(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function jc(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function ei(n){const e={};for(let t=0;t<n.length;t++){const r=jc(n[t]);for(const i in r)e[i]=r[i]}return e}function sG(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function jR(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:gn.workingColorSpace}const uG={clone:jc,merge:ei};var lG=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,cG=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xr extends Qc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=lG,this.fragmentShader=cG,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=jc(e.uniforms),this.uniformsGroups=sG(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class qR extends zi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new sr,this.projectionMatrix=new sr,this.projectionMatrixInverse=new sr,this.coordinateSystem=ua,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ps=new Te,ZE=new Wt,ek=new Wt;class eo extends qR{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=sd*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Yh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return sd*2*Math.atan(Math.tan(Yh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){Ps.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ps.x,Ps.y).multiplyScalar(-e/Ps.z),Ps.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Ps.x,Ps.y).multiplyScalar(-e/Ps.z)}getViewSize(e,t){return this.getViewBounds(e,ZE,ek),t.subVectors(ek,ZE)}setViewOffset(e,t,r,i,o,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Yh*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,l=a.fullHeight;o+=a.offsetX*i/u,t-=a.offsetY*r/l,i*=a.width/u,r*=a.height/l}const s=this.filmOffset;s!==0&&(o+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const ec=-90,tc=1;class hG extends zi{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new eo(ec,tc,e,t);i.layers=this.layers,this.add(i);const o=new eo(ec,tc,e,t);o.layers=this.layers,this.add(o);const a=new eo(ec,tc,e,t);a.layers=this.layers,this.add(a);const s=new eo(ec,tc,e,t);s.layers=this.layers,this.add(s);const u=new eo(ec,tc,e,t);u.layers=this.layers,this.add(u);const l=new eo(ec,tc,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,o,a,s,u]=t;for(const l of t)this.remove(l);if(e===ua)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(e===Gm)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,a,s,u,l,c]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const w=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,o),e.setRenderTarget(r,1,i),e.render(t,a),e.setRenderTarget(r,2,i),e.render(t,s),e.setRenderTarget(r,3,i),e.render(t,u),e.setRenderTarget(r,4,i),e.render(t,l),r.texture.generateMipmaps=w,e.setRenderTarget(r,5,i),e.render(t,c),e.setRenderTarget(h,f,m),e.xr.enabled=g,r.texture.needsPMREMUpdate=!0}}class $R extends jr{constructor(e=[],t=Wc,r,i,o,a,s,u,l,c){super(e,t,r,i,o,a,s,u,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class dG extends ri{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new $R(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Bd(5,5,5),o=new Xr({name:"CubemapFromEquirect",uniforms:jc(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:br,blending:wi});o.uniforms.tEquirect.value=t;const a=new Io(i,o),s=t.minFilter;return t.minFilter===$u&&(t.minFilter=vi),new hG(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,r=!0,i=!0){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,r,i);e.setRenderTarget(o)}}class Fp extends zi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const fG={type:"move"};class Mb{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Fp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Fp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Fp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,o=null,a=null;const s=this._targetRay,u=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){a=!0;for(const w of e.hand.values()){const v=t.getJointPose(w,r),y=this._getHandJoint(l,w);v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=v.radius),y.visible=v!==null}const c=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],f=c.position.distanceTo(h.position),m=.02,g=.005;l.inputState.pinching&&f>m+g?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=m-g&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(u.matrix.fromArray(o.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,o.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(o.linearVelocity)):u.hasLinearVelocity=!1,o.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(o.angularVelocity)):u.hasAngularVelocity=!1));s!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&o!==null&&(i=o),i!==null&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(fG)))}return s!==null&&(s.visible=i!==null),u!==null&&(u.visible=o!==null),l!==null&&(l.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new Fp;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}class cw extends zi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new $a,this.environmentIntensity=1,this.environmentRotation=new $a,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const Rb=new Te,pG=new Te,mG=new Jt;class Ou{constructor(e=new Te(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=Rb.subVectors(r,t).cross(pG.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(Rb),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||mG.getNormalMatrix(e),i=this.coplanarPoint(Rb).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Mu=new q_,gG=new Wt(.5,.5),Op=new Te;class XR{constructor(e=new Ou,t=new Ou,r=new Ou,i=new Ou,o=new Ou,a=new Ou){this.planes=[e,t,r,i,o,a]}set(e,t,r,i,o,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(r),s[3].copy(i),s[4].copy(o),s[5].copy(a),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=ua,r=!1){const i=this.planes,o=e.elements,a=o[0],s=o[1],u=o[2],l=o[3],c=o[4],h=o[5],f=o[6],m=o[7],g=o[8],w=o[9],v=o[10],y=o[11],x=o[12],E=o[13],_=o[14],k=o[15];if(i[0].setComponents(l-a,m-c,y-g,k-x).normalize(),i[1].setComponents(l+a,m+c,y+g,k+x).normalize(),i[2].setComponents(l+s,m+h,y+w,k+E).normalize(),i[3].setComponents(l-s,m-h,y-w,k-E).normalize(),r)i[4].setComponents(u,f,v,_).normalize(),i[5].setComponents(l-u,m-f,y-v,k-_).normalize();else if(i[4].setComponents(l-u,m-f,y-v,k-_).normalize(),t===ua)i[5].setComponents(l+u,m+f,y+v,k+_).normalize();else if(t===Gm)i[5].setComponents(u,f,v,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Mu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Mu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Mu)}intersectsSprite(e){Mu.center.set(0,0,0);const t=gG.distanceTo(e.center);return Mu.radius=.7071067811865476+t,Mu.applyMatrix4(e.matrixWorld),this.intersectsSphere(Mu)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(Op.x=i.normal.x>0?e.max.x:e.min.x,Op.y=i.normal.y>0?e.max.y:e.min.y,Op.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Op)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class $_ extends jr{constructor(e,t,r=Zs,i,o,a,s=Lo,u=Lo,l,c=ad,h=1){if(c!==ad&&c!==Vc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:h};super(f,i,o,a,s,u,c,r,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new j_(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class YR extends jr{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class Ud extends uu{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const o=e/2,a=t/2,s=Math.floor(r),u=Math.floor(i),l=s+1,c=u+1,h=e/s,f=t/u,m=[],g=[],w=[],v=[];for(let y=0;y<c;y++){const x=y*f-a;for(let E=0;E<l;E++){const _=E*h-o;g.push(_,-x,0),w.push(0,0,1),v.push(E/s),v.push(1-y/u)}}for(let y=0;y<u;y++)for(let x=0;x<s;x++){const E=x+l*y,_=x+l*(y+1),k=x+1+l*(y+1),C=x+1+l*y;m.push(E,_,C),m.push(_,k,C)}this.setIndex(m),this.setAttribute("position",new Qu(g,3)),this.setAttribute("normal",new Qu(w,3)),this.setAttribute("uv",new Qu(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ud(e.width,e.height,e.widthSegments,e.heightSegments)}}class vG extends Qc{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Fd,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class yG extends Qc{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class X_ extends qR{constructor(e=-1,t=1,r=1,i=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=r-e,a=r+e,s=i+t,u=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=l*this.view.offsetX,a=o+l*this.view.width,s-=c*this.view.offsetY,u=s-c*this.view.height}this.projectionMatrix.makeOrthographic(o,a,s,u,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class bG extends eo{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class fn{constructor(e){this.value=e}clone(){return new fn(this.value.clone===void 0?this.value:this.value.clone())}}function tk(n,e,t,r){const i=wG(r);switch(t){case NR:return n*e;case FR:return n*e/i.components*i.byteLength;case W_:return n*e/i.components*i.byteLength;case OR:return n*e*2/i.components*i.byteLength;case H_:return n*e*2/i.components*i.byteLength;case PR:return n*e*3/i.components*i.byteLength;case Ao:return n*e*4/i.components*i.byteLength;case G_:return n*e*4/i.components*i.byteLength;case Jp:case Qp:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case Zp:case em:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case L0:case U0:return Math.max(n,16)*Math.max(e,8)/4;case O0:case B0:return Math.max(n,8)*Math.max(e,8)/2;case z0:case W0:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*8;case H0:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case G0:return Math.floor((n+3)/4)*Math.floor((e+3)/4)*16;case V0:return Math.floor((n+4)/5)*Math.floor((e+3)/4)*16;case j0:return Math.floor((n+4)/5)*Math.floor((e+4)/5)*16;case q0:return Math.floor((n+5)/6)*Math.floor((e+4)/5)*16;case $0:return Math.floor((n+5)/6)*Math.floor((e+5)/6)*16;case X0:return Math.floor((n+7)/8)*Math.floor((e+4)/5)*16;case Y0:return Math.floor((n+7)/8)*Math.floor((e+5)/6)*16;case K0:return Math.floor((n+7)/8)*Math.floor((e+7)/8)*16;case J0:return Math.floor((n+9)/10)*Math.floor((e+4)/5)*16;case Q0:return Math.floor((n+9)/10)*Math.floor((e+5)/6)*16;case Z0:return Math.floor((n+9)/10)*Math.floor((e+7)/8)*16;case ew:return Math.floor((n+9)/10)*Math.floor((e+9)/10)*16;case tw:return Math.floor((n+11)/12)*Math.floor((e+9)/10)*16;case nw:return Math.floor((n+11)/12)*Math.floor((e+11)/12)*16;case rw:case iw:case ow:return Math.ceil(n/4)*Math.ceil(e/4)*16;case aw:case sw:return Math.ceil(n/4)*Math.ceil(e/4)*8;case uw:case lw:return Math.ceil(n/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function wG(n){switch(n){case $r:case RR:return{byteLength:1,components:1};case od:case AR:case Pd:return{byteLength:2,components:1};case U_:case z_:return{byteLength:2,components:4};case Zs:case B_:case Wa:return{byteLength:4,components:1};case IR:case DR:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${n}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Nd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Nd);function KR(){let n=null,e=!1,t=null,r=null;function i(o,a){t(o,a),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function _G(n){const e=new WeakMap;function t(s,u){const l=s.array,c=s.usage,h=l.byteLength,f=n.createBuffer();n.bindBuffer(u,f),n.bufferData(u,l,c),s.onUploadCallback();let m;if(l instanceof Float32Array)m=n.FLOAT;else if(typeof Float16Array<"u"&&l instanceof Float16Array)m=n.HALF_FLOAT;else if(l instanceof Uint16Array)s.isFloat16BufferAttribute?m=n.HALF_FLOAT:m=n.UNSIGNED_SHORT;else if(l instanceof Int16Array)m=n.SHORT;else if(l instanceof Uint32Array)m=n.UNSIGNED_INT;else if(l instanceof Int32Array)m=n.INT;else if(l instanceof Int8Array)m=n.BYTE;else if(l instanceof Uint8Array)m=n.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)m=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:f,type:m,bytesPerElement:l.BYTES_PER_ELEMENT,version:s.version,size:h}}function r(s,u,l){const c=u.array,h=u.updateRanges;if(n.bindBuffer(l,s),h.length===0)n.bufferSubData(l,0,c);else{h.sort((m,g)=>m.start-g.start);let f=0;for(let m=1;m<h.length;m++){const g=h[f],w=h[m];w.start<=g.start+g.count+1?g.count=Math.max(g.count,w.start+w.count-g.start):(++f,h[f]=w)}h.length=f+1;for(let m=0,g=h.length;m<g;m++){const w=h[m];n.bufferSubData(l,w.start*c.BYTES_PER_ELEMENT,c,w.start,w.count)}u.clearUpdateRanges()}u.onUploadCallback()}function i(s){return s.isInterleavedBufferAttribute&&(s=s.data),e.get(s)}function o(s){s.isInterleavedBufferAttribute&&(s=s.data);const u=e.get(s);u&&(n.deleteBuffer(u.buffer),e.delete(s))}function a(s,u){if(s.isInterleavedBufferAttribute&&(s=s.data),s.isGLBufferAttribute){const c=e.get(s);(!c||c.version<s.version)&&e.set(s,{buffer:s.buffer,type:s.type,bytesPerElement:s.elementSize,version:s.version});return}const l=e.get(s);if(l===void 0)e.set(s,t(s,u));else if(l.version<s.version){if(l.size!==s.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(l.buffer,s,u),l.version=s.version}}return{get:i,remove:o,update:a}}var xG=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,SG=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,EG=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,kG=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,CG=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,TG=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,MG=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,RG=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,AG=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,IG=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,DG=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,NG=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,PG=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,FG=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,OG=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,LG=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,BG=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,UG=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,zG=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,WG=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,HG=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,GG=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,VG=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,jG=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,qG=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,$G=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,XG=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,YG=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,KG=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,JG=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,QG="gl_FragColor = linearToOutputTexel( gl_FragColor );",ZG=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,eV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,tV=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,nV=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,rV=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,iV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,oV=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,aV=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,sV=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,uV=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,lV=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,cV=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,hV=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,dV=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,fV=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,pV=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,mV=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gV=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,vV=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,yV=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,bV=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,wV=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_V=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,xV=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,SV=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,EV=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,kV=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,CV=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,TV=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,MV=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,RV=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,AV=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,IV=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,DV=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,NV=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,PV=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,FV=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,OV=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,LV=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,BV=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,UV=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,zV=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,WV=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,HV=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,GV=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,VV=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,jV=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,qV=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,$V=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,XV=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,YV=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,KV=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,JV=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,QV=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,ZV=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,ej=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,tj=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,nj=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,rj=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,ij=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,oj=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,aj=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,sj=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,uj=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,lj=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,cj=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,hj=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,dj=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,fj=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,pj=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,mj=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,gj=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,vj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,wj=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _j=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,xj=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Sj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Ej=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,kj=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,Cj=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Tj=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,Mj=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,Rj=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,Aj=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,Ij=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,Dj=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,Nj=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Pj=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Fj=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,Oj=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Lj=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Bj=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Uj=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zj=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Wj=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Hj=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Gj=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Vj=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,jj=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qj=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$j=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Xj=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Yj=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Kj=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Jj=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Qj=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Zj=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,eq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Zt={alphahash_fragment:xG,alphahash_pars_fragment:SG,alphamap_fragment:EG,alphamap_pars_fragment:kG,alphatest_fragment:CG,alphatest_pars_fragment:TG,aomap_fragment:MG,aomap_pars_fragment:RG,batching_pars_vertex:AG,batching_vertex:IG,begin_vertex:DG,beginnormal_vertex:NG,bsdfs:PG,iridescence_fragment:FG,bumpmap_pars_fragment:OG,clipping_planes_fragment:LG,clipping_planes_pars_fragment:BG,clipping_planes_pars_vertex:UG,clipping_planes_vertex:zG,color_fragment:WG,color_pars_fragment:HG,color_pars_vertex:GG,color_vertex:VG,common:jG,cube_uv_reflection_fragment:qG,defaultnormal_vertex:$G,displacementmap_pars_vertex:XG,displacementmap_vertex:YG,emissivemap_fragment:KG,emissivemap_pars_fragment:JG,colorspace_fragment:QG,colorspace_pars_fragment:ZG,envmap_fragment:eV,envmap_common_pars_fragment:tV,envmap_pars_fragment:nV,envmap_pars_vertex:rV,envmap_physical_pars_fragment:pV,envmap_vertex:iV,fog_vertex:oV,fog_pars_vertex:aV,fog_fragment:sV,fog_pars_fragment:uV,gradientmap_pars_fragment:lV,lightmap_pars_fragment:cV,lights_lambert_fragment:hV,lights_lambert_pars_fragment:dV,lights_pars_begin:fV,lights_toon_fragment:mV,lights_toon_pars_fragment:gV,lights_phong_fragment:vV,lights_phong_pars_fragment:yV,lights_physical_fragment:bV,lights_physical_pars_fragment:wV,lights_fragment_begin:_V,lights_fragment_maps:xV,lights_fragment_end:SV,logdepthbuf_fragment:EV,logdepthbuf_pars_fragment:kV,logdepthbuf_pars_vertex:CV,logdepthbuf_vertex:TV,map_fragment:MV,map_pars_fragment:RV,map_particle_fragment:AV,map_particle_pars_fragment:IV,metalnessmap_fragment:DV,metalnessmap_pars_fragment:NV,morphinstance_vertex:PV,morphcolor_vertex:FV,morphnormal_vertex:OV,morphtarget_pars_vertex:LV,morphtarget_vertex:BV,normal_fragment_begin:UV,normal_fragment_maps:zV,normal_pars_fragment:WV,normal_pars_vertex:HV,normal_vertex:GV,normalmap_pars_fragment:VV,clearcoat_normal_fragment_begin:jV,clearcoat_normal_fragment_maps:qV,clearcoat_pars_fragment:$V,iridescence_pars_fragment:XV,opaque_fragment:YV,packing:KV,premultiplied_alpha_fragment:JV,project_vertex:QV,dithering_fragment:ZV,dithering_pars_fragment:ej,roughnessmap_fragment:tj,roughnessmap_pars_fragment:nj,shadowmap_pars_fragment:rj,shadowmap_pars_vertex:ij,shadowmap_vertex:oj,shadowmask_pars_fragment:aj,skinbase_vertex:sj,skinning_pars_vertex:uj,skinning_vertex:lj,skinnormal_vertex:cj,specularmap_fragment:hj,specularmap_pars_fragment:dj,tonemapping_fragment:fj,tonemapping_pars_fragment:pj,transmission_fragment:mj,transmission_pars_fragment:gj,uv_pars_fragment:vj,uv_pars_vertex:yj,uv_vertex:bj,worldpos_vertex:wj,background_vert:_j,background_frag:xj,backgroundCube_vert:Sj,backgroundCube_frag:Ej,cube_vert:kj,cube_frag:Cj,depth_vert:Tj,depth_frag:Mj,distanceRGBA_vert:Rj,distanceRGBA_frag:Aj,equirect_vert:Ij,equirect_frag:Dj,linedashed_vert:Nj,linedashed_frag:Pj,meshbasic_vert:Fj,meshbasic_frag:Oj,meshlambert_vert:Lj,meshlambert_frag:Bj,meshmatcap_vert:Uj,meshmatcap_frag:zj,meshnormal_vert:Wj,meshnormal_frag:Hj,meshphong_vert:Gj,meshphong_frag:Vj,meshphysical_vert:jj,meshphysical_frag:qj,meshtoon_vert:$j,meshtoon_frag:Xj,points_vert:Yj,points_frag:Kj,shadow_vert:Jj,shadow_frag:Qj,sprite_vert:Zj,sprite_frag:eq},ut={common:{diffuse:{value:new Sn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Jt},alphaMap:{value:null},alphaMapTransform:{value:new Jt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Jt}},envmap:{envMap:{value:null},envMapRotation:{value:new Jt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Jt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Jt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Jt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Jt},normalScale:{value:new Wt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Jt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Jt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Jt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Jt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Sn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Sn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Jt},alphaTest:{value:0},uvTransform:{value:new Jt}},sprite:{diffuse:{value:new Sn(16777215)},opacity:{value:1},center:{value:new Wt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Jt},alphaMap:{value:null},alphaMapTransform:{value:new Jt},alphaTest:{value:0}}},na={basic:{uniforms:ei([ut.common,ut.specularmap,ut.envmap,ut.aomap,ut.lightmap,ut.fog]),vertexShader:Zt.meshbasic_vert,fragmentShader:Zt.meshbasic_frag},lambert:{uniforms:ei([ut.common,ut.specularmap,ut.envmap,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)}}]),vertexShader:Zt.meshlambert_vert,fragmentShader:Zt.meshlambert_frag},phong:{uniforms:ei([ut.common,ut.specularmap,ut.envmap,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)},specular:{value:new Sn(1118481)},shininess:{value:30}}]),vertexShader:Zt.meshphong_vert,fragmentShader:Zt.meshphong_frag},standard:{uniforms:ei([ut.common,ut.envmap,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.roughnessmap,ut.metalnessmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Zt.meshphysical_vert,fragmentShader:Zt.meshphysical_frag},toon:{uniforms:ei([ut.common,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.gradientmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)}}]),vertexShader:Zt.meshtoon_vert,fragmentShader:Zt.meshtoon_frag},matcap:{uniforms:ei([ut.common,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.fog,{matcap:{value:null}}]),vertexShader:Zt.meshmatcap_vert,fragmentShader:Zt.meshmatcap_frag},points:{uniforms:ei([ut.points,ut.fog]),vertexShader:Zt.points_vert,fragmentShader:Zt.points_frag},dashed:{uniforms:ei([ut.common,ut.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Zt.linedashed_vert,fragmentShader:Zt.linedashed_frag},depth:{uniforms:ei([ut.common,ut.displacementmap]),vertexShader:Zt.depth_vert,fragmentShader:Zt.depth_frag},normal:{uniforms:ei([ut.common,ut.bumpmap,ut.normalmap,ut.displacementmap,{opacity:{value:1}}]),vertexShader:Zt.meshnormal_vert,fragmentShader:Zt.meshnormal_frag},sprite:{uniforms:ei([ut.sprite,ut.fog]),vertexShader:Zt.sprite_vert,fragmentShader:Zt.sprite_frag},background:{uniforms:{uvTransform:{value:new Jt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Zt.background_vert,fragmentShader:Zt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Jt}},vertexShader:Zt.backgroundCube_vert,fragmentShader:Zt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Zt.cube_vert,fragmentShader:Zt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Zt.equirect_vert,fragmentShader:Zt.equirect_frag},distanceRGBA:{uniforms:ei([ut.common,ut.displacementmap,{referencePosition:{value:new Te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Zt.distanceRGBA_vert,fragmentShader:Zt.distanceRGBA_frag},shadow:{uniforms:ei([ut.lights,ut.fog,{color:{value:new Sn(0)},opacity:{value:1}}]),vertexShader:Zt.shadow_vert,fragmentShader:Zt.shadow_frag}};na.physical={uniforms:ei([na.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Jt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Jt},clearcoatNormalScale:{value:new Wt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Jt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Jt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Jt},sheen:{value:0},sheenColor:{value:new Sn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Jt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Jt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Jt},transmissionSamplerSize:{value:new Wt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Jt},attenuationDistance:{value:0},attenuationColor:{value:new Sn(0)},specularColor:{value:new Sn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Jt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Jt},anisotropyVector:{value:new Wt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Jt}}]),vertexShader:Zt.meshphysical_vert,fragmentShader:Zt.meshphysical_frag};const Lp={r:0,b:0,g:0},Ru=new $a,tq=new sr;function nq(n,e,t,r,i,o,a){const s=new Sn(0);let u=o===!0?0:1,l,c,h=null,f=0,m=null;function g(E){let _=E.isScene===!0?E.background:null;return _&&_.isTexture&&(_=(E.backgroundBlurriness>0?t:e).get(_)),_}function w(E){let _=!1;const k=g(E);k===null?y(s,u):k&&k.isColor&&(y(k,1),_=!0);const C=n.xr.getEnvironmentBlendMode();C==="additive"?r.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,a),(n.autoClear||_)&&(r.buffers.depth.setTest(!0),r.buffers.depth.setMask(!0),r.buffers.color.setMask(!0),n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil))}function v(E,_){const k=g(_);k&&(k.isCubeTexture||k.mapping===bg)?(c===void 0&&(c=new Io(new Bd(1,1,1),new Xr({name:"BackgroundCubeMaterial",uniforms:jc(na.backgroundCube.uniforms),vertexShader:na.backgroundCube.vertexShader,fragmentShader:na.backgroundCube.fragmentShader,side:br,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(C,A,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),Ru.copy(_.backgroundRotation),Ru.x*=-1,Ru.y*=-1,Ru.z*=-1,k.isCubeTexture&&k.isRenderTargetTexture===!1&&(Ru.y*=-1,Ru.z*=-1),c.material.uniforms.envMap.value=k,c.material.uniforms.flipEnvMap.value=k.isCubeTexture&&k.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(tq.makeRotationFromEuler(Ru)),c.material.toneMapped=gn.getTransfer(k.colorSpace)!==Mn,(h!==k||f!==k.version||m!==n.toneMapping)&&(c.material.needsUpdate=!0,h=k,f=k.version,m=n.toneMapping),c.layers.enableAll(),E.unshift(c,c.geometry,c.material,0,0,null)):k&&k.isTexture&&(l===void 0&&(l=new Io(new Ud(2,2),new Xr({name:"BackgroundMaterial",uniforms:jc(na.background.uniforms),vertexShader:na.background.vertexShader,fragmentShader:na.background.fragmentShader,side:qa,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=k,l.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,l.material.toneMapped=gn.getTransfer(k.colorSpace)!==Mn,k.matrixAutoUpdate===!0&&k.updateMatrix(),l.material.uniforms.uvTransform.value.copy(k.matrix),(h!==k||f!==k.version||m!==n.toneMapping)&&(l.material.needsUpdate=!0,h=k,f=k.version,m=n.toneMapping),l.layers.enableAll(),E.unshift(l,l.geometry,l.material,0,0,null))}function y(E,_){E.getRGB(Lp,jR(n)),r.buffers.color.setClear(Lp.r,Lp.g,Lp.b,_,a)}function x(){c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return s},setClearColor:function(E,_=1){s.set(E),u=_,y(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(E){u=E,y(s,u)},render:w,addToRenderList:v,dispose:x}}function rq(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=f(null);let o=i,a=!1;function s(R,N,O,V,F){let B=!1;const U=h(V,O,N);o!==U&&(o=U,l(o.object)),B=m(R,V,O,F),B&&g(R,V,O,F),F!==null&&e.update(F,n.ELEMENT_ARRAY_BUFFER),(B||a)&&(a=!1,_(R,N,O,V),F!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(F).buffer))}function u(){return n.createVertexArray()}function l(R){return n.bindVertexArray(R)}function c(R){return n.deleteVertexArray(R)}function h(R,N,O){const V=O.wireframe===!0;let F=r[R.id];F===void 0&&(F={},r[R.id]=F);let B=F[N.id];B===void 0&&(B={},F[N.id]=B);let U=B[V];return U===void 0&&(U=f(u()),B[V]=U),U}function f(R){const N=[],O=[],V=[];for(let F=0;F<t;F++)N[F]=0,O[F]=0,V[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:N,enabledAttributes:O,attributeDivisors:V,object:R,attributes:{},index:null}}function m(R,N,O,V){const F=o.attributes,B=N.attributes;let U=0;const P=O.getAttributes();for(const L in P)if(P[L].location>=0){const W=F[L];let z=B[L];if(z===void 0&&(L==="instanceMatrix"&&R.instanceMatrix&&(z=R.instanceMatrix),L==="instanceColor"&&R.instanceColor&&(z=R.instanceColor)),W===void 0||W.attribute!==z||z&&W.data!==z.data)return!0;U++}return o.attributesNum!==U||o.index!==V}function g(R,N,O,V){const F={},B=N.attributes;let U=0;const P=O.getAttributes();for(const L in P)if(P[L].location>=0){let W=B[L];W===void 0&&(L==="instanceMatrix"&&R.instanceMatrix&&(W=R.instanceMatrix),L==="instanceColor"&&R.instanceColor&&(W=R.instanceColor));const z={};z.attribute=W,W&&W.data&&(z.data=W.data),F[L]=z,U++}o.attributes=F,o.attributesNum=U,o.index=V}function w(){const R=o.newAttributes;for(let N=0,O=R.length;N<O;N++)R[N]=0}function v(R){y(R,0)}function y(R,N){const O=o.newAttributes,V=o.enabledAttributes,F=o.attributeDivisors;O[R]=1,V[R]===0&&(n.enableVertexAttribArray(R),V[R]=1),F[R]!==N&&(n.vertexAttribDivisor(R,N),F[R]=N)}function x(){const R=o.newAttributes,N=o.enabledAttributes;for(let O=0,V=N.length;O<V;O++)N[O]!==R[O]&&(n.disableVertexAttribArray(O),N[O]=0)}function E(R,N,O,V,F,B,U){U===!0?n.vertexAttribIPointer(R,N,O,F,B):n.vertexAttribPointer(R,N,O,V,F,B)}function _(R,N,O,V){w();const F=V.attributes,B=O.getAttributes(),U=N.defaultAttributeValues;for(const P in B){const L=B[P];if(L.location>=0){let H=F[P];if(H===void 0&&(P==="instanceMatrix"&&R.instanceMatrix&&(H=R.instanceMatrix),P==="instanceColor"&&R.instanceColor&&(H=R.instanceColor)),H!==void 0){const W=H.normalized,z=H.itemSize,q=e.get(H);if(q===void 0)continue;const re=q.buffer,de=q.type,ye=q.bytesPerElement,te=de===n.INT||de===n.UNSIGNED_INT||H.gpuType===B_;if(H.isInterleavedBufferAttribute){const ie=H.data,fe=ie.stride,Re=H.offset;if(ie.isInstancedInterleavedBuffer){for(let De=0;De<L.locationSize;De++)y(L.location+De,ie.meshPerAttribute);R.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=ie.meshPerAttribute*ie.count)}else for(let De=0;De<L.locationSize;De++)v(L.location+De);n.bindBuffer(n.ARRAY_BUFFER,re);for(let De=0;De<L.locationSize;De++)E(L.location+De,z/L.locationSize,de,W,fe*ye,(Re+z/L.locationSize*De)*ye,te)}else{if(H.isInstancedBufferAttribute){for(let ie=0;ie<L.locationSize;ie++)y(L.location+ie,H.meshPerAttribute);R.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=H.meshPerAttribute*H.count)}else for(let ie=0;ie<L.locationSize;ie++)v(L.location+ie);n.bindBuffer(n.ARRAY_BUFFER,re);for(let ie=0;ie<L.locationSize;ie++)E(L.location+ie,z/L.locationSize,de,W,z*ye,z/L.locationSize*ie*ye,te)}}else if(U!==void 0){const W=U[P];if(W!==void 0)switch(W.length){case 2:n.vertexAttrib2fv(L.location,W);break;case 3:n.vertexAttrib3fv(L.location,W);break;case 4:n.vertexAttrib4fv(L.location,W);break;default:n.vertexAttrib1fv(L.location,W)}}}}x()}function k(){I();for(const R in r){const N=r[R];for(const O in N){const V=N[O];for(const F in V)c(V[F].object),delete V[F];delete N[O]}delete r[R]}}function C(R){if(r[R.id]===void 0)return;const N=r[R.id];for(const O in N){const V=N[O];for(const F in V)c(V[F].object),delete V[F];delete N[O]}delete r[R.id]}function A(R){for(const N in r){const O=r[N];if(O[R.id]===void 0)continue;const V=O[R.id];for(const F in V)c(V[F].object),delete V[F];delete O[R.id]}}function I(){T(),a=!0,o!==i&&(o=i,l(o.object))}function T(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:s,reset:I,resetDefaultState:T,dispose:k,releaseStatesOfGeometry:C,releaseStatesOfProgram:A,initAttributes:w,enableAttribute:v,disableUnusedAttributes:x}}function iq(n,e,t){let r;function i(l){r=l}function o(l,c){n.drawArrays(r,l,c),t.update(c,r,1)}function a(l,c,h){h!==0&&(n.drawArraysInstanced(r,l,c,h),t.update(c,r,h))}function s(l,c,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(r,l,0,c,0,h);let m=0;for(let g=0;g<h;g++)m+=c[g];t.update(m,r,1)}function u(l,c,h,f){if(h===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<l.length;g++)a(l[g],c[g],f[g]);else{m.multiDrawArraysInstancedWEBGL(r,l,0,c,0,f,0,h);let g=0;for(let w=0;w<h;w++)g+=c[w]*f[w];t.update(g,r,1)}}this.setMode=i,this.render=o,this.renderInstances=a,this.renderMultiDraw=s,this.renderMultiDrawInstances=u}function oq(n,e,t,r){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const A=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(A.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(A){return!(A!==Ao&&r.convert(A)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_FORMAT))}function s(A){const I=A===Pd&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(A!==$r&&r.convert(A)!==n.getParameter(n.IMPLEMENTATION_COLOR_READ_TYPE)&&A!==Wa&&!I)}function u(A){if(A==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";A="mediump"}return A==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=t.precision!==void 0?t.precision:"highp";const c=u(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);const h=t.logarithmicDepthBuffer===!0,f=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),g=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),w=n.getParameter(n.MAX_TEXTURE_SIZE),v=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),y=n.getParameter(n.MAX_VERTEX_ATTRIBS),x=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),E=n.getParameter(n.MAX_VARYING_VECTORS),_=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),k=g>0,C=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:u,textureFormatReadable:a,textureTypeReadable:s,precision:l,logarithmicDepthBuffer:h,reversedDepthBuffer:f,maxTextures:m,maxVertexTextures:g,maxTextureSize:w,maxCubemapSize:v,maxAttributes:y,maxVertexUniforms:x,maxVaryings:E,maxFragmentUniforms:_,vertexTextures:k,maxSamples:C}}function aq(n){const e=this;let t=null,r=0,i=!1,o=!1;const a=new Ou,s=new Jt,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const m=h.length!==0||f||r!==0||i;return i=f,r=h.length,m},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(h,f){t=c(h,f,0)},this.setState=function(h,f,m){const g=h.clippingPlanes,w=h.clipIntersection,v=h.clipShadows,y=n.get(h);if(!i||g===null||g.length===0||o&&!v)o?c(null):l();else{const x=o?0:r,E=x*4;let _=y.clippingState||null;u.value=_,_=c(g,f,E,m);for(let k=0;k!==E;++k)_[k]=t[k];y.clippingState=_,this.numIntersection=w?this.numPlanes:0,this.numPlanes+=x}};function l(){u.value!==t&&(u.value=t,u.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function c(h,f,m,g){const w=h!==null?h.length:0;let v=null;if(w!==0){if(v=u.value,g!==!0||v===null){const y=m+w*4,x=f.matrixWorldInverse;s.getNormalMatrix(x),(v===null||v.length<y)&&(v=new Float32Array(y));for(let E=0,_=m;E!==w;++E,_+=4)a.copy(h[E]).applyMatrix4(x,s),a.normal.toArray(v,_),v[_+3]=a.constant}u.value=v,u.needsUpdate=!0}return e.numPlanes=w,e.numIntersection=0,v}}function sq(n){let e=new WeakMap;function t(a,s){return s===D0?a.mapping=Wc:s===N0&&(a.mapping=Hc),a}function r(a){if(a&&a.isTexture){const s=a.mapping;if(s===D0||s===N0)if(e.has(a)){const u=e.get(a).texture;return t(u,a.mapping)}else{const u=a.image;if(u&&u.height>0){const l=new dG(u.height);return l.fromEquirectangularTexture(n,a),e.set(a,l),a.addEventListener("dispose",i),t(l.texture,a.mapping)}else return null}}return a}function i(a){const s=a.target;s.removeEventListener("dispose",i);const u=e.get(s);u!==void 0&&(e.delete(s),u.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}const pc=4,nk=[.125,.215,.35,.446,.526,.582],Wu=20,Ab=new X_,rk=new Sn;let Ib=null,Db=0,Nb=0,Pb=!1;const Lu=(1+Math.sqrt(5))/2,nc=1/Lu,ik=[new Te(-Lu,nc,0),new Te(Lu,nc,0),new Te(-nc,0,Lu),new Te(nc,0,Lu),new Te(0,Lu,-nc),new Te(0,Lu,nc),new Te(-1,1,-1),new Te(1,1,-1),new Te(-1,1,1),new Te(1,1,1)],uq=new Te;class ok{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100,o={}){const{size:a=256,position:s=uq}=o;Ib=this._renderer.getRenderTarget(),Db=this._renderer.getActiveCubeFace(),Nb=this._renderer.getActiveMipmapLevel(),Pb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,r,i,u,s),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=uk(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=sk(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Ib,Db,Nb),this._renderer.xr.enabled=Pb,e.scissorTest=!1,Bp(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Wc||e.mapping===Hc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Ib=this._renderer.getRenderTarget(),Db=this._renderer.getActiveCubeFace(),Nb=this._renderer.getActiveMipmapLevel(),Pb=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:Pd,format:Ao,colorSpace:eu,depthBuffer:!1},i=ak(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ak(e,t,r);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=lq(o)),this._blurMaterial=cq(o,e,t)}return i}_compileMaterial(e){const t=new Io(this._lodPlanes[0],e);this._renderer.compile(t,Ab)}_sceneToCubeUV(e,t,r,i,o){const u=new eo(90,1,t,r),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,m=h.toneMapping;h.getClearColor(rk),h.toneMapping=Ga,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(i),h.clearDepth(),h.setRenderTarget(null));const w=new HR({name:"PMREM.Background",side:br,depthWrite:!1,depthTest:!1}),v=new Io(new Bd,w);let y=!1;const x=e.background;x?x.isColor&&(w.color.copy(x),e.background=null,y=!0):(w.color.copy(rk),y=!0);for(let E=0;E<6;E++){const _=E%3;_===0?(u.up.set(0,l[E],0),u.position.set(o.x,o.y,o.z),u.lookAt(o.x+c[E],o.y,o.z)):_===1?(u.up.set(0,0,l[E]),u.position.set(o.x,o.y,o.z),u.lookAt(o.x,o.y+c[E],o.z)):(u.up.set(0,l[E],0),u.position.set(o.x,o.y,o.z),u.lookAt(o.x,o.y,o.z+c[E]));const k=this._cubeSize;Bp(i,_*k,E>2?k:0,k,k),h.setRenderTarget(i),y&&h.render(v,u),h.render(e,u)}v.geometry.dispose(),v.material.dispose(),h.toneMapping=m,h.autoClear=f,e.background=x}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===Wc||e.mapping===Hc;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=uk()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=sk());const o=i?this._cubemapMaterial:this._equirectMaterial,a=new Io(this._lodPlanes[0],o),s=o.uniforms;s.envMap.value=e;const u=this._cubeSize;Bp(t,0,0,3*u,2*u),r.setRenderTarget(t),r.render(a,Ab)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let o=1;o<i;o++){const a=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),s=ik[(i-o-1)%ik.length];this._blur(e,o-1,o,a,s)}t.autoClear=r}_blur(e,t,r,i,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,r,i,"latitudinal",o),this._halfBlur(a,e,r,r,i,"longitudinal",o)}_halfBlur(e,t,r,i,o,a,s){const u=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new Io(this._lodPlanes[i],l),f=l.uniforms,m=this._sizeLods[r]-1,g=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Wu-1),w=o/g,v=isFinite(o)?1+Math.floor(c*w):Wu;v>Wu&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Wu}`);const y=[];let x=0;for(let A=0;A<Wu;++A){const I=A/w,T=Math.exp(-I*I/2);y.push(T),A===0?x+=T:A<v&&(x+=2*T)}for(let A=0;A<y.length;A++)y[A]=y[A]/x;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=y,f.latitudinal.value=a==="latitudinal",s&&(f.poleAxis.value=s);const{_lodMax:E}=this;f.dTheta.value=g,f.mipInt.value=E-r;const _=this._sizeLods[i],k=3*_*(i>E-pc?i-E+pc:0),C=4*(this._cubeSize-_);Bp(t,k,C,3*_,2*_),u.setRenderTarget(t),u.render(h,Ab)}}function lq(n){const e=[],t=[],r=[];let i=n;const o=n-pc+1+nk.length;for(let a=0;a<o;a++){const s=Math.pow(2,i);t.push(s);let u=1/s;a>n-pc?u=nk[a-n+pc-1]:a===0&&(u=0),r.push(u);const l=1/(s-2),c=-l,h=1+l,f=[c,c,h,c,h,h,c,c,h,h,c,h],m=6,g=6,w=3,v=2,y=1,x=new Float32Array(w*g*m),E=new Float32Array(v*g*m),_=new Float32Array(y*g*m);for(let C=0;C<m;C++){const A=C%3*2/3-1,I=C>2?0:-1,T=[A,I,0,A+2/3,I,0,A+2/3,I+1,0,A,I,0,A+2/3,I+1,0,A,I+1,0];x.set(T,w*g*C),E.set(f,v*g*C);const R=[C,C,C,C,C,C];_.set(R,y*g*C)}const k=new uu;k.setAttribute("position",new io(x,w)),k.setAttribute("uv",new io(E,v)),k.setAttribute("faceIndex",new io(_,y)),e.push(k),i>pc&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function ak(n,e,t){const r=new ri(n,e,t);return r.texture.mapping=bg,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Bp(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function cq(n,e,t){const r=new Float32Array(Wu),i=new Te(0,1,0);return new Xr({name:"SphericalGaussianBlur",defines:{n:Wu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:Y_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:wi,depthTest:!1,depthWrite:!1})}function sk(){return new Xr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Y_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:wi,depthTest:!1,depthWrite:!1})}function uk(){return new Xr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Y_(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:wi,depthTest:!1,depthWrite:!1})}function Y_(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function hq(n){let e=new WeakMap,t=null;function r(s){if(s&&s.isTexture){const u=s.mapping,l=u===D0||u===N0,c=u===Wc||u===Hc;if(l||c){let h=e.get(s);const f=h!==void 0?h.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==f)return t===null&&(t=new ok(n)),h=l?t.fromEquirectangular(s,h):t.fromCubemap(s,h),h.texture.pmremVersion=s.pmremVersion,e.set(s,h),h.texture;if(h!==void 0)return h.texture;{const m=s.image;return l&&m&&m.height>0||c&&m&&i(m)?(t===null&&(t=new ok(n)),h=l?t.fromEquirectangular(s):t.fromCubemap(s),h.texture.pmremVersion=s.pmremVersion,e.set(s,h),s.addEventListener("dispose",o),h.texture):null}}}return s}function i(s){let u=0;const l=6;for(let c=0;c<l;c++)s[c]!==void 0&&u++;return u===l}function o(s){const u=s.target;u.removeEventListener("dispose",o);const l=e.get(u);l!==void 0&&(e.delete(u),l.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:a}}function dq(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&ud("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function fq(n,e,t,r){const i={},o=new WeakMap;function a(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);f.removeEventListener("dispose",a),delete i[f.id];const m=o.get(f);m&&(e.remove(m),o.delete(f)),r.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function s(h,f){return i[f.id]===!0||(f.addEventListener("dispose",a),i[f.id]=!0,t.memory.geometries++),f}function u(h){const f=h.attributes;for(const m in f)e.update(f[m],n.ARRAY_BUFFER)}function l(h){const f=[],m=h.index,g=h.attributes.position;let w=0;if(m!==null){const x=m.array;w=m.version;for(let E=0,_=x.length;E<_;E+=3){const k=x[E+0],C=x[E+1],A=x[E+2];f.push(k,C,C,A,A,k)}}else if(g!==void 0){const x=g.array;w=g.version;for(let E=0,_=x.length/3-1;E<_;E+=3){const k=E+0,C=E+1,A=E+2;f.push(k,C,C,A,A,k)}}else return;const v=new(BR(f)?VR:GR)(f,1);v.version=w;const y=o.get(h);y&&e.remove(y),o.set(h,v)}function c(h){const f=o.get(h);if(f){const m=h.index;m!==null&&f.version<m.version&&l(h)}else l(h);return o.get(h)}return{get:s,update:u,getWireframeAttribute:c}}function pq(n,e,t){let r;function i(f){r=f}let o,a;function s(f){o=f.type,a=f.bytesPerElement}function u(f,m){n.drawElements(r,m,o,f*a),t.update(m,r,1)}function l(f,m,g){g!==0&&(n.drawElementsInstanced(r,m,o,f*a,g),t.update(m,r,g))}function c(f,m,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(r,m,0,o,f,0,g);let v=0;for(let y=0;y<g;y++)v+=m[y];t.update(v,r,1)}function h(f,m,g,w){if(g===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let y=0;y<f.length;y++)l(f[y]/a,m[y],w[y]);else{v.multiDrawElementsInstancedWEBGL(r,m,0,o,f,0,w,0,g);let y=0;for(let x=0;x<g;x++)y+=m[x]*w[x];t.update(y,r,1)}}this.setMode=i,this.setIndex=s,this.render=u,this.renderInstances=l,this.renderMultiDraw=c,this.renderMultiDrawInstances=h}function mq(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,a,s){switch(t.calls++,a){case n.TRIANGLES:t.triangles+=s*(o/3);break;case n.LINES:t.lines+=s*(o/2);break;case n.LINE_STRIP:t.lines+=s*(o-1);break;case n.LINE_LOOP:t.lines+=s*o;break;case n.POINTS:t.points+=s*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function gq(n,e,t){const r=new WeakMap,i=new Hn;function o(a,s,u){const l=a.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,h=c!==void 0?c.length:0;let f=r.get(s);if(f===void 0||f.count!==h){let T=function(){A.dispose(),r.delete(s),s.removeEventListener("dispose",T)};f!==void 0&&f.texture.dispose();const m=s.morphAttributes.position!==void 0,g=s.morphAttributes.normal!==void 0,w=s.morphAttributes.color!==void 0,v=s.morphAttributes.position||[],y=s.morphAttributes.normal||[],x=s.morphAttributes.color||[];let E=0;m===!0&&(E=1),g===!0&&(E=2),w===!0&&(E=3);let _=s.attributes.position.count*E,k=1;_>e.maxTextureSize&&(k=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const C=new Float32Array(_*k*4*h),A=new UR(C,_,k,h);A.type=Wa,A.needsUpdate=!0;const I=E*4;for(let R=0;R<h;R++){const N=v[R],O=y[R],V=x[R],F=_*k*4*R;for(let B=0;B<N.count;B++){const U=B*I;m===!0&&(i.fromBufferAttribute(N,B),C[F+U+0]=i.x,C[F+U+1]=i.y,C[F+U+2]=i.z,C[F+U+3]=0),g===!0&&(i.fromBufferAttribute(O,B),C[F+U+4]=i.x,C[F+U+5]=i.y,C[F+U+6]=i.z,C[F+U+7]=0),w===!0&&(i.fromBufferAttribute(V,B),C[F+U+8]=i.x,C[F+U+9]=i.y,C[F+U+10]=i.z,C[F+U+11]=V.itemSize===4?i.w:1)}}f={count:h,texture:A,size:new Wt(_,k)},r.set(s,f),s.addEventListener("dispose",T)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)u.getUniforms().setValue(n,"morphTexture",a.morphTexture,t);else{let m=0;for(let w=0;w<l.length;w++)m+=l[w];const g=s.morphTargetsRelative?1:1-m;u.getUniforms().setValue(n,"morphTargetBaseInfluence",g),u.getUniforms().setValue(n,"morphTargetInfluences",l)}u.getUniforms().setValue(n,"morphTargetsTexture",f.texture,t),u.getUniforms().setValue(n,"morphTargetsTextureSize",f.size)}return{update:o}}function vq(n,e,t,r){let i=new WeakMap;function o(u){const l=r.render.frame,c=u.geometry,h=e.get(u,c);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),u.isInstancedMesh&&(u.hasEventListener("dispose",s)===!1&&u.addEventListener("dispose",s),i.get(u)!==l&&(t.update(u.instanceMatrix,n.ARRAY_BUFFER),u.instanceColor!==null&&t.update(u.instanceColor,n.ARRAY_BUFFER),i.set(u,l))),u.isSkinnedMesh){const f=u.skeleton;i.get(f)!==l&&(f.update(),i.set(f,l))}return h}function a(){i=new WeakMap}function s(u){const l=u.target;l.removeEventListener("dispose",s),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:o,dispose:a}}const JR=new jr,lk=new $_(1,1),QR=new UR,ZR=new XH,eA=new $R,ck=[],hk=[],dk=new Float32Array(16),fk=new Float32Array(9),pk=new Float32Array(4);function Zc(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let o=ck[i];if(o===void 0&&(o=new Float32Array(i),ck[i]=o),e!==0){r.toArray(o,0);for(let a=1,s=0;a!==e;++a)s+=t,n[a].toArray(o,s)}return o}function cr(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function hr(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function wg(n,e){let t=hk[e];t===void 0&&(t=new Int32Array(e),hk[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function yq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function bq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cr(t,e))return;n.uniform2fv(this.addr,e),hr(t,e)}}function wq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(cr(t,e))return;n.uniform3fv(this.addr,e),hr(t,e)}}function _q(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cr(t,e))return;n.uniform4fv(this.addr,e),hr(t,e)}}function xq(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(cr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),hr(t,e)}else{if(cr(t,r))return;pk.set(r),n.uniformMatrix2fv(this.addr,!1,pk),hr(t,r)}}function Sq(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(cr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),hr(t,e)}else{if(cr(t,r))return;fk.set(r),n.uniformMatrix3fv(this.addr,!1,fk),hr(t,r)}}function Eq(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(cr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),hr(t,e)}else{if(cr(t,r))return;dk.set(r),n.uniformMatrix4fv(this.addr,!1,dk),hr(t,r)}}function kq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function Cq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cr(t,e))return;n.uniform2iv(this.addr,e),hr(t,e)}}function Tq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(cr(t,e))return;n.uniform3iv(this.addr,e),hr(t,e)}}function Mq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cr(t,e))return;n.uniform4iv(this.addr,e),hr(t,e)}}function Rq(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function Aq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cr(t,e))return;n.uniform2uiv(this.addr,e),hr(t,e)}}function Iq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(cr(t,e))return;n.uniform3uiv(this.addr,e),hr(t,e)}}function Dq(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cr(t,e))return;n.uniform4uiv(this.addr,e),hr(t,e)}}function Nq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);let o;this.type===n.SAMPLER_2D_SHADOW?(lk.compareFunction=LR,o=lk):o=JR,t.setTexture2D(e||o,i)}function Pq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||ZR,i)}function Fq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||eA,i)}function Oq(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||QR,i)}function Lq(n){switch(n){case 5126:return yq;case 35664:return bq;case 35665:return wq;case 35666:return _q;case 35674:return xq;case 35675:return Sq;case 35676:return Eq;case 5124:case 35670:return kq;case 35667:case 35671:return Cq;case 35668:case 35672:return Tq;case 35669:case 35673:return Mq;case 5125:return Rq;case 36294:return Aq;case 36295:return Iq;case 36296:return Dq;case 35678:case 36198:case 36298:case 36306:case 35682:return Nq;case 35679:case 36299:case 36307:return Pq;case 35680:case 36300:case 36308:case 36293:return Fq;case 36289:case 36303:case 36311:case 36292:return Oq}}function Bq(n,e){n.uniform1fv(this.addr,e)}function Uq(n,e){const t=Zc(e,this.size,2);n.uniform2fv(this.addr,t)}function zq(n,e){const t=Zc(e,this.size,3);n.uniform3fv(this.addr,t)}function Wq(n,e){const t=Zc(e,this.size,4);n.uniform4fv(this.addr,t)}function Hq(n,e){const t=Zc(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function Gq(n,e){const t=Zc(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function Vq(n,e){const t=Zc(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function jq(n,e){n.uniform1iv(this.addr,e)}function qq(n,e){n.uniform2iv(this.addr,e)}function $q(n,e){n.uniform3iv(this.addr,e)}function Xq(n,e){n.uniform4iv(this.addr,e)}function Yq(n,e){n.uniform1uiv(this.addr,e)}function Kq(n,e){n.uniform2uiv(this.addr,e)}function Jq(n,e){n.uniform3uiv(this.addr,e)}function Qq(n,e){n.uniform4uiv(this.addr,e)}function Zq(n,e,t){const r=this.cache,i=e.length,o=wg(t,i);cr(r,o)||(n.uniform1iv(this.addr,o),hr(r,o));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||JR,o[a])}function e$(n,e,t){const r=this.cache,i=e.length,o=wg(t,i);cr(r,o)||(n.uniform1iv(this.addr,o),hr(r,o));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||ZR,o[a])}function t$(n,e,t){const r=this.cache,i=e.length,o=wg(t,i);cr(r,o)||(n.uniform1iv(this.addr,o),hr(r,o));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||eA,o[a])}function n$(n,e,t){const r=this.cache,i=e.length,o=wg(t,i);cr(r,o)||(n.uniform1iv(this.addr,o),hr(r,o));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||QR,o[a])}function r$(n){switch(n){case 5126:return Bq;case 35664:return Uq;case 35665:return zq;case 35666:return Wq;case 35674:return Hq;case 35675:return Gq;case 35676:return Vq;case 5124:case 35670:return jq;case 35667:case 35671:return qq;case 35668:case 35672:return $q;case 35669:case 35673:return Xq;case 5125:return Yq;case 36294:return Kq;case 36295:return Jq;case 36296:return Qq;case 35678:case 36198:case 36298:case 36306:case 35682:return Zq;case 35679:case 36299:case 36307:return e$;case 35680:case 36300:case 36308:case 36293:return t$;case 36289:case 36303:case 36311:case 36292:return n$}}class i${constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=Lq(t.type)}}class o${constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=r$(t.type)}}class a${constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let o=0,a=i.length;o!==a;++o){const s=i[o];s.setValue(e,t[s.id],r)}}}const Fb=/(\w+)(\])?(\[|\.)?/g;function mk(n,e){n.seq.push(e),n.map[e.id]=e}function s$(n,e,t){const r=n.name,i=r.length;for(Fb.lastIndex=0;;){const o=Fb.exec(r),a=Fb.lastIndex;let s=o[1];const u=o[2]==="]",l=o[3];if(u&&(s=s|0),l===void 0||l==="["&&a+2===i){mk(t,l===void 0?new i$(s,n,e):new o$(s,n,e));break}else{let h=t.map[s];h===void 0&&(h=new a$(s),mk(t,h)),t=h}}}class tm{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i),a=e.getUniformLocation(t,o.name);s$(o,a,this)}}setValue(e,t,r,i){const o=this.map[t];o!==void 0&&o.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let o=0,a=t.length;o!==a;++o){const s=t[o],u=r[s.id];u.needsUpdate!==!1&&s.setValue(e,u.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,o=e.length;i!==o;++i){const a=e[i];a.id in t&&r.push(a)}return r}}function gk(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const u$=37297;let l$=0;function c$(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let a=i;a<o;a++){const s=a+1;r.push(`${s===e?">":" "} ${s}: ${t[a]}`)}return r.join(`
`)}const vk=new Jt;function h$(n){gn._getMatrix(vk,gn.workingColorSpace,n);const e=`mat3( ${vk.elements.map(t=>t.toFixed(4))} )`;switch(gn.getTransfer(n)){case Hm:return[e,"LinearTransferOETF"];case Mn:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",n),[e,"LinearTransferOETF"]}}function yk(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),o=(n.getShaderInfoLog(e)||"").trim();if(r&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const s=parseInt(a[1]);return t.toUpperCase()+`

`+o+`

`+c$(n.getShaderSource(e),s)}else return o}function d$(n,e){const t=h$(e);return[`vec4 ${n}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function f$(n,e){let t;switch(e){case sH:t="Linear";break;case uH:t="Reinhard";break;case lH:t="Cineon";break;case cH:t="ACESFilmic";break;case dH:t="AgX";break;case fH:t="Neutral";break;case hH:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Up=new Te;function p$(){gn.getLuminanceCoefficients(Up);const n=Up.x.toFixed(4),e=Up.y.toFixed(4),t=Up.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${n}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function m$(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(jh).join(`
`)}function g$(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function v$(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const o=n.getActiveAttrib(e,i),a=o.name;let s=1;o.type===n.FLOAT_MAT2&&(s=2),o.type===n.FLOAT_MAT3&&(s=3),o.type===n.FLOAT_MAT4&&(s=4),t[a]={type:o.type,location:n.getAttribLocation(e,a),locationSize:s}}return t}function jh(n){return n!==""}function bk(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function wk(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const y$=/^[ \t]*#include +<([\w\d./]+)>/gm;function hw(n){return n.replace(y$,w$)}const b$=new Map;function w$(n,e){let t=Zt[e];if(t===void 0){const r=b$.get(e);if(r!==void 0)t=Zt[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return hw(t)}const _$=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function _k(n){return n.replace(_$,x$)}function x$(n,e,t,r){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function xk(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function S$(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===CR?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===zW?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Fa&&(e="SHADOWMAP_TYPE_VSM"),e}function E$(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Wc:case Hc:e="ENVMAP_TYPE_CUBE";break;case bg:e="ENVMAP_TYPE_CUBE_UV";break}return e}function k$(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Hc:e="ENVMAP_MODE_REFRACTION";break}return e}function C$(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case TR:e="ENVMAP_BLENDING_MULTIPLY";break;case oH:e="ENVMAP_BLENDING_MIX";break;case aH:e="ENVMAP_BLENDING_ADD";break}return e}function T$(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:r,maxMip:t}}function M$(n,e,t,r){const i=n.getContext(),o=t.defines;let a=t.vertexShader,s=t.fragmentShader;const u=S$(t),l=E$(t),c=k$(t),h=C$(t),f=T$(t),m=m$(t),g=g$(o),w=i.createProgram();let v,y,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(jh).join(`
`),v.length>0&&(v+=`
`),y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(jh).join(`
`),y.length>0&&(y+=`
`)):(v=[xk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(jh).join(`
`),y=[xk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ga?"#define TONE_MAPPING":"",t.toneMapping!==Ga?Zt.tonemapping_pars_fragment:"",t.toneMapping!==Ga?f$("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Zt.colorspace_pars_fragment,d$("linearToOutputTexel",t.outputColorSpace),p$(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(jh).join(`
`)),a=hw(a),a=bk(a,t),a=wk(a,t),s=hw(s),s=bk(s,t),s=wk(s,t),a=_k(a),s=_k(s),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,v=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===OE?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===OE?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const E=x+v+a,_=x+y+s,k=gk(i,i.VERTEX_SHADER,E),C=gk(i,i.FRAGMENT_SHADER,_);i.attachShader(w,k),i.attachShader(w,C),t.index0AttributeName!==void 0?i.bindAttribLocation(w,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(w,0,"position"),i.linkProgram(w);function A(N){if(n.debug.checkShaderErrors){const O=i.getProgramInfoLog(w)||"",V=i.getShaderInfoLog(k)||"",F=i.getShaderInfoLog(C)||"",B=O.trim(),U=V.trim(),P=F.trim();let L=!0,H=!0;if(i.getProgramParameter(w,i.LINK_STATUS)===!1)if(L=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,w,k,C);else{const W=yk(i,k,"vertex"),z=yk(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(w,i.VALIDATE_STATUS)+`

Material Name: `+N.name+`
Material Type: `+N.type+`

Program Info Log: `+B+`
`+W+`
`+z)}else B!==""?console.warn("THREE.WebGLProgram: Program Info Log:",B):(U===""||P==="")&&(H=!1);H&&(N.diagnostics={runnable:L,programLog:B,vertexShader:{log:U,prefix:v},fragmentShader:{log:P,prefix:y}})}i.deleteShader(k),i.deleteShader(C),I=new tm(i,w),T=v$(i,w)}let I;this.getUniforms=function(){return I===void 0&&A(this),I};let T;this.getAttributes=function(){return T===void 0&&A(this),T};let R=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return R===!1&&(R=i.getProgramParameter(w,u$)),R},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(w),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=l$++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=k,this.fragmentShader=C,this}let R$=0;class A${constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(r),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new I$(e),t.set(e,r)),r}}class I${constructor(e){this.id=R$++,this.code=e,this.usedTimes=0}}function D$(n,e,t,r,i,o,a){const s=new zR,u=new A$,l=new Set,c=[],h=i.logarithmicDepthBuffer,f=i.vertexTextures;let m=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function w(T){return l.add(T),T===0?"uv":`uv${T}`}function v(T,R,N,O,V){const F=O.fog,B=V.geometry,U=T.isMeshStandardMaterial?O.environment:null,P=(T.isMeshStandardMaterial?t:e).get(T.envMap||U),L=P&&P.mapping===bg?P.image.height:null,H=g[T.type];T.precision!==null&&(m=i.getMaxPrecision(T.precision),m!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",m,"instead."));const W=B.morphAttributes.position||B.morphAttributes.normal||B.morphAttributes.color,z=W!==void 0?W.length:0;let q=0;B.morphAttributes.position!==void 0&&(q=1),B.morphAttributes.normal!==void 0&&(q=2),B.morphAttributes.color!==void 0&&(q=3);let re,de,ye,te;if(H){const an=na[H];re=an.vertexShader,de=an.fragmentShader}else re=T.vertexShader,de=T.fragmentShader,u.update(T),ye=u.getVertexShaderID(T),te=u.getFragmentShaderID(T);const ie=n.getRenderTarget(),fe=n.state.buffers.depth.getReversed(),Re=V.isInstancedMesh===!0,De=V.isBatchedMesh===!0,Be=!!T.map,lt=!!T.matcap,Y=!!P,ot=!!T.aoMap,Ke=!!T.lightMap,Xe=!!T.bumpMap,qe=!!T.normalMap,Tt=!!T.displacementMap,Qe=!!T.emissiveMap,ft=!!T.metalnessMap,Mt=!!T.roughnessMap,Ut=T.anisotropy>0,Q=T.clearcoat>0,j=T.dispersion>0,me=T.iridescence>0,Ae=T.sheen>0,Pe=T.transmission>0,ke=Ut&&!!T.anisotropyMap,Ue=Q&&!!T.clearcoatMap,_e=Q&&!!T.clearcoatNormalMap,rt=Q&&!!T.clearcoatRoughnessMap,Je=me&&!!T.iridescenceMap,Oe=me&&!!T.iridescenceThicknessMap,$e=Ae&&!!T.sheenColorMap,pt=Ae&&!!T.sheenRoughnessMap,nt=!!T.specularMap,tt=!!T.specularColorMap,Nt=!!T.specularIntensityMap,se=Pe&&!!T.transmissionMap,He=Pe&&!!T.thicknessMap,Ve=!!T.gradientMap,it=!!T.alphaMap,We=T.alphaTest>0,Fe=!!T.alphaHash,gt=!!T.extensions;let Ht=Ga;T.toneMapped&&(ie===null||ie.isXRRenderTarget===!0)&&(Ht=n.toneMapping);const bn={shaderID:H,shaderType:T.type,shaderName:T.name,vertexShader:re,fragmentShader:de,defines:T.defines,customVertexShaderID:ye,customFragmentShaderID:te,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:m,batching:De,batchingColor:De&&V._colorsTexture!==null,instancing:Re,instancingColor:Re&&V.instanceColor!==null,instancingMorph:Re&&V.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:ie===null?n.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:eu,alphaToCoverage:!!T.alphaToCoverage,map:Be,matcap:lt,envMap:Y,envMapMode:Y&&P.mapping,envMapCubeUVHeight:L,aoMap:ot,lightMap:Ke,bumpMap:Xe,normalMap:qe,displacementMap:f&&Tt,emissiveMap:Qe,normalMapObjectSpace:qe&&T.normalMapType===vH,normalMapTangentSpace:qe&&T.normalMapType===gH,metalnessMap:ft,roughnessMap:Mt,anisotropy:Ut,anisotropyMap:ke,clearcoat:Q,clearcoatMap:Ue,clearcoatNormalMap:_e,clearcoatRoughnessMap:rt,dispersion:j,iridescence:me,iridescenceMap:Je,iridescenceThicknessMap:Oe,sheen:Ae,sheenColorMap:$e,sheenRoughnessMap:pt,specularMap:nt,specularColorMap:tt,specularIntensityMap:Nt,transmission:Pe,transmissionMap:se,thicknessMap:He,gradientMap:Ve,opaque:T.transparent===!1&&T.blending===Ac&&T.alphaToCoverage===!1,alphaMap:it,alphaTest:We,alphaHash:Fe,combine:T.combine,mapUv:Be&&w(T.map.channel),aoMapUv:ot&&w(T.aoMap.channel),lightMapUv:Ke&&w(T.lightMap.channel),bumpMapUv:Xe&&w(T.bumpMap.channel),normalMapUv:qe&&w(T.normalMap.channel),displacementMapUv:Tt&&w(T.displacementMap.channel),emissiveMapUv:Qe&&w(T.emissiveMap.channel),metalnessMapUv:ft&&w(T.metalnessMap.channel),roughnessMapUv:Mt&&w(T.roughnessMap.channel),anisotropyMapUv:ke&&w(T.anisotropyMap.channel),clearcoatMapUv:Ue&&w(T.clearcoatMap.channel),clearcoatNormalMapUv:_e&&w(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:rt&&w(T.clearcoatRoughnessMap.channel),iridescenceMapUv:Je&&w(T.iridescenceMap.channel),iridescenceThicknessMapUv:Oe&&w(T.iridescenceThicknessMap.channel),sheenColorMapUv:$e&&w(T.sheenColorMap.channel),sheenRoughnessMapUv:pt&&w(T.sheenRoughnessMap.channel),specularMapUv:nt&&w(T.specularMap.channel),specularColorMapUv:tt&&w(T.specularColorMap.channel),specularIntensityMapUv:Nt&&w(T.specularIntensityMap.channel),transmissionMapUv:se&&w(T.transmissionMap.channel),thicknessMapUv:He&&w(T.thicknessMap.channel),alphaMapUv:it&&w(T.alphaMap.channel),vertexTangents:!!B.attributes.tangent&&(qe||Ut),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!B.attributes.color&&B.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!B.attributes.uv&&(Be||it),fog:!!F,useFog:T.fog===!0,fogExp2:!!F&&F.isFogExp2,flatShading:T.flatShading===!0&&T.wireframe===!1,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:h,reversedDepthBuffer:fe,skinning:V.isSkinnedMesh===!0,morphTargets:B.morphAttributes.position!==void 0,morphNormals:B.morphAttributes.normal!==void 0,morphColors:B.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:q,numDirLights:R.directional.length,numPointLights:R.point.length,numSpotLights:R.spot.length,numSpotLightMaps:R.spotLightMap.length,numRectAreaLights:R.rectArea.length,numHemiLights:R.hemi.length,numDirLightShadows:R.directionalShadowMap.length,numPointLightShadows:R.pointShadowMap.length,numSpotLightShadows:R.spotShadowMap.length,numSpotLightShadowsWithMaps:R.numSpotLightShadowsWithMaps,numLightProbes:R.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:n.shadowMap.enabled&&N.length>0,shadowMapType:n.shadowMap.type,toneMapping:Ht,decodeVideoTexture:Be&&T.map.isVideoTexture===!0&&gn.getTransfer(T.map.colorSpace)===Mn,decodeVideoTextureEmissive:Qe&&T.emissiveMap.isVideoTexture===!0&&gn.getTransfer(T.emissiveMap.colorSpace)===Mn,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Fi,flipSided:T.side===br,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionClipCullDistance:gt&&T.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(gt&&T.extensions.multiDraw===!0||De)&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()};return bn.vertexUv1s=l.has(1),bn.vertexUv2s=l.has(2),bn.vertexUv3s=l.has(3),l.clear(),bn}function y(T){const R=[];if(T.shaderID?R.push(T.shaderID):(R.push(T.customVertexShaderID),R.push(T.customFragmentShaderID)),T.defines!==void 0)for(const N in T.defines)R.push(N),R.push(T.defines[N]);return T.isRawShaderMaterial===!1&&(x(R,T),E(R,T),R.push(n.outputColorSpace)),R.push(T.customProgramCacheKey),R.join()}function x(T,R){T.push(R.precision),T.push(R.outputColorSpace),T.push(R.envMapMode),T.push(R.envMapCubeUVHeight),T.push(R.mapUv),T.push(R.alphaMapUv),T.push(R.lightMapUv),T.push(R.aoMapUv),T.push(R.bumpMapUv),T.push(R.normalMapUv),T.push(R.displacementMapUv),T.push(R.emissiveMapUv),T.push(R.metalnessMapUv),T.push(R.roughnessMapUv),T.push(R.anisotropyMapUv),T.push(R.clearcoatMapUv),T.push(R.clearcoatNormalMapUv),T.push(R.clearcoatRoughnessMapUv),T.push(R.iridescenceMapUv),T.push(R.iridescenceThicknessMapUv),T.push(R.sheenColorMapUv),T.push(R.sheenRoughnessMapUv),T.push(R.specularMapUv),T.push(R.specularColorMapUv),T.push(R.specularIntensityMapUv),T.push(R.transmissionMapUv),T.push(R.thicknessMapUv),T.push(R.combine),T.push(R.fogExp2),T.push(R.sizeAttenuation),T.push(R.morphTargetsCount),T.push(R.morphAttributeCount),T.push(R.numDirLights),T.push(R.numPointLights),T.push(R.numSpotLights),T.push(R.numSpotLightMaps),T.push(R.numHemiLights),T.push(R.numRectAreaLights),T.push(R.numDirLightShadows),T.push(R.numPointLightShadows),T.push(R.numSpotLightShadows),T.push(R.numSpotLightShadowsWithMaps),T.push(R.numLightProbes),T.push(R.shadowMapType),T.push(R.toneMapping),T.push(R.numClippingPlanes),T.push(R.numClipIntersection),T.push(R.depthPacking)}function E(T,R){s.disableAll(),R.supportsVertexTextures&&s.enable(0),R.instancing&&s.enable(1),R.instancingColor&&s.enable(2),R.instancingMorph&&s.enable(3),R.matcap&&s.enable(4),R.envMap&&s.enable(5),R.normalMapObjectSpace&&s.enable(6),R.normalMapTangentSpace&&s.enable(7),R.clearcoat&&s.enable(8),R.iridescence&&s.enable(9),R.alphaTest&&s.enable(10),R.vertexColors&&s.enable(11),R.vertexAlphas&&s.enable(12),R.vertexUv1s&&s.enable(13),R.vertexUv2s&&s.enable(14),R.vertexUv3s&&s.enable(15),R.vertexTangents&&s.enable(16),R.anisotropy&&s.enable(17),R.alphaHash&&s.enable(18),R.batching&&s.enable(19),R.dispersion&&s.enable(20),R.batchingColor&&s.enable(21),R.gradientMap&&s.enable(22),T.push(s.mask),s.disableAll(),R.fog&&s.enable(0),R.useFog&&s.enable(1),R.flatShading&&s.enable(2),R.logarithmicDepthBuffer&&s.enable(3),R.reversedDepthBuffer&&s.enable(4),R.skinning&&s.enable(5),R.morphTargets&&s.enable(6),R.morphNormals&&s.enable(7),R.morphColors&&s.enable(8),R.premultipliedAlpha&&s.enable(9),R.shadowMapEnabled&&s.enable(10),R.doubleSided&&s.enable(11),R.flipSided&&s.enable(12),R.useDepthPacking&&s.enable(13),R.dithering&&s.enable(14),R.transmission&&s.enable(15),R.sheen&&s.enable(16),R.opaque&&s.enable(17),R.pointsUvs&&s.enable(18),R.decodeVideoTexture&&s.enable(19),R.decodeVideoTextureEmissive&&s.enable(20),R.alphaToCoverage&&s.enable(21),T.push(s.mask)}function _(T){const R=g[T.type];let N;if(R){const O=na[R];N=uG.clone(O.uniforms)}else N=T.uniforms;return N}function k(T,R){let N;for(let O=0,V=c.length;O<V;O++){const F=c[O];if(F.cacheKey===R){N=F,++N.usedTimes;break}}return N===void 0&&(N=new M$(n,R,T,o),c.push(N)),N}function C(T){if(--T.usedTimes===0){const R=c.indexOf(T);c[R]=c[c.length-1],c.pop(),T.destroy()}}function A(T){u.remove(T)}function I(){u.dispose()}return{getParameters:v,getProgramCacheKey:y,getUniforms:_,acquireProgram:k,releaseProgram:C,releaseShaderCache:A,programs:c,dispose:I}}function N$(){let n=new WeakMap;function e(a){return n.has(a)}function t(a){let s=n.get(a);return s===void 0&&(s={},n.set(a,s)),s}function r(a){n.delete(a)}function i(a,s,u){n.get(a)[s]=u}function o(){n=new WeakMap}return{has:e,get:t,remove:r,update:i,dispose:o}}function P$(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function Sk(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function Ek(){const n=[];let e=0;const t=[],r=[],i=[];function o(){e=0,t.length=0,r.length=0,i.length=0}function a(h,f,m,g,w,v){let y=n[e];return y===void 0?(y={id:h.id,object:h,geometry:f,material:m,groupOrder:g,renderOrder:h.renderOrder,z:w,group:v},n[e]=y):(y.id=h.id,y.object=h,y.geometry=f,y.material=m,y.groupOrder=g,y.renderOrder=h.renderOrder,y.z=w,y.group=v),e++,y}function s(h,f,m,g,w,v){const y=a(h,f,m,g,w,v);m.transmission>0?r.push(y):m.transparent===!0?i.push(y):t.push(y)}function u(h,f,m,g,w,v){const y=a(h,f,m,g,w,v);m.transmission>0?r.unshift(y):m.transparent===!0?i.unshift(y):t.unshift(y)}function l(h,f){t.length>1&&t.sort(h||P$),r.length>1&&r.sort(f||Sk),i.length>1&&i.sort(f||Sk)}function c(){for(let h=e,f=n.length;h<f;h++){const m=n[h];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:r,transparent:i,init:o,push:s,unshift:u,finish:c,sort:l}}function F$(){let n=new WeakMap;function e(r,i){const o=n.get(r);let a;return o===void 0?(a=new Ek,n.set(r,[a])):i>=o.length?(a=new Ek,o.push(a)):a=o[i],a}function t(){n=new WeakMap}return{get:e,dispose:t}}function O$(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Te,color:new Sn};break;case"SpotLight":t={position:new Te,direction:new Te,color:new Sn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Te,color:new Sn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Te,skyColor:new Sn,groundColor:new Sn};break;case"RectAreaLight":t={color:new Sn,position:new Te,halfWidth:new Te,halfHeight:new Te};break}return n[e.id]=t,t}}}function L$(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let B$=0;function U$(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function z$(n){const e=new O$,t=L$(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)r.probe.push(new Te);const i=new Te,o=new sr,a=new sr;function s(l){let c=0,h=0,f=0;for(let T=0;T<9;T++)r.probe[T].set(0,0,0);let m=0,g=0,w=0,v=0,y=0,x=0,E=0,_=0,k=0,C=0,A=0;l.sort(U$);for(let T=0,R=l.length;T<R;T++){const N=l[T],O=N.color,V=N.intensity,F=N.distance,B=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)c+=O.r*V,h+=O.g*V,f+=O.b*V;else if(N.isLightProbe){for(let U=0;U<9;U++)r.probe[U].addScaledVector(N.sh.coefficients[U],V);A++}else if(N.isDirectionalLight){const U=e.get(N);if(U.color.copy(N.color).multiplyScalar(N.intensity),N.castShadow){const P=N.shadow,L=t.get(N);L.shadowIntensity=P.intensity,L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,r.directionalShadow[m]=L,r.directionalShadowMap[m]=B,r.directionalShadowMatrix[m]=N.shadow.matrix,x++}r.directional[m]=U,m++}else if(N.isSpotLight){const U=e.get(N);U.position.setFromMatrixPosition(N.matrixWorld),U.color.copy(O).multiplyScalar(V),U.distance=F,U.coneCos=Math.cos(N.angle),U.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),U.decay=N.decay,r.spot[w]=U;const P=N.shadow;if(N.map&&(r.spotLightMap[k]=N.map,k++,P.updateMatrices(N),N.castShadow&&C++),r.spotLightMatrix[w]=P.matrix,N.castShadow){const L=t.get(N);L.shadowIntensity=P.intensity,L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,r.spotShadow[w]=L,r.spotShadowMap[w]=B,_++}w++}else if(N.isRectAreaLight){const U=e.get(N);U.color.copy(O).multiplyScalar(V),U.halfWidth.set(N.width*.5,0,0),U.halfHeight.set(0,N.height*.5,0),r.rectArea[v]=U,v++}else if(N.isPointLight){const U=e.get(N);if(U.color.copy(N.color).multiplyScalar(N.intensity),U.distance=N.distance,U.decay=N.decay,N.castShadow){const P=N.shadow,L=t.get(N);L.shadowIntensity=P.intensity,L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,L.shadowCameraNear=P.camera.near,L.shadowCameraFar=P.camera.far,r.pointShadow[g]=L,r.pointShadowMap[g]=B,r.pointShadowMatrix[g]=N.shadow.matrix,E++}r.point[g]=U,g++}else if(N.isHemisphereLight){const U=e.get(N);U.skyColor.copy(N.color).multiplyScalar(V),U.groundColor.copy(N.groundColor).multiplyScalar(V),r.hemi[y]=U,y++}}v>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=ut.LTC_FLOAT_1,r.rectAreaLTC2=ut.LTC_FLOAT_2):(r.rectAreaLTC1=ut.LTC_HALF_1,r.rectAreaLTC2=ut.LTC_HALF_2)),r.ambient[0]=c,r.ambient[1]=h,r.ambient[2]=f;const I=r.hash;(I.directionalLength!==m||I.pointLength!==g||I.spotLength!==w||I.rectAreaLength!==v||I.hemiLength!==y||I.numDirectionalShadows!==x||I.numPointShadows!==E||I.numSpotShadows!==_||I.numSpotMaps!==k||I.numLightProbes!==A)&&(r.directional.length=m,r.spot.length=w,r.rectArea.length=v,r.point.length=g,r.hemi.length=y,r.directionalShadow.length=x,r.directionalShadowMap.length=x,r.pointShadow.length=E,r.pointShadowMap.length=E,r.spotShadow.length=_,r.spotShadowMap.length=_,r.directionalShadowMatrix.length=x,r.pointShadowMatrix.length=E,r.spotLightMatrix.length=_+k-C,r.spotLightMap.length=k,r.numSpotLightShadowsWithMaps=C,r.numLightProbes=A,I.directionalLength=m,I.pointLength=g,I.spotLength=w,I.rectAreaLength=v,I.hemiLength=y,I.numDirectionalShadows=x,I.numPointShadows=E,I.numSpotShadows=_,I.numSpotMaps=k,I.numLightProbes=A,r.version=B$++)}function u(l,c){let h=0,f=0,m=0,g=0,w=0;const v=c.matrixWorldInverse;for(let y=0,x=l.length;y<x;y++){const E=l[y];if(E.isDirectionalLight){const _=r.directional[h];_.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),_.direction.sub(i),_.direction.transformDirection(v),h++}else if(E.isSpotLight){const _=r.spot[m];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(v),_.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),_.direction.sub(i),_.direction.transformDirection(v),m++}else if(E.isRectAreaLight){const _=r.rectArea[g];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(v),a.identity(),o.copy(E.matrixWorld),o.premultiply(v),a.extractRotation(o),_.halfWidth.set(E.width*.5,0,0),_.halfHeight.set(0,E.height*.5,0),_.halfWidth.applyMatrix4(a),_.halfHeight.applyMatrix4(a),g++}else if(E.isPointLight){const _=r.point[f];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(v),f++}else if(E.isHemisphereLight){const _=r.hemi[w];_.direction.setFromMatrixPosition(E.matrixWorld),_.direction.transformDirection(v),w++}}}return{setup:s,setupView:u,state:r}}function kk(n){const e=new z$(n),t=[],r=[];function i(c){l.camera=c,t.length=0,r.length=0}function o(c){t.push(c)}function a(c){r.push(c)}function s(){e.setup(t)}function u(c){e.setupView(t,c)}const l={lightsArray:t,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:s,setupLightsView:u,pushLight:o,pushShadow:a}}function W$(n){let e=new WeakMap;function t(i,o=0){const a=e.get(i);let s;return a===void 0?(s=new kk(n),e.set(i,[s])):o>=a.length?(s=new kk(n),a.push(s)):s=a[o],s}function r(){e=new WeakMap}return{get:t,dispose:r}}const H$=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,G$=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function V$(n,e,t){let r=new XR;const i=new Wt,o=new Wt,a=new Hn,s=new vG({depthPacking:mH}),u=new yG,l={},c=t.maxTextureSize,h={[qa]:br,[br]:qa,[Fi]:Fi},f=new Xr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Wt},radius:{value:4}},vertexShader:H$,fragmentShader:G$}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const g=new uu;g.setAttribute("position",new io(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Io(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=CR;let y=this.type;this.render=function(C,A,I){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||C.length===0)return;const T=n.getRenderTarget(),R=n.getActiveCubeFace(),N=n.getActiveMipmapLevel(),O=n.state;O.setBlending(wi),O.buffers.depth.getReversed()===!0?O.buffers.color.setClear(0,0,0,0):O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const V=y!==Fa&&this.type===Fa,F=y===Fa&&this.type!==Fa;for(let B=0,U=C.length;B<U;B++){const P=C[B],L=P.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;i.copy(L.mapSize);const H=L.getFrameExtents();if(i.multiply(H),o.copy(L.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(o.x=Math.floor(c/H.x),i.x=o.x*H.x,L.mapSize.x=o.x),i.y>c&&(o.y=Math.floor(c/H.y),i.y=o.y*H.y,L.mapSize.y=o.y)),L.map===null||V===!0||F===!0){const z=this.type!==Fa?{minFilter:Lo,magFilter:Lo}:{};L.map!==null&&L.map.dispose(),L.map=new ri(i.x,i.y,z),L.map.texture.name=P.name+".shadowMap",L.camera.updateProjectionMatrix()}n.setRenderTarget(L.map),n.clear();const W=L.getViewportCount();for(let z=0;z<W;z++){const q=L.getViewport(z);a.set(o.x*q.x,o.y*q.y,o.x*q.z,o.y*q.w),O.viewport(a),L.updateMatrices(P,z),r=L.getFrustum(),_(A,I,L.camera,P,this.type)}L.isPointLightShadow!==!0&&this.type===Fa&&x(L,I),L.needsUpdate=!1}y=this.type,v.needsUpdate=!1,n.setRenderTarget(T,R,N)};function x(C,A){const I=e.update(w);f.defines.VSM_SAMPLES!==C.blurSamples&&(f.defines.VSM_SAMPLES=C.blurSamples,m.defines.VSM_SAMPLES=C.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new ri(i.x,i.y)),f.uniforms.shadow_pass.value=C.map.texture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,n.setRenderTarget(C.mapPass),n.clear(),n.renderBufferDirect(A,null,I,f,w,null),m.uniforms.shadow_pass.value=C.mapPass.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,n.setRenderTarget(C.map),n.clear(),n.renderBufferDirect(A,null,I,m,w,null)}function E(C,A,I,T){let R=null;const N=I.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(N!==void 0)R=N;else if(R=I.isPointLight===!0?u:s,n.localClippingEnabled&&A.clipShadows===!0&&Array.isArray(A.clippingPlanes)&&A.clippingPlanes.length!==0||A.displacementMap&&A.displacementScale!==0||A.alphaMap&&A.alphaTest>0||A.map&&A.alphaTest>0||A.alphaToCoverage===!0){const O=R.uuid,V=A.uuid;let F=l[O];F===void 0&&(F={},l[O]=F);let B=F[V];B===void 0&&(B=R.clone(),F[V]=B,A.addEventListener("dispose",k)),R=B}if(R.visible=A.visible,R.wireframe=A.wireframe,T===Fa?R.side=A.shadowSide!==null?A.shadowSide:A.side:R.side=A.shadowSide!==null?A.shadowSide:h[A.side],R.alphaMap=A.alphaMap,R.alphaTest=A.alphaToCoverage===!0?.5:A.alphaTest,R.map=A.map,R.clipShadows=A.clipShadows,R.clippingPlanes=A.clippingPlanes,R.clipIntersection=A.clipIntersection,R.displacementMap=A.displacementMap,R.displacementScale=A.displacementScale,R.displacementBias=A.displacementBias,R.wireframeLinewidth=A.wireframeLinewidth,R.linewidth=A.linewidth,I.isPointLight===!0&&R.isMeshDistanceMaterial===!0){const O=n.properties.get(R);O.light=I}return R}function _(C,A,I,T,R){if(C.visible===!1)return;if(C.layers.test(A.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&R===Fa)&&(!C.frustumCulled||r.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,C.matrixWorld);const V=e.update(C),F=C.material;if(Array.isArray(F)){const B=V.groups;for(let U=0,P=B.length;U<P;U++){const L=B[U],H=F[L.materialIndex];if(H&&H.visible){const W=E(C,H,T,R);C.onBeforeShadow(n,C,A,I,V,W,L),n.renderBufferDirect(I,null,V,W,C,L),C.onAfterShadow(n,C,A,I,V,W,L)}}}else if(F.visible){const B=E(C,F,T,R);C.onBeforeShadow(n,C,A,I,V,B,null),n.renderBufferDirect(I,null,V,B,C,null),C.onAfterShadow(n,C,A,I,V,B,null)}}const O=C.children;for(let V=0,F=O.length;V<F;V++)_(O[V],A,I,T,R)}function k(C){C.target.removeEventListener("dispose",k);for(const I in l){const T=l[I],R=C.target.uuid;R in T&&(T[R].dispose(),delete T[R])}}}const j$={[C0]:Wm,[T0]:A0,[M0]:I0,[zc]:R0,[Wm]:C0,[A0]:T0,[I0]:M0,[R0]:zc};function q$(n,e){function t(){let se=!1;const He=new Hn;let Ve=null;const it=new Hn(0,0,0,0);return{setMask:function(We){Ve!==We&&!se&&(n.colorMask(We,We,We,We),Ve=We)},setLocked:function(We){se=We},setClear:function(We,Fe,gt,Ht,bn){bn===!0&&(We*=Ht,Fe*=Ht,gt*=Ht),He.set(We,Fe,gt,Ht),it.equals(He)===!1&&(n.clearColor(We,Fe,gt,Ht),it.copy(He))},reset:function(){se=!1,Ve=null,it.set(-1,0,0,0)}}}function r(){let se=!1,He=!1,Ve=null,it=null,We=null;return{setReversed:function(Fe){if(He!==Fe){const gt=e.get("EXT_clip_control");Fe?gt.clipControlEXT(gt.LOWER_LEFT_EXT,gt.ZERO_TO_ONE_EXT):gt.clipControlEXT(gt.LOWER_LEFT_EXT,gt.NEGATIVE_ONE_TO_ONE_EXT),He=Fe;const Ht=We;We=null,this.setClear(Ht)}},getReversed:function(){return He},setTest:function(Fe){Fe?ie(n.DEPTH_TEST):fe(n.DEPTH_TEST)},setMask:function(Fe){Ve!==Fe&&!se&&(n.depthMask(Fe),Ve=Fe)},setFunc:function(Fe){if(He&&(Fe=j$[Fe]),it!==Fe){switch(Fe){case C0:n.depthFunc(n.NEVER);break;case Wm:n.depthFunc(n.ALWAYS);break;case T0:n.depthFunc(n.LESS);break;case zc:n.depthFunc(n.LEQUAL);break;case M0:n.depthFunc(n.EQUAL);break;case R0:n.depthFunc(n.GEQUAL);break;case A0:n.depthFunc(n.GREATER);break;case I0:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}it=Fe}},setLocked:function(Fe){se=Fe},setClear:function(Fe){We!==Fe&&(He&&(Fe=1-Fe),n.clearDepth(Fe),We=Fe)},reset:function(){se=!1,Ve=null,it=null,We=null,He=!1}}}function i(){let se=!1,He=null,Ve=null,it=null,We=null,Fe=null,gt=null,Ht=null,bn=null;return{setTest:function(an){se||(an?ie(n.STENCIL_TEST):fe(n.STENCIL_TEST))},setMask:function(an){He!==an&&!se&&(n.stencilMask(an),He=an)},setFunc:function(an,oi,fr){(Ve!==an||it!==oi||We!==fr)&&(n.stencilFunc(an,oi,fr),Ve=an,it=oi,We=fr)},setOp:function(an,oi,fr){(Fe!==an||gt!==oi||Ht!==fr)&&(n.stencilOp(an,oi,fr),Fe=an,gt=oi,Ht=fr)},setLocked:function(an){se=an},setClear:function(an){bn!==an&&(n.clearStencil(an),bn=an)},reset:function(){se=!1,He=null,Ve=null,it=null,We=null,Fe=null,gt=null,Ht=null,bn=null}}}const o=new t,a=new r,s=new i,u=new WeakMap,l=new WeakMap;let c={},h={},f=new WeakMap,m=[],g=null,w=!1,v=null,y=null,x=null,E=null,_=null,k=null,C=null,A=new Sn(0,0,0),I=0,T=!1,R=null,N=null,O=null,V=null,F=null;const B=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,P=0;const L=n.getParameter(n.VERSION);L.indexOf("WebGL")!==-1?(P=parseFloat(/^WebGL (\d)/.exec(L)[1]),U=P>=1):L.indexOf("OpenGL ES")!==-1&&(P=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),U=P>=2);let H=null,W={};const z=n.getParameter(n.SCISSOR_BOX),q=n.getParameter(n.VIEWPORT),re=new Hn().fromArray(z),de=new Hn().fromArray(q);function ye(se,He,Ve,it){const We=new Uint8Array(4),Fe=n.createTexture();n.bindTexture(se,Fe),n.texParameteri(se,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(se,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let gt=0;gt<Ve;gt++)se===n.TEXTURE_3D||se===n.TEXTURE_2D_ARRAY?n.texImage3D(He,0,n.RGBA,1,1,it,0,n.RGBA,n.UNSIGNED_BYTE,We):n.texImage2D(He+gt,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,We);return Fe}const te={};te[n.TEXTURE_2D]=ye(n.TEXTURE_2D,n.TEXTURE_2D,1),te[n.TEXTURE_CUBE_MAP]=ye(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),te[n.TEXTURE_2D_ARRAY]=ye(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),te[n.TEXTURE_3D]=ye(n.TEXTURE_3D,n.TEXTURE_3D,1,1),o.setClear(0,0,0,1),a.setClear(1),s.setClear(0),ie(n.DEPTH_TEST),a.setFunc(zc),Xe(!1),qe(AE),ie(n.CULL_FACE),ot(wi);function ie(se){c[se]!==!0&&(n.enable(se),c[se]=!0)}function fe(se){c[se]!==!1&&(n.disable(se),c[se]=!1)}function Re(se,He){return h[se]!==He?(n.bindFramebuffer(se,He),h[se]=He,se===n.DRAW_FRAMEBUFFER&&(h[n.FRAMEBUFFER]=He),se===n.FRAMEBUFFER&&(h[n.DRAW_FRAMEBUFFER]=He),!0):!1}function De(se,He){let Ve=m,it=!1;if(se){Ve=f.get(He),Ve===void 0&&(Ve=[],f.set(He,Ve));const We=se.textures;if(Ve.length!==We.length||Ve[0]!==n.COLOR_ATTACHMENT0){for(let Fe=0,gt=We.length;Fe<gt;Fe++)Ve[Fe]=n.COLOR_ATTACHMENT0+Fe;Ve.length=We.length,it=!0}}else Ve[0]!==n.BACK&&(Ve[0]=n.BACK,it=!0);it&&n.drawBuffers(Ve)}function Be(se){return g!==se?(n.useProgram(se),g=se,!0):!1}const lt={[zu]:n.FUNC_ADD,[HW]:n.FUNC_SUBTRACT,[GW]:n.FUNC_REVERSE_SUBTRACT};lt[VW]=n.MIN,lt[jW]=n.MAX;const Y={[qW]:n.ZERO,[$W]:n.ONE,[XW]:n.SRC_COLOR,[E0]:n.SRC_ALPHA,[eH]:n.SRC_ALPHA_SATURATE,[QW]:n.DST_COLOR,[KW]:n.DST_ALPHA,[YW]:n.ONE_MINUS_SRC_COLOR,[k0]:n.ONE_MINUS_SRC_ALPHA,[ZW]:n.ONE_MINUS_DST_COLOR,[JW]:n.ONE_MINUS_DST_ALPHA,[tH]:n.CONSTANT_COLOR,[nH]:n.ONE_MINUS_CONSTANT_COLOR,[rH]:n.CONSTANT_ALPHA,[iH]:n.ONE_MINUS_CONSTANT_ALPHA};function ot(se,He,Ve,it,We,Fe,gt,Ht,bn,an){if(se===wi){w===!0&&(fe(n.BLEND),w=!1);return}if(w===!1&&(ie(n.BLEND),w=!0),se!==WW){if(se!==v||an!==T){if((y!==zu||_!==zu)&&(n.blendEquation(n.FUNC_ADD),y=zu,_=zu),an)switch(se){case Ac:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case IE:n.blendFunc(n.ONE,n.ONE);break;case DE:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case NE:n.blendFuncSeparate(n.DST_COLOR,n.ONE_MINUS_SRC_ALPHA,n.ZERO,n.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}else switch(se){case Ac:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case IE:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE,n.ONE,n.ONE);break;case DE:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case NE:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}x=null,E=null,k=null,C=null,A.set(0,0,0),I=0,v=se,T=an}return}We=We||He,Fe=Fe||Ve,gt=gt||it,(He!==y||We!==_)&&(n.blendEquationSeparate(lt[He],lt[We]),y=He,_=We),(Ve!==x||it!==E||Fe!==k||gt!==C)&&(n.blendFuncSeparate(Y[Ve],Y[it],Y[Fe],Y[gt]),x=Ve,E=it,k=Fe,C=gt),(Ht.equals(A)===!1||bn!==I)&&(n.blendColor(Ht.r,Ht.g,Ht.b,bn),A.copy(Ht),I=bn),v=se,T=!1}function Ke(se,He){se.side===Fi?fe(n.CULL_FACE):ie(n.CULL_FACE);let Ve=se.side===br;He&&(Ve=!Ve),Xe(Ve),se.blending===Ac&&se.transparent===!1?ot(wi):ot(se.blending,se.blendEquation,se.blendSrc,se.blendDst,se.blendEquationAlpha,se.blendSrcAlpha,se.blendDstAlpha,se.blendColor,se.blendAlpha,se.premultipliedAlpha),a.setFunc(se.depthFunc),a.setTest(se.depthTest),a.setMask(se.depthWrite),o.setMask(se.colorWrite);const it=se.stencilWrite;s.setTest(it),it&&(s.setMask(se.stencilWriteMask),s.setFunc(se.stencilFunc,se.stencilRef,se.stencilFuncMask),s.setOp(se.stencilFail,se.stencilZFail,se.stencilZPass)),Qe(se.polygonOffset,se.polygonOffsetFactor,se.polygonOffsetUnits),se.alphaToCoverage===!0?ie(n.SAMPLE_ALPHA_TO_COVERAGE):fe(n.SAMPLE_ALPHA_TO_COVERAGE)}function Xe(se){R!==se&&(se?n.frontFace(n.CW):n.frontFace(n.CCW),R=se)}function qe(se){se!==BW?(ie(n.CULL_FACE),se!==N&&(se===AE?n.cullFace(n.BACK):se===UW?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):fe(n.CULL_FACE),N=se}function Tt(se){se!==O&&(U&&n.lineWidth(se),O=se)}function Qe(se,He,Ve){se?(ie(n.POLYGON_OFFSET_FILL),(V!==He||F!==Ve)&&(n.polygonOffset(He,Ve),V=He,F=Ve)):fe(n.POLYGON_OFFSET_FILL)}function ft(se){se?ie(n.SCISSOR_TEST):fe(n.SCISSOR_TEST)}function Mt(se){se===void 0&&(se=n.TEXTURE0+B-1),H!==se&&(n.activeTexture(se),H=se)}function Ut(se,He,Ve){Ve===void 0&&(H===null?Ve=n.TEXTURE0+B-1:Ve=H);let it=W[Ve];it===void 0&&(it={type:void 0,texture:void 0},W[Ve]=it),(it.type!==se||it.texture!==He)&&(H!==Ve&&(n.activeTexture(Ve),H=Ve),n.bindTexture(se,He||te[se]),it.type=se,it.texture=He)}function Q(){const se=W[H];se!==void 0&&se.type!==void 0&&(n.bindTexture(se.type,null),se.type=void 0,se.texture=void 0)}function j(){try{n.compressedTexImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function me(){try{n.compressedTexImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ae(){try{n.texSubImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Pe(){try{n.texSubImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function ke(){try{n.compressedTexSubImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ue(){try{n.compressedTexSubImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function _e(){try{n.texStorage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function rt(){try{n.texStorage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Je(){try{n.texImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Oe(){try{n.texImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function $e(se){re.equals(se)===!1&&(n.scissor(se.x,se.y,se.z,se.w),re.copy(se))}function pt(se){de.equals(se)===!1&&(n.viewport(se.x,se.y,se.z,se.w),de.copy(se))}function nt(se,He){let Ve=l.get(He);Ve===void 0&&(Ve=new WeakMap,l.set(He,Ve));let it=Ve.get(se);it===void 0&&(it=n.getUniformBlockIndex(He,se.name),Ve.set(se,it))}function tt(se,He){const it=l.get(He).get(se);u.get(He)!==it&&(n.uniformBlockBinding(He,it,se.__bindingPointIndex),u.set(He,it))}function Nt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),a.setReversed(!1),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),c={},H=null,W={},h={},f=new WeakMap,m=[],g=null,w=!1,v=null,y=null,x=null,E=null,_=null,k=null,C=null,A=new Sn(0,0,0),I=0,T=!1,R=null,N=null,O=null,V=null,F=null,re.set(0,0,n.canvas.width,n.canvas.height),de.set(0,0,n.canvas.width,n.canvas.height),o.reset(),a.reset(),s.reset()}return{buffers:{color:o,depth:a,stencil:s},enable:ie,disable:fe,bindFramebuffer:Re,drawBuffers:De,useProgram:Be,setBlending:ot,setMaterial:Ke,setFlipSided:Xe,setCullFace:qe,setLineWidth:Tt,setPolygonOffset:Qe,setScissorTest:ft,activeTexture:Mt,bindTexture:Ut,unbindTexture:Q,compressedTexImage2D:j,compressedTexImage3D:me,texImage2D:Je,texImage3D:Oe,updateUBOMapping:nt,uniformBlockBinding:tt,texStorage2D:_e,texStorage3D:rt,texSubImage2D:Ae,texSubImage3D:Pe,compressedTexSubImage2D:ke,compressedTexSubImage3D:Ue,scissor:$e,viewport:pt,reset:Nt}}function $$(n,e,t,r,i,o,a){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Wt,c=new WeakMap;let h;const f=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(Q,j){return m?new OffscreenCanvas(Q,j):Vm("canvas")}function w(Q,j,me){let Ae=1;const Pe=Ut(Q);if((Pe.width>me||Pe.height>me)&&(Ae=me/Math.max(Pe.width,Pe.height)),Ae<1)if(typeof HTMLImageElement<"u"&&Q instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Q instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Q instanceof ImageBitmap||typeof VideoFrame<"u"&&Q instanceof VideoFrame){const ke=Math.floor(Ae*Pe.width),Ue=Math.floor(Ae*Pe.height);h===void 0&&(h=g(ke,Ue));const _e=j?g(ke,Ue):h;return _e.width=ke,_e.height=Ue,_e.getContext("2d").drawImage(Q,0,0,ke,Ue),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+ke+"x"+Ue+")."),_e}else return"data"in Q&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),Q;return Q}function v(Q){return Q.generateMipmaps}function y(Q){n.generateMipmap(Q)}function x(Q){return Q.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:Q.isWebGL3DRenderTarget?n.TEXTURE_3D:Q.isWebGLArrayRenderTarget||Q.isCompressedArrayTexture?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D}function E(Q,j,me,Ae,Pe=!1){if(Q!==null){if(n[Q]!==void 0)return n[Q];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Q+"'")}let ke=j;if(j===n.RED&&(me===n.FLOAT&&(ke=n.R32F),me===n.HALF_FLOAT&&(ke=n.R16F),me===n.UNSIGNED_BYTE&&(ke=n.R8)),j===n.RED_INTEGER&&(me===n.UNSIGNED_BYTE&&(ke=n.R8UI),me===n.UNSIGNED_SHORT&&(ke=n.R16UI),me===n.UNSIGNED_INT&&(ke=n.R32UI),me===n.BYTE&&(ke=n.R8I),me===n.SHORT&&(ke=n.R16I),me===n.INT&&(ke=n.R32I)),j===n.RG&&(me===n.FLOAT&&(ke=n.RG32F),me===n.HALF_FLOAT&&(ke=n.RG16F),me===n.UNSIGNED_BYTE&&(ke=n.RG8)),j===n.RG_INTEGER&&(me===n.UNSIGNED_BYTE&&(ke=n.RG8UI),me===n.UNSIGNED_SHORT&&(ke=n.RG16UI),me===n.UNSIGNED_INT&&(ke=n.RG32UI),me===n.BYTE&&(ke=n.RG8I),me===n.SHORT&&(ke=n.RG16I),me===n.INT&&(ke=n.RG32I)),j===n.RGB_INTEGER&&(me===n.UNSIGNED_BYTE&&(ke=n.RGB8UI),me===n.UNSIGNED_SHORT&&(ke=n.RGB16UI),me===n.UNSIGNED_INT&&(ke=n.RGB32UI),me===n.BYTE&&(ke=n.RGB8I),me===n.SHORT&&(ke=n.RGB16I),me===n.INT&&(ke=n.RGB32I)),j===n.RGBA_INTEGER&&(me===n.UNSIGNED_BYTE&&(ke=n.RGBA8UI),me===n.UNSIGNED_SHORT&&(ke=n.RGBA16UI),me===n.UNSIGNED_INT&&(ke=n.RGBA32UI),me===n.BYTE&&(ke=n.RGBA8I),me===n.SHORT&&(ke=n.RGBA16I),me===n.INT&&(ke=n.RGBA32I)),j===n.RGB&&(me===n.UNSIGNED_INT_5_9_9_9_REV&&(ke=n.RGB9_E5),me===n.UNSIGNED_INT_10F_11F_11F_REV&&(ke=n.R11F_G11F_B10F)),j===n.RGBA){const Ue=Pe?Hm:gn.getTransfer(Ae);me===n.FLOAT&&(ke=n.RGBA32F),me===n.HALF_FLOAT&&(ke=n.RGBA16F),me===n.UNSIGNED_BYTE&&(ke=Ue===Mn?n.SRGB8_ALPHA8:n.RGBA8),me===n.UNSIGNED_SHORT_4_4_4_4&&(ke=n.RGBA4),me===n.UNSIGNED_SHORT_5_5_5_1&&(ke=n.RGB5_A1)}return(ke===n.R16F||ke===n.R32F||ke===n.RG16F||ke===n.RG32F||ke===n.RGBA16F||ke===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ke}function _(Q,j){let me;return Q?j===null||j===Zs||j===Gc?me=n.DEPTH24_STENCIL8:j===Wa?me=n.DEPTH32F_STENCIL8:j===od&&(me=n.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):j===null||j===Zs||j===Gc?me=n.DEPTH_COMPONENT24:j===Wa?me=n.DEPTH_COMPONENT32F:j===od&&(me=n.DEPTH_COMPONENT16),me}function k(Q,j){return v(Q)===!0||Q.isFramebufferTexture&&Q.minFilter!==Lo&&Q.minFilter!==vi?Math.log2(Math.max(j.width,j.height))+1:Q.mipmaps!==void 0&&Q.mipmaps.length>0?Q.mipmaps.length:Q.isCompressedTexture&&Array.isArray(Q.image)?j.mipmaps.length:1}function C(Q){const j=Q.target;j.removeEventListener("dispose",C),I(j),j.isVideoTexture&&c.delete(j)}function A(Q){const j=Q.target;j.removeEventListener("dispose",A),R(j)}function I(Q){const j=r.get(Q);if(j.__webglInit===void 0)return;const me=Q.source,Ae=f.get(me);if(Ae){const Pe=Ae[j.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&T(Q),Object.keys(Ae).length===0&&f.delete(me)}r.remove(Q)}function T(Q){const j=r.get(Q);n.deleteTexture(j.__webglTexture);const me=Q.source,Ae=f.get(me);delete Ae[j.__cacheKey],a.memory.textures--}function R(Q){const j=r.get(Q);if(Q.depthTexture&&(Q.depthTexture.dispose(),r.remove(Q.depthTexture)),Q.isWebGLCubeRenderTarget)for(let Ae=0;Ae<6;Ae++){if(Array.isArray(j.__webglFramebuffer[Ae]))for(let Pe=0;Pe<j.__webglFramebuffer[Ae].length;Pe++)n.deleteFramebuffer(j.__webglFramebuffer[Ae][Pe]);else n.deleteFramebuffer(j.__webglFramebuffer[Ae]);j.__webglDepthbuffer&&n.deleteRenderbuffer(j.__webglDepthbuffer[Ae])}else{if(Array.isArray(j.__webglFramebuffer))for(let Ae=0;Ae<j.__webglFramebuffer.length;Ae++)n.deleteFramebuffer(j.__webglFramebuffer[Ae]);else n.deleteFramebuffer(j.__webglFramebuffer);if(j.__webglDepthbuffer&&n.deleteRenderbuffer(j.__webglDepthbuffer),j.__webglMultisampledFramebuffer&&n.deleteFramebuffer(j.__webglMultisampledFramebuffer),j.__webglColorRenderbuffer)for(let Ae=0;Ae<j.__webglColorRenderbuffer.length;Ae++)j.__webglColorRenderbuffer[Ae]&&n.deleteRenderbuffer(j.__webglColorRenderbuffer[Ae]);j.__webglDepthRenderbuffer&&n.deleteRenderbuffer(j.__webglDepthRenderbuffer)}const me=Q.textures;for(let Ae=0,Pe=me.length;Ae<Pe;Ae++){const ke=r.get(me[Ae]);ke.__webglTexture&&(n.deleteTexture(ke.__webglTexture),a.memory.textures--),r.remove(me[Ae])}r.remove(Q)}let N=0;function O(){N=0}function V(){const Q=N;return Q>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Q+" texture units while this GPU supports only "+i.maxTextures),N+=1,Q}function F(Q){const j=[];return j.push(Q.wrapS),j.push(Q.wrapT),j.push(Q.wrapR||0),j.push(Q.magFilter),j.push(Q.minFilter),j.push(Q.anisotropy),j.push(Q.internalFormat),j.push(Q.format),j.push(Q.type),j.push(Q.generateMipmaps),j.push(Q.premultiplyAlpha),j.push(Q.flipY),j.push(Q.unpackAlignment),j.push(Q.colorSpace),j.join()}function B(Q,j){const me=r.get(Q);if(Q.isVideoTexture&&ft(Q),Q.isRenderTargetTexture===!1&&Q.isExternalTexture!==!0&&Q.version>0&&me.__version!==Q.version){const Ae=Q.image;if(Ae===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Ae.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{te(me,Q,j);return}}else Q.isExternalTexture&&(me.__webglTexture=Q.sourceTexture?Q.sourceTexture:null);t.bindTexture(n.TEXTURE_2D,me.__webglTexture,n.TEXTURE0+j)}function U(Q,j){const me=r.get(Q);if(Q.isRenderTargetTexture===!1&&Q.version>0&&me.__version!==Q.version){te(me,Q,j);return}t.bindTexture(n.TEXTURE_2D_ARRAY,me.__webglTexture,n.TEXTURE0+j)}function P(Q,j){const me=r.get(Q);if(Q.isRenderTargetTexture===!1&&Q.version>0&&me.__version!==Q.version){te(me,Q,j);return}t.bindTexture(n.TEXTURE_3D,me.__webglTexture,n.TEXTURE0+j)}function L(Q,j){const me=r.get(Q);if(Q.version>0&&me.__version!==Q.version){ie(me,Q,j);return}t.bindTexture(n.TEXTURE_CUBE_MAP,me.__webglTexture,n.TEXTURE0+j)}const H={[P0]:n.REPEAT,[qu]:n.CLAMP_TO_EDGE,[F0]:n.MIRRORED_REPEAT},W={[Lo]:n.NEAREST,[pH]:n.NEAREST_MIPMAP_NEAREST,[yp]:n.NEAREST_MIPMAP_LINEAR,[vi]:n.LINEAR,[sb]:n.LINEAR_MIPMAP_NEAREST,[$u]:n.LINEAR_MIPMAP_LINEAR},z={[yH]:n.NEVER,[EH]:n.ALWAYS,[bH]:n.LESS,[LR]:n.LEQUAL,[wH]:n.EQUAL,[SH]:n.GEQUAL,[_H]:n.GREATER,[xH]:n.NOTEQUAL};function q(Q,j){if(j.type===Wa&&e.has("OES_texture_float_linear")===!1&&(j.magFilter===vi||j.magFilter===sb||j.magFilter===yp||j.magFilter===$u||j.minFilter===vi||j.minFilter===sb||j.minFilter===yp||j.minFilter===$u)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(Q,n.TEXTURE_WRAP_S,H[j.wrapS]),n.texParameteri(Q,n.TEXTURE_WRAP_T,H[j.wrapT]),(Q===n.TEXTURE_3D||Q===n.TEXTURE_2D_ARRAY)&&n.texParameteri(Q,n.TEXTURE_WRAP_R,H[j.wrapR]),n.texParameteri(Q,n.TEXTURE_MAG_FILTER,W[j.magFilter]),n.texParameteri(Q,n.TEXTURE_MIN_FILTER,W[j.minFilter]),j.compareFunction&&(n.texParameteri(Q,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(Q,n.TEXTURE_COMPARE_FUNC,z[j.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(j.magFilter===Lo||j.minFilter!==yp&&j.minFilter!==$u||j.type===Wa&&e.has("OES_texture_float_linear")===!1)return;if(j.anisotropy>1||r.get(j).__currentAnisotropy){const me=e.get("EXT_texture_filter_anisotropic");n.texParameterf(Q,me.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j.anisotropy,i.getMaxAnisotropy())),r.get(j).__currentAnisotropy=j.anisotropy}}}function re(Q,j){let me=!1;Q.__webglInit===void 0&&(Q.__webglInit=!0,j.addEventListener("dispose",C));const Ae=j.source;let Pe=f.get(Ae);Pe===void 0&&(Pe={},f.set(Ae,Pe));const ke=F(j);if(ke!==Q.__cacheKey){Pe[ke]===void 0&&(Pe[ke]={texture:n.createTexture(),usedTimes:0},a.memory.textures++,me=!0),Pe[ke].usedTimes++;const Ue=Pe[Q.__cacheKey];Ue!==void 0&&(Pe[Q.__cacheKey].usedTimes--,Ue.usedTimes===0&&T(j)),Q.__cacheKey=ke,Q.__webglTexture=Pe[ke].texture}return me}function de(Q,j,me){return Math.floor(Math.floor(Q/me)/j)}function ye(Q,j,me,Ae){const ke=Q.updateRanges;if(ke.length===0)t.texSubImage2D(n.TEXTURE_2D,0,0,0,j.width,j.height,me,Ae,j.data);else{ke.sort((Oe,$e)=>Oe.start-$e.start);let Ue=0;for(let Oe=1;Oe<ke.length;Oe++){const $e=ke[Ue],pt=ke[Oe],nt=$e.start+$e.count,tt=de(pt.start,j.width,4),Nt=de($e.start,j.width,4);pt.start<=nt+1&&tt===Nt&&de(pt.start+pt.count-1,j.width,4)===tt?$e.count=Math.max($e.count,pt.start+pt.count-$e.start):(++Ue,ke[Ue]=pt)}ke.length=Ue+1;const _e=n.getParameter(n.UNPACK_ROW_LENGTH),rt=n.getParameter(n.UNPACK_SKIP_PIXELS),Je=n.getParameter(n.UNPACK_SKIP_ROWS);n.pixelStorei(n.UNPACK_ROW_LENGTH,j.width);for(let Oe=0,$e=ke.length;Oe<$e;Oe++){const pt=ke[Oe],nt=Math.floor(pt.start/4),tt=Math.ceil(pt.count/4),Nt=nt%j.width,se=Math.floor(nt/j.width),He=tt,Ve=1;n.pixelStorei(n.UNPACK_SKIP_PIXELS,Nt),n.pixelStorei(n.UNPACK_SKIP_ROWS,se),t.texSubImage2D(n.TEXTURE_2D,0,Nt,se,He,Ve,me,Ae,j.data)}Q.clearUpdateRanges(),n.pixelStorei(n.UNPACK_ROW_LENGTH,_e),n.pixelStorei(n.UNPACK_SKIP_PIXELS,rt),n.pixelStorei(n.UNPACK_SKIP_ROWS,Je)}}function te(Q,j,me){let Ae=n.TEXTURE_2D;(j.isDataArrayTexture||j.isCompressedArrayTexture)&&(Ae=n.TEXTURE_2D_ARRAY),j.isData3DTexture&&(Ae=n.TEXTURE_3D);const Pe=re(Q,j),ke=j.source;t.bindTexture(Ae,Q.__webglTexture,n.TEXTURE0+me);const Ue=r.get(ke);if(ke.version!==Ue.__version||Pe===!0){t.activeTexture(n.TEXTURE0+me);const _e=gn.getPrimaries(gn.workingColorSpace),rt=j.colorSpace===oa?null:gn.getPrimaries(j.colorSpace),Je=j.colorSpace===oa||_e===rt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,j.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,j.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Je);let Oe=w(j.image,!1,i.maxTextureSize);Oe=Mt(j,Oe);const $e=o.convert(j.format,j.colorSpace),pt=o.convert(j.type);let nt=E(j.internalFormat,$e,pt,j.colorSpace,j.isVideoTexture);q(Ae,j);let tt;const Nt=j.mipmaps,se=j.isVideoTexture!==!0,He=Ue.__version===void 0||Pe===!0,Ve=ke.dataReady,it=k(j,Oe);if(j.isDepthTexture)nt=_(j.format===Vc,j.type),He&&(se?t.texStorage2D(n.TEXTURE_2D,1,nt,Oe.width,Oe.height):t.texImage2D(n.TEXTURE_2D,0,nt,Oe.width,Oe.height,0,$e,pt,null));else if(j.isDataTexture)if(Nt.length>0){se&&He&&t.texStorage2D(n.TEXTURE_2D,it,nt,Nt[0].width,Nt[0].height);for(let We=0,Fe=Nt.length;We<Fe;We++)tt=Nt[We],se?Ve&&t.texSubImage2D(n.TEXTURE_2D,We,0,0,tt.width,tt.height,$e,pt,tt.data):t.texImage2D(n.TEXTURE_2D,We,nt,tt.width,tt.height,0,$e,pt,tt.data);j.generateMipmaps=!1}else se?(He&&t.texStorage2D(n.TEXTURE_2D,it,nt,Oe.width,Oe.height),Ve&&ye(j,Oe,$e,pt)):t.texImage2D(n.TEXTURE_2D,0,nt,Oe.width,Oe.height,0,$e,pt,Oe.data);else if(j.isCompressedTexture)if(j.isCompressedArrayTexture){se&&He&&t.texStorage3D(n.TEXTURE_2D_ARRAY,it,nt,Nt[0].width,Nt[0].height,Oe.depth);for(let We=0,Fe=Nt.length;We<Fe;We++)if(tt=Nt[We],j.format!==Ao)if($e!==null)if(se){if(Ve)if(j.layerUpdates.size>0){const gt=tk(tt.width,tt.height,j.format,j.type);for(const Ht of j.layerUpdates){const bn=tt.data.subarray(Ht*gt/tt.data.BYTES_PER_ELEMENT,(Ht+1)*gt/tt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,We,0,0,Ht,tt.width,tt.height,1,$e,bn)}j.clearLayerUpdates()}else t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,We,0,0,0,tt.width,tt.height,Oe.depth,$e,tt.data)}else t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,We,nt,tt.width,tt.height,Oe.depth,0,tt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else se?Ve&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,We,0,0,0,tt.width,tt.height,Oe.depth,$e,pt,tt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,We,nt,tt.width,tt.height,Oe.depth,0,$e,pt,tt.data)}else{se&&He&&t.texStorage2D(n.TEXTURE_2D,it,nt,Nt[0].width,Nt[0].height);for(let We=0,Fe=Nt.length;We<Fe;We++)tt=Nt[We],j.format!==Ao?$e!==null?se?Ve&&t.compressedTexSubImage2D(n.TEXTURE_2D,We,0,0,tt.width,tt.height,$e,tt.data):t.compressedTexImage2D(n.TEXTURE_2D,We,nt,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):se?Ve&&t.texSubImage2D(n.TEXTURE_2D,We,0,0,tt.width,tt.height,$e,pt,tt.data):t.texImage2D(n.TEXTURE_2D,We,nt,tt.width,tt.height,0,$e,pt,tt.data)}else if(j.isDataArrayTexture)if(se){if(He&&t.texStorage3D(n.TEXTURE_2D_ARRAY,it,nt,Oe.width,Oe.height,Oe.depth),Ve)if(j.layerUpdates.size>0){const We=tk(Oe.width,Oe.height,j.format,j.type);for(const Fe of j.layerUpdates){const gt=Oe.data.subarray(Fe*We/Oe.data.BYTES_PER_ELEMENT,(Fe+1)*We/Oe.data.BYTES_PER_ELEMENT);t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,Fe,Oe.width,Oe.height,1,$e,pt,gt)}j.clearLayerUpdates()}else t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Oe.width,Oe.height,Oe.depth,$e,pt,Oe.data)}else t.texImage3D(n.TEXTURE_2D_ARRAY,0,nt,Oe.width,Oe.height,Oe.depth,0,$e,pt,Oe.data);else if(j.isData3DTexture)se?(He&&t.texStorage3D(n.TEXTURE_3D,it,nt,Oe.width,Oe.height,Oe.depth),Ve&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Oe.width,Oe.height,Oe.depth,$e,pt,Oe.data)):t.texImage3D(n.TEXTURE_3D,0,nt,Oe.width,Oe.height,Oe.depth,0,$e,pt,Oe.data);else if(j.isFramebufferTexture){if(He)if(se)t.texStorage2D(n.TEXTURE_2D,it,nt,Oe.width,Oe.height);else{let We=Oe.width,Fe=Oe.height;for(let gt=0;gt<it;gt++)t.texImage2D(n.TEXTURE_2D,gt,nt,We,Fe,0,$e,pt,null),We>>=1,Fe>>=1}}else if(Nt.length>0){if(se&&He){const We=Ut(Nt[0]);t.texStorage2D(n.TEXTURE_2D,it,nt,We.width,We.height)}for(let We=0,Fe=Nt.length;We<Fe;We++)tt=Nt[We],se?Ve&&t.texSubImage2D(n.TEXTURE_2D,We,0,0,$e,pt,tt):t.texImage2D(n.TEXTURE_2D,We,nt,$e,pt,tt);j.generateMipmaps=!1}else if(se){if(He){const We=Ut(Oe);t.texStorage2D(n.TEXTURE_2D,it,nt,We.width,We.height)}Ve&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,$e,pt,Oe)}else t.texImage2D(n.TEXTURE_2D,0,nt,$e,pt,Oe);v(j)&&y(Ae),Ue.__version=ke.version,j.onUpdate&&j.onUpdate(j)}Q.__version=j.version}function ie(Q,j,me){if(j.image.length!==6)return;const Ae=re(Q,j),Pe=j.source;t.bindTexture(n.TEXTURE_CUBE_MAP,Q.__webglTexture,n.TEXTURE0+me);const ke=r.get(Pe);if(Pe.version!==ke.__version||Ae===!0){t.activeTexture(n.TEXTURE0+me);const Ue=gn.getPrimaries(gn.workingColorSpace),_e=j.colorSpace===oa?null:gn.getPrimaries(j.colorSpace),rt=j.colorSpace===oa||Ue===_e?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,j.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,j.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,rt);const Je=j.isCompressedTexture||j.image[0].isCompressedTexture,Oe=j.image[0]&&j.image[0].isDataTexture,$e=[];for(let Fe=0;Fe<6;Fe++)!Je&&!Oe?$e[Fe]=w(j.image[Fe],!0,i.maxCubemapSize):$e[Fe]=Oe?j.image[Fe].image:j.image[Fe],$e[Fe]=Mt(j,$e[Fe]);const pt=$e[0],nt=o.convert(j.format,j.colorSpace),tt=o.convert(j.type),Nt=E(j.internalFormat,nt,tt,j.colorSpace),se=j.isVideoTexture!==!0,He=ke.__version===void 0||Ae===!0,Ve=Pe.dataReady;let it=k(j,pt);q(n.TEXTURE_CUBE_MAP,j);let We;if(Je){se&&He&&t.texStorage2D(n.TEXTURE_CUBE_MAP,it,Nt,pt.width,pt.height);for(let Fe=0;Fe<6;Fe++){We=$e[Fe].mipmaps;for(let gt=0;gt<We.length;gt++){const Ht=We[gt];j.format!==Ao?nt!==null?se?Ve&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,0,0,Ht.width,Ht.height,nt,Ht.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,Nt,Ht.width,Ht.height,0,Ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):se?Ve&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,0,0,Ht.width,Ht.height,nt,tt,Ht.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,Nt,Ht.width,Ht.height,0,nt,tt,Ht.data)}}}else{if(We=j.mipmaps,se&&He){We.length>0&&it++;const Fe=Ut($e[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,it,Nt,Fe.width,Fe.height)}for(let Fe=0;Fe<6;Fe++)if(Oe){se?Ve&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,0,0,$e[Fe].width,$e[Fe].height,nt,tt,$e[Fe].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,Nt,$e[Fe].width,$e[Fe].height,0,nt,tt,$e[Fe].data);for(let gt=0;gt<We.length;gt++){const bn=We[gt].image[Fe].image;se?Ve&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,0,0,bn.width,bn.height,nt,tt,bn.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,Nt,bn.width,bn.height,0,nt,tt,bn.data)}}else{se?Ve&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,0,0,nt,tt,$e[Fe]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,Nt,nt,tt,$e[Fe]);for(let gt=0;gt<We.length;gt++){const Ht=We[gt];se?Ve&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,0,0,nt,tt,Ht.image[Fe]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,Nt,nt,tt,Ht.image[Fe])}}}v(j)&&y(n.TEXTURE_CUBE_MAP),ke.__version=Pe.version,j.onUpdate&&j.onUpdate(j)}Q.__version=j.version}function fe(Q,j,me,Ae,Pe,ke){const Ue=o.convert(me.format,me.colorSpace),_e=o.convert(me.type),rt=E(me.internalFormat,Ue,_e,me.colorSpace),Je=r.get(j),Oe=r.get(me);if(Oe.__renderTarget=j,!Je.__hasExternalTextures){const $e=Math.max(1,j.width>>ke),pt=Math.max(1,j.height>>ke);Pe===n.TEXTURE_3D||Pe===n.TEXTURE_2D_ARRAY?t.texImage3D(Pe,ke,rt,$e,pt,j.depth,0,Ue,_e,null):t.texImage2D(Pe,ke,rt,$e,pt,0,Ue,_e,null)}t.bindFramebuffer(n.FRAMEBUFFER,Q),Qe(j)?s.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Ae,Pe,Oe.__webglTexture,0,Tt(j)):(Pe===n.TEXTURE_2D||Pe>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Ae,Pe,Oe.__webglTexture,ke),t.bindFramebuffer(n.FRAMEBUFFER,null)}function Re(Q,j,me){if(n.bindRenderbuffer(n.RENDERBUFFER,Q),j.depthBuffer){const Ae=j.depthTexture,Pe=Ae&&Ae.isDepthTexture?Ae.type:null,ke=_(j.stencilBuffer,Pe),Ue=j.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,_e=Tt(j);Qe(j)?s.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,_e,ke,j.width,j.height):me?n.renderbufferStorageMultisample(n.RENDERBUFFER,_e,ke,j.width,j.height):n.renderbufferStorage(n.RENDERBUFFER,ke,j.width,j.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,Ue,n.RENDERBUFFER,Q)}else{const Ae=j.textures;for(let Pe=0;Pe<Ae.length;Pe++){const ke=Ae[Pe],Ue=o.convert(ke.format,ke.colorSpace),_e=o.convert(ke.type),rt=E(ke.internalFormat,Ue,_e,ke.colorSpace),Je=Tt(j);me&&Qe(j)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Je,rt,j.width,j.height):Qe(j)?s.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Je,rt,j.width,j.height):n.renderbufferStorage(n.RENDERBUFFER,rt,j.width,j.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function De(Q,j){if(j&&j.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,Q),!(j.depthTexture&&j.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Ae=r.get(j.depthTexture);Ae.__renderTarget=j,(!Ae.__webglTexture||j.depthTexture.image.width!==j.width||j.depthTexture.image.height!==j.height)&&(j.depthTexture.image.width=j.width,j.depthTexture.image.height=j.height,j.depthTexture.needsUpdate=!0),B(j.depthTexture,0);const Pe=Ae.__webglTexture,ke=Tt(j);if(j.depthTexture.format===ad)Qe(j)?s.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Pe,0,ke):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Pe,0);else if(j.depthTexture.format===Vc)Qe(j)?s.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Pe,0,ke):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Pe,0);else throw new Error("Unknown depthTexture format")}function Be(Q){const j=r.get(Q),me=Q.isWebGLCubeRenderTarget===!0;if(j.__boundDepthTexture!==Q.depthTexture){const Ae=Q.depthTexture;if(j.__depthDisposeCallback&&j.__depthDisposeCallback(),Ae){const Pe=()=>{delete j.__boundDepthTexture,delete j.__depthDisposeCallback,Ae.removeEventListener("dispose",Pe)};Ae.addEventListener("dispose",Pe),j.__depthDisposeCallback=Pe}j.__boundDepthTexture=Ae}if(Q.depthTexture&&!j.__autoAllocateDepthBuffer){if(me)throw new Error("target.depthTexture not supported in Cube render targets");const Ae=Q.texture.mipmaps;Ae&&Ae.length>0?De(j.__webglFramebuffer[0],Q):De(j.__webglFramebuffer,Q)}else if(me){j.__webglDepthbuffer=[];for(let Ae=0;Ae<6;Ae++)if(t.bindFramebuffer(n.FRAMEBUFFER,j.__webglFramebuffer[Ae]),j.__webglDepthbuffer[Ae]===void 0)j.__webglDepthbuffer[Ae]=n.createRenderbuffer(),Re(j.__webglDepthbuffer[Ae],Q,!1);else{const Pe=Q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ke=j.__webglDepthbuffer[Ae];n.bindRenderbuffer(n.RENDERBUFFER,ke),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pe,n.RENDERBUFFER,ke)}}else{const Ae=Q.texture.mipmaps;if(Ae&&Ae.length>0?t.bindFramebuffer(n.FRAMEBUFFER,j.__webglFramebuffer[0]):t.bindFramebuffer(n.FRAMEBUFFER,j.__webglFramebuffer),j.__webglDepthbuffer===void 0)j.__webglDepthbuffer=n.createRenderbuffer(),Re(j.__webglDepthbuffer,Q,!1);else{const Pe=Q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,ke=j.__webglDepthbuffer;n.bindRenderbuffer(n.RENDERBUFFER,ke),n.framebufferRenderbuffer(n.FRAMEBUFFER,Pe,n.RENDERBUFFER,ke)}}t.bindFramebuffer(n.FRAMEBUFFER,null)}function lt(Q,j,me){const Ae=r.get(Q);j!==void 0&&fe(Ae.__webglFramebuffer,Q,Q.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),me!==void 0&&Be(Q)}function Y(Q){const j=Q.texture,me=r.get(Q),Ae=r.get(j);Q.addEventListener("dispose",A);const Pe=Q.textures,ke=Q.isWebGLCubeRenderTarget===!0,Ue=Pe.length>1;if(Ue||(Ae.__webglTexture===void 0&&(Ae.__webglTexture=n.createTexture()),Ae.__version=j.version,a.memory.textures++),ke){me.__webglFramebuffer=[];for(let _e=0;_e<6;_e++)if(j.mipmaps&&j.mipmaps.length>0){me.__webglFramebuffer[_e]=[];for(let rt=0;rt<j.mipmaps.length;rt++)me.__webglFramebuffer[_e][rt]=n.createFramebuffer()}else me.__webglFramebuffer[_e]=n.createFramebuffer()}else{if(j.mipmaps&&j.mipmaps.length>0){me.__webglFramebuffer=[];for(let _e=0;_e<j.mipmaps.length;_e++)me.__webglFramebuffer[_e]=n.createFramebuffer()}else me.__webglFramebuffer=n.createFramebuffer();if(Ue)for(let _e=0,rt=Pe.length;_e<rt;_e++){const Je=r.get(Pe[_e]);Je.__webglTexture===void 0&&(Je.__webglTexture=n.createTexture(),a.memory.textures++)}if(Q.samples>0&&Qe(Q)===!1){me.__webglMultisampledFramebuffer=n.createFramebuffer(),me.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,me.__webglMultisampledFramebuffer);for(let _e=0;_e<Pe.length;_e++){const rt=Pe[_e];me.__webglColorRenderbuffer[_e]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,me.__webglColorRenderbuffer[_e]);const Je=o.convert(rt.format,rt.colorSpace),Oe=o.convert(rt.type),$e=E(rt.internalFormat,Je,Oe,rt.colorSpace,Q.isXRRenderTarget===!0),pt=Tt(Q);n.renderbufferStorageMultisample(n.RENDERBUFFER,pt,$e,Q.width,Q.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+_e,n.RENDERBUFFER,me.__webglColorRenderbuffer[_e])}n.bindRenderbuffer(n.RENDERBUFFER,null),Q.depthBuffer&&(me.__webglDepthRenderbuffer=n.createRenderbuffer(),Re(me.__webglDepthRenderbuffer,Q,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ke){t.bindTexture(n.TEXTURE_CUBE_MAP,Ae.__webglTexture),q(n.TEXTURE_CUBE_MAP,j);for(let _e=0;_e<6;_e++)if(j.mipmaps&&j.mipmaps.length>0)for(let rt=0;rt<j.mipmaps.length;rt++)fe(me.__webglFramebuffer[_e][rt],Q,j,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+_e,rt);else fe(me.__webglFramebuffer[_e],Q,j,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0);v(j)&&y(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ue){for(let _e=0,rt=Pe.length;_e<rt;_e++){const Je=Pe[_e],Oe=r.get(Je);let $e=n.TEXTURE_2D;(Q.isWebGL3DRenderTarget||Q.isWebGLArrayRenderTarget)&&($e=Q.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture($e,Oe.__webglTexture),q($e,Je),fe(me.__webglFramebuffer,Q,Je,n.COLOR_ATTACHMENT0+_e,$e,0),v(Je)&&y($e)}t.unbindTexture()}else{let _e=n.TEXTURE_2D;if((Q.isWebGL3DRenderTarget||Q.isWebGLArrayRenderTarget)&&(_e=Q.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(_e,Ae.__webglTexture),q(_e,j),j.mipmaps&&j.mipmaps.length>0)for(let rt=0;rt<j.mipmaps.length;rt++)fe(me.__webglFramebuffer[rt],Q,j,n.COLOR_ATTACHMENT0,_e,rt);else fe(me.__webglFramebuffer,Q,j,n.COLOR_ATTACHMENT0,_e,0);v(j)&&y(_e),t.unbindTexture()}Q.depthBuffer&&Be(Q)}function ot(Q){const j=Q.textures;for(let me=0,Ae=j.length;me<Ae;me++){const Pe=j[me];if(v(Pe)){const ke=x(Q),Ue=r.get(Pe).__webglTexture;t.bindTexture(ke,Ue),y(ke),t.unbindTexture()}}}const Ke=[],Xe=[];function qe(Q){if(Q.samples>0){if(Qe(Q)===!1){const j=Q.textures,me=Q.width,Ae=Q.height;let Pe=n.COLOR_BUFFER_BIT;const ke=Q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Ue=r.get(Q),_e=j.length>1;if(_e)for(let Je=0;Je<j.length;Je++)t.bindFramebuffer(n.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Ue.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer);const rt=Q.texture.mipmaps;rt&&rt.length>0?t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ue.__webglFramebuffer[0]):t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ue.__webglFramebuffer);for(let Je=0;Je<j.length;Je++){if(Q.resolveDepthBuffer&&(Q.depthBuffer&&(Pe|=n.DEPTH_BUFFER_BIT),Q.stencilBuffer&&Q.resolveStencilBuffer&&(Pe|=n.STENCIL_BUFFER_BIT)),_e){n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Ue.__webglColorRenderbuffer[Je]);const Oe=r.get(j[Je]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,Oe,0)}n.blitFramebuffer(0,0,me,Ae,0,0,me,Ae,Pe,n.NEAREST),u===!0&&(Ke.length=0,Xe.length=0,Ke.push(n.COLOR_ATTACHMENT0+Je),Q.depthBuffer&&Q.resolveDepthBuffer===!1&&(Ke.push(ke),Xe.push(ke),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,Xe)),n.invalidateFramebuffer(n.READ_FRAMEBUFFER,Ke))}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),_e)for(let Je=0;Je<j.length;Je++){t.bindFramebuffer(n.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.RENDERBUFFER,Ue.__webglColorRenderbuffer[Je]);const Oe=r.get(j[Je]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Ue.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+Je,n.TEXTURE_2D,Oe,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer)}else if(Q.depthBuffer&&Q.resolveDepthBuffer===!1&&u){const j=Q.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT;n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[j])}}}function Tt(Q){return Math.min(i.maxSamples,Q.samples)}function Qe(Q){const j=r.get(Q);return Q.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&j.__useRenderToTexture!==!1}function ft(Q){const j=a.render.frame;c.get(Q)!==j&&(c.set(Q,j),Q.update())}function Mt(Q,j){const me=Q.colorSpace,Ae=Q.format,Pe=Q.type;return Q.isCompressedTexture===!0||Q.isVideoTexture===!0||me!==eu&&me!==oa&&(gn.getTransfer(me)===Mn?(Ae!==Ao||Pe!==$r)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",me)),j}function Ut(Q){return typeof HTMLImageElement<"u"&&Q instanceof HTMLImageElement?(l.width=Q.naturalWidth||Q.width,l.height=Q.naturalHeight||Q.height):typeof VideoFrame<"u"&&Q instanceof VideoFrame?(l.width=Q.displayWidth,l.height=Q.displayHeight):(l.width=Q.width,l.height=Q.height),l}this.allocateTextureUnit=V,this.resetTextureUnits=O,this.setTexture2D=B,this.setTexture2DArray=U,this.setTexture3D=P,this.setTextureCube=L,this.rebindTextures=lt,this.setupRenderTarget=Y,this.updateRenderTargetMipmap=ot,this.updateMultisampleRenderTarget=qe,this.setupDepthRenderbuffer=Be,this.setupFrameBufferTexture=fe,this.useMultisampledRTT=Qe}function X$(n,e){function t(r,i=oa){let o;const a=gn.getTransfer(i);if(r===$r)return n.UNSIGNED_BYTE;if(r===U_)return n.UNSIGNED_SHORT_4_4_4_4;if(r===z_)return n.UNSIGNED_SHORT_5_5_5_1;if(r===IR)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===DR)return n.UNSIGNED_INT_10F_11F_11F_REV;if(r===RR)return n.BYTE;if(r===AR)return n.SHORT;if(r===od)return n.UNSIGNED_SHORT;if(r===B_)return n.INT;if(r===Zs)return n.UNSIGNED_INT;if(r===Wa)return n.FLOAT;if(r===Pd)return n.HALF_FLOAT;if(r===NR)return n.ALPHA;if(r===PR)return n.RGB;if(r===Ao)return n.RGBA;if(r===ad)return n.DEPTH_COMPONENT;if(r===Vc)return n.DEPTH_STENCIL;if(r===FR)return n.RED;if(r===W_)return n.RED_INTEGER;if(r===OR)return n.RG;if(r===H_)return n.RG_INTEGER;if(r===G_)return n.RGBA_INTEGER;if(r===Jp||r===Qp||r===Zp||r===em)if(a===Mn)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(r===Jp)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Qp)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Zp)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===em)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===Jp)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Qp)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Zp)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===em)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===O0||r===L0||r===B0||r===U0)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===O0)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===L0)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===B0)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===U0)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===z0||r===W0||r===H0)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(r===z0||r===W0)return a===Mn?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(r===H0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===G0||r===V0||r===j0||r===q0||r===$0||r===X0||r===Y0||r===K0||r===J0||r===Q0||r===Z0||r===ew||r===tw||r===nw)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(r===G0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===V0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===j0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===q0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===$0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===X0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===Y0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===K0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===J0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===Q0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===Z0)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===ew)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===tw)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===nw)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===rw||r===iw||r===ow)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(r===rw)return a===Mn?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===iw)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===ow)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===aw||r===sw||r===uw||r===lw)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(r===aw)return o.COMPRESSED_RED_RGTC1_EXT;if(r===sw)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===uw)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===lw)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Gc?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}const Y$=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,K$=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class J${constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const r=new YR(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=r}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,r=new Xr({vertexShader:Y$,fragmentShader:K$,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Io(new Ud(20,20),r)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class Q$ extends is{constructor(e,t){super();const r=this;let i=null,o=1,a=null,s="local-floor",u=1,l=null,c=null,h=null,f=null,m=null,g=null;const w=typeof XRWebGLBinding<"u",v=new J$,y={},x=t.getContextAttributes();let E=null,_=null;const k=[],C=[],A=new Wt;let I=null;const T=new eo;T.viewport=new Hn;const R=new eo;R.viewport=new Hn;const N=[T,R],O=new bG;let V=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(te){let ie=k[te];return ie===void 0&&(ie=new Mb,k[te]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(te){let ie=k[te];return ie===void 0&&(ie=new Mb,k[te]=ie),ie.getGripSpace()},this.getHand=function(te){let ie=k[te];return ie===void 0&&(ie=new Mb,k[te]=ie),ie.getHandSpace()};function B(te){const ie=C.indexOf(te.inputSource);if(ie===-1)return;const fe=k[ie];fe!==void 0&&(fe.update(te.inputSource,te.frame,l||a),fe.dispatchEvent({type:te.type,data:te.inputSource}))}function U(){i.removeEventListener("select",B),i.removeEventListener("selectstart",B),i.removeEventListener("selectend",B),i.removeEventListener("squeeze",B),i.removeEventListener("squeezestart",B),i.removeEventListener("squeezeend",B),i.removeEventListener("end",U),i.removeEventListener("inputsourceschange",P);for(let te=0;te<k.length;te++){const ie=C[te];ie!==null&&(C[te]=null,k[te].disconnect(ie))}V=null,F=null,v.reset();for(const te in y)delete y[te];e.setRenderTarget(E),m=null,f=null,h=null,i=null,_=null,ye.stop(),r.isPresenting=!1,e.setPixelRatio(I),e.setSize(A.width,A.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(te){o=te,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(te){s=te,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(te){l=te},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return h===null&&w&&(h=new XRWebGLBinding(i,t)),h},this.getFrame=function(){return g},this.getSession=function(){return i},this.setSession=async function(te){if(i=te,i!==null){if(E=e.getRenderTarget(),i.addEventListener("select",B),i.addEventListener("selectstart",B),i.addEventListener("selectend",B),i.addEventListener("squeeze",B),i.addEventListener("squeezestart",B),i.addEventListener("squeezeend",B),i.addEventListener("end",U),i.addEventListener("inputsourceschange",P),x.xrCompatible!==!0&&await t.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(A),w&&"createProjectionLayer"in XRWebGLBinding.prototype){let fe=null,Re=null,De=null;x.depth&&(De=x.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,fe=x.stencil?Vc:ad,Re=x.stencil?Gc:Zs);const Be={colorFormat:t.RGBA8,depthFormat:De,scaleFactor:o};h=this.getBinding(),f=h.createProjectionLayer(Be),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),_=new ri(f.textureWidth,f.textureHeight,{format:Ao,type:$r,depthTexture:new $_(f.textureWidth,f.textureHeight,Re,void 0,void 0,void 0,void 0,void 0,void 0,fe),stencilBuffer:x.stencil,colorSpace:e.outputColorSpace,samples:x.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const fe={antialias:x.antialias,alpha:!0,depth:x.depth,stencil:x.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(i,t,fe),i.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),_=new ri(m.framebufferWidth,m.framebufferHeight,{format:Ao,type:$r,colorSpace:e.outputColorSpace,stencilBuffer:x.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}_.isXRRenderTarget=!0,this.setFoveation(u),l=null,a=await i.requestReferenceSpace(s),ye.setContext(i),ye.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function P(te){for(let ie=0;ie<te.removed.length;ie++){const fe=te.removed[ie],Re=C.indexOf(fe);Re>=0&&(C[Re]=null,k[Re].disconnect(fe))}for(let ie=0;ie<te.added.length;ie++){const fe=te.added[ie];let Re=C.indexOf(fe);if(Re===-1){for(let Be=0;Be<k.length;Be++)if(Be>=C.length){C.push(fe),Re=Be;break}else if(C[Be]===null){C[Be]=fe,Re=Be;break}if(Re===-1)break}const De=k[Re];De&&De.connect(fe)}}const L=new Te,H=new Te;function W(te,ie,fe){L.setFromMatrixPosition(ie.matrixWorld),H.setFromMatrixPosition(fe.matrixWorld);const Re=L.distanceTo(H),De=ie.projectionMatrix.elements,Be=fe.projectionMatrix.elements,lt=De[14]/(De[10]-1),Y=De[14]/(De[10]+1),ot=(De[9]+1)/De[5],Ke=(De[9]-1)/De[5],Xe=(De[8]-1)/De[0],qe=(Be[8]+1)/Be[0],Tt=lt*Xe,Qe=lt*qe,ft=Re/(-Xe+qe),Mt=ft*-Xe;if(ie.matrixWorld.decompose(te.position,te.quaternion,te.scale),te.translateX(Mt),te.translateZ(ft),te.matrixWorld.compose(te.position,te.quaternion,te.scale),te.matrixWorldInverse.copy(te.matrixWorld).invert(),De[10]===-1)te.projectionMatrix.copy(ie.projectionMatrix),te.projectionMatrixInverse.copy(ie.projectionMatrixInverse);else{const Ut=lt+ft,Q=Y+ft,j=Tt-Mt,me=Qe+(Re-Mt),Ae=ot*Y/Q*Ut,Pe=Ke*Y/Q*Ut;te.projectionMatrix.makePerspective(j,me,Ae,Pe,Ut,Q),te.projectionMatrixInverse.copy(te.projectionMatrix).invert()}}function z(te,ie){ie===null?te.matrixWorld.copy(te.matrix):te.matrixWorld.multiplyMatrices(ie.matrixWorld,te.matrix),te.matrixWorldInverse.copy(te.matrixWorld).invert()}this.updateCamera=function(te){if(i===null)return;let ie=te.near,fe=te.far;v.texture!==null&&(v.depthNear>0&&(ie=v.depthNear),v.depthFar>0&&(fe=v.depthFar)),O.near=R.near=T.near=ie,O.far=R.far=T.far=fe,(V!==O.near||F!==O.far)&&(i.updateRenderState({depthNear:O.near,depthFar:O.far}),V=O.near,F=O.far),O.layers.mask=te.layers.mask|6,T.layers.mask=O.layers.mask&3,R.layers.mask=O.layers.mask&5;const Re=te.parent,De=O.cameras;z(O,Re);for(let Be=0;Be<De.length;Be++)z(De[Be],Re);De.length===2?W(O,T,R):O.projectionMatrix.copy(T.projectionMatrix),q(te,O,Re)};function q(te,ie,fe){fe===null?te.matrix.copy(ie.matrixWorld):(te.matrix.copy(fe.matrixWorld),te.matrix.invert(),te.matrix.multiply(ie.matrixWorld)),te.matrix.decompose(te.position,te.quaternion,te.scale),te.updateMatrixWorld(!0),te.projectionMatrix.copy(ie.projectionMatrix),te.projectionMatrixInverse.copy(ie.projectionMatrixInverse),te.isPerspectiveCamera&&(te.fov=sd*2*Math.atan(1/te.projectionMatrix.elements[5]),te.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(f===null&&m===null))return u},this.setFoveation=function(te){u=te,f!==null&&(f.fixedFoveation=te),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=te)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(O)},this.getCameraTexture=function(te){return y[te]};let re=null;function de(te,ie){if(c=ie.getViewerPose(l||a),g=ie,c!==null){const fe=c.views;m!==null&&(e.setRenderTargetFramebuffer(_,m.framebuffer),e.setRenderTarget(_));let Re=!1;fe.length!==O.cameras.length&&(O.cameras.length=0,Re=!0);for(let Y=0;Y<fe.length;Y++){const ot=fe[Y];let Ke=null;if(m!==null)Ke=m.getViewport(ot);else{const qe=h.getViewSubImage(f,ot);Ke=qe.viewport,Y===0&&(e.setRenderTargetTextures(_,qe.colorTexture,qe.depthStencilTexture),e.setRenderTarget(_))}let Xe=N[Y];Xe===void 0&&(Xe=new eo,Xe.layers.enable(Y),Xe.viewport=new Hn,N[Y]=Xe),Xe.matrix.fromArray(ot.transform.matrix),Xe.matrix.decompose(Xe.position,Xe.quaternion,Xe.scale),Xe.projectionMatrix.fromArray(ot.projectionMatrix),Xe.projectionMatrixInverse.copy(Xe.projectionMatrix).invert(),Xe.viewport.set(Ke.x,Ke.y,Ke.width,Ke.height),Y===0&&(O.matrix.copy(Xe.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),Re===!0&&O.cameras.push(Xe)}const De=i.enabledFeatures;if(De&&De.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&w){h=r.getBinding();const Y=h.getDepthInformation(fe[0]);Y&&Y.isValid&&Y.texture&&v.init(Y,i.renderState)}if(De&&De.includes("camera-access")&&w){e.state.unbindTexture(),h=r.getBinding();for(let Y=0;Y<fe.length;Y++){const ot=fe[Y].camera;if(ot){let Ke=y[ot];Ke||(Ke=new YR,y[ot]=Ke);const Xe=h.getCameraImage(ot);Ke.sourceTexture=Xe}}}}for(let fe=0;fe<k.length;fe++){const Re=C[fe],De=k[fe];Re!==null&&De!==void 0&&De.update(Re,ie,l||a)}re&&re(te,ie),ie.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:ie}),g=null}const ye=new KR;ye.setAnimationLoop(de),this.setAnimationLoop=function(te){re=te},this.dispose=function(){}}}const Au=new $a,Z$=new sr;function eX(n,e){function t(v,y){v.matrixAutoUpdate===!0&&v.updateMatrix(),y.value.copy(v.matrix)}function r(v,y){y.color.getRGB(v.fogColor.value,jR(n)),y.isFog?(v.fogNear.value=y.near,v.fogFar.value=y.far):y.isFogExp2&&(v.fogDensity.value=y.density)}function i(v,y,x,E,_){y.isMeshBasicMaterial||y.isMeshLambertMaterial?o(v,y):y.isMeshToonMaterial?(o(v,y),h(v,y)):y.isMeshPhongMaterial?(o(v,y),c(v,y)):y.isMeshStandardMaterial?(o(v,y),f(v,y),y.isMeshPhysicalMaterial&&m(v,y,_)):y.isMeshMatcapMaterial?(o(v,y),g(v,y)):y.isMeshDepthMaterial?o(v,y):y.isMeshDistanceMaterial?(o(v,y),w(v,y)):y.isMeshNormalMaterial?o(v,y):y.isLineBasicMaterial?(a(v,y),y.isLineDashedMaterial&&s(v,y)):y.isPointsMaterial?u(v,y,x,E):y.isSpriteMaterial?l(v,y):y.isShadowMaterial?(v.color.value.copy(y.color),v.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function o(v,y){v.opacity.value=y.opacity,y.color&&v.diffuse.value.copy(y.color),y.emissive&&v.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(v.map.value=y.map,t(y.map,v.mapTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.bumpMap&&(v.bumpMap.value=y.bumpMap,t(y.bumpMap,v.bumpMapTransform),v.bumpScale.value=y.bumpScale,y.side===br&&(v.bumpScale.value*=-1)),y.normalMap&&(v.normalMap.value=y.normalMap,t(y.normalMap,v.normalMapTransform),v.normalScale.value.copy(y.normalScale),y.side===br&&v.normalScale.value.negate()),y.displacementMap&&(v.displacementMap.value=y.displacementMap,t(y.displacementMap,v.displacementMapTransform),v.displacementScale.value=y.displacementScale,v.displacementBias.value=y.displacementBias),y.emissiveMap&&(v.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,v.emissiveMapTransform)),y.specularMap&&(v.specularMap.value=y.specularMap,t(y.specularMap,v.specularMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest);const x=e.get(y),E=x.envMap,_=x.envMapRotation;E&&(v.envMap.value=E,Au.copy(_),Au.x*=-1,Au.y*=-1,Au.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Au.y*=-1,Au.z*=-1),v.envMapRotation.value.setFromMatrix4(Z$.makeRotationFromEuler(Au)),v.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=y.reflectivity,v.ior.value=y.ior,v.refractionRatio.value=y.refractionRatio),y.lightMap&&(v.lightMap.value=y.lightMap,v.lightMapIntensity.value=y.lightMapIntensity,t(y.lightMap,v.lightMapTransform)),y.aoMap&&(v.aoMap.value=y.aoMap,v.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,v.aoMapTransform))}function a(v,y){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,y.map&&(v.map.value=y.map,t(y.map,v.mapTransform))}function s(v,y){v.dashSize.value=y.dashSize,v.totalSize.value=y.dashSize+y.gapSize,v.scale.value=y.scale}function u(v,y,x,E){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,v.size.value=y.size*x,v.scale.value=E*.5,y.map&&(v.map.value=y.map,t(y.map,v.uvTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest)}function l(v,y){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,v.rotation.value=y.rotation,y.map&&(v.map.value=y.map,t(y.map,v.mapTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest)}function c(v,y){v.specular.value.copy(y.specular),v.shininess.value=Math.max(y.shininess,1e-4)}function h(v,y){y.gradientMap&&(v.gradientMap.value=y.gradientMap)}function f(v,y){v.metalness.value=y.metalness,y.metalnessMap&&(v.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,v.metalnessMapTransform)),v.roughness.value=y.roughness,y.roughnessMap&&(v.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,v.roughnessMapTransform)),y.envMap&&(v.envMapIntensity.value=y.envMapIntensity)}function m(v,y,x){v.ior.value=y.ior,y.sheen>0&&(v.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),v.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(v.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,v.sheenColorMapTransform)),y.sheenRoughnessMap&&(v.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,v.sheenRoughnessMapTransform))),y.clearcoat>0&&(v.clearcoat.value=y.clearcoat,v.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(v.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,v.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(v.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===br&&v.clearcoatNormalScale.value.negate())),y.dispersion>0&&(v.dispersion.value=y.dispersion),y.iridescence>0&&(v.iridescence.value=y.iridescence,v.iridescenceIOR.value=y.iridescenceIOR,v.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(v.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,v.iridescenceMapTransform)),y.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),y.transmission>0&&(v.transmission.value=y.transmission,v.transmissionSamplerMap.value=x.texture,v.transmissionSamplerSize.value.set(x.width,x.height),y.transmissionMap&&(v.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,v.transmissionMapTransform)),v.thickness.value=y.thickness,y.thicknessMap&&(v.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=y.attenuationDistance,v.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(v.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(v.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=y.specularIntensity,v.specularColor.value.copy(y.specularColor),y.specularColorMap&&(v.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,v.specularColorMapTransform)),y.specularIntensityMap&&(v.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,y){y.matcap&&(v.matcap.value=y.matcap)}function w(v,y){const x=e.get(y).light;v.referencePosition.value.setFromMatrixPosition(x.matrixWorld),v.nearDistance.value=x.shadow.camera.near,v.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function tX(n,e,t,r){let i={},o={},a=[];const s=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function u(x,E){const _=E.program;r.uniformBlockBinding(x,_)}function l(x,E){let _=i[x.id];_===void 0&&(g(x),_=c(x),i[x.id]=_,x.addEventListener("dispose",v));const k=E.program;r.updateUBOMapping(x,k);const C=e.render.frame;o[x.id]!==C&&(f(x),o[x.id]=C)}function c(x){const E=h();x.__bindingPointIndex=E;const _=n.createBuffer(),k=x.__size,C=x.usage;return n.bindBuffer(n.UNIFORM_BUFFER,_),n.bufferData(n.UNIFORM_BUFFER,k,C),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,E,_),_}function h(){for(let x=0;x<s;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(x){const E=i[x.id],_=x.uniforms,k=x.__cache;n.bindBuffer(n.UNIFORM_BUFFER,E);for(let C=0,A=_.length;C<A;C++){const I=Array.isArray(_[C])?_[C]:[_[C]];for(let T=0,R=I.length;T<R;T++){const N=I[T];if(m(N,C,T,k)===!0){const O=N.__offset,V=Array.isArray(N.value)?N.value:[N.value];let F=0;for(let B=0;B<V.length;B++){const U=V[B],P=w(U);typeof U=="number"||typeof U=="boolean"?(N.__data[0]=U,n.bufferSubData(n.UNIFORM_BUFFER,O+F,N.__data)):U.isMatrix3?(N.__data[0]=U.elements[0],N.__data[1]=U.elements[1],N.__data[2]=U.elements[2],N.__data[3]=0,N.__data[4]=U.elements[3],N.__data[5]=U.elements[4],N.__data[6]=U.elements[5],N.__data[7]=0,N.__data[8]=U.elements[6],N.__data[9]=U.elements[7],N.__data[10]=U.elements[8],N.__data[11]=0):(U.toArray(N.__data,F),F+=P.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,O,N.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function m(x,E,_,k){const C=x.value,A=E+"_"+_;if(k[A]===void 0)return typeof C=="number"||typeof C=="boolean"?k[A]=C:k[A]=C.clone(),!0;{const I=k[A];if(typeof C=="number"||typeof C=="boolean"){if(I!==C)return k[A]=C,!0}else if(I.equals(C)===!1)return I.copy(C),!0}return!1}function g(x){const E=x.uniforms;let _=0;const k=16;for(let A=0,I=E.length;A<I;A++){const T=Array.isArray(E[A])?E[A]:[E[A]];for(let R=0,N=T.length;R<N;R++){const O=T[R],V=Array.isArray(O.value)?O.value:[O.value];for(let F=0,B=V.length;F<B;F++){const U=V[F],P=w(U),L=_%k,H=L%P.boundary,W=L+H;_+=H,W!==0&&k-W<P.storage&&(_+=k-W),O.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=_,_+=P.storage}}}const C=_%k;return C>0&&(_+=k-C),x.__size=_,x.__cache={},this}function w(x){const E={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(E.boundary=4,E.storage=4):x.isVector2?(E.boundary=8,E.storage=8):x.isVector3||x.isColor?(E.boundary=16,E.storage=12):x.isVector4?(E.boundary=16,E.storage=16):x.isMatrix3?(E.boundary=48,E.storage=48):x.isMatrix4?(E.boundary=64,E.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),E}function v(x){const E=x.target;E.removeEventListener("dispose",v);const _=a.indexOf(E.__bindingPointIndex);a.splice(_,1),n.deleteBuffer(i[E.id]),delete i[E.id],delete o[E.id]}function y(){for(const x in i)n.deleteBuffer(i[x]);a=[],i={},o={}}return{bind:u,update:l,dispose:y}}class nX{constructor(e={}){const{canvas:t=WH(),context:r=null,depth:i=!0,stencil:o=!1,alpha:a=!1,antialias:s=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let m;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=r.getContextAttributes().alpha}else m=a;const g=new Uint32Array(4),w=new Int32Array(4);let v=null,y=null;const x=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Ga,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const _=this;let k=!1;this._outputColorSpace=Cn;let C=0,A=0,I=null,T=-1,R=null;const N=new Hn,O=new Hn;let V=null;const F=new Sn(0);let B=0,U=t.width,P=t.height,L=1,H=null,W=null;const z=new Hn(0,0,U,P),q=new Hn(0,0,U,P);let re=!1;const de=new XR;let ye=!1,te=!1;const ie=new sr,fe=new Te,Re=new Hn,De={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Be=!1;function lt(){return I===null?L:1}let Y=r;function ot($,pe){return t.getContext($,pe)}try{const $={alpha:!0,depth:i,stencil:o,antialias:s,premultipliedAlpha:u,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Nd}`),t.addEventListener("webglcontextlost",Ve,!1),t.addEventListener("webglcontextrestored",it,!1),t.addEventListener("webglcontextcreationerror",We,!1),Y===null){const pe="webgl2";if(Y=ot(pe,$),Y===null)throw ot(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch($){throw console.error("THREE.WebGLRenderer: "+$.message),$}let Ke,Xe,qe,Tt,Qe,ft,Mt,Ut,Q,j,me,Ae,Pe,ke,Ue,_e,rt,Je,Oe,$e,pt,nt,tt,Nt;function se(){Ke=new dq(Y),Ke.init(),nt=new X$(Y,Ke),Xe=new oq(Y,Ke,e,nt),qe=new q$(Y,Ke),Xe.reversedDepthBuffer&&f&&qe.buffers.depth.setReversed(!0),Tt=new mq(Y),Qe=new N$,ft=new $$(Y,Ke,qe,Qe,Xe,nt,Tt),Mt=new sq(_),Ut=new hq(_),Q=new _G(Y),tt=new rq(Y,Q),j=new fq(Y,Q,Tt,tt),me=new vq(Y,j,Q,Tt),Oe=new gq(Y,Xe,ft),_e=new aq(Qe),Ae=new D$(_,Mt,Ut,Ke,Xe,tt,_e),Pe=new eX(_,Qe),ke=new F$,Ue=new W$(Ke),Je=new nq(_,Mt,Ut,qe,me,m,u),rt=new V$(_,me,Xe),Nt=new tX(Y,Tt,Xe,qe),$e=new iq(Y,Ke,Tt),pt=new pq(Y,Ke,Tt),Tt.programs=Ae.programs,_.capabilities=Xe,_.extensions=Ke,_.properties=Qe,_.renderLists=ke,_.shadowMap=rt,_.state=qe,_.info=Tt}se();const He=new Q$(_,Y);this.xr=He,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const $=Ke.get("WEBGL_lose_context");$&&$.loseContext()},this.forceContextRestore=function(){const $=Ke.get("WEBGL_lose_context");$&&$.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function($){$!==void 0&&(L=$,this.setSize(U,P,!1))},this.getSize=function($){return $.set(U,P)},this.setSize=function($,pe,Ee=!0){if(He.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}U=$,P=pe,t.width=Math.floor($*L),t.height=Math.floor(pe*L),Ee===!0&&(t.style.width=$+"px",t.style.height=pe+"px"),this.setViewport(0,0,$,pe)},this.getDrawingBufferSize=function($){return $.set(U*L,P*L).floor()},this.setDrawingBufferSize=function($,pe,Ee){U=$,P=pe,L=Ee,t.width=Math.floor($*Ee),t.height=Math.floor(pe*Ee),this.setViewport(0,0,$,pe)},this.getCurrentViewport=function($){return $.copy(N)},this.getViewport=function($){return $.copy(z)},this.setViewport=function($,pe,Ee,Ce){$.isVector4?z.set($.x,$.y,$.z,$.w):z.set($,pe,Ee,Ce),qe.viewport(N.copy(z).multiplyScalar(L).round())},this.getScissor=function($){return $.copy(q)},this.setScissor=function($,pe,Ee,Ce){$.isVector4?q.set($.x,$.y,$.z,$.w):q.set($,pe,Ee,Ce),qe.scissor(O.copy(q).multiplyScalar(L).round())},this.getScissorTest=function(){return re},this.setScissorTest=function($){qe.setScissorTest(re=$)},this.setOpaqueSort=function($){H=$},this.setTransparentSort=function($){W=$},this.getClearColor=function($){return $.copy(Je.getClearColor())},this.setClearColor=function(){Je.setClearColor(...arguments)},this.getClearAlpha=function(){return Je.getClearAlpha()},this.setClearAlpha=function(){Je.setClearAlpha(...arguments)},this.clear=function($=!0,pe=!0,Ee=!0){let Ce=0;if($){let he=!1;if(I!==null){const Ye=I.texture.format;he=Ye===G_||Ye===H_||Ye===W_}if(he){const Ye=I.texture.type,st=Ye===$r||Ye===Zs||Ye===od||Ye===Gc||Ye===U_||Ye===z_,vt=Je.getClearColor(),ct=Je.getClearAlpha(),Bt=vt.r,zt=vt.g,Rt=vt.b;st?(g[0]=Bt,g[1]=zt,g[2]=Rt,g[3]=ct,Y.clearBufferuiv(Y.COLOR,0,g)):(w[0]=Bt,w[1]=zt,w[2]=Rt,w[3]=ct,Y.clearBufferiv(Y.COLOR,0,w))}else Ce|=Y.COLOR_BUFFER_BIT}pe&&(Ce|=Y.DEPTH_BUFFER_BIT),Ee&&(Ce|=Y.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Y.clear(Ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ve,!1),t.removeEventListener("webglcontextrestored",it,!1),t.removeEventListener("webglcontextcreationerror",We,!1),Je.dispose(),ke.dispose(),Ue.dispose(),Qe.dispose(),Mt.dispose(),Ut.dispose(),me.dispose(),tt.dispose(),Nt.dispose(),Ae.dispose(),He.dispose(),He.removeEventListener("sessionstart",fr),He.removeEventListener("sessionend",os),pr.stop()};function Ve($){$.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),k=!0}function it(){console.log("THREE.WebGLRenderer: Context Restored."),k=!1;const $=Tt.autoReset,pe=rt.enabled,Ee=rt.autoUpdate,Ce=rt.needsUpdate,he=rt.type;se(),Tt.autoReset=$,rt.enabled=pe,rt.autoUpdate=Ee,rt.needsUpdate=Ce,rt.type=he}function We($){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",$.statusMessage)}function Fe($){const pe=$.target;pe.removeEventListener("dispose",Fe),gt(pe)}function gt($){Ht($),Qe.remove($)}function Ht($){const pe=Qe.get($).programs;pe!==void 0&&(pe.forEach(function(Ee){Ae.releaseProgram(Ee)}),$.isShaderMaterial&&Ae.releaseShaderCache($))}this.renderBufferDirect=function($,pe,Ee,Ce,he,Ye){pe===null&&(pe=De);const st=he.isMesh&&he.matrixWorld.determinant()<0,vt=ho($,pe,Ee,Ce,he);qe.setMaterial(Ce,st);let ct=Ee.index,Bt=1;if(Ce.wireframe===!0){if(ct=j.getWireframeAttribute(Ee),ct===void 0)return;Bt=2}const zt=Ee.drawRange,Rt=Ee.attributes.position;let jt=zt.start*Bt,xn=(zt.start+zt.count)*Bt;Ye!==null&&(jt=Math.max(jt,Ye.start*Bt),xn=Math.min(xn,(Ye.start+Ye.count)*Bt)),ct!==null?(jt=Math.max(jt,0),xn=Math.min(xn,ct.count)):Rt!=null&&(jt=Math.max(jt,0),xn=Math.min(xn,Rt.count));const ln=xn-jt;if(ln<0||ln===1/0)return;tt.setup(he,Ce,vt,Ee,ct);let An,kn=$e;if(ct!==null&&(An=Q.get(ct),kn=pt,kn.setIndex(An)),he.isMesh)Ce.wireframe===!0?(qe.setLineWidth(Ce.wireframeLinewidth*lt()),kn.setMode(Y.LINES)):kn.setMode(Y.TRIANGLES);else if(he.isLine){let Ft=Ce.linewidth;Ft===void 0&&(Ft=1),qe.setLineWidth(Ft*lt()),he.isLineSegments?kn.setMode(Y.LINES):he.isLineLoop?kn.setMode(Y.LINE_LOOP):kn.setMode(Y.LINE_STRIP)}else he.isPoints?kn.setMode(Y.POINTS):he.isSprite&&kn.setMode(Y.TRIANGLES);if(he.isBatchedMesh)if(he._multiDrawInstances!==null)ud("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),kn.renderMultiDrawInstances(he._multiDrawStarts,he._multiDrawCounts,he._multiDrawCount,he._multiDrawInstances);else if(Ke.get("WEBGL_multi_draw"))kn.renderMultiDraw(he._multiDrawStarts,he._multiDrawCounts,he._multiDrawCount);else{const Ft=he._multiDrawStarts,Tn=he._multiDrawCounts,nn=he._multiDrawCount,tr=ct?Q.get(ct).bytesPerElement:1,fo=Qe.get(Ce).currentProgram.getUniforms();for(let Yr=0;Yr<nn;Yr++)fo.setValue(Y,"_gl_DrawID",Yr),kn.render(Ft[Yr]/tr,Tn[Yr])}else if(he.isInstancedMesh)kn.renderInstances(jt,ln,he.count);else if(Ee.isInstancedBufferGeometry){const Ft=Ee._maxInstanceCount!==void 0?Ee._maxInstanceCount:1/0,Tn=Math.min(Ee.instanceCount,Ft);kn.renderInstances(jt,ln,Tn)}else kn.render(jt,ln)};function bn($,pe,Ee){$.transparent===!0&&$.side===Fi&&$.forceSinglePass===!1?($.side=br,$.needsUpdate=!0,as($,pe,Ee),$.side=qa,$.needsUpdate=!0,as($,pe,Ee),$.side=Fi):as($,pe,Ee)}this.compile=function($,pe,Ee=null){Ee===null&&(Ee=$),y=Ue.get(Ee),y.init(pe),E.push(y),Ee.traverseVisible(function(he){he.isLight&&he.layers.test(pe.layers)&&(y.pushLight(he),he.castShadow&&y.pushShadow(he))}),$!==Ee&&$.traverseVisible(function(he){he.isLight&&he.layers.test(pe.layers)&&(y.pushLight(he),he.castShadow&&y.pushShadow(he))}),y.setupLights();const Ce=new Set;return $.traverse(function(he){if(!(he.isMesh||he.isPoints||he.isLine||he.isSprite))return;const Ye=he.material;if(Ye)if(Array.isArray(Ye))for(let st=0;st<Ye.length;st++){const vt=Ye[st];bn(vt,Ee,he),Ce.add(vt)}else bn(Ye,Ee,he),Ce.add(Ye)}),y=E.pop(),Ce},this.compileAsync=function($,pe,Ee=null){const Ce=this.compile($,pe,Ee);return new Promise(he=>{function Ye(){if(Ce.forEach(function(st){Qe.get(st).currentProgram.isReady()&&Ce.delete(st)}),Ce.size===0){he($);return}setTimeout(Ye,10)}Ke.get("KHR_parallel_shader_compile")!==null?Ye():setTimeout(Ye,10)})};let an=null;function oi($){an&&an($)}function fr(){pr.stop()}function os(){pr.start()}const pr=new KR;pr.setAnimationLoop(oi),typeof self<"u"&&pr.setContext(self),this.setAnimationLoop=function($){an=$,He.setAnimationLoop($),$===null?pr.stop():pr.start()},He.addEventListener("sessionstart",fr),He.addEventListener("sessionend",os),this.render=function($,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(k===!0)return;if($.matrixWorldAutoUpdate===!0&&$.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),He.enabled===!0&&He.isPresenting===!0&&(He.cameraAutoUpdate===!0&&He.updateCamera(pe),pe=He.getCamera()),$.isScene===!0&&$.onBeforeRender(_,$,pe,I),y=Ue.get($,E.length),y.init(pe),E.push(y),ie.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),de.setFromProjectionMatrix(ie,ua,pe.reversedDepth),te=this.localClippingEnabled,ye=_e.init(this.clippingPlanes,te),v=ke.get($,x.length),v.init(),x.push(v),He.enabled===!0&&He.isPresenting===!0){const Ye=_.xr.getDepthSensingMesh();Ye!==null&&Ho(Ye,pe,-1/0,_.sortObjects)}Ho($,pe,0,_.sortObjects),v.finish(),_.sortObjects===!0&&v.sort(H,W),Be=He.enabled===!1||He.isPresenting===!1||He.hasDepthSensing()===!1,Be&&Je.addToRenderList(v,$),this.info.render.frame++,ye===!0&&_e.beginShadows();const Ee=y.state.shadowsArray;rt.render(Ee,$,pe),ye===!0&&_e.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ce=v.opaque,he=v.transmissive;if(y.setupLights(),pe.isArrayCamera){const Ye=pe.cameras;if(he.length>0)for(let st=0,vt=Ye.length;st<vt;st++){const ct=Ye[st];Hi(Ce,he,$,ct)}Be&&Je.render($);for(let st=0,vt=Ye.length;st<vt;st++){const ct=Ye[st];Go(v,$,ct,ct.viewport)}}else he.length>0&&Hi(Ce,he,$,pe),Be&&Je.render($),Go(v,$,pe);I!==null&&A===0&&(ft.updateMultisampleRenderTarget(I),ft.updateRenderTargetMipmap(I)),$.isScene===!0&&$.onAfterRender(_,$,pe),tt.resetDefaultState(),T=-1,R=null,E.pop(),E.length>0?(y=E[E.length-1],ye===!0&&_e.setGlobalState(_.clippingPlanes,y.state.camera)):y=null,x.pop(),x.length>0?v=x[x.length-1]:v=null};function Ho($,pe,Ee,Ce){if($.visible===!1)return;if($.layers.test(pe.layers)){if($.isGroup)Ee=$.renderOrder;else if($.isLOD)$.autoUpdate===!0&&$.update(pe);else if($.isLight)y.pushLight($),$.castShadow&&y.pushShadow($);else if($.isSprite){if(!$.frustumCulled||de.intersectsSprite($)){Ce&&Re.setFromMatrixPosition($.matrixWorld).applyMatrix4(ie);const st=me.update($),vt=$.material;vt.visible&&v.push($,st,vt,Ee,Re.z,null)}}else if(($.isMesh||$.isLine||$.isPoints)&&(!$.frustumCulled||de.intersectsObject($))){const st=me.update($),vt=$.material;if(Ce&&($.boundingSphere!==void 0?($.boundingSphere===null&&$.computeBoundingSphere(),Re.copy($.boundingSphere.center)):(st.boundingSphere===null&&st.computeBoundingSphere(),Re.copy(st.boundingSphere.center)),Re.applyMatrix4($.matrixWorld).applyMatrix4(ie)),Array.isArray(vt)){const ct=st.groups;for(let Bt=0,zt=ct.length;Bt<zt;Bt++){const Rt=ct[Bt],jt=vt[Rt.materialIndex];jt&&jt.visible&&v.push($,st,jt,Ee,Re.z,Rt)}}else vt.visible&&v.push($,st,vt,Ee,Re.z,null)}}const Ye=$.children;for(let st=0,vt=Ye.length;st<vt;st++)Ho(Ye[st],pe,Ee,Ce)}function Go($,pe,Ee,Ce){const he=$.opaque,Ye=$.transmissive,st=$.transparent;y.setupLightsView(Ee),ye===!0&&_e.setGlobalState(_.clippingPlanes,Ee),Ce&&qe.viewport(N.copy(Ce)),he.length>0&&Gi(he,pe,Ee),Ye.length>0&&Gi(Ye,pe,Ee),st.length>0&&Gi(st,pe,Ee),qe.buffers.depth.setTest(!0),qe.buffers.depth.setMask(!0),qe.buffers.color.setMask(!0),qe.setPolygonOffset(!1)}function Hi($,pe,Ee,Ce){if((Ee.isScene===!0?Ee.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[Ce.id]===void 0&&(y.state.transmissionRenderTarget[Ce.id]=new ri(1,1,{generateMipmaps:!0,type:Ke.has("EXT_color_buffer_half_float")||Ke.has("EXT_color_buffer_float")?Pd:$r,minFilter:$u,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:gn.workingColorSpace}));const Ye=y.state.transmissionRenderTarget[Ce.id],st=Ce.viewport||N;Ye.setSize(st.z*_.transmissionResolutionScale,st.w*_.transmissionResolutionScale);const vt=_.getRenderTarget(),ct=_.getActiveCubeFace(),Bt=_.getActiveMipmapLevel();_.setRenderTarget(Ye),_.getClearColor(F),B=_.getClearAlpha(),B<1&&_.setClearColor(16777215,.5),_.clear(),Be&&Je.render(Ee);const zt=_.toneMapping;_.toneMapping=Ga;const Rt=Ce.viewport;if(Ce.viewport!==void 0&&(Ce.viewport=void 0),y.setupLightsView(Ce),ye===!0&&_e.setGlobalState(_.clippingPlanes,Ce),Gi($,Ee,Ce),ft.updateMultisampleRenderTarget(Ye),ft.updateRenderTargetMipmap(Ye),Ke.has("WEBGL_multisampled_render_to_texture")===!1){let jt=!1;for(let xn=0,ln=pe.length;xn<ln;xn++){const An=pe[xn],kn=An.object,Ft=An.geometry,Tn=An.material,nn=An.group;if(Tn.side===Fi&&kn.layers.test(Ce.layers)){const tr=Tn.side;Tn.side=br,Tn.needsUpdate=!0,co(kn,Ee,Ce,Ft,Tn,nn),Tn.side=tr,Tn.needsUpdate=!0,jt=!0}}jt===!0&&(ft.updateMultisampleRenderTarget(Ye),ft.updateRenderTargetMipmap(Ye))}_.setRenderTarget(vt,ct,Bt),_.setClearColor(F,B),Rt!==void 0&&(Ce.viewport=Rt),_.toneMapping=zt}function Gi($,pe,Ee){const Ce=pe.isScene===!0?pe.overrideMaterial:null;for(let he=0,Ye=$.length;he<Ye;he++){const st=$[he],vt=st.object,ct=st.geometry,Bt=st.group;let zt=st.material;zt.allowOverride===!0&&Ce!==null&&(zt=Ce),vt.layers.test(Ee.layers)&&co(vt,pe,Ee,ct,zt,Bt)}}function co($,pe,Ee,Ce,he,Ye){$.onBeforeRender(_,pe,Ee,Ce,he,Ye),$.modelViewMatrix.multiplyMatrices(Ee.matrixWorldInverse,$.matrixWorld),$.normalMatrix.getNormalMatrix($.modelViewMatrix),he.onBeforeRender(_,pe,Ee,Ce,$,Ye),he.transparent===!0&&he.side===Fi&&he.forceSinglePass===!1?(he.side=br,he.needsUpdate=!0,_.renderBufferDirect(Ee,pe,Ce,he,$,Ye),he.side=qa,he.needsUpdate=!0,_.renderBufferDirect(Ee,pe,Ce,he,$,Ye),he.side=Fi):_.renderBufferDirect(Ee,pe,Ce,he,$,Ye),$.onAfterRender(_,pe,Ee,Ce,he,Ye)}function as($,pe,Ee){pe.isScene!==!0&&(pe=De);const Ce=Qe.get($),he=y.state.lights,Ye=y.state.shadowsArray,st=he.state.version,vt=Ae.getParameters($,he.state,Ye,pe,Ee),ct=Ae.getProgramCacheKey(vt);let Bt=Ce.programs;Ce.environment=$.isMeshStandardMaterial?pe.environment:null,Ce.fog=pe.fog,Ce.envMap=($.isMeshStandardMaterial?Ut:Mt).get($.envMap||Ce.environment),Ce.envMapRotation=Ce.environment!==null&&$.envMap===null?pe.environmentRotation:$.envMapRotation,Bt===void 0&&($.addEventListener("dispose",Fe),Bt=new Map,Ce.programs=Bt);let zt=Bt.get(ct);if(zt!==void 0){if(Ce.currentProgram===zt&&Ce.lightsStateVersion===st)return pl($,vt),zt}else vt.uniforms=Ae.getUniforms($),$.onBeforeCompile(vt,_),zt=Ae.acquireProgram(vt,ct),Bt.set(ct,zt),Ce.uniforms=vt.uniforms;const Rt=Ce.uniforms;return(!$.isShaderMaterial&&!$.isRawShaderMaterial||$.clipping===!0)&&(Rt.clippingPlanes=_e.uniform),pl($,vt),Ce.needsLights=ss($),Ce.lightsStateVersion=st,Ce.needsLights&&(Rt.ambientLightColor.value=he.state.ambient,Rt.lightProbe.value=he.state.probe,Rt.directionalLights.value=he.state.directional,Rt.directionalLightShadows.value=he.state.directionalShadow,Rt.spotLights.value=he.state.spot,Rt.spotLightShadows.value=he.state.spotShadow,Rt.rectAreaLights.value=he.state.rectArea,Rt.ltc_1.value=he.state.rectAreaLTC1,Rt.ltc_2.value=he.state.rectAreaLTC2,Rt.pointLights.value=he.state.point,Rt.pointLightShadows.value=he.state.pointShadow,Rt.hemisphereLights.value=he.state.hemi,Rt.directionalShadowMap.value=he.state.directionalShadowMap,Rt.directionalShadowMatrix.value=he.state.directionalShadowMatrix,Rt.spotShadowMap.value=he.state.spotShadowMap,Rt.spotLightMatrix.value=he.state.spotLightMatrix,Rt.spotLightMap.value=he.state.spotLightMap,Rt.pointShadowMap.value=he.state.pointShadowMap,Rt.pointShadowMatrix.value=he.state.pointShadowMatrix),Ce.currentProgram=zt,Ce.uniformsList=null,zt}function fl($){if($.uniformsList===null){const pe=$.currentProgram.getUniforms();$.uniformsList=tm.seqWithValue(pe.seq,$.uniforms)}return $.uniformsList}function pl($,pe){const Ee=Qe.get($);Ee.outputColorSpace=pe.outputColorSpace,Ee.batching=pe.batching,Ee.batchingColor=pe.batchingColor,Ee.instancing=pe.instancing,Ee.instancingColor=pe.instancingColor,Ee.instancingMorph=pe.instancingMorph,Ee.skinning=pe.skinning,Ee.morphTargets=pe.morphTargets,Ee.morphNormals=pe.morphNormals,Ee.morphColors=pe.morphColors,Ee.morphTargetsCount=pe.morphTargetsCount,Ee.numClippingPlanes=pe.numClippingPlanes,Ee.numIntersection=pe.numClipIntersection,Ee.vertexAlphas=pe.vertexAlphas,Ee.vertexTangents=pe.vertexTangents,Ee.toneMapping=pe.toneMapping}function ho($,pe,Ee,Ce,he){pe.isScene!==!0&&(pe=De),ft.resetTextureUnits();const Ye=pe.fog,st=Ce.isMeshStandardMaterial?pe.environment:null,vt=I===null?_.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:eu,ct=(Ce.isMeshStandardMaterial?Ut:Mt).get(Ce.envMap||st),Bt=Ce.vertexColors===!0&&!!Ee.attributes.color&&Ee.attributes.color.itemSize===4,zt=!!Ee.attributes.tangent&&(!!Ce.normalMap||Ce.anisotropy>0),Rt=!!Ee.morphAttributes.position,jt=!!Ee.morphAttributes.normal,xn=!!Ee.morphAttributes.color;let ln=Ga;Ce.toneMapped&&(I===null||I.isXRRenderTarget===!0)&&(ln=_.toneMapping);const An=Ee.morphAttributes.position||Ee.morphAttributes.normal||Ee.morphAttributes.color,kn=An!==void 0?An.length:0,Ft=Qe.get(Ce),Tn=y.state.lights;if(ye===!0&&(te===!0||$!==R)){const Yn=$===R&&Ce.id===T;_e.setState(Ce,$,Yn)}let nn=!1;Ce.version===Ft.__version?(Ft.needsLights&&Ft.lightsStateVersion!==Tn.state.version||Ft.outputColorSpace!==vt||he.isBatchedMesh&&Ft.batching===!1||!he.isBatchedMesh&&Ft.batching===!0||he.isBatchedMesh&&Ft.batchingColor===!0&&he.colorTexture===null||he.isBatchedMesh&&Ft.batchingColor===!1&&he.colorTexture!==null||he.isInstancedMesh&&Ft.instancing===!1||!he.isInstancedMesh&&Ft.instancing===!0||he.isSkinnedMesh&&Ft.skinning===!1||!he.isSkinnedMesh&&Ft.skinning===!0||he.isInstancedMesh&&Ft.instancingColor===!0&&he.instanceColor===null||he.isInstancedMesh&&Ft.instancingColor===!1&&he.instanceColor!==null||he.isInstancedMesh&&Ft.instancingMorph===!0&&he.morphTexture===null||he.isInstancedMesh&&Ft.instancingMorph===!1&&he.morphTexture!==null||Ft.envMap!==ct||Ce.fog===!0&&Ft.fog!==Ye||Ft.numClippingPlanes!==void 0&&(Ft.numClippingPlanes!==_e.numPlanes||Ft.numIntersection!==_e.numIntersection)||Ft.vertexAlphas!==Bt||Ft.vertexTangents!==zt||Ft.morphTargets!==Rt||Ft.morphNormals!==jt||Ft.morphColors!==xn||Ft.toneMapping!==ln||Ft.morphTargetsCount!==kn)&&(nn=!0):(nn=!0,Ft.__version=Ce.version);let tr=Ft.currentProgram;nn===!0&&(tr=as(Ce,pe,he));let fo=!1,Yr=!1,lu=!1;const In=tr.getUniforms(),Kr=Ft.uniforms;if(qe.useProgram(tr.program)&&(fo=!0,Yr=!0,lu=!0),Ce.id!==T&&(T=Ce.id,Yr=!0),fo||R!==$){qe.buffers.depth.getReversed()&&$.reversedDepth!==!0&&($._reversedDepth=!0,$.updateProjectionMatrix()),In.setValue(Y,"projectionMatrix",$.projectionMatrix),In.setValue(Y,"viewMatrix",$.matrixWorldInverse);const Ar=In.map.cameraPosition;Ar!==void 0&&Ar.setValue(Y,fe.setFromMatrixPosition($.matrixWorld)),Xe.logarithmicDepthBuffer&&In.setValue(Y,"logDepthBufFC",2/(Math.log($.far+1)/Math.LN2)),(Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshLambertMaterial||Ce.isMeshBasicMaterial||Ce.isMeshStandardMaterial||Ce.isShaderMaterial)&&In.setValue(Y,"isOrthographic",$.isOrthographicCamera===!0),R!==$&&(R=$,Yr=!0,lu=!0)}if(he.isSkinnedMesh){In.setOptional(Y,he,"bindMatrix"),In.setOptional(Y,he,"bindMatrixInverse");const Yn=he.skeleton;Yn&&(Yn.boneTexture===null&&Yn.computeBoneTexture(),In.setValue(Y,"boneTexture",Yn.boneTexture,ft))}he.isBatchedMesh&&(In.setOptional(Y,he,"batchingTexture"),In.setValue(Y,"batchingTexture",he._matricesTexture,ft),In.setOptional(Y,he,"batchingIdTexture"),In.setValue(Y,"batchingIdTexture",he._indirectTexture,ft),In.setOptional(Y,he,"batchingColorTexture"),he._colorsTexture!==null&&In.setValue(Y,"batchingColorTexture",he._colorsTexture,ft));const Rr=Ee.morphAttributes;if((Rr.position!==void 0||Rr.normal!==void 0||Rr.color!==void 0)&&Oe.update(he,Ee,tr),(Yr||Ft.receiveShadow!==he.receiveShadow)&&(Ft.receiveShadow=he.receiveShadow,In.setValue(Y,"receiveShadow",he.receiveShadow)),Ce.isMeshGouraudMaterial&&Ce.envMap!==null&&(Kr.envMap.value=ct,Kr.flipEnvMap.value=ct.isCubeTexture&&ct.isRenderTargetTexture===!1?-1:1),Ce.isMeshStandardMaterial&&Ce.envMap===null&&pe.environment!==null&&(Kr.envMapIntensity.value=pe.environmentIntensity),Yr&&(In.setValue(Y,"toneMappingExposure",_.toneMappingExposure),Ft.needsLights&&ml(Kr,lu),Ye&&Ce.fog===!0&&Pe.refreshFogUniforms(Kr,Ye),Pe.refreshMaterialUniforms(Kr,Ce,L,P,y.state.transmissionRenderTarget[$.id]),tm.upload(Y,fl(Ft),Kr,ft)),Ce.isShaderMaterial&&Ce.uniformsNeedUpdate===!0&&(tm.upload(Y,fl(Ft),Kr,ft),Ce.uniformsNeedUpdate=!1),Ce.isSpriteMaterial&&In.setValue(Y,"center",he.center),In.setValue(Y,"modelViewMatrix",he.modelViewMatrix),In.setValue(Y,"normalMatrix",he.normalMatrix),In.setValue(Y,"modelMatrix",he.matrixWorld),Ce.isShaderMaterial||Ce.isRawShaderMaterial){const Yn=Ce.uniformsGroups;for(let Ar=0,cu=Yn.length;Ar<cu;Ar++){const rn=Yn[Ar];Nt.update(rn,tr),Nt.bind(rn,tr)}}return tr}function ml($,pe){$.ambientLightColor.needsUpdate=pe,$.lightProbe.needsUpdate=pe,$.directionalLights.needsUpdate=pe,$.directionalLightShadows.needsUpdate=pe,$.pointLights.needsUpdate=pe,$.pointLightShadows.needsUpdate=pe,$.spotLights.needsUpdate=pe,$.spotLightShadows.needsUpdate=pe,$.rectAreaLights.needsUpdate=pe,$.hemisphereLights.needsUpdate=pe}function ss($){return $.isMeshLambertMaterial||$.isMeshToonMaterial||$.isMeshPhongMaterial||$.isMeshStandardMaterial||$.isShadowMaterial||$.isShaderMaterial&&$.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return A},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function($,pe,Ee){const Ce=Qe.get($);Ce.__autoAllocateDepthBuffer=$.resolveDepthBuffer===!1,Ce.__autoAllocateDepthBuffer===!1&&(Ce.__useRenderToTexture=!1),Qe.get($.texture).__webglTexture=pe,Qe.get($.depthTexture).__webglTexture=Ce.__autoAllocateDepthBuffer?void 0:Ee,Ce.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function($,pe){const Ee=Qe.get($);Ee.__webglFramebuffer=pe,Ee.__useDefaultFramebuffer=pe===void 0};const _g=Y.createFramebuffer();this.setRenderTarget=function($,pe=0,Ee=0){I=$,C=pe,A=Ee;let Ce=!0,he=null,Ye=!1,st=!1;if($){const ct=Qe.get($);if(ct.__useDefaultFramebuffer!==void 0)qe.bindFramebuffer(Y.FRAMEBUFFER,null),Ce=!1;else if(ct.__webglFramebuffer===void 0)ft.setupRenderTarget($);else if(ct.__hasExternalTextures)ft.rebindTextures($,Qe.get($.texture).__webglTexture,Qe.get($.depthTexture).__webglTexture);else if($.depthBuffer){const Rt=$.depthTexture;if(ct.__boundDepthTexture!==Rt){if(Rt!==null&&Qe.has(Rt)&&($.width!==Rt.image.width||$.height!==Rt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ft.setupDepthRenderbuffer($)}}const Bt=$.texture;(Bt.isData3DTexture||Bt.isDataArrayTexture||Bt.isCompressedArrayTexture)&&(st=!0);const zt=Qe.get($).__webglFramebuffer;$.isWebGLCubeRenderTarget?(Array.isArray(zt[pe])?he=zt[pe][Ee]:he=zt[pe],Ye=!0):$.samples>0&&ft.useMultisampledRTT($)===!1?he=Qe.get($).__webglMultisampledFramebuffer:Array.isArray(zt)?he=zt[Ee]:he=zt,N.copy($.viewport),O.copy($.scissor),V=$.scissorTest}else N.copy(z).multiplyScalar(L).floor(),O.copy(q).multiplyScalar(L).floor(),V=re;if(Ee!==0&&(he=_g),qe.bindFramebuffer(Y.FRAMEBUFFER,he)&&Ce&&qe.drawBuffers($,he),qe.viewport(N),qe.scissor(O),qe.setScissorTest(V),Ye){const ct=Qe.get($.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_CUBE_MAP_POSITIVE_X+pe,ct.__webglTexture,Ee)}else if(st){const ct=pe;for(let Bt=0;Bt<$.textures.length;Bt++){const zt=Qe.get($.textures[Bt]);Y.framebufferTextureLayer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0+Bt,zt.__webglTexture,Ee,ct)}}else if($!==null&&Ee!==0){const ct=Qe.get($.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,ct.__webglTexture,Ee)}T=-1},this.readRenderTargetPixels=function($,pe,Ee,Ce,he,Ye,st,vt=0){if(!($&&$.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ct=Qe.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&st!==void 0&&(ct=ct[st]),ct){qe.bindFramebuffer(Y.FRAMEBUFFER,ct);try{const Bt=$.textures[vt],zt=Bt.format,Rt=Bt.type;if(!Xe.textureFormatReadable(zt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Xe.textureTypeReadable(Rt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=$.width-Ce&&Ee>=0&&Ee<=$.height-he&&($.textures.length>1&&Y.readBuffer(Y.COLOR_ATTACHMENT0+vt),Y.readPixels(pe,Ee,Ce,he,nt.convert(zt),nt.convert(Rt),Ye))}finally{const Bt=I!==null?Qe.get(I).__webglFramebuffer:null;qe.bindFramebuffer(Y.FRAMEBUFFER,Bt)}}},this.readRenderTargetPixelsAsync=async function($,pe,Ee,Ce,he,Ye,st,vt=0){if(!($&&$.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ct=Qe.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&st!==void 0&&(ct=ct[st]),ct)if(pe>=0&&pe<=$.width-Ce&&Ee>=0&&Ee<=$.height-he){qe.bindFramebuffer(Y.FRAMEBUFFER,ct);const Bt=$.textures[vt],zt=Bt.format,Rt=Bt.type;if(!Xe.textureFormatReadable(zt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Xe.textureTypeReadable(Rt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const jt=Y.createBuffer();Y.bindBuffer(Y.PIXEL_PACK_BUFFER,jt),Y.bufferData(Y.PIXEL_PACK_BUFFER,Ye.byteLength,Y.STREAM_READ),$.textures.length>1&&Y.readBuffer(Y.COLOR_ATTACHMENT0+vt),Y.readPixels(pe,Ee,Ce,he,nt.convert(zt),nt.convert(Rt),0);const xn=I!==null?Qe.get(I).__webglFramebuffer:null;qe.bindFramebuffer(Y.FRAMEBUFFER,xn);const ln=Y.fenceSync(Y.SYNC_GPU_COMMANDS_COMPLETE,0);return Y.flush(),await HH(Y,ln,4),Y.bindBuffer(Y.PIXEL_PACK_BUFFER,jt),Y.getBufferSubData(Y.PIXEL_PACK_BUFFER,0,Ye),Y.deleteBuffer(jt),Y.deleteSync(ln),Ye}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function($,pe=null,Ee=0){const Ce=Math.pow(2,-Ee),he=Math.floor($.image.width*Ce),Ye=Math.floor($.image.height*Ce),st=pe!==null?pe.x:0,vt=pe!==null?pe.y:0;ft.setTexture2D($,0),Y.copyTexSubImage2D(Y.TEXTURE_2D,Ee,0,0,st,vt,he,Ye),qe.unbindTexture()};const zd=Y.createFramebuffer(),Wd=Y.createFramebuffer();this.copyTextureToTexture=function($,pe,Ee=null,Ce=null,he=0,Ye=null){Ye===null&&(he!==0?(ud("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Ye=he,he=0):Ye=0);let st,vt,ct,Bt,zt,Rt,jt,xn,ln;const An=$.isCompressedTexture?$.mipmaps[Ye]:$.image;if(Ee!==null)st=Ee.max.x-Ee.min.x,vt=Ee.max.y-Ee.min.y,ct=Ee.isBox3?Ee.max.z-Ee.min.z:1,Bt=Ee.min.x,zt=Ee.min.y,Rt=Ee.isBox3?Ee.min.z:0;else{const Rr=Math.pow(2,-he);st=Math.floor(An.width*Rr),vt=Math.floor(An.height*Rr),$.isDataArrayTexture?ct=An.depth:$.isData3DTexture?ct=Math.floor(An.depth*Rr):ct=1,Bt=0,zt=0,Rt=0}Ce!==null?(jt=Ce.x,xn=Ce.y,ln=Ce.z):(jt=0,xn=0,ln=0);const kn=nt.convert(pe.format),Ft=nt.convert(pe.type);let Tn;pe.isData3DTexture?(ft.setTexture3D(pe,0),Tn=Y.TEXTURE_3D):pe.isDataArrayTexture||pe.isCompressedArrayTexture?(ft.setTexture2DArray(pe,0),Tn=Y.TEXTURE_2D_ARRAY):(ft.setTexture2D(pe,0),Tn=Y.TEXTURE_2D),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,pe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,pe.unpackAlignment);const nn=Y.getParameter(Y.UNPACK_ROW_LENGTH),tr=Y.getParameter(Y.UNPACK_IMAGE_HEIGHT),fo=Y.getParameter(Y.UNPACK_SKIP_PIXELS),Yr=Y.getParameter(Y.UNPACK_SKIP_ROWS),lu=Y.getParameter(Y.UNPACK_SKIP_IMAGES);Y.pixelStorei(Y.UNPACK_ROW_LENGTH,An.width),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,An.height),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,Bt),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,zt),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,Rt);const In=$.isDataArrayTexture||$.isData3DTexture,Kr=pe.isDataArrayTexture||pe.isData3DTexture;if($.isDepthTexture){const Rr=Qe.get($),Yn=Qe.get(pe),Ar=Qe.get(Rr.__renderTarget),cu=Qe.get(Yn.__renderTarget);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,Ar.__webglFramebuffer),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,cu.__webglFramebuffer);for(let rn=0;rn<ct;rn++)In&&(Y.framebufferTextureLayer(Y.READ_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Qe.get($).__webglTexture,he,Rt+rn),Y.framebufferTextureLayer(Y.DRAW_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Qe.get(pe).__webglTexture,Ye,ln+rn)),Y.blitFramebuffer(Bt,zt,st,vt,jt,xn,st,vt,Y.DEPTH_BUFFER_BIT,Y.NEAREST);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,null),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,null)}else if(he!==0||$.isRenderTargetTexture||Qe.has($)){const Rr=Qe.get($),Yn=Qe.get(pe);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,zd),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,Wd);for(let Ar=0;Ar<ct;Ar++)In?Y.framebufferTextureLayer(Y.READ_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Rr.__webglTexture,he,Rt+Ar):Y.framebufferTexture2D(Y.READ_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,Rr.__webglTexture,he),Kr?Y.framebufferTextureLayer(Y.DRAW_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Yn.__webglTexture,Ye,ln+Ar):Y.framebufferTexture2D(Y.DRAW_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,Yn.__webglTexture,Ye),he!==0?Y.blitFramebuffer(Bt,zt,st,vt,jt,xn,st,vt,Y.COLOR_BUFFER_BIT,Y.NEAREST):Kr?Y.copyTexSubImage3D(Tn,Ye,jt,xn,ln+Ar,Bt,zt,st,vt):Y.copyTexSubImage2D(Tn,Ye,jt,xn,Bt,zt,st,vt);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,null),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,null)}else Kr?$.isDataTexture||$.isData3DTexture?Y.texSubImage3D(Tn,Ye,jt,xn,ln,st,vt,ct,kn,Ft,An.data):pe.isCompressedArrayTexture?Y.compressedTexSubImage3D(Tn,Ye,jt,xn,ln,st,vt,ct,kn,An.data):Y.texSubImage3D(Tn,Ye,jt,xn,ln,st,vt,ct,kn,Ft,An):$.isDataTexture?Y.texSubImage2D(Y.TEXTURE_2D,Ye,jt,xn,st,vt,kn,Ft,An.data):$.isCompressedTexture?Y.compressedTexSubImage2D(Y.TEXTURE_2D,Ye,jt,xn,An.width,An.height,kn,An.data):Y.texSubImage2D(Y.TEXTURE_2D,Ye,jt,xn,st,vt,kn,Ft,An);Y.pixelStorei(Y.UNPACK_ROW_LENGTH,nn),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,tr),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,fo),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,Yr),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,lu),Ye===0&&pe.generateMipmaps&&Y.generateMipmap(Tn),qe.unbindTexture()},this.initRenderTarget=function($){Qe.get($).__webglFramebuffer===void 0&&ft.setupRenderTarget($)},this.initTexture=function($){$.isCubeTexture?ft.setTextureCube($,0):$.isData3DTexture?ft.setTexture3D($,0):$.isDataArrayTexture||$.isCompressedArrayTexture?ft.setTexture2DArray($,0):ft.setTexture2D($,0),qe.unbindTexture()},this.resetState=function(){C=0,A=0,I=null,qe.reset(),tt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ua}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=gn._getDrawingBufferColorSpace(e),t.unpackColorSpace=gn._getUnpackColorSpace()}}var Ob=1/1e3,rX=1e3,iX=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(n){typeof document<"u"&&document.hidden!==void 0&&(n?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=n)}get delta(){return this._delta*Ob}get fixedDelta(){return this._fixedDelta*Ob}set fixedDelta(n){this._fixedDelta=n*rX}get elapsed(){return this._elapsed*Ob}update(n){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(n!==void 0?n:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(n){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},oX=(()=>{const n=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new uu;return t.setAttribute("position",new io(n,3)),t.setAttribute("uv",new io(e,2)),t})(),Wo=class dw{static get fullscreenGeometry(){return oX}constructor(e="Pass",t=new cw,r=new X_){this.name=e,this.renderer=null,this.scene=t,this.camera=r,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Io(dw.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new cw),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Fd){}render(e,t,r,i,o){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,r){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof ri||t instanceof Qc||t instanceof jr||t instanceof dw)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},aX=class extends Wo{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(n,e,t,r,i){const o=n.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},sX=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,tA="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",nA=class extends Xr{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new fn(null),depthBuffer:new fn(null),channelWeights:new fn(null),opacity:new fn(1)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:sX,vertexShader:tA}),this.depthFunc=Wm}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(n){const e=n!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){const e=n!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=n}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(n){n!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=n):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(n){this.uniforms.inputBuffer.value=n}getOpacity(n){return this.uniforms.opacity.value}setOpacity(n){this.uniforms.opacity.value=n}},uX=class extends Wo{constructor(n,e=!0){super("CopyPass"),this.fullscreenMaterial=new nA,this.needsSwap=!1,this.renderTarget=n,n===void 0&&(this.renderTarget=new ri(1,1,{minFilter:vi,magFilter:vi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(n){this.autoResize=n}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(n){this.autoResize=n}render(n,e,t,r,i){this.fullscreenMaterial.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){this.autoResize&&this.renderTarget.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==$r?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":n!==null&&n.outputColorSpace===Cn&&(this.renderTarget.texture.colorSpace=Cn))}},Ck=new Sn,rA=class extends Wo{constructor(n=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=n,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(n,e,t){this.color=n,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(n){this.overrideClearColor=n}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(n){this.overrideClearAlpha=n}render(n,e,t,r,i){const o=this.overrideClearColor,a=this.overrideClearAlpha,s=n.getClearAlpha(),u=o!==null,l=a>=0;u?(n.getClearColor(Ck),n.setClearColor(o,l?a:s)):l&&n.setClearAlpha(a),n.setRenderTarget(this.renderToScreen?null:e),n.clear(this.color,this.depth,this.stencil),u?n.setClearColor(Ck,s):l&&n.setClearAlpha(s)}},lX=class extends Wo{constructor(n,e){super("MaskPass",n,e),this.needsSwap=!1,this.clearPass=new rA(!1,!1,!0),this.inverse=!1}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get inverted(){return this.inverse}set inverted(n){this.inverse=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(n){this.inverted=n}render(n,e,t,r,i){const o=n.getContext(),a=n.state.buffers,s=this.scene,u=this.camera,l=this.clearPass,c=this.inverted?0:1,h=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,c,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(n,null):(l.render(n,e),l.render(n,t))),this.renderToScreen?(n.setRenderTarget(null),n.render(s,u)):(n.setRenderTarget(e),n.render(s,u),n.setRenderTarget(t),n.render(s,u)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},cX=class{constructor(n=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:r=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,i,r),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new uX,this.depthTexture=null,this.passes=[],this.timer=new iX,this.autoRenderToScreen=!0,this.setRenderer(n)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(n){const e=this.inputBuffer,t=this.multisampling;t>0&&n>0?(this.inputBuffer.samples=n,this.outputBuffer.samples=n,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==n&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,n),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(n){if(this.renderer=n,n!==null){const e=n.getSize(new Wt),t=n.getContext().getContextAttributes().alpha,r=this.inputBuffer.texture.type;r===$r&&n.outputColorSpace===Cn&&(this.inputBuffer.texture.colorSpace=Cn,this.outputBuffer.texture.colorSpace=Cn,this.inputBuffer.dispose(),this.outputBuffer.dispose()),n.autoClear=!1,this.setSize(e.width,e.height);for(const i of this.passes)i.initialize(n,t,r)}}replaceRenderer(n,e=!0){const t=this.renderer,r=t.domElement.parentNode;return this.setRenderer(n),e&&r!==null&&(r.removeChild(t.domElement),r.appendChild(n.domElement)),t}createDepthTexture(){const n=this.depthTexture=new $_;return this.inputBuffer.depthTexture=n,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(n.format=Vc,n.type=Gc):n.type=Zs,n}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const n of this.passes)n.setDepthTexture(null)}}createBuffer(n,e,t,r){const i=this.renderer,o=i===null?new Wt:i.getDrawingBufferSize(new Wt),a={minFilter:vi,magFilter:vi,stencilBuffer:e,depthBuffer:n,type:t},s=new ri(o.width,o.height,a);return r>0&&(s.samples=r),t===$r&&i!==null&&i.outputColorSpace===Cn&&(s.texture.colorSpace=Cn),s.texture.name="EffectComposer.Buffer",s.texture.generateMipmaps=!1,s}setMainScene(n){for(const e of this.passes)e.mainScene=n}setMainCamera(n){for(const e of this.passes)e.mainCamera=n}addPass(n,e){const t=this.passes,r=this.renderer,i=r.getDrawingBufferSize(new Wt),o=r.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(n.setRenderer(r),n.setSize(i.width,i.height),n.initialize(r,o,a),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),n.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,n):t.push(n),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),n.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const s=this.createDepthTexture();for(n of t)n.setDepthTexture(s)}else n.setDepthTexture(this.depthTexture)}removePass(n){const e=this.passes,t=e.indexOf(n);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const o=(s,u)=>s||u.needsDepthTexture;e.reduce(o,!1)||(n.getDepthTexture()===this.depthTexture&&n.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(n.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const n=this.passes;this.deleteDepthTexture(),n.length>0&&(this.autoRenderToScreen&&(n[n.length-1].renderToScreen=!1),this.passes=[])}render(n){const e=this.renderer,t=this.copyPass;let r=this.inputBuffer,i=this.outputBuffer,o=!1,a,s,u;n===void 0&&(this.timer.update(),n=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(e,r,i,n,o),l.needsSwap&&(o&&(t.renderToScreen=l.renderToScreen,a=e.getContext(),s=e.state.buffers.stencil,s.setFunc(a.NOTEQUAL,1,4294967295),t.render(e,r,i,n,o),s.setFunc(a.EQUAL,1,4294967295)),u=r,r=i,i=u),l instanceof lX?o=!0:l instanceof aX&&(o=!1))}setSize(n,e,t){const r=this.renderer,i=r.getSize(new Wt);(n===void 0||e===void 0)&&(n=i.width,e=i.height),(i.width!==n||i.height!==e)&&r.setSize(n,e,t);const o=r.getDrawingBufferSize(new Wt);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const n of this.passes)n.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Wo.fullscreenGeometry.dispose()}},$s={NONE:0,DEPTH:1,CONVOLUTION:2},vn={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},hX=class{constructor(){this.shaderParts=new Map([[vn.FRAGMENT_HEAD,null],[vn.FRAGMENT_MAIN_UV,null],[vn.FRAGMENT_MAIN_IMAGE,null],[vn.VERTEX_HEAD,null],[vn.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=$s.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=eu}},Lb=!1,Tk=class{constructor(n=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(n),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Fi:t=this.materialsFlatShadedDoubleSide;break;case br:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Fi:t=this.materialsDoubleSide;break;case br:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(n){if(!(n instanceof Xr))return n.clone();const e=n.uniforms,t=new Map;for(const i in e){const o=e[i].value;o.isRenderTargetTexture&&(e[i].value=null,t.set(i,o))}const r=n.clone();for(const i of t)e[i[0]].value=i[1],r.uniforms[i[0]].value=i[1];return r}setMaterial(n){if(this.disposeMaterials(),this.material=n,n!==null){const e=this.materials=[this.cloneMaterial(n),this.cloneMaterial(n),this.cloneMaterial(n)];for(const t of e)t.uniforms=Object.assign({},n.uniforms),t.side=qa;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=br,r}),this.materialsDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.side=Fi,r}),this.materialsFlatShaded=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r}),this.materialsFlatShadedBackSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=br,r}),this.materialsFlatShadedDoubleSide=e.map(t=>{const r=this.cloneMaterial(t);return r.uniforms=Object.assign({},n.uniforms),r.flatShading=!0,r.side=Fi,r})}}render(n,e,t){const r=n.shadowMap.enabled;if(n.shadowMap.enabled=!1,Lb){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),n.render(e,t);for(const o of i)o[0].material=o[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,n.render(e,t),e.overrideMaterial=i}n.shadowMap.enabled=r}disposeMaterials(){if(this.material!==null){const n=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of n)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return Lb}static set workaroundEnabled(n){Lb=n}},Fs=-1,la=class extends is{constructor(n,e=Fs,t=Fs,r=1){super(),this.resizable=n,this.baseSize=new Wt(1,1),this.preferredSize=new Wt(e,t),this.target=this.preferredSize,this.s=r,this.effectiveSize=new Wt,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const n=this.baseSize,e=this.preferredSize,t=this.effectiveSize,r=this.scale;e.width!==Fs?t.width=e.width:e.height!==Fs?t.width=Math.round(e.height*(n.width/Math.max(n.height,1))):t.width=Math.round(n.width*r),e.height!==Fs?t.height=e.height:e.width!==Fs?t.height=Math.round(e.width/Math.max(n.width/Math.max(n.height,1),1)):t.height=Math.round(n.height*r)}get width(){return this.effectiveSize.width}set width(n){this.preferredWidth=n}get height(){return this.effectiveSize.height}set height(n){this.preferredHeight=n}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(n){this.s!==n&&(this.s=n,this.preferredSize.setScalar(Fs),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(n){this.scale=n}get baseWidth(){return this.baseSize.width}set baseWidth(n){this.baseSize.width!==n&&(this.baseSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(n){this.baseWidth=n}get baseHeight(){return this.baseSize.height}set baseHeight(n){this.baseSize.height!==n&&(this.baseSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(n){this.baseHeight=n}setBaseSize(n,e){(this.baseSize.width!==n||this.baseSize.height!==e)&&(this.baseSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(n){this.preferredSize.width!==n&&(this.preferredSize.width=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(n){this.preferredWidth=n}get preferredHeight(){return this.preferredSize.height}set preferredHeight(n){this.preferredSize.height!==n&&(this.preferredSize.height=n,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(n){this.preferredHeight=n}setPreferredSize(n,e){(this.preferredSize.width!==n||this.preferredSize.height!==e)&&(this.preferredSize.set(n,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(n){this.s=n.scale,this.baseSize.set(n.baseWidth,n.baseHeight),this.preferredSize.set(n.preferredWidth,n.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Fs}},un={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},dX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",fX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",pX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",mX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",gX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",vX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",yX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",bX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",wX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",_X="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",xX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",SX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",EX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",kX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",CX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",TX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",MX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",RX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",AX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",IX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",DX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",NX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",PX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",FX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",OX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",LX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",BX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",UX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",zX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",WX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",HX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",GX=new Map([[un.ADD,dX],[un.AVERAGE,fX],[un.COLOR,pX],[un.COLOR_BURN,mX],[un.COLOR_DODGE,gX],[un.DARKEN,vX],[un.DIFFERENCE,yX],[un.DIVIDE,bX],[un.DST,null],[un.EXCLUSION,wX],[un.HARD_LIGHT,_X],[un.HARD_MIX,xX],[un.HUE,SX],[un.INVERT,EX],[un.INVERT_RGB,kX],[un.LIGHTEN,CX],[un.LINEAR_BURN,TX],[un.LINEAR_DODGE,MX],[un.LINEAR_LIGHT,RX],[un.LUMINOSITY,AX],[un.MULTIPLY,IX],[un.NEGATION,DX],[un.NORMAL,NX],[un.OVERLAY,PX],[un.PIN_LIGHT,FX],[un.REFLECT,OX],[un.SATURATION,LX],[un.SCREEN,BX],[un.SOFT_LIGHT,UX],[un.SRC,zX],[un.SUBTRACT,WX],[un.VIVID_LIGHT,HX]]),VX=class extends is{constructor(n,e=1){super(),this._blendFunction=n,this.opacity=new fn(e)}getOpacity(){return this.opacity.value}setOpacity(n){this.opacity.value=n}get blendFunction(){return this._blendFunction}set blendFunction(n){this._blendFunction=n,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(n){this.blendFunction=n}getShaderCode(){return GX.get(this.blendFunction)}},iA=class extends is{constructor(n,e,{attributes:t=$s.NONE,blendFunction:r=un.NORMAL,defines:i=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:s=null}={}){super(),this.name=n,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=s,this.defines=i,this.uniforms=o,this.extensions=a,this.blendMode=new VX(r),this.blendMode.addEventListener("change",u=>this.setChanged()),this._inputColorSpace=eu,this._outputColorSpace=oa}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(n){this._inputColorSpace=n,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(n){this._outputColorSpace=n,this.setChanged()}set mainScene(n){}set mainCamera(n){}getName(){return this.name}setRenderer(n){this.renderer=n}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(n){this.attributes=n,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(n){this.fragmentShader=n,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(n){this.vertexShader=n,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(n,e=Fd){}update(n,e,t){}setSize(n,e){}initialize(n,e,t){}dispose(){for(const n of Object.keys(this)){const e=this[n];(e instanceof ri||e instanceof Qc||e instanceof jr||e instanceof Wo)&&this[n].dispose()}}},K_={MEDIUM:2,LARGE:3},jX=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,qX="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",$X=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],XX=class extends Xr{constructor(n=new Hn){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new fn(null),texelSize:new fn(new Hn),scale:new fn(1),kernel:new fn(0)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:jX,vertexShader:qX}),this.setTexelSize(n.x,n.y),this.kernelSize=K_.MEDIUM}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.inputBuffer=n}get kernelSequence(){return $X[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(n){this.uniforms.scale.value=n}getScale(){return this.uniforms.scale.value}setScale(n){this.uniforms.scale.value=n}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(n){this.uniforms.kernel.value=n}setKernel(n){this.kernel=n}setTexelSize(n,e){this.uniforms.texelSize.value.set(n,e,n*.5,e*.5)}setSize(n,e){const t=1/n,r=1/e;this.uniforms.texelSize.value.set(t,r,t*.5,r*.5)}},YX=class extends Wo{constructor({kernelSize:n=K_.MEDIUM,resolutionScale:e=.5,width:t=la.AUTO_SIZE,height:r=la.AUTO_SIZE,resolutionX:i=t,resolutionY:o=r}={}){super("KawaseBlurPass"),this.renderTargetA=new ri(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new la(this,i,o,e);a.addEventListener("change",s=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new XX,this._blurMaterial.kernelSize=n,this.copyMaterial=new nA}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(n){this._blurMaterial=n}get dithering(){return this.copyMaterial.dithering}set dithering(n){this.copyMaterial.dithering=n}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(n){this.blurMaterial.kernelSize=n}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get scale(){return this.blurMaterial.scale}set scale(n){this.blurMaterial.scale=n}getScale(){return this.blurMaterial.scale}setScale(n){this.blurMaterial.scale=n}getKernelSize(){return this.kernelSize}setKernelSize(n){this.kernelSize=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}render(n,e,t,r,i){const o=this.scene,a=this.camera,s=this.renderTargetA,u=this.renderTargetB,l=this.blurMaterial,c=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,m=c.length;f<m;++f){const g=(f&1)===0?s:u;l.kernel=c[f],l.inputBuffer=h.texture,n.setRenderTarget(g),n.render(o,a),h=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,n.setRenderTarget(this.renderToScreen?null:t),n.render(o,a)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e);const r=t.width,i=t.height;this.renderTargetA.setSize(r,i),this.renderTargetB.setSize(r,i),this.blurMaterial.setSize(n,e)}initialize(n,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==$r?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):n!==null&&n.outputColorSpace===Cn&&(this.renderTargetA.texture.colorSpace=Cn,this.renderTargetB.texture.colorSpace=Cn))}static get AUTO_SIZE(){return la.AUTO_SIZE}},KX=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,JX=class extends Xr{constructor(n=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Nd.replace(/\D+/g,"")},uniforms:{inputBuffer:new fn(null),threshold:new fn(0),smoothing:new fn(1),range:new fn(null)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:KX,vertexShader:tA}),this.colorOutput=n,this.luminanceRange=e}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get threshold(){return this.uniforms.threshold.value}set threshold(n){this.smoothing>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=n}getThreshold(){return this.threshold}setThreshold(n){this.threshold=n}get smoothing(){return this.uniforms.smoothing.value}set smoothing(n){this.threshold>0||n>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=n}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(n){this.smoothing=n}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(n){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(n){n?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(n){return this.colorOutput}setColorOutputEnabled(n){this.colorOutput=n}get useRange(){return this.luminanceRange!==null}set useRange(n){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(n){n!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=n,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(n){this.luminanceRange=n}},QX=class extends Wo{constructor({renderTarget:n,luminanceRange:e,colorOutput:t,resolutionScale:r=1,width:i=la.AUTO_SIZE,height:o=la.AUTO_SIZE,resolutionX:a=i,resolutionY:s=o}={}){super("LuminancePass"),this.fullscreenMaterial=new JX(t,e),this.needsSwap=!1,this.renderTarget=n,this.renderTarget===void 0&&(this.renderTarget=new ri(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const u=this.resolution=new la(this,a,s,r);u.addEventListener("change",l=>this.setSize(u.baseWidth,u.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(n,e,t,r,i){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,n.setRenderTarget(this.renderToScreen?null:this.renderTarget),n.render(this.scene,this.camera)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height)}initialize(n,e,t){t!==void 0&&t!==$r&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},ZX=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,eY="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",tY=class extends Xr{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new fn(null),texelSize:new fn(new Wt)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:ZX,vertexShader:eY})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},nY=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,rY="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",iY=class extends Xr{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new fn(null),supportBuffer:new fn(null),texelSize:new fn(new Wt),radius:new fn(.85)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:nY,vertexShader:rY})}set inputBuffer(n){this.uniforms.inputBuffer.value=n}set supportBuffer(n){this.uniforms.supportBuffer.value=n}get radius(){return this.uniforms.radius.value}set radius(n){this.uniforms.radius.value=n}setSize(n,e){this.uniforms.texelSize.value.set(1/n,1/e)}},oY=class extends Wo{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new ri(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new tY,this.upsamplingMaterial=new iY,this.resolution=new Wt}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(n){if(this.levels!==n){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<n;++t){const r=e.clone();r.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(r)}this.upsamplingMipmaps.push(e);for(let t=1,r=n-1;t<r;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(n){this.upsamplingMaterial.radius=n}render(n,e,t,r,i){const{scene:o,camera:a}=this,{downsamplingMaterial:s,upsamplingMaterial:u}=this,{downsamplingMipmaps:l,upsamplingMipmaps:c}=this;let h=e;this.fullscreenMaterial=s;for(let f=0,m=l.length;f<m;++f){const g=l[f];s.setSize(h.width,h.height),s.inputBuffer=h.texture,n.setRenderTarget(g),n.render(o,a),h=g}this.fullscreenMaterial=u;for(let f=c.length-1;f>=0;--f){const m=c[f];u.setSize(h.width,h.height),u.inputBuffer=h.texture,u.supportBuffer=l[f].texture,n.setRenderTarget(m),n.render(o,a),h=m}}setSize(n,e){const t=this.resolution;t.set(n,e);let r=t.width,i=t.height;for(let o=0,a=this.downsamplingMipmaps.length;o<a;++o)r=Math.round(r*.5),i=Math.round(i*.5),this.downsamplingMipmaps[o].setSize(r,i),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(r,i)}initialize(n,e,t){if(t!==void 0){const r=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of r)i.texture.type=t;if(t!==$r)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(n!==null&&n.outputColorSpace===Cn)for(const i of r)i.texture.colorSpace=Cn}}dispose(){super.dispose();for(const n of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))n.dispose()}},aY=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,sY=class extends iA{constructor({blendFunction:n=un.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:r=!0,intensity:i=1,radius:o=.85,levels:a=8,kernelSize:s=K_.LARGE,resolutionScale:u=.5,width:l=la.AUTO_SIZE,height:c=la.AUTO_SIZE,resolutionX:h=l,resolutionY:f=c}={}){super("BloomEffect",aY,{blendFunction:n,uniforms:new Map([["map",new fn(null)],["intensity",new fn(i)]])}),this.renderTarget=new ri(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new YX({kernelSize:s}),this.luminancePass=new QX({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new oY,this.mipmapBlurPass.enabled=r,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=r?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new la(this,h,f,u);m.addEventListener("change",g=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(n){this.resolution.preferredWidth=n}get height(){return this.resolution.height}set height(n){this.resolution.preferredHeight=n}get dithering(){return this.blurPass.dithering}set dithering(n){this.blurPass.dithering=n}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(n){this.blurPass.kernelSize=n}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(n){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(n){this.uniforms.get("intensity").value=n}getIntensity(){return this.intensity}setIntensity(n){this.intensity=n}getResolutionScale(){return this.resolution.scale}setResolutionScale(n){this.resolution.scale=n}update(n,e,t){const r=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(n,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,i.renderTarget):this.blurPass.render(n,i.renderTarget,r)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(n,e):this.blurPass.render(n,e,r)}setSize(n,e){const t=this.resolution;t.setBaseSize(n,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(n,e),this.mipmapBlurPass.setSize(n,e)}initialize(n,e,t){this.blurPass.initialize(n,e,t),this.luminancePass.initialize(n,e,t),this.mipmapBlurPass.initialize(n,e,t),t!==void 0&&(this.renderTarget.texture.type=t,n!==null&&n.outputColorSpace===Cn&&(this.renderTarget.texture.colorSpace=Cn))}},uY=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,lY="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",cY=class extends iA{constructor({offset:n=new Wt(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",uY,{vertexShader:lY,attributes:$s.CONVOLUTION,uniforms:new Map([["offset",new fn(n)],["modulationOffset",new fn(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(n){this.uniforms.get("offset").value=n}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(n){n?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(n){this.uniforms.get("modulationOffset").value=n}getOffset(){return this.offset}setOffset(n){this.offset=n}},hY=class extends Wo{constructor(n,e,t=null){super("RenderPass",n,e),this.needsSwap=!1,this.clearPass=new rA,this.overrideMaterialManager=t===null?null:new Tk(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(n){this.scene=n}set mainCamera(n){this.camera=n}get renderToScreen(){return super.renderToScreen}set renderToScreen(n){super.renderToScreen=n,this.clearPass.renderToScreen=n}get overrideMaterial(){const n=this.overrideMaterialManager;return n!==null?n.material:null}set overrideMaterial(n){const e=this.overrideMaterialManager;n!==null?e!==null?e.setMaterial(n):this.overrideMaterialManager=new Tk(n):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(n){this.overrideMaterial=n}get clear(){return this.clearPass.enabled}set clear(n){this.clearPass.enabled=n}getSelection(){return this.selection}setSelection(n){this.selection=n}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(n){this.ignoreBackground=n}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(n){this.skipShadowMapUpdate=n}getClearPass(){return this.clearPass}render(n,e,t,r,i){const o=this.scene,a=this.camera,s=this.selection,u=a.layers.mask,l=o.background,c=n.shadowMap.autoUpdate,h=this.renderToScreen?null:e;s!==null&&a.layers.set(s.getLayer()),this.skipShadowMapUpdate&&(n.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(n,e),n.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(n,o,a):n.render(o,a),a.layers.mask=u,o.background=l,n.shadowMap.autoUpdate=c}},dY=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,fY="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",pY=class extends Xr{constructor(n,e,t,r,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Nd.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new fn(null),depthBuffer:new fn(null),resolution:new fn(new Wt),texelSize:new fn(new Wt),cameraNear:new fn(.3),cameraFar:new fn(1e3),aspect:new fn(1),time:new fn(0)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),n&&this.setShaderParts(n),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(r)}set inputBuffer(n){this.uniforms.inputBuffer.value=n}setInputBuffer(n){this.uniforms.inputBuffer.value=n}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(n){this.uniforms.depthBuffer.value=n}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(n){this.defines.DEPTH_PACKING=n.toFixed(0),this.needsUpdate=!0}setDepthBuffer(n,e=Fd){this.depthBuffer=n,this.depthPacking=e}setShaderData(n){this.setShaderParts(n.shaderParts),this.setDefines(n.defines),this.setUniforms(n.uniforms),this.setExtensions(n.extensions)}setShaderParts(n){return this.fragmentShader=dY.replace(vn.FRAGMENT_HEAD,n.get(vn.FRAGMENT_HEAD)||"").replace(vn.FRAGMENT_MAIN_UV,n.get(vn.FRAGMENT_MAIN_UV)||"").replace(vn.FRAGMENT_MAIN_IMAGE,n.get(vn.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=fY.replace(vn.VERTEX_HEAD,n.get(vn.VERTEX_HEAD)||"").replace(vn.VERTEX_MAIN_SUPPORT,n.get(vn.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(n){for(const e of n.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(n){for(const e of n.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(n){this.extensions={};for(const e of n)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(n){this.encodeOutput!==n&&(n?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(n){return this.encodeOutput}setOutputEncodingEnabled(n){this.encodeOutput=n}get time(){return this.uniforms.time.value}set time(n){this.uniforms.time.value=n}setDeltaTime(n){this.uniforms.time.value+=n}adoptCameraSettings(n){this.copyCameraSettings(n)}copyCameraSettings(n){n&&(this.uniforms.cameraNear.value=n.near,this.uniforms.cameraFar.value=n.far,n instanceof eo?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(n,e){const t=this.uniforms;t.resolution.value.set(n,e),t.texelSize.value.set(1/n,1/e),t.aspect.value=n/e}static get Section(){return vn}};function Mk(n,e,t){for(const r of e){const i="$1"+n+r.charAt(0).toUpperCase()+r.slice(1),o=new RegExp("([^\\.])(\\b"+r+"\\b)","g");for(const a of t.entries())a[1]!==null&&t.set(a[0],a[1].replace(o,i))}}function mY(n,e,t){let r=e.getFragmentShader(),i=e.getVertexShader();const o=r!==void 0&&/mainImage/.test(r),a=r!==void 0&&/mainUv/.test(r);if(t.attributes|=e.getAttributes(),r===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&(t.attributes&$s.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!o&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const s=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,u=t.shaderParts;let l=u.get(vn.FRAGMENT_HEAD)||"",c=u.get(vn.FRAGMENT_MAIN_UV)||"",h=u.get(vn.FRAGMENT_MAIN_IMAGE)||"",f=u.get(vn.VERTEX_HEAD)||"",m=u.get(vn.VERTEX_MAIN_SUPPORT)||"";const g=new Set,w=new Set;if(a&&(c+=`	${n}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const x=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);m+=`	${n}MainSupport(`,m+=x?`vUv);
`:`);
`;for(const E of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const _ of E[1].split(/\s*,\s*/))t.varyings.add(_),g.add(_),w.add(_);for(const E of i.matchAll(s))w.add(E[1])}for(const x of r.matchAll(s))w.add(x[1]);for(const x of e.defines.keys())w.add(x.replace(/\([\w\s,]*\)/g,""));for(const x of e.uniforms.keys())w.add(x);w.delete("while"),w.delete("for"),w.delete("if"),e.uniforms.forEach((x,E)=>t.uniforms.set(n+E.charAt(0).toUpperCase()+E.slice(1),x)),e.defines.forEach((x,E)=>t.defines.set(n+E.charAt(0).toUpperCase()+E.slice(1),x));const v=new Map([["fragment",r],["vertex",i]]);Mk(n,w,t.defines),Mk(n,w,v),r=v.get("fragment"),i=v.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),o){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===Cn?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==oa?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const x=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${n}MainImage(color0, UV, `,(t.attributes&$s.DEPTH)!==0&&x.test(r)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const E=n+"BlendOpacity";t.uniforms.set(E,y.opacity),h+=`color0 = blend${y.blendFunction}(color0, color1, ${E});

	`,l+=`uniform float ${E};

`}if(l+=r+`
`,i!==null&&(f+=i+`
`),u.set(vn.FRAGMENT_HEAD,l),u.set(vn.FRAGMENT_MAIN_UV,c),u.set(vn.FRAGMENT_MAIN_IMAGE,h),u.set(vn.VERTEX_HEAD,f),u.set(vn.VERTEX_MAIN_SUPPORT,m),e.extensions!==null)for(const x of e.extensions)t.extensions.add(x)}}var gY=class extends Wo{constructor(n,...e){super("EffectPass"),this.fullscreenMaterial=new pY(null,null,null,n),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(n){for(const e of this.effects)e.mainScene=n}set mainCamera(n){this.fullscreenMaterial.copyCameraSettings(n);for(const e of this.effects)e.mainCamera=n}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(n){this.fullscreenMaterial.encodeOutput=n}get dithering(){return this.fullscreenMaterial.dithering}set dithering(n){const e=this.fullscreenMaterial;e.dithering=n,e.needsUpdate=!0}setEffects(n){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=n.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const n=new hX;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===un.DST)n.attributes|=a.getAttributes()&$s.DEPTH;else{if((n.attributes&a.getAttributes()&$s.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${a.name})`);mY("e"+e++,a,n)}let t=n.shaderParts.get(vn.FRAGMENT_HEAD),r=n.shaderParts.get(vn.FRAGMENT_MAIN_IMAGE),i=n.shaderParts.get(vn.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const a of n.blendModes.values())t+=a.getShaderCode().replace(o,`blend${a.blendFunction}`)+`
`;(n.attributes&$s.DEPTH)!==0?(n.readDepth&&(r=`float depth = readDepth(UV);

	`+r),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,n.colorSpace===Cn&&(r+=`color0 = sRGBToLinear(color0);
	`),n.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,n.defines.set("UV","transformedUv")):n.defines.set("UV","vUv"),n.shaderParts.set(vn.FRAGMENT_HEAD,t),n.shaderParts.set(vn.FRAGMENT_MAIN_IMAGE,r),n.shaderParts.set(vn.FRAGMENT_MAIN_UV,i);for(const[a,s]of n.shaderParts)s!==null&&n.shaderParts.set(a,s.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(n)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(n,e=Fd){this.fullscreenMaterial.depthBuffer=n,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(n,e)}render(n,e,t,r,i){for(const o of this.effects)o.update(n,e,r);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,o.time+=r*this.timeScale,n.setRenderTarget(this.renderToScreen?null:t),n.render(this.scene,this.camera)}}setSize(n,e){this.fullscreenMaterial.setSize(n,e);for(const t of this.effects)t.setSize(n,e)}initialize(n,e,t){this.renderer=n;for(const r of this.effects)r.initialize(n,e,t);this.updateMaterial(),t!==void 0&&t!==$r&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const n of this.effects)n.removeEventListener("change",this.listener),n.dispose()}handleEvent(n){switch(n.type){case"change":this.recompile();break}}};const vY=`
varying vec2 vUv;
void main(){
  vUv = uv;
  gl_Position = vec4(position.xy, 0.0, 1.0);
}
`,yY=`
precision highp float;
uniform vec3 iResolution;
uniform float iTime;
uniform vec2 uSkew;
uniform float uTilt;
uniform float uYaw;
uniform float uLineThickness;
uniform vec3 uLinesColor;
uniform vec3 uScanColor;
uniform float uGridScale;
uniform float uLineStyle;
uniform float uLineJitter;
uniform float uScanOpacity;
uniform float uScanDirection;
uniform float uNoise;
uniform float uBloomOpacity;
uniform float uScanGlow;
uniform float uScanSoftness;
uniform float uPhaseTaper;
uniform float uScanDuration;
uniform float uScanDelay;
varying vec2 vUv;

uniform float uScanStarts[8];
uniform float uScanCount;

const int MAX_SCANS = 8;

float smoother01(float a, float b, float x){
  float t = clamp((x - a) / max(1e-5, (b - a)), 0.0, 1.0);
  return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}

void mainImage(out vec4 fragColor, in vec2 fragCoord)
{
    vec2 p = (2.0 * fragCoord - iResolution.xy) / iResolution.y;

    vec3 ro = vec3(0.0);
    vec3 rd = normalize(vec3(p, 2.0));

    float cR = cos(uTilt), sR = sin(uTilt);
    rd.xy = mat2(cR, -sR, sR, cR) * rd.xy;

    float cY = cos(uYaw), sY = sin(uYaw);
    rd.xz = mat2(cY, -sY, sY, cY) * rd.xz;

    vec2 skew = clamp(uSkew, vec2(-0.7), vec2(0.7));
    rd.xy += skew * rd.z;

    vec3 color = vec3(0.0);
  float minT = 1e20;
  float gridScale = max(1e-5, uGridScale);
    float fadeStrength = 2.0;
    vec2 gridUV = vec2(0.0);

  float hitIsY = 1.0;
    for (int i = 0; i < 4; i++)
    {
        float isY = float(i < 2);
        float pos = mix(-0.2, 0.2, float(i)) * isY + mix(-0.5, 0.5, float(i - 2)) * (1.0 - isY);
        float num = pos - (isY * ro.y + (1.0 - isY) * ro.x);
        float den = isY * rd.y + (1.0 - isY) * rd.x;
        float t = num / den;
        vec3 h = ro + rd * t;

        float depthBoost = smoothstep(0.0, 3.0, h.z);
        h.xy += skew * 0.15 * depthBoost;

    bool use = t > 0.0 && t < minT;
    gridUV = use ? mix(h.zy, h.xz, isY) / gridScale : gridUV;
    minT = use ? t : minT;
    hitIsY = use ? isY : hitIsY;
    }

    vec3 hit = ro + rd * minT;
    float dist = length(hit - ro);

  float jitterAmt = clamp(uLineJitter, 0.0, 1.0);
  if (jitterAmt > 0.0) {
    vec2 j = vec2(
      sin(gridUV.y * 2.7 + iTime * 1.8),
      cos(gridUV.x * 2.3 - iTime * 1.6)
    ) * (0.15 * jitterAmt);
    gridUV += j;
  }
  float fx = fract(gridUV.x);
  float fy = fract(gridUV.y);
  float ax = min(fx, 1.0 - fx);
  float ay = min(fy, 1.0 - fy);
  float wx = fwidth(gridUV.x);
  float wy = fwidth(gridUV.y);
  float halfPx = max(0.0, uLineThickness) * 0.5;

  float tx = halfPx * wx;
  float ty = halfPx * wy;

  float aax = wx;
  float aay = wy;

  float lineX = 1.0 - smoothstep(tx, tx + aax, ax);
  float lineY = 1.0 - smoothstep(ty, ty + aay, ay);
  if (uLineStyle > 0.5) {
    float dashRepeat = 4.0;
    float dashDuty = 0.5;
    float vy = fract(gridUV.y * dashRepeat);
    float vx = fract(gridUV.x * dashRepeat);
    float dashMaskY = step(vy, dashDuty);
    float dashMaskX = step(vx, dashDuty);
    if (uLineStyle < 1.5) {
      lineX *= dashMaskY;
      lineY *= dashMaskX;
    } else {
      float dotRepeat = 6.0;
      float dotWidth = 0.18;
      float cy = abs(fract(gridUV.y * dotRepeat) - 0.5);
      float cx = abs(fract(gridUV.x * dotRepeat) - 0.5);
      float dotMaskY = 1.0 - smoothstep(dotWidth, dotWidth + fwidth(gridUV.y * dotRepeat), cy);
      float dotMaskX = 1.0 - smoothstep(dotWidth, dotWidth + fwidth(gridUV.x * dotRepeat), cx);
      lineX *= dotMaskY;
      lineY *= dotMaskX;
    }
  }
  float primaryMask = max(lineX, lineY);

  vec2 gridUV2 = (hitIsY > 0.5 ? hit.xz : hit.zy) / gridScale;
  if (jitterAmt > 0.0) {
    vec2 j2 = vec2(
      cos(gridUV2.y * 2.1 - iTime * 1.4),
      sin(gridUV2.x * 2.5 + iTime * 1.7)
    ) * (0.15 * jitterAmt);
    gridUV2 += j2;
  }
  float fx2 = fract(gridUV2.x);
  float fy2 = fract(gridUV2.y);
  float ax2 = min(fx2, 1.0 - fx2);
  float ay2 = min(fy2, 1.0 - fy2);
  float wx2 = fwidth(gridUV2.x);
  float wy2 = fwidth(gridUV2.y);
  float tx2 = halfPx * wx2;
  float ty2 = halfPx * wy2;
  float aax2 = wx2;
  float aay2 = wy2;
  float lineX2 = 1.0 - smoothstep(tx2, tx2 + aax2, ax2);
  float lineY2 = 1.0 - smoothstep(ty2, ty2 + aay2, ay2);
  if (uLineStyle > 0.5) {
    float dashRepeat2 = 4.0;
    float dashDuty2 = 0.5;
    float vy2m = fract(gridUV2.y * dashRepeat2);
    float vx2m = fract(gridUV2.x * dashRepeat2);
    float dashMaskY2 = step(vy2m, dashDuty2);
    float dashMaskX2 = step(vx2m, dashDuty2);
    if (uLineStyle < 1.5) {
      lineX2 *= dashMaskY2;
      lineY2 *= dashMaskX2;
    } else {
      float dotRepeat2 = 6.0;
      float dotWidth2 = 0.18;
      float cy2 = abs(fract(gridUV2.y * dotRepeat2) - 0.5);
      float cx2 = abs(fract(gridUV2.x * dotRepeat2) - 0.5);
      float dotMaskY2 = 1.0 - smoothstep(dotWidth2, dotWidth2 + fwidth(gridUV2.y * dotRepeat2), cy2);
      float dotMaskX2 = 1.0 - smoothstep(dotWidth2, dotWidth2 + fwidth(gridUV2.x * dotRepeat2), cx2);
      lineX2 *= dotMaskY2;
      lineY2 *= dotMaskX2;
    }
  }
    float altMask = max(lineX2, lineY2);

    float edgeDistX = min(abs(hit.x - (-0.5)), abs(hit.x - 0.5));
    float edgeDistY = min(abs(hit.y - (-0.2)), abs(hit.y - 0.2));
    float edgeDist = mix(edgeDistY, edgeDistX, hitIsY);
    float edgeGate = 1.0 - smoothstep(gridScale * 0.5, gridScale * 2.0, edgeDist);
    altMask *= edgeGate;

  float lineMask = max(primaryMask, altMask);

    float fade = exp(-dist * fadeStrength);

    float dur = max(0.05, uScanDuration);
    float del = max(0.0, uScanDelay);
    float scanZMax = 2.0;
    float widthScale = max(0.1, uScanGlow);
    float sigma = max(0.001, 0.18 * widthScale * uScanSoftness);
    float sigmaA = sigma * 2.0;

    float combinedPulse = 0.0;
    float combinedAura = 0.0;

    float cycle = dur + del;
    float tCycle = mod(iTime, cycle);
    float scanPhase = clamp((tCycle - del) / dur, 0.0, 1.0);
    float phase = scanPhase;
    if (uScanDirection > 0.5 && uScanDirection < 1.5) {
      phase = 1.0 - phase;
    } else if (uScanDirection > 1.5) {
      float t2 = mod(max(0.0, iTime - del), 2.0 * dur);
      phase = (t2 < dur) ? (t2 / dur) : (1.0 - (t2 - dur) / dur);
    }
    float scanZ = phase * scanZMax;
    float dz = abs(hit.z - scanZ);
    float lineBand = exp(-0.5 * (dz * dz) / (sigma * sigma));
    float taper = clamp(uPhaseTaper, 0.0, 0.49);
    float headW = taper;
    float tailW = taper;
    float headFade = smoother01(0.0, headW, phase);
    float tailFade = 1.0 - smoother01(1.0 - tailW, 1.0, phase);
    float phaseWindow = headFade * tailFade;
    float pulseBase = lineBand * phaseWindow;
    combinedPulse += pulseBase * clamp(uScanOpacity, 0.0, 1.0);
    float auraBand = exp(-0.5 * (dz * dz) / (sigmaA * sigmaA));
    combinedAura += (auraBand * 0.25) * phaseWindow * clamp(uScanOpacity, 0.0, 1.0);

    for (int i = 0; i < MAX_SCANS; i++) {
      if (float(i) >= uScanCount) break;
      float tActiveI = iTime - uScanStarts[i];
      float phaseI = clamp(tActiveI / dur, 0.0, 1.0);
      if (uScanDirection > 0.5 && uScanDirection < 1.5) {
        phaseI = 1.0 - phaseI;
      } else if (uScanDirection > 1.5) {
        phaseI = (phaseI < 0.5) ? (phaseI * 2.0) : (1.0 - (phaseI - 0.5) * 2.0);
      }
      float scanZI = phaseI * scanZMax;
      float dzI = abs(hit.z - scanZI);
      float lineBandI = exp(-0.5 * (dzI * dzI) / (sigma * sigma));
      float headFadeI = smoother01(0.0, headW, phaseI);
      float tailFadeI = 1.0 - smoother01(1.0 - tailW, 1.0, phaseI);
      float phaseWindowI = headFadeI * tailFadeI;
      combinedPulse += lineBandI * phaseWindowI * clamp(uScanOpacity, 0.0, 1.0);
      float auraBandI = exp(-0.5 * (dzI * dzI) / (sigmaA * sigmaA));
      combinedAura += (auraBandI * 0.25) * phaseWindowI * clamp(uScanOpacity, 0.0, 1.0);
    }

  float lineVis = lineMask;
  vec3 gridCol = uLinesColor * lineVis * fade;
  vec3 scanCol = uScanColor * combinedPulse;
  vec3 scanAura = uScanColor * combinedAura;

    color = gridCol + scanCol + scanAura;

  float n = fract(sin(dot(gl_FragCoord.xy + vec2(iTime * 123.4), vec2(12.9898,78.233))) * 43758.5453123);
  color += (n - 0.5) * uNoise;
  color = clamp(color, 0.0, 1.0);
  float alpha = clamp(max(lineVis, combinedPulse), 0.0, 1.0);
  float gx = 1.0 - smoothstep(tx * 2.0, tx * 2.0 + aax * 2.0, ax);
  float gy = 1.0 - smoothstep(ty * 2.0, ty * 2.0 + aay * 2.0, ay);
  float halo = max(gx, gy) * fade;
  alpha = max(alpha, halo * clamp(uBloomOpacity, 0.0, 1.0));
  fragColor = vec4(color, alpha);
}

void main(){
  vec4 c;
  mainImage(c, vUv * iResolution.xy);
  gl_FragColor = c;
}
`,bY=({enableWebcam:n=!1,showPreview:e=!1,modelsPath:t="https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights",sensitivity:r=.55,lineThickness:i=1,linesColor:o="#392e4e",scanColor:a="#FF9FFC",scanOpacity:s=.4,gridScale:u=.1,lineStyle:l="solid",lineJitter:c=.1,scanDirection:h="pingpong",enablePost:f=!0,bloomIntensity:m=0,bloomThreshold:g=0,bloomSmoothing:w=0,chromaticAberration:v=.002,noiseIntensity:y=.01,scanGlow:x=.5,scanSoftness:E=2,scanPhaseTaper:_=.9,scanDuration:k=2,scanDelay:C=2,enableGyro:A=!1,scanOnClick:I=!1,snapBackDelay:T=250,className:R,style:N,children:O})=>{const V=Ze.useRef(null),F=Ze.useRef(null),B=Ze.useRef(null),U=Ze.useRef(null),P=Ze.useRef(null),L=Ze.useRef(null),H=Ze.useRef(null),W=Ze.useRef(null),[z,q]=Ze.useState(!1),[re,de]=Ze.useState(!1),ye=Ze.useRef(new Wt(0,0)),te=Ze.useRef(0),ie=Ze.useRef(0),fe=Ze.useRef(new Wt(0,0)),Re=Ze.useRef(new Wt(0,0)),De=Ze.useRef(0),Be=Ze.useRef(0),lt=Ze.useRef(0),Y=Ze.useRef(0),ot=8,Ke=Ze.useRef([]),Xe=Ue=>{const _e=Ke.current.slice();if(_e.length>=ot&&_e.shift(),_e.push(Ue),Ke.current=_e,U.current){const rt=U.current.uniforms,Je=new Array(ot).fill(0);for(let Oe=0;Oe<_e.length&&Oe<ot;Oe++)Je[Oe]=_e[Oe];rt.uScanStarts.value=Je,rt.uScanCount.value=_e.length}},qe=Ze.useRef([]),Tt=Ze.useRef([]),Qe=Ze.useRef([]),ft=Ze.useRef([]),Mt=Ki.clamp(r,0,1),Ut=Ki.lerp(.06,.2,Mt),Q=Ki.lerp(.12,.3,Mt),j=Ki.lerp(.1,.28,Mt),me=Ki.lerp(.25,.45,Mt),Ae=Ki.lerp(.45,.12,Mt),Pe=1/0,ke=Ki.lerp(1.2,1.6,Mt);return Ze.useEffect(()=>{const Ue=V.current;if(!Ue)return;let _e=null;const rt=pt=>{if(re)return;_e&&(clearTimeout(_e),_e=null);const nt=Ue.getBoundingClientRect(),tt=(pt.clientX-nt.left)/nt.width*2-1,Nt=-((pt.clientY-nt.top)/nt.height*2-1);ye.current.set(tt,Nt)},Je=async()=>{const pt=performance.now()/1e3;if(I&&Xe(pt),A&&typeof window<"u"&&window.DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission)try{await DeviceOrientationEvent.requestPermission()}catch{}},Oe=()=>{_e&&(clearTimeout(_e),_e=null)},$e=()=>{re||(_e&&clearTimeout(_e),_e=window.setTimeout(()=>{ye.current.set(0,0),te.current=0,ie.current=0},Math.max(0,T||0)))};return Ue.addEventListener("mousemove",rt),Ue.addEventListener("mouseenter",Oe),I&&Ue.addEventListener("click",Je),Ue.addEventListener("mouseleave",$e),()=>{Ue.removeEventListener("mousemove",rt),Ue.removeEventListener("mouseenter",Oe),Ue.removeEventListener("mouseleave",$e),I&&Ue.removeEventListener("click",Je),_e&&clearTimeout(_e)}},[re,T,I,A]),Ze.useEffect(()=>{const Ue=V.current;if(!Ue)return;const _e=new nX({antialias:!0,alpha:!0});B.current=_e,_e.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),_e.setSize(Ue.clientWidth,Ue.clientHeight),_e.outputColorSpace=Cn,_e.toneMapping=Ga,_e.autoClear=!1,_e.setClearColor(0,0),Ue.appendChild(_e.domElement);const rt={iResolution:{value:new Te(Ue.clientWidth,Ue.clientHeight,_e.getPixelRatio())},iTime:{value:0},uSkew:{value:new Wt(0,0)},uTilt:{value:0},uYaw:{value:0},uLineThickness:{value:i},uLinesColor:{value:zp(o)},uScanColor:{value:zp(a)},uGridScale:{value:u},uLineStyle:{value:l==="dashed"?1:l==="dotted"?2:0},uLineJitter:{value:Math.max(0,Math.min(1,c||0))},uScanOpacity:{value:s},uNoise:{value:y},uBloomOpacity:{value:m},uScanGlow:{value:x},uScanSoftness:{value:E},uPhaseTaper:{value:_},uScanDuration:{value:k},uScanDelay:{value:C},uScanDirection:{value:h==="backward"?1:h==="pingpong"?2:0},uScanStarts:{value:new Array(ot).fill(0)},uScanCount:{value:0}},Je=new Xr({uniforms:rt,vertexShader:vY,fragmentShader:yY,transparent:!0,depthWrite:!1,depthTest:!1});U.current=Je;const Oe=new cw,$e=new X_(-1,1,1,-1,0,1),pt=new Io(new Ud(2,2),Je);Oe.add(pt);let nt=null;if(f){nt=new cX(_e),P.current=nt;const He=new hY(Oe,$e);nt.addPass(He);const Ve=new sY({intensity:1,luminanceThreshold:g,luminanceSmoothing:w});Ve.blendMode.opacity.value=Math.max(0,m),L.current=Ve;const it=new cY({offset:new Wt(v,v),radialModulation:!0,modulationOffset:0});H.current=it;const We=new gY($e,Ve,it);We.renderToScreen=!0,nt.addPass(We)}const tt=()=>{_e.setSize(Ue.clientWidth,Ue.clientHeight),Je.uniforms.iResolution.value.set(Ue.clientWidth,Ue.clientHeight,_e.getPixelRatio()),P.current&&P.current.setSize(Ue.clientWidth,Ue.clientHeight)};window.addEventListener("resize",tt);let Nt=performance.now();const se=()=>{const He=performance.now(),Ve=Math.max(0,Math.min(.1,(He-Nt)/1e3));Nt=He,fe.current.copy(wY(fe.current,ye.current,Re.current,Ae,Pe,Ve));const it=Rk(De.current,te.current,{v:Be.current},Ae,Pe,Ve);De.current=it.value,Be.current=it.v;const We=Rk(lt.current,ie.current,{v:Y.current},Ae,Pe,Ve);lt.current=We.value,Y.current=We.v;const Fe=new Wt(fe.current.x*Ut,-fe.current.y*ke*Ut);Je.uniforms.uSkew.value.set(Fe.x,Fe.y),Je.uniforms.uTilt.value=De.current*Q,Je.uniforms.uYaw.value=Ki.clamp(lt.current*j,-.6,.6),Je.uniforms.iTime.value=He/1e3,_e.clear(!0,!0,!0),P.current?P.current.render(Ve):_e.render(Oe,$e),W.current=requestAnimationFrame(se)};return W.current=requestAnimationFrame(se),()=>{W.current&&cancelAnimationFrame(W.current),window.removeEventListener("resize",tt),Je.dispose(),pt.geometry.dispose(),P.current&&(P.current.dispose(),P.current=null),_e.dispose(),Ue.removeChild(_e.domElement)}},[r,i,o,a,s,u,l,c,h,f]),Ze.useEffect(()=>{const Ue=U.current;if(Ue){const _e=Ue.uniforms;_e.uLineThickness.value=i,_e.uLinesColor.value.copy(zp(o)),_e.uScanColor.value.copy(zp(a)),_e.uGridScale.value=u,_e.uLineStyle.value=l==="dashed"?1:l==="dotted"?2:0,_e.uLineJitter.value=Math.max(0,Math.min(1,c||0)),_e.uBloomOpacity.value=Math.max(0,m),_e.uNoise.value=Math.max(0,y),_e.uScanGlow.value=x,_e.uScanOpacity.value=Math.max(0,Math.min(1,s)),_e.uScanDirection.value=h==="backward"?1:h==="pingpong"?2:0,_e.uScanSoftness.value=E,_e.uPhaseTaper.value=_,_e.uScanDuration.value=Math.max(.05,k),_e.uScanDelay.value=Math.max(0,C)}L.current&&(L.current.blendMode.opacity.value=Math.max(0,m),L.current.luminanceMaterial.threshold=g,L.current.luminanceMaterial.smoothing=w),H.current&&H.current.offset.set(v,v)},[i,o,a,u,l,c,m,g,w,v,y,x,s,h,E,_,k,C]),Ze.useEffect(()=>{if(!A)return;const Ue=_e=>{if(re)return;const rt=_e.gamma??0,Je=_e.beta??0,Oe=Ki.clamp(rt/45,-1,1),$e=Ki.clamp(-Je/30,-1,1);ye.current.set(Oe,$e),te.current=Ki.degToRad(rt)*.4};return window.addEventListener("deviceorientation",Ue),()=>{window.removeEventListener("deviceorientation",Ue)}},[A,re]),Ze.useEffect(()=>{let Ue=!1;return(async()=>{try{await Promise.all([gi.tinyFaceDetector.loadFromUri(t),gi.faceLandmark68TinyNet.loadFromUri(t)]),Ue||q(!0)}catch{Ue||q(!1)}})(),()=>{Ue=!0}},[t]),Ze.useEffect(()=>{let Ue=!1,_e=0;return(async()=>{if(!n||!z)return;const Je=F.current;if(!Je)return;try{const pt=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}},audio:!1});Je.srcObject=pt,await Je.play()}catch{return}const Oe=new gR({inputSize:320,scoreThreshold:.5}),$e=async pt=>{if(!Ue){if(pt-_e>=33){_e=pt;try{const nt=await OW(Je,Oe).withFaceLandmarks(!0);if(nt&&nt.detection){const Nt=nt.detection.box,se=Je.videoWidth||1,He=Je.videoHeight||1,Ve=Nt.x+Nt.width*.5,it=Nt.y+Nt.height*.5,We=Ve/se*2-1,Fe=it/He*2-1;Wp(qe.current,We,5),Wp(Tt.current,Fe,5);const gt=Hp(qe.current),Ht=Hp(Tt.current),bn=new Wt(Math.tanh(gt),Math.tanh(Ht)),an=Math.min(1,Math.hypot(Nt.width/se,Nt.height/He)),oi=1+me*(an-.25);ye.current.copy(bn.multiplyScalar(oi));const fr=nt.landmarks.getLeftEye(),os=nt.landmarks.getRightEye(),pr=Ak(fr),Ho=Ak(os),Go=Math.atan2(Ho.y-pr.y,Ho.x-pr.x);Wp(Qe.current,Go,5),te.current=Hp(Qe.current);const Hi=nt.landmarks.getNose(),Gi=Hi[Hi.length-1]||Hi[Math.floor(Hi.length/2)],co=nt.landmarks.getJawOutline(),as=co[3]||co[2],fl=co[13]||co[14],pl=Ik(Gi,as),ho=Ik(Gi,fl),ml=Math.hypot(Ho.x-pr.x,Ho.y-pr.y)+1e-6;let ss=Ki.clamp((ho-pl)/(ml*1.6),-1,1);ss=Math.tanh(ss),Wp(ft.current,ss,5),ie.current=Hp(ft.current),de(!0)}else de(!1)}catch{de(!1)}}"requestVideoFrameCallback"in HTMLVideoElement.prototype?Je.requestVideoFrameCallback(()=>$e(performance.now())):requestAnimationFrame($e)}};requestAnimationFrame($e)})(),()=>{Ue=!0;const Je=F.current;if(Je){const Oe=Je.srcObject;Oe&&Oe.getTracks().forEach($e=>$e.stop()),Je.pause(),Je.srcObject=null}}},[n,z,me]),ne.jsxs("div",{ref:V,className:`gridscan${R?` ${R}`:""}`,style:N,children:[O&&ne.jsx("div",{className:"gridscan__content",children:O}),e&&ne.jsxs("div",{className:"gridscan__preview",children:[ne.jsx("video",{ref:F,muted:!0,playsInline:!0,autoPlay:!0,className:"gridscan__video"}),ne.jsx("div",{className:"gridscan__badge",children:n?z?re?"Face: tracking":"Face: searching":"Loading models":"Webcam disabled"})]})]})};function zp(n){return new Sn(n).convertSRGBToLinear()}function wY(n,e,t,r,i,o){const a=n.clone();r=Math.max(1e-4,r);const s=2/r,u=s*o,l=1/(1+u+.48*u*u+.235*u*u*u),c=n.clone().sub(e),h=e.clone(),f=i*r;c.length()>f&&c.setLength(f),e=n.clone().sub(c);const m=t.clone().addScaledVector(c,s).multiplyScalar(o);t.sub(m.clone().multiplyScalar(s)),t.multiplyScalar(l),a.copy(e.clone().add(c.add(m).multiplyScalar(l)));const g=h.clone().sub(n),w=a.clone().sub(h);return g.dot(w)>0&&(a.copy(h),t.set(0,0)),a}function Rk(n,e,t,r,i,o){r=Math.max(1e-4,r);const a=2/r,s=a*o,u=1/(1+s+.48*s*s+.235*s*s*s);let l=n-e;const c=e,h=i*r;l=Math.sign(l)*Math.min(Math.abs(l),h),e=n-l;const f=(t.v+a*l)*o;t.v=(t.v-a*f)*u;let m=e+(l+f)*u;const g=c-n,w=m-c;return g*w>0&&(m=c,t.v=0),{value:m,v:t.v}}function Wp(n,e,t){n.push(e),n.length>t&&n.shift()}function Hp(n){if(n.length===0)return 0;const e=[...n].sort((r,i)=>r-i),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])*.5}function Ak(n){let e=0,t=0;const r=n.length||1;for(const i of n)e+=i.x,t+=i.y;return{x:e/r,y:t/r}}function Ik(n,e){return Math.hypot(n.x-e.x,n.y-e.y)}const _Y=n=>{switch(n.toLowerCase()){case"github":return"socicon-github";case"twitter":return"socicon-twitter";case"instagram":return"socicon-instagram";case"linkedin":return"socicon-linkedin";case"medium":return"socicon-medium";case"whatsapp":return"socicon-whatsapp";default:return"-"}},xY=({data:n})=>{const{network:e,url:t}=n;return ne.jsx("div",{className:"ico",children:ne.jsx("a",{className:"no-underline",href:t,children:ne.jsx("span",{className:_Y(e),title:e})})})},Dk=({data:n})=>ne.jsx(Do.Fragment,{children:n.map((e,t)=>ne.jsx(xY,{data:e},t))}),SY=({data:n})=>{const{name:e,summary:t,profiles:r}=n;return ne.jsx(Do.Fragment,{children:ne.jsx("section",{id:"home",className:"large-header",children:ne.jsx("div",{className:"overlay",children:ne.jsxs(bY,{sensitivity:.55,lineThickness:1,linesColor:"#392e4e",gridScale:.1,scanColor:"#FF9FFC",scanOpacity:.4,enablePost:!0,bloomIntensity:.6,chromaticAberration:.002,noiseIntensity:.01,children:[ne.jsxs("div",{className:"hero-content",children:[ne.jsx("div",{className:"hero-intro",children:ne.jsx("i",{children:"Hi, my name is"})}),ne.jsx("div",{className:"hero-name-wrapper",children:ne.jsx("h1",{className:"typewriter",children:e})}),ne.jsx("div",{className:"hero-summary",children:t.map((i,o)=>i&&ne.jsx("p",{children:i},o))}),ne.jsxs("div",{className:"hero-actions",children:[ne.jsx("div",{className:"social-group",children:ne.jsx(Dk,{data:r.social})}),ne.jsx("div",{className:"action-separator",children:"|"}),ne.jsx("div",{className:"cv-group",children:ne.jsx(Dk,{data:r.cv})})]})]}),ne.jsx("div",{className:"arrow-container",onClick:()=>document.getElementById("resume")?.scrollIntoView({behavior:"smooth"}),children:ne.jsx("i",{className:"arrow down"})})]})})})})};var oA={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Nk=Do.createContext&&Do.createContext(oA),EY=["attr","size","title"];function kY(n,e){if(n==null)return{};var t=CY(n,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function CY(n,e){if(n==null)return{};var t={};for(var r in n)if(Object.prototype.hasOwnProperty.call(n,r)){if(e.indexOf(r)>=0)continue;t[r]=n[r]}return t}function jm(){return jm=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},jm.apply(this,arguments)}function Pk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function qm(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Pk(Object(t),!0).forEach(function(r){TY(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Pk(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function TY(n,e,t){return e=MY(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function MY(n){var e=RY(n,"string");return typeof e=="symbol"?e:e+""}function RY(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function aA(n){return n&&n.map((e,t)=>Do.createElement(e.tag,qm({key:t},e.attr),aA(e.child)))}function dl(n){return e=>Do.createElement(AY,jm({attr:qm({},n.attr)},e),aA(n.child))}function AY(n){var e=t=>{var{attr:r,size:i,title:o}=n,a=kY(n,EY),s=i||t.size||"1em",u;return t.className&&(u=t.className),n.className&&(u=(u?u+" ":"")+n.className),Do.createElement("svg",jm({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,r,a,{className:u,style:qm(qm({color:n.color||t.color},t.style),n.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&Do.createElement("title",null,o),n.children)};return Nk!==void 0?Do.createElement(Nk.Consumer,null,t=>e(t)):e(oA)}function IY(n){return dl({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(n)}function DY(n){return dl({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"},child:[]}]})(n)}function NY(n){return dl({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M320 336c0 8.84-7.16 16-16 16h-96c-8.84 0-16-7.16-16-16v-48H0v144c0 25.6 22.4 48 48 48h416c25.6 0 48-22.4 48-48V288H320v48zm144-208h-80V80c0-25.6-22.4-48-48-48H176c-25.6 0-48 22.4-48 48v48H48c-25.6 0-48 22.4-48 48v80h512v-80c0-25.6-22.4-48-48-48zm-144 0H192V96h128v32z"},child:[]}]})(n)}function PY(n){return dl({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(n)}function FY(n){return dl({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"},child:[]}]})(n)}function Fk(n){return dl({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(n)}function OY(n){return dl({attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(n)}const LY="modulepreload",BY=function(n){return"/"+n},Ok={},UY=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let u=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");i=u(t.map(l=>{if(l=BY(l),l in Ok)return;Ok[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":LY,c||(f.as="script"),f.crossOrigin="",f.href=l,s&&f.setAttribute("nonce",s),document.head.appendChild(f),c)return new Promise((m,g)=>{f.addEventListener("load",m),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})};var Gp={exports:{}},Os={},Vp={exports:{}},Qi={},jp={exports:{}},Lk;function sA(){return Lk||(Lk=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t="none",r="contents",i=/^(input|select|textarea|button|object|iframe)$/;function o(h,f){return f.getPropertyValue("overflow")!=="visible"||h.scrollWidth<=0&&h.scrollHeight<=0}function a(h){var f=h.offsetWidth<=0&&h.offsetHeight<=0;if(f&&!h.innerHTML)return!0;try{var m=window.getComputedStyle(h),g=m.getPropertyValue("display");return f?g!==r&&o(h,m):g===t}catch{return console.warn("Failed to inspect element style"),!1}}function s(h){for(var f=h,m=h.getRootNode&&h.getRootNode();f&&f!==document.body;){if(m&&f===m&&(f=m.host.parentNode),a(f))return!1;f=f.parentNode}return!0}function u(h,f){var m=h.nodeName.toLowerCase(),g=i.test(m)&&!h.disabled||m==="a"&&h.href||f;return g&&s(h)}function l(h){var f=h.getAttribute("tabindex");f===null&&(f=void 0);var m=isNaN(f);return(m||f>=0)&&u(h,!m)}function c(h){var f=[].slice.call(h.querySelectorAll("*"),0).reduce(function(m,g){return m.concat(g.shadowRoot?c(g.shadowRoot):[g])},[]);return f.filter(l)}n.exports=e.default})(jp,jp.exports)),jp.exports}var Bk;function zY(){if(Bk)return Qi;Bk=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.resetState=a,Qi.log=s,Qi.handleBlur=u,Qi.handleFocus=l,Qi.markForFocusLater=c,Qi.returnFocus=h,Qi.popWithoutFocus=f,Qi.setupScopedFocus=m,Qi.teardownScopedFocus=g;var n=sA(),e=t(n);function t(w){return w&&w.__esModule?w:{default:w}}var r=[],i=null,o=!1;function a(){r=[]}function s(){}function u(){o=!0}function l(){if(o){if(o=!1,!i)return;setTimeout(function(){if(!i.contains(document.activeElement)){var w=(0,e.default)(i)[0]||i;w.focus()}},0)}}function c(){r.push(document.activeElement)}function h(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,v=null;try{r.length!==0&&(v=r.pop(),v.focus({preventScroll:w}));return}catch{console.warn(["You tried to return focus to",v,"but it is not in the DOM anymore"].join(" "))}}function f(){r.length>0&&r.pop()}function m(w){i=w,window.addEventListener?(window.addEventListener("blur",u,!1),document.addEventListener("focus",l,!0)):(window.attachEvent("onBlur",u),document.attachEvent("onFocus",l))}function g(){i=null,window.addEventListener?(window.removeEventListener("blur",u),document.removeEventListener("focus",l)):(window.detachEvent("onBlur",u),document.detachEvent("onFocus",l))}return Qi}var qp={exports:{}},Uk;function WY(){return Uk||(Uk=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=sA(),r=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function o(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;return s.activeElement.shadowRoot?o(s.activeElement.shadowRoot):s.activeElement}function a(s,u){var l=(0,r.default)(s);if(!l.length){u.preventDefault();return}var c=void 0,h=u.shiftKey,f=l[0],m=l[l.length-1],g=o();if(s===g){if(!h)return;c=m}if(m===g&&!h&&(c=f),f===g&&h&&(c=m),c){u.preventDefault(),c.focus();return}var w=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent),v=w!=null&&w[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(v){var y=l.indexOf(g);if(y>-1&&(y+=h?-1:1),c=l[y],typeof c>"u"){u.preventDefault(),c=h?m:f,c.focus();return}u.preventDefault(),c.focus()}}n.exports=e.default})(qp,qp.exports)),qp.exports}var Eo={},Yo={},Bb={exports:{}};var zk;function HY(){return zk||(zk=1,(function(n){(function(){var e=!!(typeof window<"u"&&window.document&&window.document.createElement),t={canUseDOM:e,canUseWorkers:typeof Worker<"u",canUseEventListeners:e&&!!(window.addEventListener||window.attachEvent),canUseViewport:e&&!!window.screen};n.exports?n.exports=t:window.ExecutionEnvironment=t})()})(Bb)),Bb.exports}var Wk;function J_(){if(Wk)return Yo;Wk=1,Object.defineProperty(Yo,"__esModule",{value:!0}),Yo.canUseDOM=Yo.SafeNodeList=Yo.SafeHTMLCollection=void 0;var n=HY(),e=t(n);function t(o){return o&&o.__esModule?o:{default:o}}var r=e.default,i=r.canUseDOM?window.HTMLElement:{};return Yo.SafeHTMLCollection=r.canUseDOM?window.HTMLCollection:{},Yo.SafeNodeList=r.canUseDOM?window.NodeList:{},Yo.canUseDOM=r.canUseDOM,Yo.default=i,Yo}var Hk;function uA(){if(Hk)return Eo;Hk=1,Object.defineProperty(Eo,"__esModule",{value:!0}),Eo.resetState=o,Eo.log=a,Eo.assertNodeList=s,Eo.setElement=u,Eo.validateElement=l,Eo.hide=c,Eo.show=h,Eo.documentNotReadyOrSSRTesting=f;var n=cC(),e=r(n),t=J_();function r(m){return m&&m.__esModule?m:{default:m}}var i=null;function o(){i&&(i.removeAttribute?i.removeAttribute("aria-hidden"):i.length!=null?i.forEach(function(m){return m.removeAttribute("aria-hidden")}):document.querySelectorAll(i).forEach(function(m){return m.removeAttribute("aria-hidden")})),i=null}function a(){}function s(m,g){if(!m||!m.length)throw new Error("react-modal: No elements were found for selector "+g+".")}function u(m){var g=m;if(typeof g=="string"&&t.canUseDOM){var w=document.querySelectorAll(g);s(w,g),g=w}return i=g||i,i}function l(m){var g=m||i;return g?Array.isArray(g)||g instanceof HTMLCollection||g instanceof NodeList?g:[g]:((0,e.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}function c(m){var g=!0,w=!1,v=void 0;try{for(var y=l(m)[Symbol.iterator](),x;!(g=(x=y.next()).done);g=!0){var E=x.value;E.setAttribute("aria-hidden","true")}}catch(_){w=!0,v=_}finally{try{!g&&y.return&&y.return()}finally{if(w)throw v}}}function h(m){var g=!0,w=!1,v=void 0;try{for(var y=l(m)[Symbol.iterator](),x;!(g=(x=y.next()).done);g=!0){var E=x.value;E.removeAttribute("aria-hidden")}}catch(_){w=!0,v=_}finally{try{!g&&y.return&&y.return()}finally{if(w)throw v}}}function f(){i=null}return Eo}var Iu={},Gk;function GY(){if(Gk)return Iu;Gk=1,Object.defineProperty(Iu,"__esModule",{value:!0}),Iu.resetState=r,Iu.log=i;var n={},e={};function t(l,c){l.classList.remove(c)}function r(){var l=document.getElementsByTagName("html")[0];for(var c in n)t(l,n[c]);var h=document.body;for(var f in e)t(h,e[f]);n={},e={}}function i(){}var o=function(c,h){return c[h]||(c[h]=0),c[h]+=1,h},a=function(c,h){return c[h]&&(c[h]-=1),h},s=function(c,h,f){f.forEach(function(m){o(h,m),c.add(m)})},u=function(c,h,f){f.forEach(function(m){a(h,m),h[m]===0&&c.remove(m)})};return Iu.add=function(c,h){return s(c.classList,c.nodeName.toLowerCase()=="html"?n:e,h.split(" "))},Iu.remove=function(c,h){return u(c.classList,c.nodeName.toLowerCase()=="html"?n:e,h.split(" "))},Iu}var rc={},Vk;function lA(){if(Vk)return rc;Vk=1,Object.defineProperty(rc,"__esModule",{value:!0}),rc.log=r,rc.resetState=i;function n(o,a){if(!(o instanceof a))throw new TypeError("Cannot call a class as a function")}var e=function o(){var a=this;n(this,o),this.register=function(s){a.openInstances.indexOf(s)===-1&&(a.openInstances.push(s),a.emit("register"))},this.deregister=function(s){var u=a.openInstances.indexOf(s);u!==-1&&(a.openInstances.splice(u,1),a.emit("deregister"))},this.subscribe=function(s){a.subscribers.push(s)},this.emit=function(s){a.subscribers.forEach(function(u){return u(s,a.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},t=new e;function r(){console.log("portalOpenInstances ----------"),console.log(t.openInstances.length),t.openInstances.forEach(function(o){return console.log(o)}),console.log("end portalOpenInstances ----------")}function i(){t=new e}return rc.default=t,rc}var Gh={},jk;function VY(){if(jk)return Gh;jk=1,Object.defineProperty(Gh,"__esModule",{value:!0}),Gh.resetState=a,Gh.log=s;var n=lA(),e=t(n);function t(c){return c&&c.__esModule?c:{default:c}}var r=void 0,i=void 0,o=[];function a(){for(var c=[r,i],h=0;h<c.length;h++){var f=c[h];f&&f.parentNode&&f.parentNode.removeChild(f)}r=i=null,o=[]}function s(){console.log("bodyTrap ----------"),console.log(o.length);for(var c=[r,i],h=0;h<c.length;h++){var f=c[h],m=f||{};console.log(m.nodeName,m.className,m.id)}console.log("edn bodyTrap ----------")}function u(){o.length!==0&&o[o.length-1].focusContent()}function l(c,h){!r&&!i&&(r=document.createElement("div"),r.setAttribute("data-react-modal-body-trap",""),r.style.position="absolute",r.style.opacity="0",r.setAttribute("tabindex","0"),r.addEventListener("focus",u),i=r.cloneNode(),i.addEventListener("focus",u)),o=h,o.length>0?(document.body.firstChild!==r&&document.body.insertBefore(r,document.body.firstChild),document.body.lastChild!==i&&document.body.appendChild(i)):(r.parentElement&&r.parentElement.removeChild(r),i.parentElement&&i.parentElement.removeChild(i))}return e.default.subscribe(l),Gh}var qk;function jY(){return qk||(qk=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=Object.assign||function(F){for(var B=1;B<arguments.length;B++){var U=arguments[B];for(var P in U)Object.prototype.hasOwnProperty.call(U,P)&&(F[P]=U[P])}return F},r=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},i=(function(){function F(B,U){for(var P=0;P<U.length;P++){var L=U[P];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(B,L.key,L)}}return function(B,U,P){return U&&F(B.prototype,U),P&&F(B,P),B}})(),o=qc(),a=Ym(),s=k(a),u=zY(),l=_(u),c=WY(),h=k(c),f=uA(),m=_(f),g=GY(),w=_(g),v=J_(),y=k(v),x=lA(),E=k(x);VY();function _(F){if(F&&F.__esModule)return F;var B={};if(F!=null)for(var U in F)Object.prototype.hasOwnProperty.call(F,U)&&(B[U]=F[U]);return B.default=F,B}function k(F){return F&&F.__esModule?F:{default:F}}function C(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function A(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function I(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var T={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},R=function(B){return B.code==="Tab"||B.keyCode===9},N=function(B){return B.code==="Escape"||B.keyCode===27},O=0,V=(function(F){I(B,F);function B(U){C(this,B);var P=A(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,U));return P.setOverlayRef=function(L){P.overlay=L,P.props.overlayRef&&P.props.overlayRef(L)},P.setContentRef=function(L){P.content=L,P.props.contentRef&&P.props.contentRef(L)},P.afterClose=function(){var L=P.props,H=L.appElement,W=L.ariaHideApp,z=L.htmlOpenClassName,q=L.bodyOpenClassName,re=L.parentSelector,de=re&&re().ownerDocument||document;q&&w.remove(de.body,q),z&&w.remove(de.getElementsByTagName("html")[0],z),W&&O>0&&(O-=1,O===0&&m.show(H)),P.props.shouldFocusAfterRender&&(P.props.shouldReturnFocusAfterClose?(l.returnFocus(P.props.preventScroll),l.teardownScopedFocus()):l.popWithoutFocus()),P.props.onAfterClose&&P.props.onAfterClose(),E.default.deregister(P)},P.open=function(){P.beforeOpen(),P.state.afterOpen&&P.state.beforeClose?(clearTimeout(P.closeTimer),P.setState({beforeClose:!1})):(P.props.shouldFocusAfterRender&&(l.setupScopedFocus(P.node),l.markForFocusLater()),P.setState({isOpen:!0},function(){P.openAnimationFrame=requestAnimationFrame(function(){P.setState({afterOpen:!0}),P.props.isOpen&&P.props.onAfterOpen&&P.props.onAfterOpen({overlayEl:P.overlay,contentEl:P.content})})}))},P.close=function(){P.props.closeTimeoutMS>0?P.closeWithTimeout():P.closeWithoutTimeout()},P.focusContent=function(){return P.content&&!P.contentHasFocus()&&P.content.focus({preventScroll:!0})},P.closeWithTimeout=function(){var L=Date.now()+P.props.closeTimeoutMS;P.setState({beforeClose:!0,closesAt:L},function(){P.closeTimer=setTimeout(P.closeWithoutTimeout,P.state.closesAt-Date.now())})},P.closeWithoutTimeout=function(){P.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},P.afterClose)},P.handleKeyDown=function(L){R(L)&&(0,h.default)(P.content,L),P.props.shouldCloseOnEsc&&N(L)&&(L.stopPropagation(),P.requestClose(L))},P.handleOverlayOnClick=function(L){P.shouldClose===null&&(P.shouldClose=!0),P.shouldClose&&P.props.shouldCloseOnOverlayClick&&(P.ownerHandlesClose()?P.requestClose(L):P.focusContent()),P.shouldClose=null},P.handleContentOnMouseUp=function(){P.shouldClose=!1},P.handleOverlayOnMouseDown=function(L){!P.props.shouldCloseOnOverlayClick&&L.target==P.overlay&&L.preventDefault()},P.handleContentOnClick=function(){P.shouldClose=!1},P.handleContentOnMouseDown=function(){P.shouldClose=!1},P.requestClose=function(L){return P.ownerHandlesClose()&&P.props.onRequestClose(L)},P.ownerHandlesClose=function(){return P.props.onRequestClose},P.shouldBeClosed=function(){return!P.state.isOpen&&!P.state.beforeClose},P.contentHasFocus=function(){return document.activeElement===P.content||P.content.contains(document.activeElement)},P.buildClassName=function(L,H){var W=(typeof H>"u"?"undefined":r(H))==="object"?H:{base:T[L],afterOpen:T[L]+"--after-open",beforeClose:T[L]+"--before-close"},z=W.base;return P.state.afterOpen&&(z=z+" "+W.afterOpen),P.state.beforeClose&&(z=z+" "+W.beforeClose),typeof H=="string"&&H?z+" "+H:z},P.attributesFromObject=function(L,H){return Object.keys(H).reduce(function(W,z){return W[L+"-"+z]=H[z],W},{})},P.state={afterOpen:!1,beforeClose:!1},P.shouldClose=null,P.moveFromContentToOverlay=null,P}return i(B,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(P,L){this.props.isOpen&&!P.isOpen?this.open():!this.props.isOpen&&P.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!L.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var P=this.props,L=P.appElement,H=P.ariaHideApp,W=P.htmlOpenClassName,z=P.bodyOpenClassName,q=P.parentSelector,re=q&&q().ownerDocument||document;z&&w.add(re.body,z),W&&w.add(re.getElementsByTagName("html")[0],W),H&&(O+=1,m.hide(L)),E.default.register(this)}},{key:"render",value:function(){var P=this.props,L=P.id,H=P.className,W=P.overlayClassName,z=P.defaultStyles,q=P.children,re=H?{}:z.content,de=W?{}:z.overlay;if(this.shouldBeClosed())return null;var ye={ref:this.setOverlayRef,className:this.buildClassName("overlay",W),style:t({},de,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},te=t({id:L,ref:this.setContentRef,style:t({},re,this.props.style.content),className:this.buildClassName("content",H),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",t({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),ie=this.props.contentElement(te,q);return this.props.overlayElement(ye,ie)}}]),B})(o.Component);V.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},V.propTypes={isOpen:s.default.bool.isRequired,defaultStyles:s.default.shape({content:s.default.object,overlay:s.default.object}),style:s.default.shape({content:s.default.object,overlay:s.default.object}),className:s.default.oneOfType([s.default.string,s.default.object]),overlayClassName:s.default.oneOfType([s.default.string,s.default.object]),parentSelector:s.default.func,bodyOpenClassName:s.default.string,htmlOpenClassName:s.default.string,ariaHideApp:s.default.bool,appElement:s.default.oneOfType([s.default.instanceOf(y.default),s.default.instanceOf(v.SafeHTMLCollection),s.default.instanceOf(v.SafeNodeList),s.default.arrayOf(s.default.instanceOf(y.default))]),onAfterOpen:s.default.func,onAfterClose:s.default.func,onRequestClose:s.default.func,closeTimeoutMS:s.default.number,shouldFocusAfterRender:s.default.bool,shouldCloseOnOverlayClick:s.default.bool,shouldReturnFocusAfterClose:s.default.bool,preventScroll:s.default.bool,role:s.default.string,contentLabel:s.default.string,aria:s.default.object,data:s.default.object,children:s.default.node,shouldCloseOnEsc:s.default.bool,overlayRef:s.default.func,contentRef:s.default.func,id:s.default.string,overlayElement:s.default.func,contentElement:s.default.func,testId:s.default.string},e.default=V,n.exports=e.default})(Vp,Vp.exports)),Vp.exports}const qY=$4(yI);var $k;function $Y(){if($k)return Os;$k=1,Object.defineProperty(Os,"__esModule",{value:!0}),Os.bodyOpenClassName=Os.portalClassName=void 0;var n=Object.assign||function(N){for(var O=1;O<arguments.length;O++){var V=arguments[O];for(var F in V)Object.prototype.hasOwnProperty.call(V,F)&&(N[F]=V[F])}return N},e=(function(){function N(O,V){for(var F=0;F<V.length;F++){var B=V[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(O,B.key,B)}}return function(O,V,F){return V&&N(O.prototype,V),F&&N(O,F),O}})(),t=qc(),r=v(t),i=nC(),o=v(i),a=Ym(),s=v(a),u=jY(),l=v(u),c=uA(),h=w(c),f=J_(),m=v(f),g=qY;function w(N){if(N&&N.__esModule)return N;var O={};if(N!=null)for(var V in N)Object.prototype.hasOwnProperty.call(N,V)&&(O[V]=N[V]);return O.default=N,O}function v(N){return N&&N.__esModule?N:{default:N}}function y(N,O){if(!(N instanceof O))throw new TypeError("Cannot call a class as a function")}function x(N,O){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O&&(typeof O=="object"||typeof O=="function")?O:N}function E(N,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof O);N.prototype=Object.create(O&&O.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(N,O):N.__proto__=O)}var _=Os.portalClassName="ReactModalPortal",k=Os.bodyOpenClassName="ReactModal__Body--open",C=f.canUseDOM&&o.default.createPortal!==void 0,A=function(O){return document.createElement(O)},I=function(){return C?o.default.createPortal:o.default.unstable_renderSubtreeIntoContainer};function T(N){return N()}var R=(function(N){E(O,N);function O(){var V,F,B,U;y(this,O);for(var P=arguments.length,L=Array(P),H=0;H<P;H++)L[H]=arguments[H];return U=(F=(B=x(this,(V=O.__proto__||Object.getPrototypeOf(O)).call.apply(V,[this].concat(L))),B),B.removePortal=function(){!C&&o.default.unmountComponentAtNode(B.node);var W=T(B.props.parentSelector);W&&W.contains(B.node)?W.removeChild(B.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},B.portalRef=function(W){B.portal=W},B.renderPortal=function(W){var z=I(),q=z(B,r.default.createElement(l.default,n({defaultStyles:O.defaultStyles},W)),B.node);B.portalRef(q)},F),x(B,U)}return e(O,[{key:"componentDidMount",value:function(){if(f.canUseDOM){C||(this.node=A("div")),this.node.className=this.props.portalClassName;var F=T(this.props.parentSelector);F.appendChild(this.node),!C&&this.renderPortal(this.props)}}},{key:"getSnapshotBeforeUpdate",value:function(F){var B=T(F.parentSelector),U=T(this.props.parentSelector);return{prevParent:B,nextParent:U}}},{key:"componentDidUpdate",value:function(F,B,U){if(f.canUseDOM){var P=this.props,L=P.isOpen,H=P.portalClassName;F.portalClassName!==H&&(this.node.className=H);var W=U.prevParent,z=U.nextParent;z!==W&&(W.removeChild(this.node),z.appendChild(this.node)),!(!F.isOpen&&!L)&&!C&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(!(!f.canUseDOM||!this.node||!this.portal)){var F=this.portal.state,B=Date.now(),U=F.isOpen&&this.props.closeTimeoutMS&&(F.closesAt||B+this.props.closeTimeoutMS);U?(F.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,U-B)):this.removePortal()}}},{key:"render",value:function(){if(!f.canUseDOM||!C)return null;!this.node&&C&&(this.node=A("div"));var F=I();return F(r.default.createElement(l.default,n({ref:this.portalRef,defaultStyles:O.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function(F){h.setElement(F)}}]),O})(t.Component);return R.propTypes={isOpen:s.default.bool.isRequired,style:s.default.shape({content:s.default.object,overlay:s.default.object}),portalClassName:s.default.string,bodyOpenClassName:s.default.string,htmlOpenClassName:s.default.string,className:s.default.oneOfType([s.default.string,s.default.shape({base:s.default.string.isRequired,afterOpen:s.default.string.isRequired,beforeClose:s.default.string.isRequired})]),overlayClassName:s.default.oneOfType([s.default.string,s.default.shape({base:s.default.string.isRequired,afterOpen:s.default.string.isRequired,beforeClose:s.default.string.isRequired})]),appElement:s.default.oneOfType([s.default.instanceOf(m.default),s.default.instanceOf(f.SafeHTMLCollection),s.default.instanceOf(f.SafeNodeList),s.default.arrayOf(s.default.instanceOf(m.default))]),onAfterOpen:s.default.func,onRequestClose:s.default.func,closeTimeoutMS:s.default.number,ariaHideApp:s.default.bool,shouldFocusAfterRender:s.default.bool,shouldCloseOnOverlayClick:s.default.bool,shouldReturnFocusAfterClose:s.default.bool,preventScroll:s.default.bool,parentSelector:s.default.func,aria:s.default.object,data:s.default.object,role:s.default.string,contentLabel:s.default.string,shouldCloseOnEsc:s.default.bool,overlayRef:s.default.func,contentRef:s.default.func,id:s.default.string,overlayElement:s.default.func,contentElement:s.default.func},R.defaultProps={isOpen:!1,portalClassName:_,bodyOpenClassName:k,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(O,V){return r.default.createElement("div",O,V)},contentElement:function(O,V){return r.default.createElement("div",O,V)}},R.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,g.polyfill)(R),Os.default=R,Os}var Xk;function XY(){return Xk||(Xk=1,(function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var t=$Y(),r=i(t);function i(o){return o&&o.__esModule?o:{default:o}}e.default=r.default,n.exports=e.default})(Gp,Gp.exports)),Gp.exports}var YY=XY();const KY=tu(YY);function JY(n){const[e,t]=Ze.useState(n);return n!==e&&(!n||!e||n.length!==e.length||n.some((r,i)=>r!==e[i]))?(t(n),n):e}function QY(n,[e,t]){const[r,i]=n;return r!==void 0&&i!==void 0&&e!==void 0&&t!==void 0&&e>r&&e-r<=20&&t<i?[r,t]:r!==e||i!==t?[e,t]:n}function ZY(n,e){let t=n?.clientWidth;if(t!==void 0&&e&&e.length>0){const r=[...e.filter(i=>i>0)].sort((i,o)=>o-i);r.push(Math.floor(r[r.length-1]/2)),t=r.find((i,o)=>i<=t||o===r.length-1)}return t}function Q_(n,e,t){const[[r],i]=Ze.useReducer(QY,[t]),o=JY(e),a=Ze.useRef(void 0);return{containerRef:Ze.useCallback(u=>{a.current?.disconnect(),a.current=void 0;const l=()=>i([ZY(u,o),window.innerWidth-document.documentElement.clientWidth]);l(),u&&typeof ResizeObserver<"u"&&(a.current=new ResizeObserver(l),a.current.observe(u)),typeof n=="function"?n(u):n&&(n.current=u)},[n,o]),containerWidth:r}}function eK(...n){return[...n].filter(Boolean).join(" ")}function cA(n){return["react-photo-album",n].filter(Boolean).join("--")}function tK(n){return`--${cA(n)}`}function ro({width:n,height:e}){return n/e}const nK=Object.freeze([1200,600,300,0]);function Vs(n,e){return typeof n=="function"?n(e):n}function hA(n,e){return e!==void 0?Vs(n,e):void 0}function rK(n,e){const t=nK.findIndex(r=>r<=e);return Vs(n[Math.max(t,0)],e)}function ld(n,e,t,r=0){if(e===void 0)return;const i=hA(n,e);return Math.round(Math.max(i===void 0?rK(t,e):i,r))}function Z_(n,{spacing:e,padding:t,componentsProps:r,render:i}){return{spacing:ld(e,n,[20,15,10,5]),padding:ld(t,n,[0,0,0,0]),componentsProps:Vs(r,n)||{},render:Vs(i,n)}}function cd(n,e=0){const t=10**e;return Math.round((n+Number.EPSILON)*t)/t}function iK(n,e,t,r,i,o,a){let s,u;const l=h=>{const f=o*(i-1)+2*a*i;return`calc((${h.match(/^\s*calc\((.*)\)\s*$/)?.[1]??h} - ${f}px) / ${cd((r-f)/t,5)})`},c=n.srcSet;return c&&c.length>0&&(s=c.concat(c.some(({width:h})=>h===n.width)?[]:[{src:n.src,width:n.width,height:n.height}]).sort((h,f)=>h.width-f.width).map(h=>`${h.src} ${h.width}w`).join(", ")),e?.size?u=(e.sizes||[]).map(({viewport:h,size:f})=>`${h} ${l(f)}`).concat(l(e.size)).join(", "):u=`${Math.ceil(t/r*100)}vw`,{srcSet:s,sizes:u}}function oK({as:n,render:e,context:t,classes:r=[],variables:i={},style:o,className:a,children:s,...u},l){const c=eK(...(Array.isArray(r)?r:[r]).filter(g=>typeof g=="string").map(cA),a),f={style:{...Object.fromEntries(Object.entries(i).map(([g,w])=>[tK(g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),typeof w=="number"?cd(w,5):w])),...o},className:c,children:s,...u};if(e){const g=e({ref:l,...f},t);if(g)return g}const m=n||"div";return ne.jsx(m,{ref:l,...f})}const $m=Ze.forwardRef(oK);function aK({photo:n,index:e,width:t,height:r,onClick:i,render:{wrapper:o,link:a,button:s,image:u,extras:l}={},componentsProps:{link:c,button:h,wrapper:f,image:m}={}},g){const{href:w}=n,v={photo:n,index:e,width:cd(t,3),height:cd(r,3)};let y;return w?y={...c,as:"a",render:a,classes:["photo","link"],href:w,onClick:i}:i?y={...h,as:"button",type:"button",render:s,classes:["photo","button"],onClick:i}:y={...f,render:o,classes:"photo"},ne.jsxs($m,{ref:g,variables:{photoWidth:v.width,photoHeight:v.height},context:v,...y,children:[ne.jsx($m,{as:"img",classes:"image",render:u,context:v,...m}),l?.({},v)]})}const sK=Ze.forwardRef(aK);function uK({layout:n,sizes:e,model:t,skeleton:r,onClick:i,render:{container:o,track:a,photo:s,...u}={},componentsProps:{container:l,track:c,link:h,button:f,wrapper:m,image:g}={}},w){const{spacing:v,padding:y,containerWidth:x,tracks:E,variables:_,horizontal:k}=t||{};return ne.jsxs($m,{role:"group","aria-label":"Photo album",...l,variables:{spacing:v,padding:y,containerWidth:x,..._},classes:["",n],render:o,ref:w,children:[v!==void 0&&y!==void 0&&x!==void 0&&E?.map(({photos:C,variables:A},I)=>{const T=C.length,R=k?T:E.length;return Ze.createElement($m,{...c,key:I,render:a,classes:"track",variables:{trackSize:T,...A}},C.map(N=>{const{photo:O,index:V,width:F}=N,{key:B,src:U,alt:P,title:L,label:H}=O,W=i?q=>{i({event:q,photo:O,index:V})}:void 0;if(s){const q=s({onClick:W},N);if(q)return q}const z=q=>H?{"aria-label":H,...q}:q;return ne.jsx(sK,{onClick:W,render:u,componentsProps:{image:{loading:"lazy",decoding:"async",src:U,alt:P,title:L,...iK(O,e,F,x,R,v,y),...Vs(g,N)},link:z(Vs(h,N)),button:z(Vs(f,N)),wrapper:Vs(m,N)},...N},B??U)}))}),x===void 0&&r]})}const e1=Ze.forwardRef(uK);function lK(n,{photos:e,targetRowHeight:t,rowConstraints:r,...i}){const{spacing:o,padding:a,componentsProps:s,render:u}=Z_(n,i),{singleRowMaxHeight:l,minPhotos:c,maxPhotos:h}=hA(r,n)||{};if(l!==void 0&&o!==void 0&&a!==void 0){const f=Math.floor(e.reduce((m,{width:g,height:w})=>m+g/w*l-2*a,a*e.length*2+o*(e.length-1)));f>0&&(s.container={...s.container},s.container.style={maxWidth:f,...s.container.style})}return{...i,targetRowHeight:ld(t,n,[f=>f/5,f=>f/4,f=>f/3,f=>f/2]),render:u,spacing:o,padding:a,minPhotos:c,maxPhotos:h,componentsProps:s}}function cK(n){return(e,t)=>n(t)-n(e)}function hK(n){let e=0;const t=[],r=(c,h)=>n(t[c],t[h])<0,i=(c,h)=>{const f=t[c];t[c]=t[h],t[h]=f},o=c=>{let h=c,f=Math.floor(h/2);for(;h>1&&r(f,h);)i(f,h),h=f,f=Math.floor(h/2)},a=c=>{let h=c,f=h*2;for(;f<=e&&(f<e&&r(f,f+1)&&(f+=1),!!r(h,f));)i(h,f),h=f,f=h*2};return{push:c=>{e+=1,t[e]=c,o(e)},pop:()=>{if(e===0)return;i(1,e),e-=1;const c=t.pop();return a(1),c},size:()=>e}}function dK(n,e,t){const r=new Map,i=new Set,o=new Map;o.set(e,0);const a=hK(cK(s=>s[1]));for(a.push([e,0]);a.size()>0;){const[s,u]=a.pop();if(!i.has(s)){const l=n(s);i.add(s),l.forEach((c,h)=>{const f=u+c,m=r.get(h),g=o.get(h);(g===void 0||g>f&&(g/f>1.005||m!==void 0&&m<s))&&(o.set(h,f),a.push([h,f]),r.set(h,s))})}}return o.has(t)?r:void 0}function fK(n,e){if(!n)return;const t=[];for(let r=e;r!==void 0;r=n.get(r))t.push(r);return t.reverse()}function pK(n,e,t){return fK(dK(n,e,t),t)}function mK(n,e,t,r){return cd(e/t/Math.min(...n.map(i=>ro(i))))+(r||0)+2}function dA(n,e,t,r){return(e-(n.length-1)*t-2*r*n.length)/n.reduce((i,o)=>i+ro(o),0)}function gK(n,e,t,r,i,o,a){const s=n.slice(e,t),u=dA(s,r,i,o);return u>0?(u-a)**2*s.length:void 0}function vK(n,e,t,r,i,o,a,s){return u=>{const l=new Map;l.set(u,0);const c=a||1,h=Math.min(o,s||1/0);for(let f=u+c;f<n.length+1&&!(f-u>h);f+=1){const m=gK(n,u,f,r,e,t,i);if(m===void 0)break;l.set(f,m)}return l}}function yK(n,e,t,r,i,o,a){const s=mK(n,r,i,o),u=vK(n,e,t,r,i,s,o,a),l=pK(u,0,n.length);if(!l)return;const c=[];for(let h=1;h<l.length;h+=1){const f=n.map((g,w)=>({photo:g,index:w})).slice(l[h-1],l[h]),m=dA(f.map(({photo:g})=>g),r,e,t);c.push({photos:f.map(({photo:g,index:w})=>({photo:g,index:w,width:m*ro(g),height:m}))})}return{spacing:e,padding:t,containerWidth:r,tracks:c,horizontal:!0}}function bK({photos:n,breakpoints:e,defaultContainerWidth:t,...r},i){const{containerRef:o,containerWidth:a}=Q_(i,e,t),{spacing:s,padding:u,targetRowHeight:l,minPhotos:c,maxPhotos:h,...f}=lK(a,{photos:n,...r}),m=Ze.useMemo(()=>a!==void 0&&s!==void 0&&u!==void 0&&l!==void 0?yK(n,s,u,a,l,c,h):void 0,[n,s,u,a,l,c,h]);return ne.jsx(e1,{layout:"rows",ref:o,model:m,...f})}const wK=Ze.forwardRef(bK);function _K(n,{columns:e,...t}){return{...t,...Z_(n,t),columns:ld(e,n,[5,4,3,2],1)}}function xK(n,e,t,r){const i=new Map,o=new Set;o.add(t);for(let a=0;a<e;a+=1){const s=[...o.keys()];o.clear(),s.forEach(u=>{const l=a>0?i.get(u)[a][1]:0;n(u).forEach(([c,h])=>{let f=i.get(c);f||(f=[],i.set(c,f));const m=l+h,g=f[a+1];(!g||g[1]>m&&(g[1]/m>1.0001||u<g[0]))&&(f[a+1]=[u,m]),a<e-1&&c!==r&&o.add(c)})})}return i}function SK(n,e,t){const r=[t];for(let i=t,o=e;o>0;o-=1)[i]=n.get(i)[o],r.push(i);return r.reverse()}function EK(n,e,t,r){return SK(xK(n,e,t,r),e,r)}function kK(n,e,t,r,i){return o=>{const a=[],s=i*1.5;let u=r/ro(n[o])+2*t;for(let l=o+1;l<n.length+1&&(a.push([l,(i-u)**2]),!(u>s||l===n.length));l+=1)u+=r/ro(n[l])+e+2*t;return a}}function Yk(n,e,t,r,i,o,a){const s=[],u=a.reduce((l,c)=>l+c,0);for(let l=0;l<n.length-1;l+=1){const c=e.map((m,g)=>({photo:m,index:g})).slice(n[l],n[l+1]),h=a.reduce((m,g,w)=>m+(o[l]-o[w])*g,0),f=(i-(n.length-2)*t-2*(n.length-1)*r-h)*a[l]/u;s.push({photos:c.map(({photo:m,index:g})=>({photo:m,index:g,width:f,height:f/ro(m)})),variables:{adjustedGaps:h,columnRatio:a[l]}})}return{tracks:s,variables:{totalRatio:u}}}function CK(n,e,t,r,i,o){const a=[],s=[];if(n.length<=o){const h=n.length>0?n.reduce((f,m)=>f+ro(m),0)/n.length:1;for(let f=0;f<o;f+=1)a[f]=2*t,s[f]=f<n.length?ro(n[f]):h;return Yk(Array.from({length:o+1},(f,m)=>Math.min(m,n.length)),n,e,t,r,a,s)}const u=(n.reduce((h,f)=>h+i/ro(f),0)+e*(n.length-o)+2*t*n.length)/o,l=kK(n,e,t,i,u),c=EK(l,o,0,n.length);for(let h=0;h<c.length-1;h+=1){const f=n.slice(c[h],c[h+1]);a[h]=e*(f.length-1)+2*t*f.length,s[h]=1/f.reduce((m,g)=>m+1/ro(g),0)}return Yk(c,n,e,t,r,a,s)}function fA(n,e,t,r,i){const o=(r-e*(i-1)-2*t*i)/i,{tracks:a,variables:s}=CK(n,e,t,r,o,i);return a.some(u=>u.photos.some(({width:l,height:c})=>l<0||c<0))?i>1?fA(n,e,t,r,i-1):void 0:{tracks:a,spacing:e,padding:t,containerWidth:r,variables:{columns:i,...s}}}function TK({photos:n,breakpoints:e,defaultContainerWidth:t,...r},i){const{containerRef:o,containerWidth:a}=Q_(i,e,t),{spacing:s,padding:u,columns:l,...c}=_K(a,{photos:n,...r}),h=Ze.useMemo(()=>a!==void 0&&s!==void 0&&u!==void 0&&l!==void 0?fA(n,s,u,a,l):void 0,[n,s,u,a,l]);return ne.jsx(e1,{layout:"columns",ref:o,model:h,...c})}const MK=Ze.forwardRef(TK);function RK(n,{columns:e,...t}){return{...t,...Z_(n,t),columns:ld(e,n,[5,4,3,2],1)}}function pA(n,e,t,r,i){const o=(r-e*(i-1)-2*t*i)/i;if(o<=0)return i>1?pA(n,e,t,r,i-1):void 0;const a=[];for(let u=0;u<i;u+=1)a[u]=0;const s=n.reduce((u,l,c)=>{const h=a.reduce((f,m,g)=>m<a[f]-1?g:f,0);return a[h]=a[h]+o/ro(l)+e+2*t,u[h].push({photo:l,index:c}),u},Array.from({length:i},()=>[]));return{spacing:e,padding:t,containerWidth:r,variables:{columns:i},tracks:s.map(u=>({photos:u.map(({photo:l,index:c})=>({photo:l,index:c,width:o,height:o/ro(l)}))}))}}function AK({photos:n,breakpoints:e,defaultContainerWidth:t,...r},i){const{containerRef:o,containerWidth:a}=Q_(i,e,t),{spacing:s,padding:u,columns:l,...c}=RK(a,{photos:n,...r}),h=Ze.useMemo(()=>a!==void 0&&s!==void 0&&u!==void 0&&l!==void 0?pA(n,s,u,a,l):void 0,[n,s,u,a,l]);return ne.jsx(e1,{layout:"masonry",ref:o,model:h,...c})}const IK=Ze.forwardRef(AK);function DK({layout:n,...e},t){return n==="rows"?ne.jsx(wK,{ref:t,...e}):n==="columns"?ne.jsx(MK,{ref:t,...e}):n==="masonry"?ne.jsx(IK,{ref:t,...e}):null}const NK=Ze.forwardRef(DK),PK=JSON.parse(`[{"link":"https://www.goodreads.com/book/show/35167718-what-do-you-care-what-other-people-think","title":"\\"What Do You Care What Other People Think?\\": Further Adventures of a Curious Character","title_without_series":"\\"What Do You Care What Other People Think?\\": Further Adventures of a Curious Character","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1516068365l/35167718._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1516068365l/35167718._SX98_.jpg","description":"One of the greatest physicists of the twentieth century, Richard Feynman possessed an unquenchable thirst for adventure and an unparalleled ability to tell the stories of his life. \\"What Do You Care What Other People Think?\\" is Feynman's last literary legacy, prepared with his friend and fellow drummer, Ralph Leighton.<br />Among the book's many tales we meet Feynman's first wife, Arlene, who taught him of love's irreducible mystery as she lay dying in a hospital bed while he worked nearby on the atomic bomb at Los Alamos. We are also given a fascinating narrative of the investigation of the space shuttle Challenger's explosion in 1986, and we relive the moment when Feynman revealed the disaster's cause by an elegant experiment: dropping a ring of rubber into a glass of cold water and pulling it out, misshapen.","num_pages":288,"authors":{"author":{"id":1429989,"name":"Richard P. Feynman","role":"","image_url":"https://images.gr-assets.com/authors/1498916887p5/1429989.jpg","small_image_url":"https://images.gr-assets.com/authors/1498916887p2/1429989.jpg","link":"https://www.goodreads.com/author/show/1429989.Richard_P_Feynman","average_rating":4.26,"ratings_count":367637,"text_reviews_count":15772}},"average_rating":4.19,"ratings_count":30789,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/38820046-21-lessons-for-the-21st-century","title":"21 Lessons for the 21st Century","title_without_series":"21 Lessons for the 21st Century","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SX98_.jpg","description":"<b>In<i> Sapiens, </i>he explored our past. In <i>Homo Deus, </i>he looked to our future<i>. </i>Now, one of the most innovative thinkers on the planet turns to the present to make sense of today's most pressing issues.</b><br /><br />How do computers and robots change the meaning of being human? How do we deal with the epidemic of fake news? Are nations and religions still relevant? What should we teach our children?<br /><br />Yuval Noah Harari's <i>21 Lessons for the 21st Century</i> is a probing and visionary investigation into today's most urgent issues as we move into the uncharted territory of the future. As technology advances faster than our understanding of it, hacking becomes a tactic of war, and the world feels more polarized than ever, Harari addresses the challenge of navigating life in the face of constant and disorienting change and raises the important questions we need to ask ourselves in order to survive.<br /><br />In twenty-one accessible chapters that are both provocative and profound, Harari builds on the ideas explored in his previous books, untangling political, technological, social, and existential issues and offering advice on how to prepare for a very different future from the world we now live in: How can we retain freedom of choice when Big Data is watching us? What will the future workforce look like, and how should we ready ourselves for it? How should we deal with the threat of terrorism? Why is liberal democracy in crisis?<br /><br />Harari's unique ability to make sense of where we have come from and where we are going has captured the imaginations of millions of readers. Here he invites us to consider values, meaning, and personal engagement in a world full of noise and uncertainty. When we are deluged with irrelevant information, clarity is power. Presenting complex contemporary challenges clearly and accessibly, <i>21 Lessons for the 21st Century</i> is essential reading.","num_pages":372,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.28,"ratings_count":1829708,"text_reviews_count":101707}},"average_rating":4.15,"ratings_count":178347,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13707738-boomerang","title":"Boomerang: Travels in the New Third World","title_without_series":"Boomerang: Travels in the New Third World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX98_.jpg","description":"The tsunami of cheap credit that rolled across the planet between 2002 and 2008 was more than a simple financial phenomenon: it was temptation, offering entire societies the chance to reveal aspects of their characters they could not normally afford to indulge.<br /><br /><br />Icelanders wanted to stop fishing and become investment bankers. The Greeks wanted to turn their country into a pinata stuffed with cash and allow as many citizens as possible to take a whack at it. The Germans wanted to be even more German; the Irish wanted to stop being Irish.<br /><br /><br />Michael Lewis's investigation of bubbles beyond our shores is so brilliantly, sadly hilarious that it leads the American reader to a comfortable complacency: oh, those foolish foreigners. But when he turns a merciless eye on California and Washington, DC, we see that the narrative is a trap baited with humor, and we understand the reckoning that awaits the greatest and greediest of debtor nations.","num_pages":218,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":3.9,"ratings_count":47556,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60321447-chip-war","title":"Chip War: The Fight for the World's Most Critical Technology","title_without_series":"Chip War: The Fight for the World's Most Critical Technology","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1662566820l/60321447._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1662566820l/60321447._SX98_.jpg","description":"An epic account of the decades-long battle to control what has emerged as the world's most critical resourcemicrochip technologywith the United States and China increasingly in conflict.<br /><br />You may be surprised to learn that microchips are the new oilthe scarce resource on which the modern world depends. Today, military, economic, and geopolitical power are built on a foundation of computer chips. Virtually <em>everything</em> from missiles to microwaves, smartphones to the stock market  runs on chips. Until recently, America designed and built the fastest chips and maintained its lead as the #1 superpower. Now, America's edge isslipping, undermined by competitors in Taiwan, Korea,Europe, and, above all, China. Today, as <i>Chip War</i> reveals, China, which spends more money each year importing chips than it spends importing oil,is pouring billions into a chip-building initiative to catch up to the US. At stake is America's military superiority and economic prosperity.<br /><br />Economic historian Chris Miller explains how the semiconductor came to play a critical role in modern life and how the U.S. become dominant in chip design and manufacturing and applied this technology to military systems. America's victory in the Cold War and its global military dominance stems from its ability to harness computing power more effectively than any other power. But here, too, China is catching up, with its chip-building ambitions and military modernization going hand in hand.America has let key components of the chip-building process slip out of its grasp, contributing not only to a worldwide chip shortage but also a new Cold War with a superpower adversary that is desperate to bridge the gap.<br /><br />Illuminating, timely, and fascinating, <i>Chip War</i> shows that, to make sense of the current state of politics, economics, and technology, we must first understand the vital role played by chips.","num_pages":431,"authors":{"author":{"id":10070,"name":"Chris   Miller","role":"","image_url":"https://images.gr-assets.com/authors/1675147491p5/10070.jpg","small_image_url":"https://images.gr-assets.com/authors/1675147491p2/10070.jpg","link":"https://www.goodreads.com/author/show/10070.Chris_Miller","average_rating":4.37,"ratings_count":43700,"text_reviews_count":3975}},"average_rating":4.4,"ratings_count":42026,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/34890015-factfulness","title":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","title_without_series":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SX98_.jpg","description":"<b><i>Factfulness:</i> The stress-reducing habit of only carrying opinions for which you have strong supporting facts.</b><br /><br />When asked simple questions about global trends<i>what percentage of the worlds population live in poverty; why the worlds population is increasing; how many girls finish school</i>we systematically get the answers wrong. So wrong that a chimpanzee choosing answers at random will consistently outguess teachers, journalists, Nobel laureates, and investment bankers.<br /><br />In <i>Factfulness</i>, Professor of International Health and global TED phenomenon Hans Rosling, together with his two long-time collaborators, Anna and Ola, offers <b>a radical new explanation of why this happens</b>. They reveal <b>the ten instincts that distort our perspective</b>from our tendency to divide the world into two camps (usually some version of <i>us</i> and <i>them</i>) to the way we consume media (where fear rules) to how we perceive progress (believing that most things are getting worse).<br /><br />Our problem is that we dont know what we dont know, and even our guesses are informed by unconscious and predictable biases.<br /><br /><b>It turns out that the world, for all its imperfections, is in a much better state than we might think.</b> That doesnt mean there arent real concerns. But when we worry about everything all the time instead of embracing a worldview based on facts, we can lose our ability to focus on the things that threaten us most.<br /><br />Inspiring and revelatory, filled with lively anecdotes and moving stories, <b><i>Factfulness </i>is an urgent and essential book that will change the way you see the world and empower you to respond to the crises and opportunities of the future. </b>","num_pages":342,"authors":{"author":{"id":2790706,"name":"Hans Rosling","role":"","image_url":"https://images.gr-assets.com/authors/1486521286p5/2790706.jpg","small_image_url":"https://images.gr-assets.com/authors/1486521286p2/2790706.jpg","link":"https://www.goodreads.com/author/show/2790706.Hans_Rosling","average_rating":4.35,"ratings_count":205985,"text_reviews_count":16365}},"average_rating":4.35,"ratings_count":202560,"publication_day":3,"publication_month":4,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/1150300.Fooled_by_Randomness","title":"Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets","title_without_series":"Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1336107222l/1150300._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1336107222l/1150300._SX98_.jpg","description":"<b><i>Fooled by Randomness </i>is a standalone book in Nassim Nicholas Talebs landmark Incerto series, an investigation of opacity, luck, uncertainty, probability, human error, risk, and decision-making in a world we dont understand. The other books in the series are <i>The Black Swan, Antifragile, </i>and <i>The Bed of Procrustes</i>.</b><br /><br />Now in a striking new hardcover edition, Fooled by Randomness is the word-of-mouth sensation that will change the way you think about business and the world. Nassim Nicholas Talebveteran trader, renowned risk expert, polymathic scholar, erudite raconteur, and New York Times bestselling author of The Black Swanhas written a modern classic that turns on its head what we believe about luck and skill.<br /><br /> This book is about luckor more precisely, about how we perceive and deal with luck in life and business. Set against the backdrop of the most conspicuous forum in which luck is mistaken for skillthe world of trading<i>Fooled by Randomness</i> provides captivating insight into one of the least understood factors in all our lives. Writing in an entertaining narrative style, the author tackles major intellectual issues related to the underestimation of the influence of happenstance on our lives.<br /><br /> The book is populated with an array of characters, some of whom have grasped, in their own way, the significance of chance: the baseball legend Yogi Berra; the philosopher of knowledge Karl Popper; the ancient worlds wisest man, Solon; the modern financier George Soros; and the Greek voyager Odysseus. We also meet the fictional Nero, who seems to understand the role of randomness in his professional life but falls victim to his own superstitious foolishness.<br /><br /> However, the most recognizable character of all remains unnamedthe lucky fool who happens to be in the right place at the right timehe embodies the survival of the least fit. Such individuals attract devoted followers who believe in their gurus insights and methods. But no one can replicate what is obtained by chance.<br /><br /> Are we capable of distinguishing the fortunate charlatan from the genuine visionary? Must we always try to uncover nonexistent messages in random events? It may be impossible to guard ourselves against the vagaries of the goddess Fortuna, but after reading <i>Fooled by Randomness</i> we can be a little better prepared.<br /><br /><b>\\n  <u>PRAISE FOR <i>FOOLED BY RANDOMNESS</i></u>\\n</b>:<br /><br /><b>Named by Fortune One of the Smartest Books of All Time<br /><br /> A Financial Times Best Business Book of the Year</b><br /><br /> [<i>Fooled by Randomness</i>] is to conventional Wall Street wisdom approximately what Martin Luthers ninety-five theses were to the Catholic Church.<br /> Malcolm Gladwell, author of <i>Blink</i><br /><br /> The book that rolled down Wall Street like a hand grenade.<br /> Maggie Mahar, author of <i>Bull! A History of the Boom, 19821999</i><br /><br /> Fascinating . . . Taleb will grab you.<br /> Peter L. Bernstein, author of <i>Capital Ideas Evolving</i><br /><br /> Recalls the best of scientist/essayists like Richard Dawkins . . . and Stephen Jay Gould.<br /> Michael Schrage, author of <i>Serious Play: How the Worlds Best Companies Simulate to Innovate</i><br /><br /> We need a book like this. . . . Fun to read, refreshingly independent-minded.<br /> Robert J. Shiller, author of <i>Irrational Exuberance </i><br /><br /> Powerful . . . loaded with crackling little insights [and] extreme brilliance.<br /><i>National Review</i>","num_pages":"","authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":309970,"text_reviews_count":21319}},"average_rating":4.08,"ratings_count":71660,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23281872-how-not-to-be-wrong","title":"How Not to Be Wrong: The Power of Mathematical Thinking","title_without_series":"How Not to Be Wrong: The Power of Mathematical Thinking","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SX98_.jpg","description":"Witty, compelling, and just plain fun to read . . .\\" Evelyn Lamb, Scientific American<br /><br />The Freakonomics of matha math-world superstar unveils the hidden beauty and logic of the world and puts its power in our hands<br /><br />The math we learn in school can seem like a dull set of rules, laid down by the ancients and not to be questioned. In How Not to Be Wrong , Jordan Ellenberg shows us how terribly limiting this view is: Math isnt confined to abstract incidents that never occur in real life, but rather touches everything we dothe whole world is shot through with it.<br /><br />Math allows us to see the hidden structures underneath the messy and chaotic surface of our world. Its a science of not being wrong, hammered out by centuries of hard work and argument. Armed with the tools of mathematics, we can see through to the true meaning of information we take for granted: How early should you get to the airport? What does public opinion really represent? Why do tall parents have shorter children? Who really won Florida in 2000? And how likely are you, really, to develop cancer?<br /><br />How Not to Be Wrong presents the surprising revelations behind all of these questions and many more, using the mathematicians method of analyzing life and exposing the hard-won insights of the academic community to the laymanminus the jargon. Ellenberg chases mathematical threads through a vast range of time and space, from the everyday to the cosmic, encountering, among other things, baseball, Reaganomics, daring lottery schemes, Voltaire, the replicability crisis in psychology, Italian Renaissance painting, artificial languages, the development of non-Euclidean geometry, the coming obesity apocalypse, Antonin Scalias views on crime and punishment, the psychology of slime molds, what Facebook can and cant figure out about you, and the existence of God.<br /><br />Ellenberg pulls from history as well as from the latest theoretical developments to provide those not trained in math with the knowledge they need. Math, as Ellenberg says, is an atomic-powered prosthesis that you attach to your common sense, vastly multiplying its reach and strength. With the tools of mathematics in hand, you can understand the world in a deeper, more meaningful way. How Not to Be Wrong will show you how.","num_pages":457,"authors":{"author":{"id":359894,"name":"Jordan Ellenberg","role":"","image_url":"https://images.gr-assets.com/authors/1622052352p5/359894.jpg","small_image_url":"https://images.gr-assets.com/authors/1622052352p2/359894.jpg","link":"https://www.goodreads.com/author/show/359894.Jordan_Ellenberg","average_rating":3.93,"ratings_count":23700,"text_reviews_count":2219}},"average_rating":3.95,"ratings_count":21440,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/218372426-moral-ambition","title":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","title_without_series":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1735426102l/218372426._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1735426102l/218372426._SX98_.jpg","description":"<b>From the author of the <i>New York Times</i> bestsellers <i>Humankind</i> and <i>Utopia for Realists</i>a more politically radical Malcolm Gladwell (<i>The New York Times</i>)comes a bold manifesto daring us to harness our talents and transform our idealism into action, all with the goal of making the world a wildly better place.</b><br /><br />A career consists of 2,000 workweeks, and how you spend that time is one of the most important decisions of your life. Still, millions of people are stuck in in mind-numbing, pointless, or just plain harmful jobs.<br /><br />Theres an antidote to this waste of talent, and its called moral ambition. Moral ambition is the will to be among the best, but with different measures of success. Not a fancy title, fat salary, or corner office, but a career dedicated to the best solutions to the worlds biggest problems whether that means tackling climate change, making pandemics history or fighting Big Tobacco.<br /><br />In <i>Moral Ambition</i>, internationally bestselling author Rutger Bregman reveals how our conventional definitions of success are harming us and the planet, and shows how we can shift the focus from personal gain to societal benefit. In the process, he explains, we will join a growing movement of pioneers who are already living out this ethos. Theyre the builders, the problem-solvers, the doers who have chosen a path less traveled. A guidebook to finding that path for ourselves, <i>Moral Ambition</i> reminds us that the real measure of success lies not in what we accumulate, but in what we contribute, and shows how we, too, can build a legacy that truly matters.","num_pages":"","authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.21,"ratings_count":142058,"text_reviews_count":14509}},"average_rating":3.76,"ratings_count":11313,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17662487-nudge","title":"Nudge: Improving Decisions About Health, Wealth, and Happiness","title_without_series":"Nudge: Improving Decisions About Health, Wealth, and Happiness","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SX98_.jpg","description":"For fans of Malcolm Gladwells Blink and Nobel Prize winner Daniel Kahnemans Thinking Fast and Slow, a revelatory new look at how we make decisions<br /><br />A New York Times bestseller<br />An Economist Best Book of the Year<br />A Financial Times Best Book of the Year<br /><br />Nudge is about choiceshow we make them and how we can make better ones. Drawing on decades of research in the fields of behavioral science and economics, authors Richard H. Thaler and Cass R. Sunstein offer a new perspective on preventing the countless mistakes we makeill-advised personal investments, consumption of unhealthy foods, neglect of our natural resourcesand show us how sensible choice architecture can successfully nudge people toward the best decisions. In the tradition of The Tipping Point and Freakonomics, Nudge is straightforward, informative, and entertaininga must-read for anyone interested in our individual and collective well-being.","num_pages":324,"authors":{"author":{"id":65483,"name":"Richard H. Thaler","role":"","image_url":"https://images.gr-assets.com/authors/1438885744p5/65483.jpg","small_image_url":"https://images.gr-assets.com/authors/1438885744p2/65483.jpg","link":"https://www.goodreads.com/author/show/65483.Richard_H_Thaler","average_rating":3.9,"ratings_count":119482,"text_reviews_count":6923}},"average_rating":3.84,"ratings_count":95033,"publication_day":24,"publication_month":2,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/25135194-prisoners-of-geography","title":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics (Politics of Place, #1)","title_without_series":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SX98_.jpg","description":"<i>Geography shapes not only our history, but where we're headed...</i><br /><br />All leaders are constrained by geography. Their choices are limited by mountains, rivers, seas and concrete. Yes, to follow world events you need to understand people, ideas and movements - but if you don't know geography, you'll never have the full picture.<br /><br />If you've ever wondered why Putin is so obsessed with Crimea, why the USA was destined to become a global superpower, or why China's power base continues to expand ever outwards, the answers are all here.<br /><br /><b>In ten chapters and ten maps, <i>Prisoners of Geography</i> looks at the past, present and future to offer an essential insight into one of the major factors that determines world history.<br /><br />It's time to put the 'geo' back into geopolitics.<br /><br />Ten maps; ten chapters:<br /><br />Russia * China * United States of America * Latin America * the Middle East * Africa * India and Pakistan * Europe * Japan and Korea * the Arctic</b>","num_pages":256,"authors":{"author":{"id":713466,"name":"Tim  Marshall","role":"","image_url":"https://images.gr-assets.com/authors/1489696759p5/713466.jpg","small_image_url":"https://images.gr-assets.com/authors/1489696759p2/713466.jpg","link":"https://www.goodreads.com/author/show/713466.Tim_Marshall","average_rating":4.14,"ratings_count":167924,"text_reviews_count":13897}},"average_rating":4.19,"ratings_count":118074,"publication_day":9,"publication_month":7,"publication_year":2015},{"link":"https://www.goodreads.com/book/show/54493401-project-hail-mary","title":"Project Hail Mary","title_without_series":"Project Hail Mary","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1764703833l/54493401._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1764703833l/54493401._SX98_.jpg","description":"<b>A LONE ASTRONAUT. <br />AN IMPOSSIBLE MISSION. <br />AN ALLY HE NEVER IMAGINED.</b><br /><br /><b> RYLAND GRACE</b> is the sole survivor on a desperate, last-chance missionand if he fails, humanity and Earth itself will perish.<br /><br />Except that right now, he doesnt know that. He cant even remember his own name, let alone the nature of his assignment or how to complete it.<br /><br />All he knows is that hes been asleep for a very, very long time. And hes just been awakened to find himself millions of miles from home, with nothing but two corpses for company.<br /><br />His crewmates dead, his memories fuzzily returning, Ryland realizes that an impossible task now confronts him. Hurtling through space on this tiny ship, its up to him to puzzle out an impossible scientific mysteryand conquer an extinction-level threat to our species.<br /><br />And with the clock ticking down and the nearest human being light-years away, hes got to do it all alone.<br /><br />Or does he?<br /><br />An irresistible interstellar adventure as only Andy Weir could imagine it, <i>Project Hail Mary</i> is a tale of discovery, speculation, and survival to rival <i>The Martian</i>while taking us to places it never dreamed of going.","num_pages":476,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.35,"ratings_count":2919335,"text_reviews_count":301814}},"average_rating":4.5,"ratings_count":1186092,"publication_day":4,"publication_month":5,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/54968118-the-code-breaker","title":"The Code Breaker: Jennifer Doudna, Gene Editing, and the Future of the Human Race","title_without_series":"The Code Breaker: Jennifer Doudna, Gene Editing, and the Future of the Human Race","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610894755l/54968118._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610894755l/54968118._SX98_.jpg","description":"When Jennifer Doudna was in sixth grade, she came home one day to find that her dad had left a paperback titled <i>The Double Helix</i> on her bed. As she sped through the pages, she became enthralled by the intense drama behind the competition to discover the code of life. Even though her high school counselor told her girls didnt become scientists, she decided she would.<br /><br />Driven by a passion to understand how nature works and to turn discoveries into inventions, she would help to make what the books author, James Watson, told her was the most important biological advance since his co-discovery of the structure of DNA. She and her collaborators turned <b></b>a curiosity of nature into an invention that will transform the human race: an easy-to-use tool that can edit DNA. Known as CRISPR, it opened a brave new world of medical miracles and moral questions.<br /> <br />The development of CRISPR and the race to create vaccines for coronavirus will hasten our transition to the next great innovation revolution. The past half-century has been a digital age, based on the microchip, computer, and internet. Now we are entering a life-science revolution. Children who study digital coding will be joined by those who study genetic code.<br /> <br />Should we use our new evolution-hacking powers to make us less susceptible to viruses? What a wonderful boon that would be! And what about preventing depression? HmmmShould we allow parents, if they can afford it, to enhance the height or muscles or IQ of their kids?<br /> <br />After helping to discover CRISPR, Doudna became a leader in wrestling with these moral issues and, with her collaborator Emmanuelle Charpentier, won the Nobel Prize in 2020.","num_pages":536,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2035307,"text_reviews_count":55219}},"average_rating":4.28,"ratings_count":41418,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18295861-the-first-fifteen-lives-of-harry-august","title":"The First Fifteen Lives of Harry August","title_without_series":"The First Fifteen Lives of Harry August","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SX98_.jpg","description":"Some stories cannot be told in just one lifetime. Harry August is on his deathbed. Again. No matter what he does or the decisions he makes, when death comes, Harry always returns to where he began, a child with all the knowledge of a life he has already lived a dozen times before. Nothing ever changes. Until now. As Harry nears the end of his eleventh life, a little girl appears at his bedside. \\"I nearly missed you, Doctor August,\\" she says. \\"I need to send a message.\\" This is the story of what Harry does next, and what he did before, and how he tries to save a past he cannot change and a future he cannot allow.","num_pages":416,"authors":{"author":{"id":7210024,"name":"Claire North","role":"","image_url":"https://images.gr-assets.com/authors/1440105009p5/7210024.jpg","small_image_url":"https://images.gr-assets.com/authors/1440105009p2/7210024.jpg","link":"https://www.goodreads.com/author/show/7210024.Claire_North","average_rating":3.91,"ratings_count":177283,"text_reviews_count":23738}},"average_rating":4.03,"ratings_count":99978,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/29807115-the-selfish-gene","title":"The Selfish Gene","title_without_series":"The Selfish Gene","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SX98_.jpg","description":"The million copy international bestseller, critically acclaimed and translated into over 25 languages. <br />As influential today as when it was first published, The Selfish Gene has become a classic exposition of evolutionary thought. Professor Dawkins articulates a gene's eye view of evolution - a view giving centre stage to these persistent units of information, and in which organisms can be seen as vehicles for their replication. This imaginative, powerful, and stylistically brilliant work not only brought the insights of Neo-Darwinism to a wide audience, but galvanized the biology community, generating much debate and stimulating whole new areas of research. Forty years later, its insights remain as relevant today as on the day it was published. <br />This 40th anniversary edition includes a new epilogue from the author discussing the continuing relevance of these ideas in evolutionary biology today, as well as the original prefaces and foreword, and extracts from early reviews. <br />Oxford Landmark Science books are 'must-read' classics of modern science writing which have crystallized big ideas, and shaped the way we think.<br />","num_pages":464,"authors":{"author":{"id":1194,"name":"Richard Dawkins","role":"","image_url":"https://images.gr-assets.com/authors/1377030297p5/1194.jpg","small_image_url":"https://images.gr-assets.com/authors/1377030297p2/1194.jpg","link":"https://www.goodreads.com/author/show/1194.Richard_Dawkins","average_rating":4.03,"ratings_count":763334,"text_reviews_count":30405}},"average_rating":4.16,"ratings_count":193438,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/20518872-the-three-body-problem","title":"The Three-Body Problem (Remembrance of Earths Past, #1)","title_without_series":"The Three-Body Problem","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1415428227l/20518872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1415428227l/20518872._SX98_.jpg","description":"Set against the backdrop of China's Cultural Revolution, a secret military project sends signals into space to establish contact with aliens. An alien civilization on the brink of destruction captures the signal and plans to invade Earth. Meanwhile, on Earth, different camps start forming, planning to either welcome the superior beings and help them take over a world seen as corrupt, or to fight against the invasion.","num_pages":472,"authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":960805,"text_reviews_count":90486}},"average_rating":4.08,"ratings_count":499704,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/599660.The_Undercover_Economist","title":"The Undercover Economist","title_without_series":"The Undercover Economist","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SX98_.jpg","description":"Who makes most money from the demand for cappuccinos early in the morning at Waterloo Station? Why is it impossible to get a foot on the property ladder? How does the Mafia make money from laundries when street gangs pushing drugs dont? Who really benefits from immigration? How can China, in just fifty years, go from the worlds worst famine to one of the greatest economic revolutions of all time, lifting a million people out of poverty a month?<br /><br />Looking at familiar situations in unfamiliar ways, THE UNDERCOVER ECONOMIST is a fresh explanation of the fundamental principles of the modern economy, illuminated by examples from the streets of London to the booming skyscrapers of Shanghai to the sleepy canals of Bruges. Leaving behind textbook jargon and equations, Tim Harford will reveal the games of signals and negotiations, contests of strength and battles of wit that drive not only the economy at large but the everyday choices we make.","num_pages":278,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60920,"text_reviews_count":4360}},"average_rating":3.81,"ratings_count":29576,"publication_day":"","publication_month":"","publication_year":2007},{"link":"https://www.goodreads.com/book/show/25516595-thinking-fast-and-slow","title":"Thinking, Fast and Slow","title_without_series":"Thinking, Fast and Slow","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SX98_.jpg","description":"<b>In the highly anticipated <i>Thinking, Fast and Slow</i>, Kahneman takes us on a groundbreaking tour of the mind and explains the two systems that drive the way we think.</b><br /><br />System 1 is fast, intuitive, and emotional; System 2 is slower, more deliberative, and more logical. Kahneman exposes the extraordinary capabilities  and also the faults and biases  of fast thinking, and reveals the pervasive influence of intuitive impressions on our thoughts and behavior. <br /><br />The impact of loss aversion and overconfidence on corporate strategies, the difficulties of predicting what will make us happy in the future, the challenges of properly framing risks at work and at home, the profound effect of cognitive biases on everything from playing the stock market to planning the next vacation  each of these can be understood only by knowing how the two systems work together to shape our judgments and decisions.<br /><br />Engaging the reader in a lively conversation about how we think, Kahneman reveals where we can and cannot trust our intuitions and how we can tap into the benefits of slow thinking. He offers practical and enlightening insights into how choices are made in both our business and our personal lives  and how we can use different techniques to guard against the mental glitches that often get us into trouble. <br /><br /><i>Thinking, Fast and Slow</i> will transform the way you think about thinking.","num_pages":504,"authors":{"author":{"id":72401,"name":"Daniel Kahneman","role":"","image_url":"https://images.gr-assets.com/authors/1615917414p5/72401.jpg","small_image_url":"https://images.gr-assets.com/authors/1615917414p2/72401.jpg","link":"https://www.goodreads.com/author/show/72401.Daniel_Kahneman","average_rating":4.15,"ratings_count":615861,"text_reviews_count":21554}},"average_rating":4.17,"ratings_count":592621,"publication_day":"","publication_month":"","publication_year":2012},{"link":"https://www.goodreads.com/book/show/40876575-utopia-for-realists","title":"Utopia for Realists: How We Can Build the Ideal World","title_without_series":"Utopia for Realists: How We Can Build the Ideal World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX98_.jpg","description":"<b>Universal basic income. A 15-hour workweek. Open borders. Does it sound too good to be true? One of Europe's leading young thinkers shows how we can build an ideal world today.</b> <br /><br />After working all day at jobs we often dislike, we buy things we don't need. Rutger Bregman, a Dutch historian, reminds us it needn't be this wayand in some places it isn't. Rutger Bregman's TED Talk about universal basic income seemed impossibly radical when he delivered it in 2014. A quarter of a million views later, the subject of that video is being seriously considered by leading economists and government leaders the world over. It's just one of the many utopian ideas that Bregman proves is possible today. <br /><br /><i>Utopia for Realists</i> is one of those rare books that takes you by surprise and challenges what you think can happen. From a Canadian city that once completely eradicated poverty, to Richard Nixon's near implementation of a basic income for millions of Americans, Bregman takes us on a journey through history, and beyond the traditional left-right divides, as he champions ideas whose time have come. <br /><br />Every progressive milestone of civilizationfrom the end of slavery to the beginning of democracywas once considered a utopian fantasy. Bregman's book, both challenging and bracing, demonstrates that new utopian ideas, like the elimination of poverty and the creation of the fifteen-hour workweek, can become a reality in our lifetime. Being unrealistic and unreasonable can in fact make the impossible inevitable, and it is the only way to build the ideal world.","num_pages":262,"authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.21,"ratings_count":142058,"text_reviews_count":14509}},"average_rating":4.21,"ratings_count":43273,"publication_day":14,"publication_month":3,"publication_year":2017}]`),FK=JSON.parse(`[{"link":"https://www.goodreads.com/book/show/35167718-what-do-you-care-what-other-people-think","title":"\\"What Do You Care What Other People Think?\\": Further Adventures of a Curious Character","title_without_series":"\\"What Do You Care What Other People Think?\\": Further Adventures of a Curious Character","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1516068365l/35167718._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1516068365l/35167718._SX98_.jpg","description":"One of the greatest physicists of the twentieth century, Richard Feynman possessed an unquenchable thirst for adventure and an unparalleled ability to tell the stories of his life. \\"What Do You Care What Other People Think?\\" is Feynman's last literary legacy, prepared with his friend and fellow drummer, Ralph Leighton.<br />Among the book's many tales we meet Feynman's first wife, Arlene, who taught him of love's irreducible mystery as she lay dying in a hospital bed while he worked nearby on the atomic bomb at Los Alamos. We are also given a fascinating narrative of the investigation of the space shuttle Challenger's explosion in 1986, and we relive the moment when Feynman revealed the disaster's cause by an elegant experiment: dropping a ring of rubber into a glass of cold water and pulling it out, misshapen.","num_pages":288,"authors":{"author":{"id":1429989,"name":"Richard P. Feynman","role":"","image_url":"https://images.gr-assets.com/authors/1498916887p5/1429989.jpg","small_image_url":"https://images.gr-assets.com/authors/1498916887p2/1429989.jpg","link":"https://www.goodreads.com/author/show/1429989.Richard_P_Feynman","average_rating":4.26,"ratings_count":367637,"text_reviews_count":15772}},"average_rating":4.19,"ratings_count":30789,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/30257963-12-rules-for-life","title":"12 Rules for Life: An Antidote to Chaos","title_without_series":"12 Rules for Life: An Antidote to Chaos","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1512705866l/30257963._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1512705866l/30257963._SX98_.jpg","description":"<b>What does everyone in the modern world need to know? Renowned psychologist Jordan B. Peterson's answer to this most difficult of questions uniquely combines the hard-won truths of ancient tradition with the stunning revelations of cutting-edge scientific research.</b><br /><br />Humorous, surprising, and informative, Dr. Peterson tells us why skateboarding boys and girls must be left alone, what terrible fate awaits those who criticize too easily, and why you should always pet a cat when you meet one on the street.<br /><br />What does the nervous system of the lowly lobster have to tell us about standing up straight (with our shoulders back) and about success in life? Why did ancient Egyptians worship the capacity to pay careful attention as the highest of gods? What dreadful paths do people tread when they become resentful, arrogant, and vengeful? Dr. Peterson journeys broadly, discussing discipline, freedom, adventure, and responsibility, distilling the world's wisdom into 12 practical and profound rules for life. <i>12 Rules for Life</i> shatters the modern commonplaces of science, faith, and human nature while transforming and ennobling the mind and spirit of its listeners.","num_pages":409,"authors":{"author":{"id":282885,"name":"Jordan B. Peterson","role":"","image_url":"https://images.gr-assets.com/authors/1651741136p5/282885.jpg","small_image_url":"https://images.gr-assets.com/authors/1651741136p2/282885.jpg","link":"https://www.goodreads.com/author/show/282885.Jordan_B_Peterson","average_rating":3.93,"ratings_count":320179,"text_reviews_count":23546}},"average_rating":3.9,"ratings_count":269380,"publication_day":23,"publication_month":1,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/38820046-21-lessons-for-the-21st-century","title":"21 Lessons for the 21st Century","title_without_series":"21 Lessons for the 21st Century","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SX98_.jpg","description":"<b>In<i> Sapiens, </i>he explored our past. In <i>Homo Deus, </i>he looked to our future<i>. </i>Now, one of the most innovative thinkers on the planet turns to the present to make sense of today's most pressing issues.</b><br /><br />How do computers and robots change the meaning of being human? How do we deal with the epidemic of fake news? Are nations and religions still relevant? What should we teach our children?<br /><br />Yuval Noah Harari's <i>21 Lessons for the 21st Century</i> is a probing and visionary investigation into today's most urgent issues as we move into the uncharted territory of the future. As technology advances faster than our understanding of it, hacking becomes a tactic of war, and the world feels more polarized than ever, Harari addresses the challenge of navigating life in the face of constant and disorienting change and raises the important questions we need to ask ourselves in order to survive.<br /><br />In twenty-one accessible chapters that are both provocative and profound, Harari builds on the ideas explored in his previous books, untangling political, technological, social, and existential issues and offering advice on how to prepare for a very different future from the world we now live in: How can we retain freedom of choice when Big Data is watching us? What will the future workforce look like, and how should we ready ourselves for it? How should we deal with the threat of terrorism? Why is liberal democracy in crisis?<br /><br />Harari's unique ability to make sense of where we have come from and where we are going has captured the imaginations of millions of readers. Here he invites us to consider values, meaning, and personal engagement in a world full of noise and uncertainty. When we are deluged with irrelevant information, clarity is power. Presenting complex contemporary challenges clearly and accessibly, <i>21 Lessons for the 21st Century</i> is essential reading.","num_pages":372,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.28,"ratings_count":1829708,"text_reviews_count":101707}},"average_rating":4.15,"ratings_count":178347,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55361205-a-promised-land","title":"A Promised Land","title_without_series":"A Promised Land","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1600357110l/55361205._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1600357110l/55361205._SX98_.jpg","description":"A riveting, deeply personal account of history in the making, from the president who inspired us to believe in the power of democracy. <br /><br />In the stirring, highly anticipated first volume of his presidential memoirs, Barack Obama tells the story of his improbable odyssey from young man searching for his identity to leader of the free world, describing in strikingly personal detail both his political education and the landmark moments of the first term of his historic presidencya time of dramatic transformation and turmoil.<br /><br />Obama takes readers on a compelling journey from his earliest political aspirations to the pivotal Iowa caucus victory that demonstrated the power of grassroots activism to the watershed night of November 4, 2008, when he was elected 44th president of the United States, becoming the first African American to hold the nations highest office.<br /><br />Reflecting on the presidency, he offers a unique and thoughtful exploration of both the awesome reach and the limits of presidential power, as well as singular insights into the dynamics of U.S. partisan politics and international diplomacy. Obama brings readers inside the Oval Office and the White House Situation Room, and to Moscow, Cairo, Beijing, and points beyond. We are privy to his thoughts as he assembles his cabinet, wrestles with a global financial crisis, takes the measure of Vladimir Putin, overcomes seemingly insurmountable odds to secure passage of the Affordable Care Act, clashes with generals about U.S. strategy in Afghanistan, tackles Wall Street reform, responds to the devastating Deepwater Horizon blowout, and authorizes Operation Neptunes Spear, which leads to the death of Osama bin Laden.<br /><br />A Promised Land is extraordinarily intimate and introspectivethe story of one mans bet with history, the faith of a community organizer tested on the world stage. Obama is candid about the balancing act of running for office as a Black American, bearing the expectations of a generation buoyed by messages of hope and change, and meeting the moral challenges of high-stakes decision-making. He is frank about the forces that opposed him at home and abroad, open about how living in the White House affected his wife and daughters, and unafraid to reveal self-doubt and disappointment. Yet he never wavers from his belief that inside the great, ongoing American experiment, progress is always possible.<br /><br />This beautifully written and powerful book captures Barack Obamas conviction that democracy is not a gift from on high but something founded on empathy and common understanding and built together, day by day.","num_pages":768,"authors":{"author":{"id":6356,"name":"Barack Obama","role":"","image_url":"https://images.gr-assets.com/authors/1602177326p5/6356.jpg","small_image_url":"https://images.gr-assets.com/authors/1602177326p2/6356.jpg","link":"https://www.goodreads.com/author/show/6356.Barack_Obama","average_rating":4.07,"ratings_count":708439,"text_reviews_count":39840}},"average_rating":4.31,"ratings_count":277498,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/28092883-a-short-history-of-nearly-everything","title":"A Short History of Nearly Everything","title_without_series":"A Short History of Nearly Everything","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1470437934l/28092883._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1470437934l/28092883._SX98_.jpg","description":"<b>The ultimate eye-opening journey through time and space, A Short History of Nearly Everything is the biggest-selling popular science book of the 21st century and has sold over 2 million copies.</b><br /><br />Bill Bryson describes himself as a reluctant traveller, but even when he stays safely at home he can't contain his curiosity about the world around him.<i> A Short History of Nearly Everything </i>is his quest to understand everything that has happened from the Big Bang to the rise of civilization - how we got from there, being nothing at all, to here, being us. Bill Bryson's challenge is to take subjects that normally bore the pants off most of us, like geology, chemistry and particle physics, and see if there isn't some way to render them comprehensible to people who have never thought they could be interested in science.<br /><br />The ultimate eye-opening journey through time and space, A Short History of Nearly Everything is the biggest-selling popular science book of the 21st century, and reveals the world in a way most of us have never seen it before.","num_pages":668,"authors":{"author":{"id":7,"name":"Bill Bryson","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/7.Bill_Bryson","average_rating":4.05,"ratings_count":1836822,"text_reviews_count":112800}},"average_rating":4.22,"ratings_count":424456,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/128029.A_Thousand_Splendid_Suns","title":"A Thousand Splendid Suns","title_without_series":"A Thousand Splendid Suns","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655336738l/128029._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655336738l/128029._SX98_.jpg","description":"Mariam is only fifteen when she is sent to Kabul to marry the troubled and bitter Rasheed, who is thirty years her senior. Nearly two decades later, in a climate of growing unrest, tragedy strikes fifteen-year-old Laila, who must leave her home and join Mariam's unhappy household. Laila and Mariam are to find consolation in each other, their friendship to grow as deep as the bond between sisters, as strong as the ties between mother and daughter. <br /><br />With the passing of time comes Taliban rule over Afghanistan, the streets of Kabul loud with the sound of gunfire and bombs, life a desperate struggle against starvation, brutality and fear, the women's endurance tested beyond their worst imaginings. Yet love can move people to act in unexpected ways, lead them to overcome the most daunting obstacles with a startling heroism. In the end it is love that triumphs over death and destruction. <br /><br /><i>A Thousand Splendid Suns</i> is a portrait of a wounded country and a story of family and friendship, of an unforgiving time, an unlikely bond, and an indestructible love.","num_pages":372,"authors":{"author":{"id":569,"name":"Khaled Hosseini","role":"","image_url":"https://images.gr-assets.com/authors/1359753468p5/569.jpg","small_image_url":"https://images.gr-assets.com/authors/1359753468p2/569.jpg","link":"https://www.goodreads.com/author/show/569.Khaled_Hosseini","average_rating":4.37,"ratings_count":5797591,"text_reviews_count":254238}},"average_rating":4.46,"ratings_count":1746617,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25666050-algorithms-to-live-by","title":"Algorithms to Live By: The Computer Science of Human Decisions","title_without_series":"Algorithms to Live By: The Computer Science of Human Decisions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1454296875l/25666050._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1454296875l/25666050._SX98_.jpg","description":"<b>A fascinating exploration of how insights from computer algorithms can be applied to our everyday lives, helping to solve common decision-making problems and illuminate the workings of the human mind</b><br /><br />All our lives are constrained by limited space and time, limits that give rise to a particular set of problems. What should we do, or leave undone, in a day or a lifetime? How much messiness should we accept? What balance of new activities and familiar favorites is the most fulfilling? These may seem like uniquely human quandaries, but they are not: computers, too, face the same constraints, so computer scientists have been grappling with their version of such issues for decades. And the solutions they've found have much to teach us.<br /><br />In a dazzlingly interdisciplinary work, acclaimed author Brian Christian and cognitive scientist Tom Griffiths show how the algorithms used by computers can also untangle very human questions. They explain how to have better hunches and when to leave things to chance, how to deal with overwhelming choices and how best to connect with others. From finding a spouse to finding a parking spot, from organizing one's inbox to understanding the workings of memory, <i>Algorithms to Live By</i> transforms the wisdom of computer science into strategies for human living.","num_pages":"","authors":{"author":{"id":4199891,"name":"Brian  Christian","role":"","image_url":"https://images.gr-assets.com/authors/1737681489p5/4199891.jpg","small_image_url":"https://images.gr-assets.com/authors/1737681489p2/4199891.jpg","link":"https://www.goodreads.com/author/show/4199891.Brian_Christian","average_rating":4.13,"ratings_count":45046,"text_reviews_count":4246}},"average_rating":4.12,"ratings_count":35142,"publication_day":19,"publication_month":4,"publication_year":2016},{"link":"https://www.goodreads.com/book/show/13030110-all-you-zombies","title":"All You Zombies","title_without_series":"All You Zombies","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338513108l/13030110._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338513108l/13030110._SX98_.jpg","description":"First published in The Magazine of Fantasy and Science Fiction - March, 1959 - the story involves a number of paradoxes caused by time travel. It further develops themes explored by the author in a previous work, \\"By His Bootstraps\\", published some 18 years earlier.","num_pages":13,"authors":{"author":{"id":205,"name":"Robert A. Heinlein","role":"","image_url":"https://images.gr-assets.com/authors/1192826560p5/205.jpg","small_image_url":"https://images.gr-assets.com/authors/1192826560p2/205.jpg","link":"https://www.goodreads.com/author/show/205.Robert_A_Heinlein","average_rating":3.94,"ratings_count":1327484,"text_reviews_count":51455}},"average_rating":4.07,"ratings_count":7371,"publication_day":"","publication_month":3,"publication_year":1959},{"link":"https://www.goodreads.com/book/show/22466476-antifragile-systems-and-teams","title":"Antifragile Systems and Teams","title_without_series":"Antifragile Systems and Teams","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1436603358l/22466476._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1436603358l/22466476._SX98_.jpg","description":"How Can DevOps Make You Antifragile?<br /><br />All complex computer systems eventually break, despite all of the heavy-handed, bureaucratic change-management processes we throw at them. But some systems are clearly more fragile than others, depending on how well they cope with stress. In this O'Reilly report, Dave Zwieback explains how the DevOps methodology can help make your system \\"antifragile.\\"<br /><br />Systems are fragile when organizations are unprepared to handle changing conditions. As generalists adept at several roles, DevOps practitioners adjust more easily to the fast pace of change. Rather than attempt to constrain volatility, DevOps embraces disorder, randomness, and impermanence to make systems even better.<br /><br />This concise report covers: Why Etsy, Netflix, and other antifragile companies constantly introduce volatility to test and upgrade their systemsHow DevOps removes the schism between developers and operations, enlisting developers to deploy as well as buildUsing continual experimentation and minor failures to make critical adjustments--and discover breakthroughsHow an overreliance on measurement and automation can make systems fragileWhy sharing increases trust, collaboration, and tribal knowledgeDownload this free report and learn how the DevOps philosophy of Culture, Automation, Measurement, and Sharing makes use of changing conditions and even embarrassing mistakes to help improve your system--and your organization.<br /><br />Dave Zwieback has been managing large-scale, mission-critical infrastructure and teams for 17 years.","num_pages":"","authors":{"author":{"id":7080009,"name":"Dave Zwieback","role":"","image_url":"https://images.gr-assets.com/authors/1755285050p5/7080009.jpg","small_image_url":"https://images.gr-assets.com/authors/1755285050p2/7080009.jpg","link":"https://www.goodreads.com/author/show/7080009.Dave_Zwieback","average_rating":3.71,"ratings_count":317,"text_reviews_count":37}},"average_rating":3.5,"ratings_count":60,"publication_day":1,"publication_month":4,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/13530973-antifragile","title":"Antifragile: Things That Gain from Disorder","title_without_series":"Antifragile: Things That Gain from Disorder","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1352422827l/13530973._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1352422827l/13530973._SX98_.jpg","description":"From the bestselling author of The Black Swan and one of the foremost philosophers of our time, Nassim Nicholas Taleb, a book on how some systems actually benefit from disorder.<br /><br />In The Black Swan Taleb outlined a problem; in <i>Antifragile</i> he offers a definitive solution: how to gain from disorder and chaos while being protected from fragilities and adverse events. For what he calls the \\"antifragile\\" is one step beyond robust, as it benefits from adversity, uncertainty and stressors, just as human bones get stronger when subjected to stress and tension.<br /><br />Taleb stands uncertainty on its head, making it desirable, and proposing that things be built in an antifragile manner. Extremely ambitious and multidisciplinary, <i>Antifragile</i> provides a blueprint for how to behaveand thrivein a world we don't understand and which is too uncertain for us to even try to understand. He who is not antifragile will perish. Why is the city state better than the nation state, why is debt bad for you, and why is almost everything modern bound to fail? The book covers innovation, health, biology, medicine, life decisions, politics, foreign policy, urban planning, war, personal finance, and economic systems. Throughout, the voice and recipes of the ancient wisdom from Phoenician, Roman, Greek, and Medieval sources are heard loud and clear.","num_pages":426,"authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":309970,"text_reviews_count":21319}},"average_rating":4.1,"ratings_count":57964,"publication_day":27,"publication_month":11,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/37707396-artemis","title":"Artemis","title_without_series":"Artemis","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1514317976l/37707396._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1514317976l/37707396._SX98_.jpg","description":"Jazz Bashara is a criminal.<br /> <br />Well, sort of. Life on Artemis, the first and only city on the moon, is tough if you're not a rich tourist or an eccentric billionaire. So smuggling in the occasional harmless bit of contraband barely counts, right? Not when you've got debts to pay and your job as a porter barely covers the rent.<br /> <br />Everything changes when Jazz sees the chance to commit the perfect crime, with a reward too lucrative to turn down. But pulling off the impossible is just the start of her problems, as she learns that she's stepped square into a conspiracy for control of Artemis itselfand that now, her only chance at survival lies in a gambit even riskier than the first.","num_pages":255,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.35,"ratings_count":2919335,"text_reviews_count":301814}},"average_rating":3.68,"ratings_count":329989,"publication_day":14,"publication_month":11,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/40121378-atomic-habits","title":"Atomic Habits: An Easy & Proven Way to Build Good Habits & Break Bad Ones","title_without_series":"Atomic Habits: An Easy & Proven Way to Build Good Habits & Break Bad Ones","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655988385l/40121378._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655988385l/40121378._SX98_.jpg","description":"No matter your goals, <i>Atomic Habits</i> offers a proven framework for improvingevery day. James Clear, one of the world's leading experts on habit formation, reveals practical strategies that will teach you exactly how to form good habits, break bad ones, and master the tiny behaviors that lead to remarkable results.<br /><br />If you're having trouble changing your habits, the problem isn't you. The problem is your system. Bad habits repeat themselves again and again not because you don't want to change, but because you have the wrong system for change. You do not rise to the level of your goals. You fall to the level of your systems. Here, you'll get a proven system that can take you to new heights.<br /><br />Clear is known for his ability to distill complex topics into simple behaviors that can be easily applied to daily life and work. Here, he draws on the most proven ideas from biology, psychology, and neuroscience to create an easy-to-understand guide for making good habits inevitable and bad habits impossible. Along the way, readers will be inspired and entertained with true stories from Olympic gold medalists, award-winning artists, business leaders, life-saving physicians, and star comedians who have used the science of small habits to master their craft and vault to the top of their field.<br /><br />Learn how to:<br />-Make time for new habits (even when life gets crazy);<br />-Overcome a lack of motivation and willpower;<br />- Design your environment to make success easier;<br />- Get back on track when you fall off course;<br />...and much more.<br /><br /><i>Atomic Habits</i> will reshape the way you think about progress and success, and give you the tools and strategies you need to transform your habits--whether you are a team looking to win a championship, an organization hoping to redefine an industry, or simply an individual who wishes to quit smoking, lose weight, reduce stress, or achieve any other goal.","num_pages":"","authors":{"author":{"id":7327369,"name":"James Clear","role":"","image_url":"https://images.gr-assets.com/authors/1393075384p5/7327369.jpg","small_image_url":"https://images.gr-assets.com/authors/1393075384p2/7327369.jpg","link":"https://www.goodreads.com/author/show/7327369.James_Clear","average_rating":4.31,"ratings_count":1336625,"text_reviews_count":79722}},"average_rating":4.32,"ratings_count":1318366,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/37976541-bad-blood","title":"Bad Blood: Secrets and Lies in a Silicon Valley Startup","title_without_series":"Bad Blood: Secrets and Lies in a Silicon Valley Startup","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523311515l/37976541._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523311515l/37976541._SX98_.jpg","description":"<b>The full inside story of the breathtaking rise and shocking collapse of a multibillion-dollar startup, by the prize-winning journalist who first broke the story and pursued it to the end in the face of pressure and threats from the CEO and her lawyers.</b> <br /><br />In 2014, Theranos founder and CEO Elizabeth Holmes was widely seen as the female Steve Jobs: a brilliant Stanford dropout whose startup \\"unicorn\\" promised to revolutionize the medical industry with a machine that would make blood tests significantly faster and easier. Backed by investors such as Larry Ellison and Tim Draper, Theranos sold shares in a fundraising round that valued the company at $9 billion, putting Holmes's worth at an estimated $4.7 billion. There was just one problem: The technology didn't work. <br /><br />For years, Holmes had been misleading investors, FDA officials, and her own employees. When Carreyrou, working at <i>The Wall Street Journal,</i> got a tip from a former Theranos employee and started asking questions, both Carreyrou and the <i>Journal</i> were threatened with lawsuits. Undaunted, the newspaper ran the first of dozens of Theranos articles in late 2015. By early 2017, the company's value was zero and Holmes faced potential legal action from the government and her investors. <br /><br />Here is the riveting story of the biggest corporate fraud since Enron, a disturbing cautionary tale set amid the bold promises and gold-rush frenzy of Silicon Valley.","num_pages":339,"authors":{"author":{"id":17575761,"name":"John Carreyrou","role":"","image_url":"https://images.gr-assets.com/authors/1637505627p5/17575761.jpg","small_image_url":"https://images.gr-assets.com/authors/1637505627p2/17575761.jpg","link":"https://www.goodreads.com/author/show/17575761.John_Carreyrou","average_rating":4.4,"ratings_count":283048,"text_reviews_count":23887}},"average_rating":4.4,"ratings_count":282862,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/38746485-becoming","title":"Becoming","title_without_series":"Becoming","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1528206996l/38746485._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1528206996l/38746485._SX98_.jpg","description":"In a life filled with meaning and accomplishment, Michelle Obama has emerged as one of the most iconic and compelling women of our era. As First Lady of the United States of Americathe first African American to serve in that roleshe helped create the most welcoming and inclusive White House in history, while also establishing herself as a powerful advocate for women and girls in the U.S. and around the world, dramatically changing the ways that families pursue healthier and more active lives, and standing with her husband as he led America through some of its most harrowing moments. Along the way, she showed us a few dance moves, crushed Carpool Karaoke, and raised two down-to-earth daughters under an unforgiving media glare. <br /> <br />In her memoir, a work of deep reflection and mesmerizing storytelling, Michelle Obama invites readers into her world, chronicling the experiences that have shaped herfrom her childhood on the South Side of Chicago to her years as an executive balancing the demands of motherhood and work, to her time spent at the worlds most famous address. With unerring honesty and lively wit, she describes her triumphs and her disappointments, both public and private, telling her full story as she has lived itin her own words and on her own terms. Warm, wise, and revelatory, Becoming is the deeply personal reckoning of a woman of soul and substance who has steadily defied expectationsand whose story inspires us to do the same.","num_pages":448,"authors":{"author":{"id":2338628,"name":"Michelle Obama","role":"","image_url":"https://images.gr-assets.com/authors/1658411922p5/2338628.jpg","small_image_url":"https://images.gr-assets.com/authors/1658411922p2/2338628.jpg","link":"https://www.goodreads.com/author/show/2338628.Michelle_Obama","average_rating":4.42,"ratings_count":1313378,"text_reviews_count":82730}},"average_rating":4.43,"ratings_count":1204194,"publication_day":13,"publication_month":11,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/31170723-behave","title":"Behave: The Biology of Humans at Our Best and Worst","title_without_series":"Behave: The Biology of Humans at Our Best and Worst","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517732866l/31170723._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517732866l/31170723._SX98_.jpg","description":"<b>Why do we do the things we do?</b><br /><br />More than a decade in the making, this game-changing book is Robert Sapolsky's genre-shattering attempt to answer that question as fully as perhaps only he could, looking at it from every angle. Sapolsky's storytelling concept is delightful but it also has a powerful intrinsic logic: he starts by looking at the factors that bear on a person's reaction in the precise moment a behavior occurs, and then hops back in time from there, in stages, ultimately ending up at the deep history of our species and its evolutionary legacy.<br /><br />And so the first category of explanation is the neurobiological one. A behavior occurswhether an example of humans at our best, worst, or somewhere in between. What went on in a person's brain a second before the behavior happened? Then Sapolsky pulls out to a slightly larger field of vision, a little earlier in time: What sight, sound, or smell caused the nervous system to produce that behavior? And then, what hormones acted hours to days earlier to change how responsive that individual is to the stimuli that triggered the nervous system? By now he has increased our field of vision so that we are thinking about neurobiology and the sensory world of our environment and endocrinology in trying to explain what happened.<br /><br />Sapolsky keeps going: How was that behavior influenced by structural changes in the nervous system over the preceding months, by that person's adolescence, childhood, fetal life, and then back to his or her genetic makeup? Finally, he expands the view to encompass factors larger than one individual. How did culture shape that individual's group, what ecological factors millennia old formed that culture? And on and on, back to evolutionary factors millions of years old.<br /><br />The result is one of the most dazzling tours d'horizon of the science of human behavior ever attempted, a majestic synthesis that harvests cutting-edge research across a range of disciplines to provide a subtle and nuanced perspective on why we ultimately do the things we do ... for good and for ill. Sapolsky builds on this understanding to wrestle with some of our deepest and thorniest questions relating to tribalism and xenophobia, hierarchy and competition, morality and free will, and war and peace. Wise, humane, often very funny, <i>Behave</i> is a towering achievement, powerfully humanizing, and downright heroic in its own right.","num_pages":790,"authors":{"author":{"id":187,"name":"Robert M. Sapolsky","role":"","image_url":"https://images.gr-assets.com/authors/1234040721p5/187.jpg","small_image_url":"https://images.gr-assets.com/authors/1234040721p2/187.jpg","link":"https://www.goodreads.com/author/show/187.Robert_M_Sapolsky","average_rating":4.29,"ratings_count":74814,"text_reviews_count":7900}},"average_rating":4.38,"ratings_count":32211,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/873537.Blink","title":"Blink: The Power of Thinking Without Thinking","title_without_series":"Blink: The Power of Thinking Without Thinking","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>'Mesmerizing' <i>Time</i></b><br /><br />An art expert instantly spots a fake. A cop decides whether to shoot. A psychologist accurately predicts a couple's future in minutes. This book is about those moments when we 'know' something without knowing why. It shows that honing your instincts could change the way you think about thinking forever. <br /><br />'Trust my snap judgement, buy this book: you'll be delighted' David Brooks, <i>The New York Times</i><br /><br />'Fiendishly clever' <i>Evening Standard</i><br /><br />'Provocative, fascinating, radical' Fergal Byrne, <i>Financial Times</i>","num_pages":277,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3176601,"text_reviews_count":132017}},"average_rating":3.96,"ratings_count":623636,"publication_day":"","publication_month":"","publication_year":2006},{"link":"https://www.goodreads.com/book/show/13707738-boomerang","title":"Boomerang: Travels in the New Third World","title_without_series":"Boomerang: Travels in the New Third World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX98_.jpg","description":"The tsunami of cheap credit that rolled across the planet between 2002 and 2008 was more than a simple financial phenomenon: it was temptation, offering entire societies the chance to reveal aspects of their characters they could not normally afford to indulge.<br /><br /><br />Icelanders wanted to stop fishing and become investment bankers. The Greeks wanted to turn their country into a pinata stuffed with cash and allow as many citizens as possible to take a whack at it. The Germans wanted to be even more German; the Irish wanted to stop being Irish.<br /><br /><br />Michael Lewis's investigation of bubbles beyond our shores is so brilliantly, sadly hilarious that it leads the American reader to a comfortable complacency: oh, those foolish foreigners. But when he turns a merciless eye on California and Washington, DC, we see that the narrative is a trap baited with humor, and we understand the reckoning that awaits the greatest and greediest of debtor nations.","num_pages":218,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":3.9,"ratings_count":47556,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/29780253-born-a-crime","title":"Born a Crime: Stories from a South African Childhood","title_without_series":"Born a Crime: Stories from a South African Childhood","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473867911l/29780253._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473867911l/29780253._SX98_.jpg","description":"The memoir of one mans coming-of-age, set during the twilight of apartheid and the tumultuous days of freedom that followed.<br /> <br />Trevor Noahs unlikely path from apartheid South Africa to the desk of The Daily Show began with a criminal act: his birth. Trevor was born to a white Swiss father and a black Xhosa mother at a time when such a union was punishable by five years in prison. Living proof of his parents indiscretion, Trevor was kept mostly indoors for the earliest years of his life, bound by the extreme and often absurd measures his mother took to hide him from a government that could, at any moment, steal him away. Finally liberated by the end of South Africas tyrannical white rule, Trevor and his mother set forth on a grand adventure, living openly and freely and embracing the opportunities won by a centuries-long struggle.<br /> <br /><i>Born a Crime</i> is the story of a mischievous young boy who grows into a restless young man as he struggles to find himself in a world where he was never supposed to exist. It is also the story of that young mans relationship with his fearless, rebellious, and fervently religious motherhis teammate, a woman determined to save her son from the cycle of poverty, violence, and abuse that would ultimately threaten her own life.","num_pages":289,"authors":{"author":{"id":15149526,"name":"Trevor Noah","role":"","image_url":"https://images.gr-assets.com/authors/1555600819p5/15149526.jpg","small_image_url":"https://images.gr-assets.com/authors/1555600819p2/15149526.jpg","link":"https://www.goodreads.com/author/show/15149526.Trevor_Noah","average_rating":4.48,"ratings_count":829632,"text_reviews_count":66253}},"average_rating":4.49,"ratings_count":812077,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6289283-born-to-run","title":"Born to Run: A Hidden Tribe, Superathletes, and the Greatest Race the World Has Never Seen","title_without_series":"Born to Run: A Hidden Tribe, Superathletes, and the Greatest Race the World Has Never Seen","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631519495l/6289283._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631519495l/6289283._SX98_.jpg","description":"Full of incredible characters, amazing athletic achievements, cutting-edge science, and, most of all, pure inspiration, <i>Born to Run</i> is an epic adventure that began with one simple question: Why does my foot hurt? In search of an answer, Christopher McDougall sets off to find a tribe of the worlds greatest distance runners and learn their secrets, and in the process shows us that everything we thought we knew about running is wrong.<br /><br />Isolated by the most savage terrain in North America, the reclusive Tarahumara Indians of Mexicos deadly Copper Canyons are custodians of a lost art. For centuries they have practiced techniques that allow them to run hundreds of miles without rest and chase down anything from a deer to an Olympic marathoner while enjoying every mile of it. Their superhuman talent is matched by uncanny health and serenity, leaving the Tarahumara immune to the diseases and strife that plague modern existence. With the help of Caballo Blanco, a mysterious loner who lives among the tribe, the author was able not only to uncover the secrets of the Tarahumara but also to find his own inner ultra-athlete, as he trained for the challenge of a lifetime: a fifty-mile race through the heart of Tarahumara country pitting the tribe against an odd band of Americans, including a star ultramarathoner, a beautiful young surfer, and a barefoot wonder.<br /><br />With a sharp wit and wild exuberance, McDougall takes us from the high-tech science labs at Harvard to the sun-baked valleys and freezing peaks across North America, where ever-growing numbers of ultrarunners are pushing their bodies to the limit, and, finally, to the climactic race in the Copper Canyons. <i>Born to Run</i> is that rare book that will not only engage your mind but inspire your body when you realize that the secret to happiness is right at your feet, and that you, indeed all of us, were born to run.","num_pages":287,"authors":{"author":{"id":133538,"name":"Christopher McDougall","role":"","image_url":"https://images.gr-assets.com/authors/1294361251p5/133538.jpg","small_image_url":"https://images.gr-assets.com/authors/1294361251p2/133538.jpg","link":"https://www.goodreads.com/author/show/133538.Christopher_McDougall","average_rating":4.27,"ratings_count":264650,"text_reviews_count":21904}},"average_rating":4.3,"ratings_count":235023,"publication_day":5,"publication_month":5,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/40277241-brief-answers-to-the-big-questions","title":"Brief Answers to the Big Questions","title_without_series":"Brief Answers to the Big Questions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1536862019l/40277241._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1536862019l/40277241._SX98_.jpg","description":"Stephen Hawking was recognized as one of the greatest minds of our time and a figure of inspiration after defying his ALS diagnosis at age twenty-one. He is known for both his breakthroughs in theoretical physics as well as his ability to make complex concepts accessible for all, and was beloved for his mischievous sense of humor. At the time of his death, Hawking was working on a final project: a book compiling his answers to the \\"big\\" questions that he was so often posed--questions that ranged beyond his academic field. <br /><br />Within these pages, he provides his personal views on our biggest challenges as a human race, and where we, as a planet, are heading next. Each section will be introduced by a leading thinker offering his or her own insight into Professor Hawking's contribution to our understanding.","num_pages":256,"authors":{"author":{"id":1401,"name":"Stephen W. Hawking","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1401.Stephen_W_Hawking","average_rating":4.19,"ratings_count":863691,"text_reviews_count":34590}},"average_rating":4.26,"ratings_count":88080,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/59616977-building-a-second-brain","title":"Building a Second Brain: A Proven Method to Organize Your Digital Life and Unlock Your Creative Potential","title_without_series":"Building a Second Brain: A Proven Method to Organize Your Digital Life and Unlock Your Creative Potential","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1652891488l/59616977._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1652891488l/59616977._SX98_.jpg","description":"&gt;For the first time in history, we have instantaneous access to the worlds knowledge. There has never been a better time to learn, to contribute, and to improve ourselves. Yet, rather than feeling empowered, we are often left feeling overwhelmed by this constant influx of information. The very knowledge that was supposed to set us free has instead led to the paralyzing stress of believing well never know or remember enough.<br /> <br />Now, this eye-opening and accessible guide shows how you can easily create your own personal system for knowledge management, otherwise known as a Second Brain. As a trusted and organized digital repository of your most valued ideas, notes, and creative work synced across all your devices and platforms, a Second Brain gives you the confidence to tackle your most important projects and ambitious goals. <br /> <br />Discover the full potential of your ideas and translate what you know into more powerful, more meaningful improvements in your work and life by <i>Building a Second Brain</i>.","num_pages":"","authors":{"author":{"id":17177938,"name":"Tiago Forte","role":"","image_url":"https://images.gr-assets.com/authors/1579580196p5/17177938.jpg","small_image_url":"https://images.gr-assets.com/authors/1579580196p2/17177938.jpg","link":"https://www.goodreads.com/author/show/17177938.Tiago_Forte","average_rating":4.04,"ratings_count":25551,"text_reviews_count":2517}},"average_rating":4.03,"ratings_count":21761,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/48889983-calling-bullshit","title":"Calling Bullshit: The Art of Skepticism in a Data-Driven World","title_without_series":"Calling Bullshit: The Art of Skepticism in a Data-Driven World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1592246867l/48889983._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1592246867l/48889983._SX98_.jpg","description":"<b>Bullshit isn't what it used to be.</b> <b>Now, two science professors give us the tools to dismantle misinformation and think clearly in a world of fake news and bad data.</b><br /><br />It's increasingly difficult to know what's true. Misinformation, disinformation, and fake news abound. Our media environment has become hyperpartisan. Science is conducted by press release. Startup culture elevates bullshit to high art. We are fairly well equipped to spot the sort of old-school bullshit that is based in fancy rhetoric and weasel words, but most of us don't feel qualified to challenge the avalanche of new-school bullshit presented in the language of math, science, or statistics. In <i>Calling Bullshit, </i> Professors Carl Bergstrom and Jevin West give us a set of powerful tools to cut through the most intimidating data.<br /><br />You don't need a lot of technical expertise to call out problems with data. Are the numbers or results too good or too dramatic to be true? Is the claim comparing like with like? Is it confirming your personal bias? Drawing on a deep well of expertise in statistics and computational biology, Bergstrom and West exuberantly unpack examples of selection bias and muddled data visualization, distinguish between correlation and causation, and examine the susceptibility of science to modern bullshit.<br /><br />We have always needed people who call bullshit when necessary, whether within a circle of friends, a community of scholars, or the citizenry of a nation. Now that bullshit has evolved, we need to relearn the art of skepticism.","num_pages":"","authors":{"author":{"id":5387403,"name":"Carl T. Bergstrom","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/5387403.Carl_T_Bergstrom","average_rating":4.1,"ratings_count":5421,"text_reviews_count":688}},"average_rating":4.11,"ratings_count":5346,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/31868165-captivate","title":"Captivate: The Science of Succeeding with People","title_without_series":"Captivate: The Science of Succeeding with People","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1489777793l/31868165._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1489777793l/31868165._SX98_.jpg","description":"Do you feel awkward at networking events? Do you wonder what your date really thinks of you? Do you wish you could decode people? You need to learn the science of people.<br /> <br />As a human behavior hacker, Vanessa Van Edwards created a research lab to study the hidden forces that drive us. And shes cracked the code. In Captivate, she shares shortcuts, systems, and secrets for taking charge of your interactions at work, at home, and in any social situation. These arent the people skills you learned in school. This is the first comprehensive, science backed, real life manual on how to captivate anyoneand a completely new approach to building connections.<br /> <br />Just like knowing the formulas to use in a chemistry lab, or the right programming language to build an app, Captivate provides simple ways to solve people problems. Youll learn, for example<br /> <br /> How to work a room: Every party, networking event, and social situation has a predictable map. Discover the sweet spot for making the most connections.<br /> How to read faces: Its easier than you think to speed-read facial expressions and use them to predict peoples emotions.<br /> How to talk to anyone: Every conversation can be memorableonce you learn how certain words generate the pleasure hormone dopamine in listeners.<br /><br />When you understand the laws of human behavior, your influence, impact, and income will increase significantly. Whats more, you will improve your interpersonal intelligence, make a killer first impression, and build rapport quickly and authentically in any situationnegotiations, interviews, parties, and pitches. Youll never interact the same way again.","num_pages":"","authors":{"author":{"id":6947464,"name":"Vanessa Van Edwards","role":"","image_url":"https://images.gr-assets.com/authors/1467470633p5/6947464.jpg","small_image_url":"https://images.gr-assets.com/authors/1467470633p2/6947464.jpg","link":"https://www.goodreads.com/author/show/6947464.Vanessa_Van_Edwards","average_rating":4.14,"ratings_count":12523,"text_reviews_count":1188}},"average_rating":4.11,"ratings_count":8607,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60321447-chip-war","title":"Chip War: The Fight for the World's Most Critical Technology","title_without_series":"Chip War: The Fight for the World's Most Critical Technology","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1662566820l/60321447._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1662566820l/60321447._SX98_.jpg","description":"An epic account of the decades-long battle to control what has emerged as the world's most critical resourcemicrochip technologywith the United States and China increasingly in conflict.<br /><br />You may be surprised to learn that microchips are the new oilthe scarce resource on which the modern world depends. Today, military, economic, and geopolitical power are built on a foundation of computer chips. Virtually <em>everything</em> from missiles to microwaves, smartphones to the stock market  runs on chips. Until recently, America designed and built the fastest chips and maintained its lead as the #1 superpower. Now, America's edge isslipping, undermined by competitors in Taiwan, Korea,Europe, and, above all, China. Today, as <i>Chip War</i> reveals, China, which spends more money each year importing chips than it spends importing oil,is pouring billions into a chip-building initiative to catch up to the US. At stake is America's military superiority and economic prosperity.<br /><br />Economic historian Chris Miller explains how the semiconductor came to play a critical role in modern life and how the U.S. become dominant in chip design and manufacturing and applied this technology to military systems. America's victory in the Cold War and its global military dominance stems from its ability to harness computing power more effectively than any other power. But here, too, China is catching up, with its chip-building ambitions and military modernization going hand in hand.America has let key components of the chip-building process slip out of its grasp, contributing not only to a worldwide chip shortage but also a new Cold War with a superpower adversary that is desperate to bridge the gap.<br /><br />Illuminating, timely, and fascinating, <i>Chip War</i> shows that, to make sense of the current state of politics, economics, and technology, we must first understand the vital role played by chips.","num_pages":431,"authors":{"author":{"id":10070,"name":"Chris   Miller","role":"","image_url":"https://images.gr-assets.com/authors/1675147491p5/10070.jpg","small_image_url":"https://images.gr-assets.com/authors/1675147491p2/10070.jpg","link":"https://www.goodreads.com/author/show/10070.Chris_Miller","average_rating":4.37,"ratings_count":43700,"text_reviews_count":3975}},"average_rating":4.4,"ratings_count":42026,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/61420096-choosing-to-run","title":"Choosing to Run: A Memoir","title_without_series":"Choosing to Run: A Memoir","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673265751l/61420096._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673265751l/61420096._SX98_.jpg","description":"Featuring both the story of an historic, unforgettable win and insight into the life of an indelible champion, Choosing to Run is a truly inspirational memoir from Boston Marathon winner and Olympian Des Linden, sharing her personal story and what motivates her to keep showing up.<br /><br />When Des woke up on April 16, 2018, the morning of the Boston Marathon, it was 39 degrees and raining, with high, gusty winds. The weather didnt bother her. In fact, she thought it might be a blessing. She was far from peak formrecovering from illness and questioning her running futureand didnt expect much of herself that day.<br /><br />But as she ticked off mile after mile in the brutal conditions, passing familiar landmarks on the course she knew by heart, something shifted. Opportunity unexpectedly presented itself. Des tapped into her inner strength and remembered all of the reasons she loved to race.<br /><br />Coming off Heartbreak Hill at Mile 22, Des took the lead and never relinquished it, becoming the 2018 Boston Marathon champion and the first American woman to win the race in thirty-three years.<br /><br />Her career has always been defined by tenacity and an independent spirit, stretching back to her first competitive race in San Diego, when she beat better-outfitted, more experienced kids. Des was a two-time All-American at Arizona State University, and as her collegiate years wound down, she decided she wasnt done with the sport. Des gambled on herself and moved to Michigan to give professional running a try. As she rose through the elite ranks, she became increasingly determined to do things her way in an industry often bound by the status quo.<br /><br />In her first book, readers will learn the story behind that the way Des trains, the way she thinks, her relationships with other great runners of her generation, and how much she values her family and friends. Theyll read about her deep connection to the most famous marathon in the world, her two very different Olympic experiences, and how she defined new goals and set a world record at the 50-kilometer distance.<br /><br />Most of all, theyll learn what makes her get up and run every day.","num_pages":"","authors":{"author":{"id":22522131,"name":"Des Linden","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/22522131.Des_Linden","average_rating":4.25,"ratings_count":12604,"text_reviews_count":1278}},"average_rating":4.25,"ratings_count":12604,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/75665850-clear-thinking","title":"Clear Thinking: Turning Ordinary Moments into Extraordinary Results","title_without_series":"Clear Thinking: Turning Ordinary Moments into Extraordinary Results","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350454l/75665850._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350454l/75665850._SX98_.jpg","description":"<b>Zjednodute si rozhodovn dky snadnm a vdou podloenm trikm</b><br /><br />Vtina knih o mylen vs vede k tomu, abyste byli vce racionln a nenechali se pevlcovat emocemi. Jene to samo o sob nesta. K chybm v sudku toti asto dochz v pln vednch chvlch, kdy vbec nezvaujete dsledky svch rozhodnut.<br /><br />Nikdo vs nezastav, kdy se chystte pilt olej do ohn odpovd kolegovi, kter prv zranil vae ego. Nikdo vm nezabrn zat hdku s partnerem, kterou budete brzy chtt vzt zptky. A nikdo vs neupozorn, e zrovna stojte ped rozhodnutm, kter navdy zmn trajektorii vaeho ivota.<br /><br />Vae mylen a rozhodovn neovlivuj jen emoce, ale i automatick reflexy nebo spoleensk normy. Shane Parrish vm ve sv knize uke, jak chyby pi pemlen pravdpodobn dlte. A nabdne vdecky podloen tipy a nstroje, dky nim se naute vyut plnou kapacitu svho uvaovn.<br /><br />Naute se dky nmu teba:<br /><br />- jac jsou tyi nejvt neptel jasnho mylen,<br />- jak vyuvat sv racionln mylen na maximum,<br />- jak upevnit sv siln strnky a zvldnout ty slab,<br />- jak sprvn zvit dlouhodob dopady vaich rozhodnut,<br />- co je to bezpenostn rezerva a pro je dleit na ni myslet,<br />- jak pomoc jasnho mylen doshnout spokojenosti v ivot<br />- a jak bt lepm partnerem, rodiem i kolegou.","num_pages":"","authors":{"author":{"id":7871969,"name":"Shane Parrish","role":"","image_url":"https://images.gr-assets.com/authors/1686056002p5/7871969.jpg","small_image_url":"https://images.gr-assets.com/authors/1686056002p2/7871969.jpg","link":"https://www.goodreads.com/author/show/7871969.Shane_Parrish","average_rating":4.12,"ratings_count":23334,"text_reviews_count":1913}},"average_rating":4.16,"ratings_count":10245,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/41022133-colorless-tsukuru-tazaki-and-his-years-of-pilgrimage","title":"Colorless Tsukuru Tazaki and His Years of Pilgrimage","title_without_series":"Colorless Tsukuru Tazaki and His Years of Pilgrimage","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1533141634l/41022133._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1533141634l/41022133._SX98_.jpg","description":"<b>INSTANT #1 <i>NEW YORK TIMES</i> BESTSELLER  One of the most revered voices in literature today gives us a story of love, friendship, and heartbreak for the ages.<br /><br />Mesmerizing, immersive, hallucinogenic.<i>Entertainment Weekly</i></b><br /><br /><i>Colorless Tsukuru Tazaki and His Years of Pilgrimage</i> is the remarkable story of a young man haunted by a great loss; of dreams and nightmares that have unintended consequences for the world around us; and of a journey into the past that is necessary to mend the present.<br /><br /><b>ONE OF THE BEST BOOKS OF THE YEAR: The New York Times Book Review, The Washington Post, Financial Times, St. Louis Post-Dispatch, Slate, Mother Jones, The Daily Beast, BookPage</b>","num_pages":308,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4260675,"text_reviews_count":366787}},"average_rating":3.87,"ratings_count":204059,"publication_day":12,"publication_month":8,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/6751.Consider_the_Lobster_and_Other_Essays","title":"Consider the Lobster and Other Essays","title_without_series":"Consider the Lobster and Other Essays","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"Do lobsters feel pain? Did Franz Kafka have a funny bone? What is John Updike's deal, anyway? And what happens when adult video starlets meet their fans in person? David Foster Wallace answers these questions and more in essays that are also enthralling narrative adventures. Whether covering the three-ring circus of a vicious presidential race, plunging into the wars between dictionary writers, or confronting the World's Largest Lobster Cooker at the annual Maine Lobster Festival, Wallace projects a quality of thought that is uniquely his and a voice as powerful and distinct as any in American letters.<br /><br />Contains: \\"Big Red Son,\\" \\"Certainly the End of Something or Other, One Would Sort of Have to Think,\\" \\"Some Remarks on Kafka's Funniness from Which Probably Not Enough Has Been Removed,\\" \\"Authority and American Usage,\\" \\"The View from Mrs. Thompson's,\\" \\"How Tracy Austin Broke My Heart,\\" \\"Up, Simba,\\" \\"Consider the Lobster,\\" \\"Joseph Frank's Dostoevsky\\" and \\"Host.\\"","num_pages":343,"authors":{"author":{"id":4339,"name":"David Foster Wallace","role":"","image_url":"https://images.gr-assets.com/authors/1615507112p5/4339.jpg","small_image_url":"https://images.gr-assets.com/authors/1615507112p2/4339.jpg","link":"https://www.goodreads.com/author/show/4339.David_Foster_Wallace","average_rating":4.11,"ratings_count":411981,"text_reviews_count":42091}},"average_rating":4.18,"ratings_count":54371,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55757377-covered-calls-for-beginners","title":"Covered Calls for Beginners: A Risk-Free Way to Collect \\"Rental Income\\" Every Single Month on Stocks You Already Own (Options Trading for Beginners Book 1)","title_without_series":"Covered Calls for Beginners: A Risk-Free Way to Collect \\"Rental Income\\" Every Single Month on Stocks You Already Own","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"","num_pages":"","authors":{"author":{"id":20400935,"name":"Freeman Publications","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/20400935.Freeman_Publications","average_rating":4.2,"ratings_count":2711,"text_reviews_count":246}},"average_rating":4.23,"ratings_count":344,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25451264-death-s-end","title":"Death's End (Remembrance of Earths Past, #3)","title_without_series":"Death's End","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1430330507l/25451264._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1430330507l/25451264._SX98_.jpg","description":"With The Three-Body Problem, English-speaking readers got their first chance to experience the multiple-award-winning and bestselling Three-Body Trilogy by China's most beloved science fiction author, Cixin Liu. Three-Body was released to great acclaim including coverage in The New York Times and The Wall Street Journal. It was also named a finalist for the Nebula Award, making it the first translated novel to be nominated for a major SF award since Italo Calvino's Invisible Cities in 1976.<br /><br />Now this epic trilogy concludes with Death's End. Half a century after the Doomsday Battle, the uneasy balance of Dark Forest Deterrence keeps the Trisolaran invaders at bay. Earth enjoys unprecedented prosperity due to the infusion of Trisolaran knowledge. With human science advancing daily and the Trisolarans adopting Earth culture, it seems that the two civilizations will soon be able to co-exist peacefully as equals without the terrible threat of mutually assured annihilation. But the peace has also made humanity complacent.<br /><br />Cheng Xin, an aerospace engineer from the early 21st century, awakens from hibernation in this new age. She brings with her knowledge of a long-forgotten program dating from the beginning of the Trisolar Crisis, and her very presence may upset the delicate balance between two worlds. Will humanity reach for the stars or die in its cradle?","num_pages":604,"authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":960805,"text_reviews_count":90486}},"average_rating":4.4,"ratings_count":173950,"publication_day":20,"publication_month":9,"publication_year":2016},{"link":"https://www.goodreads.com/book/show/6617037-debt","title":"Debt: The First 5,000 Years","title_without_series":"Debt: The First 5,000 Years","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1728517587l/6617037._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1728517587l/6617037._SX98_.jpg","description":"<b>Before there was money, there was debt</b>.<br /><br />Every economics textbook says the same thing: Money was invented to replace onerous and complicated barter systemsto relieve ancient people from having to haul their goods to market. The problem with this version of history? Theres not a shred of evidence to support it.<br /><br />Here anthropologist David Graeber presents a stunning reversal of conventional wisdom. He shows that for more than 5,000 years, since the beginnings of the first agrarian empires, humans have used elaborate credit systems to buy and sell goodsthat is, long before the invention of coins or cash. It is in this era, Graeber argues, that we also first encounter a society divided into debtors and creditors. <br /><br />Graeber shows that arguments about debt and debt forgiveness have been at the center of political debates from Italy to China, as well as sparking innumerable insurrections. He also brilliantly demonstrates that the language of the ancient works of law and religion(words like guilt, sin, and redemption) derive in large part from ancient debates about debt, and shape even our most basic ideas of right and wrong. We are still fighting these battles today without knowing it.<br /><br /><i>Debt: The First 5,000 Years </i>is a fascinating chronicle of this little known historyas well as how it has defined human history, and what it means for the credit crisis of the present day and the future of our economy.","num_pages":534,"authors":{"author":{"id":29101,"name":"David Graeber","role":"","image_url":"https://images.gr-assets.com/authors/1479657149p5/29101.jpg","small_image_url":"https://images.gr-assets.com/authors/1479657149p2/29101.jpg","link":"https://www.goodreads.com/author/show/29101.David_Graeber","average_rating":4.11,"ratings_count":106865,"text_reviews_count":14373}},"average_rating":4.21,"ratings_count":27095,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50927537-deceiving-the-sky","title":"Deceiving the Sky: Inside Communist China's Drive for Global Supremacy","title_without_series":"Deceiving the Sky: Inside Communist China's Drive for Global Supremacy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"The United States' approach to China since the Communist regime in Beijing began the period of reform and opening in the 1980s was based on a promise that trade and engagement with China would result in a peaceful, democratic state.<br /><br />Forty years later the hope of producing a benign People's Republic of China utterly failed. The Communist Party of China deceived the West into believing that the its system and the Party-ruled People's Liberation Army were peaceful and posed no threat. In fact, these misguided policies produced the emergence of a 21st Century Evil Empire even more dangerous than a Cold War version in the Soviet Union.<br /><br />Successive American presidential administrations were fooled by ill-advised pro-China policymakers, intelligence analysts and business leaders who facilitated the rise not of a peaceful China but a threatening and expansionist nuclear-armed communist dictatorship not focused on a single overriding strategic objective: Weakening and destroying the United States of America.<br /><br />Defeating the United States is the first step for China's current rulers in achieving global supremacy under a new world order based an ideology of Communism with Chinese characteristics.<br /><br />The process included technology theft of American companies that took place on a massive scale through cyber theft and unfair trade practices. The losses directly supported in the largest and most significant buildup of the Chinese military that now directly threatens American and allied interests around the world. The military threat is only half the danger as China aggressively pursues regional and international control using a variety of non-military forces, including economic, cyber and space warfare and large-scale influence operations.<br /><br /><i>Deceiving the Sky: Inside Communist China's Drive for Global Supremacy</i> details the failure to understand the nature and activities of the dangers posed by China and what the United States can do in taking needed steps to counter the threats.","num_pages":"","authors":{"author":{"id":86575,"name":"Bill Gertz","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/86575.Bill_Gertz","average_rating":3.61,"ratings_count":745,"text_reviews_count":94}},"average_rating":3.96,"ratings_count":225,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25744928-deep-work","title":"Deep Work: Rules for Focused Success in a Distracted World","title_without_series":"Deep Work: Rules for Focused Success in a Distracted World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1447957962l/25744928._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1447957962l/25744928._SX98_.jpg","description":"<b>One of the most valuable skills in our economy is becoming increasingly rare. If you master this skill, you'll achieve extraordinary results.</b><br /><br />Deep work is the ability to focus without distraction on a cognitively demanding task. It's a skill that allows you to quickly master complicated information and produce better results in less time. Deep work will make you better at what you do and provide the sense of true fulfillment that comes from craftsmanship. In short, deep work is like a super power in our increasingly competitive twenty-first century economy. And yet, most people have lost the ability to go deep-spending their days instead in a frantic blur of e-mail and social media, not even realizing there's a better way.<br /><br />In <i>Deep Work</i>, author and professor Cal Newport flips the narrative on impact in a connected age. Instead of arguing distraction is bad, he instead celebrates the power of its opposite. Dividing this book into two parts, he first makes the case that in almost any profession, cultivating a deep work ethic will produce massive benefits. He then presents a rigorous training regimen, presented as a series of four \\"rules,\\" for transforming your mind and habits to support this skill.<br /><br />A mix of cultural criticism and actionable advice, <i>Deep Work</i> takes the reader on a journey through memorable stories-from Carl Jung building a stone tower in the woods to focus his mind, to a social media pioneer buying a round-trip business class ticket to Tokyo to write a book free from distraction in the air-and no-nonsense advice, such as the claim that most serious professionals should quit social media and that you should practice being bored. <i>Deep Work</i> is an indispensable guide to anyone seeking focused success in a distracted world.","num_pages":296,"authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":385941,"text_reviews_count":34848}},"average_rating":4.16,"ratings_count":190616,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/11125.Digital_Fortress","title":"Digital Fortress","title_without_series":"Digital Fortress","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360095966l/11125._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360095966l/11125._SX98_.jpg","description":"<i>This an alternate cover for</i> <a href=\\"https://www.goodreads.com/book/show/44775909.9780552151696\\" title=\\"9780552151696\\" rel=\\"nofollow noopener\\">9780552151696</a> <br /><br />When the NSA's invincible code-breaking machine encounters a mysterious code it cannot break, the agency calls its head cryptographer, Susan Fletcher, a brilliant and beautiful mathematician. What she uncovers sends shock waves through the corridors of power. The NSA is being held hostage...not by guns or bombs, but by a code so ingeniously complex that if released it would cripple U.S. intelligence.<br /><br />Caught in an accelerating tempest of secrecy and lies, Susan Fletcher battles to save the agency she believes in. Betrayed on all sides, she finds herself fighting not only for her country but for her life, and in the end, for the life of the man she loves.<br /><br />From the underground hallways of power to the skyscrapers of Tokyo to the towering cathedrals of Spain, a desperate race unfolds. It is a battle for survival--a crucial bid to destroy a creation of inconceivable genius...an impregnable code-writing formula that threatens to obliterate the post-cold war balance of power. Forever.","num_pages":510,"authors":{"author":{"id":630,"name":"Dan    Brown","role":"","image_url":"https://images.gr-assets.com/authors/1751545491p5/630.jpg","small_image_url":"https://images.gr-assets.com/authors/1751545491p2/630.jpg","link":"https://www.goodreads.com/author/show/630.Dan_Brown","average_rating":3.9,"ratings_count":9171979,"text_reviews_count":238758}},"average_rating":3.71,"ratings_count":666426,"publication_day":"","publication_month":"","publication_year":2004},{"link":"https://www.goodreads.com/book/show/40672036-digital-minimalism","title":"Digital Minimalism: Choosing a Focused Life in a Noisy World","title_without_series":"Digital Minimalism: Choosing a Focused Life in a Noisy World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1549433350l/40672036._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1549433350l/40672036._SX98_.jpg","description":"Minimalism is the art of knowing how much is just enough. Digital minimalism applies this idea to our personal technology. It's the key to living a focused life in an increasingly noisy world.<br /><br />In this timely and enlightening book, the bestselling author of Deep Work introduces a philosophy for technology use that has already improved countless lives.<br /><br />Digital minimalists are all around us. They're the calm, happy people who can hold long conversations without furtive glances at their phones. They can get lost in a good book, a woodworking project, or a leisurely morning run. They can have fun with friends and family without the obsessive urge to document the experience. They stay informed about the news of the day, but don't feel overwhelmed by it. They don't experience \\"fear of missing out\\" because they already know which activities provide them meaning and satisfaction.<br /><br />Now, Newport gives us a name for this quiet movement, and makes a persuasive case for its urgency in our tech-saturated world. Common sense tips, like turning off notifications, or occasional rituals like observing a digital sabbath, don't go far enough in helping us take back control of our technological lives, and attempts to unplug completely are complicated by the demands of family, friends and work. What we need instead is a thoughtful method to decide what tools to use, for what purposes, and under what conditions.<br /><br />Drawing on a diverse array of real-life examples, from Amish farmers to harried parents to Silicon Valley programmers, Newport identifies the common practices of digital minimalists and the ideas that underpin them. He shows how digital minimalists are rethinking their relationship to social media, rediscovering the pleasures of the offline world, and reconnecting with their inner selves through regular periods of solitude. He then shares strategies for integrating these practices into your life, starting with a thirty-day \\"digital declutter\\" process that has already helped thousands feel less overwhelmed and more in control.<br /><br />Technology is intrinsically neither good nor bad. The key is using it to support your goals and values, rather than letting it use you. This book shows the way.","num_pages":302,"authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":385941,"text_reviews_count":34848}},"average_rating":4.05,"ratings_count":96014,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55723020-dopamine-nation","title":"Dopamine Nation: Finding Balance in the Age of Indulgence","title_without_series":"Dopamine Nation: Finding Balance in the Age of Indulgence","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629679336l/55723020._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629679336l/55723020._SX98_.jpg","description":"This book is about pleasure. It's also about pain. Most important, it's about how to find the delicate balance between the two, and why now more than ever finding balance is essential. We're living in a time of unprecedented access to high-reward, high-dopamine stimuli: drugs, food, news, gambling, shopping, gaming, texting, sexting, Facebooking, Instagramming, YouTubing, tweeting... The increased numbers, variety, and potency is staggering. The smartphone is the modern-day hypodermic needle, delivering digital dopamine 24/7 for a wired generation. As such we've all become vulnerable to compulsive overconsumption.<br /><br />In <i>Dopamine Nation</i>, Dr. Anna Lembke, psychiatrist and author, explores the exciting new scientific discoveries that explain why the relentless pursuit of pleasure leads to pain...and what to do about it. Condensing complex neuroscience into easy-to-understand metaphors, Lembke illustrates how finding contentment and connectedness means keeping dopamine in check. The lived experiences of her patients are the gripping fabric of her narrative. Their riveting stories of suffering and redemption give us all hope for managing our consumption and transforming our lives. In essence, <i>Dopamine Nation </i>shows that the secret to finding balance is combining the science of desire with the wisdom of recovery.<br /><br /><b>\\"Brilliant... riveting, scary, cogent, and cleverly argued.\\"--Beth Macy, author of <i>Dopesick</i></b><br /><br /><br />INSTANT NEW YORK TIMES and LOS ANGELES TIMES BESTSELLER<br />Brilliant riveting, scary, cogent, and cleverly argued.Beth Macy, author of Dopesick<br />As heard on Fresh Air","num_pages":304,"authors":{"author":{"id":15190376,"name":"Anna Lembke","role":"","image_url":"https://images.gr-assets.com/authors/1642883127p5/15190376.jpg","small_image_url":"https://images.gr-assets.com/authors/1642883127p2/15190376.jpg","link":"https://www.goodreads.com/author/show/15190376.Anna_Lembke","average_rating":3.86,"ratings_count":82809,"text_reviews_count":7274}},"average_rating":3.88,"ratings_count":86760,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/122765395-elon-musk","title":"Elon Musk","title_without_series":"Elon Musk","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1692288251l/122765395._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1692288251l/122765395._SX98_.jpg","description":"<b>From the author of <i>Steve Jobs</i> and other bestselling biographies, this is the astonishingly intimate story of the most fascinating and controversial innovator of our eraa rule-breaking visionary who helped to lead the world into the era of electric vehicles, private space exploration, and artificial intelligence. Oh, and took over Twitter.</b><br /><br />When Elon Musk was a kid in South Africa, he was regularly beaten by bullies. One day a group pushed him down some concrete steps and kicked him until his face was a swollen ball of flesh. He was in the hospital for a week. But the physical scars were minor compared to the emotional ones inflicted by his father, an engineer, rogue, and charismatic fantasist.<br /><br />His fathers impact on his psyche would linger. He developed into a tough yet vulnerable man-child, prone to abrupt Jekyll-and-Hyde mood swings, with an exceedingly high tolerance for risk, a craving for drama, an epic sense of mission, and a maniacal intensity that was callous and at times destructive.<br /><br />At the beginning of 2022after a year marked by SpaceX launching thirty-one rockets into orbit, Tesla selling a million cars, and him becoming the richest man on earthMusk spoke ruefully about his compulsion to stir up dramas. I need to shift my mindset away from being in crisis mode, which it has been for about fourteen years now, or arguably most of my life, he said.<br /><br />It was a wistful comment, not a New Years resolution. Even as he said it, he was secretly buying up shares of Twitter, the worlds ultimate playground. Over the years, whenever he was in a dark place, his mind went back to being bullied on the playground. Now he had the chance to own the playground.<br /><br />For two years, Isaacson shadowed Musk, attended his meetings, walked his factories with him, and spent hours interviewing him, his family, friends, coworkers, and adversaries. The result is the revealing inside story, filled with amazing tales of triumphs and turmoil, that addresses the are the demons that drive Musk also what it takes to drive innovation and progress?","num_pages":688,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2035307,"text_reviews_count":55219}},"average_rating":4.33,"ratings_count":76570,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60690050-engineering-in-plain-sight","title":"Engineering in Plain Sight: An Illustrated Field Guide to the Constructed Environment","title_without_series":"Engineering in Plain Sight: An Illustrated Field Guide to the Constructed Environment","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1648243628l/60690050._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1648243628l/60690050._SX98_.jpg","description":"Engineering in Plain Sight is a beautifully illustrated field guide to the infrastructure around us.<br /><br />Engineering in Plain Sight extends the field guide genre from natural phenomena to human-made structures, making them approachable and understandable to non-engineers. It transforms readers' perspectives of the built environment, converting the act of looking at infrastructure from a mundane inevitability into an everyday diversion and joy. <br /><br />Each section of this accessible, informative book features colorful illustrations revealing the fascinating details of how the human-made world works. An ideal road trip companion, this book offers a fresh perspective on the parts of the environment that often blend into the background. Readers will learn to identify characteristics of the electrical grid, roadways, railways, bridges, tunnels, waterways, and more. Engineering in Plain Sight inspires curiosity, interest, and engagement in how the infrastructure around us is designed and constructed.","num_pages":251,"authors":{"author":{"id":22319964,"name":"Grady Hillhouse","role":"","image_url":"https://images.gr-assets.com/authors/1649089101p5/22319964.jpg","small_image_url":"https://images.gr-assets.com/authors/1649089101p2/22319964.jpg","link":"https://www.goodreads.com/author/show/22319964.Grady_Hillhouse","average_rating":4.2,"ratings_count":835,"text_reviews_count":100}},"average_rating":4.2,"ratings_count":835,"publication_day":1,"publication_month":11,"publication_year":2022},{"link":"https://www.goodreads.com/book/show/43319933-every-tool-s-a-hammer","title":"Every Tool's a Hammer: Life Is What You Make It","title_without_series":"Every Tool's a Hammer: Life Is What You Make It","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1555856209l/43319933._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1555856209l/43319933._SX98_.jpg","description":"<b>In this <i>New York Times</i> bestselling imperative how-to for creativity (Nick Offerman), Adam Savage</b><b>star of Discovery Channels <i>Mythbusters</i>shares his golden rules of creativity, from finding inspiration to following through and successfully making your idea a reality.</b><br /><br /><i>Every Tool</i><i>s a Hammer </i>is a chronicle of my life as a maker. Its an exploration of making, but its also a permission slip of sorts from me to you. Permission to grab hold of the things youre interested in, that fascinate you, and to dive deeper into them to see where they lead you.<br /> <br />Through stories from forty-plus years of making and molding, building and breaking, along with the lessons I learned along the way, this book is meant to be a toolbox of problem solving, complete with a shops worth of notes on the tools, techniques, and materials that I use most often. Things like: <b>In Every Tool There Is a Hammer</b>dont wait until everything is perfect to begin a project, and if you dont have the exact right tool for a task, just use whatevers handy; <b>Increase Your Loose Tolerance</b>making is messy and filled with screwups, but thats okay, as creativity is a path with twists and turns and not a straight line to be found; <b>Use More Cooling Fluid</b>it prolongs the life of blades and bits, and it prevents tool failure, but beyond that its a reminder to slow down and reduce the friction in your work and relationships; <b>Screw Before You Glue</b>mechanical fasteners allow you to change and modify a project while glue is forever but sometimes you just need the right glue, so I dig into which ones will do the job with the least harm and best effects.<br /> <br />This toolbox also includes lessons from many other incredible makers and creators, including: Jamie Hyneman, Nick Offerman, Pixar director Andrew Stanton, Oscar-winner Guillermo del Toro, artist Tom Sachs, and chef Traci Des Jardins. And if everything goes well, we will hopefully save you a few mistakes (and maybe fingers) as well as help you turn your curiosities into creations.<br /> <br />I hope this book serves as creative rocket fuel (Ed Helms) to build, make, invent, explore, andmost of allenjoy the thrills of being a creator.","num_pages":320,"authors":{"author":{"id":3352714,"name":"Adam Savage","role":"","image_url":"https://images.gr-assets.com/authors/1412809454p5/3352714.jpg","small_image_url":"https://images.gr-assets.com/authors/1412809454p2/3352714.jpg","link":"https://www.goodreads.com/author/show/3352714.Adam_Savage","average_rating":4.17,"ratings_count":11682,"text_reviews_count":1224}},"average_rating":4.18,"ratings_count":10916,"publication_day":7,"publication_month":5,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/43808723-everything-is-f-cked","title":"Everything Is F*cked: A Book About Hope","title_without_series":"Everything Is F*cked: A Book About Hope","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550685003l/43808723._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550685003l/43808723._SX98_.jpg","description":"<b>From the author of the international mega-bestseller The Subtle Art of Not Giving A F*ck comes a counterintuitive guide to the problems of hope. </b><br /><br />We live in an interesting time. Materially, everything is the best its ever beenwe are freer, healthier and wealthier than any people in human history. Yet, somehow everything seems to be irreparably and horribly f*ckedthe planet is warming, governments are failing, economies are collapsing, and everyone is perpetually offended on Twitter. At this moment in history, when we have access to technology, education and communication our ancestors couldnt even dream of, so many of us come back to an overriding feeling of hopelessness.<br /><br />Whats going on? If anyone can put a name to our current malaise and help fix it, its Mark Manson. In 2016, Manson published <i>The Subtle Art of Not Giving A F*ck</i>, a book that brilliantly gave shape to the ever-present, low-level hum of anxiety that permeates modern living. He showed us that technology had made it too easy to care about the wrong things, that our culture had convinced us that the world owed us something when it didntand worst of all, that our modern and maddening urge to always find happiness only served to make us unhappier. Instead, the subtle art of that title turned out to be a bold challenge: to choose your struggle; to narrow and focus and find the pain you want to sustain. The result was a book that became an international phenomenon, selling millions of copies worldwide while becoming the #1 bestseller in 13 different countries.<br /><br />Now, in <i>Everthing Is F*cked</i>, Manson turns his gaze from the inevitable flaws within each individual self to the endless calamities taking place in the world around us. Drawing from the pool of psychological research on these topics, as well as the timeless wisdom of philosophers such as Plato, Nietzsche, and Tom Waits, he dissects religion and politics and the uncomfortable ways they have come to resemble one another. He looks at our relationships with money, entertainment and the internet, and how too much of a good thing can psychologically eat us alive. He openly defies our definitions of faith, happiness, freedomand even of hope itself.<br /><br />With his usual mix of erudition and where-the-f*ck-did-that-come-from humor, Manson takes us by the collar and challenges us to be more honest with ourselves and connected with the world in ways we probably havent considered before. Its another counterintuitive romp through the pain in our hearts and the stress of our soul. One of the great modern writers has produced another book that will set the agenda for years to come.","num_pages":288,"authors":{"author":{"id":8529755,"name":"Mark Manson","role":"","image_url":"https://images.gr-assets.com/authors/1410365708p5/8529755.jpg","small_image_url":"https://images.gr-assets.com/authors/1410365708p2/8529755.jpg","link":"https://www.goodreads.com/author/show/8529755.Mark_Manson","average_rating":3.87,"ratings_count":1619258,"text_reviews_count":92082}},"average_rating":3.67,"ratings_count":98290,"publication_day":14,"publication_month":5,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/34890015-factfulness","title":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","title_without_series":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SX98_.jpg","description":"<b><i>Factfulness:</i> The stress-reducing habit of only carrying opinions for which you have strong supporting facts.</b><br /><br />When asked simple questions about global trends<i>what percentage of the worlds population live in poverty; why the worlds population is increasing; how many girls finish school</i>we systematically get the answers wrong. So wrong that a chimpanzee choosing answers at random will consistently outguess teachers, journalists, Nobel laureates, and investment bankers.<br /><br />In <i>Factfulness</i>, Professor of International Health and global TED phenomenon Hans Rosling, together with his two long-time collaborators, Anna and Ola, offers <b>a radical new explanation of why this happens</b>. They reveal <b>the ten instincts that distort our perspective</b>from our tendency to divide the world into two camps (usually some version of <i>us</i> and <i>them</i>) to the way we consume media (where fear rules) to how we perceive progress (believing that most things are getting worse).<br /><br />Our problem is that we dont know what we dont know, and even our guesses are informed by unconscious and predictable biases.<br /><br /><b>It turns out that the world, for all its imperfections, is in a much better state than we might think.</b> That doesnt mean there arent real concerns. But when we worry about everything all the time instead of embracing a worldview based on facts, we can lose our ability to focus on the things that threaten us most.<br /><br />Inspiring and revelatory, filled with lively anecdotes and moving stories, <b><i>Factfulness </i>is an urgent and essential book that will change the way you see the world and empower you to respond to the crises and opportunities of the future. </b>","num_pages":342,"authors":{"author":{"id":2790706,"name":"Hans Rosling","role":"","image_url":"https://images.gr-assets.com/authors/1486521286p5/2790706.jpg","small_image_url":"https://images.gr-assets.com/authors/1486521286p2/2790706.jpg","link":"https://www.goodreads.com/author/show/2790706.Hans_Rosling","average_rating":4.35,"ratings_count":205985,"text_reviews_count":16365}},"average_rating":4.35,"ratings_count":202560,"publication_day":3,"publication_month":4,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/33358206-fifty-inventions-that-shaped-the-modern-economy","title":"Fifty Inventions That Shaped the Modern Economy","title_without_series":"Fifty Inventions That Shaped the Modern Economy","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1491703991l/33358206._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1491703991l/33358206._SX98_.jpg","description":"<b>A lively history seen through the fifty inventions that shaped it most profoundly, by the bestselling author of <i>The Undercover Economist</i> and <i>Messy.</i></b><br /> <br />Who thought up paper money? What was the secret element that made the Gutenberg printing press possible? And what is the connection between <i>The Da Vinci Code</i> and the collapse of Lehman Brothers? <br /><br /><i>Fifty Inventions That Shaped the Modern Economy</i> paints an epic picture of change in an intimate way by telling the stories of the tools, people, and ideas that had far-reaching consequences for all of us. From the plough to artificial intelligence, from Gillettes disposable razor to IKEAs Billy bookcase, bestselling author and <i>Financial Times</i> columnist Tim Harford recounts each inventions own curious, surprising, and memorable story. <br /><br />Invention by invention, Harford reflects on how we got here and where we might go next. He lays bare often unexpected connections: how the bar code undermined family corner stores, and why the gramophone widened inequality. In the process, he introduces characters who developed some of these inventions, profited from them, and were ruined by them, as he traces the principles that helped explain their transformative effects. The result is a wise and witty book of history, economics, and biography.","num_pages":336,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60920,"text_reviews_count":4360}},"average_rating":4.06,"ratings_count":4232,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/24724602-flash-boys","title":"Flash Boys: A Wall Street Revolt","title_without_series":"Flash Boys: A Wall Street Revolt","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1426093936l/24724602._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1426093936l/24724602._SX98_.jpg","description":"<strong>#1 <em>New York Times</em> Bestseller  With a new Afterword</strong><br /><br />In Michael Lewis's game-changing bestseller, a small group of Wall Street iconoclasts realize that the U.S. stock market has been rigged for the benefit of insiders. They band togethersome of them walking away from seven-figure salariesto investigate, expose, and reform the insidious new ways that Wall Street generates profits. If you have any contact with the market, even a retirement account, this story is happening to you.","num_pages":304,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":4.14,"ratings_count":90970,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/177058906-fluke","title":"Fluke: Chance, Chaos, and Why Everything We Do Matters","title_without_series":"Fluke: Chance, Chaos, and Why Everything We Do Matters","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"If you could rewind your life to the very beginning and then press play, would everything turn out the same? Or could making an accidental phone call or missing an exit off the highway change not just your life, but history itself? And would you remain blind to the radically different possible world you unknowingly left behind?<br /><br />In Fluke, myth-shattering social scientist Brian Klaas dives deeply into the phenomenon of random chance and the chaos it can sow, taking aim at most people's neat and tidy storybook version of reality. The book's argument is that we willfully ignore a bewildering but for a few small changes, our lives - and our societies - could be radically different.<br /><br />Offering an entirely new lens, Fluke explores how our world really works, driven by strange interactions and apparently random events. How did one couple's vacation cause 100,000 people to die? Does our decision to hit the snooze button in the morning radically alter the trajectory of our lives? And has the evolution of humans been inevitable, or are we simply the product of a series of freak accidents?<br /><br />Drawing on social science, chaos theory, history, evolutionary biology, and philosophy, Klaas provides a brilliantly fresh look at why things happen - all while providing mind-bending lessons on how we can live smarter, be happier, and lead more fulfilling lives.","num_pages":"","authors":{"author":{"id":15732035,"name":"Brian Klaas","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/15732035.Brian_Klaas","average_rating":4.11,"ratings_count":8113,"text_reviews_count":1014}},"average_rating":4.07,"ratings_count":3951,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1150300.Fooled_by_Randomness","title":"Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets","title_without_series":"Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1336107222l/1150300._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1336107222l/1150300._SX98_.jpg","description":"<b><i>Fooled by Randomness </i>is a standalone book in Nassim Nicholas Talebs landmark Incerto series, an investigation of opacity, luck, uncertainty, probability, human error, risk, and decision-making in a world we dont understand. The other books in the series are <i>The Black Swan, Antifragile, </i>and <i>The Bed of Procrustes</i>.</b><br /><br />Now in a striking new hardcover edition, Fooled by Randomness is the word-of-mouth sensation that will change the way you think about business and the world. Nassim Nicholas Talebveteran trader, renowned risk expert, polymathic scholar, erudite raconteur, and New York Times bestselling author of The Black Swanhas written a modern classic that turns on its head what we believe about luck and skill.<br /><br /> This book is about luckor more precisely, about how we perceive and deal with luck in life and business. Set against the backdrop of the most conspicuous forum in which luck is mistaken for skillthe world of trading<i>Fooled by Randomness</i> provides captivating insight into one of the least understood factors in all our lives. Writing in an entertaining narrative style, the author tackles major intellectual issues related to the underestimation of the influence of happenstance on our lives.<br /><br /> The book is populated with an array of characters, some of whom have grasped, in their own way, the significance of chance: the baseball legend Yogi Berra; the philosopher of knowledge Karl Popper; the ancient worlds wisest man, Solon; the modern financier George Soros; and the Greek voyager Odysseus. We also meet the fictional Nero, who seems to understand the role of randomness in his professional life but falls victim to his own superstitious foolishness.<br /><br /> However, the most recognizable character of all remains unnamedthe lucky fool who happens to be in the right place at the right timehe embodies the survival of the least fit. Such individuals attract devoted followers who believe in their gurus insights and methods. But no one can replicate what is obtained by chance.<br /><br /> Are we capable of distinguishing the fortunate charlatan from the genuine visionary? Must we always try to uncover nonexistent messages in random events? It may be impossible to guard ourselves against the vagaries of the goddess Fortuna, but after reading <i>Fooled by Randomness</i> we can be a little better prepared.<br /><br /><b>\\n  <u>PRAISE FOR <i>FOOLED BY RANDOMNESS</i></u>\\n</b>:<br /><br /><b>Named by Fortune One of the Smartest Books of All Time<br /><br /> A Financial Times Best Business Book of the Year</b><br /><br /> [<i>Fooled by Randomness</i>] is to conventional Wall Street wisdom approximately what Martin Luthers ninety-five theses were to the Catholic Church.<br /> Malcolm Gladwell, author of <i>Blink</i><br /><br /> The book that rolled down Wall Street like a hand grenade.<br /> Maggie Mahar, author of <i>Bull! A History of the Boom, 19821999</i><br /><br /> Fascinating . . . Taleb will grab you.<br /> Peter L. Bernstein, author of <i>Capital Ideas Evolving</i><br /><br /> Recalls the best of scientist/essayists like Richard Dawkins . . . and Stephen Jay Gould.<br /> Michael Schrage, author of <i>Serious Play: How the Worlds Best Companies Simulate to Innovate</i><br /><br /> We need a book like this. . . . Fun to read, refreshingly independent-minded.<br /> Robert J. Shiller, author of <i>Irrational Exuberance </i><br /><br /> Powerful . . . loaded with crackling little insights [and] extreme brilliance.<br /><i>National Review</i>","num_pages":"","authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":309970,"text_reviews_count":21319}},"average_rating":4.08,"ratings_count":71660,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54785515-four-thousand-weeks","title":"Four Thousand Weeks: Time Management for Mortals","title_without_series":"Four Thousand Weeks: Time Management for Mortals","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627425434l/54785515._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627425434l/54785515._SX98_.jpg","description":"<b>The average human lifespan is absurdly, insultingly brief. Assuming you live to be eighty, you have just over four thousand weeks.</b> <br /><br />Nobody needs to be told there isnt enough time. Were obsessed with our lengthening to-do lists, overfilled inboxes, work-life balance, and ceaseless battle against distraction; were deluged with advice on becoming more productive and efficient and life hacks to optimize our days. But such techniques often end up making things worse. The sense of anxious hurry grows more intense, and still the most meaningful parts of life seem to lie just beyond the horizon. Still, we rarely make the connection between our daily struggles with time and the ultimate time management problem: the challenge of how best to use our four thousand weeks. <br /><br />Drawing on the insights of both ancient and contemporary philosophers, psychologists, and spiritual teachers, Oliver Burkeman delivers an entertaining, humorous, practical, and ultimately profound guide to time and time management. Rejecting the futile modern obsession with getting everything done, <i>Four Thousand Weeks </i>introduces readers to tools for constructing a meaningful life by embracing finitude, showing that many of the unhelpful ways weve come to think about time arent inescapable, unchanging truths, but choices weve made as individuals and as a societyand that we could do things differently.","num_pages":245,"authors":{"author":{"id":4384050,"name":"Oliver Burkeman","role":"","image_url":"https://images.gr-assets.com/authors/1394595901p5/4384050.jpg","small_image_url":"https://images.gr-assets.com/authors/1394595901p2/4384050.jpg","link":"https://www.goodreads.com/author/show/4384050.Oliver_Burkeman","average_rating":4.16,"ratings_count":164854,"text_reviews_count":16586}},"average_rating":4.17,"ratings_count":128868,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1022022.Freakonomics","title":"Freakonomics: A Rogue Economist Explores the Hidden Side of Everything","title_without_series":"Freakonomics: A Rogue Economist Explores the Hidden Side of Everything","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356025048l/1022022._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356025048l/1022022._SX98_.jpg","description":"Which is more dangerous, a gun or a swimming pool? What do schoolteachers and sumo wrestlers have in common? Why do drug dealers still live with their moms? How much do parents really matter? What kind of impact did Roe v. Wade have on violent crime? Freakonomics will literally redefine the way we view the modern world.<br /><br />These may not sound like typical questions for an economist to ask. But Steven D. Levitt is not a typical economist. He is a much heralded scholar who studies the stuff and riddles of everyday life -- from cheating and crime to sports and child rearing -- and whose conclusions regularly turn the conventional wisdom on its head. He usually begins with a mountain of data and a simple, unasked question. Some of these questions concern life-and-death issues; others have an admittedly freakish quality. Thus the new field of study contained in this book: freakonomics.<br /><br />Through forceful storytelling and wry insight, Levitt and co-author Stephen J. Dubner show that economics is, at root, the study of incentives -- how people get what they want, or need, especially when other people want or need the same thing. In Freakonomics, they set out to explore the hidden side of ... well, everything. The inner workings of a crack gang. The truth about real-estate agents. The myths of campaign finance. The telltale marks of a cheating schoolteacher. The secrets of the Ku Klux Klan.<br /><br />What unites all these stories is a belief that the modern world, despite a surfeit of obfuscation, complication, and downright deceit, is not impenetrable, is not unknowable, and -- if the right questions are asked -- is even more intriguing than we think. All it takes is a new way of looking. Steven Levitt, through devilishly clever and clear-eyed thinking, shows how to see through all the clutter.<br /><br />Freakonomics establishes this unconventional premise: If morality represents how we would like the world to work, then economics represents how it actually does work. It is true that readers of this book will be armed with enough riddles and stories to last a thousand cocktail parties. But Freakonomics can provide more than that. It will literally redefine the way we view the modern world.","num_pages":315,"authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1107926,"text_reviews_count":30849}},"average_rating":4.01,"ratings_count":899662,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13259270-free-will","title":"Free Will","title_without_series":"Free Will","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1532072045l/13259270._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1532072045l/13259270._SX98_.jpg","description":"Belief in free will touches nearly everything that human beings value. It is difficult to think about law, politics, religion, public policy, intimate relationships, moralityas well as feelings of remorse or personal achievementwithout first imagining that every person is the true source of his or her thoughts and actions. And yet the facts tell us that free will is an illusion.<br /><br />In this enlightening book, Sam Harris argues that this truth about the human mind does not undermine morality or diminish the importance of social and political freedom, but it can and should change the way we think about some of the most important questions in life.","num_pages":96,"authors":{"author":{"id":16593,"name":"Sam Harris","role":"","image_url":"https://images.gr-assets.com/authors/1274184541p5/16593.jpg","small_image_url":"https://images.gr-assets.com/authors/1274184541p2/16593.jpg","link":"https://www.goodreads.com/author/show/16593.Sam_Harris","average_rating":3.92,"ratings_count":238999,"text_reviews_count":15534}},"average_rating":3.86,"ratings_count":38220,"publication_day":6,"publication_month":3,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/16158498-give-and-take","title":"Give and Take: A Revolutionary Approach to Success","title_without_series":"Give and Take: A Revolutionary Approach to Success","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356136579l/16158498._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356136579l/16158498._SX98_.jpg","description":"<i>Give and Take</i> highlights what effective networking, collaboration, influence, negotiation, and leadership skills have in common.<br /><br />For generations, we have focused on the individual drivers of success: passion, hard work, talent, and luck. But today, success is increasingly dependent on how we interact with others. It turns out that at work, most people operate as either takers, matchers, or givers. Whereas takers strive to get as much as possible from others and matchers aim to trade evenly, givers are the rare breed of people who contribute to others without expecting anything in return. <br /><br />Using his own pioneering research as Wharton's youngest tenured professor, Grant shows that these styles have a surprising impact on success. Although some givers get exploited and burn out, the rest achieve extraordinary results across a wide range of industries. Combining cutting-edge evidence with captivating stories, this landmark book shows how one of America's best networkers developed his connections, why the creative genius behind one of the most popular shows in television history toiled for years in anonymity, how a basketball executive responsible for multiple draft busts transformed his franchise into a winner, and how we could have anticipated Enron's demise four years before the company collapsed - without ever looking at a single number. <br /><br />Praised by bestselling authors such as Dan Pink, Tony Hsieh, Dan Ariely, Susan Cain, Dan Gilbert, Gretchen Rubin, Bob Sutton, David Allen, Robert Cialdini, and Seth Godin-as well as senior leaders from Google, McKinsey, Merck, Estee Lauder, Nike, and NASA - <i>Give and Take</i> highlights what effective networking, collaboration, influence, negotiation, and leadership skills have in common. This landmark book opens up an approach to success that has the power to transform not just individuals and groups, but entire organizations and communities.","num_pages":"","authors":{"author":{"id":6583155,"name":"Adam M. Grant","role":"","image_url":"https://images.gr-assets.com/authors/1638361005p5/6583155.jpg","small_image_url":"https://images.gr-assets.com/authors/1638361005p2/6583155.jpg","link":"https://www.goodreads.com/author/show/6583155.Adam_M_Grant","average_rating":4.04,"ratings_count":351469,"text_reviews_count":23789}},"average_rating":4.07,"ratings_count":40101,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/149105520-going-infinite","title":"Going Infinite: The Rise and Fall of a New Tycoon","title_without_series":"Going Infinite: The Rise and Fall of a New Tycoon","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684247487l/149105520._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684247487l/149105520._SX98_.jpg","description":"From the #1 best-selling author of <em>The Big Short</em> and <em>Flash Boys</em>, the story of FTXs spectacular collapse and the enigmatic founder at its center.<br /><br />When Michael Lewis first met him, Sam Bankman-Fried was the worlds youngest billionaire and cryptos Gatsby. CEOs, celebrities, and leaders of small countries all vied for his time and cash after he catapulted, practically overnight, onto the <em>Forbes</em> billionaire list. Who was this rumpled guy in cargo shorts and limp white socks, whose eyes twitched across Zoom meetings as he played video games on the side?<br /><br />In <em>Going Infinite</em> Lewis sets out to answer this question, taking readers into the mind of Bankman-Fried, whose rise and fall offers an education in high-frequency trading, cryptocurrencies, philanthropy, bankruptcy, and the justice system. Both psychological portrait and financial roller-coaster ride, <em>Going Infinite</em> is Michael Lewis at the top of his game, tracing the mind-bending trajectory of a character who never liked the rules and was allowed to live by his ownuntil it all came undone.","num_pages":272,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":3.83,"ratings_count":35927,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43726517-hello-world","title":"Hello World: Being Human in the Age of Algorithms","title_without_series":"Hello World: Being Human in the Age of Algorithms","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"Shortlisted for the 2018 Baillie Gifford Prize and the 2018 Royal Society Investment Science Book Prize<br /><br />\\"A beautifully accessible guide.One of the best books yet written on data and algorithms.\\"  Times (UK) When it comes to artificial intelligence, we either hear of a paradise on earth or of our imminent extinction. Its time we stand face-to-digital-face with the true powers and limitations of the algorithms that already automate important decisions in healthcare, transportation, crime, and commerce. Hello World is indispensable preparation for the moral quandaries of a world run by code, and with the unfailingly entertaining Hannah Fry as our guide, well be discussing these issues long after the last page is turned.","num_pages":256,"authors":{"author":{"id":8365972,"name":"Hannah Fry","role":"","image_url":"https://images.gr-assets.com/authors/1448012148p5/8365972.jpg","small_image_url":"https://images.gr-assets.com/authors/1448012148p2/8365972.jpg","link":"https://www.goodreads.com/author/show/8365972.Hannah_Fry","average_rating":4.02,"ratings_count":18013,"text_reviews_count":1929}},"average_rating":4.11,"ratings_count":11868,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/157095669-hidden-potential","title":"Hidden Potential: The Science of Achieving Greater Things","title_without_series":"Hidden Potential: The Science of Achieving Greater Things","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1689111352l/157095669._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1689111352l/157095669._SX98_.jpg","description":"<b>#1 New York Times bestseller<br /><br />\\"This brilliant book will shatter your assumptions about what it takes to improve and succeed. I wish I could go back in time and gift it to my younger self. It would've helped me find a more joyful path to progress.\\"<br />-Serena Williams, 23-time Grand Slam singles tennis champion<br /><br />The #1 New York Times bestselling author of Think Again illuminates how we can elevate ourselves and others to unexpected heights.</b><br /><br />We live in a world thats obsessed with talent. We celebrate gifted students in school, natural athletes in sports, and child prodigies in music. But admiring people who start out with innate advantages leads us to overlook the distances we ourselves can travel. We can all improve at improving. And when opportunity doesnt knock, there are ways to build a door.<br /><br />Hidden Potential offers a new framework for raising aspirations and exceeding expectations. Adam Grant weaves together groundbreaking evidence, surprising insights, and vivid storytelling that takes us from the classroom to the boardroom, the playground to the Olympics, and underground to outer space. He shows that progress depends less on how hard you work than how well you learn. Growth is not about the genius you possess  its about the character you develop. Grant explores how to build the character skills and motivational structures to realize our own potential, and how to design systems that create opportunities for those who have been underrated and overlooked.<br /><br />This book reveals how anyone can rise to achieve greater things. The true measure of your potential is not the height of the peak youve reached, but how far youve climbed to get there.","num_pages":304,"authors":{"author":{"id":6583155,"name":"Adam M. Grant","role":"","image_url":"https://images.gr-assets.com/authors/1638361005p5/6583155.jpg","small_image_url":"https://images.gr-assets.com/authors/1638361005p2/6583155.jpg","link":"https://www.goodreads.com/author/show/6583155.Adam_M_Grant","average_rating":4.04,"ratings_count":351469,"text_reviews_count":23789}},"average_rating":4.1,"ratings_count":47113,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/42950805-homo-deus","title":"Homo Deus: A Brief History of Tomorrow","title_without_series":"Homo Deus: A Brief History of Tomorrow","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1543157430l/42950805._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1543157430l/42950805._SX98_.jpg","description":"<i>Librarian's Note: Alternate-cover edition for ISBN <a href=\\"https://www.goodreads.com/book/show/30965703-homo-deus\\" rel=\\"nofollow noopener\\">1784703931 / 9781784703936</a></i><br /><br />From the author of the number one bestseller <i>Sapiens</i>.<br /><br /><i>Sapiens </i> showed us where we came from. <i>Homo Deus</i> shows us where we're going. War is obsolete. You are more likely to commit suicide than be killed in conflict. Famine is disappearing. You are at more risk of obesity than starvation. Death is just a technical problem. Equality is out - but immortality is in.<br /><br />What does our future hold? Yuval Noah Harari, author of the bestselling phenomenon <i>Sapiens</i> envisions a not-too-distant world in which we face a new set of challenges.<br /><br /><i>Homo Deus</i> explores the projects, dreams and nightmares that will shape the twenty-first century - from overcoming death to creating artificial life. It asks the fundamental questions: Where do we go from here? And how will we protect this fragile world from our own destructive powers?","num_pages":513,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.28,"ratings_count":1829708,"text_reviews_count":101707}},"average_rating":4.18,"ratings_count":288753,"publication_day":"","publication_month":"","publication_year":2017},{"link":"https://www.goodreads.com/book/show/22668729-hooked","title":"Hooked: How to Build Habit-Forming Products","title_without_series":"Hooked: How to Build Habit-Forming Products","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1407112405l/22668729._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1407112405l/22668729._SX98_.jpg","description":"<b>How do successful companies create products people cant put down?</b><br /><br />Why do some products capture widespread attention while others flop? What makes us engage with certain products out of sheer habit? Is there a pattern underlying how technologies hook us?<br />Nir Eyal answers these questions (and many more) by explaining the Hook Modela four-step process embedded into the products of many successful companies to subtly encourage customer behavior. Through consecutive hook cycles, these products reach their ultimate goal of bringing users back again and again without depending on costly advertising or aggressive messaging.<br /><br /><br /><i>Hooked</i> is based on Eyals years of research, consulting, and practical experience. He wrote the book he wished had been available to him as a start-up foundernot abstract theory, but a how-to guide for building better products. <i>Hooked</i> is written for product managers, designers, marketers, start-up founders, and anyone who seeks to understand how products influence our behavior.<br /><br /><br />Eyal provides readers with:<br /><br /><br /> Practical insights to create user habits that stick.<br /> Actionable steps for building products people love.<br /><br /> Fascinating examples from the iPhone to Twitter, Pinterest to the Bible App, and many other habit-forming products.","num_pages":256,"authors":{"author":{"id":7284116,"name":"Nir   Eyal","role":"","image_url":"https://images.gr-assets.com/authors/1555434805p5/7284116.jpg","small_image_url":"https://images.gr-assets.com/authors/1555434805p2/7284116.jpg","link":"https://www.goodreads.com/author/show/7284116.Nir_Eyal","average_rating":3.99,"ratings_count":74556,"text_reviews_count":5142}},"average_rating":4.12,"ratings_count":50244,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26245868-how-google-works","title":"How Google Works","title_without_series":"How Google Works","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1481060659l/26245868._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1481060659l/26245868._SX98_.jpg","description":"Google Executive Chairman and ex-CEO Eric Schmidt and former SVP of Products Jonathan Rosenberg came to Google over a decade ago as proven technology executives. At the time, the company was already well-known for doing things differently, reflecting the visionary - and frequently contrarian - principles of founders Larry Page and Sergey Brin. If Eric and Jonathan were going to succeed, they realized they would have to relearn everything they thought they knew about management and business.<br /><br />Today, Google is a global icon that regularly pushes the boundaries of innovation in a variety of fields. How Google Works is an entertaining, pause-resistant primer containing lessons that Eric and Jonathan learned as they helped build the company. The authors explain how technology has shifted the balance of power from companies to consumers, and that the only way to succeed in this ever-changing landscape is to create superior products and attract a new breed of multifaceted employees whom Eric and Jonathan dub \\"smart creatives\\". Covering topics including corporate culture, strategy, talent, decision-making, communication, innovation, and dealing with disruption, the authors illustrate management maxims (\\"Consensus requires dissension\\", \\"Exile knaves but fight for divas\\", \\"Think 10X, not 10%\\") with numerous insider anecdotes from Google's history, many of which are shared here for the first time.<br /><br />In an era when everything is speeding up, the best way for businesses to succeed is to attract smart-creative people and give them an environment where they can thrive at scale. How Google Works explains how to do just that.","num_pages":"","authors":{"author":{"id":3887089,"name":"Eric Schmidt","role":"","image_url":"https://images.gr-assets.com/authors/1456105735p5/3887089.jpg","small_image_url":"https://images.gr-assets.com/authors/1456105735p2/3887089.jpg","link":"https://www.goodreads.com/author/show/3887089.Eric_Schmidt","average_rating":3.92,"ratings_count":56704,"text_reviews_count":4081}},"average_rating":4.05,"ratings_count":29586,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/7963278-how-i-killed-pluto-and-why-it-had-it-coming","title":"How I Killed Pluto and Why It Had It Coming","title_without_series":"How I Killed Pluto and Why It Had It Coming","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320532443l/7963278._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320532443l/7963278._SX98_.jpg","description":"The solar system most of us grew up with included nine planets, with Mercury closest to the sun and Pluto at the outer edge. Then, in 2005, astronomer Mike Brown made the discovery of a lifetime: a tenth planet, Eris, slightly bigger than Pluto. But instead of adding one more planet to our solar system, Browns find ignited a firestorm of controversy that culminated in the demotion of Pluto from real planet to the newly coined category of dwarf planet. Suddenly Brown was receiving hate mail from schoolchildren and being bombarded by TV reportersall because of the discovery he had spent years searching for and a lifetime dreaming about.<br /><br />A heartfelt and personal journey filled with both humor and drama, <i>How I Killed Pluto and Why It Had It Coming</i> is the book for anyone, young or old, who has ever imagined exploring the universeand who among us hasnt?","num_pages":267,"authors":{"author":{"id":234214,"name":"Mike    Brown","role":"","image_url":"https://images.gr-assets.com/authors/1291870808p5/234214.jpg","small_image_url":"https://images.gr-assets.com/authors/1291870808p2/234214.jpg","link":"https://www.goodreads.com/author/show/234214.Mike_Brown","average_rating":4.05,"ratings_count":10300,"text_reviews_count":1465}},"average_rating":4.06,"ratings_count":9941,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23281872-how-not-to-be-wrong","title":"How Not to Be Wrong: The Power of Mathematical Thinking","title_without_series":"How Not to Be Wrong: The Power of Mathematical Thinking","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SX98_.jpg","description":"Witty, compelling, and just plain fun to read . . .\\" Evelyn Lamb, Scientific American<br /><br />The Freakonomics of matha math-world superstar unveils the hidden beauty and logic of the world and puts its power in our hands<br /><br />The math we learn in school can seem like a dull set of rules, laid down by the ancients and not to be questioned. In How Not to Be Wrong , Jordan Ellenberg shows us how terribly limiting this view is: Math isnt confined to abstract incidents that never occur in real life, but rather touches everything we dothe whole world is shot through with it.<br /><br />Math allows us to see the hidden structures underneath the messy and chaotic surface of our world. Its a science of not being wrong, hammered out by centuries of hard work and argument. Armed with the tools of mathematics, we can see through to the true meaning of information we take for granted: How early should you get to the airport? What does public opinion really represent? Why do tall parents have shorter children? Who really won Florida in 2000? And how likely are you, really, to develop cancer?<br /><br />How Not to Be Wrong presents the surprising revelations behind all of these questions and many more, using the mathematicians method of analyzing life and exposing the hard-won insights of the academic community to the laymanminus the jargon. Ellenberg chases mathematical threads through a vast range of time and space, from the everyday to the cosmic, encountering, among other things, baseball, Reaganomics, daring lottery schemes, Voltaire, the replicability crisis in psychology, Italian Renaissance painting, artificial languages, the development of non-Euclidean geometry, the coming obesity apocalypse, Antonin Scalias views on crime and punishment, the psychology of slime molds, what Facebook can and cant figure out about you, and the existence of God.<br /><br />Ellenberg pulls from history as well as from the latest theoretical developments to provide those not trained in math with the knowledge they need. Math, as Ellenberg says, is an atomic-powered prosthesis that you attach to your common sense, vastly multiplying its reach and strength. With the tools of mathematics in hand, you can understand the world in a deeper, more meaningful way. How Not to Be Wrong will show you how.","num_pages":457,"authors":{"author":{"id":359894,"name":"Jordan Ellenberg","role":"","image_url":"https://images.gr-assets.com/authors/1622052352p5/359894.jpg","small_image_url":"https://images.gr-assets.com/authors/1622052352p2/359894.jpg","link":"https://www.goodreads.com/author/show/359894.Jordan_Ellenberg","average_rating":3.93,"ratings_count":23700,"text_reviews_count":2219}},"average_rating":3.95,"ratings_count":21440,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43852758-how-to","title":"How To: Absurd Scientific Advice for Common Real-World Problems","title_without_series":"How To: Absurd Scientific Advice for Common Real-World Problems","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550145086l/43852758._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550145086l/43852758._SX98_.jpg","description":"<b>The world's most entertaining and useless self-help guide, from the brilliant mind behind the wildly popular webcomic xkcd and the #1 <i>New York Times</i> bestsellers <i>What If?</i> and <i>Thing Explainer</i></b><br /><br />For any task you might want to do, there's a right way, a wrong way, and a way so monumentally complex, excessive, and inadvisable that no one would ever try it. <i>How To</i> is a guide to the third kind of approach. It's full of highly impractical advice for everything from landing a plane to digging a hole.<br /><br />Bestselling author and cartoonist Randall Munroe explains how to predict the weather by analyzing the pixels of your Facebook photos. He teaches you how to tell if you're a baby boomer or a 90's kid by measuring the radioactivity of your teeth. He offers tips for taking a selfie with a telescope, crossing a river by boiling it, and powering your house by destroying the fabric of space-time. And if you want to get rid of the book once you're done with it, he walks you through your options for proper disposal, including dissolving it in the ocean, converting it to a vapor, using tectonic plates to subduct it into the Earth's mantle, or launching it into the Sun.<br /><br />By exploring the most complicated ways to do simple tasks, Munroe doesn't just make things difficult for himself and his readers. As he did so brilliantly in <i>What If?</i>, Munroe invites us to explore the most absurd reaches of the possible. Full of clever infographics and amusing illustrations, <i>How To</i> is a delightfully mind-bending way to better understand the science and technology underlying the things we do every day.","num_pages":308,"authors":{"author":{"id":3089156,"name":"Randall Munroe","role":"","image_url":"https://images.gr-assets.com/authors/1406058780p5/3089156.jpg","small_image_url":"https://images.gr-assets.com/authors/1406058780p2/3089156.jpg","link":"https://www.goodreads.com/author/show/3089156.Randall_Munroe","average_rating":4.16,"ratings_count":257477,"text_reviews_count":17775}},"average_rating":4.17,"ratings_count":23132,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/56587388-how-the-world-really-works","title":"How the World Really Works: A Scientist's Guide to Our Past, Present and Future","title_without_series":"How the World Really Works: A Scientist's Guide to Our Past, Present and Future","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641444915l/56587388._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641444915l/56587388._SX98_.jpg","description":"* THE NEW YORK TIMES BESTSELLER *<br /><br />'Another masterpiece from one of my favorite authors . . . If you want a brief but thorough education in numeric thinking about many of the fundamental forces that shape human life, this is the book to read. It's a tour de force' BILL GATES<br />__________<br /><br />We have never had so much information at our fingertips and yet most of us don't know how the world really works. This book explains seven of the most fundamental realities governing our survival and prosperity. From energy and food production, through our material world and its globalization, to risks, our environment and its future, How the World Really Works offers a much-needed reality check - because before we can tackle problems effectively, we must understand the facts.<br /><br />In this ambitious and thought-provoking book we see, for example, that globalization isn't inevitable and that our societies have been steadily increasing their dependence on fossil fuels, making their complete and rapid elimination unlikely. Drawing on the latest science and tackling sources of misinformation head on - from Yuval Noah Harari to Noam Chomsky - ultimately Smil answers the most profound question of our age: are we irrevocably doomed or is a brighter utopia ahead?<br />__________<br /><br />'Very informative and eye-opening in many ways' HA-JOON CHANG, author of 23 Things They Don't Tell You About Capitalism<br /><br />'If you are anxious about the future, and infuriated that we aren't doing enough about it, please read this book' PAUL COLLIER, author of The Future of Capitalism","num_pages":326,"authors":{"author":{"id":5003,"name":"Vaclav Smil","role":"","image_url":"https://images.gr-assets.com/authors/1619861469p5/5003.jpg","small_image_url":"https://images.gr-assets.com/authors/1619861469p2/5003.jpg","link":"https://www.goodreads.com/author/show/5003.Vaclav_Smil","average_rating":3.9,"ratings_count":39774,"text_reviews_count":4079}},"average_rating":3.95,"ratings_count":14083,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/35959613-how-to-american","title":"How to American: An Immigrant's Guide to Disappointing Your Parents","title_without_series":"How to American: An Immigrant's Guide to Disappointing Your Parents","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517784874l/35959613._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517784874l/35959613._SX98_.jpg","description":"<b>Standup comic, actor and fan favorite from the popular HBO series <i>Silicon Valley</i> shares his memoir of growing up as a Chinese immigrant in California and making it in Hollywood.<br /><br /></b>Jimmy O. Yang is about to have his moment. You've likely seen the standup comic and actor starring as a series regular, the fan favorite character Jian Yang in Mike Judge's Emmy-nominated HBO comedy <i>Silicon Valley</i>. Or you may have caught his first dramatic turn in director Peter Berg's acclaimed film <i>Patriot's Day</i>. Next up is a major role opposite Melissa McCarthy in the comedy <i>Life of the Party</i>. Beyond his burgeoning career in Hollywood, Yang's star status is only a small piece of his story. His family emigrated from Hong Kong to Los Angeles when he was 13. Can you think of a worse time for a young adolescent who didn't speak English to be thrown into the Los Angeles School District with its notorious income gap, mean girls, and children of Hollywood elite? <br /><br />In his first book, <i>How to American</i>, Yang shares his storiesalways hilarious, often resonantof learning our customs, assimilating into our culture, and figuring out how to date high school girls who were six inches taller than him, all while enduring the constant pressure from his sometimes overbearing parents to go to medical school and become a doctor. In his book, we see firsthand what Yang's experienced as an immigrant and the things he did and didn't do to progress into a star on the rise. <i>How to American</i> features chapters on a wide range of topics, from \\"How to Thuglife\\" (what Yang learned about America by watching BET RapCity, three hours of rap music videos a day) to \\"How to Hollywood\\" (making the best of the limited roles given to him, to eventually playing the boyfriend to a white girl in the upcoming Melissa McCarthy star vehicle <i>Life of The Party</i>, the Holy Grail of Asian actors).<b>\\n  <br />\\n</b>","num_pages":240,"authors":{"author":{"id":17086472,"name":"Jimmy O. Yang","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/17086472.Jimmy_O_Yang","average_rating":4.03,"ratings_count":7927,"text_reviews_count":911}},"average_rating":4.03,"ratings_count":7925,"publication_day":13,"publication_month":3,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/52275335-how-to-avoid-a-climate-disaster","title":"How to Avoid a Climate Disaster: The Solutions We Have and the Breakthroughs We Need","title_without_series":"How to Avoid a Climate Disaster: The Solutions We Have and the Breakthroughs We Need","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1609355352l/52275335._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1609355352l/52275335._SX98_.jpg","description":"Neste livro urgente e ricamente detalhado, Bill Gates prope um plano abrangente, prtico e acessvel para zerar a emisso de gases de efeito estufa e evitar uma catstrofe climtica.<br /><br />Bill Gates passou uma dcada investigando as causas e os efeitos da mudana climtica. Com a ajuda de especialistas nas reas de fsica, qumica, biologia, engenharia, cincia poltica e finanas, ele se concentrou no que deve ser feito para impedir uma catstrofe ambiental. Neste livro, o fundador da Microsoft no explica apenas por que precisamos zerar as emisses lquidas de gases de efeito estufa, mas tambm detalha como podemos atingir esse objetivo e superar os desafios que temos pela frente. <br />A partir de sua experincia em inovao e de tirar ideias do papel, Gates descreve como a tecnologia j vem ajudando a reduzir as emisses, onde e como ela pode funcionar de forma mais eficaz, em quais setores precisamos de novidades e quem so os pesquisadores por trs delas. Finalmente, ele apresenta um plano prtico para zerar as emisses, que inclui desde as polticas pblicas at as atitudes que ns, cidados, podemos tomar a fim de monitorar o trabalho do governo, de nossos empregadores e de ns mesmos. <br />Como o autor demonstra, zerar as emisses no ser fcil, mas, seguindo os conselhos deste livro,  uma meta que est plenamente a nosso alcance.","num_pages":272,"authors":{"author":{"id":23470,"name":"Bill  Gates","role":"","image_url":"https://images.gr-assets.com/authors/1736827769p5/23470.jpg","small_image_url":"https://images.gr-assets.com/authors/1736827769p2/23470.jpg","link":"https://www.goodreads.com/author/show/23470.Bill_Gates","average_rating":4.07,"ratings_count":84869,"text_reviews_count":7771}},"average_rating":4.12,"ratings_count":51171,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55655032-how-to-change","title":"How to Change: The Science of Getting from Where You Are to Where You Want to Be","title_without_series":"How to Change: The Science of Getting from Where You Are to Where You Want to Be","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1605572905l/55655032._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1605572905l/55655032._SX98_.jpg","description":"<b><b><i>Wall Street Journal</i> bestseller</b> </b><br /><br /><b>\\"A welcome revelation.\\" --<i>The Financial Times</i></b><br /><br /><b>Award-winning Wharton Professor and Choiceology podcast host Katy Milkman has devoted her career to the study of behavior change. In this ground-breaking book, Milkman reveals a proven path that can take you from where you are to where you want to be, with a foreword from psychologist Angela Duckworth, the best-selling author of <i>Grit</i>.</b><br /><br />Change comes most readily when you understand what's standing between you and success and tailor your solution to that roadblock. If you want to work out more but find exercise difficult and boring, downloading a goal-setting app probably won't help. But what if, instead, you transformed your workouts so they became a source of pleasure instead of a chore? Turning an uphill battle into a downhill one is the key to success.<br /><br />Drawing on Milkman's original research and the work of her world-renowned scientific collaborators, <i>How to Change</i> shares strategic methods for identifying and overcoming common barriers to change, such as impulsivity, procrastination, and forgetfulness. Through case studies and engaging stories, you'll learn:<br /><br /><b>-</b> Why timing can be everything when it comes to making a change<br /> <b>-</b> How to turn temptation and inertia into assets <br /> <b>-</b> That giving advice, even if it's about something you're struggling with, can help you achieve more<br /><br />Whether you're a manager, coach, or teacher aiming to help others change for the better or are struggling to kick-start change yourself, <i>How to Change</i> offers an invaluable, science-based blueprint for achieving your goals, once and for all.","num_pages":"","authors":{"author":{"id":20805683,"name":"Katy Milkman","role":"","image_url":"https://images.gr-assets.com/authors/1699799627p5/20805683.jpg","small_image_url":"https://images.gr-assets.com/authors/1699799627p2/20805683.jpg","link":"https://www.goodreads.com/author/show/20805683.Katy_Milkman","average_rating":3.84,"ratings_count":7333,"text_reviews_count":730}},"average_rating":3.84,"ratings_count":7333,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54564213-how-to-make-the-world-add-up","title":"How to Make the World Add Up: Ten Rules for Thinking Differently About Numbers","title_without_series":"How to Make the World Add Up: Ten Rules for Thinking Differently About Numbers","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594979690l/54564213._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594979690l/54564213._SX98_.jpg","description":"When was the last time you read a grand statement, accompanied by a large number, and wondered whether it could really be true? Statistics are vital in helping us tell stories - we see them in the papers, on social media, and we hear them used in everyday conversation - and yet we doubt them more than ever.<br /><br />But numbers - in the right hands - have the power to change the world for the better. Contrary to popular belief, good statistics are not a trick, although they are a kind of magic. Good statistics are not smoke and mirrors; in fact, they help us see more clearly. Good statistics are like a telescope for an astronomer, a microscope for a bacteriologist, or an X-ray for a radiologist. If we are willing to let them, good statistics help us see things about the world around us and about ourselves - both large and small - that we would not be able to see in any other way.<br /><br />In How to Make the World Add Up, Tim Harford draws on his experience as both an economist and presenter of the BBC's radio show 'More or Less'. He takes us deep into the world of disinformation and obfuscation, bad research and misplaced motivation to find those priceless jewels of data and analysis that make communicating with numbers worthwhile. Harford's characters range from the art forger who conned the Nazis to the stripper who fell in love with the most powerful congressman in Washington, to famous data detectives such as John Maynard Keynes, Daniel Kahneman and Florence Nightingale. He reveals how we can evaluate the claims that surround us with confidence, curiosity and a healthy level of scepticism.<br /><br />Using ten simple rules for understanding numbers - plus one golden rule - this extraordinarily insightful book shows how if we keep our wits about us, thinking carefully about the way numbers are sourced and presented, we can look around us and see with crystal clarity how the world adds up.","num_pages":352,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60920,"text_reviews_count":4360}},"average_rating":4.12,"ratings_count":8304,"publication_day":17,"publication_month":9,"publication_year":2020},{"link":"https://www.goodreads.com/book/show/54304221-how-to-not-die-alone","title":"How to Not Die Alone: The Surprising Science That Will Help You Find Love","title_without_series":"How to Not Die Alone: The Surprising Science That Will Help You Find Love","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1607457004l/54304221._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1607457004l/54304221._SX98_.jpg","description":"J alguma vez olhou  sua volta e deu por si a Por que razo j toda a gente encontrou o amor, menos eu? O seu caso no  o nico. Os bons relacionamentos no aparecem do nada nas nossas vidas; so o culminar de uma srie de decises, incluindo com quem se deve ou no namorar, quando se deve terminar uma ligao que no est a resultar e quando se deve investir a srio numa determinada pessoa.<br /><br />Com base em anos de pesquisa, a cientista comportamental Logan Ury vai tornar-se a sua preciosa ajuda. Em Como No Acabar Sozinho, ir <br /><br />Porque hesita nos namoros (e como quebrar esse padro);<br />O que importa numa relao de longo prazo (e o que no);<br />Como conhecer mais pessoas (enquanto faz coisas de que gosta);<br />Como voltar a sair com algum (sem que tal parea uma entrevista de trabalho);<br />A razo pela qual a fasca  um mito (mas como, ainda assim, encontrar o amor).","num_pages":"","authors":{"author":{"id":20455205,"name":"Logan Ury","role":"","image_url":"https://images.gr-assets.com/authors/1603676701p5/20455205.jpg","small_image_url":"https://images.gr-assets.com/authors/1603676701p2/20455205.jpg","link":"https://www.goodreads.com/author/show/20455205.Logan_Ury","average_rating":3.97,"ratings_count":19528,"text_reviews_count":2160}},"average_rating":3.97,"ratings_count":19500,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/53406646-humankind","title":"Humankind: A Hopeful History","title_without_series":"Humankind: A Hopeful History","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"It's a belief that unites the left and right, psychologists and philosophers, writers and historians. It drives the headlines that surround us and the laws that touch our lives. From Machiavelli to Hobbes, Freud to Dawkins, the roots of this belief have sunk deep into Western thought. Human beings, we're taught, are by nature selfish and governed by self-interest.<br /><br />Humankind makes a new argument: that it is realistic, as well as revolutionary, to assume that people are good. The instinct to cooperate rather than compete, trust rather than distrust, has an evolutionary basis going right back to the beginning of Homo sapiens. By thinking the worst of others, we bring out the worst in our politics and economics too.<br /><br />In this major book, internationally bestselling author Rutger Bregman takes some of the world's most famous studies and events and reframes them, providing a new perspective on the last 200,000 years of human history. From the real-life Lord of the Flies to the Blitz, a Siberian fox farm to an infamous New York murder, Stanley Milgram's Yale shock machine to the Stanford prison experiment, Bregman shows how believing in human kindness and altruism can be a new way to think  and act as the foundation for achieving true change in our society.<br /><br />It is time for a new view of human nature.","num_pages":496,"authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.21,"ratings_count":142058,"text_reviews_count":14509}},"average_rating":4.32,"ratings_count":80850,"publication_day":19,"publication_month":3,"publication_year":2020},{"link":"https://www.goodreads.com/book/show/39074550-humble-pi","title":"Humble Pi: A Comedy of Maths Errors","title_without_series":"Humble Pi: A Comedy of Maths Errors","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>An international bestseller </b><br /><br />The book-length answer to anyone who ever put their hand up in math class and asked, \\"When am I ever going to use this in the real world?\\"<br /><br />\\"Fun, informative, and relentlessly entertaining, <i>Humble Pi</i> is a charming and very readable guide to some of humanity's all-time greatest miscalculations--that also gives you permission to feel a little better about some of your own mistakes.\\" --Ryan North, author of <i>How to Invent Everything</i><br /><br />Our whole world is built on math, from the code running a website to the equations enabling the design of skyscrapers and bridges. Most of the time this math works quietly behind the scenes . . . until it doesn't. All sorts of seemingly innocuous mathematical mistakes can have significant consequences.<br /><br />Math is easy to ignore until a misplaced decimal point upends the stock market, a unit conversion error causes a plane to crash, or someone divides by zero and stalls a battleship in the middle of the ocean.<br /><br />Exploring and explaining a litany of glitches, near misses, and mathematical mishaps involving the internet, big data, elections, street signs, lotteries, the Roman Empire, and an Olympic team, Matt Parker uncovers the bizarre ways math trips us up, and what this reveals about its essential place in our world. Getting it wrong has never been more fun.","num_pages":314,"authors":{"author":{"id":17598525,"name":"Matt    Parker","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/17598525.Matt_Parker","average_rating":4.1,"ratings_count":27222,"text_reviews_count":2893}},"average_rating":4.1,"ratings_count":22443,"publication_day":7,"publication_month":3,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/63249703-it-s-ok-to-be-angry-about-capitalism","title":"It's OK to Be Angry About Capitalism","title_without_series":"It's OK to Be Angry About Capitalism","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1669081225l/63249703._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1669081225l/63249703._SX98_.jpg","description":"A progressive takedown of the uber-capitalist status quo that has enriched millionaires and billionaires at the expense of the working class, and a blueprint for what transformational change would actually look like<br /><br />Its OK to be angry about capitalism. Reflecting on our turbulent times, Senator Bernie Sanders takes on the billionaire class and speaks blunt truths about our countrys failure to address the destructive nature of a system that is fueled by uncontrolled greed and rigidly committed to prioritizing corporate profits over the needs of ordinary Americans.<br /><br />Sanders argues that unfettered capitalism is to blame for an unprecedented level of income and wealth inequality, is undermining our democracy, and is destroying our planet. How can we accept an economic order that allows three billionaires to control more wealth than the bottom half of our society? How can we accept a political system that allows the super rich to buy elections and politicians? How can we accept an energy system that rewards the fossil fuel corporations causing the climate crisis? Sanders believes that, in the face of these overwhelming challenges, the American people must ask tough questions about the systems that have failed us and demand fundamental economic and political change. This is where the path forward begins.<br /><br />Its OK to Be Angry About Capitalism presents a vision that extends beyond the promises of past campaigns to reveal what would be possible if the political revolution took place, if we would finally recognize that economic rights are human rights, and if we would work to create a society that provides a decent standard of living for all. This isnt some utopian fantasy; this is democracy as we should know it.","num_pages":"","authors":{"author":{"id":102824,"name":"Bernie Sanders","role":"","image_url":"https://images.gr-assets.com/authors/1300822269p5/102824.jpg","small_image_url":"https://images.gr-assets.com/authors/1300822269p2/102824.jpg","link":"https://www.goodreads.com/author/show/102824.Bernie_Sanders","average_rating":4.13,"ratings_count":27216,"text_reviews_count":3969}},"average_rating":4.1,"ratings_count":7415,"publication_day":21,"publication_month":2,"publication_year":2023},{"link":"https://www.goodreads.com/book/show/2294277.Just_for_Fun","title":"Just for Fun: The Story of an Accidental Revolutionary","title_without_series":"Just for Fun: The Story of an Accidental Revolutionary","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328006418l/2294277._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328006418l/2294277._SX98_.jpg","description":"Most 31-year olds can't boast of being the instigator of a revolution. But then again, the world's leading promoter of open source software and creator of the operating system Linux does humbly call himself an accidental revolutionary--accidental being the operative word here. <i>Just for Fun</i> is the quirky story of how Linus Torvalds went from being a penniless, introverted code writer in Helsinki in the early 1990s to being the unwitting (and rather less than penniless) leader of a radical shift in computer programming by the end of the decade.<p> OK, perhaps \\"story\\" in the traditional sense of the term is stretching it a bit. This whole book is more like a series of e-mails, an exercise in textual communication for someone more used to code language than conversation: choppy sentences packed into short paragraphs, and sometimes just one-liners. The pace is fast, but the quippy tone can get somewhat tiring, though it definitely suits the portrayal of a computer-dominated life. And like an e-mail conversation, the tense often changes, the topics jump back and forth, and the narrators occasionally change, mostly alternating between the Linux man himself and <i>Red Herring</i> executive editor David Diamond, who convinced the difficult-to-pin-down Torvalds to write his story (or at least allow Diamond to poke, prod, and pull it out of him, all the while giving his own impressions and interpretations). But Torvald's tale contains enough informative and entertaining tidbits--on growing up in dark, strangely silent but communication-gadget-obsessed Finland (which boasts more cell phones per capita than anywhere else), on what makes passionate code writers tick, on making the transition from unknown computer geek to world-famous computer geek, on the convergence of technology and ideology, on his work for Transmeta and involvement (or lack thereof) with all the players worth mentioning in Silicon Valley - to keep more than just computer programmers engrossed in his story. For the latter, of course, <i>Just for Fun</i> will be required reading.</p><p> If you pick up this book as a geek's guide to the meaning of life (which, believe it or not, Torvalds does ramble on about at the beginning and the end), then you're in for a bit of a shallow take on the whole thing. But if you're interested in the idea of technological development as a global team sport, and how a nerdy Finnish transplant to California got the whole game going in the first place, check out Linus's story... just for fun, of course. --<i>S. Ketchum</i></p>","num_pages":249,"authors":{"author":{"id":44935662,"name":"Torvalds. Linus & David Diamond","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/44935662.Torvalds_Linus_David_Diamond","average_rating":3.96,"ratings_count":23,"text_reviews_count":1}},"average_rating":3.96,"ratings_count":4869,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/4929.Kafka_on_the_Shore","title":"Kafka on the Shore","title_without_series":"Kafka on the Shore","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1429638085l/4929._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1429638085l/4929._SX98_.jpg","description":"<i>Kafka on the Shore</i>, a tour de force of metaphysical reality, is powered by two remarkable characters: a teenage boy, Kafka Tamura, who runs away from home either to escape a gruesome oedipal prophecy or to search for his long-missing mother and sister; and an aging simpleton called Nakata, who never recovered from a wartime affliction and now is drawn toward Kafka for reasons that, like the most basic activities of daily life, he cannot fathom. Their odyssey, as mysterious to them as it is to us, is enriched throughout by vivid accomplices and mesmerizing events. Cats and people carry on conversations, a ghostlike pimp employs a Hegel-quoting prostitute, a forest harbors soldiers apparently unaged since World War II, and rainstorms of fish (and worse) fall from the sky. There is a brutal murder, with the identity of both victim and perpetrator a riddleyet this, along with everything else, is eventually answered, just as the entwined destinies of Kafka and Nakata are gradually revealed, with one escaping his fate entirely and the other given a fresh start on his own.","num_pages":467,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4260675,"text_reviews_count":366787}},"average_rating":4.12,"ratings_count":552186,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54120408-klara-and-the-sun","title":"Klara and the Sun","title_without_series":"Klara and the Sun","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1603206535l/54120408._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1603206535l/54120408._SX98_.jpg","description":"From her place in the store, Klara, an Artificial Friend with outstanding observational qualities, watches carefully the behavior of those who come in to browse, and of those who pass on the street outside. She remains hopeful that a customer will soon choose her, but when the possibility emerges that her circumstances may change forever, Klara is warned not to invest too much in the promises of humans.<br /><br />In <i>Klara and the Sun</i>, Kazuo Ishiguro looks at our rapidly changing modern world through the eyes of an unforgettable narrator to explore a fundamental question: what does it mean to love?","num_pages":303,"authors":{"author":{"id":4280,"name":"Kazuo Ishiguro","role":"","image_url":"https://images.gr-assets.com/authors/1424906625p5/4280.jpg","small_image_url":"https://images.gr-assets.com/authors/1424906625p2/4280.jpg","link":"https://www.goodreads.com/author/show/4280.Kazuo_Ishiguro","average_rating":3.84,"ratings_count":1987647,"text_reviews_count":191894}},"average_rating":3.74,"ratings_count":438494,"publication_day":2,"publication_month":3,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/34684622-leonardo-da-vinci","title":"Leonardo da Vinci","title_without_series":"Leonardo da Vinci","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523543570l/34684622._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523543570l/34684622._SX98_.jpg","description":"Based on thousands of pages from Leonardo's astonishing notebooks and new discoveries about his life and work, Walter Isaacson weaves a narrative that connects his art to his science. He shows how Leonardo's genius was based on skills we can improve in ourselves, such as passionate curiosity, careful observation, and an imagination so playful that it flirted with fantasy. He produced the two most famous paintings in history, The Last Supper and the Mona Lisa. But in his own mind, he was just as much a man of science and technology. With a passion that sometimes became obsessive, he pursued innovative studies of anatomy, fossils, birds, the heart, flying machines, botany, geology, and weaponry. His ability to stand at the crossroads of the humanities and the sciences, made iconic by his drawing of Vitruvian Man, made him history's most creative genius","num_pages":600,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2035307,"text_reviews_count":55219}},"average_rating":4.18,"ratings_count":129736,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/7865083-liar-s-poker","title":"Liar's Poker","title_without_series":"Liar's Poker","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<strong>The time was the 1980s. The place was Wall Street. The game was called Liars Poker.</strong> <br /><br />Michael Lewis was fresh out of Princeton and the London School of Economics when he landed a job at Salomon Brothers, one of Wall Streets premier investment firms. During the next three years, Lewis rose from callow trainee to bond salesman, raking in millions for the firm and cashing in on a modern-day gold rush. <em>Liars Poker</em> is the culmination of those heady, frenzied yearsa behind-the-scenes look at a unique and turbulent time in American business. From the frat-boy camaraderie of the forty-first-floor trading room to the killer instinct that made ambitious young men gamble everything on a high-stakes game of bluffing and deception, here is Michael Lewiss knowing and hilarious insiders account of an unprecedented era of greed, gluttony, and outrageous fortune. .","num_pages":310,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":4.15,"ratings_count":112458,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/75623469-love-triangle","title":"Love Triangle: The Life-changing Magic of Trigonometry","title_without_series":"Love Triangle: The Life-changing Magic of Trigonometry","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1714209877l/75623469._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1714209877l/75623469._SX98_.jpg","description":"","num_pages":337,"authors":{"author":{"id":17598525,"name":"Matt    Parker","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/17598525.Matt_Parker","average_rating":4.1,"ratings_count":27222,"text_reviews_count":2893}},"average_rating":3.93,"ratings_count":1394,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18770267-make-it-stick","title":"Make It Stick: The Science of Successful Learning","title_without_series":"Make It Stick: The Science of Successful Learning","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631768711l/18770267._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631768711l/18770267._SX98_.jpg","description":"To most of us, learning something the hard way implies wasted time and effort. Good teaching, we believe, should be creatively tailored to the different learning styles of students and should use strategies that make learning easier. <em>Make It Stick</em> turns fashionable ideas like these on their head. Drawing on recent discoveries in cognitive psychology and other disciplines, the authors offer concrete techniques for becoming more productive learners.<br /><br />Memory plays a central role in our ability to carry out complex cognitive tasks, such as applying knowledge to problems never before encountered and drawing inferences from facts already known. New insights into how memory is encoded, consolidated, and later retrieved have led to a better understanding of how we learn. Grappling with the impediments that make learning challenging leads both to more complex mastery and better retention of what was learned.<br /><br />Many common study habits and practice routines turn out to be counterproductive. Underlining and highlighting, rereading, cramming, and single-minded repetition of new skills create the illusion of mastery, but gains fade quickly. More complex and durable learning come from self-testing, introducing certain difficulties in practice, waiting to re-study new material until a little forgetting has set in, and interleaving the practice of one skill or topic with another. Speaking most urgently to students, teachers, trainers, and athletes, <em>Make It Stick</em> will appeal to all those interested in the challenge of lifelong learning and self-improvement.","num_pages":313,"authors":{"author":{"id":47555,"name":"Peter C. Brown","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/47555.Peter_C_Brown","average_rating":4.14,"ratings_count":23182,"text_reviews_count":2397}},"average_rating":4.15,"ratings_count":22712,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/4069.Man_s_Search_for_Meaning","title":"Man's Search for Meaning","title_without_series":"Man's Search for Meaning","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1535419394l/4069._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1535419394l/4069._SX98_.jpg","description":"Psychiatrist Viktor Frankl's memoir has riveted generations of readers with its descriptions of life in Nazi death camps and its lessons for spiritual survival. Based on his own experience and the stories of his patients, Frankl argues that we cannot avoid suffering but we can choose how to cope with it, find meaning in it, and move forward with renewed purpose. At the heart of his theory, known as logotherapy, is a conviction that the primary human drive is not pleasure but the pursuit of what we find meaningful. <i>Man's Search for Meaning</i> has become one of the most influential books in America; it continues to inspire us all to find significance in the very act of living.","num_pages":165,"authors":{"author":{"id":2782,"name":"Viktor E. Frankl","role":"","image_url":"https://images.gr-assets.com/authors/1542894524p5/2782.jpg","small_image_url":"https://images.gr-assets.com/authors/1542894524p2/2782.jpg","link":"https://www.goodreads.com/author/show/2782.Viktor_E_Frankl","average_rating":4.36,"ratings_count":916155,"text_reviews_count":52103}},"average_rating":4.37,"ratings_count":886496,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/8410925-mao-s-great-famine","title":"Mao's Great Famine: The History of China's Most Devastating Catastrophe, 1958-62","title_without_series":"Mao's Great Famine: The History of China's Most Devastating Catastrophe, 1958-62","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1467992412l/8410925._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1467992412l/8410925._SX98_.jpg","description":"Between 1958 and 1962, 45 million Chinese people were worked, starved or beaten to death. Mao Zedong threw his country into a frenzy with the Great Leap Forward, an attempt to catch up with and overtake the Western world in less than fifteen years. It lead to one of the greatest catastrophes the world has ever known. Dikotter's extraordinary research within Chinese archives brings together for the first time what happened in the corridors of power with the everyday experiences of ordinary people, giving voice to the dead and disenfranchised. This groundbreaking account definitively recasts the history of the People's Republic of China.","num_pages":448,"authors":{"author":{"id":628437,"name":"Frank Diktter","role":"","image_url":"https://images.gr-assets.com/authors/1357655982p5/628437.jpg","small_image_url":"https://images.gr-assets.com/authors/1357655982p2/628437.jpg","link":"https://www.goodreads.com/author/show/628437.Frank_Dik_tter","average_rating":3.99,"ratings_count":14201,"text_reviews_count":1707}},"average_rating":4.07,"ratings_count":5199,"publication_day":6,"publication_month":9,"publication_year":2010},{"link":"https://www.goodreads.com/book/show/37570546-maybe-you-should-talk-to-someone","title":"Maybe You Should Talk to Someone: A Therapist, Her Therapist, and Our Lives Revealed","title_without_series":"Maybe You Should Talk to Someone: A Therapist, Her Therapist, and Our Lives Revealed","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1547189796l/37570546._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1547189796l/37570546._SX98_.jpg","description":"<b>From a psychotherapist, and national advice columnist comes a thought-provoking new book that takes us behind the scenes of a therapist's world -- where her patients are looking for answers (and so is she).</b><br /><br /> One day, Lori Gottlieb is a therapist who helps patients in her Los Angeles practice. The next, a crisis causes her world to come crashing down. Enter Wendell, the quirky but seasoned therapist in whose office she suddenly lands. With his balding head, cardigan, and khakis, he seems to have come straight from Therapist Central Casting. Yet he will turn out to be anything but.<br /><br /> As Gottlieb explores the inner chambers of her patients' lives -- a self-absorbed Hollywood producer, a young newlywed diagnosed with a terminal illness, a senior citizen threatening to end her life on her birthday if nothing gets better, and a twenty-something who can't stop hooking up with the wrong guys -- she finds that the questions they are struggling with are the very ones she is now bringing to Wendell.<br /><br /> With startling wisdom and humor, Gottlieb invites us into her world as both clinician and patient, examining the truths and fictions we tell ourselves and others as we teeter on the tightrope between love and desire, meaning and mortality, guilt and redemption, terror and courage, hope and change.<br /><br /><i>Maybe You Should Talk to Someone </i>is revolutionary in its candor, offering a deeply personal yet universal tour of our hearts and minds and providing the rarest of gifts: a boldly revealing portrait of what it means to be human, and a disarmingly funny and illuminating account of our own mysterious lives and our power to transform them.","num_pages":415,"authors":{"author":{"id":201386,"name":"Lori Gottlieb","role":"","image_url":"https://images.gr-assets.com/authors/1547068605p5/201386.jpg","small_image_url":"https://images.gr-assets.com/authors/1547068605p2/201386.jpg","link":"https://www.goodreads.com/author/show/201386.Lori_Gottlieb","average_rating":4.34,"ratings_count":422601,"text_reviews_count":37719}},"average_rating":4.37,"ratings_count":407519,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/205363955-meditations-for-mortals","title":"Meditations for Mortals: Four Weeks to Embrace Your Limitations and Make Time for What Counts","title_without_series":"Meditations for Mortals: Four Weeks to Embrace Your Limitations and Make Time for What Counts","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b><i>Meditations for Mortals</i> takes us on a liberating journey towards a more meaningful life  one that begins not with fantasies of the ideal existence, but with the reality in which we actually find ourselves.</b><br /><br />Addressing the fundamental questions about how to live, it offers a powerful new way to take action on what counts: a guiding philosophy of life Oliver Burkeman calls imperfectionism. How can we embrace our non-negotiable limitations? Or make good decisions when theres always too much to do? What if purposeful productivity were often about letting things happen, not making them happen?<br /><br />Reflecting on ideas drawn from philosophy, religion, literature, psychology, and self-help, Burkeman explores practical tools and shifts in perspective. The result is a bracing challenge to much familiar advice, and a profound yet entertaining crash course in living more fully.<br /><br /><b>To be read either as a four-week retreat of the mind or devoured in one or two sittings, <i>Meditations for Mortals</i> will be a source of solace and inspiration, and an aid to a saner, freer, and more enchantment-filled life. In anxiety-inducing times, it is rich in truths we have never needed more.</b>","num_pages":208,"authors":{"author":{"id":4384050,"name":"Oliver Burkeman","role":"","image_url":"https://images.gr-assets.com/authors/1394595901p5/4384050.jpg","small_image_url":"https://images.gr-assets.com/authors/1394595901p2/4384050.jpg","link":"https://www.goodreads.com/author/show/4384050.Oliver_Burkeman","average_rating":4.16,"ratings_count":164854,"text_reviews_count":16586}},"average_rating":4.27,"ratings_count":16820,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26530355-misbehaving","title":"Misbehaving: The Making of Behavioral Economics","title_without_series":"Misbehaving: The Making of Behavioral Economics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459531022l/26530355._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459531022l/26530355._SX98_.jpg","description":"Nobel laureate Richard H. Thaler has spent his career studying the radical notion that the central agents in the economy are humanspredictable, error-prone individuals. <em>Misbehaving</em> is his arresting, frequently hilarious account of the struggle to bring an academic discipline back down to earthand change the way we think about economics, ourselves, and our world.<br /><br />Traditional economics assumes rational actors. Early in his research, Thaler realized these Spock-like automatons were nothing like real people. Whether buying a clock radio, selling basketball tickets, or applying for a mortgage, we all succumb to biases and make decisions that deviate from the standards of rationality assumed by economists. In other words, we misbehave. More importantly, our misbehavior has serious consequences. Dismissed at first by economists as an amusing sideshow, the study of human miscalculations and their effects on markets now drives efforts to make better decisions in our lives, our businesses, and our governments.<br /><br />Coupling recent discoveries in human psychology with a practical understanding of incentives and market behavior, Thaler enlightens readers about how to make smarter decisions in an increasingly mystifying world. He reveals how behavioral economic analysis opens up new ways to look at everything from household finance to assigning faculty offices in a new building, to TV game shows, the NFL draft, and businesses like Uber.<br /><br />Laced with antic stories of Thalers spirited battles with the bastions of traditional economic thinking, <em>Misbehaving</em> is a singular look into profound human foibles. When economics meets psychology, the implications for individuals, managers, and policy makers are both profound and entertaining.","num_pages":358,"authors":{"author":{"id":65483,"name":"Richard H. Thaler","role":"","image_url":"https://images.gr-assets.com/authors/1438885744p5/65483.jpg","small_image_url":"https://images.gr-assets.com/authors/1438885744p2/65483.jpg","link":"https://www.goodreads.com/author/show/65483.Richard_H_Thaler","average_rating":3.9,"ratings_count":119482,"text_reviews_count":6923}},"average_rating":4.16,"ratings_count":23755,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50358103-money","title":"Money: The True Story of a Made-Up Thing","title_without_series":"Money: The True Story of a Made-Up Thing","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1585192145l/50358103._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1585192145l/50358103._SX98_.jpg","description":"Money only works because we all agree to believe in it. In <i>Money</i>, Jacob Goldstein shows how money is a useful fiction that has shaped societies for thousands of years, from the rise of coins in ancient Greece to the first stock market in Amsterdam to the emergence of shadow banking in the 21st century.<br />At the heart of the story are the fringe thinkers and world leaders who reimagined money. Kublai Khan, the Mongol emperor, created paper money backed by nothing, centuries before it appeared in the west. John Law, a professional gambler and convicted murderer, brought modern money to France (and destroyed the country's economy). The cypherpunks, a group of radical libertarian computer programmers, paved the way for bitcoin.<br />One thing they all realized: what counts as money (and what doesn't) is the result of choices we make, and those choices have a profound effect on who gets more stuff and who gets less, who gets to take risks when times are good, and who gets screwed when things go bad.<br />Lively, accessible, and full of interesting details (like the 43-pound copper coins that 17th-century Swedes carried strapped to their backs), <i>Money</i> is the story of the choices that gave us money as we know it today.<b>\\n  <br />\\n</b><br /><b>The co-host of the popular NPR podcast <i>Planet Money </i>provides a well-researched, entertaining, somewhat irreverent look at how money is a made-up thing that has evolved over time to suit humanity's changing needs.</b><b>\\n  <br />\\n</b>","num_pages":272,"authors":{"author":{"id":1000751,"name":"Jacob Goldstein","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1000751.Jacob_Goldstein","average_rating":4.19,"ratings_count":6562,"text_reviews_count":796}},"average_rating":4.19,"ratings_count":6562,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1301.Moneyball","title":"Moneyball","title_without_series":"Moneyball","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"Billy Beane, general manager of MLB's Oakland A's and protagonist of Michael Lewis's <i>Moneyball</i>, had a problem: how to win in the Major Leagues with a budget that's smaller than that of nearly every other team. Conventional wisdom long held that big name, highly athletic hitters and young pitchers with rocket arms were the ticket to success. But Beane and his staff, buoyed by massive amounts of carefully interpreted statistical data, believed that wins could be had by more affordable methods such as hitters with high on-base percentage and pitchers who get lots of ground outs. Given this information and a tight budget, Beane defied tradition and his own scouting department to build winning teams of young affordable players and inexpensive castoff veterans. <p> Lewis was in the room with the A's top management as they spent the summer of 2002 adding and subtracting players and he provides outstanding play-by-play. In the June player draft, Beane acquired nearly every prospect he coveted (few of whom were coveted by other teams) and at the July trading deadline he engaged in a tense battle of nerves to acquire a lefty reliever. Besides being one of the most insider accounts ever written about baseball, <i>Moneyball</i> is populated with fascinating characters. We meet Jeremy Brown, an overweight college catcher who most teams project to be a 15th round draft pick (Beane takes him in the first). Sidearm pitcher Chad Bradford is plucked from the White Sox triple-A club to be a key set-up man and catcher Scott Hatteberg is rebuilt as a first baseman. But the most interesting character is Beane himself. A speedy athletic can't-miss prospect who somehow missed, Beane reinvents himself as a front-office guru, relying on players completely unlike, say, Billy Beane. Lewis, one of the top nonfiction writers of his era (<i>Liar's Poker</i>, <i>The New New Thing</i>), offers highly accessible explanations of baseball stats and his roadmap of Beane's economic approach makes <i>Moneyball</i> an appealing reading experience for business people and sports fans alike. <i>--John Moe</i></p>","num_pages":317,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":4.27,"ratings_count":145270,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6346975-moonwalking-with-einstein","title":"Moonwalking with Einstein: The Art and Science of Remembering Everything","title_without_series":"Moonwalking with Einstein: The Art and Science of Remembering Everything","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630575238l/6346975._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630575238l/6346975._SX98_.jpg","description":"<b>The blockbuster phenomenon that charts an amazing journey of the mind while revolutionizing our concept of memory</b><br /><br />An instant bestseller that is poised to become a classic, <i>Moonwalking with Einstein</i> recounts Joshua Foer's yearlong quest to improve his memory under the tutelage of top \\"mental athletes.\\" He draws on cutting-edge research, a surprising cultural history of remembering, and venerable tricks of the mentalist's trade to transform our understanding of human memory. From the United States Memory Championship to deep within the author's own mind, this is an electrifying work of journalism that reminds us that, in every way that matters, we are the sum of our memories.","num_pages":307,"authors":{"author":{"id":2867569,"name":"Joshua Foer","role":"","image_url":"https://images.gr-assets.com/authors/1322436441p5/2867569.jpg","small_image_url":"https://images.gr-assets.com/authors/1322436441p2/2867569.jpg","link":"https://www.goodreads.com/author/show/2867569.Joshua_Foer","average_rating":3.91,"ratings_count":102958,"text_reviews_count":8136}},"average_rating":3.88,"ratings_count":94379,"publication_day":3,"publication_month":3,"publication_year":2011},{"link":"https://www.goodreads.com/book/show/218372426-moral-ambition","title":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","title_without_series":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1735426102l/218372426._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1735426102l/218372426._SX98_.jpg","description":"<b>From the author of the <i>New York Times</i> bestsellers <i>Humankind</i> and <i>Utopia for Realists</i>a more politically radical Malcolm Gladwell (<i>The New York Times</i>)comes a bold manifesto daring us to harness our talents and transform our idealism into action, all with the goal of making the world a wildly better place.</b><br /><br />A career consists of 2,000 workweeks, and how you spend that time is one of the most important decisions of your life. Still, millions of people are stuck in in mind-numbing, pointless, or just plain harmful jobs.<br /><br />Theres an antidote to this waste of talent, and its called moral ambition. Moral ambition is the will to be among the best, but with different measures of success. Not a fancy title, fat salary, or corner office, but a career dedicated to the best solutions to the worlds biggest problems whether that means tackling climate change, making pandemics history or fighting Big Tobacco.<br /><br />In <i>Moral Ambition</i>, internationally bestselling author Rutger Bregman reveals how our conventional definitions of success are harming us and the planet, and shows how we can shift the focus from personal gain to societal benefit. In the process, he explains, we will join a growing movement of pioneers who are already living out this ethos. Theyre the builders, the problem-solvers, the doers who have chosen a path less traveled. A guidebook to finding that path for ourselves, <i>Moral Ambition</i> reminds us that the real measure of success lies not in what we accumulate, but in what we contribute, and shows how we, too, can build a legacy that truly matters.","num_pages":"","authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.21,"ratings_count":142058,"text_reviews_count":14509}},"average_rating":3.76,"ratings_count":11313,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17986418-naked-statistics","title":"Naked Statistics: Stripping the Dread from the Data","title_without_series":"Naked Statistics: Stripping the Dread from the Data","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395613778l/17986418._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395613778l/17986418._SX98_.jpg","description":"Once considered tedious, the field of statistics is rapidly evolving into a discipline Hal Varian, chief economist at Google, has actually called sexy. From batting averages and political polls to game shows and medical research, the real-world application of statistics continues to grow by leaps and bounds. How can we catch schools that cheat on standardized tests? How does Netflix know which movies youll like? What is causing the rising incidence of autism? As best-selling author Charles Wheelan shows us in <em>Naked Statistics</em>, the right data and a few well-chosen statistical tools can help us answer these questions and more.<br />For those who slept through Stats 101, this book is a lifesaver. Wheelan strips away the arcane and technical details and focuses on the underlying intuition that drives statistical analysis. He clarifies key concepts such as inference, correlation, and regression analysis, reveals how biased or careless parties can manipulate or misrepresent data, and shows us how brilliant and creative researchers are exploiting the valuable data from natural experiments to tackle thorny questions.<br /><br /><br />And in Wheelans trademark style, theres not a dull page in sight. Youll encounter clever Schlitz Beer marketers leveraging basic probability, an International Sausage Festival illuminating the tenets of the central limit theorem, and a head-scratching choice from the famous game show <em>Lets Make a Deal</em>and youll come away with insights each time. With the wit, accessibility, and sheer fun that turned <em>Naked Economics</em> into a bestseller, Wheelan defies the odds yet again by bringing another essential, formerly unglamorous discipline to life.","num_pages":304,"authors":{"author":{"id":18704,"name":"Charles Wheelan","role":"","image_url":"https://images.gr-assets.com/authors/1456860234p5/18704.jpg","small_image_url":"https://images.gr-assets.com/authors/1456860234p2/18704.jpg","link":"https://www.goodreads.com/author/show/18704.Charles_Wheelan","average_rating":4.01,"ratings_count":42956,"text_reviews_count":3927}},"average_rating":3.96,"ratings_count":15212,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/3949642-nepal---culture-smart","title":"Nepal - Culture Smart!: The Essential Guide to Customs & Culture (16)","title_without_series":"Nepal - Culture Smart!: The Essential Guide to Customs & Culture","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320559416l/3949642._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320559416l/3949642._SX98_.jpg","description":"Culture Smart! provides essential information on attitudes, beliefs and behavior in different countries, ensuring that you arrive at your destination aware of basic manners, common courtesies, and sensitive issues. These concise guides tell you what to expect, how to behave, and how to establish a rapport with your hosts. This inside knowledge will enable you to steer clear of embarrassing gaffes and mistakes, feel confident in unfamiliar situations, and develop trust, friendships, and successful business relationships.<br /><br />Culture Smart! offers illuminating insights into the culture and society of a particular country. It will help you to turn your visit-whether on business or for pleasure-into a memorable and enriching experience. Contents include:<br /><br />* customs, values, and traditions<br />* historical, religious, and political background<br />* life at home<br />* leisure, social, and cultural life<br />* eating and drinking<br />* do's, don'ts, and taboos<br />* business practices<br />* communication, spoken and unspoken<br /><br />\\"Culture Smart has come to the rescue of hapless travellers.\\" <i>Sunday Times Travel<br /><br /></i>\\"... the perfect introduction to the weird, wonderful and downright odd quirks and customs of various countries.\\" <i>Global Travel<br /><br /></i>\\"...full of fascinating-as well as common-sense-tips to help you avoid embarrassing faux pas.\\" <i>Observer<br /><br /></i>\\"...as useful as they are entertaining.\\" <i>Easyjet Magazine<br /><br /></i>\\"...offer glimpses into the psyche of a faraway world.\\" <i>New York Times</i>","num_pages":"","authors":{"author":{"id":1684350,"name":"Tessa Feller","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1684350.Tessa_Feller","average_rating":3.97,"ratings_count":201,"text_reviews_count":13}},"average_rating":3.98,"ratings_count":177,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/36258318-netherlands---culture-smart","title":"Netherlands - Culture Smart!: The Essential Guide to Customs & Culture","title_without_series":"Netherlands - Culture Smart!: The Essential Guide to Customs & Culture","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1527525724l/36258318._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1527525724l/36258318._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":1104428,"name":"Sheryl Buckland","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1104428.Sheryl_Buckland","average_rating":4.05,"ratings_count":137,"text_reviews_count":8}},"average_rating":3.99,"ratings_count":76,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50772888-no-filter","title":"No Filter: The Inside Story of Instagram","title_without_series":"No Filter: The Inside Story of Instagram","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>Award-winning reporter Sarah Frier reveals an inside, never-before-told, behind-the-scenes look at how Instagram defied the odds to become one of the most culturally defining apps of the decade. </b><br /><br />Since its creation in 2010, Instagrams fun and simple interface has captured our collective imagination, swiftly becoming a way of life. In <i>No Filter: The Inside Story of Instagram</i>, technology reporter Sarah Frier explains how Instagrams founders married art and technology to overcome skeptics and to hook the public on visual storytelling. At first, Instagram initially attracted artisans, but then the platform exploded in popularity among the masses, creating an entire industry of digital influencers thats now worth tens of billions of dollars.<br /><br />Eighteen months after Instagrams launch and explosive growth, the founders made the gut-wrenching decision to sell the company to Facebook. For most companies, that would be the end of the story; but for Instagram, it was only the beginning. Instagram borrowed some lessons from Facebook and rejected others, until eventually its success stirred tension with Facebooks CEO Mark Zuckerberg, just as Facebook became embroiled in a string of public crises. Frier unearths the details that led to the cofoundersKevin Systrom and Mike Kriegerdeparture, bringing to light dramatic moments unknown to the public until now.<br /><br />At its heart, <i>No Filter</i> draws on unprecedented exclusive accessfrom the founders of Instagram, as well as employees, executives, and competitors; hedge fund billionaire Ray Dalio; Anna Wintour of <i>Vogue</i>; Kris Jenner of the Kardashian-Jenner empire; and a plethora of influencers, from fashionistas with millions of followers to owners of famous dogs worldwideto show how Instagram has fundamentally changed the way we communicate, shop, eat, and travel. The book brings readers inside users strategies to craft their personal image and fame, explaining how the companys product decisions have affected the structure of our society. From teenagers to the pope, <i>No Filter </i>tells the captivating story of how Instagram not only created a new industry but also changed our lives.","num_pages":"","authors":{"author":{"id":19284946,"name":"Sarah Frier","role":"","image_url":"https://images.gr-assets.com/authors/1566424706p5/19284946.jpg","small_image_url":"https://images.gr-assets.com/authors/1566424706p2/19284946.jpg","link":"https://www.goodreads.com/author/show/19284946.Sarah_Frier","average_rating":4.11,"ratings_count":10907,"text_reviews_count":1234}},"average_rating":4.11,"ratings_count":10910,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18213403-no-place-to-hide","title":"No Place to Hide: Edward Snowden, the NSA, and the U.S. Surveillance State","title_without_series":"No Place to Hide: Edward Snowden, the NSA, and the U.S. Surveillance State","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383352779l/18213403._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383352779l/18213403._SX98_.jpg","description":"This is a look at the NSA surveillance scandal, from the reporter who broke the story. The Guardian reporter, Glenn Greenwald, provides a look into the NSA scandal that has triggered a debate over national security. With revelations from documents entrusted to her by Snowden, it explores the cooperation between private industry and the NSA.","num_pages":260,"authors":{"author":{"id":205996,"name":"Glenn Greenwald","role":"","image_url":"https://images.gr-assets.com/authors/1371508181p5/205996.jpg","small_image_url":"https://images.gr-assets.com/authors/1371508181p2/205996.jpg","link":"https://www.goodreads.com/author/show/205996.Glenn_Greenwald","average_rating":4.06,"ratings_count":18060,"text_reviews_count":1714}},"average_rating":4.07,"ratings_count":15110,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/49099937-no-rules-rules","title":"No Rules Rules: Netflix and the Culture of Reinvention","title_without_series":"No Rules Rules: Netflix and the Culture of Reinvention","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1595815356l/49099937._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1595815356l/49099937._SX98_.jpg","description":"<b>Shortlisted for the 2020 Financial Times &amp; McKinsey Business Book of the Year </b><br /><br /><b>\\n  <b>Netflix cofounder Reed Hastings reveals for the first time the unorthodox culture behind one of the world's most innovative, imaginative, and successful companies</b>\\n</b><br /><br />There has never before been a company like Netflix. It has led nothing short of a revolution in the entertainment industries, generating billions of dollars in annual revenue while capturing the imaginations of hundreds of millions of people in over 190 countries. But to reach these great heights, Netflix, which launched in 1998 as an online DVD rental service, has had to reinvent itself over and over again. This type of unprecedented flexibility would have been impossible without the counterintuitive and radical management principles that cofounder Reed Hastings established from the very beginning. Hastings rejected the conventional wisdom under which other companies operate and defied tradition to instead build a culture focused on freedom and responsibility, one that has allowed Netflix to adapt and innovate as the needs of its members and the world have simultaneously transformed.<br /><br />Hastings set new standards, valuing people over process, emphasizing innovation over efficiency, and giving employees context, not controls. At Netflix, there are no vacation or expense policies. At Netflix, adequate performance gets a generous severance, and hard work is irrel-evant. At Netflix, you don't try to please your boss, you give candid feedback instead. At Netflix, employees don't need approval, and the company pays top of market. When Hastings and his team first devised these unorthodox principles, the implications were unknown and untested. But in just a short period, their methods led to unparalleled speed and boldness, as Netflix quickly became one of the most loved brands in the world.<br /><br />Here for the first time, Hastings and Erin Meyer, bestselling author of <i>The Culture Map </i>and one of the world's most influential business thinkers, dive deep into the controversial ideologies at the heart of the Netflix psyche, which have generated results that are the envy of the business world. Drawing on hundreds of interviews with current and past Netflix employees from around the globe and never-before-told stories of trial and error from Hastings's own career, <i>No Rules Rules </i>is the fascinating and untold account of the philosophy behind one of the world's most innovative, imaginative, and successful companies.","num_pages":"","authors":{"author":{"id":19792006,"name":"Reed Hastings","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/19792006.Reed_Hastings","average_rating":4.27,"ratings_count":33204,"text_reviews_count":2811}},"average_rating":4.27,"ratings_count":33205,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17161156-norwegian-wood","title":"Norwegian Wood","title_without_series":"Norwegian Wood","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1493851993l/17161156._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1493851993l/17161156._SX98_.jpg","description":"The haunting, enigmatic love story that turned Murakami into a literary superstar in Japan, and is his bestselling title throughout the world <br /><br />When he hears her favourite Beatles song, Toru Watanabe recalls his first love Naoko, the girlfriend of his best friend Kizuki. Immediately he is transported back almost twenty years to his student days in Tokyo, adrift in a world of uneasy friendships, casual sex, passion, loss and desire - to a time when an impetuous young woman called Midori marches into his life and he has to choose between the future and the past.","num_pages":389,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4260675,"text_reviews_count":366787}},"average_rating":3.99,"ratings_count":735176,"publication_day":4,"publication_month":7,"publication_year":2003},{"link":"https://www.goodreads.com/book/show/17662487-nudge","title":"Nudge: Improving Decisions About Health, Wealth, and Happiness","title_without_series":"Nudge: Improving Decisions About Health, Wealth, and Happiness","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SX98_.jpg","description":"For fans of Malcolm Gladwells Blink and Nobel Prize winner Daniel Kahnemans Thinking Fast and Slow, a revelatory new look at how we make decisions<br /><br />A New York Times bestseller<br />An Economist Best Book of the Year<br />A Financial Times Best Book of the Year<br /><br />Nudge is about choiceshow we make them and how we can make better ones. Drawing on decades of research in the fields of behavioral science and economics, authors Richard H. Thaler and Cass R. Sunstein offer a new perspective on preventing the countless mistakes we makeill-advised personal investments, consumption of unhealthy foods, neglect of our natural resourcesand show us how sensible choice architecture can successfully nudge people toward the best decisions. In the tradition of The Tipping Point and Freakonomics, Nudge is straightforward, informative, and entertaininga must-read for anyone interested in our individual and collective well-being.","num_pages":324,"authors":{"author":{"id":65483,"name":"Richard H. Thaler","role":"","image_url":"https://images.gr-assets.com/authors/1438885744p5/65483.jpg","small_image_url":"https://images.gr-assets.com/authors/1438885744p2/65483.jpg","link":"https://www.goodreads.com/author/show/65483.Richard_H_Thaler","average_rating":3.9,"ratings_count":119482,"text_reviews_count":6923}},"average_rating":3.84,"ratings_count":95033,"publication_day":24,"publication_month":2,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/50705179-numbers-don-t-lie","title":"Numbers Don't Lie: 71 Things You Need to Know About the World","title_without_series":"Numbers Don't Lie: 71 Things You Need to Know About the World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1666542864l/50705179._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1666542864l/50705179._SX98_.jpg","description":"<b>Is flying dangerous? How much do the world's cows weigh? And what makes people happy?</b><br /><br />From earth's nations and inhabitants, through the fuels and foods that energize them, to the transportation and inventions of our modern world - and how all of this affects the planet itself - in <i>Numbers Don't Lie</i>, Professor Vaclav Smil takes us on a fact-finding adventure, using surprising statistics and illuminating graphs to challenge lazy thinking.<br /><br />Packed with 'well-I-never-knew-that' information and with fascinating and unusual examples throughout, we see how it is too soon to judge shale gas, that vaccination yields the best return on investment, and why electric cars aren't as great as we think (yet). There's a wonderful mix of science, history and wit, all in bite-sized chapters on a broad range of topics.<br /><br /><b>Should you trust unemployment figures? Is China's rise unstoppable? And what's worse for the environment: your car or mobile phone?</b><br /><br />Unclouded by pessimism or optimism and unafraid of big questions, Smil explains why calls for the Anthropocene era may be premature but why the Paris Agreement does not go far enough. These issues are not straightforward and progress takes longer than you think, but with Smil as our authoritative and entertaining guide we get a healthy shot of realism.<br /><br />Urgent and essential, <i>Numbers Don't Lie</i> is a powerful rallying cry for interrogating what you take to be true in these significant times. Smil is on a mission to make facts matter, because after all, numbers may not lie, but which truth do they convey?","num_pages":384,"authors":{"author":{"id":5003,"name":"Vaclav Smil","role":"","image_url":"https://images.gr-assets.com/authors/1619861469p5/5003.jpg","small_image_url":"https://images.gr-assets.com/authors/1619861469p2/5003.jpg","link":"https://www.goodreads.com/author/show/5003.Vaclav_Smil","average_rating":3.9,"ratings_count":39774,"text_reviews_count":4079}},"average_rating":3.82,"ratings_count":10473,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/35890182-on-confidence","title":"On Confidence","title_without_series":"On Confidence","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"","num_pages":"","authors":{"author":{"id":6509498,"name":"The School of Life","role":"","image_url":"https://images.gr-assets.com/authors/1479529978p5/6509498.jpg","small_image_url":"https://images.gr-assets.com/authors/1479529978p2/6509498.jpg","link":"https://www.goodreads.com/author/show/6509498.The_School_of_Life","average_rating":3.99,"ratings_count":47429,"text_reviews_count":5649}},"average_rating":3.92,"ratings_count":3503,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/3228917-outliers","title":"Outliers: The Story of Success","title_without_series":"Outliers: The Story of Success","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1344266315l/3228917._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1344266315l/3228917._SX98_.jpg","description":"In this stunning book, Malcolm Gladwell takes us on an intellectual journey through the world of \\"outliers\\"the best and the brightest, the most famous and the most successful. He asks the question: what makes high-achievers different?<br /><br />His answer is that we pay too much attention to what successful people are like, and too little attention to where they are from: that is, their culture, their family, their generation, and the idiosyncratic experiences of their upbringing. Along the way he explains the secrets of software billionaires, what it takes to be a great soccer player, why Asians are good at math, and what made the Beatles the greatest rock band.","num_pages":309,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3176601,"text_reviews_count":132017}},"average_rating":4.19,"ratings_count":870462,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/46223297-permanent-record","title":"Permanent Record","title_without_series":"Permanent Record","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564666396l/46223297._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564666396l/46223297._SX98_.jpg","description":"Edward Snowden, the man who risked everything to expose the US governments system of mass surveillance, reveals for the first time the story of his life, including how he helped to build that system and what motivated him to try to bring it down.<br /><br />In 2013, twenty-nine-year-old Edward Snowden shocked the world when he broke with the American intelligence establishment and revealed that the United States government was secretly pursuing the means to collect every single phone call, text message, and email. The result would be an unprecedented system of mass surveillance with the ability to pry into the private lives of every person on earth. Six years later, Snowden reveals for the very first time how he helped to build this system and why he was moved to expose it.<br /><br />Spanning the bucolic Beltway suburbs of his childhood and the clandestine CIA and NSA postings of his adulthood, <i>Permanent Record</i> is the extraordinary account of a bright young man who grew up onlinea man who became a spy, a whistleblower, and, in exile, the Internets conscience. Written with wit, grace, passion, and an unflinching candor, <i>Permanent Record</i> is a crucial memoir of our digital age and destined to be a classic.","num_pages":339,"authors":{"author":{"id":7140597,"name":"Edward Snowden","role":"","image_url":"https://images.gr-assets.com/authors/1425078029p5/7140597.jpg","small_image_url":"https://images.gr-assets.com/authors/1425078029p2/7140597.jpg","link":"https://www.goodreads.com/author/show/7140597.Edward_Snowden","average_rating":4.29,"ratings_count":58536,"text_reviews_count":5349}},"average_rating":4.3,"ratings_count":58184,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25135194-prisoners-of-geography","title":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics (Politics of Place, #1)","title_without_series":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SX98_.jpg","description":"<i>Geography shapes not only our history, but where we're headed...</i><br /><br />All leaders are constrained by geography. Their choices are limited by mountains, rivers, seas and concrete. Yes, to follow world events you need to understand people, ideas and movements - but if you don't know geography, you'll never have the full picture.<br /><br />If you've ever wondered why Putin is so obsessed with Crimea, why the USA was destined to become a global superpower, or why China's power base continues to expand ever outwards, the answers are all here.<br /><br /><b>In ten chapters and ten maps, <i>Prisoners of Geography</i> looks at the past, present and future to offer an essential insight into one of the major factors that determines world history.<br /><br />It's time to put the 'geo' back into geopolitics.<br /><br />Ten maps; ten chapters:<br /><br />Russia * China * United States of America * Latin America * the Middle East * Africa * India and Pakistan * Europe * Japan and Korea * the Arctic</b>","num_pages":256,"authors":{"author":{"id":713466,"name":"Tim  Marshall","role":"","image_url":"https://images.gr-assets.com/authors/1489696759p5/713466.jpg","small_image_url":"https://images.gr-assets.com/authors/1489696759p2/713466.jpg","link":"https://www.goodreads.com/author/show/713466.Tim_Marshall","average_rating":4.14,"ratings_count":167924,"text_reviews_count":13897}},"average_rating":4.19,"ratings_count":118074,"publication_day":9,"publication_month":7,"publication_year":2015},{"link":"https://www.goodreads.com/book/show/54493401-project-hail-mary","title":"Project Hail Mary","title_without_series":"Project Hail Mary","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1764703833l/54493401._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1764703833l/54493401._SX98_.jpg","description":"<b>A LONE ASTRONAUT. <br />AN IMPOSSIBLE MISSION. <br />AN ALLY HE NEVER IMAGINED.</b><br /><br /><b> RYLAND GRACE</b> is the sole survivor on a desperate, last-chance missionand if he fails, humanity and Earth itself will perish.<br /><br />Except that right now, he doesnt know that. He cant even remember his own name, let alone the nature of his assignment or how to complete it.<br /><br />All he knows is that hes been asleep for a very, very long time. And hes just been awakened to find himself millions of miles from home, with nothing but two corpses for company.<br /><br />His crewmates dead, his memories fuzzily returning, Ryland realizes that an impossible task now confronts him. Hurtling through space on this tiny ship, its up to him to puzzle out an impossible scientific mysteryand conquer an extinction-level threat to our species.<br /><br />And with the clock ticking down and the nearest human being light-years away, hes got to do it all alone.<br /><br />Or does he?<br /><br />An irresistible interstellar adventure as only Andy Weir could imagine it, <i>Project Hail Mary</i> is a tale of discovery, speculation, and survival to rival <i>The Martian</i>while taking us to places it never dreamed of going.","num_pages":476,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.35,"ratings_count":2919335,"text_reviews_count":301814}},"average_rating":4.5,"ratings_count":1186092,"publication_day":4,"publication_month":5,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/8520610-quiet","title":"Quiet: The Power of Introverts in a World That Can't Stop Talking","title_without_series":"Quiet: The Power of Introverts in a World That Can't Stop Talking","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328562861l/8520610._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328562861l/8520610._SX98_.jpg","description":"<b>The book that started the Quiet Revolution<br /></b><br />At least one-third of the people we know are introverts. They are the ones who prefer listening to speaking; who innovate and create but dislike self-promotion; who favor working on their own over working in teams. It is to introvertsRosa Parks, Chopin, Dr. Seuss, Steve Wozniakthat we owe many of the great contributions to society.<br /><br />In <i>Quiet, </i>Susan Cain argues that we dramatically undervalue introverts and shows how much we lose in doing so. She charts the rise of the Extrovert Ideal throughout the twentieth century and explores how deeply it has come to permeate our culture. She also introduces us to successful introvertsfrom a witty, high-octane public speaker who recharges in solitude after his talks, to a record-breaking salesman who quietly taps into the power of questions. Passionately argued, superbly researched, and filled with indelible stories of real people, <i>Quiet </i>has the power to permanently change how we see introverts and, equally important, how they see themselves.<br /><br />Now with Extra Libris material, including a readers guide and bonus content.","num_pages":333,"authors":{"author":{"id":4101935,"name":"Susan Cain","role":"","image_url":"https://images.gr-assets.com/authors/1644435084p5/4101935.jpg","small_image_url":"https://images.gr-assets.com/authors/1644435084p2/4101935.jpg","link":"https://www.goodreads.com/author/show/4101935.Susan_Cain","average_rating":4.07,"ratings_count":512207,"text_reviews_count":35911}},"average_rating":4.07,"ratings_count":476684,"publication_day":24,"publication_month":1,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/63018232-random-acts-of-medicine","title":"Random Acts of Medicine: The Hidden Forces That Sway Doctors, Impact Patients, and Shape Our Health","title_without_series":"Random Acts of Medicine: The Hidden Forces That Sway Doctors, Impact Patients, and Shape Our Health","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684815163l/63018232._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684815163l/63018232._SX98_.jpg","description":"Does timing, circumstance, or luck impact your health care? This groundbreaking book reveals the hidden side of medicine and how unexpectedbut predictableevents can profoundly affect our health.  Is there ever a good time to have a heart attack? Why do kids born in the summer get diagnosed more often with A.D.H.D.? How are marathons harmful for your health, even when you're not running?<br /><br />\\"Fantastically entertaining and deeply thought-provoking.\\" Emily Oster, New York Times bestselling author of The Family Firm, Cribsheet, and Expecting Better<br /><br />\\"Smart, entertaining, and full of surprises.\\" Steven D. Levitt, #1 New York Times bestselling co-author of Freakonomics<br /><br />As a University of Chicagotrained economist and Harvard medical school professor and doctor, Anupam Jena is uniquely equipped to answer these questions. And as a critical care doctor at Massachusetts General who researches health care policy, Christopher Worsham confronts their impact on the hospitals sickest patients. In this singular work of science and medicine, Jena and Worsham show us how medicine really works, and its effect on all of us.<br /><br />Relying on ingeniously devised natural experimentsrandom events that unknowingly turn us into experimental subjectsJena and Worsham do more than offer readers colorful stories. They help us see the way our health is shaped by forces invisible to the untrained eye. Is there ever a good time to have a heart attack? Do you choose the veteran doctor or the rookie? Do you really need the surgery your doctor recommends? These questions are rife with significance; their impact can be life changing. Addressing them in a style thats both animated and enlightening, Random Acts of Medicine empowers you to see past the white coat and find out what really makes medicine workand how it could work better.","num_pages":"","authors":{"author":{"id":4269933,"name":"Anupam B. Jena","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/4269933.Anupam_B_Jena","average_rating":3.69,"ratings_count":1762,"text_reviews_count":255}},"average_rating":3.69,"ratings_count":1762,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/44000528-range","title":"Range: Why Generalists Triumph in a Specialized World","title_without_series":"Range: Why Generalists Triumph in a Specialized World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550048363l/44000528._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550048363l/44000528._SX98_.jpg","description":"What's the most effective path to success in any domain? It's not what you think.<br /><br />Plenty of experts argue that anyone who wants to develop a skill, play an instrument, or lead their field should start early, focus intensely, and rack up as many hours of deliberate practice as possible. If you dabble or delay, you'll never catch up to the people who got a head start. But if you take a closer look at the world's top performers, from professional athletes to Nobel laureates, you'll find that early specialisation is the exception, not the rule. <br /><br />David Epstein, author of the <i>New York Times</i> bestseller <i>The Sports Gene</i>, studied the world's most successful athletes, artists, musicians, inventors, forecasters and scientists. He discovered that in most fields--especially those that are complex and unpredictable--generalists, not specialists, are primed to excel. Generalists often find their path late, and they juggle many interests rather than focusing on one. They're also more creative, more agile, and able to make connections their more specialized peers can't spy from deep in their hyperfocused trenches. As experts silo themselves further while computers master more of the skills once reserved for highly focused humans, people who think broadly and embrace diverse experiences and perspectives will increasingly thrive. <br /><br />Our obsession with getting a head start is understandable; early specialization feels efficient. But Epstein marshals an enormous body of scientific research to argue that we should all actively cultivate inefficiency. Failing a test is the best way to learn. Frequent quitters end up with the most fulfilling careers. The most impactful inventors cross domains rather than deepening their knowledge in a single area. Provocative, rigorous, and engrossing, <i>Range</i> explains how to maintain the benefits of breadth, diverse experience, interdisciplinary thinking, and delayed concentration in a world that increasingly incentivizes, even demands, hyperspecialization.","num_pages":339,"authors":{"author":{"id":7164089,"name":"David   Epstein","role":"","image_url":"https://images.gr-assets.com/authors/1545945759p5/7164089.jpg","small_image_url":"https://images.gr-assets.com/authors/1545945759p2/7164089.jpg","link":"https://www.goodreads.com/author/show/7164089.David_Epstein","average_rating":4.14,"ratings_count":97199,"text_reviews_count":8854}},"average_rating":4.13,"ratings_count":80082,"publication_day":28,"publication_month":5,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/9969571-ready-player-one","title":"Ready Player One (Ready Player One, #1)","title_without_series":"Ready Player One","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1500930947l/9969571._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1500930947l/9969571._SX98_.jpg","description":"<i>Librarian's note: An alternate cover edition can be found <a href=\\"https://www.goodreads.com/book/show/54733514.here\\" title=\\"here\\" rel=\\"nofollow noopener\\">here</a></i><br /><br /><b>IN THE YEAR 2044, reality is an ugly place.</b> The only time teenage Wade Watts really feels alive is when he's jacked into the virtual utopia known as the OASIS. Wade's devoted his life to studying the puzzles hidden within this world's digital confines, puzzles that are based on their creator's obsession with the pop culture of decades past and that promise massive power and fortune to whoever can unlock them. <br /><br />But when Wade stumbles upon the first clue, he finds himself beset by players willing to kill to take this ultimate prize. The race is on, and if Wade's going to survive, he'll have to winand confront the real world he's always been so desperate to escape.","num_pages":480,"authors":{"author":{"id":31712,"name":"Ernest Cline","role":"","image_url":"https://images.gr-assets.com/authors/1310753539p5/31712.jpg","small_image_url":"https://images.gr-assets.com/authors/1310753539p2/31712.jpg","link":"https://www.goodreads.com/author/show/31712.Ernest_Cline","average_rating":4.08,"ratings_count":1627302,"text_reviews_count":147238}},"average_rating":4.23,"ratings_count":1306520,"publication_day":16,"publication_month":8,"publication_year":2011},{"link":"https://www.goodreads.com/book/show/216857785-revenge-of-the-tipping-point","title":"Revenge of the Tipping Point","title_without_series":"Revenge of the Tipping Point","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1721984170l/216857785._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1721984170l/216857785._SX98_.jpg","description":"Twenty-five years after the publication of his groundbreaking first book, Malcolm Gladwell returns with a brand-new volume that reframes the lessons of The Tipping Point in a startling and revealing light.<br /><br />Why is MiamiMiami? What does the heartbreaking fate of the cheetah tell us about the way we raise our children? Why do Ivy League schools care so much about sports? What is the Magic Third, and what does it mean for racial harmony? In this provocative new work, Malcolm Gladwell returns for the first time in twenty-five years to the subject of social epidemics and tipping points, this time with the aim of explaining the dark side of contagious phenomena.<br /> <br />Through a series of riveting stories, Gladwell traces the rise of a new and troubling form of social engineering. He takes us to the streets of Los Angeles to meet the worlds most successful bank robbers, rediscovers a forgotten television show from the 1970s that changed the world, visits the site of a historic experiment on a tiny cul-de-sac in northern California, and offers an alternate history of two of the biggest epidemics of our day: COVID and the opioid crisis. Revenge of the Tipping Point is Gladwells most personal book yet. With his characteristic mix of storytelling and social science, he offers a guide to making sense of the contagions of modern world. Its time we took tipping points seriously.","num_pages":352,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3176601,"text_reviews_count":132017}},"average_rating":4.02,"ratings_count":59489,"publication_day":1,"publication_month":10,"publication_year":2024},{"link":"https://www.goodreads.com/book/show/10144145-rich-dad-poor-dad","title":"Rich Dad Poor Dad: What the Rich Teach Their Kids About Money That the Poor and Middle Class Do Not!","title_without_series":"Rich Dad Poor Dad: What the Rich Teach Their Kids About Money That the Poor and Middle Class Do Not!","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328736124l/10144145._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328736124l/10144145._SY160_.jpg","description":"<br /><i>Rich Dad Poor Dad</i>, the #1 Personal Finance book of all time, tells the story of <b>Robert Kiyosaki</b> and his two dadshis real father and the father of his best friend, his rich dadand the ways in which both men shaped his thoughts about money and investing. The book explodes the myth that you need to earn a high income to be rich and explains the difference between working for money and having your money work for you.","num_pages":275,"authors":{"author":{"id":600,"name":"Robert T. Kiyosaki","role":"","image_url":"https://images.gr-assets.com/authors/1236463010p5/600.jpg","small_image_url":"https://images.gr-assets.com/authors/1236463010p2/600.jpg","link":"https://www.goodreads.com/author/show/600.Robert_T_Kiyosaki","average_rating":4.09,"ratings_count":929166,"text_reviews_count":36232}},"average_rating":4.09,"ratings_count":731732,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/58284094-run-like-a-pro-even-if-you-re-slow","title":"Run Like a Pro (Even If You're Slow): Elite Tools and Tips for Runners at Every Level","title_without_series":"Run Like a Pro (Even If You're Slow): Elite Tools and Tips for Runners at Every Level","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1639201586l/58284094._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1639201586l/58284094._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":99585,"name":"Matt Fitzgerald","role":"","image_url":"https://images.gr-assets.com/authors/1631573197p5/99585.jpg","small_image_url":"https://images.gr-assets.com/authors/1631573197p2/99585.jpg","link":"https://www.goodreads.com/author/show/99585.Matt_Fitzgerald","average_rating":3.98,"ratings_count":36943,"text_reviews_count":3024}},"average_rating":4.05,"ratings_count":1287,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/124941268-same-as-ever","title":"Same as Ever: A Guide to What Never Changes","title_without_series":"Same as Ever: A Guide to What Never Changes","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350462l/124941268._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350462l/124941268._SX98_.jpg","description":"From Morgan Housel, bestselling author of The Psychology of Money , stories about what people have always done, and will always do<br /><br />Everyone wants to see the future. Few are good at it. From business to economics, politics to social trends, were just not very good at predicting what happens next.<br /><br />According to Morgan Housel, this is because we focus too much on what we think will change and not enough on what we know will stay the same.<br /><br />If you traveled in time to 500 years ago or 500 years from now, you would be astounded at how much technology and medicine has changed. The geopolitical order would make no sense to you. The language and dialect may be completely foreign. But youd notice people falling for greed and fear just like they do in our current world.<br /><br />Youd see people persuaded by risk, jealousy, and tribal affiliations in ways that are familiar to you.<br /><br />Youd see overconfidence and short-sightedness that reminds you of people's behavior today.<br /><br />Youd find people seeking the secret to a happy life and trying to find certainty when none exists in ways that are so relatable. <br /><br />When transported to an unfamiliar world, youd spend a few minutes watching people behave and say, Ah. Ive seen this before. Same as ever.<br /><br />History is filled with surprises no one could have seen coming. But if we learn to see what doesnt change, we can be more confident in our choices, no matter what the future brings.","num_pages":"","authors":{"author":{"id":7499284,"name":"Morgan Housel","role":"","image_url":"https://images.gr-assets.com/authors/1669719604p5/7499284.jpg","small_image_url":"https://images.gr-assets.com/authors/1669719604p2/7499284.jpg","link":"https://www.goodreads.com/author/show/7499284.Morgan_Housel","average_rating":4.27,"ratings_count":367392,"text_reviews_count":24613}},"average_rating":4.16,"ratings_count":23981,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23346740-sapiens","title":"Sapiens: A Brief History of Humankind","title_without_series":"Sapiens: A Brief History of Humankind","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1427068429l/23346740._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1427068429l/23346740._SX98_.jpg","description":"100,000 years ago, at least six human species inhabited the earth. Today there is just one. Us. <i>Homo sapiens</i>.<br /><br />How did our species succeed in the battle for dominance? Why did our foraging ancestors come together to create cities and kingdoms? How did we come to believe in gods, nations and human rights; to trust money, books and laws; and to be enslaved by bureaucracy, timetables and consumerism? And what will our world be like in the millennia to come?<br /><br />In <i>Sapiens, </i>Dr Yuval Noah Harari spans the whole of human history, from the very first humans to walk the earth to the radical  and sometimes devastating  breakthroughs of the Cognitive, Agricultural and Scientific Revolutions. Drawing on insights from biology, anthropology, palaeontology and economics, he explores how the currents of history have shaped our human societies, the animals and plants around us, and even our personalities. Have we become happier as history has unfolded? Can we ever free our behaviour from the heritage of our ancestors? And what, if anything, can we do to influence the course of the centuries to come?<br /><br />Bold, wide-ranging and provocative, <i>Sapiens </i>challenges everything we thought we knew about being human: our thoughts, our actions, our power ... and our future.","num_pages":498,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.28,"ratings_count":1829708,"text_reviews_count":101707}},"average_rating":4.33,"ratings_count":1271224,"publication_day":4,"publication_month":9,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/19288230-scrum","title":"Scrum: The Art of Doing Twice the Work in Half the Time","title_without_series":"Scrum: The Art of Doing Twice the Work in Half the Time","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1393221649l/19288230._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1393221649l/19288230._SX98_.jpg","description":"In the future, historians may look back on human progress and draw a sharp line designating before Scrum and after Scrum. Scrum is that ground-breaking. It already drives most of the worlds top technology companies. And now its starting to spread to every domain where leaders wrestle with complex projects.<br /> <br />If youve ever been startled by how fast the world is changing, Scrum is one of the reasons why. Productivity gains of as much as 1200% have been recorded, and theres no more lucid  or compelling  explainer of Scrum and its bright promise than Jeff Sutherland, the man who put together the first Scrum team more than twenty years ago.<br /> <br />The thorny problem Jeff began tackling back then boils down to this: people are spectacularly bad at doing things with agility and efficiency. Best laid plans go up in smoke. Teams often work at cross purposes to each other. And when the pressure rises, unhappiness soars. Drawing on his experience as a West Point-educated fighter pilot, biometrics expert, early innovator of ATM technology, and V.P. of engineering or CTO at eleven different technology companies, Jeff began challenging those dysfunctional realities, looking for solutions that would have global impact.<br /> <br />In this book youll journey to Scrums front lines where Jeffs system of deep accountability, team interaction, and constant iterative improvement is, among other feats, bringing the FBI into the 21st century, perfecting the design of an affordable 140 mile per hour/100 mile per gallon car, helping NPR report fast-moving action in the Middle East, changing the way pharmacists interact with patients, reducing poverty in the Third World, and even helping people plan their weddings and accomplish weekend chores. <br /> <br />Woven with insights from martial arts, judicial decision making, advanced aerial combat, robotics, and many other disciplines, Scrum is consistently riveting. But the most important reason to read this book is that it may just help you achieve what others consider unachievable  whether it be inventing a trailblazing technology, devising a new system of education, pioneering a way to feed the hungry, or, closer to home, a building a foundation for your family to thrive and prosper.","num_pages":237,"authors":{"author":{"id":2290725,"name":"Jeff Sutherland","role":"","image_url":"https://images.gr-assets.com/authors/1508058646p5/2290725.jpg","small_image_url":"https://images.gr-assets.com/authors/1508058646p2/2290725.jpg","link":"https://www.goodreads.com/author/show/2290725.Jeff_Sutherland","average_rating":4.13,"ratings_count":25616,"text_reviews_count":2191}},"average_rating":4.14,"ratings_count":23659,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/22826126-seveneves","title":"Seveneves","title_without_series":"Seveneves","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1422566422l/22826126._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1422566422l/22826126._SX98_.jpg","description":"What would happen if the world were ending?<br /><br />A catastrophic event renders the earth a ticking time bomb. In a feverish race against the inevitable, nations around the globe band together to devise an ambitious plan to ensure the survival of humanity far beyond our atmosphere, in outer space.<br /><br />But the complexities and unpredictability of human nature coupled with unforeseen challenges and dangers threaten the intrepid pioneers, until only a handful of survivors remain...<br /><br />Five thousand years later, their progeny -- seven distinct races now three billion strong -- embark on yet another audacious journey into the unknown ... to an alien world utterly transformed by cataclysm and time: Earth.","num_pages":867,"authors":{"author":{"id":545,"name":"Neal Stephenson","role":"","image_url":"https://images.gr-assets.com/authors/1430920344p5/545.jpg","small_image_url":"https://images.gr-assets.com/authors/1430920344p2/545.jpg","link":"https://www.goodreads.com/author/show/545.Neal_Stephenson","average_rating":4.03,"ratings_count":1033176,"text_reviews_count":67930}},"average_rating":4,"ratings_count":125424,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/27220736-shoe-dog","title":"Shoe Dog: A Memoir by the Creator of Nike","title_without_series":"Shoe Dog: A Memoir by the Creator of Nike","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1457284880l/27220736._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1457284880l/27220736._SX98_.jpg","description":"In this candid and riveting memoir, for the first time ever, Nike founder and CEO Phil Knight shares the inside story of the companys early days as an intrepid start-up and its evolution into one of the worlds most iconic, game-changing, and profitable brands.<br /><br />In 1962, fresh out of business school, Phil Knight borrowed $50 from his father and created a company with a simple mission: import high-quality, low-cost athletic shoes from Japan. Selling the shoes from the trunk of his lime green Plymouth Valiant, Knight grossed $8,000 his first year. Today, Nikes annual sales top $30 billion. In an age of startups, Nike is the <i>ne plus ultra</i> of all startups, and the swoosh has become a revolutionary, globe-spanning icon, one of the most ubiquitous and recognizable symbols in the world today.<br /><br />But Knight, the man behind the swoosh, has always remained a mystery. Now, for the first time, in a memoir that is candid, humble, gutsy, and wry, he tells his story, beginning with his crossroads moment. At 24, after backpacking around the world, he decided to take the unconventional path, to start his own businessa business that would be dynamic, <i>different.</i><br /><br />Knight details the many risks and daunting setbacks that stood between him and his dreamalong with his early triumphs. Above all, he recalls the formative relationships with his first partners and employees, a ragtag group of misfits and seekers who became a tight-knit band of brothers. Together, harnessing the transcendent power of a shared mission, and a deep belief in the spirit of sport, they built a brand that changed everything.","num_pages":400,"authors":{"author":{"id":3319233,"name":"Phil Knight","role":"","image_url":"https://images.gr-assets.com/authors/1541244521p5/3319233.jpg","small_image_url":"https://images.gr-assets.com/authors/1541244521p2/3319233.jpg","link":"https://www.goodreads.com/author/show/3319233.Phil_Knight","average_rating":4.45,"ratings_count":378067,"text_reviews_count":22215}},"average_rating":4.46,"ratings_count":371891,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/36064445-skin-in-the-game","title":"Skin in the Game: The Hidden Asymmetries in Daily Life","title_without_series":"Skin in the Game: The Hidden Asymmetries in Daily Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1510319798l/36064445._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1510319798l/36064445._SX98_.jpg","description":"From the <i>New York Times</i> bestselling author of <i>The Black Swan,</i> a bold new work that challenges many of our long-held beliefs about risk and reward, politics and religion, finance and personal responsibility<br /><br /> In his most provocative and practical book yet, one of the foremost thinkers of our time redefines what it means to understand the world, succeed in a profession, contribute to a fair and just society, detect nonsense, and influence others. Citing examples ranging from Hammurabi to Seneca, Antaeus the Giant to Donald Trump, Nassim Nicholas Taleb shows how the willingness to accept ones own risks is an essential attribute of heroes, saints, and flourishing people in all walks of life.<br /><br /> As always both accessible and iconoclastic, Taleb challenges long-held beliefs about the values of those who spearhead military interventions, make financial investments, and propagate religious faiths. Among his insights:<br /><br /> <b> <i>For social justice,focus on symmetry and risk sharing. </i></b>You cannot make profits and transfer the risks to others, as bankers and large corporations do. You cannot get rich without owning your own risk and paying for your own losses. Forcing skin in the game corrects this asymmetry better than thousands of laws and regulations.<br /> <b> <i>Ethical rules arent universal</i>.</b> Youre part of a group larger than you, but its still smaller than humanity in general.<br /> <b> <i>Minorities, not majorities, run the world. </i></b>The world is not run by consensus but by stubborn minorities imposing their tastes and ethics on others.<br /> <b> <i>You can be an intellectual yet still be an idiot</i>.</b> Educated philistines have been wrong on everything from Stalinism to Iraq to low-carb diets.<br /> <b> <i>Beware of complicated solutions (that someone was paid to find)</i>.</b> A simple barbell can build muscle better than expensive new machines.<br /> <b> <i>True religion is commitment, not just faith</i>.</b> How much you believe in something is manifested only by what youre willing to risk for it.<br /><br />The phrase skin in the game is one we have often heard but rarely stopped to truly dissect. It is the backbone of risk management, but its also an astonishingly rich worldview that, as Taleb shows in this book, applies to all aspects of our lives. As Taleb says, The symmetry of skin in the game is a simple rule thats necessary for fairness and justice, and the ultimate BS-buster, and Never trust anyone who doesnt have skin in the game. Without it, fools and crooks will benefit, and their mistakes will never come back to haunt them.","num_pages":272,"authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":309970,"text_reviews_count":21319}},"average_rating":3.91,"ratings_count":31883,"publication_day":1,"publication_month":6,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/197773418-slow-productivity","title":"Slow Productivity: The Lost Art of Accomplishment Without Burnout","title_without_series":"Slow Productivity: The Lost Art of Accomplishment Without Burnout","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>Do fewer things. Work at a natural pace. Obsess over quality.</b><br /><br />From the <i>New York Times</i> bestselling author of <i>Digital Minimalism</i> and <i>Deep Work,</i> a groundbreaking philosophy for pursuing meaningful accomplishment while avoiding overload.<br /><br />Our current definition of productivity is broken. It pushes us to treat busyness as a proxy for useful effort, leading to impossibly lengthy task lists and ceaseless meetings. Were overwhelmed by all we have to do and on the edge of burnout, left to decide between giving into soul-sapping hustle culture or rejecting ambition altogether. But are these really our only choices?<br /><br />Long before the arrival of pinging inboxes and clogged schedules, historys most creative and impactful philosophers, scientists, artists, and writers mastered the art of producing valuable work with staying power. In this timely and provocative book, Cal Newport harnesses the wisdom of these traditional knowledge workers to radically transform our modern jobs. Drawing from deep research on the habits and mindsets of a varied cast of storied thinkersfrom Galileo and Isaac Newton, to Jane Austen and Georgia OKeefeNewport lays out the key principles of slow productivity, a more sustainable alternative to the aimless overwhelm that defines our current moment. Combining cultural criticism with systematic pragmatism, Newport deconstructs the absurdities inherent in standard notions of productivity, and then provides step-by-step advice for workers to replace them with a slower, more humane alternative.<br /><br />From the aggressive rethinking of workload management, to introducing seasonal variation, to shifting your performance toward long-term quality, Slow Productivity provides a roadmap for escaping overload and arriving instead at a more timeless approach to pursuing meaningful accomplishment. The world of work is due for a new revolution. Slow productivity is exactly what we need.","num_pages":244,"authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":385941,"text_reviews_count":34848}},"average_rating":3.67,"ratings_count":24449,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/20910174-smartcuts","title":"Smartcuts: How Hackers, Innovators, and Icons Accelerate Success","title_without_series":"Smartcuts: How Hackers, Innovators, and Icons Accelerate Success","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1405868185l/20910174._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1405868185l/20910174._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":7567448,"name":"Shane Snow","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/7567448.Shane_Snow","average_rating":3.86,"ratings_count":7602,"text_reviews_count":568}},"average_rating":3.88,"ratings_count":6562,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25733966-smarter-faster-better","title":"Smarter Faster Better: The Secrets of Being Productive in Life and Business","title_without_series":"Smarter Faster Better: The Secrets of Being Productive in Life and Business","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1453057544l/25733966._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1453057544l/25733966._SX98_.jpg","description":"A new book that explores the science of productivity, and why, in todays world, managing <i>how</i> you thinkrather than <i>what</i> you thinkcan transform your life.","num_pages":"","authors":{"author":{"id":5201530,"name":"Charles Duhigg","role":"","image_url":"https://images.gr-assets.com/authors/1349273209p5/5201530.jpg","small_image_url":"https://images.gr-assets.com/authors/1349273209p2/5201530.jpg","link":"https://www.goodreads.com/author/show/5201530.Charles_Duhigg","average_rating":4.11,"ratings_count":639259,"text_reviews_count":30653}},"average_rating":3.9,"ratings_count":35925,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13525945-so-good-they-can-t-ignore-you","title":"So Good They Can't Ignore You: Why Skills Trump Passion in the Quest for Work You Love","title_without_series":"So Good They Can't Ignore You: Why Skills Trump Passion in the Quest for Work You Love","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360564614l/13525945._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360564614l/13525945._SX98_.jpg","description":"In this eye-opening account, Cal Newport debunks the long-held belief that \\"follow your passion\\" is good advice. <br /><br />Not only is the clich flawedpreexisting passions are rare and have little to do with how most people end up loving their workbut it can also be dangerous, leading to anxiety and chronic job hopping.<br /><br />After making his case against passion, Newport sets out on a quest to discover the reality of how people end up loving what they do. Spending time with organic farmers, venture capitalists, screenwriters, freelance computer programmers, and others who admitted to deriving great satisfaction from their work, Newport uncovers the strategies they used and the pitfalls they avoided in developing their compelling careers.<br /><br />Matching your job to a preexisting passion does not matter, he reveals. Passion comes after you put in the hard work to become excellent at something valuable, not before. In other words, what you do for a living is much less important than how you do it.<br /><br />With a title taken from the comedian Steve Martin, who once said his advice for aspiring entertainers was to \\"be so good they can't ignore you,\\" Cal Newport's clearly written manifesto is mandatory reading for anyone fretting about what to do with their life, or frustrated by their current job situation and eager to find a fresh new way to take control of their livelihood. He provides an evidence-based blueprint for creating work you love.<br /><br /><i>So Good They Can't Ignore You</i> will change the way we think about our careers, happiness, and the crafting of a remarkable life.","num_pages":"","authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":385941,"text_reviews_count":34848}},"average_rating":4.07,"ratings_count":50667,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/62296528-spare","title":"Spare","title_without_series":"Spare","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673458354l/62296528._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673458354l/62296528._SX98_.jpg","description":"It was one of the most searing images of the twentieth century: two young boys, two princes, walking behind their mothers coffin as the world watched in sorrowand horror. As Princess Diana was laid to rest, billions wondered what Prince William and Prince Harry must be thinking and feelingand how their lives would play out from that point on.<br /><br />For Harry, this is that story at last.<br /><br />Before losing his mother, twelve-year-old Prince Harry was known as the carefree one, the happy-go-lucky Spare to the more serious Heir. Grief changed everything. He struggled at school, struggled with anger, with lonelinessand, because he blamed the press for his mothers death, he struggled to accept life in the spotlight.<br /><br />At twenty-one, he joined the British Army. The discipline gave him structure, and two combat tours made him a hero at home. But he soon felt more lost than ever, suffering from post-traumatic stress and prone to crippling panic attacks. Above all, he couldnt find true love. <br /><br />Then he met Meghan. The world was swept away by the couples cinematic romance and rejoiced in their fairy-tale wedding. But from the beginning, Harry and Meghan were preyed upon by the press, subjected to waves of abuse, racism, and lies. Watching his wife suffer, their safety and mental health at risk, Harry saw no other way to prevent the tragedy of history repeating itself but to flee his mother country. Over the centuries, leaving the Royal Family was an act few had dared. The last to try, in fact, had been his mother. . . .<br /><br />For the first time, Prince Harry tells his own story, chronicling his journey with raw, unflinching honesty. A landmark publication, <i>Spare</i> is full of insight, revelation, self-examination, and hard-won wisdom about the eternal power of love over grief.","num_pages":410,"authors":{"author":{"id":7848512,"name":"Prince Harry","role":"","image_url":"https://images.gr-assets.com/authors/1669544936p5/7848512.jpg","small_image_url":"https://images.gr-assets.com/authors/1669544936p2/7848512.jpg","link":"https://www.goodreads.com/author/show/7848512.Prince_Harry","average_rating":3.83,"ratings_count":431857,"text_reviews_count":44713}},"average_rating":3.83,"ratings_count":431610,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/36510202-start-nl-dutch-for-beginners","title":"Start.nl Dutch for Beginners","title_without_series":"Start.nl Dutch for Beginners","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"nan","num_pages":144,"authors":{"author":{"id":19703128,"name":"Katja Verbruggen","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/19703128.Katja_Verbruggen","average_rating":3.65,"ratings_count":17,"text_reviews_count":2}},"average_rating":3.12,"ratings_count":8,"publication_day":"","publication_month":"","publication_year":2017},{"link":"https://www.goodreads.com/book/show/44573628-super-pumped","title":"Super Pumped: The Battle for Uber","title_without_series":"Super Pumped: The Battle for Uber","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1553648438l/44573628._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1553648438l/44573628._SX98_.jpg","description":"","num_pages":408,"authors":{"author":{"id":18993769,"name":"Mike Isaac","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/18993769.Mike_Isaac","average_rating":4.14,"ratings_count":14161,"text_reviews_count":1085}},"average_rating":4.14,"ratings_count":14155,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6402364-superfreakonomics","title":"SuperFreakonomics: Global Cooling, Patriotic Prostitutes And Why Suicide Bombers Should Buy Life Insurance","title_without_series":"SuperFreakonomics: Global Cooling, Patriotic Prostitutes And Why Suicide Bombers Should Buy Life Insurance","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1308117804l/6402364._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1308117804l/6402364._SX98_.jpg","description":"The New York Times best-selling Freakonomics was a worldwide sensation, selling over four million copies in thirty-five languages and changing the way we look at the world. Now, Steven D. Levitt and Stephen J. Dubner return with SuperFreakonomics, and fans and newcomers alike will find that the freakquel is even bolder, funnier, and more surprising than the first.<br /><br />Four years in the making, SuperFreakonomics asks not only the tough questions, but the unexpected ones: What's more dangerous, driving drunk or walking drunk? Why is chemotherapy prescribed so often if it's so ineffective? Can a sex change boost your salary?<br /><br />SuperFreakonomics challenges the way we think all over again, exploring the hidden side of everything with such questions as:<br /><br />How is a street prostitute like a department-store Santa?<br />Why are doctors so bad at washing their hands?<br />How much good do car seats do?<br />What's the best way to catch a terrorist?<br />Did TV cause a rise in crime?<br />What do hurricanes, heart attacks, and highway deaths have in common?<br />Are people hard-wired for altruism or selfishness?<br />Can eating kangaroo save the planet?<br />Which adds more value: a pimp or a Realtor?<br /><br />Levitt and Dubner mix smart thinking and great storytelling like no one else, whether investigating a solution to global warming or explaining why the price of oral sex has fallen so drastically. By examining how people respond to incentives, they show the world for what it really is  good, bad, ugly, and, in the final analysis, super freaky.<br /><br />Freakonomics has been imitated many times over  but only now, with SuperFreakonomics, has it met its match.","num_pages":270,"authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1107926,"text_reviews_count":30849}},"average_rating":4,"ratings_count":134510,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60631342-system-design-interview-an-insider-s-guide","title":"System Design Interview  An Insider's Guide: Volume 2","title_without_series":"System Design Interview  An Insider's Guide: Volume 2","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"System Design Interview - An Insider's Guide (Volume 2)<br /><br />This book can be seen as a sequel to the book: System Design Interview - An Insiders Guide. It covers a different set of system design interview questions and solutions. Although reading Volume 1 is helpful, it is not required. This book should be accessible to readers who have a basic understanding of distributed systems.<br /><br />This volume provides a reliable strategy and knowledge base for approaching a broad range of system design questions that you may encounter. It will help you feel confident during this important interview. This book provides a step-by-step framework for how to tackle a system design question. It also includes many real-world examples to illustrate a systematic approach, with detailed and well-explained steps you can follow.<br /><br />Whats inside?<br />- An insiders take on what interviewers really look for and why.<br />- A 4-step framework for solving any system design interview question.<br />- 13 real system design interview questions with detailed solutions.<br />- 300+ diagrams to visually explain how different systems work.<br /><br />Table of Contents<br />Chapter 1: Proximity Service<br />Chapter 2: Nearby Friends<br />Chapter 3: Google Maps<br />Chapter 4: Distributed Message Queue<br />Chapter 5: Metrics Monitoring<br />Chapter 6: Ad Click Event Aggregation<br />Chapter 7: Hotel Reservation<br />Chapter 8: Distributed Email Service<br />Chapter 9: S3-like Object Storage<br />Chapter 10: Real-time Gaming Leaderboard<br />Chapter 11: Payment System<br />Chapter 12: Digital Wallet<br />Chapter 13: Stock Exchange","num_pages":424,"authors":{"author":{"id":20411209,"name":"Alex Xu","role":"","image_url":"https://images.gr-assets.com/authors/1688294611p5/20411209.jpg","small_image_url":"https://images.gr-assets.com/authors/1688294611p2/20411209.jpg","link":"https://www.goodreads.com/author/show/20411209.Alex_Xu","average_rating":4.29,"ratings_count":4173,"text_reviews_count":388}},"average_rating":4.43,"ratings_count":640,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54109255-system-design-interview-an-insider-s-guide","title":"System Design Interview  An insider's guide","title_without_series":"System Design Interview  An insider's guide","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"The system design interview is considered to be the most complex and most difficult technical job interview by many. This book provides a step-by-step framework on how to tackle a system design question. It includes many real-world examples to illustrate the systematic approach with detailed steps that you can follow.<br /><br />Whats inside?<br />- An insiders take on what interviewers really look for and why.<br />- A 4-step framework for solving any system design interview question.<br />- 15 real system design interview questions with detailed solutions.<br />- 188 diagrams to visually explain how different systems work.<br /><br />Table Of Contents<br />Chapter 1: Scale From Zero To Millions Of Users<br />Chapter 2: Back-of-the-envelope Estimation<br />Chapter 3: A Framework For System Design Interviews<br />Chapter 4: Design A Rate Limiter<br />Chapter 5: Design Consistent Hashing<br />Chapter 6: Design A Key-value Store<br />Chapter 7: Design A Unique Id Generator In Distributed Systems<br />Chapter 8: Design A Url Shortener<br />Chapter 9: Design A Web Crawler<br />Chapter 10: Design A Notification System<br />Chapter 11: Design A News Feed System<br />Chapter 12: Design A Chat System<br />Chapter 13: Design A Search Autocomplete System<br />Chapter 14: Design Youtube<br />Chapter 15: Design Google Drive<br />Chapter 16: The Learning Continues","num_pages":324,"authors":{"author":{"id":20411209,"name":"Alex Xu","role":"","image_url":"https://images.gr-assets.com/authors/1688294611p5/20411209.jpg","small_image_url":"https://images.gr-assets.com/authors/1688294611p2/20411209.jpg","link":"https://www.goodreads.com/author/show/20411209.Alex_Xu","average_rating":4.29,"ratings_count":4173,"text_reviews_count":388}},"average_rating":4.26,"ratings_count":3363,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43848929-talking-to-strangers","title":"Talking to Strangers: What We Should Know About the People We Don't Know","title_without_series":"Talking to Strangers: What We Should Know About the People We Don't Know","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>Malcolm Gladwell, host of the podcast Revisionist History and author of the #1 New York Times bestseller <i>Outliers</i>, offers a powerful examination of our interactions with strangers -- and why they often go wrong.</b><br /><br />How did Fidel Castro fool the CIA for a generation? Why did Neville Chamberlain think he could trust Adolf Hitler? Why are campus sexual assaults on the rise? Do television sitcoms teach us something about the way we relate to each other that isn't true?<br /><br />While tackling these questions, Malcolm Gladwell was not solely writing a book for the page. He was also producing for the ear. In the audiobook version of Talking to Strangers, you'll hear the voices of people he interviewed--scientists, criminologists, military psychologists. Court transcripts are brought to life with re-enactments. You actually hear the contentious arrest of Sandra Bland by the side of the road in Texas. As Gladwell revisits the deceptions of Bernie Madoff, the trial of Amanda Knox, and the suicide of Sylvia Plath, you hear directly from many of the players in these real-life tragedies. There's even a theme song - Janelle Monae's \\"Hell You Talmbout.\\"<br /><br />Something is very wrong, Gladwell argues, with the tools and strategies we use to make sense of people we don't know. And because we don't know how to talk to strangers, we are inviting conflict and misunderstanding in ways that have a profound effect on our lives and our world.","num_pages":388,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3176601,"text_reviews_count":132017}},"average_rating":4,"ratings_count":338129,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/44428950-that-will-never-work","title":"That Will Never Work: The Birth of Netflix and the Amazing Life of an Idea","title_without_series":"That Will Never Work: The Birth of Netflix and the Amazing Life of an Idea","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1565067558l/44428950._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1565067558l/44428950._SX98_.jpg","description":"<b>In the tradition of SHOE DOG, comes the incredible story of how Netflix went from concept to company - all told by co-founder Marc Randolph</b><br />Silicon Valley lore has it that Netflix was born out of a frustration with video stores' late fees, and while that is a convenient, charming story it is far from the truth. In reality, the idea was just one of many more and far worse proposals, like personalized baseball bats and a shampoo delivery service, that Marc Randolph would pitch to his business partner, Reed Hastings, on their commute to work each morning. From this ever-shifting pool of potential ventures the pair, with Hastings as the primary investor and Randolph as the CEO, took a risk and founded Netflix. Not until years later, when a billion dollar company emerged out of a business model that - after countless disasters and flirtations with bankruptcy - seemed destined for failure would the risk pay off and become one of the mostly incredible and unlikely success stories of our time.Now with over 125 million subscribers the triumph of Netflix feels inevitable, but at a time when brick and mortar video rental stores were king and DVD technology had yet to take off, its success was far from guaranteed. From having to pitch his own mother on being an early investor, to a motel business conference room that served as a first office, to helping develop Netflix's now-famous company culture, Marc Randolph's improbable journey exemplifies how anyone with grit, gut instincts and determination can transform the world we live in. Telling his story in energetic, compelling prose, Marc chronicles the personal and professional labors that went into the creation of the unicorn company that has disrupted the very foundations of the entertainment industry.<br /><br />From having to pitch his own mother on being an early investor, to a motel business conference room that he decided would be their first office, to helping develop Netflix's now-famous company culture, Marc Randolph's improbable journey exemplifies how anyone with grit, gut instincts and determination can transform the world we live in.","num_pages":336,"authors":{"author":{"id":18965880,"name":"Marc Randolph","role":"","image_url":"https://images.gr-assets.com/authors/1557353143p5/18965880.jpg","small_image_url":"https://images.gr-assets.com/authors/1557353143p2/18965880.jpg","link":"https://www.goodreads.com/author/show/18965880.Marc_Randolph","average_rating":4.22,"ratings_count":17215,"text_reviews_count":1367}},"average_rating":4.22,"ratings_count":17192,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/984017.The_48_Laws_of_Power","title":"The 48 Laws of Power","title_without_series":"The 48 Laws of Power","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1529072201l/984017._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1529072201l/984017._SX98_.jpg","description":"Amoral, cunning, ruthless, and instructive, this piercing work distills three thousand years of the history of power in to forty-eight well explicated laws. As attention-grabbing in its design as it is in its content, this bold volume outlines the laws of power in their unvarnished essence, synthesizing the philosophies of Machiavelli, Sun-tzu, Carl von Clausewitz, and other great thinkers. <br /><br />Some laws teach the need for prudence (\\"Law 1: Never Outshine the Master\\"), the virtue of stealth (\\"Law 3: Conceal Your Intentions\\"), and many demand the total absence of mercy (\\"Law 15: Crush Your Enemy Totally\\"), but like it or not, all have applications in real life. <br /><br />Illustrated through the tactics of Queen Elizabeth I, Henry Kissinger, P. T. Barnum, and other famous figures who have wielded--or been victimized by--power, these laws will fascinate any reader interested in gaining, observing, or defending against ultimate control.","num_pages":452,"authors":{"author":{"id":865,"name":"Robert Greene","role":"","image_url":"https://images.gr-assets.com/authors/1298212921p5/865.jpg","small_image_url":"https://images.gr-assets.com/authors/1298212921p2/865.jpg","link":"https://www.goodreads.com/author/show/865.Robert_Greene","average_rating":4.12,"ratings_count":401988,"text_reviews_count":23975}},"average_rating":4.08,"ratings_count":228432,"publication_day":"","publication_month":"","publication_year":2000},{"link":"https://www.goodreads.com/book/show/36072.The_7_Habits_of_Highly_Effective_People","title":"The 7 Habits of Highly Effective People: Powerful Lessons in Personal Change","title_without_series":"The 7 Habits of Highly Effective People: Powerful Lessons in Personal Change","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1421842784l/36072._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1421842784l/36072._SX98_.jpg","description":"Uno de los libros ms inspiradores e impactantes que se haya escrito jams, Los 7 hbitos de la gente altamente efectiva ha cautivado a lectores durante veinticinco aos. Esta obra ha transformado la vida de presidentes y CEOs, educadores y padres- en definitiva, de millones de personas de todas las edades y ocupaciones.<br />La obra maestra de Covey, si no ha cambiado el mundo, al menos ha influido en millones de lectores que pueden hacer y harn de nuestro planeta un lugar ms pacfico y prspero, ms preparado y dotado de mayor sentido.Warren Bennis, autor de Lderes, profesor emrito de Negocios, Universidad de Southern California<br />Afortunadamente, este libro ha sido nuestro consejero y estmulo durante veinticinco aos. Yo incito con ocasin de este aniversario a que seamos leales y sigamos apoyndolo otros veinticinco aos.Maya Angelou<br />Los 7 hbitos de la gente altamente efectiva rene principios intemporales que contribuyen a que cualquier empresa se oriente hacia el xito.<br />Tony Hsieh, del New York Times, autor del superventas Entregando felicidad y consejero delegado de Zappos.com, Inc.<br />Los 7 hbitos nos han guiado a muchos en nuestro camino por el mundo de los negocios. Sencillo pero increblemente efectivo. Una gua extraordinaria para cualquier aspirante a lder!Meg Whitman, consejero delegado de HP<br />Nadie vive eternamente, pero los libros y las ideas perviven. La vida de Stephen R. Covey lleg a su fin, pero su obra no. Contina presente en este libro y tan viva como cuando se escribi.Jim Collins<br />Veinticinco aos despus de su publicacin, la sabidura de Los 7 hbitos de la gente altamente efectiva resulta ms relevante que nunca. A nivel individual, la gente se quema, y a nivel colectivo estamos quemando el planeta. De ah, el nfasis del doctor Covey en la necesidad de que las personas nos renovemos, y su convencimiento de que el liderazgo y la creatividad nos obligan a hacer uso de nuestro potencial fsico, mental y espiritual; es exactamente lo que necesitamos en este momento.<br />Arianna Huffington, miembro del Consejo, presidente y editora jefe de The Huffington Post Media Group","num_pages":372,"authors":{"author":{"id":1538,"name":"Stephen R. Covey","role":"","image_url":"https://images.gr-assets.com/authors/1321654785p5/1538.jpg","small_image_url":"https://images.gr-assets.com/authors/1321654785p2/1538.jpg","link":"https://www.goodreads.com/author/show/1538.Stephen_R_Covey","average_rating":4.14,"ratings_count":1026295,"text_reviews_count":25618}},"average_rating":4.16,"ratings_count":825164,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/57007683-the-apollo-murders","title":"The Apollo Murders (Apollo Murders, #1)","title_without_series":"The Apollo Murders","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629112133l/57007683._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629112133l/57007683._SX98_.jpg","description":"<b>An exceptional debut thriller and exciting journey into the dark heart of the Cold War and the space race from<i>New York Times</i></b><b>bestselling author and astronaut Chris Hadfield (Andy Weir, author of <i>The Martian </i>and <i>Project Hail Mary</i>).<br /></b><br /><i>1973: a final, top-secret mission to the Moon. Three astronauts in a tiny spaceship, a quarter million miles from home. A quarter million miles from help.</i><br /><br />NASA is about to launch Apollo 18. While the mission has been billed as a scientific one, flight controller Kazimieras \\"Kaz\\" Zemeckis knows there is a darker objective. Intelligence has discovered a secret Soviet space station spying on America, and Apollo 18 may be the only chance to stop it.<br /><br />But even as Kaz races to keep the NASA crew one step ahead of their Russian rivals, a deadly accident reveals that not everyone involved is quite who they were thought to be. With political stakes stretched to the breaking point, the White House and the Kremlin can only watch as their astronauts collide on the lunar surface, far beyond the reach of law or rescue.<br /><br />Full of the fascinating technical detail that fans of<i>The Martian</i>loved, and reminiscent of the thrilling claustrophobia, twists, and tension of<i>The Hunt for Red October</i>,<i>The Apollo Murders</i>is a high-stakes thriller unlike any other. Chris Hadfield captures the fierce G-forces of launch, the frozen loneliness of space, and the fear of holding on to the outside of a spacecraft orbiting the Earth at 17,000 miles per hour as only someone who has experienced all of these things in real life can.<br /><br />Strap in and count down for the ride of a lifetime.","num_pages":"","authors":{"author":{"id":1136925,"name":"Chris Hadfield","role":"","image_url":"https://images.gr-assets.com/authors/1372880368p5/1136925.jpg","small_image_url":"https://images.gr-assets.com/authors/1372880368p2/1136925.jpg","link":"https://www.goodreads.com/author/show/1136925.Chris_Hadfield","average_rating":4.12,"ratings_count":94931,"text_reviews_count":9217}},"average_rating":3.92,"ratings_count":19510,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/231148075-the-art-of-spending-money","title":"The Art of Spending Money: Simple Choices for a Richer Life","title_without_series":"The Art of Spending Money: Simple Choices for a Richer Life","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"","num_pages":"","authors":{"author":{"id":7499284,"name":"Morgan Housel","role":"","image_url":"https://images.gr-assets.com/authors/1669719604p5/7499284.jpg","small_image_url":"https://images.gr-assets.com/authors/1669719604p2/7499284.jpg","link":"https://www.goodreads.com/author/show/7499284.Morgan_Housel","average_rating":4.27,"ratings_count":367392,"text_reviews_count":24613}},"average_rating":4.15,"ratings_count":12253,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/9402297-the-bed-of-procrustes","title":"The Bed of Procrustes: Philosophical and Practical Aphorisms","title_without_series":"The Bed of Procrustes: Philosophical and Practical Aphorisms","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1665067245l/9402297._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1665067245l/9402297._SX98_.jpg","description":"The Bed of Procrustes takes its title from Greek mythology: the story of a man who made his visitors fit his bed to perfection by either stretching them or cutting their limbs. It represents Nassim Nicholas Taleb's view of modern civilization's hubristic side effects-modifying humans to satisfy technology, blaming reality for not fitting economic models, inventing diseases to sell drugs, defining intelligence as what can be tested in a classroom, and convincing people that employment is not slavery.<br /><br />Playful and irreverent, these aphorisms will surprise you by exposing self-delusions you have been living with but never recognized.<br /><br />With a rare combination of pointed wit and potent wisdom, Taleb plows through human illusions, contrasting the classical values of courage, elegance, and erudition against the modern diseases of nerdiness, philistinism, and phoniness.<br /><br /><br /> \\"The most prophetic voice of all.\\" -GQ<br /><br />\\"The hottest thinker in the world.\\" -Bryan Appleyard, The Sunday Times (London)<br /><br />\\"Idiosyncratically brilliant.\\" -Niall Ferguson, Los Angeles Times","num_pages":"","authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":309970,"text_reviews_count":21319}},"average_rating":3.78,"ratings_count":10967,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/2962025-the-black-swan","title":"The Black Swan: The Impact of the Highly Improbable","title_without_series":"The Black Swan: The Impact of the Highly Improbable","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1659249464l/2962025._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1659249464l/2962025._SX98_.jpg","description":"<p><i>In Black Swan: The Impact of The Highly Improbable</i>, the author projects randomness and uncertainty as a single idea. He puts forth a theory that promotes the idea and value of a society that stands robust in the face of negative events, and manipulates the positive ones to its advantage.According to Taleb, a Black Swan event is a rare event that has large magnitude and powerful consequences owing to its unpredictability. Such an event is initially a surprise to its observer, but is rationalized by him/her in retrospect. World War I, the rise of the Internet, and the 9/11 attacks on the World Trade Center are cited as examples of Black Swan events. Taleb introduces a fictional character called Yevgenia Nikolayevna Krasnova to elucidate his theory. Krasnova is a neuroscientist, who is interested in philosophy. She writes a book called A Story Of Recursion. A small publishing firm picks up the book and publishes it in its unedited form. In an unexpected turn of events, the book goes on to become an international bestseller, catapulting the author and the publishing firm to fame. This event is described as a Black Swan Event.The book is divided into four parts. Part 1 and the first section of Part 2 deal with psychology. The author then moves on to the subjects of science and business in the later part of Part 2 and the whole of Part 3. Part 4 provides strategies to enjoy life amidst all the uncertainties in the world. The book was first released in 2007 and went on to become extremely successful. It was listed by The Sunday Times as one of the 12 most influential books post World War II. It stayed on The New York Times bestseller list for 36 weeks. It was published in 32 languages, and sold almost 3 million copies as of February 2011.</p>","num_pages":480,"authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":309970,"text_reviews_count":21319}},"average_rating":3.96,"ratings_count":122278,"publication_day":"","publication_month":"","publication_year":2010},{"link":"https://www.goodreads.com/book/show/18693771-the-body-keeps-the-score","title":"The Body Keeps the Score: Brain, Mind, and Body in the Healing of Trauma","title_without_series":"The Body Keeps the Score: Brain, Mind, and Body in the Healing of Trauma","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594559067l/18693771._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594559067l/18693771._SX98_.jpg","description":"<b>A pioneering researcher transforms our understanding of trauma and offers a bold new paradigm for healing.</b> <br /><br />Trauma is a fact of life. Veterans and their families deal with the painful aftermath of combat; one in five Americans has been molested; one in four grew up with alcoholics; one in three couples have engaged in physical violence. Dr. Bessel van der Kolk, one of the world's foremost experts on trauma, has spent over three decades working with survivors. In <i>The Body Keeps the Score</i>, he uses recent scientific advances to show how trauma literally reshapes both body and brain, compromising sufferers' capacities for pleasure, engagement, self-control, and trust. He explores innovative treatmentsfrom neurofeedback and meditation to sports, drama, and yogathat offer new paths to recovery by activating the brain's natural neuroplasticity. Based on Dr. van der Kolk's own research and that of other leading specialists, <i>The Body Keeps the Score</i> exposes the tremendous power of our relationships both to hurt and to healand offers new hope for reclaiming lives.","num_pages":464,"authors":{"author":{"id":21280926,"name":"Bessel van der Kolk","role":"","image_url":"https://images.gr-assets.com/authors/1617660077p5/21280926.jpg","small_image_url":"https://images.gr-assets.com/authors/1617660077p2/21280926.jpg","link":"https://www.goodreads.com/author/show/21280926.Bessel_van_der_Kolk","average_rating":4.35,"ratings_count":288557,"text_reviews_count":22632}},"average_rating":4.35,"ratings_count":284713,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/56668328-the-bomber-mafia","title":"The Bomber Mafia: A Dream, a Temptation, and the Longest Night of the Second World War","title_without_series":"The Bomber Mafia: A Dream, a Temptation, and the Longest Night of the Second World War","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1616422126l/56668328._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1616422126l/56668328._SX98_.jpg","description":"<b>An exploration of how technology and best intentions collide in the heat of war<br /><br />A<i>New York Times Book Review </i>Editors Choice</b><br /><br />In <i>The Bomber Mafia</i><i>,</i> Malcolm Gladwell weaves together the stories of a Dutch genius and his homemade computer, a band of brothers in central Alabama, a British psychopath, and pyromaniacal chemists at Harvard to examine one of the greatest moral challenges in modern American history.<br /><br />Most military thinkers in the years leading up to World War II saw the airplane as an afterthought. But a small band of idealistic strategists, the Bomber Mafia, asked: What if precision bombing could cripple the enemy <i>and</i> make war far less lethal? <br /><br />In contrast, the bombing of Tokyo on the deadliest night of the war was the brainchild of General Curtis LeMay, whose brutal pragmatism and scorched-earth tactics in Japan cost thousands of civilian lives, but may have spared even more by averting a planned US invasion. In <i>The Bomber Mafia, </i>Gladwell asks, Was it worth it?<br /><br />Things might have gone differently had LeMays predecessor, General Haywood Hansell, remained in charge. Hansell believed in precision bombing, but when he and Curtis LeMay squared off for a leadership handover in the jungles of Guam, LeMay emerged victorious, leading to the darkest night of World War II. <i>The Bomber Mafia </i>is a riveting tale of persistence, innovation, and the incalculable wages of war.","num_pages":"","authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3176601,"text_reviews_count":132017}},"average_rating":4.02,"ratings_count":64648,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/19063.The_Book_Thief","title":"The Book Thief","title_without_series":"The Book Thief","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1522157426l/19063._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1522157426l/19063._SX98_.jpg","description":"<i>Librarian's note: An alternate cover edition can be found <a href=\\"https://www.goodreads.com/book/show/41048862.here\\" title=\\"here\\" rel=\\"nofollow noopener\\">here</a></i><br /><br />It is 1939. Nazi Germany. The country is holding its breath. Death has never been busier, and will be busier still.<br /><br />By her brother's graveside, Liesel's life is changed when she picks up a single object, partially hidden in the snow. It is The Gravedigger's Handbook, left behind there by accident, and it is her first act of book thievery. So begins a love affair with books and words, as Liesel, with the help of her accordian-playing foster father, learns to read. Soon she is stealing books from Nazi book-burnings, the mayor's wife's library, wherever there are books to be found.<br /><br />But these are dangerous times. When Liesel's foster family hides a Jew in their basement, Liesel's world is both opened up, and closed down.<br /><br />In superbly crafted writing that burns with intensity, award-winning author Markus Zusak has given us one of the most enduring stories of our time.<br /><br />(Note: this title was not published as YA fiction)","num_pages":592,"authors":{"author":{"id":11466,"name":"Markus Zusak","role":"","image_url":"https://images.gr-assets.com/authors/1537240528p5/11466.jpg","small_image_url":"https://images.gr-assets.com/authors/1537240528p2/11466.jpg","link":"https://www.goodreads.com/author/show/11466.Markus_Zusak","average_rating":4.36,"ratings_count":3135635,"text_reviews_count":188273}},"average_rating":4.39,"ratings_count":2893753,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6667514-the-checklist-manifesto","title":"The Checklist Manifesto: How to Get Things Right","title_without_series":"The Checklist Manifesto: How to Get Things Right","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1647403235l/6667514._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1647403235l/6667514._SX98_.jpg","description":"<b>The <em>New York Times</em> bestselling author of <em>Better</em> and <em>Complications</em> reveals the surprising power of the ordinary checklist</b><br /><br />We live in a world of great and increasing complexity, where even the most expert professionals struggle to master the tasks they face. Longer training, ever more advanced technologiesneither seems to prevent grievous errors. But in a hopeful turn, acclaimed surgeon and writer Atul Gawande finds a remedy in the humblest and simplest of techniques: the checklist. First introduced decades ago by the U.S. Air Force, checklists have enabled pilots to fly aircraft of mind-boggling sophistication. Now innovative checklists are being adopted in hospitals around the world, helping doctors and nurses respond to everything from flu epidemics to avalanches. Even in the immensely complex world of surgery, a simple ninety-second variant has cut the rate of fatalities by more than a third.<br /><br />In riveting stories, Gawande takes us from Austria, where an emergency checklist saved a drowning victim who had spent half an hour underwater, to Michigan, where a cleanliness checklist in intensive care units virtually eliminated a type of deadly hospital infection. He explains how checklists actually work to prompt striking and immediate improvements. And he follows the checklist revolution into fields well beyond medicine, from disaster response to investment banking, skyscraper construction, and businesses of all kinds.<br /><br />An intellectual adventure in which lives are lost and saved and one simple idea makes a tremendous difference, <em>The Checklist Manifesto</em> is essential reading for anyone working to get things right.","num_pages":208,"authors":{"author":{"id":3078,"name":"Atul Gawande","role":"","image_url":"https://images.gr-assets.com/authors/1560377007p5/3078.jpg","small_image_url":"https://images.gr-assets.com/authors/1560377007p2/3078.jpg","link":"https://www.goodreads.com/author/show/3078.Atul_Gawande","average_rating":4.35,"ratings_count":386673,"text_reviews_count":37045}},"average_rating":4.04,"ratings_count":75804,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54968118-the-code-breaker","title":"The Code Breaker: Jennifer Doudna, Gene Editing, and the Future of the Human Race","title_without_series":"The Code Breaker: Jennifer Doudna, Gene Editing, and the Future of the Human Race","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610894755l/54968118._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610894755l/54968118._SX98_.jpg","description":"When Jennifer Doudna was in sixth grade, she came home one day to find that her dad had left a paperback titled <i>The Double Helix</i> on her bed. As she sped through the pages, she became enthralled by the intense drama behind the competition to discover the code of life. Even though her high school counselor told her girls didnt become scientists, she decided she would.<br /><br />Driven by a passion to understand how nature works and to turn discoveries into inventions, she would help to make what the books author, James Watson, told her was the most important biological advance since his co-discovery of the structure of DNA. She and her collaborators turned <b></b>a curiosity of nature into an invention that will transform the human race: an easy-to-use tool that can edit DNA. Known as CRISPR, it opened a brave new world of medical miracles and moral questions.<br /> <br />The development of CRISPR and the race to create vaccines for coronavirus will hasten our transition to the next great innovation revolution. The past half-century has been a digital age, based on the microchip, computer, and internet. Now we are entering a life-science revolution. Children who study digital coding will be joined by those who study genetic code.<br /> <br />Should we use our new evolution-hacking powers to make us less susceptible to viruses? What a wonderful boon that would be! And what about preventing depression? HmmmShould we allow parents, if they can afford it, to enhance the height or muscles or IQ of their kids?<br /> <br />After helping to discover CRISPR, Doudna became a leader in wrestling with these moral issues and, with her collaborator Emmanuelle Charpentier, won the Nobel Prize in 2020.","num_pages":536,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2035307,"text_reviews_count":55219}},"average_rating":4.28,"ratings_count":41418,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55825273-the-comfort-book","title":"The Comfort Book","title_without_series":"The Comfort Book","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641142132l/55825273._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641142132l/55825273._SX98_.jpg","description":"<b>The new uplifting book from Matt Haig, the <i>New York Times</i> bestselling author of <i>The Midnight Library</i>, for anyone in search of hope, looking for a path to a more meaningful life, or in need of a little encouragement.</b><br /><br /><i>It is a strange paradox, that many of the clearest, most comforting life lessons are learnt while we are at our lowest. But then we never think about food more than when we are hungry and we never think about life rafts more than when we are thrown overboard.</i><br /><br /><i>The Comfort Book</i> is Haigs life raft: its a collection of notes, lists, and stories written over a span of several years that originally served as gentle reminders to Haigs future self that things are not always as dark as they may seem. Incorporating a diverse array of sources from across the world, history, science, and his own experiences, Haig offers warmth and reassurance, reminding us to slow down and appreciate the beauty and unpredictability of existence.","num_pages":"","authors":{"author":{"id":76360,"name":"Matt Haig","role":"","image_url":"https://images.gr-assets.com/authors/1770056342p5/76360.jpg","small_image_url":"https://images.gr-assets.com/authors/1770056342p2/76360.jpg","link":"https://www.goodreads.com/author/show/76360.Matt_Haig","average_rating":3.95,"ratings_count":3387513,"text_reviews_count":349598}},"average_rating":4.05,"ratings_count":74238,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43306206-the-courage-to-be-disliked","title":"The Courage to Be Disliked: How to Free Yourself, Change Your Life and Achieve Real Happiness","title_without_series":"The Courage to Be Disliked: How to Free Yourself, Change Your Life and Achieve Real Happiness","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"The Japanese phenomenon that teaches us the simple yet profound lessons required to liberate our real selves and find lasting happiness.<br /><br /><i>The Courage to Be Disliked</i> shows you how to unlock the power within yourself to become your best and truest self, change your future and find lasting happiness. Using the theories of Alfred Adler, one of the three giants of 19th-century psychology alongside Freud and Jung, the authors explain how we are all free to determine our own future free of the shackles of past experiences, doubts and the expectations of others. Its a philosophy thats profoundly liberating, allowing us to develop the courage to change, and to ignore the limitations that we and those around us can place on ourselves.<br /><br />The result is a book that is both highly accessible and profound in its importance. Millions have already read and benefited from its wisdom. Now that The Courage to Be Disliked has been published for the first time in English, so can you.","num_pages":"","authors":{"author":{"id":14541046,"name":"Ichiro Kishimi","role":"","image_url":"https://images.gr-assets.com/authors/1745447796p5/14541046.jpg","small_image_url":"https://images.gr-assets.com/authors/1745447796p2/14541046.jpg","link":"https://www.goodreads.com/author/show/14541046.Ichiro_Kishimi","average_rating":3.92,"ratings_count":154168,"text_reviews_count":16768}},"average_rating":3.91,"ratings_count":142464,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/22085568-the-culture-map","title":"The Culture Map: Breaking Through the Invisible Boundaries of Global Business","title_without_series":"The Culture Map: Breaking Through the Invisible Boundaries of Global Business","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1488319495l/22085568._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1488319495l/22085568._SX98_.jpg","description":"Cuando te das cuenta de que, antes de hacer una crtica, los estadounidenses se hartan a halagos mientras que los alemanes no se andan con rodeos; o que los asiticos muestran reverencia por la jerarqua, mientras que para los suecos cualquiera puede ser jefe, caes en que nos regimos por un contexto cultural que es imprescindible entender antes de pensar en relacionarse con alguien de otro pas.<br /><br />La comunicacin entre culturas es el gran reto de la economa global, y disponer de las claves necesarias para facilitar la comprensin puede ser la diferencia entre el xito y el fracaso.<br /><br />La experta reconocida Erin Meyer desgrana los 8 puntos diferenciales de nuestros rasgos culturales y nos facilita las herramientas para afrontar de manera eficaz los retos comunicativos ms comunes en el mundo de las relaciones internacionales. El mapa cultural se ha convertido en la obra de referencia para cualquier lector que quiera desenvolverse de la forma ms consciente y cmoda en este terreno sutil, y a veces traicionero, en el que se espera que personas de orgenes distintos trabajen juntas en armona.","num_pages":"","authors":{"author":{"id":7178109,"name":"Erin Meyer","role":"","image_url":"https://images.gr-assets.com/authors/1463868125p5/7178109.jpg","small_image_url":"https://images.gr-assets.com/authors/1463868125p2/7178109.jpg","link":"https://www.goodreads.com/author/show/7178109.Erin_Meyer","average_rating":4.29,"ratings_count":63444,"text_reviews_count":5682}},"average_rating":4.33,"ratings_count":30386,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23168817-the-dark-forest","title":"The Dark Forest (Remembrance of Earths Past, #2)","title_without_series":"The Dark Forest","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1412064931l/23168817._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1412064931l/23168817._SX98_.jpg","description":"Imagine the universe as a forest, patrolled by numberless and nameless predators. In this forest, stealth is survival  any civilisation that reveals its location is prey.<br /><br />Earth has. Now the predators are coming.<br /><br />Crossing light-years, the Trisolarians will reach Earth in four centuries' time. But the sophons, their extra-dimensional agents and saboteurs, are already here. Only the individual human mind remains immune to their influence.<br /><br />This is the motivation for the Wallfacer Project, a last-ditch defence that grants four individuals almost absolute power to design secret strategies, hidden through deceit and misdirection from human and alien alike. Three of the Wallfacers are influential statesmen and scientists, but the fourth is a total unknown.","num_pages":"","authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":960805,"text_reviews_count":90486}},"average_rating":4.4,"ratings_count":222298,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/45731395-the-deficit-myth","title":"The Deficit Myth: Modern Monetary Theory and the Birth of the People's Economy","title_without_series":"The Deficit Myth: Modern Monetary Theory and the Birth of the People's Economy","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1571698158l/45731395._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1571698158l/45731395._SX98_.jpg","description":"<b>A <i>New York Times</i> Bestseller</b> <b><b><br /></b>The leading thinker and most visible public advocate of modern monetary theory -- the freshest and most important idea about economics in decades -- delivers a radically different, bold, new understanding for how to build a just and prosperous society.</b><br /><br />Stephanie Kelton's brilliant exploration of modern monetary theory (MMT) dramatically changes our understanding of how we can best deal with crucial issues ranging from poverty and inequality to creating jobs, expanding health care coverage, climate change, and building resilient infrastructure. Any ambitious proposal, however, inevitably runs into the buzz saw of how to find the money to pay for it, rooted in myths about deficits that are hobbling us as a country.<br /><br /><br />Kelton busts through the myths that prevent us from taking action: that the federal government should budget like a household, that deficits will harm the next generation, crowd out private investment, and undermine long-term growth, and that entitlements are propelling us toward a grave fiscal crisis.<br /><br /><br />MMT, as Kelton shows, shifts the terrain from narrow budgetary questions to one of broader economic and social benefits. With its important new ways of understanding money, taxes, and the critical role of deficit spending, MMT redefines how to responsibly use our resources so that we can maximize our potential as a society. MMT gives us the power to imagine a new politics and a new economy and move from a narrative of scarcity to one of opportunity.","num_pages":327,"authors":{"author":{"id":18314573,"name":"Stephanie Kelton","role":"","image_url":"https://images.gr-assets.com/authors/1589912118p5/18314573.jpg","small_image_url":"https://images.gr-assets.com/authors/1589912118p2/18314573.jpg","link":"https://www.goodreads.com/author/show/18314573.Stephanie_Kelton","average_rating":4.02,"ratings_count":10066,"text_reviews_count":1538}},"average_rating":4.02,"ratings_count":9925,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26083308-the-devops-handbook","title":"The DevOps Handbook: How to Create World-Class Agility, Reliability, and Security in Technology Organizations","title_without_series":"The DevOps Handbook: How to Create World-Class Agility, Reliability, and Security in Technology Organizations","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473461230l/26083308._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473461230l/26083308._SX98_.jpg","description":"Increase profitability, elevate work culture, and exceed productivity goals through DevOps practices.<br /><br />More than ever, the effective management of technology is critical for business competitiveness. For decades, technology leaders have struggled to balance agility, reliability, and security. The consequences of failure have never been greater whether it's the healthcare.gov debacle, cardholder data breaches, or missing the boat with Big Data in the cloud.<br /><br />And yet, high performers using DevOps principles, such as Google, Amazon, Facebook, Etsy, and Netflix, are routinely and reliably deploying code into production hundreds, or even thousands, of times per day.<br /><br />Following in the footsteps of The Phoenix Project, The DevOps Handbook shows leaders how to replicate these incredible outcomes, by showing how to integrate Product Management, Development, QA, IT Operations, and Information Security to elevate your company and win in the marketplace.\\"<br /><br /><i>Table of contents</i><br /><br />Preface<br />Spreading the Aha! Moment<br />Introduction<br /><br />PART I: THE THREE WAYS<br />1. Agile, continuous delivery and the three ways<br />2. The First Way: The Principles of Flow<br />3. The Second Way: The Principle of Feedback<br />4. The Third Way: The Principles of Continual Learning<br /><br />PART II: WHERE TO START<br />5. Selecting which value stream to start with<br />6. Understanding the work in our value stream<br />7. How to design our organization and architecture<br />8. How to get great outcomes by integrating operations into the daily work for development<br /><br />PART III: THE FIRST WAY: THE TECHNICAL PRACTICES OF FLOW<br />9. Create the foundations of our deployment pipeline<br />10. Enable fast and reliable automated testing<br />11. Enable and practice continuous integration<br />12. Automate and enable low-risk releases<br />13. Architect for low-risk releases<br /><br />PART IV: THE SECOND WAY: THE TECHNICAL PRACTICES OF FEEDBACK<br />14*. Create telemetry to enable seeing abd solving problems<br />15. Analyze telemetry to better anticipate problems<br />16. Enable feedbackso development and operation can safely deploy code<br />17. Integrate hypothesis-driven development and A/B testing into our daily work<br />18. Create review and coordination processes to increase quality of our current work<br /><br />PART V: THE THRID WAY: THE TECHNICAL PRACTICES OF CONTINUAL LEARNING<br />19. Enable and inject learning into daily work<br />20. Convert local discoveries into global improvements<br />21. Reserve time to create organizational learning<br />22. Information security as everyones job, every day<br />23. Protecting the deployment pipeline<br /><br />PART VI: CONCLUSION<br />A call to action<br />Conclusion to the DevOps Handbook<br /><br />APPENDICES<br />1. The convergence of Devops<br />2. The theory of constraints and core chronic conflicts<br />3. Tabular form of downward spiral<br />4. The dangers of handoffs and queues<br />5. Myths of industrial safety<br />6. The Toyota Andon Cord<br />7. COTS Software<br />8. Post-mortem meetings<br />9. The Simian Army<br />10. Transparent uptime<br /><br />Additional Resources<br />Endnotes","num_pages":442,"authors":{"author":{"id":328437,"name":"Gene Kim","role":"","image_url":"https://images.gr-assets.com/authors/1361113444p5/328437.jpg","small_image_url":"https://images.gr-assets.com/authors/1361113444p2/328437.jpg","link":"https://www.goodreads.com/author/show/328437.Gene_Kim","average_rating":4.2,"ratings_count":76844,"text_reviews_count":6206}},"average_rating":4.29,"ratings_count":5895,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17563539-the-egg","title":"The Egg","title_without_series":"The Egg","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431492647l/17563539._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431492647l/17563539._SX98_.jpg","description":"<b>A short story about the universe and your place in it.</b><br /><br /><i>\\"You were on your way home when you died. It was a car accident. Nothing particularly remarkable, but fatal nonetheless. You left behind a wife and two children. It was a painless death. ... And thats when you met me.\\"</i><br /><br /><i>The Egg</i> is a short story written by Andy Weir, his most popular, and follows a nameless 48-year-old man who discovers the \\"meaning of life\\" after he dies. The story is about<i> \\"you\\"</i> (in the second person), and God, who is <i>\\"me\\"</i> (in the first person). God says that you have been reincarnated many times before, and that you are soon to be reincarnated once more, leading to quite a few existential questions.<br /><br /><b>\\n  <a href=\\"https://www.goodreads.com/author/show/6540057.Andy_Weir\\" title=\\"Andy Weir\\" rel=\\"nofollow noopener\\">Andy Weir</a>\\n</b> (1972-) built a career as a software engineer until the success of his first published novel, <i><a href=\\"https://www.goodreads.com/book/show/18007564.The_Martian__2011_\\" title=\\"The Martian (2011)\\" rel=\\"nofollow noopener\\">The Martian (2011)</a>,</i> allowed him to live out his dream of writing fulltime. He is a lifelong space nerd and a devoted hobbyist of subjects such as relativistic physics, orbital mechanics, and the history of manned spaceflight. He also mixes a mean cocktail.","num_pages":3,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.35,"ratings_count":2919335,"text_reviews_count":301814}},"average_rating":4.21,"ratings_count":38510,"publication_day":15,"publication_month":8,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/28820444-the-elephant-in-the-brain","title":"The Elephant in the Brain: Hidden Motives in Everyday Life","title_without_series":"The Elephant in the Brain: Hidden Motives in Everyday Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513355864l/28820444._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513355864l/28820444._SX98_.jpg","description":"Human beings are primates, and primates are political animals. Our brains, therefore, are designed not just to hunt and gather, but also to help us get ahead socially, often via deception and self-deception. But while we may be self-interested schemers, we benefit by pretending otherwise. The less we know about our own ugly motives, the better - and thus we don't like to talk or even think about the extent of our selfishness. This is \\"the elephant in the brain.\\" Such an introspective taboo makes it hard for us to think clearly about our nature and the explanations for our behavior. The aim of this book, then, is to confront our hidden motives directly - to track down the darker, unexamined corners of our psyches and blast them with floodlights. Then, once everything is clearly visible, we can work to better understand ourselves: Why do we laugh? Why are artists sexy? Why do we brag about travel? Why do we prefer to speak rather than listen?<br /><br />Our unconscious motives drive more than just our private behavior; they also infect our venerated social institutions such as Art, School, Charity, Medicine, Politics, and Religion. In fact, these institutions are in many ways designed to accommodate our hidden motives, to serve covert agendas alongside their \\"official\\" ones. The existence of big hidden motives can upend the usual political debates, leading one to question the legitimacy of these social institutions, and of standard policies designed to favor or discourage them. You won't see yourself - or the world - the same after confronting the elephant in the brain.","num_pages":408,"authors":{"author":{"id":14932232,"name":"Kevin Simler","role":"","image_url":"https://images.gr-assets.com/authors/1631175835p5/14932232.jpg","small_image_url":"https://images.gr-assets.com/authors/1631175835p2/14932232.jpg","link":"https://www.goodreads.com/author/show/14932232.Kevin_Simler","average_rating":3.96,"ratings_count":8489,"text_reviews_count":824}},"average_rating":3.96,"ratings_count":8481,"publication_day":"","publication_month":12,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/17660462-the-everything-store","title":"The Everything Store: Jeff Bezos and the Age of Amazon","title_without_series":"The Everything Store: Jeff Bezos and the Age of Amazon","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631792766l/17660462._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631792766l/17660462._SX98_.jpg","description":"<b>The definitive story of Amazon.com, one of the most successful companies in the world, and of its driven, brilliant founder, Jeff Bezos.</b><br /><br />Amazon.com started off delivering books through the mail. But its visionary founder, Jeff Bezos, wasn't content with being a bookseller. He wanted Amazon to become the everything store, offering limitless selection and seductive convenience at disruptively low prices. To do so, he developed a corporate culture of relentless ambition and secrecy that's never been cracked. Until now. Brad Stone enjoyed unprecedented access to current and former Amazon employees and Bezos family members, giving readers the first in-depth, fly-on-the-wall account of life at Amazon. Compared to tech's other elite innovators--Jobs, Gates, Zuckerberg--Bezos is a private man. But he stands out for his restless pursuit of new markets, leading Amazon into risky new ventures like the Kindle and cloud computing, and transforming retail in the same way Henry Ford revolutionized manufacturing.<br /><br /><i>The Everything Store</i> will be the revealing, definitive biography of the company that placed one of the first and largest bets on the Internet and forever changed the way we shop and read.","num_pages":384,"authors":{"author":{"id":219908,"name":"Brad Stone","role":"","image_url":"https://images.gr-assets.com/authors/1483551689p5/219908.jpg","small_image_url":"https://images.gr-assets.com/authors/1483551689p2/219908.jpg","link":"https://www.goodreads.com/author/show/219908.Brad_Stone","average_rating":4.12,"ratings_count":91661,"text_reviews_count":4633}},"average_rating":4.14,"ratings_count":77663,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/46266188-the-fifth-risk","title":"The Fifth Risk: Undoing Democracy","title_without_series":"The Fifth Risk: Undoing Democracy","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1562687004l/46266188._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1562687004l/46266188._SX98_.jpg","description":"The morning after Trump was elected president, the people who ran the US Department of Energy waited to brief the administrations transition team on the agency it would soon be running. Nobody appeared. Across all departments the stories were the same: Trump appointees were few and far between; those who did show up were shockingly uninformed about the functions of their new workplace.<br /><br /><br />Michael Lewiss brilliant narrative of the Trump administrations botched presidential transition takes us into the engine rooms of a government under attack by its leaders through willful ignorance and greed. The government manages a vast array of critical services that keep us safe and underpin our lives, from ensuring the safety of our food and medications and predicting extreme weather events to tracking and locating black- market uranium before the terrorists do. <em>The Fifth Risk</em> masterfully and vividly unspools the consequences of what happens when the people given control over our government have no idea how it works.","num_pages":255,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":4.09,"ratings_count":48196,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/16158493-the-first-20-hours","title":"The First 20 Hours: How to Learn Anything...Fast","title_without_series":"The First 20 Hours: How to Learn Anything...Fast","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1364771935l/16158493._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1364771935l/16158493._SX98_.jpg","description":"Cun sch ny l cuc tm kim ca c nhn ti nhm kim tra tnh ngh thut v khoa hc ca vic hc k nng nhanh chng - lm cch no  hc bt c k nng no nhanh nht c th. Mc ch ca cun sch ny l gip bn hc c nhng k nng mi trong khong thi gian k lc. Theo kinh nghim ca ti, mt khong 20 gi thc hnh  ph v ro cn tht v  i t mc hon ton khng bit g v vic bn ang c gng lm ti mc c th lm vic  tt mt cch ng ngc nhin. Cun sch ny l cch tip cn mang tnh h thng i vi vn  hc k nng mi nhanh nht c th. Phng php mang tnh ph qut. Vn  khng phi l bn mun hc ngoi ng, vit tiu thuyt, v chn dung, khi nghip hay li my bay. Nu bn u t t nht 20 ting  hc nhng iu c bn ca mt k nng, bn s ngc nhin vi mc  thnh tho m bn c th t c. Bt k k nng bn mun hc l g, cun sch ny cng s gip bn t c k nng  vi t thi gian v nng lng lng ph hn. Ch cn mt cht n lc tp trung, c chin lc, bn s thy mnh nhanh chng tin b m khng tht vng.<br />Trong cun sch ny, chng ta s bt u bng nhng nguyn tc hc k nng lm cch no  hc nhng k nng mi nhanh nht c th. Nhng  tng v bi tp thc hnh ny khng h phc tp, nn s khng mt qu nhiu thi gian  hc. Sau , ti s gii thch cch s dng nhng nguyn tc ny trong thc t bng cch ch cho cc bn bit ti  hc 6 k nng mi di y trong vng cha ti 20 ting mi k nng, khng qu 90 pht thc hnh mi ngy, nh th no.<br />- Pht trin bi tp yoga c nhn<br />- Vit chng trnh my tnh da trn web<br />- Hc li cch g 10 ngn<br />- Khm ph boardgame c nht v phc tp nht trong lch s<br />- Chi c mt nhc c<br />- Lt vn<br />Ti hi vng cun sch ny c th khuyn khch bn phi bi danh sch nhng vic mun lm ca bn, kim tra li danh sch  v cam kt hc c iu mi m no .","num_pages":"","authors":{"author":{"id":4409125,"name":"Josh Kaufman","role":"","image_url":"https://images.gr-assets.com/authors/1309447929p5/4409125.jpg","small_image_url":"https://images.gr-assets.com/authors/1309447929p2/4409125.jpg","link":"https://www.goodreads.com/author/show/4409125.Josh_Kaufman","average_rating":4.01,"ratings_count":59282,"text_reviews_count":2681}},"average_rating":3.46,"ratings_count":8066,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18295861-the-first-fifteen-lives-of-harry-august","title":"The First Fifteen Lives of Harry August","title_without_series":"The First Fifteen Lives of Harry August","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SX98_.jpg","description":"Some stories cannot be told in just one lifetime. Harry August is on his deathbed. Again. No matter what he does or the decisions he makes, when death comes, Harry always returns to where he began, a child with all the knowledge of a life he has already lived a dozen times before. Nothing ever changes. Until now. As Harry nears the end of his eleventh life, a little girl appears at his bedside. \\"I nearly missed you, Doctor August,\\" she says. \\"I need to send a message.\\" This is the story of what Harry does next, and what he did before, and how he tries to save a past he cannot change and a future he cannot allow.","num_pages":416,"authors":{"author":{"id":7210024,"name":"Claire North","role":"","image_url":"https://images.gr-assets.com/authors/1440105009p5/7210024.jpg","small_image_url":"https://images.gr-assets.com/authors/1440105009p2/7210024.jpg","link":"https://www.goodreads.com/author/show/7210024.Claire_North","average_rating":3.91,"ratings_count":177283,"text_reviews_count":23738}},"average_rating":4.03,"ratings_count":99978,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/30165919-the-god-delusion","title":"The God Delusion","title_without_series":"The God Delusion","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1476116806l/30165919._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1476116806l/30165919._SX98_.jpg","description":"<i>The God Delusion</i> caused a sensation when it was published in 2006. Within weeks it became the most hotly debated topic, with Dawkins himself branded as either saint or sinner for presenting his hard-hitting, impassioned rebuttal of religion of all types.<br /><br />His argument could hardly be more topical. While Europe is becoming increasingly secularized, the rise of religious fundamentalism, whether in the Middle East or Middle America, is dramatically and dangerously dividing opinion around the world. In America, and elsewhere, a vigorous dispute between 'intelligent design' and Darwinism is seriously undermining and restricting the teaching of science. In many countries religious dogma from medieval times still serves to abuse basic human rights such as women's and gay rights. And all from a belief in a God whose existence lacks evidence of any kind.<br /><br />Dawkins attacks God in all his forms. He eviscerates the major arguments for religion and demonstrates the supreme improbability of a supreme being. He shows how religion fuels war, foments bigotry and abuses children.<br /><br /><i>The God Delusion </i>is a brilliantly argued, fascinating polemic that will be required reading for anyone interested in this most emotional and important subject.","num_pages":471,"authors":{"author":{"id":1194,"name":"Richard Dawkins","role":"","image_url":"https://images.gr-assets.com/authors/1377030297p5/1194.jpg","small_image_url":"https://images.gr-assets.com/authors/1377030297p2/1194.jpg","link":"https://www.goodreads.com/author/show/1194.Richard_Dawkins","average_rating":4.03,"ratings_count":763334,"text_reviews_count":30405}},"average_rating":3.9,"ratings_count":284013,"publication_day":"","publication_month":"","publication_year":2016},{"link":"https://www.goodreads.com/book/show/44245196-the-great-mental-models","title":"The Great Mental Models: General Thinking Concepts","title_without_series":"The Great Mental Models: General Thinking Concepts","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"The old saying goes, \\"To the man with a hammer, everything looks like a nail.\\" But anyone who has done any kind of project knows a hammer often isn't enough. <br /> <br />The more tools you have at your disposal, the more likely you'll use the right tool for the job  and get it done right. <br /> <br />The same is true when it comes to your thinking. The quality of your outcomes depends on the mental models in your head. And most people are going through life with little more than a hammer. <br /> <br />Until now. <br /> <br />The Great Mental Models: General Thinking Concepts is the first book in The Great Mental Models series designed to upgrade your thinking with the best, most useful and powerful tools so you always have the right one on hand. <br /> <br />This volume details nine of the most versatile, all-purpose mental models you can use right away to improve your decision making, productivity, and how clearly you see the world. You will discover what forces govern the universe and how to focus your efforts so you can harness them to your advantage, rather than fight with them or worse yet ignore them. <br /> <br />Upgrade your mental toolbox and get the first volume today!","num_pages":"","authors":{"author":{"id":7871969,"name":"Shane Parrish","role":"","image_url":"https://images.gr-assets.com/authors/1686056002p5/7871969.jpg","small_image_url":"https://images.gr-assets.com/authors/1686056002p2/7871969.jpg","link":"https://www.goodreads.com/author/show/7871969.Shane_Parrish","average_rating":4.12,"ratings_count":23334,"text_reviews_count":1913}},"average_rating":4.07,"ratings_count":10441,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/11797471-the-idea-factory","title":"The Idea Factory: Bell Labs and the Great Age of American Innovation","title_without_series":"The Idea Factory: Bell Labs and the Great Age of American Innovation","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338504885l/11797471._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338504885l/11797471._SX98_.jpg","description":"From its beginnings in the 1920s until its demise in the 1980s, Bell Labsofficially, the research and development wing of AT&amp;Twas the biggest, and arguably the best, laboratory for new ideas in the world. From the transistor to the laser, its hard to find an aspect of modern life that hasnt been touched by Bell Labs.<br /><br />Why did so many transformative ideas come from Bell Labs? In The Idea Factory, Jon Gertner traces the origins of some of the twentieth centurys most important inventions and delivers a riveting and heretofore untold chapter of American history. At its heart this is a story about the life and work of a small group of brilliant and eccentric menMervin Kelly, Bill Shockley, Claude Shannon, John Pierce, and Bill Bakerwho spent their careers at Bell Labs. Their job was to research and develop the future of communications. Small-town boys, childhood hobbyists, oddballs: they give the lie to the idea that Bell Labs was a grim cathedral of top-down command and control.<br /><br />Gertner brings to life the powerful alchemy of the forces at work behind Bell Labs inventions, teasing out the intersections between science, business, and society. He distills the lessons that abide: how to recruit and nurture young talent; how to organize and lead fractious employees; how to find solutions to the most stubbornly vexing problems; how to transform a scientific discovery into a marketable product, then make it even better, cheaper, or both. Today, when the drive to invent has become a mantra, Bell Labs offers us a way to enrich our understanding of the challenges and solutions to technological innovation. Here, after all, was where the foundational ideas on the management of innovation were born.<br />The Idea Factory is the story of the origins of modern communications and the beginnings of the information agea deeply human story of extraordinary men who were given extraordinary meanstime, space, funds, and access to one anotherand edged the world into a new dimension.","num_pages":"","authors":{"author":{"id":5808423,"name":"Jon Gertner","role":"","image_url":"https://images.gr-assets.com/authors/1554851617p5/5808423.jpg","small_image_url":"https://images.gr-assets.com/authors/1554851617p2/5808423.jpg","link":"https://www.goodreads.com/author/show/5808423.Jon_Gertner","average_rating":4.2,"ratings_count":10213,"text_reviews_count":1041}},"average_rating":4.21,"ratings_count":8911,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/21856367-the-innovators","title":"The Innovators: How a Group of Hackers, Geniuses and Geeks Created the Digital Revolution","title_without_series":"The Innovators: How a Group of Hackers, Geniuses and Geeks Created the Digital Revolution","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1410191571l/21856367._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1410191571l/21856367._SX98_.jpg","description":"Following his blockbuster biography of Steve Jobs, The Innovators is Walter Isaacsons revealing story of the people who created the computer and the Internet. It is destined to be the standard history of the digital revolution and an indispensable guide to how innovation really happens.<br /><br />What were the talents that allowed certain inventors and entrepreneurs to turn their visionary ideas into disruptive realities? What led to their creative leaps? Why did some succeed and others fail?<br /><br />In his masterly saga, Isaacson begins with Ada Lovelace, Lord Byrons daughter, who pioneered computer programming in the 1840s. He explores the fascinating personalities that created our current digital revolution, such as Vannevar Bush, Alan Turing, John von Neumann, J.C.R. Licklider, Doug Engelbart, Robert Noyce, Bill Gates, Steve Wozniak, Steve Jobs, Tim Berners-Lee, and Larry Page.<br /><br />This is the story of how their minds worked and what made them so inventive. Its also a narrative of how their ability to collaborate and master the art of teamwork made them even more creative.<br /><br />For an era that seeks to foster innovation, creativity, and teamwork, The Innovators shows how they happen.","num_pages":542,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2035307,"text_reviews_count":55219}},"average_rating":4.12,"ratings_count":39914,"publication_day":7,"publication_month":10,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/37751071-the-little-book-of-common-sense-investing","title":"The Little Book of Common Sense Investing: The Only Way to Guarantee Your Fair Share of Stock Market Returns","title_without_series":"The Little Book of Common Sense Investing: The Only Way to Guarantee Your Fair Share of Stock Market Returns","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1515011941l/37751071._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1515011941l/37751071._SX98_.jpg","description":"The best-selling investing \\"bible\\" offers new information, new insights, and new perspectives<br /><br /><i>The Little Book of Common Sense Investing</i> is the classic guide to getting smart about the market. Legendary mutual fund pioneer John C. Bogle reveals his key to getting more out of investing: low-cost index funds. Bogle describes the simplest and most effective investment strategy for building wealth over the long term: buy and hold, at very low cost, a mutual fund that tracks a broad stock market Index such as the S&amp;P 500.<br /><br />While the stock market has tumbled and then soared since the first edition of <i>The Little Book of Common Sense Investing</i> was published in April 2007, Bogle's investment principles have endured and served investors well. This tenth anniversary edition includes updated data and new information but maintains the same long-term perspective as in its predecessor. Bogle has also added two new chapters designed to provide further guidance to investors: one on asset allocation, the other on retirement investing.<br /><br />A portfolio focused on index funds is the only investment that effectively guarantees your fair share of stock market returns. This strategy is favored by Warren Buffett, who said this about Bogle: \\"For decades, Jack has urged investors to invest in ultra-low-cost index funds.... Today, however, he has the satisfaction of knowing that he helped millions of investors realize far better returns on their savings than they otherwise would have earned. He is a hero to them and to me.\\"<br /><br />Bogle shows you how to make index investing work for you and help you achieve your financial goals and finds support from some of the world's best financial minds: not only Warren Buffett but Benjamin Graham, Paul Samuelson, Burton Malkiel, Yale's David Swensen, Cliff Asness of AQR, and many others.<br /><br />This new edition of <i>The Little Book of Common Sense Investing</i> offers you the same solid strategy as its predecessor for building your financial future.<br /><br /><br />Build a broadly diversified, low-cost portfolio without the risks of individual stocks, manager selection, or sector rotation.<br />Forget the fads and marketing hype, and focus on what works in the real world.<br />Understand that stock returns are generated by three sources (dividend yield, earnings growth, and change in market valuation) in order to establish rational expectations for stock returns over the coming decade.<br />Recognize that in the long run, business reality trumps market expectations.<br />Learn how to harness the magic of compounding returns while avoiding the tyranny of compounding costs.<br />While index investing allows you to sit back and let the market do the work for you, too many investors trade frantically, turning a winner's game into a loser's game. <i>The Little Book of Common Sense Investing</i> is a solid guidebook to your financial future.","num_pages":"","authors":{"author":{"id":88909,"name":"John C. Bogle","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/88909.John_C_Bogle","average_rating":4.14,"ratings_count":46939,"text_reviews_count":3668}},"average_rating":4.15,"ratings_count":26446,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1249095.The_Logic_of_Life","title":"The Logic of Life: The Rational Economics of an Irrational World","title_without_series":"The Logic of Life: The Rational Economics of an Irrational World","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"Life sometimes seems illogical. Individuals do strange things: take drugs, have unprotected sex, mug each other. Love seems irrational, and so does divorce. On a larger scale, life seems no fairer or easier to fathom: Why do some neighborhoods thrive and others become ghettos? Why is racism so persistent? Why is your idiot boss paid a fortune for sitting behind a mahogany altar? Thorny questionsand you might be surprised to hear the answers coming from an economist. But award-winning journalist Tim Harford likes to spring surprises. In this deftly reasoned book, he argues that life is logical after all. Under the surface of everyday insanity, hidden incentives are at work, and Harford shows these incentives emerging in the most unlikely places.","num_pages":213,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60920,"text_reviews_count":4360}},"average_rating":3.81,"ratings_count":5838,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18007564-the-martian","title":"The Martian","title_without_series":"The Martian","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1413706054l/18007564._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1413706054l/18007564._SX98_.jpg","description":"Six days ago, astronaut Mark Watney became one of the first people to walk on Mars. <br /><br />Now, hes sure hell be the first person to die there.<br /><br />After a dust storm nearly kills him and forces his crew to evacuate while thinking him dead, Mark finds himself stranded and completely alone with no way to even signal Earth that hes aliveand even if he could get word out, his supplies would be gone long before a rescue could arrive. <br /><br />Chances are, though, he wont have time to starve to death. The damaged machinery, unforgiving environment, or plain-old human error are much more likely to kill him first. <br /><br />But Mark isnt ready to give up yet. Drawing on his ingenuity, his engineering skills  and a relentless, dogged refusal to quit  he steadfastly confronts one seemingly insurmountable obstacle after the next. Will his resourcefulness be enough to overcome the impossible odds against him?<br /><br />","num_pages":369,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.35,"ratings_count":2919335,"text_reviews_count":301814}},"average_rating":4.42,"ratings_count":1297407,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/52578297-the-midnight-library","title":"The Midnight Library (The Midnight World, #1)","title_without_series":"The Midnight Library","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602190253l/52578297._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602190253l/52578297._SX98_.jpg","description":"Between life and death there is a library.<br /><br />When Nora Seed finds herself in the Midnight Library, she has a chance to make things right. Up until now, her life has been full of misery and regret. She feels she has let everyone down, including herself. But things are about to change.<br /><br />The books in the Midnight Library enable Nora to live as if she had done things differently. With the help of an old friend, she can now undo every one of her regrets as she tries to work out her perfect life. But things aren't always what she imagined they'd be, and soon her choices place the library and herself in extreme danger.<br /><br />Before time runs out, she must answer the ultimate question: what is the best way to live?","num_pages":288,"authors":{"author":{"id":76360,"name":"Matt Haig","role":"","image_url":"https://images.gr-assets.com/authors/1770056342p5/76360.jpg","small_image_url":"https://images.gr-assets.com/authors/1770056342p2/76360.jpg","link":"https://www.goodreads.com/author/show/76360.Matt_Haig","average_rating":3.95,"ratings_count":3387513,"text_reviews_count":349598}},"average_rating":3.98,"ratings_count":2488642,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/998.The_Millionaire_Next_Door","title":"The Millionaire Next Door: The Surprising Secrets of America's Wealthy","title_without_series":"The Millionaire Next Door: The Surprising Secrets of America's Wealthy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"The incredible national bestseller that is changing people's lives -- and increasing their net worth! <p> <b>CAN YOU SPOT THE MILLIONAIRE NEXT DOOR?</b> </p><p> <b>Who are the rich in this country?</b></p><p> What do they do?</p><p> Where do they shop?</p><p> What do they drive?</p><p> How do they invest?</p><p> Where did their ancestors come from?</p><p> How did they get rich?</p><p> Can I ever become one of them?</p><p> </p><p> Get the answers in <i>The Millionaire Next Door,</i> the never-before-told story about wealth in America. You'll be surprised at what you find out....</p>","num_pages":258,"authors":{"author":{"id":659,"name":"Thomas J. Stanley","role":"","image_url":"https://images.gr-assets.com/authors/1555867691p5/659.jpg","small_image_url":"https://images.gr-assets.com/authors/1555867691p2/659.jpg","link":"https://www.goodreads.com/author/show/659.Thomas_J_Stanley","average_rating":4.07,"ratings_count":169035,"text_reviews_count":6541}},"average_rating":4.05,"ratings_count":134575,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50998056-the-ministry-for-the-future","title":"The Ministry for the Future","title_without_series":"The Ministry for the Future","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1668935201l/50998056._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1668935201l/50998056._SX98_.jpg","description":"Established in 2025, the purpose of the new organization was simple: To advocate for the world's future generations and to protect all living creatures, present and future. It soon became known as the Ministry for the Future, and this is its story. <br /><br />From legendary science fiction author Kim Stanley Robinson comes a vision of climate change unlike any ever imagined. <br /><br />Told entirely through fictional eye-witness accounts, <i>The Ministry for the Future</i> is a masterpiece of the imagination, the story of how climate change will affect us all over the decades to come. <br /><br />Its setting is not a desolate, post-apocalyptic world, but a future that is almost upon usand in which we might just overcome the extraordinary challenges we face. <br /><br />It is a novel both immediate and impactful, desperate and hopeful in equal measure, and it is one of the most powerful and original books on climate change ever written.","num_pages":563,"authors":{"author":{"id":1858,"name":"Kim Stanley Robinson","role":"","image_url":"https://images.gr-assets.com/authors/1376955089p5/1858.jpg","small_image_url":"https://images.gr-assets.com/authors/1376955089p2/1858.jpg","link":"https://www.goodreads.com/author/show/1858.Kim_Stanley_Robinson","average_rating":3.83,"ratings_count":501402,"text_reviews_count":36586}},"average_rating":3.86,"ratings_count":42748,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/39722612-the-people-vs-tech","title":"The People Vs Tech: How the internet is killing democracy","title_without_series":"The People Vs Tech: How the internet is killing democracy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"In the ongoing waves of the Facebook scandal, this is the book that explains all the dangers of the digital revolution, and how our mountains of personal cyberdata are being mined by everyone from our own governments and political parties to big business to exploit our trust and threaten our freedom.<br /><br />The internet was meant to set us free. But have we unwittingly handed too much away to shadowy powers behind a wall of code, all manipulated by a handful of Silicon Valley utopians, ad men, and venture capitalists? And, in light of recent data breach scandals around companies like Facebook and Cambridge Analytica, what does that mean for democracy, our delicately balanced system of government that was created long before big data, total information, and artificial intelligence? In this urgent polemic, Jamie Bartlett argues that through our unquestioning embrace of big tech, the building blocks of democracy are slowly being removed. The middle class is being eroded, sovereign authority and civil society is weakened, and we citizens are losing our critical faculties, maybe even our free will.<br /><br /><i>The People Vs Tech</i> is an enthralling account of how our fragile political system is being threatened by the digital revolution. Bartlett explains that by upholding six key pillars of democracy, we can save it before it is too late. We need to become active citizens, uphold a shared democratic culture, protect free elections, promote equality, safeguard competitive and civic freedoms, and trust in a sovereign authority. This essential book shows that the stakes couldn't be higher and that, unless we radically alter our course, democracy will join feudalism, supreme monarchies and communism as just another political experiment that quietly disappeared.","num_pages":"","authors":{"author":{"id":7489747,"name":"Jamie Bartlett","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/7489747.Jamie_Bartlett","average_rating":3.81,"ratings_count":8534,"text_reviews_count":968}},"average_rating":3.9,"ratings_count":1727,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17255186-the-phoenix-project","title":"The Phoenix Project: A Novel About IT, DevOps, and Helping Your Business Win","title_without_series":"The Phoenix Project: A Novel About IT, DevOps, and Helping Your Business Win","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1361113128l/17255186._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1361113128l/17255186._SX98_.jpg","description":"Bill is an IT manager at Parts Unlimited. It's Tuesday morning and on his drive into the office, Bill gets a call from the CEO. <br /><br />The company's new IT initiative, code named Phoenix Project, is critical to the future of Parts Unlimited, but the project is massively over budget and very late. The CEO wants Bill to report directly to him and fix the mess in ninety days or else Bill's entire department will be outsourced. <br /><br />With the help of a prospective board member and his mysterious philosophy of The Three Ways, Bill starts to see that IT work has more in common with manufacturing plant work than he ever imagined. With the clock ticking, Bill must organize work flow streamline interdepartmental communications, and effectively serve the other business functions at Parts Unlimited. <br /><br />In a fast-paced and entertaining style, three luminaries of the DevOps movement deliver a story that anyone who works in IT will recognize. Readers will not only learn how to improve their own IT organizations, they'll never view IT the same way again.","num_pages":345,"authors":{"author":{"id":328437,"name":"Gene Kim","role":"","image_url":"https://images.gr-assets.com/authors/1361113444p5/328437.jpg","small_image_url":"https://images.gr-assets.com/authors/1361113444p2/328437.jpg","link":"https://www.goodreads.com/author/show/328437.Gene_Kim","average_rating":4.2,"ratings_count":76844,"text_reviews_count":6206}},"average_rating":4.26,"ratings_count":50191,"publication_day":10,"publication_month":1,"publication_year":2013},{"link":"https://www.goodreads.com/book/show/56696339-the-power-of-geography","title":"The Power of Geography: Ten Maps That Reveal the Future of Our World","title_without_series":"The Power of Geography: Ten Maps That Reveal the Future of Our World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610902279l/56696339._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610902279l/56696339._SX98_.jpg","description":"In this revelatory new book, Marshall explores ten regions that are set to shape global politics in a new age of great-power rivalry: Australia, Iran, Saudi Arabia, the UK, Greece, Turkey, the Sahel, Ethiopia, Spain and Space. Find out why Europes next refugee crisis is closer than it thinks as trouble brews in the Sahel; why the Middle East must look beyond oil and sand to secure its future; why the eastern Mediterranean is one of the most volatile flashpoints of the twenty-first century; and why the Earths atmosphere is set to become the worlds next battleground.<br /><br />Delivered with Marshalls trademark wit and insight, this is a lucid and gripping exploration of the power of geography to shape humanitys past, present  and future.<br /><br />Another outstanding guide to the modern world. Marshall is a master at explaining what you need to know and why. Peter Frankopan","num_pages":360,"authors":{"author":{"id":713466,"name":"Tim  Marshall","role":"","image_url":"https://images.gr-assets.com/authors/1489696759p5/713466.jpg","small_image_url":"https://images.gr-assets.com/authors/1489696759p2/713466.jpg","link":"https://www.goodreads.com/author/show/713466.Tim_Marshall","average_rating":4.14,"ratings_count":167924,"text_reviews_count":13897}},"average_rating":4.19,"ratings_count":25196,"publication_day":22,"publication_month":4,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/17248798-the-power-of-habit","title":"The Power of Habit: Why We Do What We Do and How to Change","title_without_series":"The Power of Habit: Why We Do What We Do and How to Change","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1366562921l/17248798._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1366562921l/17248798._SX98_.jpg","description":"Habits are difficult to change. The neuroscience behind the functioning of habits is still not known to many. On one hand, there is always one section of the society which finds it exceptionally easy to adapt to new situations, new environment and frequent changes. On the other hand, there are people and organizations who strive hard to mold themselves into a changing environment.<br /><br />The Power of Habit: Why We Do What We Do and How To Change presents us with brilliant information in the most engaging way that enlightens us towards the depth of human nature and its tremendous potential to transform. Through this book we visit laboratories where neuroscientists explore how habits work and where, exactly, they reside in our brains. We also understand the importance of the right habits which led to the success of great personalities.<br /><br />Keystone habits help earn billions and can also make a difference between failure and success, life and death. Hence, The Power of Habit: Why We Do What We Do and How To Change gives the readers an insight into the world's top notch companies, Rick Warren's Saddleback Church, NFL locker rooms and the nation's largest hospital to suggest the importance of right habits.","num_pages":371,"authors":{"author":{"id":5201530,"name":"Charles Duhigg","role":"","image_url":"https://images.gr-assets.com/authors/1349273209p5/5201530.jpg","small_image_url":"https://images.gr-assets.com/authors/1349273209p2/5201530.jpg","link":"https://www.goodreads.com/author/show/5201530.Charles_Duhigg","average_rating":4.11,"ratings_count":639259,"text_reviews_count":30653}},"average_rating":4.13,"ratings_count":564731,"publication_day":"","publication_month":"","publication_year":2013},{"link":"https://www.goodreads.com/book/show/56790170-the-premonition","title":"The Premonition: A Pandemic Story","title_without_series":"The Premonition: A Pandemic Story","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1611844095l/56790170._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1611844095l/56790170._SX98_.jpg","description":"<b>For those who could read between the lines, the censored news out of China was terrifying. But the president insisted there was nothing to worry about.</b><br /><br />Fortunately, we are still a nation of skeptics. Fortunately, there are those among us who study pandemics and are willing to look unflinchingly at worst-case scenarios. Michael Lewiss taut and brilliant nonfiction thriller pits a band of medical visionaries against the wall of ignorance that was the official response of the Trump administration to the outbreak of COVID-19.<br /><br />The characters you will meet in these pages are as fascinating as they are unexpected. A thirteen-year-old girls science project on transmission of an airborne pathogen develops into a very grown-up model of disease control. A local public-health officer uses her worms-eye view to see what the CDC misses, and reveals great truths about American society. A secret team of dissenting doctors, nicknamed the Wolverines, has everything necessary to fight the pandemic: brilliant backgrounds, world-class labs, prior experience with the pandemic scares of bird flu and swine flueverything, that is, except official permission to implement their work.<br /><br />Michael Lewis is not shy about calling these people heroes for their refusal to follow directives that they know to be based on misinformation and bad science. Even the internet, as crucial as it is to their exchange of ideas, poses a risk to them. They never know for sure who else might be listening in.","num_pages":304,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":4.32,"ratings_count":43049,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13766064-the-psychology-book","title":"The Psychology Book: Big Ideas Simply Explained","title_without_series":"The Psychology Book: Big Ideas Simply Explained","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1337573169l/13766064._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1337573169l/13766064._SX98_.jpg","description":"Clearly explaining more than 100 groundbreaking ideas in the field, The Psychology Book uses accessible text and easy-to-follow graphics and illustrations to explain the complex theoretical and experimental foundations of psychology.<br /><br />From its philosophical roots through behaviorism, psychotherapy, and developmental psychology, The Psychology Book looks at all the greats from Pavlov and Skinner to Freud and Jung, and is an essential reference for students and anyone with an interest in how the mind works.","num_pages":"","authors":{"author":{"id":414326,"name":"Nigel C. Benson","role":"","image_url":"https://images.gr-assets.com/authors/1388229934p5/414326.jpg","small_image_url":"https://images.gr-assets.com/authors/1388229934p2/414326.jpg","link":"https://www.goodreads.com/author/show/414326.Nigel_C_Benson","average_rating":3.98,"ratings_count":7964,"text_reviews_count":587}},"average_rating":4.17,"ratings_count":5150,"publication_day":16,"publication_month":1,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/41881472-the-psychology-of-money","title":"The Psychology of Money: Timeless Lessons on Wealth, Greed, and Happiness","title_without_series":"The Psychology of Money: Timeless Lessons on Wealth, Greed, and Happiness","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1581527774l/41881472._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1581527774l/41881472._SX98_.jpg","description":"<i>Alternate cover edition of <a href=\\"https://www.goodreads.com/book/show/245699987-the-psychology-of-money\\" rel=\\"nofollow noopener\\">ISBN 9780857197689</a>.</i><br /><br />Doing well with money isnt necessarily about what you know. Its about how you behave. And behavior is hard to teach, even to really smart people.<br /><br />Moneyinvesting, personal finance, and business decisionsis typically taught as a math-based field, where data and formulas tell us exactly what to do. But in the real world people dont make financial decisions on a spreadsheet. They make them at the dinner table, or in a meeting room, where personal history, your own unique view of the world, ego, pride, marketing, and odd incentives are scrambled together.<br /><br />In <i>The Psychology of Money</i>, award-winning author Morgan Housel shares 19 short stories exploring the different ways people think about money and teaches you how to make better sense of one of lifes most important topics.","num_pages":242,"authors":{"author":{"id":7499284,"name":"Morgan Housel","role":"","image_url":"https://images.gr-assets.com/authors/1669719604p5/7499284.jpg","small_image_url":"https://images.gr-assets.com/authors/1669719604p2/7499284.jpg","link":"https://www.goodreads.com/author/show/7499284.Morgan_Housel","average_rating":4.27,"ratings_count":367392,"text_reviews_count":24613}},"average_rating":4.28,"ratings_count":327346,"publication_day":8,"publication_month":9,"publication_year":2020},{"link":"https://www.goodreads.com/book/show/29807115-the-selfish-gene","title":"The Selfish Gene","title_without_series":"The Selfish Gene","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SX98_.jpg","description":"The million copy international bestseller, critically acclaimed and translated into over 25 languages. <br />As influential today as when it was first published, The Selfish Gene has become a classic exposition of evolutionary thought. Professor Dawkins articulates a gene's eye view of evolution - a view giving centre stage to these persistent units of information, and in which organisms can be seen as vehicles for their replication. This imaginative, powerful, and stylistically brilliant work not only brought the insights of Neo-Darwinism to a wide audience, but galvanized the biology community, generating much debate and stimulating whole new areas of research. Forty years later, its insights remain as relevant today as on the day it was published. <br />This 40th anniversary edition includes a new epilogue from the author discussing the continuing relevance of these ideas in evolutionary biology today, as well as the original prefaces and foreword, and extracts from early reviews. <br />Oxford Landmark Science books are 'must-read' classics of modern science writing which have crystallized big ideas, and shaped the way we think.<br />","num_pages":464,"authors":{"author":{"id":1194,"name":"Richard Dawkins","role":"","image_url":"https://images.gr-assets.com/authors/1377030297p5/1194.jpg","small_image_url":"https://images.gr-assets.com/authors/1377030297p2/1194.jpg","link":"https://www.goodreads.com/author/show/1194.Richard_Dawkins","average_rating":4.03,"ratings_count":763334,"text_reviews_count":30405}},"average_rating":4.16,"ratings_count":193438,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/2054761.The_Snowball","title":"The Snowball: Warren Buffett and the Business of Life","title_without_series":"The Snowball: Warren Buffett and the Business of Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320458276l/2054761._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320458276l/2054761._SX98_.jpg","description":"Bulgarele de zapada este o biografie exhaustiva, in care detaliile despre viata personala se combina cu cele de natura profesionala, intr-un melanj impresionant, dezvaluit cu o fluiditate narativa deosebita. Pentru prima data, Warren Buffett permite accesul unui autor la timpul sau, la prietenii si familia lui, dar si la partenerii de afaceri sau documentele sale personale. Este un act de curaj, fiindca, asemenea tuturor fiintelor umane, si viata lui Buffett a fost un amestec de tarie si fragilitate. Spre deosebire de alte carti, care se rezuma doar la stilul sau de investitii, lucrarea de fata exploreaza filosofia de viata si personalitatea uluitoare a celui supranumit Oracolul din Omaha.<br /><br />Warren Buffett este un complex de paradoxuri, care si-a propus sa demonstreze ca si baietii buni pot iesi pe primul loc. De-a lungul anilor si-a tratat investitorii ca pe niste parteneri, a actionat ca indrumator al acestora, iar principala sa caracteristica in calitate de investitor, CEO, membru al diverselor consilii directoare din companii, eseist si orator a fost onestitatea, care l-a insotit pe tot parcursul vietii si in toate actiunile, ajungand la un moment cel mai bogat om din lume si cel care a facut cea mai mare donatie din istorie, si nu oricui, ci fundatiei conduse de Bill Gates, de care il leaga o stransa prietenie.<br /><br />Indiferent cat de mare este averea sa, mostenirea pe care o lasa Buffett nu se rezuma doar la bani, ci la principiile de viata si ideile cu care a imbogatit vietile celorlalti. Vom vedea astfel de ce Warren Buffett este cea mai fascinanta istorie de succes a vremurilor noastre.","num_pages":960,"authors":{"author":{"id":933665,"name":"Alice Schroeder","role":"","image_url":"https://images.gr-assets.com/authors/1227584009p5/933665.jpg","small_image_url":"https://images.gr-assets.com/authors/1227584009p2/933665.jpg","link":"https://www.goodreads.com/author/show/933665.Alice_Schroeder","average_rating":4.16,"ratings_count":54466,"text_reviews_count":1796}},"average_rating":4.16,"ratings_count":54400,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/7090.The_Soul_of_a_New_Machine","title":"The Soul of a New Machine","title_without_series":"The Soul of a New Machine","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627012239l/7090._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627012239l/7090._SX98_.jpg","description":"The computer revolution brought with it new methods of getting work donejust look at today's news for reports of hard-driven, highly-motivated young software and online commerce developers who sacrifice evenings and weekends to meet impossible deadlines. Tracy Kidder got a preview of this world in the late 1970s when he observed the engineers of Data General design and build a new 32-bit minicomputer in just one year. His thoughtful, prescient book, <i>The Soul of a New Machine</i>, tells stories of 35-year-old \\"veteran\\" engineers hiring recent college graduates and encouraging them to work harder and faster on complex and difficult projects, exploiting the youngsters' ignorance of normal scheduling processes while engendering a new kind of work ethic.<br /><br />These days, we are used to the \\"total commitment\\" philosophy of managing technical creation, but Kidder was surprised and even a little alarmed at the obsessions and compulsions he found. From in-house political struggles to workers being permitted to tease management to marathon 24-hour work sessions, <i>The Soul of a New Machine</i> explores concepts that already seem familiar, even old-hat, less than 20 years later. Kidder plainly admires his subjects; while he admits to hopeless confusion about their work, he finds their dedication heroic. The reader wonders, though, what will become of it all, now and in the future. <i>Rob Lightner</i>","num_pages":293,"authors":{"author":{"id":4770,"name":"Tracy Kidder","role":"","image_url":"https://images.gr-assets.com/authors/1205329434p5/4770.jpg","small_image_url":"https://images.gr-assets.com/authors/1205329434p2/4770.jpg","link":"https://www.goodreads.com/author/show/4770.Tracy_Kidder","average_rating":4.16,"ratings_count":140726,"text_reviews_count":12144}},"average_rating":4.12,"ratings_count":9504,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/28257707-the-subtle-art-of-not-giving-a-f-ck","title":"The Subtle Art of Not Giving a F*ck: A Counterintuitive Approach to Living a Good Life","title_without_series":"The Subtle Art of Not Giving a F*ck: A Counterintuitive Approach to Living a Good Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1465761302l/28257707._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1465761302l/28257707._SX98_.jpg","description":"<i>Alternate cover edition of ISBN 9780062457738</i><br /><br />In this generation-defining self-help guide, a superstar blogger cuts through the crap to show us how to stop trying to be \\"positive\\" all the time so that we can truly become better, happier people.<br /><br />For decades, weve been told that positive thinking is the key to a happy, rich life. \\"F**k positivity,\\" Mark Manson says. \\"Lets be honest, shit is f**ked and we have to live with it.\\" In his wildly popular Internet blog, Manson doesnt sugarcoat or equivocate. He tells it like it isa dose of raw, refreshing, honest truth that is sorely lacking today. <em>The Subtle Art of Not Giving a F**k</em> is his antidote to the coddling, lets-all-feel-good mindset that has infected American society and spoiled a generation, rewarding them with gold medals just for showing up.<br /><br />Manson makes the argument, backed both by academic research and well-timed poop jokes, that improving our lives hinges not on our ability to turn lemons into lemonade, but on learning to stomach lemons better. Human beings are flawed and limited\\"not everybody can be extraordinary, there are winners and losers in society, and some of it is not fair or your fault.\\" Manson advises us to get to know our limitations and accept them. Once we embrace our fears, faults, and uncertainties, once we stop running and avoiding and start confronting painful truths, we can begin to find the courage, perseverance, honesty, responsibility, curiosity, and forgiveness we seek.<br /><br />There are only so many things we can give a f**k about so we need to figure out which ones really matter, Manson makes clear. While money is nice, caring about what you do with your life is better, because true wealth is about experience. A much-needed grab-you-by-the-shoulders-and-look-you-in-the-eye moment of real-talk, filled with entertaining stories and profane, ruthless humor, <em>The Subtle Art of Not Giving a F**k</em> is a refreshing slap for a generation to help them lead contented, grounded lives.","num_pages":212,"authors":{"author":{"id":8529755,"name":"Mark Manson","role":"","image_url":"https://images.gr-assets.com/authors/1410365708p5/8529755.jpg","small_image_url":"https://images.gr-assets.com/authors/1410365708p2/8529755.jpg","link":"https://www.goodreads.com/author/show/8529755.Mark_Manson","average_rating":3.87,"ratings_count":1619258,"text_reviews_count":92082}},"average_rating":3.86,"ratings_count":1420473,"publication_day":13,"publication_month":9,"publication_year":2016},{"link":"https://www.goodreads.com/book/show/75598048-the-things-we-make","title":"The Things We Make: The Unknown History of Invention from Cathedrals to Soda Cans","title_without_series":"The Things We Make: The Unknown History of Invention from Cathedrals to Soda Cans","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"Discover the secret method used to build the world<br /><br />For millennia, humans have used one simple method to solve problems. Whether it's planting crops, building skyscrapers, developing photographs, or designing the first microchip, all creators follow the same steps to engineer progress. But this powerful method, the \\"engineering method\\", is an all but hidden process that few of us have heard oflet alone understandbut that influences every aspect of our lives.<br /><br />Bill Hammack, a Carl Sagan award-winning professor of engineering and viral \\"The Engineer Guy\\" on Youtube, has a lifelong passion for the things we make, and how we make them. Now, for the first time, he reveals the invisible method behind every invention and takes us on a whirlwind tour of how humans built the world we know today. From the grand stone arches of medieval cathedrals to the mundane modern soda can, Hammack explains the golden rule of thumb that underlies every new building technique, every technological advancement, and every creative solution that leads us one step closer to a better, more functional world. Spanning centuries and cultures, Hammack offers a fascinating perspective on how humans engineer solutions in a world full of problems.<br /><br />A book unlike any other, The Things We Make is a captivating examination of the method that keeps pushing humanity forward, a spotlight on the achievements of the past, and a celebration of the potential of our future that will change the way we see the world around us.","num_pages":272,"authors":{"author":{"id":4633760,"name":"Bill Hammack","role":"","image_url":"https://images.gr-assets.com/authors/1413035146p5/4633760.jpg","small_image_url":"https://images.gr-assets.com/authors/1413035146p2/4633760.jpg","link":"https://www.goodreads.com/author/show/4633760.Bill_Hammack","average_rating":3.85,"ratings_count":1978,"text_reviews_count":225}},"average_rating":3.75,"ratings_count":1274,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/20518872-the-three-body-problem","title":"The Three-Body Problem (Remembrance of Earths Past, #1)","title_without_series":"The Three-Body Problem","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1415428227l/20518872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1415428227l/20518872._SX98_.jpg","description":"Set against the backdrop of China's Cultural Revolution, a secret military project sends signals into space to establish contact with aliens. An alien civilization on the brink of destruction captures the signal and plans to invade Earth. Meanwhile, on Earth, different camps start forming, planning to either welcome the superior beings and help them take over a world seen as corrupt, or to fight against the invasion.","num_pages":472,"authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":960805,"text_reviews_count":90486}},"average_rating":4.08,"ratings_count":499704,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/2612.The_Tipping_Point","title":"The Tipping Point: How Little Things Can Make a Big Difference","title_without_series":"The Tipping Point: How Little Things Can Make a Big Difference","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473396980l/2612._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473396980l/2612._SX98_.jpg","description":"<i>Alternate cover edition of ISBN 9780316346627.</i><br /><br />From the bestselling author of The Bomber Mafia: discover Malcolm Gladwell's breakthrough debut and explore the science behind viral trends in business, marketing, and human behavior.<br />The tipping point is that magic moment when an idea, trend, or social behavior crosses a threshold, tips, and spreads like wildfire. Just as a single sick person can start an epidemic of the flu, so too can a small but precisely targeted push cause a fashion trend, the popularity of a new product, or a drop in the crime rate. This widely acclaimed bestseller, in which Malcolm Gladwell explores and brilliantly illuminates the tipping point phenomenon, is already changing the way people throughout the world think about selling products and disseminating ideas.","num_pages":301,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3176601,"text_reviews_count":132017}},"average_rating":4.01,"ratings_count":857387,"publication_day":"","publication_month":"","publication_year":2002},{"link":"https://www.goodreads.com/book/show/599660.The_Undercover_Economist","title":"The Undercover Economist","title_without_series":"The Undercover Economist","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SX98_.jpg","description":"Who makes most money from the demand for cappuccinos early in the morning at Waterloo Station? Why is it impossible to get a foot on the property ladder? How does the Mafia make money from laundries when street gangs pushing drugs dont? Who really benefits from immigration? How can China, in just fifty years, go from the worlds worst famine to one of the greatest economic revolutions of all time, lifting a million people out of poverty a month?<br /><br />Looking at familiar situations in unfamiliar ways, THE UNDERCOVER ECONOMIST is a fresh explanation of the fundamental principles of the modern economy, illuminated by examples from the streets of London to the booming skyscrapers of Shanghai to the sleepy canals of Bruges. Leaving behind textbook jargon and equations, Tim Harford will reveal the games of signals and negotiations, contests of strength and battles of wit that drive not only the economy at large but the everyday choices we make.","num_pages":278,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60920,"text_reviews_count":4360}},"average_rating":3.81,"ratings_count":29576,"publication_day":"","publication_month":"","publication_year":2007},{"link":"https://www.goodreads.com/book/show/19421805-the-undercover-economist-strikes-back","title":"The Undercover Economist Strikes Back: How to Run--or Ruin--an Economy","title_without_series":"The Undercover Economist Strikes Back: How to Run--or Ruin--an Economy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>A provocative and lively exploration of the increasingly important world of macroeconomics, by the author of the bestselling <i>The Undercover Economist</i>.</b><br /> <br /> Thanks to the worldwide financial upheaval, economics is no longer a topic we can ignore. From politicians to hedge-fund managers to middle-class IRA holders, everyone must pay attention to how and why the global economy works the way it does.<br /> <br /> Enter <i>Financial Times</i> columnist and bestselling author Tim Harford. In this new book that demystifies macroeconomics, Harford strips away the spin, the hype, and the jargon to reveal the truth about how the worlds economy actually works. With the wit of a raconteur and the clear grasp of an expert, Harford explains whats really happening beyond todays headlines, why all of us should care, and what we can do about it to understand it better.<br /> <br />","num_pages":"","authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60920,"text_reviews_count":4360}},"average_rating":3.92,"ratings_count":3271,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/35631386-the-undoing-project","title":"The Undoing Project: A Friendship That Changed Our Minds","title_without_series":"The Undoing Project: A Friendship That Changed Our Minds","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1509135882l/35631386._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1509135882l/35631386._SX98_.jpg","description":"Brilliant. . . . Lewis has given us a spectacular account of two great men who faced up to uncertainty and the limits of human reason. William Easterly, Wall Street Journal <br /><br />Forty years ago, Israeli psychologists Daniel Kahneman and Amos Tversky wrote a series of breathtakingly original papers that invented the field of behavioral economics. One of the greatest partnerships in the history of science, Kahneman and Tverskys extraordinary friendship incited a revolution in Big Data studies, advanced evidence-based medicine, led to a new approach to government regulation, and made much of Michael Lewiss own work possible. In The Undoing Project, Lewis shows how their Nobel Prizewinning theory of the mind altered our perception of reality.","num_pages":"","authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":910223,"text_reviews_count":52595}},"average_rating":3.99,"ratings_count":64246,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/44333183-the-unicorn-project","title":"The Unicorn Project","title_without_series":"The Unicorn Project","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1566877586l/44333183._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1566877586l/44333183._SX98_.jpg","description":"The Phoenix Project wowed over a half-million readers. Now comes the Wall Street Journal Bestselling The Unicorn Project !  The Unicorn Project is amazing, and I loved it 100 times more than The Phoenix Project  FERNANDO CORNAGO, Senior Director Platform Engineering, Adidas Gene Kim does a masterful job of showing how  the efforts of many create lasting business advantages for all. DR. STEVEN SPEAR, author of The High-Velocity Edge, Sr. Lecturer at MIT, and principal of HVE LLC.  The Unicorn Project is so clever, so good, so crazy enlightening! CORNELIA DAVIS, Vice President Of Technology at Pivotal Software, Inc., Author of Cloud Native Patterns This highly anticipated follow-up to the bestselling title The Phoenix Project takes another look at Parts Unlimited, this time from the perspective of software development. In The Unicorn Project , we follow Maxine, a senior lead developer and architect, as she is exiled to the Phoenix Project, to the horror of her friends and colleagues, as punishment for contributing to a payroll outage. She tries to survive in what feels like a heartless and uncaring bureaucracy and to work within a system where no one can get anything done without endless committees, paperwork, and approvals. One day, she is approached by a ragtag bunch of misfits who say they want to overthrow the existing order, to liberate developers, to bring joy back to technology work, and to enable the business to win in a time of digital disruption. To her surprise, she finds herself drawn ever further into this movement, eventually becoming one of the leaders of the Rebellion, which puts her in the crosshairs of some familiar and very dangerous enemies. The Age of Software is here, and another mass extinction event loomsthis is a story about rebel developers and business leaders working together, racing against time to innovate, survive, and thrive in a time of unprecedented uncertainty...and opportunity.  The Unicorn Project provides insanely useful insights on how to improve your technology business. DOMINICA DEGRANDIS, author of Making Work Visible and Director of Digital Transformation at Tasktop  My goal in writing The Unicorn Project was to explore and reveal the necessary but invisible structures required to make developers (and all engineers) productive, and reveal the devastating effects of technical debt and complexity. I hope this book can create common ground for technology and business leaders to leave the past behind, and co-create a better future together.Gene Kim, November 2019","num_pages":"","authors":{"author":{"id":328437,"name":"Gene Kim","role":"","image_url":"https://images.gr-assets.com/authors/1361113444p5/328437.jpg","small_image_url":"https://images.gr-assets.com/authors/1361113444p2/328437.jpg","link":"https://www.goodreads.com/author/show/328437.Gene_Kim","average_rating":4.2,"ratings_count":76844,"text_reviews_count":6206}},"average_rating":4.06,"ratings_count":10149,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/144405196-the-worlds-i-see","title":"The Worlds I See: Curiosity, Exploration, and Discovery at the Dawn of AI","title_without_series":"The Worlds I See: Curiosity, Exploration, and Discovery at the Dawn of AI","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"The moving memoir of a scientist coming of age as an immigrant in America who finds her calling at the forefront of the AI revolution.<br /><br />Wired called Dr. Fei-Fei Li one of a tiny group of scientistsa group perhaps small enough to fit around a kitchen tablewho are responsible for AIs recent remarkable advances.<br /><br />Known to the world as the creator of ImageNet, a key catalyst of modern artificial intelligence, Dr. Li has spent more than two decades at the forefront of the field. But her career in science was improbable from the start. As immigrants, her family faced a difficult transition from Chinas middle class to American poverty. And their lives were made all the harder as they struggled to care for her ailing mother, who was working tirelessly to help them all gain a foothold in their new land.<br /><br />Fei-Feis adolescent knack for physics endured, however, and positioned her to make a crucial contribution to the breakthrough we now call AI, placing her at the center of a global transformation. Over the last decades, her work has brought her face-to-face with the extraordinary possibilitiesand the extraordinary dangersof the technology she loves.<br /><br />The Worlds I See is a story of science in the first person, documenting one of the centurys defining moments from the inside. It provides a riveting story of a scientist at work and a thrillingly clear explanation of what artificial intelligence actually isand how it came to be. Emotionally raw and intellectually uncompromising, this book is a testament not only to the passion required for even the most technical scholarship but also to the curiosity forever at its heart.","num_pages":"","authors":{"author":{"id":6759438,"name":"Fei-Fei Li","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/6759438.Fei_Fei_Li","average_rating":4.31,"ratings_count":5032,"text_reviews_count":655}},"average_rating":4.31,"ratings_count":5029,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55539565-think-again","title":"Think Again: The Power of Knowing What You Don't Know","title_without_series":"Think Again: The Power of Knowing What You Don't Know","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602574232l/55539565._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602574232l/55539565._SX98_.jpg","description":"<i>Think Again </i>is a book about the benefit of doubt, and about how we can get better at embracing the unknown and the joy of being wrong. Evidence has shown that creative geniuses are not attached to one identity, but constantly willing to rethink their stances and that leaders who admit they don't know something and seek critical feedback lead more productive and innovative teams.<br /><br />New evidence shows us that as a mindset and a skilllset, rethinking can be taught and Grant explains how to develop the necessary qualities to do it. Section 1 explores why we struggle to think again and how we can learn to do it as individuals, arguing that 'grit' alone can actually be counterproductive. Section 2 discusses how we can help others think again through learning about 'argument literacy'. And the final section 3 looks at how schools, businesses and governments fall short in building cultures that encourage rethinking.<br /><br />In the end, learning to <i>rethink</i> may be the secret skill to give you the edge in a world changing faster than ever.","num_pages":307,"authors":{"author":{"id":6583155,"name":"Adam M. Grant","role":"","image_url":"https://images.gr-assets.com/authors/1638361005p5/6583155.jpg","small_image_url":"https://images.gr-assets.com/authors/1638361005p2/6583155.jpg","link":"https://www.goodreads.com/author/show/6583155.Adam_M_Grant","average_rating":4.04,"ratings_count":351469,"text_reviews_count":23789}},"average_rating":4.13,"ratings_count":147590,"publication_day":2,"publication_month":2,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/17331349-think-like-a-freak","title":"Think Like a Freak","title_without_series":"Think Like a Freak","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395610974l/17331349._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395610974l/17331349._SX98_.jpg","description":"The New York Times bestselling Freakonomics changed the way we see the world, exposing the hidden side of just about everything. Then came SuperFreakonomics, a documentary film, an award-winning podcast, and more.<br /><br />Now, with Think Like a Freak, Steven D. Levitt and Stephen J. Dubner have written their most revolutionary book yet. With their trademark blend of captivating storytelling and unconventional analysis, they take us inside their thought process and teach us all to think a bit more productively, more creatively, more rationallyto think, that is, like a Freak.<br /><br />Levitt and Dubner offer a blueprint for an entirely new way to solve problems, whether your interest lies in minor lifehacks or major global reforms. As always, no topic is off-limits. They range from business to philanthropy to sports to politics, all with the goal of retraining your brain. Along the way, youll learn the secrets of a Japanese hot-dog-eating champion, the reason an Australian doctor swallowed a batch of dangerous bacteria, and why Nigerian e-mail scammers make a point of saying theyre from Nigeria.<br /><br />Some of the steps toward thinking like a Freak<br /><br />First, put away your moral compassbecause its hard to see a problem clearly if youve already decided what to do about it. Learn to say I dont knowfor until you can admit what you dont yet know, its virtually impossible to learn what you need to. Think like a childbecause youll come up with better ideas and ask better questions. Take a master class in incentivesbecause for better or worse, incentives rule our world. Learn to persuade people who dont want to be persuadedbecause being right is rarely enough to carry the day. Learn to appreciate the upside of quittingbecause you cant solve tomorrows problem if you arent willing to abandon todays dud. Levitt and Dubner plainly see the world like no one else. Now you can too. Never before have such iconoclastic thinkers been so revealingand so much fun to read.","num_pages":293,"authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1107926,"text_reviews_count":30849}},"average_rating":3.86,"ratings_count":56327,"publication_day":12,"publication_month":5,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/35957157-thinking-in-bets","title":"Thinking in Bets: Making Smarter Decisions When You Don't Have All the Facts","title_without_series":"Thinking in Bets: Making Smarter Decisions When You Don't Have All the Facts","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513351600l/35957157._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513351600l/35957157._SX98_.jpg","description":"In Super Bowl XLIX, Seahawks coach Pete Carroll made one of the most controversial calls in football history: With 26 seconds remaining, and trailing by four at the Patriots' one-yard line, he called for a pass instead of a hand off to his star running back. The pass was intercepted and the Seahawks lost. Critics called it the dumbest play in history. But was the call really that bad? Or did Carroll actually make a great move that was ruined by bad luck?<br /><br />Even the best decision doesn't yield the best outcome every time. There's always an element of luck that you can't control, and there is always information that is hidden from view. So the key to long-term success (and avoiding worrying yourself to death) is to think in bets: How sure am I? What are the possible ways things could turn out? What decision has the highest odds of success? Did I land in the unlucky 10% on the strategy that works 90% of the time? Or is my success attributable to dumb luck rather than great decision making?<br /><br />Annie Duke, a former World Series of Poker champion turned business consultant, draws on examples from business, sports, politics, and (of course) poker to share tools anyone can use to embrace uncertainty and make better decisions. For most people, it's difficult to say \\"I'm not sure\\" in a world that values and, even, rewards the appearance of certainty. But professional poker players are comfortable with the fact that great decisions don't always lead to great outcomes and bad decisions don't always lead to bad outcomes.<br /><br />By shifting your thinking from a need for certainty to a goal of accurately assessing what you know and what you don't, you'll be less vulnerable to reactive emotions, knee-jerk biases, and destructive habits in your decision making. You'll become more confident, calm, compassionate and successful in the long run.","num_pages":"","authors":{"author":{"id":312231,"name":"Annie Duke","role":"","image_url":"https://images.gr-assets.com/authors/1521558804p5/312231.jpg","small_image_url":"https://images.gr-assets.com/authors/1521558804p2/312231.jpg","link":"https://www.goodreads.com/author/show/312231.Annie_Duke","average_rating":3.93,"ratings_count":38840,"text_reviews_count":4012}},"average_rating":3.82,"ratings_count":23480,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25516595-thinking-fast-and-slow","title":"Thinking, Fast and Slow","title_without_series":"Thinking, Fast and Slow","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SX98_.jpg","description":"<b>In the highly anticipated <i>Thinking, Fast and Slow</i>, Kahneman takes us on a groundbreaking tour of the mind and explains the two systems that drive the way we think.</b><br /><br />System 1 is fast, intuitive, and emotional; System 2 is slower, more deliberative, and more logical. Kahneman exposes the extraordinary capabilities  and also the faults and biases  of fast thinking, and reveals the pervasive influence of intuitive impressions on our thoughts and behavior. <br /><br />The impact of loss aversion and overconfidence on corporate strategies, the difficulties of predicting what will make us happy in the future, the challenges of properly framing risks at work and at home, the profound effect of cognitive biases on everything from playing the stock market to planning the next vacation  each of these can be understood only by knowing how the two systems work together to shape our judgments and decisions.<br /><br />Engaging the reader in a lively conversation about how we think, Kahneman reveals where we can and cannot trust our intuitions and how we can tap into the benefits of slow thinking. He offers practical and enlightening insights into how choices are made in both our business and our personal lives  and how we can use different techniques to guard against the mental glitches that often get us into trouble. <br /><br /><i>Thinking, Fast and Slow</i> will transform the way you think about thinking.","num_pages":504,"authors":{"author":{"id":72401,"name":"Daniel Kahneman","role":"","image_url":"https://images.gr-assets.com/authors/1615917414p5/72401.jpg","small_image_url":"https://images.gr-assets.com/authors/1615917414p2/72401.jpg","link":"https://www.goodreads.com/author/show/72401.Daniel_Kahneman","average_rating":4.15,"ratings_count":615861,"text_reviews_count":21554}},"average_rating":4.17,"ratings_count":592621,"publication_day":"","publication_month":"","publication_year":2012},{"link":"https://www.goodreads.com/book/show/35510008-this-is-going-to-hurt","title":"This is Going to Hurt: Secret Diaries of a Junior Doctor","title_without_series":"This is Going to Hurt: Secret Diaries of a Junior Doctor","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"Welcome to the life of a junior doctor: 97-hour weeks, life and death decisions, a constant tsunami of bodily fluids, and the hospital parking meter earns more than you.<p>Scribbled in secret after endless days, sleepless nights and missed weekends, Adam Kay's <i>This is Going to Hurt</i> provides a no-holds-barred account of his time on the NHS front line. Hilarious, horrifying and heartbreaking, this diary is everything you wanted to know  and more than a few things you didn't  about life on and off the hospital ward.</p><p>\\n  <b>As seen on ITV's Zoe Ball Book Club </b>\\n</p><p>\\n  <b>This edition includes extra diary entries and a new afterword by the author.</b>\\n</p>","num_pages":285,"authors":{"author":{"id":17160706,"name":"Adam Kay","role":"","image_url":"https://images.gr-assets.com/authors/1594843517p5/17160706.jpg","small_image_url":"https://images.gr-assets.com/authors/1594843517p2/17160706.jpg","link":"https://www.goodreads.com/author/show/17160706.Adam_Kay","average_rating":4.3,"ratings_count":449222,"text_reviews_count":33570}},"average_rating":4.4,"ratings_count":332170,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/40876575-utopia-for-realists","title":"Utopia for Realists: How We Can Build the Ideal World","title_without_series":"Utopia for Realists: How We Can Build the Ideal World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX98_.jpg","description":"<b>Universal basic income. A 15-hour workweek. Open borders. Does it sound too good to be true? One of Europe's leading young thinkers shows how we can build an ideal world today.</b> <br /><br />After working all day at jobs we often dislike, we buy things we don't need. Rutger Bregman, a Dutch historian, reminds us it needn't be this wayand in some places it isn't. Rutger Bregman's TED Talk about universal basic income seemed impossibly radical when he delivered it in 2014. A quarter of a million views later, the subject of that video is being seriously considered by leading economists and government leaders the world over. It's just one of the many utopian ideas that Bregman proves is possible today. <br /><br /><i>Utopia for Realists</i> is one of those rare books that takes you by surprise and challenges what you think can happen. From a Canadian city that once completely eradicated poverty, to Richard Nixon's near implementation of a basic income for millions of Americans, Bregman takes us on a journey through history, and beyond the traditional left-right divides, as he champions ideas whose time have come. <br /><br />Every progressive milestone of civilizationfrom the end of slavery to the beginning of democracywas once considered a utopian fantasy. Bregman's book, both challenging and bracing, demonstrates that new utopian ideas, like the elimination of poverty and the creation of the fifteen-hour workweek, can become a reality in our lifetime. Being unrealistic and unreasonable can in fact make the impossible inevitable, and it is the only way to build the ideal world.","num_pages":262,"authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.21,"ratings_count":142058,"text_reviews_count":14509}},"average_rating":4.21,"ratings_count":43273,"publication_day":14,"publication_month":3,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/33805874-welkom-in-nederland","title":"Welkom in Nederland","title_without_series":"Welkom in Nederland","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1483717798l/33805874._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1483717798l/33805874._SX98_.jpg","description":"In Welkom in Nederland maken anderstaligen kennis met de Nederlandse maatschappij en kunnen ze zich voorbereiden op het onderdeel \\" Kennis van de Nederlandse Maatschappij \\" ( KNM ) van het inburgeringsexamen. ook wordt er geofend voor de onderdelen Lezen, Luisteren, Spreken, en Schrijven van het inburgeringsexamen op Niveau A2.","num_pages":236,"authors":{"author":{"id":16183819,"name":"Marilene Gathier","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/16183819.Marilene_Gathier","average_rating":4.14,"ratings_count":56,"text_reviews_count":16}},"average_rating":4.26,"ratings_count":31,"publication_day":"","publication_month":"","publication_year":2015},{"link":"https://www.goodreads.com/book/show/5982818-what-i-talk-about-when-i-talk-about-running","title":"What I Talk About When I Talk About Running","title_without_series":"What I Talk About When I Talk About Running","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"An intimate look at writing, running, and the incredible way they intersect, from the incomparable, bestselling author Haruki Murakami. While simply training for New York City Marathon would be enough for most people, Haruki Murakami's decided to write about it as well. The result is a beautiful memoir about his intertwined obsessions with running and writing, full of vivid memories and insights, including the eureka moment when he decided to become a writer. By turns funny and sobering, playful and philosophical, <b>What I Talk About When I Talk About Running</b><i> </i>is rich and revelatory, both for fans of this masterful yet guardedly private writer and for the exploding population of athletes who find similar satisfaction in athletic pursuit.","num_pages":190,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4260675,"text_reviews_count":366787}},"average_rating":3.87,"ratings_count":205308,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60190659-what-if-2","title":"What If? 2: Additional Serious Scientific Answers to Absurd Hypothetical Questions (What If?, #2)","title_without_series":"What If? 2: Additional Serious Scientific Answers to Absurd Hypothetical Questions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1643644004l/60190659._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1643644004l/60190659._SX98_.jpg","description":"The #1 New York Timesbestselling author of What If? and How To provides his best answers yet to the weirdest questions you never thought to ask.<br /><br />The millions of people around the world who read and loved What If? still have questions, and those questions are getting stranger. Thank goodness xkcd creator Randall Munroe is here to help. Planning to ride a fire pole from the moon back to Earth? The hardest part is sticking the landing. Hoping to cool the atmosphere by opening everyones freezer door at the same time? Maybe its time for a brief introduction to thermodynamics. Want to know what would happen if you rode a helicopter blade, built a billion-story building, made a lava lamp out of lava, or jumped on a geyser as it erupted? Okay, if you insist.<br /><br />Before you go on a cosmic road trip, feed the residents of New York City to a T. rex, or fill every church with bananas, be sure to consult this practical guide for impractical ideas. Unfazed by absurdity, Randall consults the latest research on everything from swing-set physics to airplane-catapult design to clearly and concisely answer his readers questions. As he consistently demonstrates, you can learn a lot from examining how the world might work in very specific extreme circumstances.<br /><br />Filled with bonkers science, boundless curiosity, and Randalls signature stick-figure comics, What If? 2 is sure to be another instant classic adored by inquisitive readers of all ages.","num_pages":354,"authors":{"author":{"id":3089156,"name":"Randall Munroe","role":"","image_url":"https://images.gr-assets.com/authors/1406058780p5/3089156.jpg","small_image_url":"https://images.gr-assets.com/authors/1406058780p2/3089156.jpg","link":"https://www.goodreads.com/author/show/3089156.Randall_Munroe","average_rating":4.16,"ratings_count":257477,"text_reviews_count":17775}},"average_rating":4.37,"ratings_count":17526,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/21413662-what-if","title":"What If?: Serious Scientific Answers to Absurd Hypothetical Questions","title_without_series":"What If?: Serious Scientific Answers to Absurd Hypothetical Questions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1451351509l/21413662._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1451351509l/21413662._SX98_.jpg","description":"Fans of the <i>xkcd</i> comic ask Munroe a lot of strange questions: What if you tried to hit a baseball pitched at 90 percent the speed of light? How fast can you hit a speed bump while driving and live? If there was a robot apocalypse, how long would humanity last? What if everyone only had one soulmate? What would happen if the moon went away?<br /><br />In pursuit of answers, Munroe runs computer simulations, pores over stacks of declassified military research memos, solves differential equations, and consults with nuclear reactor operators. His responses are masterpieces of clarity and hilarity, complemented by his signature <i>xkcd</i> comics. (They often predict the complete annihilation of humankind, or at least a really big explosion.)<br /><br />In celebration of 10 years of unusual insight, Randall Munroe has revised his classic blockbuster to ask what if? x 10. The result is 10x the adventure of scientific inquiry. Featuring brand-new 2-color annotations and illustrations, this special anniversary edition is far more than a book for geeks, <i>What If?</i> explains the laws of science in operation in a way that every intelligent reader will enjoy and feel much smarter for having read.","num_pages":303,"authors":{"author":{"id":3089156,"name":"Randall Munroe","role":"","image_url":"https://images.gr-assets.com/authors/1406058780p5/3089156.jpg","small_image_url":"https://images.gr-assets.com/authors/1406058780p2/3089156.jpg","link":"https://www.goodreads.com/author/show/3089156.Randall_Munroe","average_rating":4.16,"ratings_count":257477,"text_reviews_count":17775}},"average_rating":4.14,"ratings_count":196544,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26198872-when-to-rob-a-bank","title":"When to Rob a Bank: ...and 131 More Warped Suggestions and Well-Intended Rants  A Curated Collection of Witty, Off-Center Economics","title_without_series":"When to Rob a Bank: ...and 131 More Warped Suggestions and Well-Intended Rants  A Curated Collection of Witty, Off-Center Economics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459112898l/26198872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459112898l/26198872._SX98_.jpg","description":"In celebration of the 10th anniversary of the landmark book <em>Freakonomics </em>comes this curated collection from the most readable economics blog in the universe. Its the perfect solution for the millions of readers who love all things Freakonomics. Surprising and erudite, eloquent and witty,<em>When to Rob a Bank </em>demonstrates the brilliance that has made the Freakonomics guys an international sensation, with more than 7 million books sold in 40 languages, and 150 million downloads of their Freakonomics Radio podcast.","num_pages":"","authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1107926,"text_reviews_count":30849}},"average_rating":3.53,"ratings_count":15101,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50887097-why-fish-don-t-exist","title":"Why Fish Dont Exist: A Story of Loss, Love, and the Hidden Order of Life","title_without_series":"Why Fish Dont Exist: A Story of Loss, Love, and the Hidden Order of Life","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b>A wondrous debut from an extraordinary new voice in nonfiction, <i>Why Fish Dont Exist</i> is a dark and astonishing tale of love, chaos, scientific obsession, andpossiblyeven murder. </b><br /><br />David Starr Jordan was a taxonomist, a man possessed with bringing order to the natural world. In time, he would be credited with discovering nearly a <i>fifth</i> of the fish known to humans in his day. But the more of the hidden blueprint of life he uncovered, the harder the universe seemed to try to thwart him. His specimen collections were demolished by lightning, by fire, and eventually by the 1906 San Francisco earthquakewhich sent more than a thousand of his discoveries, housed in fragile glass jars, plummeting to the floor. In an instant, his lifes work was shattered.<br /> <br />Many might have given up, given in to despair. But Jordan? He surveyed the wreckage at his feet, found the first fish he recognized, and confidently began to rebuild his collection. And this time, he introduced one clever innovation that he believed would at last protect his work against the chaos of the world.<br /> <br />When NPR reporter Lulu Miller first heard this anecdote in passing, she took Jordan for a fool<b></b>a cautionary tale in hubris, or denial. But as her own life slowly unraveled, she began to wonder about him. Perhaps instead he was a model for how to go on when all seemed lost. What she would unearth about his life would transform her understanding of history, morality, and the world beneath her feet.<br /> <br />Part biography, part memoir, part scientific adventure, <i>Why Fish Dont Exist </i>reads like a fable about how to persevere in a world where chaos will always prevail.","num_pages":225,"authors":{"author":{"id":17168922,"name":"Lulu Miller","role":"","image_url":"https://images.gr-assets.com/authors/1603902452p5/17168922.jpg","small_image_url":"https://images.gr-assets.com/authors/1603902452p2/17168922.jpg","link":"https://www.goodreads.com/author/show/17168922.Lulu_Miller","average_rating":4.13,"ratings_count":57605,"text_reviews_count":9257}},"average_rating":4.13,"ratings_count":57090,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/12158480-why-nations-fail","title":"Why Nations Fail: The Origins of Power, Prosperity, and Poverty","title_without_series":"Why Nations Fail: The Origins of Power, Prosperity, and Poverty","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-1b903c9eac1b2ba789662c08a0ae41e6.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-675b3b2743c83e96e2540d2929d5f4d2.png","description":"<b><i>Brilliant and engagingly written,</i> Why Nations Fail <i>answers the question that has stumped the experts for centuries: Why are some nations rich and others poor, divided by wealth and poverty, health and sickness, food and famine? <br /><br /></i></b>Is it culture, the weather, geography? Perhaps ignorance of what the right policies are? <br /><br />Simply, no. None of these factors is either definitive or destiny. Otherwise, how to explain why Botswana has become one of the fastest growing countries in the world, while other African nations, such as Zimbabwe, the Congo, and Sierra Leone, are mired in poverty and violence? <br /><br />Daron Acemoglu and James Robinson conclusively show that it is man-made political and economic institutions that underlie economic success (or lack of it). Korea, to take just one of their fascinating examples, is a remarkably homogeneous nation, yet the people of North Korea are among the poorest on earth while their brothers and sisters in South Korea are among the richest. The south forged a society that created incentives, rewarded innovation, and allowed everyone to participate in economic opportunities. The economic success thus spurred was sustained because the government became accountable and responsive to citizens and the great mass of people. Sadly, the people of the north have endured decades of famine, political repression, and very different economic institutionswith no end in sight. The differences between the Koreas is due to the politics that created these completely different institutional trajectories. <br /><br />Based on fifteen years of original research Acemoglu and Robinson marshall extraordinary historical evidence from the Roman Empire, the Mayan city-states, medieval Venice, the Soviet Union, Latin America, England, Europe, the United States, and Africa to build a new theory of political economy with great relevance for the big questions of today, including: <br /><br /> - China has built an authoritarian growth machine. Will it continue to grow at such high speed andoverwhelm the West? <br /> - Are Americas best days behind it? Are we moving from a virtuous circle in which efforts by elites to aggrandize power are resisted to a vicious one that enriches and empowers a small minority? <br /> - What is the most effective way to help move billions of people from the rut of poverty to prosperity? More <br />philanthropy from the wealthy nations of the West? Or learning the hard-won lessons of Acemoglu and Robinsons breakthrough ideas on the interplay between inclusive political and economic institutions? <br /><br /><i>Why Nations Fail </i>will change the way you look atand understandthe world.","num_pages":529,"authors":{"author":{"id":12817,"name":"Daron Acemolu","role":"","image_url":"https://images.gr-assets.com/authors/1354435300p5/12817.jpg","small_image_url":"https://images.gr-assets.com/authors/1354435300p2/12817.jpg","link":"https://www.goodreads.com/author/show/12817.Daron_Acemo_lu","average_rating":4.09,"ratings_count":70479,"text_reviews_count":6721}},"average_rating":4.09,"ratings_count":63584,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/34466963-why-we-sleep","title":"Why We Sleep: Unlocking the Power of Sleep and Dreams","title_without_series":"Why We Sleep: Unlocking the Power of Sleep and Dreams","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1556604137l/34466963._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1556604137l/34466963._SX98_.jpg","description":"<i>Alternate cover edition of <a href=\\"https://www.goodreads.com/book/show/40781394-why-we-sleep\\" rel=\\"nofollow noopener\\">ISBN 9781501144318</a>.</i><br /><br />Neuroscientist and sleep expert Matthew Walker provides a revolutionary exploration of sleep, examining how it affects every aspect of our physical and mental well-being. Charting the most cutting-edge scientific breakthroughs, and marshalling his decades of research and clinical practice, Walker explains how we can harness sleep to improve learning, mood and energy levels, regulate hormones, prevent cancer, Alzheimer's and diabetes, slow the effects of aging, and increase longevity. He also provides actionable steps towards getting a better night's sleep every night.","num_pages":368,"authors":{"author":{"id":17598726,"name":"Matthew Walker","role":"","image_url":"https://images.gr-assets.com/authors/1537277808p5/17598726.jpg","small_image_url":"https://images.gr-assets.com/authors/1537277808p2/17598726.jpg","link":"https://www.goodreads.com/author/show/17598726.Matthew_Walker","average_rating":4.37,"ratings_count":226114,"text_reviews_count":22329}},"average_rating":4.37,"ratings_count":228376,"publication_day":3,"publication_month":10,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/44678031-yearbook","title":"Yearbook","title_without_series":"Yearbook","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1617146646l/44678031._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1617146646l/44678031._SX98_.jpg","description":"Hi! Im Seth! I was asked to describe my book, Yearbook, for the inside flap (which is a gross phrase) and for websites and shit like that, so here it goes!!!<br /> <br />Yearbook is a collection of true stories that I desperately hope are just funny at worst, and life-changingly amazing at best. (I understand that its likely the former, which is a fancy book way of saying the first one.) <br /> <br />I talk about my grandparents, doing stand-up comedy as a teenager, bar mitzvahs, and Jewish summer camp, and tell way more stories about doing drugs than my mother would like. I also talk about some of my adventures in Los Angeles, and surely say things about other famous people that will create a wildly awkward conversation for me at a party one day.<br /> <br />I hope you enjoy the book should you buy it, and if you dont enjoy it, Im sorry. If you ever see me on the street and explain the situation, Ill do my best to make it up to you.","num_pages":260,"authors":{"author":{"id":1307435,"name":"Seth Rogen","role":"","image_url":"https://images.gr-assets.com/authors/1614010346p5/1307435.jpg","small_image_url":"https://images.gr-assets.com/authors/1614010346p2/1307435.jpg","link":"https://www.goodreads.com/author/show/1307435.Seth_Rogen","average_rating":4.15,"ratings_count":80805,"text_reviews_count":9541}},"average_rating":4.15,"ratings_count":83163,"publication_day":11,"publication_month":5,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/18050143-zero-to-one","title":"Zero to One: Notes on Startups, or How to Build the Future","title_without_series":"Zero to One: Notes on Startups, or How to Build the Future","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630663027l/18050143._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630663027l/18050143._SX98_.jpg","description":"If you want to build a better future, you must believe in secrets.<br /><br />The great secret of our time is that there are still uncharted frontiers to explore and new inventions to create. In Zero to One, legendary entrepreneur and investor Peter Thiel shows how we can find singular ways to create those new things. <br /><br />Thiel begins with the contrarian premise that we live in an age of technological stagnation, even if were too distracted by shiny mobile devices to notice. Information technology has improved rapidly, but there is no reason why progress should be limited to computers or Silicon Valley. Progress can be achieved in any industry or area of business. It comes from the most important skill that every leader must master: learning to think for yourself.<br /><br />Doing what someone else already knows how to do takes the world from 1 to n, adding more of something familiar. But when you do something new, you go from 0 to 1. The next Bill Gates will not build an operating system. The next Larry Page or Sergey Brin wont make a search engine. Tomorrows champions will not win by competing ruthlessly in todays marketplace. They will escape competition altogether, because their businesses will be unique. <br /><br />Zero to One presents at once an optimistic view of the future of progress in America and a new way of thinking about innovation: it starts by learning to ask the questions that lead you to find value in unexpected places.","num_pages":195,"authors":{"author":{"id":8474721,"name":"Peter Thiel","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/8474721.Peter_Thiel","average_rating":4.15,"ratings_count":404805,"text_reviews_count":10414}},"average_rating":4.15,"ratings_count":401372,"publication_day":"","publication_month":"","publication_year":""}]`),OK=()=>ne.jsx("div",{className:"suspenseFallback",children:"Loading..."});var Ko={},Vh={},Kk;function LK(){if(Kk)return Vh;Kk=1,Object.defineProperty(Vh,"__esModule",{value:!0}),Vh.on=n,Vh.off=e;function n(t,r,i,o){o=o||!1,t.addEventListener?t.addEventListener(r,i,o):t.attachEvent&&t.attachEvent("on"+r,function(a){i.call(t,a||window.event)})}function e(t,r,i,o){o=o||!1,t.removeEventListener?t.removeEventListener(r,i,o):t.detachEvent&&t.detachEvent("on"+r,i)}return Vh}var $p={},Jk;function BK(){return Jk||(Jk=1,Object.defineProperty($p,"__esModule",{value:!0}),$p.default=function(n){if(!(n instanceof HTMLElement))return document.documentElement;for(var e=n.style.position==="absolute",t=/(scroll|auto)/,r=n;r;){if(!r.parentNode)return n.ownerDocument||document.documentElement;var i=window.getComputedStyle(r),o=i.position,a=i.overflow,s=i["overflow-x"],u=i["overflow-y"];if(o==="static"&&e){r=r.parentNode;continue}if(t.test(a)&&t.test(s)&&t.test(u))return r;r=r.parentNode}return n.ownerDocument||n.documentElement||document.documentElement}),$p}var Xp={},Qk;function UK(){if(Qk)return Xp;Qk=1,Object.defineProperty(Xp,"__esModule",{value:!0}),Xp.default=n;function n(e,t,r){var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=function c(){var h=+new Date-s;h<t&&h>=0?i=setTimeout(c,t-h):(i=null,r||(u=e.apply(a,o),i||(a=null,o=null)))};return function(){a=this,o=arguments,s=+new Date;var h=r&&!i;return i||(i=setTimeout(l,t)),h&&(u=e.apply(a,o),a=null,o=null),u}}return Xp}var Yp={},Zk;function zK(){if(Zk)return Yp;Zk=1,Object.defineProperty(Yp,"__esModule",{value:!0}),Yp.default=n;function n(e,t,r){t||(t=250);var i,o;return function(){var a=r||this,s=+new Date,u=arguments;i&&s<i+t?(clearTimeout(o),o=setTimeout(function(){i=s,e.apply(a,u)},t)):(i=s,e.apply(a,u))}}return Yp}var eC;function WK(){if(eC)return Ko;eC=1,Object.defineProperty(Ko,"__esModule",{value:!0}),Ko.forceVisible=Ko.forceCheck=Ko.lazyload=void 0;var n=(function(){function H(W,z){for(var q=0;q<z.length;q++){var re=z[q];re.enumerable=re.enumerable||!1,re.configurable=!0,"value"in re&&(re.writable=!0),Object.defineProperty(W,re.key,re)}}return function(W,z,q){return z&&H(W.prototype,z),q&&H(W,q),W}})(),e=qc(),t=f(e),r=Ym(),i=f(r),o=LK(),a=BK(),s=f(a),u=UK(),l=f(u),c=zK(),h=f(c);function f(H){return H&&H.__esModule?H:{default:H}}function m(H,W){if(!(H instanceof W))throw new TypeError("Cannot call a class as a function")}function g(H,W){if(!H)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W&&(typeof W=="object"||typeof W=="function")?W:H}function w(H,W){if(typeof W!="function"&&W!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof W);H.prototype=Object.create(W&&W.prototype,{constructor:{value:H,enumerable:!1,writable:!0,configurable:!0}}),W&&(Object.setPrototypeOf?Object.setPrototypeOf(H,W):H.__proto__=W)}var v={top:0,left:0,width:0,height:0},y="data-lazyload-listened",x=[],E=[],_=!1;try{var k=Object.defineProperty({},"passive",{get:function(){_=!0}});window.addEventListener("test",null,k)}catch{}var C=_?{capture:!1,passive:!0}:!1,A=function(W,z){var q=W.ref,re=void 0,de=void 0,ye=void 0,te=void 0;try{var ie=z.getBoundingClientRect();re=ie.top,de=ie.left,ye=ie.height,te=ie.width}catch{re=v.top,de=v.left,ye=v.height,te=v.width}var fe=window.innerHeight||document.documentElement.clientHeight,Re=window.innerWidth||document.documentElement.clientWidth,De=Math.max(re,0),Be=Math.max(de,0),lt=Math.min(fe,re+ye)-De,Y=Math.min(Re,de+te)-Be,ot=void 0,Ke=void 0,Xe=void 0,qe=void 0;try{var Tt=q.getBoundingClientRect();ot=Tt.top,Ke=Tt.left,Xe=Tt.height,qe=Tt.width}catch{ot=v.top,Ke=v.left,Xe=v.height,qe=v.width}var Qe=ot-De,ft=Ke-Be,Mt=Array.isArray(W.props.offset)?W.props.offset:[W.props.offset,W.props.offset];return Qe-Mt[0]<=lt&&Qe+Xe+Mt[1]>=0&&ft-Mt[0]<=Y&&ft+qe+Mt[1]>=0},I=function(W){var z=W.ref;if(!(z.offsetWidth||z.offsetHeight||z.getClientRects().length))return!1;var q=void 0,re=void 0;try{var de=z.getBoundingClientRect();q=de.top,re=de.height}catch{q=v.top,re=v.height}var ye=window.innerHeight||document.documentElement.clientHeight,te=Array.isArray(W.props.offset)?W.props.offset:[W.props.offset,W.props.offset];return q-te[0]<=ye&&q+re+te[1]>=0},T=function(W){var z=W.ref;if(z instanceof HTMLElement){var q=(0,s.default)(z),re=W.props.overflow&&q!==z.ownerDocument&&q!==document&&q!==document.documentElement,de=re?A(W,q):I(W);de?W.visible||(W.props.once&&E.push(W),W.visible=!0,W.forceUpdate()):W.props.once&&W.visible||(W.visible=!1,W.props.unmountIfInvisible&&W.forceUpdate())}},R=function(){E.forEach(function(W){var z=x.indexOf(W);z!==-1&&x.splice(z,1)}),E=[]},N=function(){for(var W=0;W<x.length;++W){var z=x[W];T(z)}R()},O=function(){for(var W=0;W<x.length;++W){var z=x[W];z.visible=!0,z.forceUpdate()}R()},V=void 0,F=null,B=function(W){return typeof W=="string"},U=(function(H){w(W,H);function W(z){m(this,W);var q=g(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,z));return q.visible=!1,q.setRef=q.setRef.bind(q),q}return n(W,[{key:"componentDidMount",value:function(){var q=window,re=this.props.scrollContainer;re&&B(re)&&(q=q.document.querySelector(re));var de=this.props.debounce!==void 0&&V==="throttle"||V==="debounce"&&this.props.debounce===void 0;if(de&&((0,o.off)(q,"scroll",F,C),(0,o.off)(window,"resize",F,C),F=null),F||(this.props.debounce!==void 0?(F=(0,l.default)(N,typeof this.props.debounce=="number"?this.props.debounce:300),V="debounce"):this.props.throttle!==void 0?(F=(0,h.default)(N,typeof this.props.throttle=="number"?this.props.throttle:300),V="throttle"):F=N),this.props.overflow){var ye=(0,s.default)(this.ref);if(ye&&typeof ye.getAttribute=="function"){var te=1+ +ye.getAttribute(y);te===1&&ye.addEventListener("scroll",F,C),ye.setAttribute(y,te)}}else if(x.length===0||de){var ie=this.props,fe=ie.scroll,Re=ie.resize;fe&&(0,o.on)(q,"scroll",F,C),Re&&(0,o.on)(window,"resize",F,C)}x.push(this),T(this)}},{key:"shouldComponentUpdate",value:function(){return this.visible}},{key:"componentWillUnmount",value:function(){if(this.props.overflow){var q=(0,s.default)(this.ref);if(q&&typeof q.getAttribute=="function"){var re=+q.getAttribute(y)-1;re===0?(q.removeEventListener("scroll",F,C),q.removeAttribute(y)):q.setAttribute(y,re)}}var de=x.indexOf(this);de!==-1&&x.splice(de,1),x.length===0&&typeof window<"u"&&((0,o.off)(window,"resize",F,C),(0,o.off)(window,"scroll",F,C))}},{key:"setRef",value:function(q){q&&(this.ref=q)}},{key:"render",value:function(){var q=this.props,re=q.height,de=q.children,ye=q.placeholder,te=q.className,ie=q.classNamePrefix,fe=q.style;return t.default.createElement("div",{className:ie+"-wrapper "+te,ref:this.setRef,style:fe},this.visible?de:ye||t.default.createElement("div",{style:{height:re},className:ie+"-placeholder"}))}}]),W})(e.Component);U.propTypes={className:i.default.string,classNamePrefix:i.default.string,once:i.default.bool,height:i.default.oneOfType([i.default.number,i.default.string]),offset:i.default.oneOfType([i.default.number,i.default.arrayOf(i.default.number)]),overflow:i.default.bool,resize:i.default.bool,scroll:i.default.bool,children:i.default.node,throttle:i.default.oneOfType([i.default.number,i.default.bool]),debounce:i.default.oneOfType([i.default.number,i.default.bool]),placeholder:i.default.node,scrollContainer:i.default.oneOfType([i.default.string,i.default.object]),unmountIfInvisible:i.default.bool,style:i.default.object},U.defaultProps={className:"",classNamePrefix:"lazyload",once:!1,offset:0,overflow:!1,resize:!1,scroll:!0,unmountIfInvisible:!1};var P=function(W){return W.displayName||W.name||"Component"},L=function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(q){return(function(re){w(de,re);function de(){m(this,de);var ye=g(this,(de.__proto__||Object.getPrototypeOf(de)).call(this));return ye.displayName="LazyLoad"+P(q),ye}return n(de,[{key:"render",value:function(){return t.default.createElement(U,W,t.default.createElement(q,this.props))}}]),de})(e.Component)}};return Ko.lazyload=L,Ko.default=U,Ko.forceCheck=N,Ko.forceVisible=O,Ko}var HK=WK();const GK=tu(HK),VK={backgroundColor:"#eee",cursor:"pointer",overflow:"hidden",position:"relative",width:"100%",height:"100%"},jK={transition:"transform .135s cubic-bezier(0.0,0.0,0.2,1),opacity linear .15s",display:"block",width:"100%",height:"100%"},qK=({imageProps:n,wrapperStyle:e,onClick:t})=>ne.jsx("div",{style:{...VK,...e},className:"lazy-image",onClick:t,children:ne.jsx(GK,{offset:200,once:!0,children:ne.jsx("img",{...n,style:{...jK,...n?.style||{}},alt:n?.alt||""})})}),$K=Ze.lazy(()=>UY(()=>import("./index-DgUaBfm-.js"),[])),XK=()=>{const[n,e]=Ze.useState(!1),[t,r]=Ze.useState(0),[i,o]=Ze.useState(window.innerWidth),a=()=>{o(window.innerWidth)};Ze.useEffect(()=>(window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)),[]);const s=h=>{e(!0),r(h)},u=()=>{e(!1)},l=()=>i>=1200?6:i>=960?5:i>=720?4:i>=480?3:2,c=h=>h===0?ne.jsxs(Ze.Suspense,{fallback:ne.jsx(OK,{}),children:[ne.jsxs("div",{className:"modalHeader",children:[ne.jsx("h2",{children:"Read Books"}),ne.jsx("button",{className:"closeButton",onClick:u,"aria-label":"Close modal",children:ne.jsx(OY,{})})]}),ne.jsx("div",{className:"bookShelf",children:ne.jsx($K,{books:FK,margin:10,columns:i>600?l()+1:l()})})]}):null;return ne.jsxs("div",{children:[ne.jsx(NK,{layout:"masonry",photos:PK.map((h,f)=>({...h,src:h.image_url.replace(/_SX98_./g,""),width:98,height:148,alt:h.title,key:f.toString()})),onClick:({photo:h})=>{console.log(h),window.open(h.link,"_blank")},columns:l(),spacing:10,render:{image:h=>ne.jsx(qK,{imageProps:h})}}),ne.jsxs("div",{className:"bookActions",children:[ne.jsxs("span",{className:"books_link",onClick:()=>s(0),children:[ne.jsx(Fk,{})," More Books"]}),ne.jsxs("span",{className:"books_link",onClick:()=>window.open("https://rpidanny.github.io/goodreads-explorer/user/88517742/viz/stats","_blank"),children:[ne.jsx(Fk,{})," Explore Books"]})]}),ne.jsx(KY,{isOpen:n,onRequestClose:u,className:"booksModal",overlayClassName:"ModalOverlay",contentLabel:"Books",ariaHideApp:!1,closeTimeoutMS:300,children:ne.jsx("div",{className:"bookModalContent",children:c(t)})})]})},YK=()=>ne.jsx(Do.Fragment,{children:ne.jsxs("section",{className:"interests-section",id:"interests",children:[ne.jsx("div",{className:"interests-header",children:ne.jsxs("div",{className:"header-content",children:[ne.jsx("div",{className:"subtitle",children:"What I Love"}),ne.jsx("h2",{children:"Interests"})]})}),ne.jsx("div",{className:"interests-container",children:ne.jsx("div",{className:"content",children:ne.jsx("div",{className:"row",children:ne.jsxs("div",{className:"col-md-12",children:[ne.jsxs("div",{className:"inner-title",children:[ne.jsxs("h3",{children:[ne.jsx(DY,{})," Books"]}),ne.jsx("p",{children:"Some of my favorite books"})]}),ne.jsx(XK,{})]})})})})]})}),KK="/assets/CCP-CpRSmDsF.png",JK="/assets/CDVA-Djr2m9mK.png",QK="/assets/CSAA-CfqLXySg.png",ZK="/assets/CSOA-D2_fgxH1.png",eJ={"CCP.png":KK,"CDVA.png":JK,"CSAA.png":QK,"CSOA.png":ZK},tJ=({certifications:n})=>ne.jsxs("div",{children:[ne.jsx("div",{className:"inner-title",children:ne.jsx("h3",{children:"Certifications"})}),ne.jsx("div",{className:"inner-content certifications",children:ne.jsx("div",{className:"row gy-4 justify-content-center",children:n.map((e,t)=>ne.jsx("div",{className:"col-6 col-md-auto certification",children:ne.jsx("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",children:ne.jsx("img",{src:eJ[e.image]||"",alt:e.title})})},t))})})]}),nJ=({data:n})=>{const{institution:e,startDate:t,endDate:r,studyType:i,area:o}=n,a=s=>s.split("-")[0];return ne.jsx("div",{className:"col-md-6",children:ne.jsxs("div",{className:"work-item",children:[ne.jsx(FY,{}),ne.jsxs("div",{className:"work-desc",children:[ne.jsx("h4",{children:e}),ne.jsxs("h6",{children:[a(t)," - ",a(r)]}),ne.jsxs("p",{children:[i," : ",o]})]})]})})},rJ=(n,e)=>{const t=n.slice(),r=[];for(;t.length;)r.push(t.splice(0,e));return r},iJ=({institutions:n})=>{const e=rJ(n,2);return ne.jsxs("div",{children:[ne.jsxs("div",{className:"inner-title",children:[ne.jsx("h3",{children:"Education"}),ne.jsx("p",{children:"The studies which partially made the engineer that I am now."})]}),ne.jsx("div",{className:"inner-content",children:e.map((t,r)=>ne.jsx("div",{className:"row",children:t.map((i,o)=>ne.jsx(nJ,{data:i},o))},r))})]})},oJ=({data:n,index:e})=>{const{title:t,description:r,url:i,github:o,image:a,tags:s}=n;return ne.jsxs("div",{className:"project-card","data-index":e,children:[ne.jsx("div",{className:"project-image-container",children:ne.jsx("div",{className:"project-image-placeholder",children:a?ne.jsxs(ne.Fragment,{children:[ne.jsx("img",{src:a,alt:t,className:"project-image"}),ne.jsx("div",{className:"project-image-overlay-with-image"})]}):ne.jsx("div",{className:"project-image-overlay",children:ne.jsxs("span",{className:"project-number",children:["0",e+1]})})})}),ne.jsxs("div",{className:"project-content",children:[ne.jsxs("div",{className:"project-header",children:[ne.jsx("h3",{className:"project-title",children:t}),ne.jsxs("div",{className:"project-links",children:[o&&ne.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"project-link","aria-label":"View on GitHub",children:ne.jsx(IY,{})}),ne.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"project-link","aria-label":"Visit project",children:ne.jsx(PY,{})})]})]}),ne.jsx("p",{className:"project-description",children:r}),ne.jsx("div",{className:"project-tags",children:s.map((u,l)=>ne.jsx("span",{className:"project-tag",children:u},l))})]})]})},aJ=({projects:n})=>ne.jsxs("div",{className:"projects-section",children:[ne.jsxs("div",{className:"inner-title",children:[ne.jsx("h3",{children:"Personal Projects"}),ne.jsx("p",{children:"Passion projects that solve real-world problems and help me learn new skills."})]}),ne.jsx("div",{className:"inner-content",children:ne.jsx("div",{className:"projects-grid",children:n.map((e,t)=>ne.jsx(oJ,{data:e,index:t},t))})})]}),sJ=({children:n,className:e=""})=>ne.jsx("div",{className:`vertical-timeline ${e}`,children:n}),uJ=({children:n,className:e=""})=>ne.jsx("div",{className:`vertical-timeline-element ${e}`,children:ne.jsx("div",{className:"vertical-timeline-element-content",children:n})}),lJ=({data:n})=>{const{company:e,startDate:t,endDate:r,position:i,summary:o,website:a}=n;return ne.jsx(uJ,{iconStyle:{display:"none"},children:ne.jsxs("div",{className:"work-item",children:[ne.jsx("div",{className:"work-ico",children:ne.jsx(NY,{})}),ne.jsxs("div",{className:"work-desc",children:[ne.jsx("h4",{children:ne.jsx("a",{href:a,className:"no-underline",children:e})}),ne.jsx("h5",{children:i}),ne.jsxs("h6",{children:[t," - ",r]}),ne.jsx("p",{children:o})]})]})})},cJ=({companies:n})=>ne.jsxs("div",{children:[ne.jsxs("div",{className:"inner-title",children:[ne.jsx("h3",{children:"Experience"}),ne.jsx("p",{children:"What I did in the past and what I am doing now."})]}),ne.jsx("div",{className:"inner-content",children:ne.jsx(sJ,{children:n.map((e,t)=>ne.jsx(lJ,{data:e},t))})})]}),hJ=({education:n,work:e,certifications:t,projects:r})=>ne.jsxs("section",{className:"resume-section",id:"resume",children:[ne.jsx("div",{className:"resume-header",children:ne.jsxs("div",{className:"header-content",children:[ne.jsx("div",{className:"subtitle",children:"My Journey"}),ne.jsx("h2",{children:"Resume"})]})}),ne.jsx("div",{className:"resume-container",children:ne.jsxs("div",{className:"resume-content",children:[r&&r.length>0&&ne.jsx("div",{className:"resume-block",children:ne.jsx(aJ,{projects:r})}),ne.jsx("div",{className:"resume-block",children:ne.jsx(cJ,{companies:e})}),ne.jsx("div",{className:"resume-block",children:ne.jsx(iJ,{institutions:n})}),t&&ne.jsx("div",{className:"resume-block",children:ne.jsx(tJ,{certifications:t})})]})})]}),dJ="https://ptdwwoy2xc.execute-api.us-east-1.amazonaws.com/prod/quotes/random";rC.initialize("UA-76263604-1",{testMode:!1});const fJ=()=>{const[n,e]=Ze.useState({quote:"People who are really serious about software should make their own hardware",author:"Alan Kay"});Ze.useEffect(()=>{rC.send({hitType:"pageview",page:window.location.pathname+window.location.search}),(async()=>{try{const c=await(await fetch(dJ)).json();c&&c.quote&&c.author&&e(c)}catch(l){console.error("Error fetching quote:",l)}})()},[]);const{basics:t,education:r,work:i,interests:o,certifications:a,projects:s}=fI;return ne.jsxs("div",{className:"App",children:[ne.jsx(SY,{data:t}),ne.jsx(hJ,{education:r,work:i,certifications:a,projects:s}),ne.jsx(YK,{data:o}),ne.jsx(VI,{email:t.email}),ne.jsx(pI,{quote:n})]})},tC=document.getElementById("root");tC&&tI.createRoot(tC).render(ne.jsx(fJ,{}));export{qK as L,NK as P,ne as j};
