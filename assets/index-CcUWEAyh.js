(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();function iu(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function tI(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){var i=!1;try{i=this instanceof n}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var i=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return r[n]}})}),t}var ey={exports:{}},Dh={},ty={exports:{}},en={};var k2;function nI(){if(k2)return en;k2=1;var r=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),a=Symbol.for("react.context"),s=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),l=Symbol.for("react.memo"),c=Symbol.for("react.lazy"),h=Symbol.iterator;function f(z){return z===null||typeof z!="object"?null:(z=h&&z[h]||z["@@iterator"],typeof z=="function"?z:null)}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,w={};function v(z,q,re){this.props=z,this.context=q,this.refs=w,this.updater=re||m}v.prototype.isReactComponent={},v.prototype.setState=function(z,q){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,q,"setState")},v.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function y(){}y.prototype=v.prototype;function x(z,q,re){this.props=z,this.context=q,this.refs=w,this.updater=re||m}var E=x.prototype=new y;E.constructor=x,g(E,v.prototype),E.isPureReactComponent=!0;var _=Array.isArray,k=Object.prototype.hasOwnProperty,C={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function I(z,q,re){var de,ye={},ne=null,ie=null;if(q!=null)for(de in q.ref!==void 0&&(ie=q.ref),q.key!==void 0&&(ne=""+q.key),q)k.call(q,de)&&!R.hasOwnProperty(de)&&(ye[de]=q[de]);var fe=arguments.length-2;if(fe===1)ye.children=re;else if(1<fe){for(var Ae=Array(fe),De=0;De<fe;De++)Ae[De]=arguments[De+2];ye.children=Ae}if(z&&z.defaultProps)for(de in fe=z.defaultProps,fe)ye[de]===void 0&&(ye[de]=fe[de]);return{$$typeof:r,type:z,key:ne,ref:ie,props:ye,_owner:C.current}}function T(z,q){return{$$typeof:r,type:z.type,key:q,ref:z.ref,props:z.props,_owner:z._owner}}function A(z){return typeof z=="object"&&z!==null&&z.$$typeof===r}function N(z){var q={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(re){return q[re]})}var O=/\/+/g;function V(z,q){return typeof z=="object"&&z!==null&&z.key!=null?N(""+z.key):q.toString(36)}function F(z,q,re,de,ye){var ne=typeof z;(ne==="undefined"||ne==="boolean")&&(z=null);var ie=!1;if(z===null)ie=!0;else switch(ne){case"string":case"number":ie=!0;break;case"object":switch(z.$$typeof){case r:case e:ie=!0}}if(ie)return ie=z,ye=ye(ie),z=de===""?"."+V(ie,0):de,_(ye)?(re="",z!=null&&(re=z.replace(O,"$&/")+"/"),F(ye,q,re,"",function(De){return De})):ye!=null&&(A(ye)&&(ye=T(ye,re+(!ye.key||ie&&ie.key===ye.key?"":(""+ye.key).replace(O,"$&/")+"/")+z)),q.push(ye)),1;if(ie=0,de=de===""?".":de+":",_(z))for(var fe=0;fe<z.length;fe++){ne=z[fe];var Ae=de+V(ne,fe);ie+=F(ne,q,re,Ae,ye)}else if(Ae=f(z),typeof Ae=="function")for(z=Ae.call(z),fe=0;!(ne=z.next()).done;)ne=ne.value,Ae=de+V(ne,fe++),ie+=F(ne,q,re,Ae,ye);else if(ne==="object")throw q=String(z),Error("Objects are not valid as a React child (found: "+(q==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":q)+"). If you meant to render a collection of children, use an array instead.");return ie}function B(z,q,re){if(z==null)return z;var de=[],ye=0;return F(z,de,"","",function(ne){return q.call(re,ne,ye++)}),de}function U(z){if(z._status===-1){var q=z._result;q=q(),q.then(function(re){(z._status===0||z._status===-1)&&(z._status=1,z._result=re)},function(re){(z._status===0||z._status===-1)&&(z._status=2,z._result=re)}),z._status===-1&&(z._status=0,z._result=q)}if(z._status===1)return z._result.default;throw z._result}var P={current:null},L={transition:null},H={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:L,ReactCurrentOwner:C};function W(){throw Error("act(...) is not supported in production builds of React.")}return en.Children={map:B,forEach:function(z,q,re){B(z,function(){q.apply(this,arguments)},re)},count:function(z){var q=0;return B(z,function(){q++}),q},toArray:function(z){return B(z,function(q){return q})||[]},only:function(z){if(!A(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},en.Component=v,en.Fragment=t,en.Profiler=i,en.PureComponent=x,en.StrictMode=n,en.Suspense=u,en.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,en.act=W,en.cloneElement=function(z,q,re){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var de=g({},z.props),ye=z.key,ne=z.ref,ie=z._owner;if(q!=null){if(q.ref!==void 0&&(ne=q.ref,ie=C.current),q.key!==void 0&&(ye=""+q.key),z.type&&z.type.defaultProps)var fe=z.type.defaultProps;for(Ae in q)k.call(q,Ae)&&!R.hasOwnProperty(Ae)&&(de[Ae]=q[Ae]===void 0&&fe!==void 0?fe[Ae]:q[Ae])}var Ae=arguments.length-2;if(Ae===1)de.children=re;else if(1<Ae){fe=Array(Ae);for(var De=0;De<Ae;De++)fe[De]=arguments[De+2];de.children=fe}return{$$typeof:r,type:z.type,key:ye,ref:ne,props:de,_owner:ie}},en.createContext=function(z){return z={$$typeof:a,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:o,_context:z},z.Consumer=z},en.createElement=I,en.createFactory=function(z){var q=I.bind(null,z);return q.type=z,q},en.createRef=function(){return{current:null}},en.forwardRef=function(z){return{$$typeof:s,render:z}},en.isValidElement=A,en.lazy=function(z){return{$$typeof:c,_payload:{_status:-1,_result:z},_init:U}},en.memo=function(z,q){return{$$typeof:l,type:z,compare:q===void 0?null:q}},en.startTransition=function(z){var q=L.transition;L.transition={};try{z()}finally{L.transition=q}},en.unstable_act=W,en.useCallback=function(z,q){return P.current.useCallback(z,q)},en.useContext=function(z){return P.current.useContext(z)},en.useDebugValue=function(){},en.useDeferredValue=function(z){return P.current.useDeferredValue(z)},en.useEffect=function(z,q){return P.current.useEffect(z,q)},en.useId=function(){return P.current.useId()},en.useImperativeHandle=function(z,q,re){return P.current.useImperativeHandle(z,q,re)},en.useInsertionEffect=function(z,q){return P.current.useInsertionEffect(z,q)},en.useLayoutEffect=function(z,q){return P.current.useLayoutEffect(z,q)},en.useMemo=function(z,q){return P.current.useMemo(z,q)},en.useReducer=function(z,q,re){return P.current.useReducer(z,q,re)},en.useRef=function(z){return P.current.useRef(z)},en.useState=function(z){return P.current.useState(z)},en.useSyncExternalStore=function(z,q,re){return P.current.useSyncExternalStore(z,q,re)},en.useTransition=function(){return P.current.useTransition()},en.version="18.3.1",en}var C2;function $c(){return C2||(C2=1,ty.exports=nI()),ty.exports}var T2;function rI(){if(T2)return Dh;T2=1;var r=$c(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,i=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function a(s,u,l){var c,h={},f=null,m=null;l!==void 0&&(f=""+l),u.key!==void 0&&(f=""+u.key),u.ref!==void 0&&(m=u.ref);for(c in u)n.call(u,c)&&!o.hasOwnProperty(c)&&(h[c]=u[c]);if(s&&s.defaultProps)for(c in u=s.defaultProps,u)h[c]===void 0&&(h[c]=u[c]);return{$$typeof:e,type:s,key:f,ref:m,props:h,_owner:i.current}}return Dh.Fragment=t,Dh.jsx=a,Dh.jsxs=a,Dh}var M2;function iI(){return M2||(M2=1,ey.exports=rI()),ey.exports}var Q=iI(),Vf={},ny={exports:{}},hi={},ry={exports:{}},iy={};var A2;function oI(){return A2||(A2=1,(function(r){function e(L,H){var W=L.length;L.push(H);e:for(;0<W;){var z=W-1>>>1,q=L[z];if(0<i(q,H))L[z]=H,L[W]=q,W=z;else break e}}function t(L){return L.length===0?null:L[0]}function n(L){if(L.length===0)return null;var H=L[0],W=L.pop();if(W!==H){L[0]=W;e:for(var z=0,q=L.length,re=q>>>1;z<re;){var de=2*(z+1)-1,ye=L[de],ne=de+1,ie=L[ne];if(0>i(ye,W))ne<q&&0>i(ie,ye)?(L[z]=ie,L[ne]=W,z=ne):(L[z]=ye,L[de]=W,z=de);else if(ne<q&&0>i(ie,W))L[z]=ie,L[ne]=W,z=ne;else break e}}return H}function i(L,H){var W=L.sortIndex-H.sortIndex;return W!==0?W:L.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;r.unstable_now=function(){return o.now()}}else{var a=Date,s=a.now();r.unstable_now=function(){return a.now()-s}}var u=[],l=[],c=1,h=null,f=3,m=!1,g=!1,w=!1,v=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function E(L){for(var H=t(l);H!==null;){if(H.callback===null)n(l);else if(H.startTime<=L)n(l),H.sortIndex=H.expirationTime,e(u,H);else break;H=t(l)}}function _(L){if(w=!1,E(L),!g)if(t(u)!==null)g=!0,U(k);else{var H=t(l);H!==null&&P(_,H.startTime-L)}}function k(L,H){g=!1,w&&(w=!1,y(I),I=-1),m=!0;var W=f;try{for(E(H),h=t(u);h!==null&&(!(h.expirationTime>H)||L&&!N());){var z=h.callback;if(typeof z=="function"){h.callback=null,f=h.priorityLevel;var q=z(h.expirationTime<=H);H=r.unstable_now(),typeof q=="function"?h.callback=q:h===t(u)&&n(u),E(H)}else n(u);h=t(u)}if(h!==null)var re=!0;else{var de=t(l);de!==null&&P(_,de.startTime-H),re=!1}return re}finally{h=null,f=W,m=!1}}var C=!1,R=null,I=-1,T=5,A=-1;function N(){return!(r.unstable_now()-A<T)}function O(){if(R!==null){var L=r.unstable_now();A=L;var H=!0;try{H=R(!0,L)}finally{H?V():(C=!1,R=null)}}else C=!1}var V;if(typeof x=="function")V=function(){x(O)};else if(typeof MessageChannel<"u"){var F=new MessageChannel,B=F.port2;F.port1.onmessage=O,V=function(){B.postMessage(null)}}else V=function(){v(O,0)};function U(L){R=L,C||(C=!0,V())}function P(L,H){I=v(function(){L(r.unstable_now())},H)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(L){L.callback=null},r.unstable_continueExecution=function(){g||m||(g=!0,U(k))},r.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):T=0<L?Math.floor(1e3/L):5},r.unstable_getCurrentPriorityLevel=function(){return f},r.unstable_getFirstCallbackNode=function(){return t(u)},r.unstable_next=function(L){switch(f){case 1:case 2:case 3:var H=3;break;default:H=f}var W=f;f=H;try{return L()}finally{f=W}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(L,H){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var W=f;f=L;try{return H()}finally{f=W}},r.unstable_scheduleCallback=function(L,H,W){var z=r.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?z+W:z):W=z,L){case 1:var q=-1;break;case 2:q=250;break;case 5:q=1073741823;break;case 4:q=1e4;break;default:q=5e3}return q=W+q,L={id:c++,callback:H,priorityLevel:L,startTime:W,expirationTime:q,sortIndex:-1},W>z?(L.sortIndex=W,e(l,L),t(u)===null&&L===t(l)&&(w?(y(I),I=-1):w=!0,P(_,W-z))):(L.sortIndex=q,e(u,L),g||m||(g=!0,U(k))),L},r.unstable_shouldYield=N,r.unstable_wrapCallback=function(L){var H=f;return function(){var W=f;f=H;try{return L.apply(this,arguments)}finally{f=W}}}})(iy)),iy}var R2;function aI(){return R2||(R2=1,ry.exports=oI()),ry.exports}var I2;function sI(){if(I2)return hi;I2=1;var r=$c(),e=aI();function t(d){for(var p="https://reactjs.org/docs/error-decoder.html?invariant="+d,b=1;b<arguments.length;b++)p+="&args[]="+encodeURIComponent(arguments[b]);return"Minified React error #"+d+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,i={};function o(d,p){a(d,p),a(d+"Capture",p)}function a(d,p){for(i[d]=p,d=0;d<p.length;d++)n.add(p[d])}var s=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),u=Object.prototype.hasOwnProperty,l=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,c={},h={};function f(d){return u.call(h,d)?!0:u.call(c,d)?!1:l.test(d)?h[d]=!0:(c[d]=!0,!1)}function m(d,p,b,S){if(b!==null&&b.type===0)return!1;switch(typeof p){case"function":case"symbol":return!0;case"boolean":return S?!1:b!==null?!b.acceptsBooleans:(d=d.toLowerCase().slice(0,5),d!=="data-"&&d!=="aria-");default:return!1}}function g(d,p,b,S){if(p===null||typeof p>"u"||m(d,p,b,S))return!0;if(S)return!1;if(b!==null)switch(b.type){case 3:return!p;case 4:return p===!1;case 5:return isNaN(p);case 6:return isNaN(p)||1>p}return!1}function w(d,p,b,S,M,D,G){this.acceptsBooleans=p===2||p===3||p===4,this.attributeName=S,this.attributeNamespace=M,this.mustUseProperty=b,this.propertyName=d,this.type=p,this.sanitizeURL=D,this.removeEmptyString=G}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(d){v[d]=new w(d,0,!1,d,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(d){var p=d[0];v[p]=new w(p,1,!1,d[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(d){v[d]=new w(d,2,!1,d.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(d){v[d]=new w(d,2,!1,d,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(d){v[d]=new w(d,3,!1,d.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(d){v[d]=new w(d,3,!0,d,null,!1,!1)}),["capture","download"].forEach(function(d){v[d]=new w(d,4,!1,d,null,!1,!1)}),["cols","rows","size","span"].forEach(function(d){v[d]=new w(d,6,!1,d,null,!1,!1)}),["rowSpan","start"].forEach(function(d){v[d]=new w(d,5,!1,d.toLowerCase(),null,!1,!1)});var y=/[\-:]([a-z])/g;function x(d){return d[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(d){var p=d.replace(y,x);v[p]=new w(p,1,!1,d,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(d){var p=d.replace(y,x);v[p]=new w(p,1,!1,d,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(d){var p=d.replace(y,x);v[p]=new w(p,1,!1,d,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(d){v[d]=new w(d,1,!1,d.toLowerCase(),null,!1,!1)}),v.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(d){v[d]=new w(d,1,!1,d.toLowerCase(),null,!0,!0)});function E(d,p,b,S){var M=v.hasOwnProperty(p)?v[p]:null;(M!==null?M.type!==0:S||!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(g(p,b,M,S)&&(b=null),S||M===null?f(p)&&(b===null?d.removeAttribute(p):d.setAttribute(p,""+b)):M.mustUseProperty?d[M.propertyName]=b===null?M.type===3?!1:"":b:(p=M.attributeName,S=M.attributeNamespace,b===null?d.removeAttribute(p):(M=M.type,b=M===3||M===4&&b===!0?"":""+b,S?d.setAttributeNS(S,p,b):d.setAttribute(p,b))))}var _=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),C=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),T=Symbol.for("react.profiler"),A=Symbol.for("react.provider"),N=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),U=Symbol.for("react.lazy"),P=Symbol.for("react.offscreen"),L=Symbol.iterator;function H(d){return d===null||typeof d!="object"?null:(d=L&&d[L]||d["@@iterator"],typeof d=="function"?d:null)}var W=Object.assign,z;function q(d){if(z===void 0)try{throw Error()}catch(b){var p=b.stack.trim().match(/\n( *(at )?)/);z=p&&p[1]||""}return`
`+z+d}var re=!1;function de(d,p){if(!d||re)return"";re=!0;var b=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(p)if(p=function(){throw Error()},Object.defineProperty(p.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(p,[])}catch(Se){var S=Se}Reflect.construct(d,[],p)}else{try{p.call()}catch(Se){S=Se}d.call(p.prototype)}else{try{throw Error()}catch(Se){S=Se}d()}}catch(Se){if(Se&&S&&typeof Se.stack=="string"){for(var M=Se.stack.split(`
`),D=S.stack.split(`
`),G=M.length-1,ee=D.length-1;1<=G&&0<=ee&&M[G]!==D[ee];)ee--;for(;1<=G&&0<=ee;G--,ee--)if(M[G]!==D[ee]){if(G!==1||ee!==1)do if(G--,ee--,0>ee||M[G]!==D[ee]){var ae=`
`+M[G].replace(" at new "," at ");return d.displayName&&ae.includes("<anonymous>")&&(ae=ae.replace("<anonymous>",d.displayName)),ae}while(1<=G&&0<=ee);break}}}finally{re=!1,Error.prepareStackTrace=b}return(d=d?d.displayName||d.name:"")?q(d):""}function ye(d){switch(d.tag){case 5:return q(d.type);case 16:return q("Lazy");case 13:return q("Suspense");case 19:return q("SuspenseList");case 0:case 2:case 15:return d=de(d.type,!1),d;case 11:return d=de(d.type.render,!1),d;case 1:return d=de(d.type,!0),d;default:return""}}function ne(d){if(d==null)return null;if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case R:return"Fragment";case C:return"Portal";case T:return"Profiler";case I:return"StrictMode";case V:return"Suspense";case F:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case N:return(d.displayName||"Context")+".Consumer";case A:return(d._context.displayName||"Context")+".Provider";case O:var p=d.render;return d=d.displayName,d||(d=p.displayName||p.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case B:return p=d.displayName||null,p!==null?p:ne(d.type)||"Memo";case U:p=d._payload,d=d._init;try{return ne(d(p))}catch{}}return null}function ie(d){var p=d.type;switch(d.tag){case 24:return"Cache";case 9:return(p.displayName||"Context")+".Consumer";case 10:return(p._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return d=p.render,d=d.displayName||d.name||"",p.displayName||(d!==""?"ForwardRef("+d+")":"ForwardRef");case 7:return"Fragment";case 5:return p;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ne(p);case 8:return p===I?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof p=="function")return p.displayName||p.name||null;if(typeof p=="string")return p}return null}function fe(d){switch(typeof d){case"boolean":case"number":case"string":case"undefined":return d;case"object":return d;default:return""}}function Ae(d){var p=d.type;return(d=d.nodeName)&&d.toLowerCase()==="input"&&(p==="checkbox"||p==="radio")}function De(d){var p=Ae(d)?"checked":"value",b=Object.getOwnPropertyDescriptor(d.constructor.prototype,p),S=""+d[p];if(!d.hasOwnProperty(p)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var M=b.get,D=b.set;return Object.defineProperty(d,p,{configurable:!0,get:function(){return M.call(this)},set:function(G){S=""+G,D.call(this,G)}}),Object.defineProperty(d,p,{enumerable:b.enumerable}),{getValue:function(){return S},setValue:function(G){S=""+G},stopTracking:function(){d._valueTracker=null,delete d[p]}}}}function Be(d){d._valueTracker||(d._valueTracker=De(d))}function lt(d){if(!d)return!1;var p=d._valueTracker;if(!p)return!0;var b=p.getValue(),S="";return d&&(S=Ae(d)?d.checked?"true":"false":d.value),d=S,d!==b?(p.setValue(d),!0):!1}function Y(d){if(d=d||(typeof document<"u"?document:void 0),typeof d>"u")return null;try{return d.activeElement||d.body}catch{return d.body}}function ot(d,p){var b=p.checked;return W({},p,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:b??d._wrapperState.initialChecked})}function Je(d,p){var b=p.defaultValue==null?"":p.defaultValue,S=p.checked!=null?p.checked:p.defaultChecked;b=fe(p.value!=null?p.value:b),d._wrapperState={initialChecked:S,initialValue:b,controlled:p.type==="checkbox"||p.type==="radio"?p.checked!=null:p.value!=null}}function Xe(d,p){p=p.checked,p!=null&&E(d,"checked",p,!1)}function qe(d,p){Xe(d,p);var b=fe(p.value),S=p.type;if(b!=null)S==="number"?(b===0&&d.value===""||d.value!=b)&&(d.value=""+b):d.value!==""+b&&(d.value=""+b);else if(S==="submit"||S==="reset"){d.removeAttribute("value");return}p.hasOwnProperty("value")?Qe(d,p.type,b):p.hasOwnProperty("defaultValue")&&Qe(d,p.type,fe(p.defaultValue)),p.checked==null&&p.defaultChecked!=null&&(d.defaultChecked=!!p.defaultChecked)}function Tt(d,p,b){if(p.hasOwnProperty("value")||p.hasOwnProperty("defaultValue")){var S=p.type;if(!(S!=="submit"&&S!=="reset"||p.value!==void 0&&p.value!==null))return;p=""+d._wrapperState.initialValue,b||p===d.value||(d.value=p),d.defaultValue=p}b=d.name,b!==""&&(d.name=""),d.defaultChecked=!!d._wrapperState.initialChecked,b!==""&&(d.name=b)}function Qe(d,p,b){(p!=="number"||Y(d.ownerDocument)!==d)&&(b==null?d.defaultValue=""+d._wrapperState.initialValue:d.defaultValue!==""+b&&(d.defaultValue=""+b))}var ft=Array.isArray;function Mt(d,p,b,S){if(d=d.options,p){p={};for(var M=0;M<b.length;M++)p["$"+b[M]]=!0;for(b=0;b<d.length;b++)M=p.hasOwnProperty("$"+d[b].value),d[b].selected!==M&&(d[b].selected=M),M&&S&&(d[b].defaultSelected=!0)}else{for(b=""+fe(b),p=null,M=0;M<d.length;M++){if(d[M].value===b){d[M].selected=!0,S&&(d[M].defaultSelected=!0);return}p!==null||d[M].disabled||(p=d[M])}p!==null&&(p.selected=!0)}}function Ut(d,p){if(p.dangerouslySetInnerHTML!=null)throw Error(t(91));return W({},p,{value:void 0,defaultValue:void 0,children:""+d._wrapperState.initialValue})}function Z(d,p){var b=p.value;if(b==null){if(b=p.children,p=p.defaultValue,b!=null){if(p!=null)throw Error(t(92));if(ft(b)){if(1<b.length)throw Error(t(93));b=b[0]}p=b}p==null&&(p=""),b=p}d._wrapperState={initialValue:fe(b)}}function j(d,p){var b=fe(p.value),S=fe(p.defaultValue);b!=null&&(b=""+b,b!==d.value&&(d.value=b),p.defaultValue==null&&d.defaultValue!==b&&(d.defaultValue=b)),S!=null&&(d.defaultValue=""+S)}function me(d){var p=d.textContent;p===d._wrapperState.initialValue&&p!==""&&p!==null&&(d.value=p)}function Re(d){switch(d){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Pe(d,p){return d==null||d==="http://www.w3.org/1999/xhtml"?Re(p):d==="http://www.w3.org/2000/svg"&&p==="foreignObject"?"http://www.w3.org/1999/xhtml":d}var ke,Ue=(function(d){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(p,b,S,M){MSApp.execUnsafeLocalFunction(function(){return d(p,b,S,M)})}:d})(function(d,p){if(d.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in d)d.innerHTML=p;else{for(ke=ke||document.createElement("div"),ke.innerHTML="<svg>"+p.valueOf().toString()+"</svg>",p=ke.firstChild;d.firstChild;)d.removeChild(d.firstChild);for(;p.firstChild;)d.appendChild(p.firstChild)}});function _e(d,p){if(p){var b=d.firstChild;if(b&&b===d.lastChild&&b.nodeType===3){b.nodeValue=p;return}}d.textContent=p}var rt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ze=["Webkit","ms","Moz","O"];Object.keys(rt).forEach(function(d){Ze.forEach(function(p){p=p+d.charAt(0).toUpperCase()+d.substring(1),rt[p]=rt[d]})});function Oe(d,p,b){return p==null||typeof p=="boolean"||p===""?"":b||typeof p!="number"||p===0||rt.hasOwnProperty(d)&&rt[d]?(""+p).trim():p+"px"}function $e(d,p){d=d.style;for(var b in p)if(p.hasOwnProperty(b)){var S=b.indexOf("--")===0,M=Oe(b,p[b],S);b==="float"&&(b="cssFloat"),S?d.setProperty(b,M):d[b]=M}}var pt=W({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function nt(d,p){if(p){if(pt[d]&&(p.children!=null||p.dangerouslySetInnerHTML!=null))throw Error(t(137,d));if(p.dangerouslySetInnerHTML!=null){if(p.children!=null)throw Error(t(60));if(typeof p.dangerouslySetInnerHTML!="object"||!("__html"in p.dangerouslySetInnerHTML))throw Error(t(61))}if(p.style!=null&&typeof p.style!="object")throw Error(t(62))}}function tt(d,p){if(d.indexOf("-")===-1)return typeof p.is=="string";switch(d){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Nt=null;function se(d){return d=d.target||d.srcElement||window,d.correspondingUseElement&&(d=d.correspondingUseElement),d.nodeType===3?d.parentNode:d}var He=null,Ve=null,it=null;function We(d){if(d=vh(d)){if(typeof He!="function")throw Error(t(280));var p=d.stateNode;p&&(p=of(p),He(d.stateNode,d.type,p))}}function Fe(d){Ve?it?it.push(d):it=[d]:Ve=d}function gt(){if(Ve){var d=Ve,p=it;if(it=Ve=null,We(d),p)for(d=0;d<p.length;d++)We(p[d])}}function Ht(d,p){return d(p)}function bn(){}var an=!1;function oi(d,p,b){if(an)return d(p,b);an=!0;try{return Ht(d,p,b)}finally{an=!1,(Ve!==null||it!==null)&&(bn(),gt())}}function fr(d,p){var b=d.stateNode;if(b===null)return null;var S=of(b);if(S===null)return null;b=S[p];e:switch(p){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(S=!S.disabled)||(d=d.type,S=!(d==="button"||d==="input"||d==="select"||d==="textarea")),d=!S;break e;default:d=!1}if(d)return null;if(b&&typeof b!="function")throw Error(t(231,p,typeof b));return b}var us=!1;if(s)try{var pr={};Object.defineProperty(pr,"passive",{get:function(){us=!0}}),window.addEventListener("test",pr,pr),window.removeEventListener("test",pr,pr)}catch{us=!1}function Vo(d,p,b,S,M,D,G,ee,ae){var Se=Array.prototype.slice.call(arguments,3);try{p.apply(b,Se)}catch(Ge){this.onError(Ge)}}var jo=!1,Gi=null,Vi=!1,fo=null,ls={onError:function(d){jo=!0,Gi=d}};function ml(d,p,b,S,M,D,G,ee,ae){jo=!1,Gi=null,Vo.apply(ls,arguments)}function gl(d,p,b,S,M,D,G,ee,ae){if(ml.apply(this,arguments),jo){if(jo){var Se=Gi;jo=!1,Gi=null}else throw Error(t(198));Vi||(Vi=!0,fo=Se)}}function po(d){var p=d,b=d;if(d.alternate)for(;p.return;)p=p.return;else{d=p;do p=d,(p.flags&4098)!==0&&(b=p.return),d=p.return;while(d)}return p.tag===3?b:null}function vl(d){if(d.tag===13){var p=d.memoizedState;if(p===null&&(d=d.alternate,d!==null&&(p=d.memoizedState)),p!==null)return p.dehydrated}return null}function cs(d){if(po(d)!==d)throw Error(t(188))}function Sg(d){var p=d.alternate;if(!p){if(p=po(d),p===null)throw Error(t(188));return p!==d?null:d}for(var b=d,S=p;;){var M=b.return;if(M===null)break;var D=M.alternate;if(D===null){if(S=M.return,S!==null){b=S;continue}break}if(M.child===D.child){for(D=M.child;D;){if(D===b)return cs(M),d;if(D===S)return cs(M),p;D=D.sibling}throw Error(t(188))}if(b.return!==S.return)b=M,S=D;else{for(var G=!1,ee=M.child;ee;){if(ee===b){G=!0,b=M,S=D;break}if(ee===S){G=!0,S=M,b=D;break}ee=ee.sibling}if(!G){for(ee=D.child;ee;){if(ee===b){G=!0,b=D,S=M;break}if(ee===S){G=!0,S=D,b=M;break}ee=ee.sibling}if(!G)throw Error(t(189))}}if(b.alternate!==S)throw Error(t(190))}if(b.tag!==3)throw Error(t(188));return b.stateNode.current===b?d:p}function Wd(d){return d=Sg(d),d!==null?Hd(d):null}function Hd(d){if(d.tag===5||d.tag===6)return d;for(d=d.child;d!==null;){var p=Hd(d);if(p!==null)return p;d=d.sibling}return null}var $=e.unstable_scheduleCallback,pe=e.unstable_cancelCallback,Ee=e.unstable_shouldYield,Ce=e.unstable_requestPaint,he=e.unstable_now,Ye=e.unstable_getCurrentPriorityLevel,st=e.unstable_ImmediatePriority,vt=e.unstable_UserBlockingPriority,ct=e.unstable_NormalPriority,Bt=e.unstable_LowPriority,zt=e.unstable_IdlePriority,At=null,jt=null;function xn(d){if(jt&&typeof jt.onCommitFiberRoot=="function")try{jt.onCommitFiberRoot(At,d,void 0,(d.current.flags&128)===128)}catch{}}var ln=Math.clz32?Math.clz32:Ft,Rn=Math.log,kn=Math.LN2;function Ft(d){return d>>>=0,d===0?32:31-(Rn(d)/kn|0)|0}var Tn=64,nn=4194304;function tr(d){switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return d&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return d}}function mo(d,p){var b=d.pendingLanes;if(b===0)return 0;var S=0,M=d.suspendedLanes,D=d.pingedLanes,G=b&268435455;if(G!==0){var ee=G&~M;ee!==0?S=tr(ee):(D&=G,D!==0&&(S=tr(D)))}else G=b&~M,G!==0?S=tr(G):D!==0&&(S=tr(D));if(S===0)return 0;if(p!==0&&p!==S&&(p&M)===0&&(M=S&-S,D=p&-p,M>=D||M===16&&(D&4194240)!==0))return p;if((S&4)!==0&&(S|=b&16),p=d.entangledLanes,p!==0)for(d=d.entanglements,p&=S;0<p;)b=31-ln(p),M=1<<b,S|=d[b],p&=~M;return S}function Kr(d,p){switch(d){case 1:case 2:case 4:return p+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return p+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function du(d,p){for(var b=d.suspendedLanes,S=d.pingedLanes,M=d.expirationTimes,D=d.pendingLanes;0<D;){var G=31-ln(D),ee=1<<G,ae=M[G];ae===-1?((ee&b)===0||(ee&S)!==0)&&(M[G]=Kr(ee,p)):ae<=p&&(d.expiredLanes|=ee),D&=~ee}}function In(d){return d=d.pendingLanes&-1073741825,d!==0?d:d&1073741824?1073741824:0}function Jr(){var d=Tn;return Tn<<=1,(Tn&4194240)===0&&(Tn=64),d}function Ar(d){for(var p=[],b=0;31>b;b++)p.push(d);return p}function Yn(d,p,b){d.pendingLanes|=p,p!==536870912&&(d.suspendedLanes=0,d.pingedLanes=0),d=d.eventTimes,p=31-ln(p),d[p]=b}function Rr(d,p){var b=d.pendingLanes&~p;d.pendingLanes=p,d.suspendedLanes=0,d.pingedLanes=0,d.expiredLanes&=p,d.mutableReadLanes&=p,d.entangledLanes&=p,p=d.entanglements;var S=d.eventTimes;for(d=d.expirationTimes;0<b;){var M=31-ln(b),D=1<<M;p[M]=0,S[M]=-1,d[M]=-1,b&=~D}}function fu(d,p){var b=d.entangledLanes|=p;for(d=d.entanglements;b;){var S=31-ln(b),M=1<<S;M&p|d[S]&p&&(d[S]|=p),b&=~M}}var rn=0;function r_(d){return d&=-d,1<d?4<d?(d&268435455)!==0?16:536870912:4:1}var i_,Eg,o_,a_,s_,kg=!1,Gd=[],hs=null,ds=null,fs=null,th=new Map,nh=new Map,ps=[],SR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function u_(d,p){switch(d){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":ds=null;break;case"mouseover":case"mouseout":fs=null;break;case"pointerover":case"pointerout":th.delete(p.pointerId);break;case"gotpointercapture":case"lostpointercapture":nh.delete(p.pointerId)}}function rh(d,p,b,S,M,D){return d===null||d.nativeEvent!==D?(d={blockedOn:p,domEventName:b,eventSystemFlags:S,nativeEvent:D,targetContainers:[M]},p!==null&&(p=vh(p),p!==null&&Eg(p)),d):(d.eventSystemFlags|=S,p=d.targetContainers,M!==null&&p.indexOf(M)===-1&&p.push(M),d)}function ER(d,p,b,S,M){switch(p){case"focusin":return hs=rh(hs,d,p,b,S,M),!0;case"dragenter":return ds=rh(ds,d,p,b,S,M),!0;case"mouseover":return fs=rh(fs,d,p,b,S,M),!0;case"pointerover":var D=M.pointerId;return th.set(D,rh(th.get(D)||null,d,p,b,S,M)),!0;case"gotpointercapture":return D=M.pointerId,nh.set(D,rh(nh.get(D)||null,d,p,b,S,M)),!0}return!1}function l_(d){var p=pu(d.target);if(p!==null){var b=po(p);if(b!==null){if(p=b.tag,p===13){if(p=vl(b),p!==null){d.blockedOn=p,s_(d.priority,function(){o_(b)});return}}else if(p===3&&b.stateNode.current.memoizedState.isDehydrated){d.blockedOn=b.tag===3?b.stateNode.containerInfo:null;return}}}d.blockedOn=null}function Vd(d){if(d.blockedOn!==null)return!1;for(var p=d.targetContainers;0<p.length;){var b=Tg(d.domEventName,d.eventSystemFlags,p[0],d.nativeEvent);if(b===null){b=d.nativeEvent;var S=new b.constructor(b.type,b);Nt=S,b.target.dispatchEvent(S),Nt=null}else return p=vh(b),p!==null&&Eg(p),d.blockedOn=b,!1;p.shift()}return!0}function c_(d,p,b){Vd(d)&&b.delete(p)}function kR(){kg=!1,hs!==null&&Vd(hs)&&(hs=null),ds!==null&&Vd(ds)&&(ds=null),fs!==null&&Vd(fs)&&(fs=null),th.forEach(c_),nh.forEach(c_)}function ih(d,p){d.blockedOn===p&&(d.blockedOn=null,kg||(kg=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,kR)))}function oh(d){function p(M){return ih(M,d)}if(0<Gd.length){ih(Gd[0],d);for(var b=1;b<Gd.length;b++){var S=Gd[b];S.blockedOn===d&&(S.blockedOn=null)}}for(hs!==null&&ih(hs,d),ds!==null&&ih(ds,d),fs!==null&&ih(fs,d),th.forEach(p),nh.forEach(p),b=0;b<ps.length;b++)S=ps[b],S.blockedOn===d&&(S.blockedOn=null);for(;0<ps.length&&(b=ps[0],b.blockedOn===null);)l_(b),b.blockedOn===null&&ps.shift()}var yl=_.ReactCurrentBatchConfig,jd=!0;function CR(d,p,b,S){var M=rn,D=yl.transition;yl.transition=null;try{rn=1,Cg(d,p,b,S)}finally{rn=M,yl.transition=D}}function TR(d,p,b,S){var M=rn,D=yl.transition;yl.transition=null;try{rn=4,Cg(d,p,b,S)}finally{rn=M,yl.transition=D}}function Cg(d,p,b,S){if(jd){var M=Tg(d,p,b,S);if(M===null)Vg(d,p,S,qd,b),u_(d,S);else if(ER(M,d,p,b,S))S.stopPropagation();else if(u_(d,S),p&4&&-1<SR.indexOf(d)){for(;M!==null;){var D=vh(M);if(D!==null&&i_(D),D=Tg(d,p,b,S),D===null&&Vg(d,p,S,qd,b),D===M)break;M=D}M!==null&&S.stopPropagation()}else Vg(d,p,S,null,b)}}var qd=null;function Tg(d,p,b,S){if(qd=null,d=se(S),d=pu(d),d!==null)if(p=po(d),p===null)d=null;else if(b=p.tag,b===13){if(d=vl(p),d!==null)return d;d=null}else if(b===3){if(p.stateNode.current.memoizedState.isDehydrated)return p.tag===3?p.stateNode.containerInfo:null;d=null}else p!==d&&(d=null);return qd=d,null}function h_(d){switch(d){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Ye()){case st:return 1;case vt:return 4;case ct:case Bt:return 16;case zt:return 536870912;default:return 16}default:return 16}}var ms=null,Mg=null,$d=null;function d_(){if($d)return $d;var d,p=Mg,b=p.length,S,M="value"in ms?ms.value:ms.textContent,D=M.length;for(d=0;d<b&&p[d]===M[d];d++);var G=b-d;for(S=1;S<=G&&p[b-S]===M[D-S];S++);return $d=M.slice(d,1<S?1-S:void 0)}function Xd(d){var p=d.keyCode;return"charCode"in d?(d=d.charCode,d===0&&p===13&&(d=13)):d=p,d===10&&(d=13),32<=d||d===13?d:0}function Yd(){return!0}function f_(){return!1}function Ei(d){function p(b,S,M,D,G){this._reactName=b,this._targetInst=M,this.type=S,this.nativeEvent=D,this.target=G,this.currentTarget=null;for(var ee in d)d.hasOwnProperty(ee)&&(b=d[ee],this[ee]=b?b(D):D[ee]);return this.isDefaultPrevented=(D.defaultPrevented!=null?D.defaultPrevented:D.returnValue===!1)?Yd:f_,this.isPropagationStopped=f_,this}return W(p.prototype,{preventDefault:function(){this.defaultPrevented=!0;var b=this.nativeEvent;b&&(b.preventDefault?b.preventDefault():typeof b.returnValue!="unknown"&&(b.returnValue=!1),this.isDefaultPrevented=Yd)},stopPropagation:function(){var b=this.nativeEvent;b&&(b.stopPropagation?b.stopPropagation():typeof b.cancelBubble!="unknown"&&(b.cancelBubble=!0),this.isPropagationStopped=Yd)},persist:function(){},isPersistent:Yd}),p}var bl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(d){return d.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Ag=Ei(bl),ah=W({},bl,{view:0,detail:0}),MR=Ei(ah),Rg,Ig,sh,Kd=W({},ah,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ng,button:0,buttons:0,relatedTarget:function(d){return d.relatedTarget===void 0?d.fromElement===d.srcElement?d.toElement:d.fromElement:d.relatedTarget},movementX:function(d){return"movementX"in d?d.movementX:(d!==sh&&(sh&&d.type==="mousemove"?(Rg=d.screenX-sh.screenX,Ig=d.screenY-sh.screenY):Ig=Rg=0,sh=d),Rg)},movementY:function(d){return"movementY"in d?d.movementY:Ig}}),p_=Ei(Kd),AR=W({},Kd,{dataTransfer:0}),RR=Ei(AR),IR=W({},ah,{relatedTarget:0}),Dg=Ei(IR),DR=W({},bl,{animationName:0,elapsedTime:0,pseudoElement:0}),NR=Ei(DR),PR=W({},bl,{clipboardData:function(d){return"clipboardData"in d?d.clipboardData:window.clipboardData}}),FR=Ei(PR),OR=W({},bl,{data:0}),m_=Ei(OR),LR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},BR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},UR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function zR(d){var p=this.nativeEvent;return p.getModifierState?p.getModifierState(d):(d=UR[d])?!!p[d]:!1}function Ng(){return zR}var WR=W({},ah,{key:function(d){if(d.key){var p=LR[d.key]||d.key;if(p!=="Unidentified")return p}return d.type==="keypress"?(d=Xd(d),d===13?"Enter":String.fromCharCode(d)):d.type==="keydown"||d.type==="keyup"?BR[d.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ng,charCode:function(d){return d.type==="keypress"?Xd(d):0},keyCode:function(d){return d.type==="keydown"||d.type==="keyup"?d.keyCode:0},which:function(d){return d.type==="keypress"?Xd(d):d.type==="keydown"||d.type==="keyup"?d.keyCode:0}}),HR=Ei(WR),GR=W({},Kd,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),g_=Ei(GR),VR=W({},ah,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ng}),jR=Ei(VR),qR=W({},bl,{propertyName:0,elapsedTime:0,pseudoElement:0}),$R=Ei(qR),XR=W({},Kd,{deltaX:function(d){return"deltaX"in d?d.deltaX:"wheelDeltaX"in d?-d.wheelDeltaX:0},deltaY:function(d){return"deltaY"in d?d.deltaY:"wheelDeltaY"in d?-d.wheelDeltaY:"wheelDelta"in d?-d.wheelDelta:0},deltaZ:0,deltaMode:0}),YR=Ei(XR),KR=[9,13,27,32],Pg=s&&"CompositionEvent"in window,uh=null;s&&"documentMode"in document&&(uh=document.documentMode);var JR=s&&"TextEvent"in window&&!uh,v_=s&&(!Pg||uh&&8<uh&&11>=uh),y_=" ",b_=!1;function w_(d,p){switch(d){case"keyup":return KR.indexOf(p.keyCode)!==-1;case"keydown":return p.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function __(d){return d=d.detail,typeof d=="object"&&"data"in d?d.data:null}var wl=!1;function ZR(d,p){switch(d){case"compositionend":return __(p);case"keypress":return p.which!==32?null:(b_=!0,y_);case"textInput":return d=p.data,d===y_&&b_?null:d;default:return null}}function QR(d,p){if(wl)return d==="compositionend"||!Pg&&w_(d,p)?(d=d_(),$d=Mg=ms=null,wl=!1,d):null;switch(d){case"paste":return null;case"keypress":if(!(p.ctrlKey||p.altKey||p.metaKey)||p.ctrlKey&&p.altKey){if(p.char&&1<p.char.length)return p.char;if(p.which)return String.fromCharCode(p.which)}return null;case"compositionend":return v_&&p.locale!=="ko"?null:p.data;default:return null}}var e4={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function x_(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p==="input"?!!e4[d.type]:p==="textarea"}function S_(d,p,b,S){Fe(S),p=tf(p,"onChange"),0<p.length&&(b=new Ag("onChange","change",null,b,S),d.push({event:b,listeners:p}))}var lh=null,ch=null;function t4(d){W_(d,0)}function Jd(d){var p=kl(d);if(lt(p))return d}function n4(d,p){if(d==="change")return p}var E_=!1;if(s){var Fg;if(s){var Og="oninput"in document;if(!Og){var k_=document.createElement("div");k_.setAttribute("oninput","return;"),Og=typeof k_.oninput=="function"}Fg=Og}else Fg=!1;E_=Fg&&(!document.documentMode||9<document.documentMode)}function C_(){lh&&(lh.detachEvent("onpropertychange",T_),ch=lh=null)}function T_(d){if(d.propertyName==="value"&&Jd(ch)){var p=[];S_(p,ch,d,se(d)),oi(t4,p)}}function r4(d,p,b){d==="focusin"?(C_(),lh=p,ch=b,lh.attachEvent("onpropertychange",T_)):d==="focusout"&&C_()}function i4(d){if(d==="selectionchange"||d==="keyup"||d==="keydown")return Jd(ch)}function o4(d,p){if(d==="click")return Jd(p)}function a4(d,p){if(d==="input"||d==="change")return Jd(p)}function s4(d,p){return d===p&&(d!==0||1/d===1/p)||d!==d&&p!==p}var go=typeof Object.is=="function"?Object.is:s4;function hh(d,p){if(go(d,p))return!0;if(typeof d!="object"||d===null||typeof p!="object"||p===null)return!1;var b=Object.keys(d),S=Object.keys(p);if(b.length!==S.length)return!1;for(S=0;S<b.length;S++){var M=b[S];if(!u.call(p,M)||!go(d[M],p[M]))return!1}return!0}function M_(d){for(;d&&d.firstChild;)d=d.firstChild;return d}function A_(d,p){var b=M_(d);d=0;for(var S;b;){if(b.nodeType===3){if(S=d+b.textContent.length,d<=p&&S>=p)return{node:b,offset:p-d};d=S}e:{for(;b;){if(b.nextSibling){b=b.nextSibling;break e}b=b.parentNode}b=void 0}b=M_(b)}}function R_(d,p){return d&&p?d===p?!0:d&&d.nodeType===3?!1:p&&p.nodeType===3?R_(d,p.parentNode):"contains"in d?d.contains(p):d.compareDocumentPosition?!!(d.compareDocumentPosition(p)&16):!1:!1}function I_(){for(var d=window,p=Y();p instanceof d.HTMLIFrameElement;){try{var b=typeof p.contentWindow.location.href=="string"}catch{b=!1}if(b)d=p.contentWindow;else break;p=Y(d.document)}return p}function Lg(d){var p=d&&d.nodeName&&d.nodeName.toLowerCase();return p&&(p==="input"&&(d.type==="text"||d.type==="search"||d.type==="tel"||d.type==="url"||d.type==="password")||p==="textarea"||d.contentEditable==="true")}function u4(d){var p=I_(),b=d.focusedElem,S=d.selectionRange;if(p!==b&&b&&b.ownerDocument&&R_(b.ownerDocument.documentElement,b)){if(S!==null&&Lg(b)){if(p=S.start,d=S.end,d===void 0&&(d=p),"selectionStart"in b)b.selectionStart=p,b.selectionEnd=Math.min(d,b.value.length);else if(d=(p=b.ownerDocument||document)&&p.defaultView||window,d.getSelection){d=d.getSelection();var M=b.textContent.length,D=Math.min(S.start,M);S=S.end===void 0?D:Math.min(S.end,M),!d.extend&&D>S&&(M=S,S=D,D=M),M=A_(b,D);var G=A_(b,S);M&&G&&(d.rangeCount!==1||d.anchorNode!==M.node||d.anchorOffset!==M.offset||d.focusNode!==G.node||d.focusOffset!==G.offset)&&(p=p.createRange(),p.setStart(M.node,M.offset),d.removeAllRanges(),D>S?(d.addRange(p),d.extend(G.node,G.offset)):(p.setEnd(G.node,G.offset),d.addRange(p)))}}for(p=[],d=b;d=d.parentNode;)d.nodeType===1&&p.push({element:d,left:d.scrollLeft,top:d.scrollTop});for(typeof b.focus=="function"&&b.focus(),b=0;b<p.length;b++)d=p[b],d.element.scrollLeft=d.left,d.element.scrollTop=d.top}}var l4=s&&"documentMode"in document&&11>=document.documentMode,_l=null,Bg=null,dh=null,Ug=!1;function D_(d,p,b){var S=b.window===b?b.document:b.nodeType===9?b:b.ownerDocument;Ug||_l==null||_l!==Y(S)||(S=_l,"selectionStart"in S&&Lg(S)?S={start:S.selectionStart,end:S.selectionEnd}:(S=(S.ownerDocument&&S.ownerDocument.defaultView||window).getSelection(),S={anchorNode:S.anchorNode,anchorOffset:S.anchorOffset,focusNode:S.focusNode,focusOffset:S.focusOffset}),dh&&hh(dh,S)||(dh=S,S=tf(Bg,"onSelect"),0<S.length&&(p=new Ag("onSelect","select",null,p,b),d.push({event:p,listeners:S}),p.target=_l)))}function Zd(d,p){var b={};return b[d.toLowerCase()]=p.toLowerCase(),b["Webkit"+d]="webkit"+p,b["Moz"+d]="moz"+p,b}var xl={animationend:Zd("Animation","AnimationEnd"),animationiteration:Zd("Animation","AnimationIteration"),animationstart:Zd("Animation","AnimationStart"),transitionend:Zd("Transition","TransitionEnd")},zg={},N_={};s&&(N_=document.createElement("div").style,"AnimationEvent"in window||(delete xl.animationend.animation,delete xl.animationiteration.animation,delete xl.animationstart.animation),"TransitionEvent"in window||delete xl.transitionend.transition);function Qd(d){if(zg[d])return zg[d];if(!xl[d])return d;var p=xl[d],b;for(b in p)if(p.hasOwnProperty(b)&&b in N_)return zg[d]=p[b];return d}var P_=Qd("animationend"),F_=Qd("animationiteration"),O_=Qd("animationstart"),L_=Qd("transitionend"),B_=new Map,U_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function gs(d,p){B_.set(d,p),o(p,[d])}for(var Wg=0;Wg<U_.length;Wg++){var Hg=U_[Wg],c4=Hg.toLowerCase(),h4=Hg[0].toUpperCase()+Hg.slice(1);gs(c4,"on"+h4)}gs(P_,"onAnimationEnd"),gs(F_,"onAnimationIteration"),gs(O_,"onAnimationStart"),gs("dblclick","onDoubleClick"),gs("focusin","onFocus"),gs("focusout","onBlur"),gs(L_,"onTransitionEnd"),a("onMouseEnter",["mouseout","mouseover"]),a("onMouseLeave",["mouseout","mouseover"]),a("onPointerEnter",["pointerout","pointerover"]),a("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),d4=new Set("cancel close invalid load scroll toggle".split(" ").concat(fh));function z_(d,p,b){var S=d.type||"unknown-event";d.currentTarget=b,gl(S,p,void 0,d),d.currentTarget=null}function W_(d,p){p=(p&4)!==0;for(var b=0;b<d.length;b++){var S=d[b],M=S.event;S=S.listeners;e:{var D=void 0;if(p)for(var G=S.length-1;0<=G;G--){var ee=S[G],ae=ee.instance,Se=ee.currentTarget;if(ee=ee.listener,ae!==D&&M.isPropagationStopped())break e;z_(M,ee,Se),D=ae}else for(G=0;G<S.length;G++){if(ee=S[G],ae=ee.instance,Se=ee.currentTarget,ee=ee.listener,ae!==D&&M.isPropagationStopped())break e;z_(M,ee,Se),D=ae}}}if(Vi)throw d=fo,Vi=!1,fo=null,d}function On(d,p){var b=p[Kg];b===void 0&&(b=p[Kg]=new Set);var S=d+"__bubble";b.has(S)||(H_(p,d,2,!1),b.add(S))}function Gg(d,p,b){var S=0;p&&(S|=4),H_(b,d,S,p)}var ef="_reactListening"+Math.random().toString(36).slice(2);function ph(d){if(!d[ef]){d[ef]=!0,n.forEach(function(b){b!=="selectionchange"&&(d4.has(b)||Gg(b,!1,d),Gg(b,!0,d))});var p=d.nodeType===9?d:d.ownerDocument;p===null||p[ef]||(p[ef]=!0,Gg("selectionchange",!1,p))}}function H_(d,p,b,S){switch(h_(p)){case 1:var M=CR;break;case 4:M=TR;break;default:M=Cg}b=M.bind(null,p,b,d),M=void 0,!us||p!=="touchstart"&&p!=="touchmove"&&p!=="wheel"||(M=!0),S?M!==void 0?d.addEventListener(p,b,{capture:!0,passive:M}):d.addEventListener(p,b,!0):M!==void 0?d.addEventListener(p,b,{passive:M}):d.addEventListener(p,b,!1)}function Vg(d,p,b,S,M){var D=S;if((p&1)===0&&(p&2)===0&&S!==null)e:for(;;){if(S===null)return;var G=S.tag;if(G===3||G===4){var ee=S.stateNode.containerInfo;if(ee===M||ee.nodeType===8&&ee.parentNode===M)break;if(G===4)for(G=S.return;G!==null;){var ae=G.tag;if((ae===3||ae===4)&&(ae=G.stateNode.containerInfo,ae===M||ae.nodeType===8&&ae.parentNode===M))return;G=G.return}for(;ee!==null;){if(G=pu(ee),G===null)return;if(ae=G.tag,ae===5||ae===6){S=D=G;continue e}ee=ee.parentNode}}S=S.return}oi(function(){var Se=D,Ge=se(b),je=[];e:{var ze=B_.get(d);if(ze!==void 0){var ht=Ag,yt=d;switch(d){case"keypress":if(Xd(b)===0)break e;case"keydown":case"keyup":ht=HR;break;case"focusin":yt="focus",ht=Dg;break;case"focusout":yt="blur",ht=Dg;break;case"beforeblur":case"afterblur":ht=Dg;break;case"click":if(b.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ht=p_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ht=RR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ht=jR;break;case P_:case F_:case O_:ht=NR;break;case L_:ht=$R;break;case"scroll":ht=MR;break;case"wheel":ht=YR;break;case"copy":case"cut":case"paste":ht=FR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ht=g_}var xt=(p&4)!==0,Kn=!xt&&d==="scroll",ge=xt?ze!==null?ze+"Capture":null:ze;xt=[];for(var ce=Se,we;ce!==null;){we=ce;var et=we.stateNode;if(we.tag===5&&et!==null&&(we=et,ge!==null&&(et=fr(ce,ge),et!=null&&xt.push(mh(ce,et,we)))),Kn)break;ce=ce.return}0<xt.length&&(ze=new ht(ze,yt,null,b,Ge),je.push({event:ze,listeners:xt}))}}if((p&7)===0){e:{if(ze=d==="mouseover"||d==="pointerover",ht=d==="mouseout"||d==="pointerout",ze&&b!==Nt&&(yt=b.relatedTarget||b.fromElement)&&(pu(yt)||yt[xa]))break e;if((ht||ze)&&(ze=Ge.window===Ge?Ge:(ze=Ge.ownerDocument)?ze.defaultView||ze.parentWindow:window,ht?(yt=b.relatedTarget||b.toElement,ht=Se,yt=yt?pu(yt):null,yt!==null&&(Kn=po(yt),yt!==Kn||yt.tag!==5&&yt.tag!==6)&&(yt=null)):(ht=null,yt=Se),ht!==yt)){if(xt=p_,et="onMouseLeave",ge="onMouseEnter",ce="mouse",(d==="pointerout"||d==="pointerover")&&(xt=g_,et="onPointerLeave",ge="onPointerEnter",ce="pointer"),Kn=ht==null?ze:kl(ht),we=yt==null?ze:kl(yt),ze=new xt(et,ce+"leave",ht,b,Ge),ze.target=Kn,ze.relatedTarget=we,et=null,pu(Ge)===Se&&(xt=new xt(ge,ce+"enter",yt,b,Ge),xt.target=we,xt.relatedTarget=Kn,et=xt),Kn=et,ht&&yt)t:{for(xt=ht,ge=yt,ce=0,we=xt;we;we=Sl(we))ce++;for(we=0,et=ge;et;et=Sl(et))we++;for(;0<ce-we;)xt=Sl(xt),ce--;for(;0<we-ce;)ge=Sl(ge),we--;for(;ce--;){if(xt===ge||ge!==null&&xt===ge.alternate)break t;xt=Sl(xt),ge=Sl(ge)}xt=null}else xt=null;ht!==null&&G_(je,ze,ht,xt,!1),yt!==null&&Kn!==null&&G_(je,Kn,yt,xt,!0)}}e:{if(ze=Se?kl(Se):window,ht=ze.nodeName&&ze.nodeName.toLowerCase(),ht==="select"||ht==="input"&&ze.type==="file")var St=n4;else if(x_(ze))if(E_)St=a4;else{St=i4;var Ot=r4}else(ht=ze.nodeName)&&ht.toLowerCase()==="input"&&(ze.type==="checkbox"||ze.type==="radio")&&(St=o4);if(St&&(St=St(d,Se))){S_(je,St,b,Ge);break e}Ot&&Ot(d,ze,Se),d==="focusout"&&(Ot=ze._wrapperState)&&Ot.controlled&&ze.type==="number"&&Qe(ze,"number",ze.value)}switch(Ot=Se?kl(Se):window,d){case"focusin":(x_(Ot)||Ot.contentEditable==="true")&&(_l=Ot,Bg=Se,dh=null);break;case"focusout":dh=Bg=_l=null;break;case"mousedown":Ug=!0;break;case"contextmenu":case"mouseup":case"dragend":Ug=!1,D_(je,b,Ge);break;case"selectionchange":if(l4)break;case"keydown":case"keyup":D_(je,b,Ge)}var Lt;if(Pg)e:{switch(d){case"compositionstart":var qt="onCompositionStart";break e;case"compositionend":qt="onCompositionEnd";break e;case"compositionupdate":qt="onCompositionUpdate";break e}qt=void 0}else wl?w_(d,b)&&(qt="onCompositionEnd"):d==="keydown"&&b.keyCode===229&&(qt="onCompositionStart");qt&&(v_&&b.locale!=="ko"&&(wl||qt!=="onCompositionStart"?qt==="onCompositionEnd"&&wl&&(Lt=d_()):(ms=Ge,Mg="value"in ms?ms.value:ms.textContent,wl=!0)),Ot=tf(Se,qt),0<Ot.length&&(qt=new m_(qt,d,null,b,Ge),je.push({event:qt,listeners:Ot}),Lt?qt.data=Lt:(Lt=__(b),Lt!==null&&(qt.data=Lt)))),(Lt=JR?ZR(d,b):QR(d,b))&&(Se=tf(Se,"onBeforeInput"),0<Se.length&&(Ge=new m_("onBeforeInput","beforeinput",null,b,Ge),je.push({event:Ge,listeners:Se}),Ge.data=Lt))}W_(je,p)})}function mh(d,p,b){return{instance:d,listener:p,currentTarget:b}}function tf(d,p){for(var b=p+"Capture",S=[];d!==null;){var M=d,D=M.stateNode;M.tag===5&&D!==null&&(M=D,D=fr(d,b),D!=null&&S.unshift(mh(d,D,M)),D=fr(d,p),D!=null&&S.push(mh(d,D,M))),d=d.return}return S}function Sl(d){if(d===null)return null;do d=d.return;while(d&&d.tag!==5);return d||null}function G_(d,p,b,S,M){for(var D=p._reactName,G=[];b!==null&&b!==S;){var ee=b,ae=ee.alternate,Se=ee.stateNode;if(ae!==null&&ae===S)break;ee.tag===5&&Se!==null&&(ee=Se,M?(ae=fr(b,D),ae!=null&&G.unshift(mh(b,ae,ee))):M||(ae=fr(b,D),ae!=null&&G.push(mh(b,ae,ee)))),b=b.return}G.length!==0&&d.push({event:p,listeners:G})}var f4=/\r\n?/g,p4=/\u0000|\uFFFD/g;function V_(d){return(typeof d=="string"?d:""+d).replace(f4,`
`).replace(p4,"")}function nf(d,p,b){if(p=V_(p),V_(d)!==p&&b)throw Error(t(425))}function rf(){}var jg=null,qg=null;function $g(d,p){return d==="textarea"||d==="noscript"||typeof p.children=="string"||typeof p.children=="number"||typeof p.dangerouslySetInnerHTML=="object"&&p.dangerouslySetInnerHTML!==null&&p.dangerouslySetInnerHTML.__html!=null}var Xg=typeof setTimeout=="function"?setTimeout:void 0,m4=typeof clearTimeout=="function"?clearTimeout:void 0,j_=typeof Promise=="function"?Promise:void 0,g4=typeof queueMicrotask=="function"?queueMicrotask:typeof j_<"u"?function(d){return j_.resolve(null).then(d).catch(v4)}:Xg;function v4(d){setTimeout(function(){throw d})}function Yg(d,p){var b=p,S=0;do{var M=b.nextSibling;if(d.removeChild(b),M&&M.nodeType===8)if(b=M.data,b==="/$"){if(S===0){d.removeChild(M),oh(p);return}S--}else b!=="$"&&b!=="$?"&&b!=="$!"||S++;b=M}while(b);oh(p)}function vs(d){for(;d!=null;d=d.nextSibling){var p=d.nodeType;if(p===1||p===3)break;if(p===8){if(p=d.data,p==="$"||p==="$!"||p==="$?")break;if(p==="/$")return null}}return d}function q_(d){d=d.previousSibling;for(var p=0;d;){if(d.nodeType===8){var b=d.data;if(b==="$"||b==="$!"||b==="$?"){if(p===0)return d;p--}else b==="/$"&&p++}d=d.previousSibling}return null}var El=Math.random().toString(36).slice(2),qo="__reactFiber$"+El,gh="__reactProps$"+El,xa="__reactContainer$"+El,Kg="__reactEvents$"+El,y4="__reactListeners$"+El,b4="__reactHandles$"+El;function pu(d){var p=d[qo];if(p)return p;for(var b=d.parentNode;b;){if(p=b[xa]||b[qo]){if(b=p.alternate,p.child!==null||b!==null&&b.child!==null)for(d=q_(d);d!==null;){if(b=d[qo])return b;d=q_(d)}return p}d=b,b=d.parentNode}return null}function vh(d){return d=d[qo]||d[xa],!d||d.tag!==5&&d.tag!==6&&d.tag!==13&&d.tag!==3?null:d}function kl(d){if(d.tag===5||d.tag===6)return d.stateNode;throw Error(t(33))}function of(d){return d[gh]||null}var Jg=[],Cl=-1;function ys(d){return{current:d}}function Ln(d){0>Cl||(d.current=Jg[Cl],Jg[Cl]=null,Cl--)}function Dn(d,p){Cl++,Jg[Cl]=d.current,d.current=p}var bs={},Ir=ys(bs),ai=ys(!1),mu=bs;function Tl(d,p){var b=d.type.contextTypes;if(!b)return bs;var S=d.stateNode;if(S&&S.__reactInternalMemoizedUnmaskedChildContext===p)return S.__reactInternalMemoizedMaskedChildContext;var M={},D;for(D in b)M[D]=p[D];return S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=p,d.__reactInternalMemoizedMaskedChildContext=M),M}function si(d){return d=d.childContextTypes,d!=null}function af(){Ln(ai),Ln(Ir)}function $_(d,p,b){if(Ir.current!==bs)throw Error(t(168));Dn(Ir,p),Dn(ai,b)}function X_(d,p,b){var S=d.stateNode;if(p=p.childContextTypes,typeof S.getChildContext!="function")return b;S=S.getChildContext();for(var M in S)if(!(M in p))throw Error(t(108,ie(d)||"Unknown",M));return W({},b,S)}function sf(d){return d=(d=d.stateNode)&&d.__reactInternalMemoizedMergedChildContext||bs,mu=Ir.current,Dn(Ir,d),Dn(ai,ai.current),!0}function Y_(d,p,b){var S=d.stateNode;if(!S)throw Error(t(169));b?(d=X_(d,p,mu),S.__reactInternalMemoizedMergedChildContext=d,Ln(ai),Ln(Ir),Dn(Ir,d)):Ln(ai),Dn(ai,b)}var Sa=null,uf=!1,Zg=!1;function K_(d){Sa===null?Sa=[d]:Sa.push(d)}function w4(d){uf=!0,K_(d)}function ws(){if(!Zg&&Sa!==null){Zg=!0;var d=0,p=rn;try{var b=Sa;for(rn=1;d<b.length;d++){var S=b[d];do S=S(!0);while(S!==null)}Sa=null,uf=!1}catch(M){throw Sa!==null&&(Sa=Sa.slice(d+1)),$(st,ws),M}finally{rn=p,Zg=!1}}return null}var Ml=[],Al=0,lf=null,cf=0,ji=[],qi=0,gu=null,Ea=1,ka="";function vu(d,p){Ml[Al++]=cf,Ml[Al++]=lf,lf=d,cf=p}function J_(d,p,b){ji[qi++]=Ea,ji[qi++]=ka,ji[qi++]=gu,gu=d;var S=Ea;d=ka;var M=32-ln(S)-1;S&=~(1<<M),b+=1;var D=32-ln(p)+M;if(30<D){var G=M-M%5;D=(S&(1<<G)-1).toString(32),S>>=G,M-=G,Ea=1<<32-ln(p)+M|b<<M|S,ka=D+d}else Ea=1<<D|b<<M|S,ka=d}function Qg(d){d.return!==null&&(vu(d,1),J_(d,1,0))}function ev(d){for(;d===lf;)lf=Ml[--Al],Ml[Al]=null,cf=Ml[--Al],Ml[Al]=null;for(;d===gu;)gu=ji[--qi],ji[qi]=null,ka=ji[--qi],ji[qi]=null,Ea=ji[--qi],ji[qi]=null}var ki=null,Ci=null,Bn=!1,vo=null;function Z_(d,p){var b=Ki(5,null,null,0);b.elementType="DELETED",b.stateNode=p,b.return=d,p=d.deletions,p===null?(d.deletions=[b],d.flags|=16):p.push(b)}function Q_(d,p){switch(d.tag){case 5:var b=d.type;return p=p.nodeType!==1||b.toLowerCase()!==p.nodeName.toLowerCase()?null:p,p!==null?(d.stateNode=p,ki=d,Ci=vs(p.firstChild),!0):!1;case 6:return p=d.pendingProps===""||p.nodeType!==3?null:p,p!==null?(d.stateNode=p,ki=d,Ci=null,!0):!1;case 13:return p=p.nodeType!==8?null:p,p!==null?(b=gu!==null?{id:Ea,overflow:ka}:null,d.memoizedState={dehydrated:p,treeContext:b,retryLane:1073741824},b=Ki(18,null,null,0),b.stateNode=p,b.return=d,d.child=b,ki=d,Ci=null,!0):!1;default:return!1}}function tv(d){return(d.mode&1)!==0&&(d.flags&128)===0}function nv(d){if(Bn){var p=Ci;if(p){var b=p;if(!Q_(d,p)){if(tv(d))throw Error(t(418));p=vs(b.nextSibling);var S=ki;p&&Q_(d,p)?Z_(S,b):(d.flags=d.flags&-4097|2,Bn=!1,ki=d)}}else{if(tv(d))throw Error(t(418));d.flags=d.flags&-4097|2,Bn=!1,ki=d}}}function ex(d){for(d=d.return;d!==null&&d.tag!==5&&d.tag!==3&&d.tag!==13;)d=d.return;ki=d}function hf(d){if(d!==ki)return!1;if(!Bn)return ex(d),Bn=!0,!1;var p;if((p=d.tag!==3)&&!(p=d.tag!==5)&&(p=d.type,p=p!=="head"&&p!=="body"&&!$g(d.type,d.memoizedProps)),p&&(p=Ci)){if(tv(d))throw tx(),Error(t(418));for(;p;)Z_(d,p),p=vs(p.nextSibling)}if(ex(d),d.tag===13){if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(t(317));e:{for(d=d.nextSibling,p=0;d;){if(d.nodeType===8){var b=d.data;if(b==="/$"){if(p===0){Ci=vs(d.nextSibling);break e}p--}else b!=="$"&&b!=="$!"&&b!=="$?"||p++}d=d.nextSibling}Ci=null}}else Ci=ki?vs(d.stateNode.nextSibling):null;return!0}function tx(){for(var d=Ci;d;)d=vs(d.nextSibling)}function Rl(){Ci=ki=null,Bn=!1}function rv(d){vo===null?vo=[d]:vo.push(d)}var _4=_.ReactCurrentBatchConfig;function yh(d,p,b){if(d=b.ref,d!==null&&typeof d!="function"&&typeof d!="object"){if(b._owner){if(b=b._owner,b){if(b.tag!==1)throw Error(t(309));var S=b.stateNode}if(!S)throw Error(t(147,d));var M=S,D=""+d;return p!==null&&p.ref!==null&&typeof p.ref=="function"&&p.ref._stringRef===D?p.ref:(p=function(G){var ee=M.refs;G===null?delete ee[D]:ee[D]=G},p._stringRef=D,p)}if(typeof d!="string")throw Error(t(284));if(!b._owner)throw Error(t(290,d))}return d}function df(d,p){throw d=Object.prototype.toString.call(p),Error(t(31,d==="[object Object]"?"object with keys {"+Object.keys(p).join(", ")+"}":d))}function nx(d){var p=d._init;return p(d._payload)}function rx(d){function p(ge,ce){if(d){var we=ge.deletions;we===null?(ge.deletions=[ce],ge.flags|=16):we.push(ce)}}function b(ge,ce){if(!d)return null;for(;ce!==null;)p(ge,ce),ce=ce.sibling;return null}function S(ge,ce){for(ge=new Map;ce!==null;)ce.key!==null?ge.set(ce.key,ce):ge.set(ce.index,ce),ce=ce.sibling;return ge}function M(ge,ce){return ge=Ms(ge,ce),ge.index=0,ge.sibling=null,ge}function D(ge,ce,we){return ge.index=we,d?(we=ge.alternate,we!==null?(we=we.index,we<ce?(ge.flags|=2,ce):we):(ge.flags|=2,ce)):(ge.flags|=1048576,ce)}function G(ge){return d&&ge.alternate===null&&(ge.flags|=2),ge}function ee(ge,ce,we,et){return ce===null||ce.tag!==6?(ce=Xv(we,ge.mode,et),ce.return=ge,ce):(ce=M(ce,we),ce.return=ge,ce)}function ae(ge,ce,we,et){var St=we.type;return St===R?Ge(ge,ce,we.props.children,et,we.key):ce!==null&&(ce.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===U&&nx(St)===ce.type)?(et=M(ce,we.props),et.ref=yh(ge,ce,we),et.return=ge,et):(et=Of(we.type,we.key,we.props,null,ge.mode,et),et.ref=yh(ge,ce,we),et.return=ge,et)}function Se(ge,ce,we,et){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==we.containerInfo||ce.stateNode.implementation!==we.implementation?(ce=Yv(we,ge.mode,et),ce.return=ge,ce):(ce=M(ce,we.children||[]),ce.return=ge,ce)}function Ge(ge,ce,we,et,St){return ce===null||ce.tag!==7?(ce=ku(we,ge.mode,et,St),ce.return=ge,ce):(ce=M(ce,we),ce.return=ge,ce)}function je(ge,ce,we){if(typeof ce=="string"&&ce!==""||typeof ce=="number")return ce=Xv(""+ce,ge.mode,we),ce.return=ge,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case k:return we=Of(ce.type,ce.key,ce.props,null,ge.mode,we),we.ref=yh(ge,null,ce),we.return=ge,we;case C:return ce=Yv(ce,ge.mode,we),ce.return=ge,ce;case U:var et=ce._init;return je(ge,et(ce._payload),we)}if(ft(ce)||H(ce))return ce=ku(ce,ge.mode,we,null),ce.return=ge,ce;df(ge,ce)}return null}function ze(ge,ce,we,et){var St=ce!==null?ce.key:null;if(typeof we=="string"&&we!==""||typeof we=="number")return St!==null?null:ee(ge,ce,""+we,et);if(typeof we=="object"&&we!==null){switch(we.$$typeof){case k:return we.key===St?ae(ge,ce,we,et):null;case C:return we.key===St?Se(ge,ce,we,et):null;case U:return St=we._init,ze(ge,ce,St(we._payload),et)}if(ft(we)||H(we))return St!==null?null:Ge(ge,ce,we,et,null);df(ge,we)}return null}function ht(ge,ce,we,et,St){if(typeof et=="string"&&et!==""||typeof et=="number")return ge=ge.get(we)||null,ee(ce,ge,""+et,St);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case k:return ge=ge.get(et.key===null?we:et.key)||null,ae(ce,ge,et,St);case C:return ge=ge.get(et.key===null?we:et.key)||null,Se(ce,ge,et,St);case U:var Ot=et._init;return ht(ge,ce,we,Ot(et._payload),St)}if(ft(et)||H(et))return ge=ge.get(we)||null,Ge(ce,ge,et,St,null);df(ce,et)}return null}function yt(ge,ce,we,et){for(var St=null,Ot=null,Lt=ce,qt=ce=0,vr=null;Lt!==null&&qt<we.length;qt++){Lt.index>qt?(vr=Lt,Lt=null):vr=Lt.sibling;var mn=ze(ge,Lt,we[qt],et);if(mn===null){Lt===null&&(Lt=vr);break}d&&Lt&&mn.alternate===null&&p(ge,Lt),ce=D(mn,ce,qt),Ot===null?St=mn:Ot.sibling=mn,Ot=mn,Lt=vr}if(qt===we.length)return b(ge,Lt),Bn&&vu(ge,qt),St;if(Lt===null){for(;qt<we.length;qt++)Lt=je(ge,we[qt],et),Lt!==null&&(ce=D(Lt,ce,qt),Ot===null?St=Lt:Ot.sibling=Lt,Ot=Lt);return Bn&&vu(ge,qt),St}for(Lt=S(ge,Lt);qt<we.length;qt++)vr=ht(Lt,ge,qt,we[qt],et),vr!==null&&(d&&vr.alternate!==null&&Lt.delete(vr.key===null?qt:vr.key),ce=D(vr,ce,qt),Ot===null?St=vr:Ot.sibling=vr,Ot=vr);return d&&Lt.forEach(function(As){return p(ge,As)}),Bn&&vu(ge,qt),St}function xt(ge,ce,we,et){var St=H(we);if(typeof St!="function")throw Error(t(150));if(we=St.call(we),we==null)throw Error(t(151));for(var Ot=St=null,Lt=ce,qt=ce=0,vr=null,mn=we.next();Lt!==null&&!mn.done;qt++,mn=we.next()){Lt.index>qt?(vr=Lt,Lt=null):vr=Lt.sibling;var As=ze(ge,Lt,mn.value,et);if(As===null){Lt===null&&(Lt=vr);break}d&&Lt&&As.alternate===null&&p(ge,Lt),ce=D(As,ce,qt),Ot===null?St=As:Ot.sibling=As,Ot=As,Lt=vr}if(mn.done)return b(ge,Lt),Bn&&vu(ge,qt),St;if(Lt===null){for(;!mn.done;qt++,mn=we.next())mn=je(ge,mn.value,et),mn!==null&&(ce=D(mn,ce,qt),Ot===null?St=mn:Ot.sibling=mn,Ot=mn);return Bn&&vu(ge,qt),St}for(Lt=S(ge,Lt);!mn.done;qt++,mn=we.next())mn=ht(Lt,ge,qt,mn.value,et),mn!==null&&(d&&mn.alternate!==null&&Lt.delete(mn.key===null?qt:mn.key),ce=D(mn,ce,qt),Ot===null?St=mn:Ot.sibling=mn,Ot=mn);return d&&Lt.forEach(function(eI){return p(ge,eI)}),Bn&&vu(ge,qt),St}function Kn(ge,ce,we,et){if(typeof we=="object"&&we!==null&&we.type===R&&we.key===null&&(we=we.props.children),typeof we=="object"&&we!==null){switch(we.$$typeof){case k:e:{for(var St=we.key,Ot=ce;Ot!==null;){if(Ot.key===St){if(St=we.type,St===R){if(Ot.tag===7){b(ge,Ot.sibling),ce=M(Ot,we.props.children),ce.return=ge,ge=ce;break e}}else if(Ot.elementType===St||typeof St=="object"&&St!==null&&St.$$typeof===U&&nx(St)===Ot.type){b(ge,Ot.sibling),ce=M(Ot,we.props),ce.ref=yh(ge,Ot,we),ce.return=ge,ge=ce;break e}b(ge,Ot);break}else p(ge,Ot);Ot=Ot.sibling}we.type===R?(ce=ku(we.props.children,ge.mode,et,we.key),ce.return=ge,ge=ce):(et=Of(we.type,we.key,we.props,null,ge.mode,et),et.ref=yh(ge,ce,we),et.return=ge,ge=et)}return G(ge);case C:e:{for(Ot=we.key;ce!==null;){if(ce.key===Ot)if(ce.tag===4&&ce.stateNode.containerInfo===we.containerInfo&&ce.stateNode.implementation===we.implementation){b(ge,ce.sibling),ce=M(ce,we.children||[]),ce.return=ge,ge=ce;break e}else{b(ge,ce);break}else p(ge,ce);ce=ce.sibling}ce=Yv(we,ge.mode,et),ce.return=ge,ge=ce}return G(ge);case U:return Ot=we._init,Kn(ge,ce,Ot(we._payload),et)}if(ft(we))return yt(ge,ce,we,et);if(H(we))return xt(ge,ce,we,et);df(ge,we)}return typeof we=="string"&&we!==""||typeof we=="number"?(we=""+we,ce!==null&&ce.tag===6?(b(ge,ce.sibling),ce=M(ce,we),ce.return=ge,ge=ce):(b(ge,ce),ce=Xv(we,ge.mode,et),ce.return=ge,ge=ce),G(ge)):b(ge,ce)}return Kn}var Il=rx(!0),ix=rx(!1),ff=ys(null),pf=null,Dl=null,iv=null;function ov(){iv=Dl=pf=null}function av(d){var p=ff.current;Ln(ff),d._currentValue=p}function sv(d,p,b){for(;d!==null;){var S=d.alternate;if((d.childLanes&p)!==p?(d.childLanes|=p,S!==null&&(S.childLanes|=p)):S!==null&&(S.childLanes&p)!==p&&(S.childLanes|=p),d===b)break;d=d.return}}function Nl(d,p){pf=d,iv=Dl=null,d=d.dependencies,d!==null&&d.firstContext!==null&&((d.lanes&p)!==0&&(ui=!0),d.firstContext=null)}function $i(d){var p=d._currentValue;if(iv!==d)if(d={context:d,memoizedValue:p,next:null},Dl===null){if(pf===null)throw Error(t(308));Dl=d,pf.dependencies={lanes:0,firstContext:d}}else Dl=Dl.next=d;return p}var yu=null;function uv(d){yu===null?yu=[d]:yu.push(d)}function ox(d,p,b,S){var M=p.interleaved;return M===null?(b.next=b,uv(p)):(b.next=M.next,M.next=b),p.interleaved=b,Ca(d,S)}function Ca(d,p){d.lanes|=p;var b=d.alternate;for(b!==null&&(b.lanes|=p),b=d,d=d.return;d!==null;)d.childLanes|=p,b=d.alternate,b!==null&&(b.childLanes|=p),b=d,d=d.return;return b.tag===3?b.stateNode:null}var _s=!1;function lv(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function ax(d,p){d=d.updateQueue,p.updateQueue===d&&(p.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,effects:d.effects})}function Ta(d,p){return{eventTime:d,lane:p,tag:0,payload:null,callback:null,next:null}}function xs(d,p,b){var S=d.updateQueue;if(S===null)return null;if(S=S.shared,(dn&2)!==0){var M=S.pending;return M===null?p.next=p:(p.next=M.next,M.next=p),S.pending=p,Ca(d,b)}return M=S.interleaved,M===null?(p.next=p,uv(S)):(p.next=M.next,M.next=p),S.interleaved=p,Ca(d,b)}function mf(d,p,b){if(p=p.updateQueue,p!==null&&(p=p.shared,(b&4194240)!==0)){var S=p.lanes;S&=d.pendingLanes,b|=S,p.lanes=b,fu(d,b)}}function sx(d,p){var b=d.updateQueue,S=d.alternate;if(S!==null&&(S=S.updateQueue,b===S)){var M=null,D=null;if(b=b.firstBaseUpdate,b!==null){do{var G={eventTime:b.eventTime,lane:b.lane,tag:b.tag,payload:b.payload,callback:b.callback,next:null};D===null?M=D=G:D=D.next=G,b=b.next}while(b!==null);D===null?M=D=p:D=D.next=p}else M=D=p;b={baseState:S.baseState,firstBaseUpdate:M,lastBaseUpdate:D,shared:S.shared,effects:S.effects},d.updateQueue=b;return}d=b.lastBaseUpdate,d===null?b.firstBaseUpdate=p:d.next=p,b.lastBaseUpdate=p}function gf(d,p,b,S){var M=d.updateQueue;_s=!1;var D=M.firstBaseUpdate,G=M.lastBaseUpdate,ee=M.shared.pending;if(ee!==null){M.shared.pending=null;var ae=ee,Se=ae.next;ae.next=null,G===null?D=Se:G.next=Se,G=ae;var Ge=d.alternate;Ge!==null&&(Ge=Ge.updateQueue,ee=Ge.lastBaseUpdate,ee!==G&&(ee===null?Ge.firstBaseUpdate=Se:ee.next=Se,Ge.lastBaseUpdate=ae))}if(D!==null){var je=M.baseState;G=0,Ge=Se=ae=null,ee=D;do{var ze=ee.lane,ht=ee.eventTime;if((S&ze)===ze){Ge!==null&&(Ge=Ge.next={eventTime:ht,lane:0,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null});e:{var yt=d,xt=ee;switch(ze=p,ht=b,xt.tag){case 1:if(yt=xt.payload,typeof yt=="function"){je=yt.call(ht,je,ze);break e}je=yt;break e;case 3:yt.flags=yt.flags&-65537|128;case 0:if(yt=xt.payload,ze=typeof yt=="function"?yt.call(ht,je,ze):yt,ze==null)break e;je=W({},je,ze);break e;case 2:_s=!0}}ee.callback!==null&&ee.lane!==0&&(d.flags|=64,ze=M.effects,ze===null?M.effects=[ee]:ze.push(ee))}else ht={eventTime:ht,lane:ze,tag:ee.tag,payload:ee.payload,callback:ee.callback,next:null},Ge===null?(Se=Ge=ht,ae=je):Ge=Ge.next=ht,G|=ze;if(ee=ee.next,ee===null){if(ee=M.shared.pending,ee===null)break;ze=ee,ee=ze.next,ze.next=null,M.lastBaseUpdate=ze,M.shared.pending=null}}while(!0);if(Ge===null&&(ae=je),M.baseState=ae,M.firstBaseUpdate=Se,M.lastBaseUpdate=Ge,p=M.shared.interleaved,p!==null){M=p;do G|=M.lane,M=M.next;while(M!==p)}else D===null&&(M.shared.lanes=0);_u|=G,d.lanes=G,d.memoizedState=je}}function ux(d,p,b){if(d=p.effects,p.effects=null,d!==null)for(p=0;p<d.length;p++){var S=d[p],M=S.callback;if(M!==null){if(S.callback=null,S=b,typeof M!="function")throw Error(t(191,M));M.call(S)}}}var bh={},$o=ys(bh),wh=ys(bh),_h=ys(bh);function bu(d){if(d===bh)throw Error(t(174));return d}function cv(d,p){switch(Dn(_h,p),Dn(wh,d),Dn($o,bh),d=p.nodeType,d){case 9:case 11:p=(p=p.documentElement)?p.namespaceURI:Pe(null,"");break;default:d=d===8?p.parentNode:p,p=d.namespaceURI||null,d=d.tagName,p=Pe(p,d)}Ln($o),Dn($o,p)}function Pl(){Ln($o),Ln(wh),Ln(_h)}function lx(d){bu(_h.current);var p=bu($o.current),b=Pe(p,d.type);p!==b&&(Dn(wh,d),Dn($o,b))}function hv(d){wh.current===d&&(Ln($o),Ln(wh))}var Un=ys(0);function vf(d){for(var p=d;p!==null;){if(p.tag===13){var b=p.memoizedState;if(b!==null&&(b=b.dehydrated,b===null||b.data==="$?"||b.data==="$!"))return p}else if(p.tag===19&&p.memoizedProps.revealOrder!==void 0){if((p.flags&128)!==0)return p}else if(p.child!==null){p.child.return=p,p=p.child;continue}if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return null;p=p.return}p.sibling.return=p.return,p=p.sibling}return null}var dv=[];function fv(){for(var d=0;d<dv.length;d++)dv[d]._workInProgressVersionPrimary=null;dv.length=0}var yf=_.ReactCurrentDispatcher,pv=_.ReactCurrentBatchConfig,wu=0,zn=null,nr=null,mr=null,bf=!1,xh=!1,Sh=0,x4=0;function Dr(){throw Error(t(321))}function mv(d,p){if(p===null)return!1;for(var b=0;b<p.length&&b<d.length;b++)if(!go(d[b],p[b]))return!1;return!0}function gv(d,p,b,S,M,D){if(wu=D,zn=p,p.memoizedState=null,p.updateQueue=null,p.lanes=0,yf.current=d===null||d.memoizedState===null?C4:T4,d=b(S,M),xh){D=0;do{if(xh=!1,Sh=0,25<=D)throw Error(t(301));D+=1,mr=nr=null,p.updateQueue=null,yf.current=M4,d=b(S,M)}while(xh)}if(yf.current=xf,p=nr!==null&&nr.next!==null,wu=0,mr=nr=zn=null,bf=!1,p)throw Error(t(300));return d}function vv(){var d=Sh!==0;return Sh=0,d}function Xo(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mr===null?zn.memoizedState=mr=d:mr=mr.next=d,mr}function Xi(){if(nr===null){var d=zn.alternate;d=d!==null?d.memoizedState:null}else d=nr.next;var p=mr===null?zn.memoizedState:mr.next;if(p!==null)mr=p,nr=d;else{if(d===null)throw Error(t(310));nr=d,d={memoizedState:nr.memoizedState,baseState:nr.baseState,baseQueue:nr.baseQueue,queue:nr.queue,next:null},mr===null?zn.memoizedState=mr=d:mr=mr.next=d}return mr}function Eh(d,p){return typeof p=="function"?p(d):p}function yv(d){var p=Xi(),b=p.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=d;var S=nr,M=S.baseQueue,D=b.pending;if(D!==null){if(M!==null){var G=M.next;M.next=D.next,D.next=G}S.baseQueue=M=D,b.pending=null}if(M!==null){D=M.next,S=S.baseState;var ee=G=null,ae=null,Se=D;do{var Ge=Se.lane;if((wu&Ge)===Ge)ae!==null&&(ae=ae.next={lane:0,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null}),S=Se.hasEagerState?Se.eagerState:d(S,Se.action);else{var je={lane:Ge,action:Se.action,hasEagerState:Se.hasEagerState,eagerState:Se.eagerState,next:null};ae===null?(ee=ae=je,G=S):ae=ae.next=je,zn.lanes|=Ge,_u|=Ge}Se=Se.next}while(Se!==null&&Se!==D);ae===null?G=S:ae.next=ee,go(S,p.memoizedState)||(ui=!0),p.memoizedState=S,p.baseState=G,p.baseQueue=ae,b.lastRenderedState=S}if(d=b.interleaved,d!==null){M=d;do D=M.lane,zn.lanes|=D,_u|=D,M=M.next;while(M!==d)}else M===null&&(b.lanes=0);return[p.memoizedState,b.dispatch]}function bv(d){var p=Xi(),b=p.queue;if(b===null)throw Error(t(311));b.lastRenderedReducer=d;var S=b.dispatch,M=b.pending,D=p.memoizedState;if(M!==null){b.pending=null;var G=M=M.next;do D=d(D,G.action),G=G.next;while(G!==M);go(D,p.memoizedState)||(ui=!0),p.memoizedState=D,p.baseQueue===null&&(p.baseState=D),b.lastRenderedState=D}return[D,S]}function cx(){}function hx(d,p){var b=zn,S=Xi(),M=p(),D=!go(S.memoizedState,M);if(D&&(S.memoizedState=M,ui=!0),S=S.queue,wv(px.bind(null,b,S,d),[d]),S.getSnapshot!==p||D||mr!==null&&mr.memoizedState.tag&1){if(b.flags|=2048,kh(9,fx.bind(null,b,S,M,p),void 0,null),gr===null)throw Error(t(349));(wu&30)!==0||dx(b,p,M)}return M}function dx(d,p,b){d.flags|=16384,d={getSnapshot:p,value:b},p=zn.updateQueue,p===null?(p={lastEffect:null,stores:null},zn.updateQueue=p,p.stores=[d]):(b=p.stores,b===null?p.stores=[d]:b.push(d))}function fx(d,p,b,S){p.value=b,p.getSnapshot=S,mx(p)&&gx(d)}function px(d,p,b){return b(function(){mx(p)&&gx(d)})}function mx(d){var p=d.getSnapshot;d=d.value;try{var b=p();return!go(d,b)}catch{return!0}}function gx(d){var p=Ca(d,1);p!==null&&_o(p,d,1,-1)}function vx(d){var p=Xo();return typeof d=="function"&&(d=d()),p.memoizedState=p.baseState=d,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Eh,lastRenderedState:d},p.queue=d,d=d.dispatch=k4.bind(null,zn,d),[p.memoizedState,d]}function kh(d,p,b,S){return d={tag:d,create:p,destroy:b,deps:S,next:null},p=zn.updateQueue,p===null?(p={lastEffect:null,stores:null},zn.updateQueue=p,p.lastEffect=d.next=d):(b=p.lastEffect,b===null?p.lastEffect=d.next=d:(S=b.next,b.next=d,d.next=S,p.lastEffect=d)),d}function yx(){return Xi().memoizedState}function wf(d,p,b,S){var M=Xo();zn.flags|=d,M.memoizedState=kh(1|p,b,void 0,S===void 0?null:S)}function _f(d,p,b,S){var M=Xi();S=S===void 0?null:S;var D=void 0;if(nr!==null){var G=nr.memoizedState;if(D=G.destroy,S!==null&&mv(S,G.deps)){M.memoizedState=kh(p,b,D,S);return}}zn.flags|=d,M.memoizedState=kh(1|p,b,D,S)}function bx(d,p){return wf(8390656,8,d,p)}function wv(d,p){return _f(2048,8,d,p)}function wx(d,p){return _f(4,2,d,p)}function _x(d,p){return _f(4,4,d,p)}function xx(d,p){if(typeof p=="function")return d=d(),p(d),function(){p(null)};if(p!=null)return d=d(),p.current=d,function(){p.current=null}}function Sx(d,p,b){return b=b!=null?b.concat([d]):null,_f(4,4,xx.bind(null,p,d),b)}function _v(){}function Ex(d,p){var b=Xi();p=p===void 0?null:p;var S=b.memoizedState;return S!==null&&p!==null&&mv(p,S[1])?S[0]:(b.memoizedState=[d,p],d)}function kx(d,p){var b=Xi();p=p===void 0?null:p;var S=b.memoizedState;return S!==null&&p!==null&&mv(p,S[1])?S[0]:(d=d(),b.memoizedState=[d,p],d)}function Cx(d,p,b){return(wu&21)===0?(d.baseState&&(d.baseState=!1,ui=!0),d.memoizedState=b):(go(b,p)||(b=Jr(),zn.lanes|=b,_u|=b,d.baseState=!0),p)}function S4(d,p){var b=rn;rn=b!==0&&4>b?b:4,d(!0);var S=pv.transition;pv.transition={};try{d(!1),p()}finally{rn=b,pv.transition=S}}function Tx(){return Xi().memoizedState}function E4(d,p,b){var S=Cs(d);if(b={lane:S,action:b,hasEagerState:!1,eagerState:null,next:null},Mx(d))Ax(p,b);else if(b=ox(d,p,b,S),b!==null){var M=Qr();_o(b,d,S,M),Rx(b,p,S)}}function k4(d,p,b){var S=Cs(d),M={lane:S,action:b,hasEagerState:!1,eagerState:null,next:null};if(Mx(d))Ax(p,M);else{var D=d.alternate;if(d.lanes===0&&(D===null||D.lanes===0)&&(D=p.lastRenderedReducer,D!==null))try{var G=p.lastRenderedState,ee=D(G,b);if(M.hasEagerState=!0,M.eagerState=ee,go(ee,G)){var ae=p.interleaved;ae===null?(M.next=M,uv(p)):(M.next=ae.next,ae.next=M),p.interleaved=M;return}}catch{}finally{}b=ox(d,p,M,S),b!==null&&(M=Qr(),_o(b,d,S,M),Rx(b,p,S))}}function Mx(d){var p=d.alternate;return d===zn||p!==null&&p===zn}function Ax(d,p){xh=bf=!0;var b=d.pending;b===null?p.next=p:(p.next=b.next,b.next=p),d.pending=p}function Rx(d,p,b){if((b&4194240)!==0){var S=p.lanes;S&=d.pendingLanes,b|=S,p.lanes=b,fu(d,b)}}var xf={readContext:$i,useCallback:Dr,useContext:Dr,useEffect:Dr,useImperativeHandle:Dr,useInsertionEffect:Dr,useLayoutEffect:Dr,useMemo:Dr,useReducer:Dr,useRef:Dr,useState:Dr,useDebugValue:Dr,useDeferredValue:Dr,useTransition:Dr,useMutableSource:Dr,useSyncExternalStore:Dr,useId:Dr,unstable_isNewReconciler:!1},C4={readContext:$i,useCallback:function(d,p){return Xo().memoizedState=[d,p===void 0?null:p],d},useContext:$i,useEffect:bx,useImperativeHandle:function(d,p,b){return b=b!=null?b.concat([d]):null,wf(4194308,4,xx.bind(null,p,d),b)},useLayoutEffect:function(d,p){return wf(4194308,4,d,p)},useInsertionEffect:function(d,p){return wf(4,2,d,p)},useMemo:function(d,p){var b=Xo();return p=p===void 0?null:p,d=d(),b.memoizedState=[d,p],d},useReducer:function(d,p,b){var S=Xo();return p=b!==void 0?b(p):p,S.memoizedState=S.baseState=p,d={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:p},S.queue=d,d=d.dispatch=E4.bind(null,zn,d),[S.memoizedState,d]},useRef:function(d){var p=Xo();return d={current:d},p.memoizedState=d},useState:vx,useDebugValue:_v,useDeferredValue:function(d){return Xo().memoizedState=d},useTransition:function(){var d=vx(!1),p=d[0];return d=S4.bind(null,d[1]),Xo().memoizedState=d,[p,d]},useMutableSource:function(){},useSyncExternalStore:function(d,p,b){var S=zn,M=Xo();if(Bn){if(b===void 0)throw Error(t(407));b=b()}else{if(b=p(),gr===null)throw Error(t(349));(wu&30)!==0||dx(S,p,b)}M.memoizedState=b;var D={value:b,getSnapshot:p};return M.queue=D,bx(px.bind(null,S,D,d),[d]),S.flags|=2048,kh(9,fx.bind(null,S,D,b,p),void 0,null),b},useId:function(){var d=Xo(),p=gr.identifierPrefix;if(Bn){var b=ka,S=Ea;b=(S&~(1<<32-ln(S)-1)).toString(32)+b,p=":"+p+"R"+b,b=Sh++,0<b&&(p+="H"+b.toString(32)),p+=":"}else b=x4++,p=":"+p+"r"+b.toString(32)+":";return d.memoizedState=p},unstable_isNewReconciler:!1},T4={readContext:$i,useCallback:Ex,useContext:$i,useEffect:wv,useImperativeHandle:Sx,useInsertionEffect:wx,useLayoutEffect:_x,useMemo:kx,useReducer:yv,useRef:yx,useState:function(){return yv(Eh)},useDebugValue:_v,useDeferredValue:function(d){var p=Xi();return Cx(p,nr.memoizedState,d)},useTransition:function(){var d=yv(Eh)[0],p=Xi().memoizedState;return[d,p]},useMutableSource:cx,useSyncExternalStore:hx,useId:Tx,unstable_isNewReconciler:!1},M4={readContext:$i,useCallback:Ex,useContext:$i,useEffect:wv,useImperativeHandle:Sx,useInsertionEffect:wx,useLayoutEffect:_x,useMemo:kx,useReducer:bv,useRef:yx,useState:function(){return bv(Eh)},useDebugValue:_v,useDeferredValue:function(d){var p=Xi();return nr===null?p.memoizedState=d:Cx(p,nr.memoizedState,d)},useTransition:function(){var d=bv(Eh)[0],p=Xi().memoizedState;return[d,p]},useMutableSource:cx,useSyncExternalStore:hx,useId:Tx,unstable_isNewReconciler:!1};function yo(d,p){if(d&&d.defaultProps){p=W({},p),d=d.defaultProps;for(var b in d)p[b]===void 0&&(p[b]=d[b]);return p}return p}function xv(d,p,b,S){p=d.memoizedState,b=b(S,p),b=b==null?p:W({},p,b),d.memoizedState=b,d.lanes===0&&(d.updateQueue.baseState=b)}var Sf={isMounted:function(d){return(d=d._reactInternals)?po(d)===d:!1},enqueueSetState:function(d,p,b){d=d._reactInternals;var S=Qr(),M=Cs(d),D=Ta(S,M);D.payload=p,b!=null&&(D.callback=b),p=xs(d,D,M),p!==null&&(_o(p,d,M,S),mf(p,d,M))},enqueueReplaceState:function(d,p,b){d=d._reactInternals;var S=Qr(),M=Cs(d),D=Ta(S,M);D.tag=1,D.payload=p,b!=null&&(D.callback=b),p=xs(d,D,M),p!==null&&(_o(p,d,M,S),mf(p,d,M))},enqueueForceUpdate:function(d,p){d=d._reactInternals;var b=Qr(),S=Cs(d),M=Ta(b,S);M.tag=2,p!=null&&(M.callback=p),p=xs(d,M,S),p!==null&&(_o(p,d,S,b),mf(p,d,S))}};function Ix(d,p,b,S,M,D,G){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(S,D,G):p.prototype&&p.prototype.isPureReactComponent?!hh(b,S)||!hh(M,D):!0}function Dx(d,p,b){var S=!1,M=bs,D=p.contextType;return typeof D=="object"&&D!==null?D=$i(D):(M=si(p)?mu:Ir.current,S=p.contextTypes,D=(S=S!=null)?Tl(d,M):bs),p=new p(b,D),d.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,p.updater=Sf,d.stateNode=p,p._reactInternals=d,S&&(d=d.stateNode,d.__reactInternalMemoizedUnmaskedChildContext=M,d.__reactInternalMemoizedMaskedChildContext=D),p}function Nx(d,p,b,S){d=p.state,typeof p.componentWillReceiveProps=="function"&&p.componentWillReceiveProps(b,S),typeof p.UNSAFE_componentWillReceiveProps=="function"&&p.UNSAFE_componentWillReceiveProps(b,S),p.state!==d&&Sf.enqueueReplaceState(p,p.state,null)}function Sv(d,p,b,S){var M=d.stateNode;M.props=b,M.state=d.memoizedState,M.refs={},lv(d);var D=p.contextType;typeof D=="object"&&D!==null?M.context=$i(D):(D=si(p)?mu:Ir.current,M.context=Tl(d,D)),M.state=d.memoizedState,D=p.getDerivedStateFromProps,typeof D=="function"&&(xv(d,p,D,b),M.state=d.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof M.getSnapshotBeforeUpdate=="function"||typeof M.UNSAFE_componentWillMount!="function"&&typeof M.componentWillMount!="function"||(p=M.state,typeof M.componentWillMount=="function"&&M.componentWillMount(),typeof M.UNSAFE_componentWillMount=="function"&&M.UNSAFE_componentWillMount(),p!==M.state&&Sf.enqueueReplaceState(M,M.state,null),gf(d,b,M,S),M.state=d.memoizedState),typeof M.componentDidMount=="function"&&(d.flags|=4194308)}function Fl(d,p){try{var b="",S=p;do b+=ye(S),S=S.return;while(S);var M=b}catch(D){M=`
Error generating stack: `+D.message+`
`+D.stack}return{value:d,source:p,stack:M,digest:null}}function Ev(d,p,b){return{value:d,source:null,stack:b??null,digest:p??null}}function kv(d,p){try{console.error(p.value)}catch(b){setTimeout(function(){throw b})}}var A4=typeof WeakMap=="function"?WeakMap:Map;function Px(d,p,b){b=Ta(-1,b),b.tag=3,b.payload={element:null};var S=p.value;return b.callback=function(){Rf||(Rf=!0,zv=S),kv(d,p)},b}function Fx(d,p,b){b=Ta(-1,b),b.tag=3;var S=d.type.getDerivedStateFromError;if(typeof S=="function"){var M=p.value;b.payload=function(){return S(M)},b.callback=function(){kv(d,p)}}var D=d.stateNode;return D!==null&&typeof D.componentDidCatch=="function"&&(b.callback=function(){kv(d,p),typeof S!="function"&&(Es===null?Es=new Set([this]):Es.add(this));var G=p.stack;this.componentDidCatch(p.value,{componentStack:G!==null?G:""})}),b}function Ox(d,p,b){var S=d.pingCache;if(S===null){S=d.pingCache=new A4;var M=new Set;S.set(p,M)}else M=S.get(p),M===void 0&&(M=new Set,S.set(p,M));M.has(b)||(M.add(b),d=G4.bind(null,d,p,b),p.then(d,d))}function Lx(d){do{var p;if((p=d.tag===13)&&(p=d.memoizedState,p=p!==null?p.dehydrated!==null:!0),p)return d;d=d.return}while(d!==null);return null}function Bx(d,p,b,S,M){return(d.mode&1)===0?(d===p?d.flags|=65536:(d.flags|=128,b.flags|=131072,b.flags&=-52805,b.tag===1&&(b.alternate===null?b.tag=17:(p=Ta(-1,1),p.tag=2,xs(b,p,1))),b.lanes|=1),d):(d.flags|=65536,d.lanes=M,d)}var R4=_.ReactCurrentOwner,ui=!1;function Zr(d,p,b,S){p.child=d===null?ix(p,null,b,S):Il(p,d.child,b,S)}function Ux(d,p,b,S,M){b=b.render;var D=p.ref;return Nl(p,M),S=gv(d,p,b,S,D,M),b=vv(),d!==null&&!ui?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~M,Ma(d,p,M)):(Bn&&b&&Qg(p),p.flags|=1,Zr(d,p,S,M),p.child)}function zx(d,p,b,S,M){if(d===null){var D=b.type;return typeof D=="function"&&!$v(D)&&D.defaultProps===void 0&&b.compare===null&&b.defaultProps===void 0?(p.tag=15,p.type=D,Wx(d,p,D,S,M)):(d=Of(b.type,null,S,p,p.mode,M),d.ref=p.ref,d.return=p,p.child=d)}if(D=d.child,(d.lanes&M)===0){var G=D.memoizedProps;if(b=b.compare,b=b!==null?b:hh,b(G,S)&&d.ref===p.ref)return Ma(d,p,M)}return p.flags|=1,d=Ms(D,S),d.ref=p.ref,d.return=p,p.child=d}function Wx(d,p,b,S,M){if(d!==null){var D=d.memoizedProps;if(hh(D,S)&&d.ref===p.ref)if(ui=!1,p.pendingProps=S=D,(d.lanes&M)!==0)(d.flags&131072)!==0&&(ui=!0);else return p.lanes=d.lanes,Ma(d,p,M)}return Cv(d,p,b,S,M)}function Hx(d,p,b){var S=p.pendingProps,M=S.children,D=d!==null?d.memoizedState:null;if(S.mode==="hidden")if((p.mode&1)===0)p.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dn(Ll,Ti),Ti|=b;else{if((b&1073741824)===0)return d=D!==null?D.baseLanes|b:b,p.lanes=p.childLanes=1073741824,p.memoizedState={baseLanes:d,cachePool:null,transitions:null},p.updateQueue=null,Dn(Ll,Ti),Ti|=d,null;p.memoizedState={baseLanes:0,cachePool:null,transitions:null},S=D!==null?D.baseLanes:b,Dn(Ll,Ti),Ti|=S}else D!==null?(S=D.baseLanes|b,p.memoizedState=null):S=b,Dn(Ll,Ti),Ti|=S;return Zr(d,p,M,b),p.child}function Gx(d,p){var b=p.ref;(d===null&&b!==null||d!==null&&d.ref!==b)&&(p.flags|=512,p.flags|=2097152)}function Cv(d,p,b,S,M){var D=si(b)?mu:Ir.current;return D=Tl(p,D),Nl(p,M),b=gv(d,p,b,S,D,M),S=vv(),d!==null&&!ui?(p.updateQueue=d.updateQueue,p.flags&=-2053,d.lanes&=~M,Ma(d,p,M)):(Bn&&S&&Qg(p),p.flags|=1,Zr(d,p,b,M),p.child)}function Vx(d,p,b,S,M){if(si(b)){var D=!0;sf(p)}else D=!1;if(Nl(p,M),p.stateNode===null)kf(d,p),Dx(p,b,S),Sv(p,b,S,M),S=!0;else if(d===null){var G=p.stateNode,ee=p.memoizedProps;G.props=ee;var ae=G.context,Se=b.contextType;typeof Se=="object"&&Se!==null?Se=$i(Se):(Se=si(b)?mu:Ir.current,Se=Tl(p,Se));var Ge=b.getDerivedStateFromProps,je=typeof Ge=="function"||typeof G.getSnapshotBeforeUpdate=="function";je||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(ee!==S||ae!==Se)&&Nx(p,G,S,Se),_s=!1;var ze=p.memoizedState;G.state=ze,gf(p,S,G,M),ae=p.memoizedState,ee!==S||ze!==ae||ai.current||_s?(typeof Ge=="function"&&(xv(p,b,Ge,S),ae=p.memoizedState),(ee=_s||Ix(p,b,ee,S,ze,ae,Se))?(je||typeof G.UNSAFE_componentWillMount!="function"&&typeof G.componentWillMount!="function"||(typeof G.componentWillMount=="function"&&G.componentWillMount(),typeof G.UNSAFE_componentWillMount=="function"&&G.UNSAFE_componentWillMount()),typeof G.componentDidMount=="function"&&(p.flags|=4194308)):(typeof G.componentDidMount=="function"&&(p.flags|=4194308),p.memoizedProps=S,p.memoizedState=ae),G.props=S,G.state=ae,G.context=Se,S=ee):(typeof G.componentDidMount=="function"&&(p.flags|=4194308),S=!1)}else{G=p.stateNode,ax(d,p),ee=p.memoizedProps,Se=p.type===p.elementType?ee:yo(p.type,ee),G.props=Se,je=p.pendingProps,ze=G.context,ae=b.contextType,typeof ae=="object"&&ae!==null?ae=$i(ae):(ae=si(b)?mu:Ir.current,ae=Tl(p,ae));var ht=b.getDerivedStateFromProps;(Ge=typeof ht=="function"||typeof G.getSnapshotBeforeUpdate=="function")||typeof G.UNSAFE_componentWillReceiveProps!="function"&&typeof G.componentWillReceiveProps!="function"||(ee!==je||ze!==ae)&&Nx(p,G,S,ae),_s=!1,ze=p.memoizedState,G.state=ze,gf(p,S,G,M);var yt=p.memoizedState;ee!==je||ze!==yt||ai.current||_s?(typeof ht=="function"&&(xv(p,b,ht,S),yt=p.memoizedState),(Se=_s||Ix(p,b,Se,S,ze,yt,ae)||!1)?(Ge||typeof G.UNSAFE_componentWillUpdate!="function"&&typeof G.componentWillUpdate!="function"||(typeof G.componentWillUpdate=="function"&&G.componentWillUpdate(S,yt,ae),typeof G.UNSAFE_componentWillUpdate=="function"&&G.UNSAFE_componentWillUpdate(S,yt,ae)),typeof G.componentDidUpdate=="function"&&(p.flags|=4),typeof G.getSnapshotBeforeUpdate=="function"&&(p.flags|=1024)):(typeof G.componentDidUpdate!="function"||ee===d.memoizedProps&&ze===d.memoizedState||(p.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||ee===d.memoizedProps&&ze===d.memoizedState||(p.flags|=1024),p.memoizedProps=S,p.memoizedState=yt),G.props=S,G.state=yt,G.context=ae,S=Se):(typeof G.componentDidUpdate!="function"||ee===d.memoizedProps&&ze===d.memoizedState||(p.flags|=4),typeof G.getSnapshotBeforeUpdate!="function"||ee===d.memoizedProps&&ze===d.memoizedState||(p.flags|=1024),S=!1)}return Tv(d,p,b,S,D,M)}function Tv(d,p,b,S,M,D){Gx(d,p);var G=(p.flags&128)!==0;if(!S&&!G)return M&&Y_(p,b,!1),Ma(d,p,D);S=p.stateNode,R4.current=p;var ee=G&&typeof b.getDerivedStateFromError!="function"?null:S.render();return p.flags|=1,d!==null&&G?(p.child=Il(p,d.child,null,D),p.child=Il(p,null,ee,D)):Zr(d,p,ee,D),p.memoizedState=S.state,M&&Y_(p,b,!0),p.child}function jx(d){var p=d.stateNode;p.pendingContext?$_(d,p.pendingContext,p.pendingContext!==p.context):p.context&&$_(d,p.context,!1),cv(d,p.containerInfo)}function qx(d,p,b,S,M){return Rl(),rv(M),p.flags|=256,Zr(d,p,b,S),p.child}var Mv={dehydrated:null,treeContext:null,retryLane:0};function Av(d){return{baseLanes:d,cachePool:null,transitions:null}}function $x(d,p,b){var S=p.pendingProps,M=Un.current,D=!1,G=(p.flags&128)!==0,ee;if((ee=G)||(ee=d!==null&&d.memoizedState===null?!1:(M&2)!==0),ee?(D=!0,p.flags&=-129):(d===null||d.memoizedState!==null)&&(M|=1),Dn(Un,M&1),d===null)return nv(p),d=p.memoizedState,d!==null&&(d=d.dehydrated,d!==null)?((p.mode&1)===0?p.lanes=1:d.data==="$!"?p.lanes=8:p.lanes=1073741824,null):(G=S.children,d=S.fallback,D?(S=p.mode,D=p.child,G={mode:"hidden",children:G},(S&1)===0&&D!==null?(D.childLanes=0,D.pendingProps=G):D=Lf(G,S,0,null),d=ku(d,S,b,null),D.return=p,d.return=p,D.sibling=d,p.child=D,p.child.memoizedState=Av(b),p.memoizedState=Mv,d):Rv(p,G));if(M=d.memoizedState,M!==null&&(ee=M.dehydrated,ee!==null))return I4(d,p,G,S,ee,M,b);if(D){D=S.fallback,G=p.mode,M=d.child,ee=M.sibling;var ae={mode:"hidden",children:S.children};return(G&1)===0&&p.child!==M?(S=p.child,S.childLanes=0,S.pendingProps=ae,p.deletions=null):(S=Ms(M,ae),S.subtreeFlags=M.subtreeFlags&14680064),ee!==null?D=Ms(ee,D):(D=ku(D,G,b,null),D.flags|=2),D.return=p,S.return=p,S.sibling=D,p.child=S,S=D,D=p.child,G=d.child.memoizedState,G=G===null?Av(b):{baseLanes:G.baseLanes|b,cachePool:null,transitions:G.transitions},D.memoizedState=G,D.childLanes=d.childLanes&~b,p.memoizedState=Mv,S}return D=d.child,d=D.sibling,S=Ms(D,{mode:"visible",children:S.children}),(p.mode&1)===0&&(S.lanes=b),S.return=p,S.sibling=null,d!==null&&(b=p.deletions,b===null?(p.deletions=[d],p.flags|=16):b.push(d)),p.child=S,p.memoizedState=null,S}function Rv(d,p){return p=Lf({mode:"visible",children:p},d.mode,0,null),p.return=d,d.child=p}function Ef(d,p,b,S){return S!==null&&rv(S),Il(p,d.child,null,b),d=Rv(p,p.pendingProps.children),d.flags|=2,p.memoizedState=null,d}function I4(d,p,b,S,M,D,G){if(b)return p.flags&256?(p.flags&=-257,S=Ev(Error(t(422))),Ef(d,p,G,S)):p.memoizedState!==null?(p.child=d.child,p.flags|=128,null):(D=S.fallback,M=p.mode,S=Lf({mode:"visible",children:S.children},M,0,null),D=ku(D,M,G,null),D.flags|=2,S.return=p,D.return=p,S.sibling=D,p.child=S,(p.mode&1)!==0&&Il(p,d.child,null,G),p.child.memoizedState=Av(G),p.memoizedState=Mv,D);if((p.mode&1)===0)return Ef(d,p,G,null);if(M.data==="$!"){if(S=M.nextSibling&&M.nextSibling.dataset,S)var ee=S.dgst;return S=ee,D=Error(t(419)),S=Ev(D,S,void 0),Ef(d,p,G,S)}if(ee=(G&d.childLanes)!==0,ui||ee){if(S=gr,S!==null){switch(G&-G){case 4:M=2;break;case 16:M=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:M=32;break;case 536870912:M=268435456;break;default:M=0}M=(M&(S.suspendedLanes|G))!==0?0:M,M!==0&&M!==D.retryLane&&(D.retryLane=M,Ca(d,M),_o(S,d,M,-1))}return qv(),S=Ev(Error(t(421))),Ef(d,p,G,S)}return M.data==="$?"?(p.flags|=128,p.child=d.child,p=V4.bind(null,d),M._reactRetry=p,null):(d=D.treeContext,Ci=vs(M.nextSibling),ki=p,Bn=!0,vo=null,d!==null&&(ji[qi++]=Ea,ji[qi++]=ka,ji[qi++]=gu,Ea=d.id,ka=d.overflow,gu=p),p=Rv(p,S.children),p.flags|=4096,p)}function Xx(d,p,b){d.lanes|=p;var S=d.alternate;S!==null&&(S.lanes|=p),sv(d.return,p,b)}function Iv(d,p,b,S,M){var D=d.memoizedState;D===null?d.memoizedState={isBackwards:p,rendering:null,renderingStartTime:0,last:S,tail:b,tailMode:M}:(D.isBackwards=p,D.rendering=null,D.renderingStartTime=0,D.last=S,D.tail=b,D.tailMode=M)}function Yx(d,p,b){var S=p.pendingProps,M=S.revealOrder,D=S.tail;if(Zr(d,p,S.children,b),S=Un.current,(S&2)!==0)S=S&1|2,p.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=p.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Xx(d,b,p);else if(d.tag===19)Xx(d,b,p);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===p)break e;for(;d.sibling===null;){if(d.return===null||d.return===p)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}S&=1}if(Dn(Un,S),(p.mode&1)===0)p.memoizedState=null;else switch(M){case"forwards":for(b=p.child,M=null;b!==null;)d=b.alternate,d!==null&&vf(d)===null&&(M=b),b=b.sibling;b=M,b===null?(M=p.child,p.child=null):(M=b.sibling,b.sibling=null),Iv(p,!1,M,b,D);break;case"backwards":for(b=null,M=p.child,p.child=null;M!==null;){if(d=M.alternate,d!==null&&vf(d)===null){p.child=M;break}d=M.sibling,M.sibling=b,b=M,M=d}Iv(p,!0,b,null,D);break;case"together":Iv(p,!1,null,null,void 0);break;default:p.memoizedState=null}return p.child}function kf(d,p){(p.mode&1)===0&&d!==null&&(d.alternate=null,p.alternate=null,p.flags|=2)}function Ma(d,p,b){if(d!==null&&(p.dependencies=d.dependencies),_u|=p.lanes,(b&p.childLanes)===0)return null;if(d!==null&&p.child!==d.child)throw Error(t(153));if(p.child!==null){for(d=p.child,b=Ms(d,d.pendingProps),p.child=b,b.return=p;d.sibling!==null;)d=d.sibling,b=b.sibling=Ms(d,d.pendingProps),b.return=p;b.sibling=null}return p.child}function D4(d,p,b){switch(p.tag){case 3:jx(p),Rl();break;case 5:lx(p);break;case 1:si(p.type)&&sf(p);break;case 4:cv(p,p.stateNode.containerInfo);break;case 10:var S=p.type._context,M=p.memoizedProps.value;Dn(ff,S._currentValue),S._currentValue=M;break;case 13:if(S=p.memoizedState,S!==null)return S.dehydrated!==null?(Dn(Un,Un.current&1),p.flags|=128,null):(b&p.child.childLanes)!==0?$x(d,p,b):(Dn(Un,Un.current&1),d=Ma(d,p,b),d!==null?d.sibling:null);Dn(Un,Un.current&1);break;case 19:if(S=(b&p.childLanes)!==0,(d.flags&128)!==0){if(S)return Yx(d,p,b);p.flags|=128}if(M=p.memoizedState,M!==null&&(M.rendering=null,M.tail=null,M.lastEffect=null),Dn(Un,Un.current),S)break;return null;case 22:case 23:return p.lanes=0,Hx(d,p,b)}return Ma(d,p,b)}var Kx,Dv,Jx,Zx;Kx=function(d,p){for(var b=p.child;b!==null;){if(b.tag===5||b.tag===6)d.appendChild(b.stateNode);else if(b.tag!==4&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===p)break;for(;b.sibling===null;){if(b.return===null||b.return===p)return;b=b.return}b.sibling.return=b.return,b=b.sibling}},Dv=function(){},Jx=function(d,p,b,S){var M=d.memoizedProps;if(M!==S){d=p.stateNode,bu($o.current);var D=null;switch(b){case"input":M=ot(d,M),S=ot(d,S),D=[];break;case"select":M=W({},M,{value:void 0}),S=W({},S,{value:void 0}),D=[];break;case"textarea":M=Ut(d,M),S=Ut(d,S),D=[];break;default:typeof M.onClick!="function"&&typeof S.onClick=="function"&&(d.onclick=rf)}nt(b,S);var G;b=null;for(Se in M)if(!S.hasOwnProperty(Se)&&M.hasOwnProperty(Se)&&M[Se]!=null)if(Se==="style"){var ee=M[Se];for(G in ee)ee.hasOwnProperty(G)&&(b||(b={}),b[G]="")}else Se!=="dangerouslySetInnerHTML"&&Se!=="children"&&Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&Se!=="autoFocus"&&(i.hasOwnProperty(Se)?D||(D=[]):(D=D||[]).push(Se,null));for(Se in S){var ae=S[Se];if(ee=M?.[Se],S.hasOwnProperty(Se)&&ae!==ee&&(ae!=null||ee!=null))if(Se==="style")if(ee){for(G in ee)!ee.hasOwnProperty(G)||ae&&ae.hasOwnProperty(G)||(b||(b={}),b[G]="");for(G in ae)ae.hasOwnProperty(G)&&ee[G]!==ae[G]&&(b||(b={}),b[G]=ae[G])}else b||(D||(D=[]),D.push(Se,b)),b=ae;else Se==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ee=ee?ee.__html:void 0,ae!=null&&ee!==ae&&(D=D||[]).push(Se,ae)):Se==="children"?typeof ae!="string"&&typeof ae!="number"||(D=D||[]).push(Se,""+ae):Se!=="suppressContentEditableWarning"&&Se!=="suppressHydrationWarning"&&(i.hasOwnProperty(Se)?(ae!=null&&Se==="onScroll"&&On("scroll",d),D||ee===ae||(D=[])):(D=D||[]).push(Se,ae))}b&&(D=D||[]).push("style",b);var Se=D;(p.updateQueue=Se)&&(p.flags|=4)}},Zx=function(d,p,b,S){b!==S&&(p.flags|=4)};function Ch(d,p){if(!Bn)switch(d.tailMode){case"hidden":p=d.tail;for(var b=null;p!==null;)p.alternate!==null&&(b=p),p=p.sibling;b===null?d.tail=null:b.sibling=null;break;case"collapsed":b=d.tail;for(var S=null;b!==null;)b.alternate!==null&&(S=b),b=b.sibling;S===null?p||d.tail===null?d.tail=null:d.tail.sibling=null:S.sibling=null}}function Nr(d){var p=d.alternate!==null&&d.alternate.child===d.child,b=0,S=0;if(p)for(var M=d.child;M!==null;)b|=M.lanes|M.childLanes,S|=M.subtreeFlags&14680064,S|=M.flags&14680064,M.return=d,M=M.sibling;else for(M=d.child;M!==null;)b|=M.lanes|M.childLanes,S|=M.subtreeFlags,S|=M.flags,M.return=d,M=M.sibling;return d.subtreeFlags|=S,d.childLanes=b,p}function N4(d,p,b){var S=p.pendingProps;switch(ev(p),p.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Nr(p),null;case 1:return si(p.type)&&af(),Nr(p),null;case 3:return S=p.stateNode,Pl(),Ln(ai),Ln(Ir),fv(),S.pendingContext&&(S.context=S.pendingContext,S.pendingContext=null),(d===null||d.child===null)&&(hf(p)?p.flags|=4:d===null||d.memoizedState.isDehydrated&&(p.flags&256)===0||(p.flags|=1024,vo!==null&&(Gv(vo),vo=null))),Dv(d,p),Nr(p),null;case 5:hv(p);var M=bu(_h.current);if(b=p.type,d!==null&&p.stateNode!=null)Jx(d,p,b,S,M),d.ref!==p.ref&&(p.flags|=512,p.flags|=2097152);else{if(!S){if(p.stateNode===null)throw Error(t(166));return Nr(p),null}if(d=bu($o.current),hf(p)){S=p.stateNode,b=p.type;var D=p.memoizedProps;switch(S[qo]=p,S[gh]=D,d=(p.mode&1)!==0,b){case"dialog":On("cancel",S),On("close",S);break;case"iframe":case"object":case"embed":On("load",S);break;case"video":case"audio":for(M=0;M<fh.length;M++)On(fh[M],S);break;case"source":On("error",S);break;case"img":case"image":case"link":On("error",S),On("load",S);break;case"details":On("toggle",S);break;case"input":Je(S,D),On("invalid",S);break;case"select":S._wrapperState={wasMultiple:!!D.multiple},On("invalid",S);break;case"textarea":Z(S,D),On("invalid",S)}nt(b,D),M=null;for(var G in D)if(D.hasOwnProperty(G)){var ee=D[G];G==="children"?typeof ee=="string"?S.textContent!==ee&&(D.suppressHydrationWarning!==!0&&nf(S.textContent,ee,d),M=["children",ee]):typeof ee=="number"&&S.textContent!==""+ee&&(D.suppressHydrationWarning!==!0&&nf(S.textContent,ee,d),M=["children",""+ee]):i.hasOwnProperty(G)&&ee!=null&&G==="onScroll"&&On("scroll",S)}switch(b){case"input":Be(S),Tt(S,D,!0);break;case"textarea":Be(S),me(S);break;case"select":case"option":break;default:typeof D.onClick=="function"&&(S.onclick=rf)}S=M,p.updateQueue=S,S!==null&&(p.flags|=4)}else{G=M.nodeType===9?M:M.ownerDocument,d==="http://www.w3.org/1999/xhtml"&&(d=Re(b)),d==="http://www.w3.org/1999/xhtml"?b==="script"?(d=G.createElement("div"),d.innerHTML="<script><\/script>",d=d.removeChild(d.firstChild)):typeof S.is=="string"?d=G.createElement(b,{is:S.is}):(d=G.createElement(b),b==="select"&&(G=d,S.multiple?G.multiple=!0:S.size&&(G.size=S.size))):d=G.createElementNS(d,b),d[qo]=p,d[gh]=S,Kx(d,p,!1,!1),p.stateNode=d;e:{switch(G=tt(b,S),b){case"dialog":On("cancel",d),On("close",d),M=S;break;case"iframe":case"object":case"embed":On("load",d),M=S;break;case"video":case"audio":for(M=0;M<fh.length;M++)On(fh[M],d);M=S;break;case"source":On("error",d),M=S;break;case"img":case"image":case"link":On("error",d),On("load",d),M=S;break;case"details":On("toggle",d),M=S;break;case"input":Je(d,S),M=ot(d,S),On("invalid",d);break;case"option":M=S;break;case"select":d._wrapperState={wasMultiple:!!S.multiple},M=W({},S,{value:void 0}),On("invalid",d);break;case"textarea":Z(d,S),M=Ut(d,S),On("invalid",d);break;default:M=S}nt(b,M),ee=M;for(D in ee)if(ee.hasOwnProperty(D)){var ae=ee[D];D==="style"?$e(d,ae):D==="dangerouslySetInnerHTML"?(ae=ae?ae.__html:void 0,ae!=null&&Ue(d,ae)):D==="children"?typeof ae=="string"?(b!=="textarea"||ae!=="")&&_e(d,ae):typeof ae=="number"&&_e(d,""+ae):D!=="suppressContentEditableWarning"&&D!=="suppressHydrationWarning"&&D!=="autoFocus"&&(i.hasOwnProperty(D)?ae!=null&&D==="onScroll"&&On("scroll",d):ae!=null&&E(d,D,ae,G))}switch(b){case"input":Be(d),Tt(d,S,!1);break;case"textarea":Be(d),me(d);break;case"option":S.value!=null&&d.setAttribute("value",""+fe(S.value));break;case"select":d.multiple=!!S.multiple,D=S.value,D!=null?Mt(d,!!S.multiple,D,!1):S.defaultValue!=null&&Mt(d,!!S.multiple,S.defaultValue,!0);break;default:typeof M.onClick=="function"&&(d.onclick=rf)}switch(b){case"button":case"input":case"select":case"textarea":S=!!S.autoFocus;break e;case"img":S=!0;break e;default:S=!1}}S&&(p.flags|=4)}p.ref!==null&&(p.flags|=512,p.flags|=2097152)}return Nr(p),null;case 6:if(d&&p.stateNode!=null)Zx(d,p,d.memoizedProps,S);else{if(typeof S!="string"&&p.stateNode===null)throw Error(t(166));if(b=bu(_h.current),bu($o.current),hf(p)){if(S=p.stateNode,b=p.memoizedProps,S[qo]=p,(D=S.nodeValue!==b)&&(d=ki,d!==null))switch(d.tag){case 3:nf(S.nodeValue,b,(d.mode&1)!==0);break;case 5:d.memoizedProps.suppressHydrationWarning!==!0&&nf(S.nodeValue,b,(d.mode&1)!==0)}D&&(p.flags|=4)}else S=(b.nodeType===9?b:b.ownerDocument).createTextNode(S),S[qo]=p,p.stateNode=S}return Nr(p),null;case 13:if(Ln(Un),S=p.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(Bn&&Ci!==null&&(p.mode&1)!==0&&(p.flags&128)===0)tx(),Rl(),p.flags|=98560,D=!1;else if(D=hf(p),S!==null&&S.dehydrated!==null){if(d===null){if(!D)throw Error(t(318));if(D=p.memoizedState,D=D!==null?D.dehydrated:null,!D)throw Error(t(317));D[qo]=p}else Rl(),(p.flags&128)===0&&(p.memoizedState=null),p.flags|=4;Nr(p),D=!1}else vo!==null&&(Gv(vo),vo=null),D=!0;if(!D)return p.flags&65536?p:null}return(p.flags&128)!==0?(p.lanes=b,p):(S=S!==null,S!==(d!==null&&d.memoizedState!==null)&&S&&(p.child.flags|=8192,(p.mode&1)!==0&&(d===null||(Un.current&1)!==0?rr===0&&(rr=3):qv())),p.updateQueue!==null&&(p.flags|=4),Nr(p),null);case 4:return Pl(),Dv(d,p),d===null&&ph(p.stateNode.containerInfo),Nr(p),null;case 10:return av(p.type._context),Nr(p),null;case 17:return si(p.type)&&af(),Nr(p),null;case 19:if(Ln(Un),D=p.memoizedState,D===null)return Nr(p),null;if(S=(p.flags&128)!==0,G=D.rendering,G===null)if(S)Ch(D,!1);else{if(rr!==0||d!==null&&(d.flags&128)!==0)for(d=p.child;d!==null;){if(G=vf(d),G!==null){for(p.flags|=128,Ch(D,!1),S=G.updateQueue,S!==null&&(p.updateQueue=S,p.flags|=4),p.subtreeFlags=0,S=b,b=p.child;b!==null;)D=b,d=S,D.flags&=14680066,G=D.alternate,G===null?(D.childLanes=0,D.lanes=d,D.child=null,D.subtreeFlags=0,D.memoizedProps=null,D.memoizedState=null,D.updateQueue=null,D.dependencies=null,D.stateNode=null):(D.childLanes=G.childLanes,D.lanes=G.lanes,D.child=G.child,D.subtreeFlags=0,D.deletions=null,D.memoizedProps=G.memoizedProps,D.memoizedState=G.memoizedState,D.updateQueue=G.updateQueue,D.type=G.type,d=G.dependencies,D.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext}),b=b.sibling;return Dn(Un,Un.current&1|2),p.child}d=d.sibling}D.tail!==null&&he()>Bl&&(p.flags|=128,S=!0,Ch(D,!1),p.lanes=4194304)}else{if(!S)if(d=vf(G),d!==null){if(p.flags|=128,S=!0,b=d.updateQueue,b!==null&&(p.updateQueue=b,p.flags|=4),Ch(D,!0),D.tail===null&&D.tailMode==="hidden"&&!G.alternate&&!Bn)return Nr(p),null}else 2*he()-D.renderingStartTime>Bl&&b!==1073741824&&(p.flags|=128,S=!0,Ch(D,!1),p.lanes=4194304);D.isBackwards?(G.sibling=p.child,p.child=G):(b=D.last,b!==null?b.sibling=G:p.child=G,D.last=G)}return D.tail!==null?(p=D.tail,D.rendering=p,D.tail=p.sibling,D.renderingStartTime=he(),p.sibling=null,b=Un.current,Dn(Un,S?b&1|2:b&1),p):(Nr(p),null);case 22:case 23:return jv(),S=p.memoizedState!==null,d!==null&&d.memoizedState!==null!==S&&(p.flags|=8192),S&&(p.mode&1)!==0?(Ti&1073741824)!==0&&(Nr(p),p.subtreeFlags&6&&(p.flags|=8192)):Nr(p),null;case 24:return null;case 25:return null}throw Error(t(156,p.tag))}function P4(d,p){switch(ev(p),p.tag){case 1:return si(p.type)&&af(),d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 3:return Pl(),Ln(ai),Ln(Ir),fv(),d=p.flags,(d&65536)!==0&&(d&128)===0?(p.flags=d&-65537|128,p):null;case 5:return hv(p),null;case 13:if(Ln(Un),d=p.memoizedState,d!==null&&d.dehydrated!==null){if(p.alternate===null)throw Error(t(340));Rl()}return d=p.flags,d&65536?(p.flags=d&-65537|128,p):null;case 19:return Ln(Un),null;case 4:return Pl(),null;case 10:return av(p.type._context),null;case 22:case 23:return jv(),null;case 24:return null;default:return null}}var Cf=!1,Pr=!1,F4=typeof WeakSet=="function"?WeakSet:Set,mt=null;function Ol(d,p){var b=d.ref;if(b!==null)if(typeof b=="function")try{b(null)}catch(S){Vn(d,p,S)}else b.current=null}function Nv(d,p,b){try{b()}catch(S){Vn(d,p,S)}}var Qx=!1;function O4(d,p){if(jg=jd,d=I_(),Lg(d)){if("selectionStart"in d)var b={start:d.selectionStart,end:d.selectionEnd};else e:{b=(b=d.ownerDocument)&&b.defaultView||window;var S=b.getSelection&&b.getSelection();if(S&&S.rangeCount!==0){b=S.anchorNode;var M=S.anchorOffset,D=S.focusNode;S=S.focusOffset;try{b.nodeType,D.nodeType}catch{b=null;break e}var G=0,ee=-1,ae=-1,Se=0,Ge=0,je=d,ze=null;t:for(;;){for(var ht;je!==b||M!==0&&je.nodeType!==3||(ee=G+M),je!==D||S!==0&&je.nodeType!==3||(ae=G+S),je.nodeType===3&&(G+=je.nodeValue.length),(ht=je.firstChild)!==null;)ze=je,je=ht;for(;;){if(je===d)break t;if(ze===b&&++Se===M&&(ee=G),ze===D&&++Ge===S&&(ae=G),(ht=je.nextSibling)!==null)break;je=ze,ze=je.parentNode}je=ht}b=ee===-1||ae===-1?null:{start:ee,end:ae}}else b=null}b=b||{start:0,end:0}}else b=null;for(qg={focusedElem:d,selectionRange:b},jd=!1,mt=p;mt!==null;)if(p=mt,d=p.child,(p.subtreeFlags&1028)!==0&&d!==null)d.return=p,mt=d;else for(;mt!==null;){p=mt;try{var yt=p.alternate;if((p.flags&1024)!==0)switch(p.tag){case 0:case 11:case 15:break;case 1:if(yt!==null){var xt=yt.memoizedProps,Kn=yt.memoizedState,ge=p.stateNode,ce=ge.getSnapshotBeforeUpdate(p.elementType===p.type?xt:yo(p.type,xt),Kn);ge.__reactInternalSnapshotBeforeUpdate=ce}break;case 3:var we=p.stateNode.containerInfo;we.nodeType===1?we.textContent="":we.nodeType===9&&we.documentElement&&we.removeChild(we.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(et){Vn(p,p.return,et)}if(d=p.sibling,d!==null){d.return=p.return,mt=d;break}mt=p.return}return yt=Qx,Qx=!1,yt}function Th(d,p,b){var S=p.updateQueue;if(S=S!==null?S.lastEffect:null,S!==null){var M=S=S.next;do{if((M.tag&d)===d){var D=M.destroy;M.destroy=void 0,D!==void 0&&Nv(p,b,D)}M=M.next}while(M!==S)}}function Tf(d,p){if(p=p.updateQueue,p=p!==null?p.lastEffect:null,p!==null){var b=p=p.next;do{if((b.tag&d)===d){var S=b.create;b.destroy=S()}b=b.next}while(b!==p)}}function Pv(d){var p=d.ref;if(p!==null){var b=d.stateNode;switch(d.tag){case 5:d=b;break;default:d=b}typeof p=="function"?p(d):p.current=d}}function e2(d){var p=d.alternate;p!==null&&(d.alternate=null,e2(p)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(p=d.stateNode,p!==null&&(delete p[qo],delete p[gh],delete p[Kg],delete p[y4],delete p[b4])),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function t2(d){return d.tag===5||d.tag===3||d.tag===4}function n2(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||t2(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function Fv(d,p,b){var S=d.tag;if(S===5||S===6)d=d.stateNode,p?b.nodeType===8?b.parentNode.insertBefore(d,p):b.insertBefore(d,p):(b.nodeType===8?(p=b.parentNode,p.insertBefore(d,b)):(p=b,p.appendChild(d)),b=b._reactRootContainer,b!=null||p.onclick!==null||(p.onclick=rf));else if(S!==4&&(d=d.child,d!==null))for(Fv(d,p,b),d=d.sibling;d!==null;)Fv(d,p,b),d=d.sibling}function Ov(d,p,b){var S=d.tag;if(S===5||S===6)d=d.stateNode,p?b.insertBefore(d,p):b.appendChild(d);else if(S!==4&&(d=d.child,d!==null))for(Ov(d,p,b),d=d.sibling;d!==null;)Ov(d,p,b),d=d.sibling}var xr=null,bo=!1;function Ss(d,p,b){for(b=b.child;b!==null;)r2(d,p,b),b=b.sibling}function r2(d,p,b){if(jt&&typeof jt.onCommitFiberUnmount=="function")try{jt.onCommitFiberUnmount(At,b)}catch{}switch(b.tag){case 5:Pr||Ol(b,p);case 6:var S=xr,M=bo;xr=null,Ss(d,p,b),xr=S,bo=M,xr!==null&&(bo?(d=xr,b=b.stateNode,d.nodeType===8?d.parentNode.removeChild(b):d.removeChild(b)):xr.removeChild(b.stateNode));break;case 18:xr!==null&&(bo?(d=xr,b=b.stateNode,d.nodeType===8?Yg(d.parentNode,b):d.nodeType===1&&Yg(d,b),oh(d)):Yg(xr,b.stateNode));break;case 4:S=xr,M=bo,xr=b.stateNode.containerInfo,bo=!0,Ss(d,p,b),xr=S,bo=M;break;case 0:case 11:case 14:case 15:if(!Pr&&(S=b.updateQueue,S!==null&&(S=S.lastEffect,S!==null))){M=S=S.next;do{var D=M,G=D.destroy;D=D.tag,G!==void 0&&((D&2)!==0||(D&4)!==0)&&Nv(b,p,G),M=M.next}while(M!==S)}Ss(d,p,b);break;case 1:if(!Pr&&(Ol(b,p),S=b.stateNode,typeof S.componentWillUnmount=="function"))try{S.props=b.memoizedProps,S.state=b.memoizedState,S.componentWillUnmount()}catch(ee){Vn(b,p,ee)}Ss(d,p,b);break;case 21:Ss(d,p,b);break;case 22:b.mode&1?(Pr=(S=Pr)||b.memoizedState!==null,Ss(d,p,b),Pr=S):Ss(d,p,b);break;default:Ss(d,p,b)}}function i2(d){var p=d.updateQueue;if(p!==null){d.updateQueue=null;var b=d.stateNode;b===null&&(b=d.stateNode=new F4),p.forEach(function(S){var M=j4.bind(null,d,S);b.has(S)||(b.add(S),S.then(M,M))})}}function wo(d,p){var b=p.deletions;if(b!==null)for(var S=0;S<b.length;S++){var M=b[S];try{var D=d,G=p,ee=G;e:for(;ee!==null;){switch(ee.tag){case 5:xr=ee.stateNode,bo=!1;break e;case 3:xr=ee.stateNode.containerInfo,bo=!0;break e;case 4:xr=ee.stateNode.containerInfo,bo=!0;break e}ee=ee.return}if(xr===null)throw Error(t(160));r2(D,G,M),xr=null,bo=!1;var ae=M.alternate;ae!==null&&(ae.return=null),M.return=null}catch(Se){Vn(M,p,Se)}}if(p.subtreeFlags&12854)for(p=p.child;p!==null;)o2(p,d),p=p.sibling}function o2(d,p){var b=d.alternate,S=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:if(wo(p,d),Yo(d),S&4){try{Th(3,d,d.return),Tf(3,d)}catch(xt){Vn(d,d.return,xt)}try{Th(5,d,d.return)}catch(xt){Vn(d,d.return,xt)}}break;case 1:wo(p,d),Yo(d),S&512&&b!==null&&Ol(b,b.return);break;case 5:if(wo(p,d),Yo(d),S&512&&b!==null&&Ol(b,b.return),d.flags&32){var M=d.stateNode;try{_e(M,"")}catch(xt){Vn(d,d.return,xt)}}if(S&4&&(M=d.stateNode,M!=null)){var D=d.memoizedProps,G=b!==null?b.memoizedProps:D,ee=d.type,ae=d.updateQueue;if(d.updateQueue=null,ae!==null)try{ee==="input"&&D.type==="radio"&&D.name!=null&&Xe(M,D),tt(ee,G);var Se=tt(ee,D);for(G=0;G<ae.length;G+=2){var Ge=ae[G],je=ae[G+1];Ge==="style"?$e(M,je):Ge==="dangerouslySetInnerHTML"?Ue(M,je):Ge==="children"?_e(M,je):E(M,Ge,je,Se)}switch(ee){case"input":qe(M,D);break;case"textarea":j(M,D);break;case"select":var ze=M._wrapperState.wasMultiple;M._wrapperState.wasMultiple=!!D.multiple;var ht=D.value;ht!=null?Mt(M,!!D.multiple,ht,!1):ze!==!!D.multiple&&(D.defaultValue!=null?Mt(M,!!D.multiple,D.defaultValue,!0):Mt(M,!!D.multiple,D.multiple?[]:"",!1))}M[gh]=D}catch(xt){Vn(d,d.return,xt)}}break;case 6:if(wo(p,d),Yo(d),S&4){if(d.stateNode===null)throw Error(t(162));M=d.stateNode,D=d.memoizedProps;try{M.nodeValue=D}catch(xt){Vn(d,d.return,xt)}}break;case 3:if(wo(p,d),Yo(d),S&4&&b!==null&&b.memoizedState.isDehydrated)try{oh(p.containerInfo)}catch(xt){Vn(d,d.return,xt)}break;case 4:wo(p,d),Yo(d);break;case 13:wo(p,d),Yo(d),M=d.child,M.flags&8192&&(D=M.memoizedState!==null,M.stateNode.isHidden=D,!D||M.alternate!==null&&M.alternate.memoizedState!==null||(Uv=he())),S&4&&i2(d);break;case 22:if(Ge=b!==null&&b.memoizedState!==null,d.mode&1?(Pr=(Se=Pr)||Ge,wo(p,d),Pr=Se):wo(p,d),Yo(d),S&8192){if(Se=d.memoizedState!==null,(d.stateNode.isHidden=Se)&&!Ge&&(d.mode&1)!==0)for(mt=d,Ge=d.child;Ge!==null;){for(je=mt=Ge;mt!==null;){switch(ze=mt,ht=ze.child,ze.tag){case 0:case 11:case 14:case 15:Th(4,ze,ze.return);break;case 1:Ol(ze,ze.return);var yt=ze.stateNode;if(typeof yt.componentWillUnmount=="function"){S=ze,b=ze.return;try{p=S,yt.props=p.memoizedProps,yt.state=p.memoizedState,yt.componentWillUnmount()}catch(xt){Vn(S,b,xt)}}break;case 5:Ol(ze,ze.return);break;case 22:if(ze.memoizedState!==null){u2(je);continue}}ht!==null?(ht.return=ze,mt=ht):u2(je)}Ge=Ge.sibling}e:for(Ge=null,je=d;;){if(je.tag===5){if(Ge===null){Ge=je;try{M=je.stateNode,Se?(D=M.style,typeof D.setProperty=="function"?D.setProperty("display","none","important"):D.display="none"):(ee=je.stateNode,ae=je.memoizedProps.style,G=ae!=null&&ae.hasOwnProperty("display")?ae.display:null,ee.style.display=Oe("display",G))}catch(xt){Vn(d,d.return,xt)}}}else if(je.tag===6){if(Ge===null)try{je.stateNode.nodeValue=Se?"":je.memoizedProps}catch(xt){Vn(d,d.return,xt)}}else if((je.tag!==22&&je.tag!==23||je.memoizedState===null||je===d)&&je.child!==null){je.child.return=je,je=je.child;continue}if(je===d)break e;for(;je.sibling===null;){if(je.return===null||je.return===d)break e;Ge===je&&(Ge=null),je=je.return}Ge===je&&(Ge=null),je.sibling.return=je.return,je=je.sibling}}break;case 19:wo(p,d),Yo(d),S&4&&i2(d);break;case 21:break;default:wo(p,d),Yo(d)}}function Yo(d){var p=d.flags;if(p&2){try{e:{for(var b=d.return;b!==null;){if(t2(b)){var S=b;break e}b=b.return}throw Error(t(160))}switch(S.tag){case 5:var M=S.stateNode;S.flags&32&&(_e(M,""),S.flags&=-33);var D=n2(d);Ov(d,D,M);break;case 3:case 4:var G=S.stateNode.containerInfo,ee=n2(d);Fv(d,ee,G);break;default:throw Error(t(161))}}catch(ae){Vn(d,d.return,ae)}d.flags&=-3}p&4096&&(d.flags&=-4097)}function L4(d,p,b){mt=d,a2(d)}function a2(d,p,b){for(var S=(d.mode&1)!==0;mt!==null;){var M=mt,D=M.child;if(M.tag===22&&S){var G=M.memoizedState!==null||Cf;if(!G){var ee=M.alternate,ae=ee!==null&&ee.memoizedState!==null||Pr;ee=Cf;var Se=Pr;if(Cf=G,(Pr=ae)&&!Se)for(mt=M;mt!==null;)G=mt,ae=G.child,G.tag===22&&G.memoizedState!==null?l2(M):ae!==null?(ae.return=G,mt=ae):l2(M);for(;D!==null;)mt=D,a2(D),D=D.sibling;mt=M,Cf=ee,Pr=Se}s2(d)}else(M.subtreeFlags&8772)!==0&&D!==null?(D.return=M,mt=D):s2(d)}}function s2(d){for(;mt!==null;){var p=mt;if((p.flags&8772)!==0){var b=p.alternate;try{if((p.flags&8772)!==0)switch(p.tag){case 0:case 11:case 15:Pr||Tf(5,p);break;case 1:var S=p.stateNode;if(p.flags&4&&!Pr)if(b===null)S.componentDidMount();else{var M=p.elementType===p.type?b.memoizedProps:yo(p.type,b.memoizedProps);S.componentDidUpdate(M,b.memoizedState,S.__reactInternalSnapshotBeforeUpdate)}var D=p.updateQueue;D!==null&&ux(p,D,S);break;case 3:var G=p.updateQueue;if(G!==null){if(b=null,p.child!==null)switch(p.child.tag){case 5:b=p.child.stateNode;break;case 1:b=p.child.stateNode}ux(p,G,b)}break;case 5:var ee=p.stateNode;if(b===null&&p.flags&4){b=ee;var ae=p.memoizedProps;switch(p.type){case"button":case"input":case"select":case"textarea":ae.autoFocus&&b.focus();break;case"img":ae.src&&(b.src=ae.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(p.memoizedState===null){var Se=p.alternate;if(Se!==null){var Ge=Se.memoizedState;if(Ge!==null){var je=Ge.dehydrated;je!==null&&oh(je)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Pr||p.flags&512&&Pv(p)}catch(ze){Vn(p,p.return,ze)}}if(p===d){mt=null;break}if(b=p.sibling,b!==null){b.return=p.return,mt=b;break}mt=p.return}}function u2(d){for(;mt!==null;){var p=mt;if(p===d){mt=null;break}var b=p.sibling;if(b!==null){b.return=p.return,mt=b;break}mt=p.return}}function l2(d){for(;mt!==null;){var p=mt;try{switch(p.tag){case 0:case 11:case 15:var b=p.return;try{Tf(4,p)}catch(ae){Vn(p,b,ae)}break;case 1:var S=p.stateNode;if(typeof S.componentDidMount=="function"){var M=p.return;try{S.componentDidMount()}catch(ae){Vn(p,M,ae)}}var D=p.return;try{Pv(p)}catch(ae){Vn(p,D,ae)}break;case 5:var G=p.return;try{Pv(p)}catch(ae){Vn(p,G,ae)}}}catch(ae){Vn(p,p.return,ae)}if(p===d){mt=null;break}var ee=p.sibling;if(ee!==null){ee.return=p.return,mt=ee;break}mt=p.return}}var B4=Math.ceil,Mf=_.ReactCurrentDispatcher,Lv=_.ReactCurrentOwner,Yi=_.ReactCurrentBatchConfig,dn=0,gr=null,Zn=null,Sr=0,Ti=0,Ll=ys(0),rr=0,Mh=null,_u=0,Af=0,Bv=0,Ah=null,li=null,Uv=0,Bl=1/0,Aa=null,Rf=!1,zv=null,Es=null,If=!1,ks=null,Df=0,Rh=0,Wv=null,Nf=-1,Pf=0;function Qr(){return(dn&6)!==0?he():Nf!==-1?Nf:Nf=he()}function Cs(d){return(d.mode&1)===0?1:(dn&2)!==0&&Sr!==0?Sr&-Sr:_4.transition!==null?(Pf===0&&(Pf=Jr()),Pf):(d=rn,d!==0||(d=window.event,d=d===void 0?16:h_(d.type)),d)}function _o(d,p,b,S){if(50<Rh)throw Rh=0,Wv=null,Error(t(185));Yn(d,b,S),((dn&2)===0||d!==gr)&&(d===gr&&((dn&2)===0&&(Af|=b),rr===4&&Ts(d,Sr)),ci(d,S),b===1&&dn===0&&(p.mode&1)===0&&(Bl=he()+500,uf&&ws()))}function ci(d,p){var b=d.callbackNode;du(d,p);var S=mo(d,d===gr?Sr:0);if(S===0)b!==null&&pe(b),d.callbackNode=null,d.callbackPriority=0;else if(p=S&-S,d.callbackPriority!==p){if(b!=null&&pe(b),p===1)d.tag===0?w4(h2.bind(null,d)):K_(h2.bind(null,d)),g4(function(){(dn&6)===0&&ws()}),b=null;else{switch(r_(S)){case 1:b=st;break;case 4:b=vt;break;case 16:b=ct;break;case 536870912:b=zt;break;default:b=ct}b=b2(b,c2.bind(null,d))}d.callbackPriority=p,d.callbackNode=b}}function c2(d,p){if(Nf=-1,Pf=0,(dn&6)!==0)throw Error(t(327));var b=d.callbackNode;if(Ul()&&d.callbackNode!==b)return null;var S=mo(d,d===gr?Sr:0);if(S===0)return null;if((S&30)!==0||(S&d.expiredLanes)!==0||p)p=Ff(d,S);else{p=S;var M=dn;dn|=2;var D=f2();(gr!==d||Sr!==p)&&(Aa=null,Bl=he()+500,Su(d,p));do try{W4();break}catch(ee){d2(d,ee)}while(!0);ov(),Mf.current=D,dn=M,Zn!==null?p=0:(gr=null,Sr=0,p=rr)}if(p!==0){if(p===2&&(M=In(d),M!==0&&(S=M,p=Hv(d,M))),p===1)throw b=Mh,Su(d,0),Ts(d,S),ci(d,he()),b;if(p===6)Ts(d,S);else{if(M=d.current.alternate,(S&30)===0&&!U4(M)&&(p=Ff(d,S),p===2&&(D=In(d),D!==0&&(S=D,p=Hv(d,D))),p===1))throw b=Mh,Su(d,0),Ts(d,S),ci(d,he()),b;switch(d.finishedWork=M,d.finishedLanes=S,p){case 0:case 1:throw Error(t(345));case 2:Eu(d,li,Aa);break;case 3:if(Ts(d,S),(S&130023424)===S&&(p=Uv+500-he(),10<p)){if(mo(d,0)!==0)break;if(M=d.suspendedLanes,(M&S)!==S){Qr(),d.pingedLanes|=d.suspendedLanes&M;break}d.timeoutHandle=Xg(Eu.bind(null,d,li,Aa),p);break}Eu(d,li,Aa);break;case 4:if(Ts(d,S),(S&4194240)===S)break;for(p=d.eventTimes,M=-1;0<S;){var G=31-ln(S);D=1<<G,G=p[G],G>M&&(M=G),S&=~D}if(S=M,S=he()-S,S=(120>S?120:480>S?480:1080>S?1080:1920>S?1920:3e3>S?3e3:4320>S?4320:1960*B4(S/1960))-S,10<S){d.timeoutHandle=Xg(Eu.bind(null,d,li,Aa),S);break}Eu(d,li,Aa);break;case 5:Eu(d,li,Aa);break;default:throw Error(t(329))}}}return ci(d,he()),d.callbackNode===b?c2.bind(null,d):null}function Hv(d,p){var b=Ah;return d.current.memoizedState.isDehydrated&&(Su(d,p).flags|=256),d=Ff(d,p),d!==2&&(p=li,li=b,p!==null&&Gv(p)),d}function Gv(d){li===null?li=d:li.push.apply(li,d)}function U4(d){for(var p=d;;){if(p.flags&16384){var b=p.updateQueue;if(b!==null&&(b=b.stores,b!==null))for(var S=0;S<b.length;S++){var M=b[S],D=M.getSnapshot;M=M.value;try{if(!go(D(),M))return!1}catch{return!1}}}if(b=p.child,p.subtreeFlags&16384&&b!==null)b.return=p,p=b;else{if(p===d)break;for(;p.sibling===null;){if(p.return===null||p.return===d)return!0;p=p.return}p.sibling.return=p.return,p=p.sibling}}return!0}function Ts(d,p){for(p&=~Bv,p&=~Af,d.suspendedLanes|=p,d.pingedLanes&=~p,d=d.expirationTimes;0<p;){var b=31-ln(p),S=1<<b;d[b]=-1,p&=~S}}function h2(d){if((dn&6)!==0)throw Error(t(327));Ul();var p=mo(d,0);if((p&1)===0)return ci(d,he()),null;var b=Ff(d,p);if(d.tag!==0&&b===2){var S=In(d);S!==0&&(p=S,b=Hv(d,S))}if(b===1)throw b=Mh,Su(d,0),Ts(d,p),ci(d,he()),b;if(b===6)throw Error(t(345));return d.finishedWork=d.current.alternate,d.finishedLanes=p,Eu(d,li,Aa),ci(d,he()),null}function Vv(d,p){var b=dn;dn|=1;try{return d(p)}finally{dn=b,dn===0&&(Bl=he()+500,uf&&ws())}}function xu(d){ks!==null&&ks.tag===0&&(dn&6)===0&&Ul();var p=dn;dn|=1;var b=Yi.transition,S=rn;try{if(Yi.transition=null,rn=1,d)return d()}finally{rn=S,Yi.transition=b,dn=p,(dn&6)===0&&ws()}}function jv(){Ti=Ll.current,Ln(Ll)}function Su(d,p){d.finishedWork=null,d.finishedLanes=0;var b=d.timeoutHandle;if(b!==-1&&(d.timeoutHandle=-1,m4(b)),Zn!==null)for(b=Zn.return;b!==null;){var S=b;switch(ev(S),S.tag){case 1:S=S.type.childContextTypes,S!=null&&af();break;case 3:Pl(),Ln(ai),Ln(Ir),fv();break;case 5:hv(S);break;case 4:Pl();break;case 13:Ln(Un);break;case 19:Ln(Un);break;case 10:av(S.type._context);break;case 22:case 23:jv()}b=b.return}if(gr=d,Zn=d=Ms(d.current,null),Sr=Ti=p,rr=0,Mh=null,Bv=Af=_u=0,li=Ah=null,yu!==null){for(p=0;p<yu.length;p++)if(b=yu[p],S=b.interleaved,S!==null){b.interleaved=null;var M=S.next,D=b.pending;if(D!==null){var G=D.next;D.next=M,S.next=G}b.pending=S}yu=null}return d}function d2(d,p){do{var b=Zn;try{if(ov(),yf.current=xf,bf){for(var S=zn.memoizedState;S!==null;){var M=S.queue;M!==null&&(M.pending=null),S=S.next}bf=!1}if(wu=0,mr=nr=zn=null,xh=!1,Sh=0,Lv.current=null,b===null||b.return===null){rr=1,Mh=p,Zn=null;break}e:{var D=d,G=b.return,ee=b,ae=p;if(p=Sr,ee.flags|=32768,ae!==null&&typeof ae=="object"&&typeof ae.then=="function"){var Se=ae,Ge=ee,je=Ge.tag;if((Ge.mode&1)===0&&(je===0||je===11||je===15)){var ze=Ge.alternate;ze?(Ge.updateQueue=ze.updateQueue,Ge.memoizedState=ze.memoizedState,Ge.lanes=ze.lanes):(Ge.updateQueue=null,Ge.memoizedState=null)}var ht=Lx(G);if(ht!==null){ht.flags&=-257,Bx(ht,G,ee,D,p),ht.mode&1&&Ox(D,Se,p),p=ht,ae=Se;var yt=p.updateQueue;if(yt===null){var xt=new Set;xt.add(ae),p.updateQueue=xt}else yt.add(ae);break e}else{if((p&1)===0){Ox(D,Se,p),qv();break e}ae=Error(t(426))}}else if(Bn&&ee.mode&1){var Kn=Lx(G);if(Kn!==null){(Kn.flags&65536)===0&&(Kn.flags|=256),Bx(Kn,G,ee,D,p),rv(Fl(ae,ee));break e}}D=ae=Fl(ae,ee),rr!==4&&(rr=2),Ah===null?Ah=[D]:Ah.push(D),D=G;do{switch(D.tag){case 3:D.flags|=65536,p&=-p,D.lanes|=p;var ge=Px(D,ae,p);sx(D,ge);break e;case 1:ee=ae;var ce=D.type,we=D.stateNode;if((D.flags&128)===0&&(typeof ce.getDerivedStateFromError=="function"||we!==null&&typeof we.componentDidCatch=="function"&&(Es===null||!Es.has(we)))){D.flags|=65536,p&=-p,D.lanes|=p;var et=Fx(D,ee,p);sx(D,et);break e}}D=D.return}while(D!==null)}m2(b)}catch(St){p=St,Zn===b&&b!==null&&(Zn=b=b.return);continue}break}while(!0)}function f2(){var d=Mf.current;return Mf.current=xf,d===null?xf:d}function qv(){(rr===0||rr===3||rr===2)&&(rr=4),gr===null||(_u&268435455)===0&&(Af&268435455)===0||Ts(gr,Sr)}function Ff(d,p){var b=dn;dn|=2;var S=f2();(gr!==d||Sr!==p)&&(Aa=null,Su(d,p));do try{z4();break}catch(M){d2(d,M)}while(!0);if(ov(),dn=b,Mf.current=S,Zn!==null)throw Error(t(261));return gr=null,Sr=0,rr}function z4(){for(;Zn!==null;)p2(Zn)}function W4(){for(;Zn!==null&&!Ee();)p2(Zn)}function p2(d){var p=y2(d.alternate,d,Ti);d.memoizedProps=d.pendingProps,p===null?m2(d):Zn=p,Lv.current=null}function m2(d){var p=d;do{var b=p.alternate;if(d=p.return,(p.flags&32768)===0){if(b=N4(b,p,Ti),b!==null){Zn=b;return}}else{if(b=P4(b,p),b!==null){b.flags&=32767,Zn=b;return}if(d!==null)d.flags|=32768,d.subtreeFlags=0,d.deletions=null;else{rr=6,Zn=null;return}}if(p=p.sibling,p!==null){Zn=p;return}Zn=p=d}while(p!==null);rr===0&&(rr=5)}function Eu(d,p,b){var S=rn,M=Yi.transition;try{Yi.transition=null,rn=1,H4(d,p,b,S)}finally{Yi.transition=M,rn=S}return null}function H4(d,p,b,S){do Ul();while(ks!==null);if((dn&6)!==0)throw Error(t(327));b=d.finishedWork;var M=d.finishedLanes;if(b===null)return null;if(d.finishedWork=null,d.finishedLanes=0,b===d.current)throw Error(t(177));d.callbackNode=null,d.callbackPriority=0;var D=b.lanes|b.childLanes;if(Rr(d,D),d===gr&&(Zn=gr=null,Sr=0),(b.subtreeFlags&2064)===0&&(b.flags&2064)===0||If||(If=!0,b2(ct,function(){return Ul(),null})),D=(b.flags&15990)!==0,(b.subtreeFlags&15990)!==0||D){D=Yi.transition,Yi.transition=null;var G=rn;rn=1;var ee=dn;dn|=4,Lv.current=null,O4(d,b),o2(b,d),u4(qg),jd=!!jg,qg=jg=null,d.current=b,L4(b),Ce(),dn=ee,rn=G,Yi.transition=D}else d.current=b;if(If&&(If=!1,ks=d,Df=M),D=d.pendingLanes,D===0&&(Es=null),xn(b.stateNode),ci(d,he()),p!==null)for(S=d.onRecoverableError,b=0;b<p.length;b++)M=p[b],S(M.value,{componentStack:M.stack,digest:M.digest});if(Rf)throw Rf=!1,d=zv,zv=null,d;return(Df&1)!==0&&d.tag!==0&&Ul(),D=d.pendingLanes,(D&1)!==0?d===Wv?Rh++:(Rh=0,Wv=d):Rh=0,ws(),null}function Ul(){if(ks!==null){var d=r_(Df),p=Yi.transition,b=rn;try{if(Yi.transition=null,rn=16>d?16:d,ks===null)var S=!1;else{if(d=ks,ks=null,Df=0,(dn&6)!==0)throw Error(t(331));var M=dn;for(dn|=4,mt=d.current;mt!==null;){var D=mt,G=D.child;if((mt.flags&16)!==0){var ee=D.deletions;if(ee!==null){for(var ae=0;ae<ee.length;ae++){var Se=ee[ae];for(mt=Se;mt!==null;){var Ge=mt;switch(Ge.tag){case 0:case 11:case 15:Th(8,Ge,D)}var je=Ge.child;if(je!==null)je.return=Ge,mt=je;else for(;mt!==null;){Ge=mt;var ze=Ge.sibling,ht=Ge.return;if(e2(Ge),Ge===Se){mt=null;break}if(ze!==null){ze.return=ht,mt=ze;break}mt=ht}}}var yt=D.alternate;if(yt!==null){var xt=yt.child;if(xt!==null){yt.child=null;do{var Kn=xt.sibling;xt.sibling=null,xt=Kn}while(xt!==null)}}mt=D}}if((D.subtreeFlags&2064)!==0&&G!==null)G.return=D,mt=G;else e:for(;mt!==null;){if(D=mt,(D.flags&2048)!==0)switch(D.tag){case 0:case 11:case 15:Th(9,D,D.return)}var ge=D.sibling;if(ge!==null){ge.return=D.return,mt=ge;break e}mt=D.return}}var ce=d.current;for(mt=ce;mt!==null;){G=mt;var we=G.child;if((G.subtreeFlags&2064)!==0&&we!==null)we.return=G,mt=we;else e:for(G=ce;mt!==null;){if(ee=mt,(ee.flags&2048)!==0)try{switch(ee.tag){case 0:case 11:case 15:Tf(9,ee)}}catch(St){Vn(ee,ee.return,St)}if(ee===G){mt=null;break e}var et=ee.sibling;if(et!==null){et.return=ee.return,mt=et;break e}mt=ee.return}}if(dn=M,ws(),jt&&typeof jt.onPostCommitFiberRoot=="function")try{jt.onPostCommitFiberRoot(At,d)}catch{}S=!0}return S}finally{rn=b,Yi.transition=p}}return!1}function g2(d,p,b){p=Fl(b,p),p=Px(d,p,1),d=xs(d,p,1),p=Qr(),d!==null&&(Yn(d,1,p),ci(d,p))}function Vn(d,p,b){if(d.tag===3)g2(d,d,b);else for(;p!==null;){if(p.tag===3){g2(p,d,b);break}else if(p.tag===1){var S=p.stateNode;if(typeof p.type.getDerivedStateFromError=="function"||typeof S.componentDidCatch=="function"&&(Es===null||!Es.has(S))){d=Fl(b,d),d=Fx(p,d,1),p=xs(p,d,1),d=Qr(),p!==null&&(Yn(p,1,d),ci(p,d));break}}p=p.return}}function G4(d,p,b){var S=d.pingCache;S!==null&&S.delete(p),p=Qr(),d.pingedLanes|=d.suspendedLanes&b,gr===d&&(Sr&b)===b&&(rr===4||rr===3&&(Sr&130023424)===Sr&&500>he()-Uv?Su(d,0):Bv|=b),ci(d,p)}function v2(d,p){p===0&&((d.mode&1)===0?p=1:(p=nn,nn<<=1,(nn&130023424)===0&&(nn=4194304)));var b=Qr();d=Ca(d,p),d!==null&&(Yn(d,p,b),ci(d,b))}function V4(d){var p=d.memoizedState,b=0;p!==null&&(b=p.retryLane),v2(d,b)}function j4(d,p){var b=0;switch(d.tag){case 13:var S=d.stateNode,M=d.memoizedState;M!==null&&(b=M.retryLane);break;case 19:S=d.stateNode;break;default:throw Error(t(314))}S!==null&&S.delete(p),v2(d,b)}var y2;y2=function(d,p,b){if(d!==null)if(d.memoizedProps!==p.pendingProps||ai.current)ui=!0;else{if((d.lanes&b)===0&&(p.flags&128)===0)return ui=!1,D4(d,p,b);ui=(d.flags&131072)!==0}else ui=!1,Bn&&(p.flags&1048576)!==0&&J_(p,cf,p.index);switch(p.lanes=0,p.tag){case 2:var S=p.type;kf(d,p),d=p.pendingProps;var M=Tl(p,Ir.current);Nl(p,b),M=gv(null,p,S,d,M,b);var D=vv();return p.flags|=1,typeof M=="object"&&M!==null&&typeof M.render=="function"&&M.$$typeof===void 0?(p.tag=1,p.memoizedState=null,p.updateQueue=null,si(S)?(D=!0,sf(p)):D=!1,p.memoizedState=M.state!==null&&M.state!==void 0?M.state:null,lv(p),M.updater=Sf,p.stateNode=M,M._reactInternals=p,Sv(p,S,d,b),p=Tv(null,p,S,!0,D,b)):(p.tag=0,Bn&&D&&Qg(p),Zr(null,p,M,b),p=p.child),p;case 16:S=p.elementType;e:{switch(kf(d,p),d=p.pendingProps,M=S._init,S=M(S._payload),p.type=S,M=p.tag=$4(S),d=yo(S,d),M){case 0:p=Cv(null,p,S,d,b);break e;case 1:p=Vx(null,p,S,d,b);break e;case 11:p=Ux(null,p,S,d,b);break e;case 14:p=zx(null,p,S,yo(S.type,d),b);break e}throw Error(t(306,S,""))}return p;case 0:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:yo(S,M),Cv(d,p,S,M,b);case 1:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:yo(S,M),Vx(d,p,S,M,b);case 3:e:{if(jx(p),d===null)throw Error(t(387));S=p.pendingProps,D=p.memoizedState,M=D.element,ax(d,p),gf(p,S,null,b);var G=p.memoizedState;if(S=G.element,D.isDehydrated)if(D={element:S,isDehydrated:!1,cache:G.cache,pendingSuspenseBoundaries:G.pendingSuspenseBoundaries,transitions:G.transitions},p.updateQueue.baseState=D,p.memoizedState=D,p.flags&256){M=Fl(Error(t(423)),p),p=qx(d,p,S,b,M);break e}else if(S!==M){M=Fl(Error(t(424)),p),p=qx(d,p,S,b,M);break e}else for(Ci=vs(p.stateNode.containerInfo.firstChild),ki=p,Bn=!0,vo=null,b=ix(p,null,S,b),p.child=b;b;)b.flags=b.flags&-3|4096,b=b.sibling;else{if(Rl(),S===M){p=Ma(d,p,b);break e}Zr(d,p,S,b)}p=p.child}return p;case 5:return lx(p),d===null&&nv(p),S=p.type,M=p.pendingProps,D=d!==null?d.memoizedProps:null,G=M.children,$g(S,M)?G=null:D!==null&&$g(S,D)&&(p.flags|=32),Gx(d,p),Zr(d,p,G,b),p.child;case 6:return d===null&&nv(p),null;case 13:return $x(d,p,b);case 4:return cv(p,p.stateNode.containerInfo),S=p.pendingProps,d===null?p.child=Il(p,null,S,b):Zr(d,p,S,b),p.child;case 11:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:yo(S,M),Ux(d,p,S,M,b);case 7:return Zr(d,p,p.pendingProps,b),p.child;case 8:return Zr(d,p,p.pendingProps.children,b),p.child;case 12:return Zr(d,p,p.pendingProps.children,b),p.child;case 10:e:{if(S=p.type._context,M=p.pendingProps,D=p.memoizedProps,G=M.value,Dn(ff,S._currentValue),S._currentValue=G,D!==null)if(go(D.value,G)){if(D.children===M.children&&!ai.current){p=Ma(d,p,b);break e}}else for(D=p.child,D!==null&&(D.return=p);D!==null;){var ee=D.dependencies;if(ee!==null){G=D.child;for(var ae=ee.firstContext;ae!==null;){if(ae.context===S){if(D.tag===1){ae=Ta(-1,b&-b),ae.tag=2;var Se=D.updateQueue;if(Se!==null){Se=Se.shared;var Ge=Se.pending;Ge===null?ae.next=ae:(ae.next=Ge.next,Ge.next=ae),Se.pending=ae}}D.lanes|=b,ae=D.alternate,ae!==null&&(ae.lanes|=b),sv(D.return,b,p),ee.lanes|=b;break}ae=ae.next}}else if(D.tag===10)G=D.type===p.type?null:D.child;else if(D.tag===18){if(G=D.return,G===null)throw Error(t(341));G.lanes|=b,ee=G.alternate,ee!==null&&(ee.lanes|=b),sv(G,b,p),G=D.sibling}else G=D.child;if(G!==null)G.return=D;else for(G=D;G!==null;){if(G===p){G=null;break}if(D=G.sibling,D!==null){D.return=G.return,G=D;break}G=G.return}D=G}Zr(d,p,M.children,b),p=p.child}return p;case 9:return M=p.type,S=p.pendingProps.children,Nl(p,b),M=$i(M),S=S(M),p.flags|=1,Zr(d,p,S,b),p.child;case 14:return S=p.type,M=yo(S,p.pendingProps),M=yo(S.type,M),zx(d,p,S,M,b);case 15:return Wx(d,p,p.type,p.pendingProps,b);case 17:return S=p.type,M=p.pendingProps,M=p.elementType===S?M:yo(S,M),kf(d,p),p.tag=1,si(S)?(d=!0,sf(p)):d=!1,Nl(p,b),Dx(p,S,M),Sv(p,S,M,b),Tv(null,p,S,!0,d,b);case 19:return Yx(d,p,b);case 22:return Hx(d,p,b)}throw Error(t(156,p.tag))};function b2(d,p){return $(d,p)}function q4(d,p,b,S){this.tag=d,this.key=b,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=p,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=S,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ki(d,p,b,S){return new q4(d,p,b,S)}function $v(d){return d=d.prototype,!(!d||!d.isReactComponent)}function $4(d){if(typeof d=="function")return $v(d)?1:0;if(d!=null){if(d=d.$$typeof,d===O)return 11;if(d===B)return 14}return 2}function Ms(d,p){var b=d.alternate;return b===null?(b=Ki(d.tag,p,d.key,d.mode),b.elementType=d.elementType,b.type=d.type,b.stateNode=d.stateNode,b.alternate=d,d.alternate=b):(b.pendingProps=p,b.type=d.type,b.flags=0,b.subtreeFlags=0,b.deletions=null),b.flags=d.flags&14680064,b.childLanes=d.childLanes,b.lanes=d.lanes,b.child=d.child,b.memoizedProps=d.memoizedProps,b.memoizedState=d.memoizedState,b.updateQueue=d.updateQueue,p=d.dependencies,b.dependencies=p===null?null:{lanes:p.lanes,firstContext:p.firstContext},b.sibling=d.sibling,b.index=d.index,b.ref=d.ref,b}function Of(d,p,b,S,M,D){var G=2;if(S=d,typeof d=="function")$v(d)&&(G=1);else if(typeof d=="string")G=5;else e:switch(d){case R:return ku(b.children,M,D,p);case I:G=8,M|=8;break;case T:return d=Ki(12,b,p,M|2),d.elementType=T,d.lanes=D,d;case V:return d=Ki(13,b,p,M),d.elementType=V,d.lanes=D,d;case F:return d=Ki(19,b,p,M),d.elementType=F,d.lanes=D,d;case P:return Lf(b,M,D,p);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case A:G=10;break e;case N:G=9;break e;case O:G=11;break e;case B:G=14;break e;case U:G=16,S=null;break e}throw Error(t(130,d==null?d:typeof d,""))}return p=Ki(G,b,p,M),p.elementType=d,p.type=S,p.lanes=D,p}function ku(d,p,b,S){return d=Ki(7,d,S,p),d.lanes=b,d}function Lf(d,p,b,S){return d=Ki(22,d,S,p),d.elementType=P,d.lanes=b,d.stateNode={isHidden:!1},d}function Xv(d,p,b){return d=Ki(6,d,null,p),d.lanes=b,d}function Yv(d,p,b){return p=Ki(4,d.children!==null?d.children:[],d.key,p),p.lanes=b,p.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},p}function X4(d,p,b,S,M){this.tag=p,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ar(0),this.expirationTimes=Ar(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ar(0),this.identifierPrefix=S,this.onRecoverableError=M,this.mutableSourceEagerHydrationData=null}function Kv(d,p,b,S,M,D,G,ee,ae){return d=new X4(d,p,b,ee,ae),p===1?(p=1,D===!0&&(p|=8)):p=0,D=Ki(3,null,null,p),d.current=D,D.stateNode=d,D.memoizedState={element:S,isDehydrated:b,cache:null,transitions:null,pendingSuspenseBoundaries:null},lv(D),d}function Y4(d,p,b){var S=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:C,key:S==null?null:""+S,children:d,containerInfo:p,implementation:b}}function w2(d){if(!d)return bs;d=d._reactInternals;e:{if(po(d)!==d||d.tag!==1)throw Error(t(170));var p=d;do{switch(p.tag){case 3:p=p.stateNode.context;break e;case 1:if(si(p.type)){p=p.stateNode.__reactInternalMemoizedMergedChildContext;break e}}p=p.return}while(p!==null);throw Error(t(171))}if(d.tag===1){var b=d.type;if(si(b))return X_(d,b,p)}return p}function _2(d,p,b,S,M,D,G,ee,ae){return d=Kv(b,S,!0,d,M,D,G,ee,ae),d.context=w2(null),b=d.current,S=Qr(),M=Cs(b),D=Ta(S,M),D.callback=p??null,xs(b,D,M),d.current.lanes=M,Yn(d,M,S),ci(d,S),d}function Bf(d,p,b,S){var M=p.current,D=Qr(),G=Cs(M);return b=w2(b),p.context===null?p.context=b:p.pendingContext=b,p=Ta(D,G),p.payload={element:d},S=S===void 0?null:S,S!==null&&(p.callback=S),d=xs(M,p,G),d!==null&&(_o(d,M,G,D),mf(d,M,G)),G}function Uf(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 5:return d.child.stateNode;default:return d.child.stateNode}}function x2(d,p){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var b=d.retryLane;d.retryLane=b!==0&&b<p?b:p}}function Jv(d,p){x2(d,p),(d=d.alternate)&&x2(d,p)}function K4(){return null}var S2=typeof reportError=="function"?reportError:function(d){console.error(d)};function Zv(d){this._internalRoot=d}zf.prototype.render=Zv.prototype.render=function(d){var p=this._internalRoot;if(p===null)throw Error(t(409));Bf(d,p,null,null)},zf.prototype.unmount=Zv.prototype.unmount=function(){var d=this._internalRoot;if(d!==null){this._internalRoot=null;var p=d.containerInfo;xu(function(){Bf(null,d,null,null)}),p[xa]=null}};function zf(d){this._internalRoot=d}zf.prototype.unstable_scheduleHydration=function(d){if(d){var p=a_();d={blockedOn:null,target:d,priority:p};for(var b=0;b<ps.length&&p!==0&&p<ps[b].priority;b++);ps.splice(b,0,d),b===0&&l_(d)}};function Qv(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)}function Wf(d){return!(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11&&(d.nodeType!==8||d.nodeValue!==" react-mount-point-unstable "))}function E2(){}function J4(d,p,b,S,M){if(M){if(typeof S=="function"){var D=S;S=function(){var Se=Uf(G);D.call(Se)}}var G=_2(p,S,d,0,null,!1,!1,"",E2);return d._reactRootContainer=G,d[xa]=G.current,ph(d.nodeType===8?d.parentNode:d),xu(),G}for(;M=d.lastChild;)d.removeChild(M);if(typeof S=="function"){var ee=S;S=function(){var Se=Uf(ae);ee.call(Se)}}var ae=Kv(d,0,!1,null,null,!1,!1,"",E2);return d._reactRootContainer=ae,d[xa]=ae.current,ph(d.nodeType===8?d.parentNode:d),xu(function(){Bf(p,ae,b,S)}),ae}function Hf(d,p,b,S,M){var D=b._reactRootContainer;if(D){var G=D;if(typeof M=="function"){var ee=M;M=function(){var ae=Uf(G);ee.call(ae)}}Bf(p,G,d,M)}else G=J4(b,p,d,M,S);return Uf(G)}i_=function(d){switch(d.tag){case 3:var p=d.stateNode;if(p.current.memoizedState.isDehydrated){var b=tr(p.pendingLanes);b!==0&&(fu(p,b|1),ci(p,he()),(dn&6)===0&&(Bl=he()+500,ws()))}break;case 13:xu(function(){var S=Ca(d,1);if(S!==null){var M=Qr();_o(S,d,1,M)}}),Jv(d,1)}},Eg=function(d){if(d.tag===13){var p=Ca(d,134217728);if(p!==null){var b=Qr();_o(p,d,134217728,b)}Jv(d,134217728)}},o_=function(d){if(d.tag===13){var p=Cs(d),b=Ca(d,p);if(b!==null){var S=Qr();_o(b,d,p,S)}Jv(d,p)}},a_=function(){return rn},s_=function(d,p){var b=rn;try{return rn=d,p()}finally{rn=b}},He=function(d,p,b){switch(p){case"input":if(qe(d,b),p=b.name,b.type==="radio"&&p!=null){for(b=d;b.parentNode;)b=b.parentNode;for(b=b.querySelectorAll("input[name="+JSON.stringify(""+p)+'][type="radio"]'),p=0;p<b.length;p++){var S=b[p];if(S!==d&&S.form===d.form){var M=of(S);if(!M)throw Error(t(90));lt(S),qe(S,M)}}}break;case"textarea":j(d,b);break;case"select":p=b.value,p!=null&&Mt(d,!!b.multiple,p,!1)}},Ht=Vv,bn=xu;var Z4={usingClientEntryPoint:!1,Events:[vh,kl,of,Fe,gt,Vv]},Ih={findFiberByHostInstance:pu,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Q4={bundleType:Ih.bundleType,version:Ih.version,rendererPackageName:Ih.rendererPackageName,rendererConfig:Ih.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_.ReactCurrentDispatcher,findHostInstanceByFiber:function(d){return d=Wd(d),d===null?null:d.stateNode},findFiberByHostInstance:Ih.findFiberByHostInstance||K4,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gf.isDisabled&&Gf.supportsFiber)try{At=Gf.inject(Q4),jt=Gf}catch{}}return hi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Z4,hi.createPortal=function(d,p){var b=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Qv(p))throw Error(t(200));return Y4(d,p,null,b)},hi.createRoot=function(d,p){if(!Qv(d))throw Error(t(299));var b=!1,S="",M=S2;return p!=null&&(p.unstable_strictMode===!0&&(b=!0),p.identifierPrefix!==void 0&&(S=p.identifierPrefix),p.onRecoverableError!==void 0&&(M=p.onRecoverableError)),p=Kv(d,1,!1,null,null,b,!1,S,M),d[xa]=p.current,ph(d.nodeType===8?d.parentNode:d),new Zv(p)},hi.findDOMNode=function(d){if(d==null)return null;if(d.nodeType===1)return d;var p=d._reactInternals;if(p===void 0)throw typeof d.render=="function"?Error(t(188)):(d=Object.keys(d).join(","),Error(t(268,d)));return d=Wd(p),d=d===null?null:d.stateNode,d},hi.flushSync=function(d){return xu(d)},hi.hydrate=function(d,p,b){if(!Wf(p))throw Error(t(200));return Hf(null,d,p,!0,b)},hi.hydrateRoot=function(d,p,b){if(!Qv(d))throw Error(t(405));var S=b!=null&&b.hydratedSources||null,M=!1,D="",G=S2;if(b!=null&&(b.unstable_strictMode===!0&&(M=!0),b.identifierPrefix!==void 0&&(D=b.identifierPrefix),b.onRecoverableError!==void 0&&(G=b.onRecoverableError)),p=_2(p,null,d,1,b??null,M,!1,D,G),d[xa]=p.current,ph(d),S)for(d=0;d<S.length;d++)b=S[d],M=b._getVersion,M=M(b._source),p.mutableSourceEagerHydrationData==null?p.mutableSourceEagerHydrationData=[b,M]:p.mutableSourceEagerHydrationData.push(b,M);return new zf(p)},hi.render=function(d,p,b){if(!Wf(p))throw Error(t(200));return Hf(null,d,p,!1,b)},hi.unmountComponentAtNode=function(d){if(!Wf(d))throw Error(t(40));return d._reactRootContainer?(xu(function(){Hf(null,null,d,!1,function(){d._reactRootContainer=null,d[xa]=null})}),!0):!1},hi.unstable_batchedUpdates=Vv,hi.unstable_renderSubtreeIntoContainer=function(d,p,b,S){if(!Wf(b))throw Error(t(200));if(d==null||d._reactInternals===void 0)throw Error(t(38));return Hf(d,p,b,!1,S)},hi.version="18.3.1-next-f1338f8080-20240426",hi}var D2;function oC(){if(D2)return ny.exports;D2=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),ny.exports=sI(),ny.exports}var N2;function uI(){if(N2)return Vf;N2=1;var r=oC();return Vf.createRoot=r.createRoot,Vf.hydrateRoot=r.hydrateRoot,Vf}var lI=uI(),Ke=$c();const zi=iu(Ke);var oy={},ay={},sy={},P2;function cI(){return P2||(P2=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var e=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];if(typeof window<"u"){var s;typeof window.gtag>"u"&&(window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)}),(s=window).gtag.apply(s,o)}},t=e;r.default=t})(sy)),sy}var uy={},F2;function hI(){return F2||(F2=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var e=/^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;function t(s){return s.toString().trim().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g,function(u,l,c){return l>0&&l+u.length!==c.length&&u.search(e)>-1&&c.charAt(l-2)!==":"&&(c.charAt(l+u.length)!=="-"||c.charAt(l-1)==="-")&&c.charAt(l-1).search(/[^\s-]/)<0?u.toLowerCase():u.substr(1).search(/[A-Z]|\../)>-1?u:u.charAt(0).toUpperCase()+u.substr(1)})}function n(s){return typeof s=="string"&&s.indexOf("@")!==-1}var i="REDACTED (Potential Email Address)";function o(s){return n(s)?(console.warn("This arg looks like an email address, redacting."),i):s}function a(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,c=s||"";return u&&(c=t(s)),l&&(c=o(c)),c}})(uy)),uy}var O2;function dI(){return O2||(O2=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.GA4=void 0;var e=a(cI()),t=a(hI()),n=["eventCategory","eventAction","eventLabel","eventValue","hitType"],i=["title","location"],o=["page","hitType"];function a(F){return F&&F.__esModule?F:{default:F}}function s(F,B){if(F==null)return{};var U=u(F,B),P,L;if(Object.getOwnPropertySymbols){var H=Object.getOwnPropertySymbols(F);for(L=0;L<H.length;L++)P=H[L],!(B.indexOf(P)>=0)&&Object.prototype.propertyIsEnumerable.call(F,P)&&(U[P]=F[P])}return U}function u(F,B){if(F==null)return{};var U={},P=Object.keys(F),L,H;for(H=0;H<P.length;H++)L=P[H],!(B.indexOf(L)>=0)&&(U[L]=F[L]);return U}function l(F){"@babel/helpers - typeof";return l=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(B){return typeof B}:function(B){return B&&typeof Symbol=="function"&&B.constructor===Symbol&&B!==Symbol.prototype?"symbol":typeof B},l(F)}function c(F){return m(F)||f(F)||x(F)||h()}function h(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function f(F){if(typeof Symbol<"u"&&F[Symbol.iterator]!=null||F["@@iterator"]!=null)return Array.from(F)}function m(F){if(Array.isArray(F))return E(F)}function g(F,B){var U=Object.keys(F);if(Object.getOwnPropertySymbols){var P=Object.getOwnPropertySymbols(F);B&&(P=P.filter(function(L){return Object.getOwnPropertyDescriptor(F,L).enumerable})),U.push.apply(U,P)}return U}function w(F){for(var B=1;B<arguments.length;B++){var U=arguments[B]!=null?arguments[B]:{};B%2?g(Object(U),!0).forEach(function(P){T(F,P,U[P])}):Object.getOwnPropertyDescriptors?Object.defineProperties(F,Object.getOwnPropertyDescriptors(U)):g(Object(U)).forEach(function(P){Object.defineProperty(F,P,Object.getOwnPropertyDescriptor(U,P))})}return F}function v(F,B){return k(F)||_(F,B)||x(F,B)||y()}function y(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function x(F,B){if(F){if(typeof F=="string")return E(F,B);var U=Object.prototype.toString.call(F).slice(8,-1);if(U==="Object"&&F.constructor&&(U=F.constructor.name),U==="Map"||U==="Set")return Array.from(F);if(U==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(U))return E(F,B)}}function E(F,B){(B==null||B>F.length)&&(B=F.length);for(var U=0,P=new Array(B);U<B;U++)P[U]=F[U];return P}function _(F,B){var U=F==null?null:typeof Symbol<"u"&&F[Symbol.iterator]||F["@@iterator"];if(U!=null){var P,L,H,W,z=[],q=!0,re=!1;try{if(H=(U=U.call(F)).next,B!==0)for(;!(q=(P=H.call(U)).done)&&(z.push(P.value),z.length!==B);q=!0);}catch(de){re=!0,L=de}finally{try{if(!q&&U.return!=null&&(W=U.return(),Object(W)!==W))return}finally{if(re)throw L}}return z}}function k(F){if(Array.isArray(F))return F}function C(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function R(F,B){for(var U=0;U<B.length;U++){var P=B[U];P.enumerable=P.enumerable||!1,P.configurable=!0,"value"in P&&(P.writable=!0),Object.defineProperty(F,A(P.key),P)}}function I(F,B,U){return B&&R(F.prototype,B),Object.defineProperty(F,"prototype",{writable:!1}),F}function T(F,B,U){return B=A(B),B in F?Object.defineProperty(F,B,{value:U,enumerable:!0,configurable:!0,writable:!0}):F[B]=U,F}function A(F){var B=N(F,"string");return l(B)==="symbol"?B:String(B)}function N(F,B){if(l(F)!=="object"||F===null)return F;var U=F[Symbol.toPrimitive];if(U!==void 0){var P=U.call(F,B);if(l(P)!=="object")return P;throw new TypeError("@@toPrimitive must return a primitive value.")}return(B==="string"?String:Number)(F)}var O=(function(){function F(){var B=this;C(this,F),T(this,"reset",function(){B.isInitialized=!1,B._testMode=!1,B._currentMeasurementId,B._hasLoadedGA=!1,B._isQueuing=!1,B._queueGtag=[]}),T(this,"_gtag",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];B._testMode||B._isQueuing?B._queueGtag.push(P):e.default.apply(void 0,P)}),T(this,"_loadGA",function(U,P){var L=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"https://www.googletagmanager.com/gtag/js";if(!(typeof window>"u"||typeof document>"u")&&!B._hasLoadedGA){var H=document.createElement("script");H.async=!0,H.src="".concat(L,"?id=").concat(U),P&&H.setAttribute("nonce",P),document.body.appendChild(H),window.dataLayer=window.dataLayer||[],window.gtag=function(){window.dataLayer.push(arguments)},B._hasLoadedGA=!0}}),T(this,"_toGtagOptions",function(U){if(U){var P={cookieUpdate:"cookie_update",cookieExpires:"cookie_expires",cookieDomain:"cookie_domain",cookieFlags:"cookie_flags",userId:"user_id",clientId:"client_id",anonymizeIp:"anonymize_ip",contentGroup1:"content_group1",contentGroup2:"content_group2",contentGroup3:"content_group3",contentGroup4:"content_group4",contentGroup5:"content_group5",allowAdFeatures:"allow_google_signals",allowAdPersonalizationSignals:"allow_ad_personalization_signals",nonInteraction:"non_interaction",page:"page_path",hitCallback:"event_callback"},L=Object.entries(U).reduce(function(H,W){var z=v(W,2),q=z[0],re=z[1];return P[q]?H[P[q]]=re:H[q]=re,H},{});return L}}),T(this,"initialize",function(U){var P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!U)throw new Error("Require GA_MEASUREMENT_ID");var L=typeof U=="string"?[{trackingId:U}]:U;B._currentMeasurementId=L[0].trackingId;var H=P.gaOptions,W=P.gtagOptions,z=P.nonce,q=P.testMode,re=q===void 0?!1:q,de=P.gtagUrl;if(B._testMode=re,re||B._loadGA(B._currentMeasurementId,z,de),B.isInitialized||(B._gtag("js",new Date),L.forEach(function(ie){var fe=w(w(w({},B._toGtagOptions(w(w({},H),ie.gaOptions))),W),ie.gtagOptions);Object.keys(fe).length?B._gtag("config",ie.trackingId,fe):B._gtag("config",ie.trackingId)})),B.isInitialized=!0,!re){var ye=c(B._queueGtag);for(B._queueGtag=[],B._isQueuing=!1;ye.length;){var ne=ye.shift();B._gtag.apply(B,c(ne)),ne[0]==="get"&&(B._isQueuing=!0)}}}),T(this,"set",function(U){if(!U){console.warn("`fieldsObject` is required in .set()");return}if(l(U)!=="object"){console.warn("Expected `fieldsObject` arg to be an Object");return}Object.keys(U).length===0&&console.warn("empty `fieldsObject` given to .set()"),B._gaCommand("set",U)}),T(this,"_gaCommandSendEvent",function(U,P,L,H,W){B._gtag("event",P,w(w({event_category:U,event_label:L,value:H},W&&{non_interaction:W.nonInteraction}),B._toGtagOptions(W)))}),T(this,"_gaCommandSendEventParameters",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];if(typeof P[0]=="string")B._gaCommandSendEvent.apply(B,c(P.slice(1)));else{var H=P[0],W=H.eventCategory,z=H.eventAction,q=H.eventLabel,re=H.eventValue;H.hitType;var de=s(H,n);B._gaCommandSendEvent(W,z,q,re,de)}}),T(this,"_gaCommandSendTiming",function(U,P,L,H){B._gtag("event","timing_complete",{name:P,value:L,event_category:U,event_label:H})}),T(this,"_gaCommandSendPageview",function(U,P){if(P&&Object.keys(P).length){var L=B._toGtagOptions(P),H=L.title,W=L.location,z=s(L,i);B._gtag("event","page_view",w(w(w(w({},U&&{page_path:U}),H&&{page_title:H}),W&&{page_location:W}),z))}else U?B._gtag("event","page_view",{page_path:U}):B._gtag("event","page_view")}),T(this,"_gaCommandSendPageviewParameters",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];if(typeof P[0]=="string")B._gaCommandSendPageview.apply(B,c(P.slice(1)));else{var H=P[0],W=H.page;H.hitType;var z=s(H,o);B._gaCommandSendPageview(W,z)}}),T(this,"_gaCommandSend",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];var H=typeof P[0]=="string"?P[0]:P[0].hitType;switch(H){case"event":B._gaCommandSendEventParameters.apply(B,P);break;case"pageview":B._gaCommandSendPageviewParameters.apply(B,P);break;case"timing":B._gaCommandSendTiming.apply(B,c(P.slice(1)));break;case"screenview":case"transaction":case"item":case"social":case"exception":console.warn("Unsupported send command: ".concat(H));break;default:console.warn("Send command doesn't exist: ".concat(H))}}),T(this,"_gaCommandSet",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];typeof P[0]=="string"&&(P[0]=T({},P[0],P[1])),B._gtag("set",B._toGtagOptions(P[0]))}),T(this,"_gaCommand",function(U){for(var P=arguments.length,L=new Array(P>1?P-1:0),H=1;H<P;H++)L[H-1]=arguments[H];switch(U){case"send":B._gaCommandSend.apply(B,L);break;case"set":B._gaCommandSet.apply(B,L);break;default:console.warn("Command doesn't exist: ".concat(U))}}),T(this,"ga",function(){for(var U=arguments.length,P=new Array(U),L=0;L<U;L++)P[L]=arguments[L];if(typeof P[0]=="string")B._gaCommand.apply(B,P);else{var H=P[0];B._gtag("get",B._currentMeasurementId,"client_id",function(W){B._isQueuing=!1;var z=B._queueGtag;for(H({get:function(de){return de==="clientId"?W:de==="trackingId"?B._currentMeasurementId:de==="apiVersion"?"1":void 0}});z.length;){var q=z.shift();B._gtag.apply(B,c(q))}}),B._isQueuing=!0}return B.ga}),T(this,"event",function(U,P){if(typeof U=="string")B._gtag("event",U,B._toGtagOptions(P));else{var L=U.action,H=U.category,W=U.label,z=U.value,q=U.nonInteraction,re=U.transport;if(!H||!L){console.warn("args.category AND args.action are required in event()");return}var de={hitType:"event",eventCategory:(0,t.default)(H),eventAction:(0,t.default)(L)};W&&(de.eventLabel=(0,t.default)(W)),typeof z<"u"&&(typeof z!="number"?console.warn("Expected `args.value` arg to be a Number."):de.eventValue=z),typeof q<"u"&&(typeof q!="boolean"?console.warn("`args.nonInteraction` must be a boolean."):de.nonInteraction=q),typeof re<"u"&&(typeof re!="string"?console.warn("`args.transport` must be a string."):(["beacon","xhr","image"].indexOf(re)===-1&&console.warn("`args.transport` must be either one of these values: `beacon`, `xhr` or `image`"),de.transport=re)),B._gaCommand("send",de)}}),T(this,"send",function(U){B._gaCommand("send",U)}),this.reset()}return I(F,[{key:"gtag",value:function(){this._gtag.apply(this,arguments)}}]),F})();r.GA4=O;var V=new O;r.default=V})(ay)),ay}var L2;function fI(){return L2||(L2=1,(function(r){function e(s){"@babel/helpers - typeof";return e=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(u){return typeof u}:function(u){return u&&typeof Symbol=="function"&&u.constructor===Symbol&&u!==Symbol.prototype?"symbol":typeof u},e(s)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=r.ReactGAImplementation=void 0;var t=i(dI());function n(s){if(typeof WeakMap!="function")return null;var u=new WeakMap,l=new WeakMap;return(n=function(h){return h?l:u})(s)}function i(s,u){if(s&&s.__esModule)return s;if(s===null||e(s)!=="object"&&typeof s!="function")return{default:s};var l=n(u);if(l&&l.has(s))return l.get(s);var c={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var f in s)if(f!=="default"&&Object.prototype.hasOwnProperty.call(s,f)){var m=h?Object.getOwnPropertyDescriptor(s,f):null;m&&(m.get||m.set)?Object.defineProperty(c,f,m):c[f]=s[f]}return c.default=s,l&&l.set(s,c),c}var o=t.GA4;r.ReactGAImplementation=o;var a=t.default;r.default=a})(oy)),oy}var pI=fI();const aC=iu(pI),mI={name:"Abhishek Maharjan",label:"Software Engineer / SRE / Platform Engineer",picture:"",email:"rpidanny.abhishek@gmail.com",phone:"",website:"https://rpidanny.github.io/",summary:["Highly motivated Software Engineer with 11+ years of experience building scalable, resilient, fault-tolerant systems handling ~100k requests/sec. Passionate about LLMs, infrastructure, site reliability, and improving operational efficiency through automation."],location:{city:"Utrecht",country:"Netherlands",countryCode:"NL"},profiles:{social:[{network:"Twitter",username:"rpidanny",url:"https://twitter.com/rpidanny"},{network:"Medium",username:"rpidanny",url:"https://blog.abhishek.pro.np"}],cv:[{network:"Github",username:"rpidanny",url:"https://github.com/rpidanny"},{network:"Linkedin",username:"Abhishek Maharjan",url:"https://www.linkedin.com/in/abhishek-m-5b401999/"}]},quote:{quote:"People who are really serious about software should make their own hardware",author:"Alan Kay"}},gI=[{title:"AWS Certified Solutions Architect - Associate",issueDate:"Jun 03, 2019",expirationDate:"Jun 03, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=1&t=c&d=2019-06-03&ci=AWS00868684",image:"CSAA.png"},{title:"AWS Certified Developer - Associate",issueDate:"Aug 06, 2019",expirationDate:"Aug 06, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=2&t=c&d=2019-08-06&ci=AWS00868684",image:"CDVA.png"},{title:"AWS Certified SysOps Administrator - Associate",issueDate:"Aug 06, 2019",expirationDate:"Aug 06, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=3&t=c&d=2019-09-03&ci=AWS00868684",image:"CSOA.png"},{title:"AWS Certified Cloud Practitioner",issueDate:"Oct 09, 2019",expirationDate:"Oct 09, 2022",url:"https://www.certmetrics.com/amazon/public/badge.aspx?i=9&t=c&d=2019-10-09&ci=AWS00868684",image:"CCP.png"}],vI=[{company:"Lemonade",position:"Senior Software Engineer -- Telematics",website:"",startDate:"2023-02-01",endDate:"Present",summary:"Design and built core services for car telematics, focusing on high-volume data processing, platform reliability, and developer productivity.",highlights:["Re-architected the core telematics trips services, reducing MTTR by 90%, cutting container usage by 50%, and simplifying the domain to accelerate product delivery.","Built an IaC-driven observability provisioning framework for Datadog and Grafana that automated dashboard creation end-to-end, reducing setup time by ~98% (from multiple days to ~1 hour).","Developed a unified alerting library covering application, infrastructure, and business KPIs; standardized alert quality across all services.","Reduced DynamoDB costs by 70% on a high-volume subsystem via bloom-filterbased optimizations.","Designed and implemented a unified, scalable ingestion pipeline for mobile, OBD, and OEM trip data with single-config IaC provisioning.","Created a fully local runtime/testing workflow, improving DX and cutting development cycle time by ~95%.","Created a team CLI and tooling suite that streamlined local development, reduced onboarding friction, and improved operational efficiency."]},{company:"DAZN Group",position:"Senior Software Engineer",website:"",startDate:"2020-07-01",endDate:"2023-02-01",summary:"Designed and scaled core backend services handling ~100k requests/sec, supporting millions of DAZN users. Prioritized reliability, safe deployments, high performance, and cost efficiency across large-scale distributed systems.",highlights:["Introduced Blue/Green and Canary deployments, to reduce deployment-related incidents and reduced rollback time during incidents by ~98%.","Implemented a custom autoscaling solution that responded to traffic ~2 faster.","Built an internal load-testing platform capable of simulating thousands of requests per second, enabling frictionless performance testing across teams.","Built a cost-efficient data engineering pipeline reducing operational cost by 96%.","Developed and maintained an inner-source tool visualizing Terraform plans on PRs.","Built and maintain an inner-source package that became one of the most used package in DAZN."]},{company:"Trivago",position:"Cloud / Software Engineer",website:"",startDate:"2020-02-01",endDate:"2020-07-01",summary:"Design and implement scalable data pipelines on AWS and GCP that can handle billions of events.",highlights:["Played a key role in migration of data pipelines from AWS to GCP.","Built and scaled data pipelines to handle billions of events."]},{company:"Javra Software",position:"R&D Engineer",website:"",startDate:"2018-03-01",endDate:"2020-01-01",summary:"Build and scaled AI/ML products for a leading agritech company, owning the full lifecycle from training and deploying models on GPUs to orchestration and integration into production.",highlights:[]},{company:"Javra Software",position:"R&D Engineer",website:"",startDate:"2016-02-01",endDate:"2018-02-01",summary:"Built AI/ML and computer vision prototypes adopted in pilot projects. Built IoT and LoRa-based data collection systems for real-time monitoring and analytics. Created interactive data visualizations to support analysis and decision-making.",highlights:[]},{company:"Real Time Solutions Pvt. Ltd",position:"Firmware Intern",website:"",startDate:"2014-11-01",endDate:"2015-02-01",summary:"Worked on embedded firmware development and low-level protocols for microcontrollers.",highlights:["Developed ZigBee stack support for NXP microcontrollers and USB implementation on EFM32 MCUs.","Implemented RTOS functionalities for real-time embedded devices."]},{company:"Robotics Club, Kathmandu Engineering College",position:"President & Project Coordinator",website:"",startDate:"2013-10-01",endDate:"2015-12-01",summary:"Led club activities, managed and mentored members, and guided all technical projects from conception to completion.",highlights:["Delivered multiple robotics and automation projects including virtual telepresence robots, self-balancing and line-following robots, RC robots, and SCADA systems.","Developed standardized control APIs enabling seamless Bluetooth control across multiple clients.","Mentored members to complete projects successfully, improving both technical skills and club productivity."]}],yI=[{institution:"Kathmandu Engineering College",area:"Electronics and Communications Engineering",studyType:"Bachelor of Engineering",startDate:"2011-01-01",endDate:"2015-01-01",gpa:"",courses:[]}],bI={travel:{countriesVisited:["Austria","Belgium","Bosnia and Herz.","China","Croatia","Czechia","France","Germany","Hungary","India","Italy","Nepal","Netherlands","Qatar","Slovakia","Switzerland","Thailand","United Arab Emirates"]}},wI=[{title:"Running Nepal",description:"A comprehensive platform for the running community in Nepal, connecting runners, organizing events, and tracking achievements across the country.",url:"https://runningnepal.com/",image:"/images/projects/running-nepal-2.png",tags:["Community","Sports","Web Platform"]},{title:"Mercury",description:"Transform your GPX route files into stunning 3D terrain visualizations ready for 3D printing. Bring your running, hiking, and cycling adventures to life with beautiful bird's-eye views of the terrain you've traversed.",url:"https://mercury.runningnepal.com/",github:"https://github.com/rpidanny/mercury",image:"/images/projects/mercury.png",tags:["3D Printing","Sports","Adventure","Visualization"]},{title:"Darwin",description:"An elegant CLI wizard enhancing biotech research efficiency. Streamline your research with powerful tools for searching papers, downloading datasets, and natural language interactions.",url:"https://github.com/rpidanny/darwin",github:"https://github.com/rpidanny/darwin",image:"/images/projects/darwin.png",tags:["CLI","Biotech","Research","LLM","Agents"]}],_I={basics:mI,certifications:gI,work:vI,education:yI,interests:bI,projects:wI};var ly={exports:{}};var B2;function xI(){return B2||(B2=1,(function(r){(function(){var e={}.hasOwnProperty;function t(){for(var o="",a=0;a<arguments.length;a++){var s=arguments[a];s&&(o=i(o,n(s)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return t.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var s in o)e.call(o,s)&&o[s]&&(a=i(a,s));return a}function i(o,a){return a?o?o+" "+a:o+a:o}r.exports?(t.default=t,r.exports=t):window.classNames=t})()})(ly)),ly.exports}var SI=xI();const Yr=iu(SI);var cy={exports:{}},hy,U2;function EI(){if(U2)return hy;U2=1;var r="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return hy=r,hy}var dy,z2;function kI(){if(z2)return dy;z2=1;var r=EI();function e(){}function t(){}return t.resetWarningCache=e,dy=function(){function n(a,s,u,l,c,h){if(h!==r){var f=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw f.name="Invariant Violation",f}}n.isRequired=n;function i(){return n}var o={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:i,element:n,elementType:n,instanceOf:i,node:n,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return o.PropTypes=o,o},dy}var W2;function Km(){return W2||(W2=1,cy.exports=kI()()),cy.exports}var CI=Km();const Ao=iu(CI),TI=["xxl","xl","lg","md","sm","xs"],MI="xs",Jm=Ke.createContext({prefixes:{},breakpoints:TI,minBreakpoint:MI}),{Consumer:AJ,Provider:RJ}=Jm;function _i(r,e){const{prefixes:t}=Ke.useContext(Jm);return r||t[e]||e}function AI(){const{breakpoints:r}=Ke.useContext(Jm);return r}function RI(){const{minBreakpoint:r}=Ke.useContext(Jm);return r}Ao.string,Ao.bool,Ao.bool,Ao.bool,Ao.bool;const sC=Ke.forwardRef(({bsPrefix:r,className:e,fluid:t=!1,rounded:n=!1,roundedCircle:i=!1,thumbnail:o=!1,...a},s)=>(r=_i(r,"img"),Q.jsx("img",{ref:s,...a,className:Yr(e,t&&`${r}-fluid`,n&&"rounded",i&&"rounded-circle",o&&`${r}-thumbnail`)})));sC.displayName="Image";var uC={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},H2=zi.createContext&&zi.createContext(uC),II=["attr","size","title"];function DI(r,e){if(r==null)return{};var t=NI(r,e),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(r);for(i=0;i<o.length;i++)n=o[i],!(e.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(r,n)&&(t[n]=r[n])}return t}function NI(r,e){if(r==null)return{};var t={};for(var n in r)if(Object.prototype.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}function im(){return im=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},im.apply(this,arguments)}function G2(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(r,i).enumerable})),t.push.apply(t,n)}return t}function om(r){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?G2(Object(t),!0).forEach(function(n){PI(r,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(t)):G2(Object(t)).forEach(function(n){Object.defineProperty(r,n,Object.getOwnPropertyDescriptor(t,n))})}return r}function PI(r,e,t){return e=FI(e),e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function FI(r){var e=OI(r,"string");return typeof e=="symbol"?e:e+""}function OI(r,e){if(typeof r!="object"||!r)return r;var t=r[Symbol.toPrimitive];if(t!==void 0){var n=t.call(r,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(r)}function lC(r){return r&&r.map((e,t)=>zi.createElement(e.tag,om({key:t},e.attr),lC(e.child)))}function ho(r){return e=>zi.createElement(LI,im({attr:om({},r.attr)},e),lC(r.child))}function LI(r){var e=t=>{var{attr:n,size:i,title:o}=r,a=DI(r,II),s=i||t.size||"1em",u;return t.className&&(u=t.className),r.className&&(u=(u?u+" ":"")+r.className),zi.createElement("svg",im({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,n,a,{className:u,style:om(om({color:r.color||t.color},t.style),r.style),height:s,width:s,xmlns:"http://www.w3.org/2000/svg"}),o&&zi.createElement("title",null,o),r.children)};return H2!==void 0?zi.createElement(H2.Consumer,null,t=>e(t)):e(uC)}function BI(r){return ho({attr:{viewBox:"0 0 496 512"},child:[{tag:"path",attr:{d:"M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"},child:[]}]})(r)}function UI(r){return ho({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1 34.8 34.9 56.2 81.2 56.1 130.5 0 101.8-84.9 184.6-186.6 184.6zm101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8-3.7 5.6-14.3 18-17.6 21.8-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7-1.4-2.8-12.5-30.1-17.1-41.2-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2-3.7 0-9.7 1.4-14.8 6.9-5.1 5.6-19.4 19-19.4 46.3 0 27.3 19.9 53.7 22.6 57.4 2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4 4.6-13 4.6-24.1 3.2-26.4-1.3-2.5-5-3.9-10.5-6.6z"},child:[]}]})(r)}function zI(r){return ho({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M448 360V24c0-13.3-10.7-24-24-24H96C43 0 0 43 0 96v320c0 53 43 96 96 96h328c13.3 0 24-10.7 24-24v-16c0-7.5-3.5-14.3-8.9-18.7-4.2-15.4-4.2-59.3 0-74.7 5.4-4.3 8.9-11.1 8.9-18.6zM128 134c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm0 64c0-3.3 2.7-6 6-6h212c3.3 0 6 2.7 6 6v20c0 3.3-2.7 6-6 6H134c-3.3 0-6-2.7-6-6v-20zm253.4 250H96c-17.7 0-32-14.3-32-32 0-17.6 14.4-32 32-32h285.4c-1.9 17.1-1.9 46.9 0 64z"},child:[]}]})(r)}function cC(r){return ho({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M320 336c0 8.84-7.16 16-16 16h-96c-8.84 0-16-7.16-16-16v-48H0v144c0 25.6 22.4 48 48 48h416c25.6 0 48-22.4 48-48V288H320v48zm144-208h-80V80c0-25.6-22.4-48-48-48H176c-25.6 0-48 22.4-48 48v48H48c-25.6 0-48 22.4-48 48v80h512v-80c0-25.6-22.4-48-48-48zm-144 0H192V96h128v32z"},child:[]}]})(r)}function hC(r){return ho({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V400c0 26.5-21.5 48-48 48H48c-26.5 0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5 0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"},child:[]}]})(r)}function WI(r){return ho({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"},child:[]}]})(r)}function HI(r){return ho({attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M622.34 153.2L343.4 67.5c-15.2-4.67-31.6-4.67-46.79 0L17.66 153.2c-23.54 7.23-23.54 38.36 0 45.59l48.63 14.94c-10.67 13.19-17.23 29.28-17.88 46.9C38.78 266.15 32 276.11 32 288c0 10.78 5.68 19.85 13.86 25.65L20.33 428.53C18.11 438.52 25.71 448 35.94 448h56.11c10.24 0 17.84-9.48 15.62-19.47L82.14 313.65C90.32 307.85 96 298.78 96 288c0-11.57-6.47-21.25-15.66-26.87.76-15.02 8.44-28.3 20.69-36.72L296.6 284.5c9.06 2.78 26.44 6.25 46.79 0l278.95-85.7c23.55-7.24 23.55-38.36 0-45.6zM352.79 315.09c-28.53 8.76-52.84 3.92-65.59 0l-145.02-44.55L128 384c0 35.35 85.96 64 192 64s192-28.65 192-64l-14.18-113.47-145.03 44.56z"},child:[]}]})(r)}function GI(r){return ho({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3 0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"},child:[]}]})(r)}function VI(r){return ho({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M493.4 24.6l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-36 76.7-98.9 140.5-177.2 177.2l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48C3.9 366.5-2 378.1.6 389.4l24 104C27.1 504.2 36.7 512 48 512c256.1 0 464-207.5 464-464 0-11.2-7.7-20.9-18.6-23.4z"},child:[]}]})(r)}function V2(r){return ho({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z"},child:[]}]})(r)}function Jp(r){return ho({attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M259.3 17.8L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0z"},child:[]}]})(r)}function jI(r){return ho({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(r)}var Ko={},Nh={},j2;function qI(){if(j2)return Nh;j2=1,Object.defineProperty(Nh,"__esModule",{value:!0}),Nh.on=r,Nh.off=e;function r(t,n,i,o){o=o||!1,t.addEventListener?t.addEventListener(n,i,o):t.attachEvent&&t.attachEvent("on"+n,function(a){i.call(t,a||window.event)})}function e(t,n,i,o){o=o||!1,t.removeEventListener?t.removeEventListener(n,i,o):t.detachEvent&&t.detachEvent("on"+n,i)}return Nh}var jf={},q2;function $I(){return q2||(q2=1,Object.defineProperty(jf,"__esModule",{value:!0}),jf.default=function(r){if(!(r instanceof HTMLElement))return document.documentElement;for(var e=r.style.position==="absolute",t=/(scroll|auto)/,n=r;n;){if(!n.parentNode)return r.ownerDocument||document.documentElement;var i=window.getComputedStyle(n),o=i.position,a=i.overflow,s=i["overflow-x"],u=i["overflow-y"];if(o==="static"&&e){n=n.parentNode;continue}if(t.test(a)&&t.test(s)&&t.test(u))return n;n=n.parentNode}return r.ownerDocument||r.documentElement||document.documentElement}),jf}var qf={},$2;function XI(){if($2)return qf;$2=1,Object.defineProperty(qf,"__esModule",{value:!0}),qf.default=r;function r(e,t,n){var i=void 0,o=void 0,a=void 0,s=void 0,u=void 0,l=function c(){var h=+new Date-s;h<t&&h>=0?i=setTimeout(c,t-h):(i=null,n||(u=e.apply(a,o),i||(a=null,o=null)))};return function(){a=this,o=arguments,s=+new Date;var h=n&&!i;return i||(i=setTimeout(l,t)),h&&(u=e.apply(a,o),a=null,o=null),u}}return qf}var $f={},X2;function YI(){if(X2)return $f;X2=1,Object.defineProperty($f,"__esModule",{value:!0}),$f.default=r;function r(e,t,n){t||(t=250);var i,o;return function(){var a=n||this,s=+new Date,u=arguments;i&&s<i+t?(clearTimeout(o),o=setTimeout(function(){i=s,e.apply(a,u)},t)):(i=s,e.apply(a,u))}}return $f}var Y2;function KI(){if(Y2)return Ko;Y2=1,Object.defineProperty(Ko,"__esModule",{value:!0}),Ko.forceVisible=Ko.forceCheck=Ko.lazyload=void 0;var r=(function(){function H(W,z){for(var q=0;q<z.length;q++){var re=z[q];re.enumerable=re.enumerable||!1,re.configurable=!0,"value"in re&&(re.writable=!0),Object.defineProperty(W,re.key,re)}}return function(W,z,q){return z&&H(W.prototype,z),q&&H(W,q),W}})(),e=$c(),t=f(e),n=Km(),i=f(n),o=qI(),a=$I(),s=f(a),u=XI(),l=f(u),c=YI(),h=f(c);function f(H){return H&&H.__esModule?H:{default:H}}function m(H,W){if(!(H instanceof W))throw new TypeError("Cannot call a class as a function")}function g(H,W){if(!H)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W&&(typeof W=="object"||typeof W=="function")?W:H}function w(H,W){if(typeof W!="function"&&W!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof W);H.prototype=Object.create(W&&W.prototype,{constructor:{value:H,enumerable:!1,writable:!0,configurable:!0}}),W&&(Object.setPrototypeOf?Object.setPrototypeOf(H,W):H.__proto__=W)}var v={top:0,left:0,width:0,height:0},y="data-lazyload-listened",x=[],E=[],_=!1;try{var k=Object.defineProperty({},"passive",{get:function(){_=!0}});window.addEventListener("test",null,k)}catch{}var C=_?{capture:!1,passive:!0}:!1,R=function(W,z){var q=W.ref,re=void 0,de=void 0,ye=void 0,ne=void 0;try{var ie=z.getBoundingClientRect();re=ie.top,de=ie.left,ye=ie.height,ne=ie.width}catch{re=v.top,de=v.left,ye=v.height,ne=v.width}var fe=window.innerHeight||document.documentElement.clientHeight,Ae=window.innerWidth||document.documentElement.clientWidth,De=Math.max(re,0),Be=Math.max(de,0),lt=Math.min(fe,re+ye)-De,Y=Math.min(Ae,de+ne)-Be,ot=void 0,Je=void 0,Xe=void 0,qe=void 0;try{var Tt=q.getBoundingClientRect();ot=Tt.top,Je=Tt.left,Xe=Tt.height,qe=Tt.width}catch{ot=v.top,Je=v.left,Xe=v.height,qe=v.width}var Qe=ot-De,ft=Je-Be,Mt=Array.isArray(W.props.offset)?W.props.offset:[W.props.offset,W.props.offset];return Qe-Mt[0]<=lt&&Qe+Xe+Mt[1]>=0&&ft-Mt[0]<=Y&&ft+qe+Mt[1]>=0},I=function(W){var z=W.ref;if(!(z.offsetWidth||z.offsetHeight||z.getClientRects().length))return!1;var q=void 0,re=void 0;try{var de=z.getBoundingClientRect();q=de.top,re=de.height}catch{q=v.top,re=v.height}var ye=window.innerHeight||document.documentElement.clientHeight,ne=Array.isArray(W.props.offset)?W.props.offset:[W.props.offset,W.props.offset];return q-ne[0]<=ye&&q+re+ne[1]>=0},T=function(W){var z=W.ref;if(z instanceof HTMLElement){var q=(0,s.default)(z),re=W.props.overflow&&q!==z.ownerDocument&&q!==document&&q!==document.documentElement,de=re?R(W,q):I(W);de?W.visible||(W.props.once&&E.push(W),W.visible=!0,W.forceUpdate()):W.props.once&&W.visible||(W.visible=!1,W.props.unmountIfInvisible&&W.forceUpdate())}},A=function(){E.forEach(function(W){var z=x.indexOf(W);z!==-1&&x.splice(z,1)}),E=[]},N=function(){for(var W=0;W<x.length;++W){var z=x[W];T(z)}A()},O=function(){for(var W=0;W<x.length;++W){var z=x[W];z.visible=!0,z.forceUpdate()}A()},V=void 0,F=null,B=function(W){return typeof W=="string"},U=(function(H){w(W,H);function W(z){m(this,W);var q=g(this,(W.__proto__||Object.getPrototypeOf(W)).call(this,z));return q.visible=!1,q.setRef=q.setRef.bind(q),q}return r(W,[{key:"componentDidMount",value:function(){var q=window,re=this.props.scrollContainer;re&&B(re)&&(q=q.document.querySelector(re));var de=this.props.debounce!==void 0&&V==="throttle"||V==="debounce"&&this.props.debounce===void 0;if(de&&((0,o.off)(q,"scroll",F,C),(0,o.off)(window,"resize",F,C),F=null),F||(this.props.debounce!==void 0?(F=(0,l.default)(N,typeof this.props.debounce=="number"?this.props.debounce:300),V="debounce"):this.props.throttle!==void 0?(F=(0,h.default)(N,typeof this.props.throttle=="number"?this.props.throttle:300),V="throttle"):F=N),this.props.overflow){var ye=(0,s.default)(this.ref);if(ye&&typeof ye.getAttribute=="function"){var ne=1+ +ye.getAttribute(y);ne===1&&ye.addEventListener("scroll",F,C),ye.setAttribute(y,ne)}}else if(x.length===0||de){var ie=this.props,fe=ie.scroll,Ae=ie.resize;fe&&(0,o.on)(q,"scroll",F,C),Ae&&(0,o.on)(window,"resize",F,C)}x.push(this),T(this)}},{key:"shouldComponentUpdate",value:function(){return this.visible}},{key:"componentWillUnmount",value:function(){if(this.props.overflow){var q=(0,s.default)(this.ref);if(q&&typeof q.getAttribute=="function"){var re=+q.getAttribute(y)-1;re===0?(q.removeEventListener("scroll",F,C),q.removeAttribute(y)):q.setAttribute(y,re)}}var de=x.indexOf(this);de!==-1&&x.splice(de,1),x.length===0&&typeof window<"u"&&((0,o.off)(window,"resize",F,C),(0,o.off)(window,"scroll",F,C))}},{key:"setRef",value:function(q){q&&(this.ref=q)}},{key:"render",value:function(){var q=this.props,re=q.height,de=q.children,ye=q.placeholder,ne=q.className,ie=q.classNamePrefix,fe=q.style;return t.default.createElement("div",{className:ie+"-wrapper "+ne,ref:this.setRef,style:fe},this.visible?de:ye||t.default.createElement("div",{style:{height:re},className:ie+"-placeholder"}))}}]),W})(e.Component);U.propTypes={className:i.default.string,classNamePrefix:i.default.string,once:i.default.bool,height:i.default.oneOfType([i.default.number,i.default.string]),offset:i.default.oneOfType([i.default.number,i.default.arrayOf(i.default.number)]),overflow:i.default.bool,resize:i.default.bool,scroll:i.default.bool,children:i.default.node,throttle:i.default.oneOfType([i.default.number,i.default.bool]),debounce:i.default.oneOfType([i.default.number,i.default.bool]),placeholder:i.default.node,scrollContainer:i.default.oneOfType([i.default.string,i.default.object]),unmountIfInvisible:i.default.bool,style:i.default.object},U.defaultProps={className:"",classNamePrefix:"lazyload",once:!1,offset:0,overflow:!1,resize:!1,scroll:!0,unmountIfInvisible:!1};var P=function(W){return W.displayName||W.name||"Component"},L=function(){var W=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(q){return(function(re){w(de,re);function de(){m(this,de);var ye=g(this,(de.__proto__||Object.getPrototypeOf(de)).call(this));return ye.displayName="LazyLoad"+P(q),ye}return r(de,[{key:"render",value:function(){return t.default.createElement(U,W,t.default.createElement(q,this.props))}}]),de})(e.Component)}};return Ko.lazyload=L,Ko.default=U,Ko.forceCheck=N,Ko.forceVisible=O,Ko}var JI=KI();const dC=iu(JI),K2=(r,e,t,n)=>{r.style.transition=`${e} ${t}ms ${n}`},Ba=(r,e,t)=>Math.min(Math.max(r,e),t);let ZI=class{constructor(e,t){this.glareAngle=0,this.glareOpacity=0,this.calculateGlareSize=a=>{const{width:s,height:u}=a,l=Math.sqrt(s**2+u**2);return{width:l,height:l}},this.setSize=a=>{const s=this.calculateGlareSize(a);this.glareEl.style.width=`${s.width}px`,this.glareEl.style.height=`${s.height}px`},this.update=(a,s,u,l)=>{this.updateAngle(a,s.glareReverse),this.updateOpacity(a,s,u,l)},this.updateAngle=(a,s)=>{const{xPercentage:u,yPercentage:l}=a,c=180/Math.PI,h=u?Math.atan2(l,-u)*c:0;this.glareAngle=h-(s?180:0)},this.updateOpacity=(a,s,u,l)=>{const{xPercentage:c,yPercentage:h}=a,{glarePosition:f,glareReverse:m,glareMaxOpacity:g}=s,w=u?-1:1,v=l?-1:1,y=m?-1:1;let x=0;switch(f){case"top":x=-c*w*y;break;case"right":x=h*v*y;break;case"bottom":case void 0:x=c*w*y;break;case"left":x=-h*v*y;break;case"all":x=Math.hypot(c,h)}const E=Ba(x,0,100);this.glareOpacity=E*g/100},this.render=a=>{const{glareColor:s}=a;this.glareEl.style.transform=`rotate(${this.glareAngle}deg) translate(-50%, -50%)`,this.glareEl.style.opacity=this.glareOpacity.toString(),this.glareEl.style.background=`linear-gradient(0deg, rgba(255,255,255,0) 0%, ${s} 100%)`},this.glareWrapperEl=document.createElement("div"),this.glareEl=document.createElement("div"),this.glareWrapperEl.appendChild(this.glareEl),this.glareWrapperEl.className="glare-wrapper",this.glareEl.className="glare";const n={position:"absolute",top:"0",left:"0",width:"100%",height:"100%",overflow:"hidden",borderRadius:t,WebkitMaskImage:"-webkit-radial-gradient(white, black)",pointerEvents:"none"},i=this.calculateGlareSize(e),o={position:"absolute",top:"50%",left:"50%",transformOrigin:"0% 0%",pointerEvents:"none",width:`${i.width}px`,height:`${i.height}px`};Object.assign(this.glareWrapperEl.style,n),Object.assign(this.glareEl.style,o)}},QI=class{constructor(){this.tiltAngleX=0,this.tiltAngleY=0,this.tiltAngleXPercentage=0,this.tiltAngleYPercentage=0,this.update=(e,t)=>{this.updateTilt(e,t),this.updateTiltManualInput(e,t),this.updateTiltReverse(t),this.updateTiltLimits(t)},this.updateTilt=(e,t)=>{const{xPercentage:n,yPercentage:i}=e,{tiltMaxAngleX:o,tiltMaxAngleY:a}=t;this.tiltAngleX=n*o/100,this.tiltAngleY=i*a/100*-1},this.updateTiltManualInput=(e,t)=>{const{tiltAngleXManual:n,tiltAngleYManual:i,tiltMaxAngleX:o,tiltMaxAngleY:a}=t;(n!==null||i!==null)&&(this.tiltAngleX=n!==null?n:0,this.tiltAngleY=i!==null?i:0,e.xPercentage=100*this.tiltAngleX/o,e.yPercentage=100*this.tiltAngleY/a)},this.updateTiltReverse=e=>{const t=e.tiltReverse?-1:1;this.tiltAngleX=t*this.tiltAngleX,this.tiltAngleY=t*this.tiltAngleY},this.updateTiltLimits=e=>{const{tiltAxis:t}=e;this.tiltAngleX=Ba(this.tiltAngleX,-90,90),this.tiltAngleY=Ba(this.tiltAngleY,-90,90),t&&(this.tiltAngleX=t==="x"?this.tiltAngleX:0,this.tiltAngleY=t==="y"?this.tiltAngleY:0)},this.updateTiltAnglesPercentage=e=>{const{tiltMaxAngleX:t,tiltMaxAngleY:n}=e;this.tiltAngleXPercentage=this.tiltAngleX/t*100,this.tiltAngleYPercentage=this.tiltAngleY/n*100},this.render=e=>{e.style.transform+=`rotateX(${this.tiltAngleX}deg) rotateY(${this.tiltAngleY}deg) `}}};const eD={scale:1,perspective:1e3,flipVertically:!1,flipHorizontally:!1,reset:!0,transitionEasing:"cubic-bezier(.03,.98,.52,.99)",transitionSpeed:400,trackOnWindow:!1,gyroscope:!1,tiltEnable:!0,tiltReverse:!1,tiltAngleXInitial:0,tiltAngleYInitial:0,tiltMaxAngleX:20,tiltMaxAngleY:20,tiltAxis:void 0,tiltAngleXManual:null,tiltAngleYManual:null,glareEnable:!1,glareMaxOpacity:.7,glareColor:"#ffffff",glarePosition:"bottom",glareReverse:!1,glareBorderRadius:"0"};let fC=class extends Ke.PureComponent{constructor(){super(...arguments),this.wrapperEl={node:null,size:{width:0,height:0,left:0,top:0},clientPosition:{x:null,y:null,xPercentage:0,yPercentage:0},updateAnimationId:null,scale:1},this.tilt=null,this.glare=null,this.addDeviceOrientationEventListener=async()=>{if(!window.DeviceOrientationEvent)return;const e=DeviceOrientationEvent.requestPermission;typeof e=="function"?await e()==="granted"&&window.addEventListener("deviceorientation",this.onMove):window.addEventListener("deviceorientation",this.onMove)},this.setSize=()=>{this.setWrapperElSize(),this.glare&&this.glare.setSize(this.wrapperEl.size)},this.mainLoop=e=>{this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.processInput(e),this.update(e.type),this.wrapperEl.updateAnimationId=requestAnimationFrame(this.renderFrame)},this.onEnter=e=>{const{onEnter:t}=this.props;this.setSize(),this.wrapperEl.node.style.willChange="transform",this.setTransitions(),t&&t({event:e})},this.onMove=e=>{this.mainLoop(e),this.emitOnMove(e)},this.onLeave=e=>{const{onLeave:t}=this.props;if(this.setTransitions(),t&&t({event:e}),this.props.reset){const n=new CustomEvent("autoreset");this.onMove(n)}},this.processInput=e=>{const{scale:t}=this.props;switch(e.type){case"mousemove":this.wrapperEl.clientPosition.x=e.pageX,this.wrapperEl.clientPosition.y=e.pageY,this.wrapperEl.scale=t;break;case"touchmove":this.wrapperEl.clientPosition.x=e.touches[0].pageX,this.wrapperEl.clientPosition.y=e.touches[0].pageY,this.wrapperEl.scale=t;break;case"deviceorientation":this.processInputDeviceOrientation(e),this.wrapperEl.scale=t;break;case"autoreset":{const{tiltAngleXInitial:n,tiltAngleYInitial:i,tiltMaxAngleX:o,tiltMaxAngleY:a}=this.props,s=i/a*100;this.wrapperEl.clientPosition.xPercentage=Ba(n/o*100,-100,100),this.wrapperEl.clientPosition.yPercentage=Ba(s,-100,100),this.wrapperEl.scale=1;break}}},this.processInputDeviceOrientation=e=>{if(!e.gamma||!e.beta||!this.props.gyroscope)return;const{tiltMaxAngleX:t,tiltMaxAngleY:n}=this.props,i=e.gamma;this.wrapperEl.clientPosition.xPercentage=e.beta/t*100,this.wrapperEl.clientPosition.yPercentage=i/n*100,this.wrapperEl.clientPosition.xPercentage=Ba(this.wrapperEl.clientPosition.xPercentage,-100,100),this.wrapperEl.clientPosition.yPercentage=Ba(this.wrapperEl.clientPosition.yPercentage,-100,100)},this.update=e=>{const{tiltEnable:t,flipVertically:n,flipHorizontally:i}=this.props;e!=="autoreset"&&e!=="deviceorientation"&&e!=="propChange"&&this.updateClientInput(),t&&this.tilt.update(this.wrapperEl.clientPosition,this.props),this.updateFlip(),this.tilt.updateTiltAnglesPercentage(this.props),this.glare&&this.glare.update(this.wrapperEl.clientPosition,this.props,n,i)},this.updateClientInput=()=>{const{trackOnWindow:e}=this.props;let t,n;if(e){const{x:i,y:o}=this.wrapperEl.clientPosition;t=o/window.innerHeight*200-100,n=i/window.innerWidth*200-100}else{const{size:{width:i,height:o,left:a,top:s},clientPosition:{x:u,y:l}}=this.wrapperEl;t=(l-s)/o*200-100,n=(u-a)/i*200-100}this.wrapperEl.clientPosition.xPercentage=Ba(t,-100,100),this.wrapperEl.clientPosition.yPercentage=Ba(n,-100,100)},this.updateFlip=()=>{const{flipVertically:e,flipHorizontally:t}=this.props;e&&(this.tilt.tiltAngleX+=180,this.tilt.tiltAngleY*=-1),t&&(this.tilt.tiltAngleY+=180)},this.renderFrame=()=>{this.resetWrapperElTransform(),this.renderPerspective(),this.tilt.render(this.wrapperEl.node),this.renderScale(),this.glare&&this.glare.render(this.props)}}componentDidMount(){if(this.tilt=new QI,this.initGlare(),this.setSize(),this.addEventListeners(),typeof CustomEvent>"u")return;const e=new CustomEvent("autoreset");this.mainLoop(e);const t=new CustomEvent("initial");this.emitOnMove(t)}componentWillUnmount(){this.wrapperEl.updateAnimationId!==null&&cancelAnimationFrame(this.wrapperEl.updateAnimationId),this.removeEventListeners()}componentDidUpdate(){const e=new CustomEvent("propChange");this.mainLoop(e),this.emitOnMove(e)}addEventListeners(){const{trackOnWindow:e,gyroscope:t}=this.props;window.addEventListener("resize",this.setSize),e&&(window.addEventListener("mouseenter",this.onEnter),window.addEventListener("mousemove",this.onMove),window.addEventListener("mouseout",this.onLeave),window.addEventListener("touchstart",this.onEnter),window.addEventListener("touchmove",this.onMove),window.addEventListener("touchend",this.onLeave)),t&&this.addDeviceOrientationEventListener()}removeEventListeners(){const{trackOnWindow:e,gyroscope:t}=this.props;window.removeEventListener("resize",this.setSize),e&&(window.removeEventListener("mouseenter",this.onEnter),window.removeEventListener("mousemove",this.onMove),window.removeEventListener("mouseout",this.onLeave),window.removeEventListener("touchstart",this.onEnter),window.removeEventListener("touchmove",this.onMove),window.removeEventListener("touchend",this.onLeave)),t&&window.DeviceOrientationEvent&&window.removeEventListener("deviceorientation",this.onMove)}setWrapperElSize(){const e=this.wrapperEl.node.getBoundingClientRect();this.wrapperEl.size.width=this.wrapperEl.node.offsetWidth,this.wrapperEl.size.height=this.wrapperEl.node.offsetHeight,this.wrapperEl.size.left=e.left+window.scrollX,this.wrapperEl.size.top=e.top+window.scrollY}initGlare(){const{glareEnable:e,glareBorderRadius:t}=this.props;e&&(this.glare=new ZI(this.wrapperEl.size,t),this.wrapperEl.node.appendChild(this.glare.glareWrapperEl))}emitOnMove(e){const{onMove:t}=this.props;if(!t)return;let n=0,i=0;this.glare&&(n=this.glare.glareAngle,i=this.glare.glareOpacity),t({tiltAngleX:this.tilt.tiltAngleX,tiltAngleY:this.tilt.tiltAngleY,tiltAngleXPercentage:this.tilt.tiltAngleXPercentage,tiltAngleYPercentage:this.tilt.tiltAngleYPercentage,glareAngle:n,glareOpacity:i,event:e})}resetWrapperElTransform(){this.wrapperEl.node.style.transform=""}renderPerspective(){const{perspective:e}=this.props;this.wrapperEl.node.style.transform+=`perspective(${e}px) `}renderScale(){const{scale:e}=this.wrapperEl;this.wrapperEl.node.style.transform+=`scale3d(${e},${e},${e})`}setTransitions(){const{transitionSpeed:e,transitionEasing:t}=this.props;K2(this.wrapperEl.node,"all",e,t),this.glare&&K2(this.glare.glareEl,"opacity",e,t)}render(){const{children:e,className:t,style:n}=this.props;return Q.jsx("div",{ref:i=>{this.wrapperEl.node=i},onMouseEnter:this.onEnter,onMouseMove:this.onMove,onMouseLeave:this.onLeave,onTouchStart:this.onEnter,onTouchMove:this.onMove,onTouchEnd:this.onLeave,className:t,style:n,children:e})}};fC.defaultProps=eD;const tD="/assets/pp_with_linus-Cg9n1q8T.jpg",nD=r=>{switch(r.toLowerCase()){case"github":return"socicon-github";case"twitter":return"socicon-twitter";case"instagram":return"socicon-instagram";case"linkedin":return"socicon-linkedin";case"medium":return"socicon-medium";case"whatsapp":return"socicon-whatsapp";default:return"-"}},rD=({data:r})=>{const{network:e,url:t}=r;return Q.jsx("div",{className:"ico",children:Q.jsx("a",{className:"no-underline",href:t,children:Q.jsx("span",{className:nD(e),title:e})})})},J2=({data:r})=>Q.jsx(zi.Fragment,{children:r.map((e,t)=>Q.jsx(rD,{data:e},t))}),iD=({data:r})=>{const{summary:e,profiles:t,email:n,phone:i}=r;return Q.jsx(zi.Fragment,{children:Q.jsxs("section",{className:"row about",id:"about",children:[Q.jsx("div",{className:"col-md-12 title",children:Q.jsxs("h2",{children:[Q.jsx(jI,{})," / About me"]})}),Q.jsx("div",{className:"col-md-12",children:Q.jsx("div",{className:"content",children:Q.jsxs("div",{className:"about-holder",children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsx("br",{}),e.map((o,a)=>o===""?Q.jsx("br",{},a):Q.jsxs("p",{children:[" ",o," "]},a))]}),Q.jsxs("div",{className:"inner-content profile",children:[Q.jsxs("div",{className:"dl-btn",children:[Q.jsx(J2,{data:t.cv}),Q.jsx("p",{children:"See / Download My CV"})]}),Q.jsx("div",{className:"img-profile",children:Q.jsx(fC,{tiltMaxAngleX:25,tiltMaxAngleY:25,scale:1.1,children:Q.jsx(dC,{children:Q.jsx(sC,{src:tD,roundedCircle:!0,className:"profile-pic"})})})}),Q.jsxs("div",{className:"fol-btn",children:[Q.jsx(J2,{data:t.social}),Q.jsx("p",{children:"Follow Me On"})]})]}),Q.jsx("div",{className:"info",children:Q.jsxs("ul",{children:[Q.jsxs("li",{children:[Q.jsx("div",{className:"ico",children:Q.jsx("a",{href:`mailto:${n}`,children:Q.jsx(hC,{})})}),Q.jsx("p",{children:Q.jsx("a",{href:`mailto:${n}`,children:n})})]}),Q.jsxs("li",{children:[Q.jsx("div",{className:"ico",children:Q.jsx("a",{href:`tel:${i}`,children:Q.jsx(VI,{})})}),Q.jsx("p",{children:Q.jsx("a",{href:`tel:${i}`,children:i})})]}),Q.jsxs("li",{children:[Q.jsx("div",{className:"ico",children:Q.jsx("a",{href:`https://wa.me/${i}`,children:Q.jsx(UI,{})})}),Q.jsx("p",{children:Q.jsx("a",{href:`https://wa.me/${i}`,children:"WhatsApp"})})]})]})})]})})})]})})},oD=({quote:r})=>{const{quote:e,author:t}=r;return Q.jsx("footer",{className:"footer",children:Q.jsxs("div",{className:"quotes",children:[Q.jsx("div",{className:"quote-body",children:Q.jsxs("blockquote",{children:[" ",e," "]})}),Q.jsxs("div",{className:"quote-by",children:[" - ",t," "]})]})})};function pC(){var r=this.constructor.getDerivedStateFromProps(this.props,this.state);r!=null&&this.setState(r)}function mC(r){function e(t){var n=this.constructor.getDerivedStateFromProps(r,t);return n??null}this.setState(e.bind(this))}function gC(r,e){try{var t=this.props,n=this.state;this.props=r,this.state=e,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(t,n)}finally{this.props=t,this.state=n}}pC.__suppressDeprecationWarning=!0;mC.__suppressDeprecationWarning=!0;gC.__suppressDeprecationWarning=!0;function aD(r){var e=r.prototype;if(!e||!e.isReactComponent)throw new Error("Can only polyfill class components");if(typeof r.getDerivedStateFromProps!="function"&&typeof e.getSnapshotBeforeUpdate!="function")return r;var t=null,n=null,i=null;if(typeof e.componentWillMount=="function"?t="componentWillMount":typeof e.UNSAFE_componentWillMount=="function"&&(t="UNSAFE_componentWillMount"),typeof e.componentWillReceiveProps=="function"?n="componentWillReceiveProps":typeof e.UNSAFE_componentWillReceiveProps=="function"&&(n="UNSAFE_componentWillReceiveProps"),typeof e.componentWillUpdate=="function"?i="componentWillUpdate":typeof e.UNSAFE_componentWillUpdate=="function"&&(i="UNSAFE_componentWillUpdate"),t!==null||n!==null||i!==null){var o=r.displayName||r.name,a=typeof r.getDerivedStateFromProps=="function"?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error(`Unsafe legacy lifecycles will not be called for components using new component APIs.

`+o+" uses "+a+" but also contains the following legacy lifecycles:"+(t!==null?`
  `+t:"")+(n!==null?`
  `+n:"")+(i!==null?`
  `+i:"")+`

The above lifecycles should be removed. Learn more about this warning here:
https://fb.me/react-async-component-lifecycle-hooks`)}if(typeof r.getDerivedStateFromProps=="function"&&(e.componentWillMount=pC,e.componentWillReceiveProps=mC),typeof e.getSnapshotBeforeUpdate=="function"){if(typeof e.componentDidUpdate!="function")throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");e.componentWillUpdate=gC;var s=e.componentDidUpdate;e.componentDidUpdate=function(l,c,h){var f=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:h;s.call(this,l,c,f)}}return r}const sD=Object.freeze(Object.defineProperty({__proto__:null,polyfill:aD},Symbol.toStringTag,{value:"Module"})),uD=["as","disabled"];function lD(r,e){if(r==null)return{};var t={};for(var n in r)if({}.hasOwnProperty.call(r,n)){if(e.indexOf(n)>=0)continue;t[n]=r[n]}return t}function cD(r){return!r||r.trim()==="#"}function vC({tagName:r,disabled:e,href:t,target:n,rel:i,role:o,onClick:a,tabIndex:s=0,type:u}){r||(t!=null||n!=null||i!=null?r="a":r="button");const l={tagName:r};if(r==="button")return[{type:u||"button",disabled:e},l];const c=f=>{if((e||r==="a"&&cD(t))&&f.preventDefault(),e){f.stopPropagation();return}a?.(f)},h=f=>{f.key===" "&&(f.preventDefault(),c(f))};return r==="a"&&(t||(t="#"),e&&(t=void 0)),[{role:o??"button",disabled:void 0,tabIndex:e?void 0:s,href:t,target:r==="a"?n:void 0,"aria-disabled":e||void 0,rel:r==="a"?i:void 0,onClick:c,onKeyDown:h},l]}const hD=Ke.forwardRef((r,e)=>{let{as:t,disabled:n}=r,i=lD(r,uD);const[o,{tagName:a}]=vC(Object.assign({tagName:t,disabled:n},i));return Q.jsx(a,Object.assign({},i,o,{ref:e}))});hD.displayName="Button";const yC=Ke.forwardRef(({as:r,bsPrefix:e,variant:t="primary",size:n,active:i=!1,disabled:o=!1,className:a,...s},u)=>{const l=_i(e,"btn"),[c,{tagName:h}]=vC({tagName:r,disabled:o,...s}),f=h;return Q.jsx(f,{...c,...s,ref:u,disabled:o,className:Yr(a,l,i&&"active",t&&`${l}-${t}`,n&&`${l}-${n}`,s.href&&o&&"disabled")})});yC.displayName="Button";function dD(r,e){return Ke.Children.toArray(r).some(t=>Ke.isValidElement(t)&&t.type===e)}function fD({as:r,bsPrefix:e,className:t,...n}){e=_i(e,"col");const i=AI(),o=RI(),a=[],s=[];return i.forEach(u=>{const l=n[u];delete n[u];let c,h,f;typeof l=="object"&&l!=null?{span:c,offset:h,order:f}=l:c=l;const m=u!==o?`-${u}`:"";c&&a.push(c===!0?`${e}${m}`:`${e}${m}-${c}`),f!=null&&s.push(`order${m}-${f}`),h!=null&&s.push(`offset${m}-${h}`)}),[{...n,className:Yr(t,...a,...s)},{as:r,bsPrefix:e,spans:a}]}const bC=Ke.forwardRef((r,e)=>{const[{className:t,...n},{as:i="div",bsPrefix:o,spans:a}]=fD(r);return Q.jsx(i,{...n,ref:e,className:Yr(t,!a.length&&o)})});bC.displayName="Col";var fy,Z2;function wC(){if(Z2)return fy;Z2=1;var r=function(){};return fy=r,fy}wC();const pD={type:Ao.string,tooltip:Ao.bool,as:Ao.elementType},Zm=Ke.forwardRef(({as:r="div",className:e,type:t="valid",tooltip:n=!1,...i},o)=>Q.jsx(r,{...i,ref:o,className:Yr(e,`${t}-${n?"tooltip":"feedback"}`)}));Zm.displayName="Feedback";Zm.propTypes=pD;const Xa=Ke.createContext({}),mw=Ke.forwardRef(({id:r,bsPrefix:e,className:t,type:n="checkbox",isValid:i=!1,isInvalid:o=!1,as:a="input",...s},u)=>{const{controlId:l}=Ke.useContext(Xa);return e=_i(e,"form-check-input"),Q.jsx(a,{...s,ref:u,type:n,id:r||l,className:Yr(t,e,i&&"is-valid",o&&"is-invalid")})});mw.displayName="FormCheckInput";const am=Ke.forwardRef(({bsPrefix:r,className:e,htmlFor:t,...n},i)=>{const{controlId:o}=Ke.useContext(Xa);return r=_i(r,"form-check-label"),Q.jsx("label",{...n,ref:i,htmlFor:t||o,className:Yr(e,r)})});am.displayName="FormCheckLabel";const _C=Ke.forwardRef(({id:r,bsPrefix:e,bsSwitchPrefix:t,inline:n=!1,reverse:i=!1,disabled:o=!1,isValid:a=!1,isInvalid:s=!1,feedbackTooltip:u=!1,feedback:l,feedbackType:c,className:h,style:f,title:m="",type:g="checkbox",label:w,children:v,as:y="input",...x},E)=>{e=_i(e,"form-check"),t=_i(t,"form-switch");const{controlId:_}=Ke.useContext(Xa),k=Ke.useMemo(()=>({controlId:r||_}),[_,r]),C=!v&&w!=null&&w!==!1||dD(v,am),R=Q.jsx(mw,{...x,type:g==="switch"?"checkbox":g,ref:E,isValid:a,isInvalid:s,disabled:o,as:y});return Q.jsx(Xa.Provider,{value:k,children:Q.jsx("div",{style:f,className:Yr(h,C&&e,n&&`${e}-inline`,i&&`${e}-reverse`,g==="switch"&&t),children:v||Q.jsxs(Q.Fragment,{children:[R,C&&Q.jsx(am,{title:m,children:w}),l&&Q.jsx(Zm,{type:c,tooltip:u,children:l})]})})})});_C.displayName="FormCheck";const sm=Object.assign(_C,{Input:mw,Label:am}),xC=Ke.forwardRef(({bsPrefix:r,type:e,size:t,htmlSize:n,id:i,className:o,isValid:a=!1,isInvalid:s=!1,plaintext:u,readOnly:l,as:c="input",...h},f)=>{const{controlId:m}=Ke.useContext(Xa);return r=_i(r,"form-control"),Q.jsx(c,{...h,type:e,size:n,ref:f,readOnly:l,id:i||m,className:Yr(o,u?`${r}-plaintext`:r,t&&`${r}-${t}`,e==="color"&&`${r}-color`,a&&"is-valid",s&&"is-invalid")})});xC.displayName="FormControl";const mD=Object.assign(xC,{Feedback:Zm}),SC=Ke.forwardRef(({className:r,bsPrefix:e,as:t="div",...n},i)=>(e=_i(e,"form-floating"),Q.jsx(t,{ref:i,className:Yr(r,e),...n})));SC.displayName="FormFloating";const gw=Ke.forwardRef(({controlId:r,as:e="div",...t},n)=>{const i=Ke.useMemo(()=>({controlId:r}),[r]);return Q.jsx(Xa.Provider,{value:i,children:Q.jsx(e,{...t,ref:n})})});gw.displayName="FormGroup";const EC=Ke.forwardRef(({as:r="label",bsPrefix:e,column:t=!1,visuallyHidden:n=!1,className:i,htmlFor:o,...a},s)=>{const{controlId:u}=Ke.useContext(Xa);e=_i(e,"form-label");let l="col-form-label";typeof t=="string"&&(l=`${l} ${l}-${t}`);const c=Yr(i,e,n&&"visually-hidden",t&&l);return o=o||u,t?Q.jsx(bC,{ref:s,as:"label",className:c,htmlFor:o,...a}):Q.jsx(r,{ref:s,className:c,htmlFor:o,...a})});EC.displayName="FormLabel";const kC=Ke.forwardRef(({bsPrefix:r,className:e,id:t,...n},i)=>{const{controlId:o}=Ke.useContext(Xa);return r=_i(r,"form-range"),Q.jsx("input",{...n,type:"range",ref:i,className:Yr(e,r),id:t||o})});kC.displayName="FormRange";const CC=Ke.forwardRef(({bsPrefix:r,size:e,htmlSize:t,className:n,isValid:i=!1,isInvalid:o=!1,id:a,...s},u)=>{const{controlId:l}=Ke.useContext(Xa);return r=_i(r,"form-select"),Q.jsx("select",{...s,size:t,ref:u,className:Yr(n,r,e&&`${r}-${e}`,i&&"is-valid",o&&"is-invalid"),id:a||l})});CC.displayName="FormSelect";const TC=Ke.forwardRef(({bsPrefix:r,className:e,as:t="small",muted:n,...i},o)=>(r=_i(r,"form-text"),Q.jsx(t,{...i,ref:o,className:Yr(e,r,n&&"text-muted")})));TC.displayName="FormText";const MC=Ke.forwardRef((r,e)=>Q.jsx(sm,{...r,ref:e,type:"switch"}));MC.displayName="Switch";const gD=Object.assign(MC,{Input:sm.Input,Label:sm.Label}),AC=Ke.forwardRef(({bsPrefix:r,className:e,children:t,controlId:n,label:i,...o},a)=>(r=_i(r,"form-floating"),Q.jsxs(gw,{ref:a,className:Yr(e,r),controlId:n,...o,children:[t,Q.jsx("label",{htmlFor:n,children:i})]})));AC.displayName="FloatingLabel";const vD={_ref:Ao.any,validated:Ao.bool,as:Ao.elementType},vw=Ke.forwardRef(({className:r,validated:e,as:t="form",...n},i)=>Q.jsx(t,{...n,ref:i,className:Yr(r,e&&"was-validated")}));vw.displayName="Form";vw.propTypes=vD;const xo=Object.assign(vw,{Group:gw,Control:mD,Floating:SC,Check:sm,Switch:gD,Label:EC,Text:TC,Range:kC,Select:CC,FloatingLabel:AC});var Xf={exports:{}},Yf={exports:{}},Q2;function dd(){return Q2||(Q2=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(n){if(n==null)throw new TypeError("Expected a string but received a ".concat(n));if(n.constructor.name!=="String")throw new TypeError("Expected a string but received a ".concat(n.constructor.name))}r.exports=e.default,r.exports.default=e.default})(Yf,Yf.exports)),Yf.exports}var Kf={exports:{}},eS;function yD(){return eS||(eS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;function t(i){return Object.prototype.toString.call(i)==="[object RegExp]"}function n(i,o){for(var a=0;a<o.length;a++){var s=o[a];if(i===s||t(s)&&s.test(i))return!0}return!1}r.exports=e.default,r.exports.default=e.default})(Kf,Kf.exports)),Kf.exports}var Jf={exports:{}},tS;function bD(){return tS||(tS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var t=n(dd());function n(a){return a&&a.__esModule?a:{default:a}}function i(a){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},i(a)}function o(a,s){(0,t.default)(a);var u,l;i(s)==="object"?(u=s.min||0,l=s.max):(u=arguments[1],l=arguments[2]);var c=encodeURI(a).split(/%..|./).length-1;return c>=u&&(typeof l>"u"||c<=l)}r.exports=e.default,r.exports.default=e.default})(Jf,Jf.exports)),Jf.exports}var Zf={exports:{}},Qf={exports:{}},nS;function yw(){return nS||(nS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t;function t(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1?arguments[1]:void 0;for(var o in i)typeof n[o]>"u"&&(n[o]=i[o]);return n}r.exports=e.default,r.exports.default=e.default})(Qf,Qf.exports)),Qf.exports}var rS;function wD(){return rS||(rS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=i(dd()),n=i(yw());function i(s){return s&&s.__esModule?s:{default:s}}var o={require_tld:!0,allow_underscores:!1,allow_trailing_dot:!1,allow_numeric_tld:!1,allow_wildcard:!1,ignore_max_length:!1};function a(s,u){(0,t.default)(s),u=(0,n.default)(u,o),u.allow_trailing_dot&&s[s.length-1]==="."&&(s=s.substring(0,s.length-1)),u.allow_wildcard===!0&&s.indexOf("*.")===0&&(s=s.substring(2));var l=s.split("."),c=l[l.length-1];return u.require_tld&&(l.length<2||!u.allow_numeric_tld&&!/^([a-z\u00A1-\u00A8\u00AA-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}|xn[a-z0-9-]{2,})$/i.test(c)||/\s/.test(c))||!u.allow_numeric_tld&&/^\d+$/.test(c)?!1:l.every(function(h){return!(h.length>63&&!u.ignore_max_length||!/^[a-z_\u00a1-\uffff0-9-]+$/i.test(h)||/[\uff01-\uff5e]/.test(h)||/^-|-$/.test(h)||!u.allow_underscores&&/_/.test(h))})}r.exports=e.default,r.exports.default=e.default})(Zf,Zf.exports)),Zf.exports}var ep={exports:{}},iS;function _D(){return iS||(iS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t=n(dd());function n(h){return h&&h.__esModule?h:{default:h}}function i(h){"@babel/helpers - typeof";return i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(f){return typeof f}:function(f){return f&&typeof Symbol=="function"&&f.constructor===Symbol&&f!==Symbol.prototype?"symbol":typeof f},i(h)}var o="(?:[0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])",a="(".concat(o,"[.]){3}").concat(o),s=new RegExp("^".concat(a,"$")),u="(?:[0-9a-fA-F]{1,4})",l=new RegExp("^("+"(?:".concat(u,":){7}(?:").concat(u,"|:)|")+"(?:".concat(u,":){6}(?:").concat(a,"|:").concat(u,"|:)|")+"(?:".concat(u,":){5}(?::").concat(a,"|(:").concat(u,"){1,2}|:)|")+"(?:".concat(u,":){4}(?:(:").concat(u,"){0,1}:").concat(a,"|(:").concat(u,"){1,3}|:)|")+"(?:".concat(u,":){3}(?:(:").concat(u,"){0,2}:").concat(a,"|(:").concat(u,"){1,4}|:)|")+"(?:".concat(u,":){2}(?:(:").concat(u,"){0,3}:").concat(a,"|(:").concat(u,"){1,5}|:)|")+"(?:".concat(u,":){1}(?:(:").concat(u,"){0,4}:").concat(a,"|(:").concat(u,"){1,6}|:)|")+"(?::((?::".concat(u,"){0,5}:").concat(a,"|(?::").concat(u,"){1,7}|:))")+")(%[0-9a-zA-Z.]{1,})?$");function c(h){var f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,t.default)(h);var m=(i(f)==="object"?f.version:arguments[1])||"";return m?m.toString()==="4"?s.test(h):m.toString()==="6"?l.test(h):!1:c(h,{version:4})||c(h,{version:6})}r.exports=e.default,r.exports.default=e.default})(ep,ep.exports)),ep.exports}var oS;function xD(){return oS||(oS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=x;var t=u(dd()),n=u(yD()),i=u(bD()),o=u(wD()),a=u(_D()),s=u(yw());function u(E){return E&&E.__esModule?E:{default:E}}var l={allow_display_name:!1,allow_underscores:!1,require_display_name:!1,allow_utf8_local_part:!0,require_tld:!0,blacklisted_chars:"",ignore_max_length:!1,host_blacklist:[],host_whitelist:[]},c=/^([^\x00-\x1F\x7F-\x9F\cX]+)</i,h=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~]+$/i,f=/^[a-z\d]+$/,m=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f]))*$/i,g=/^[a-z\d!#\$%&'\*\+\-\/=\?\^_`{\|}~\u00A1-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/i,w=/^([\s\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|(\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*$/i,v=254;function y(E){var _=E.replace(/^"(.+)"$/,"$1");if(!_.trim())return!1;var k=/[\.";<>]/.test(_);if(k){if(_===E)return!1;var C=_.split('"').length===_.split('\\"').length;if(!C)return!1}return!0}function x(E,_){if((0,t.default)(E),_=(0,s.default)(_,l),_.require_display_name||_.allow_display_name){var k=E.match(c);if(k){var C=k[1];if(E=E.replace(C,"").replace(/(^<|>$)/g,""),C.endsWith(" ")&&(C=C.slice(0,-1)),!y(C))return!1}else if(_.require_display_name)return!1}if(!_.ignore_max_length&&E.length>v)return!1;var R=E.split("@"),I=R.pop(),T=I.toLowerCase();if(_.host_blacklist.length>0&&(0,n.default)(T,_.host_blacklist)||_.host_whitelist.length>0&&!(0,n.default)(T,_.host_whitelist))return!1;var A=R.join("@");if(_.domain_specific_validation&&(T==="gmail.com"||T==="googlemail.com")){A=A.toLowerCase();var N=A.split("+")[0];if(!(0,i.default)(N.replace(/\./g,""),{min:6,max:30}))return!1;for(var O=N.split("."),V=0;V<O.length;V++)if(!f.test(O[V]))return!1}if(_.ignore_max_length===!1&&(!(0,i.default)(A,{max:64})||!(0,i.default)(I,{max:254})))return!1;if(!(0,o.default)(I,{require_tld:_.require_tld,ignore_max_length:_.ignore_max_length,allow_underscores:_.allow_underscores})){if(!_.allow_ip_domain)return!1;if(!(0,a.default)(I)){if(!I.startsWith("[")||!I.endsWith("]"))return!1;var F=I.slice(1,-1);if(F.length===0||!(0,a.default)(F))return!1}}if(_.blacklisted_chars&&A.search(new RegExp("[".concat(_.blacklisted_chars,"]+"),"g"))!==-1)return!1;if(A[0]==='"'&&A[A.length-1]==='"')return A=A.slice(1,A.length-1),_.allow_utf8_local_part?w.test(A):m.test(A);for(var B=_.allow_utf8_local_part?g:h,U=A.split("."),P=0;P<U.length;P++)if(!B.test(U[P]))return!1;return!0}r.exports=e.default,r.exports.default=e.default})(Xf,Xf.exports)),Xf.exports}var SD=xD();const aS=iu(SD);var tp={exports:{}},sS;function ED(){return sS||(sS=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=i(dd()),n=i(yw());function i(s){return s&&s.__esModule?s:{default:s}}var o={ignore_whitespace:!1};function a(s,u){return(0,t.default)(s),u=(0,n.default)(u,o),(u.ignore_whitespace?s.trim().length:s.length)===0}r.exports=e.default,r.exports.default=e.default})(tp,tp.exports)),tp.exports}var kD=ED();const np=iu(kD),CD=({email:r})=>{const[e,t]=Ke.useState({name:"",email:"",message:""}),[n,i]=Ke.useState({name:null,email:null,message:null}),[o,a]=Ke.useState(!1),s=c=>{const{name:h,value:f}=c.target;t(g=>({...g,[h]:f}));let m=null;switch(h){case"name":m=np(f)?"error":"success",i(g=>({...g,name:m}));break;case"email":m=aS(f)?"success":"error",i(g=>({...g,email:m}));break;case"message":m=np(f)?"error":"success",i(g=>({...g,message:m}));break}},u=()=>{const{name:c,email:h,message:f}=n;return c==="success"&&h==="success"&&f==="success"},l=()=>{if(u()){const{name:c,email:h,message:f}=e,m={from:h,to:r,subject:`Msg from: ${c}`,text:`Name: ${c}

Email: ${h}

Message: ${f}`};a(!0),fetch("https://dqf5ayzbgf.execute-api.eu-west-1.amazonaws.com/mabhishek/",{method:"POST",body:JSON.stringify(m),headers:{Accept:"application/json","Content-Type":"application/json"}}).then(g=>{if(g.status===200)g.json().then(w=>{a(!1),t({name:"",email:"",message:""}),i({name:null,email:null,message:null}),window.alert("Message Sent!"),console.log(w)});else throw console.log(g),new Error("Email send failed.")}).catch(()=>{window.alert("Failed to send message. Please try sending me an email instead."),a(!1)})}else{const{name:c,email:h,message:f}=e;i({name:np(c)?"error":"success",email:aS(h)?"success":"error",message:np(f)?"error":"success"})}};return Q.jsx(zi.Fragment,{children:Q.jsxs("section",{className:"row contact",id:"contact",children:[Q.jsx("div",{className:"col-md-12 title",children:Q.jsxs("h2",{children:[Q.jsx(hC,{})," / Contact"]})}),Q.jsx("div",{className:"col-md-12",children:Q.jsxs("div",{className:"content",children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsx("h3",{children:"get in touch with me"}),Q.jsx("p",{children:"Let me now if you're interested in working with me."})]}),Q.jsx("div",{className:"inner-content ",children:Q.jsx("div",{className:"address",children:Q.jsxs(xo,{children:[Q.jsxs(xo.Group,{controlId:"formHorizontalname",children:[Q.jsx(xo.Label,{children:"Name"}),Q.jsx(xo.Control,{type:"text",placeholder:"Your Name",name:"name",value:e.name,onChange:s,isValid:n.name==="success",isInvalid:n.name==="error"})]}),Q.jsxs(xo.Group,{controlId:"formHorizontalEmail",children:[Q.jsx(xo.Label,{children:"Email"}),Q.jsx(xo.Control,{type:"email",placeholder:"Email",name:"email",value:e.email,onChange:s,isValid:n.email==="success",isInvalid:n.email==="error"})]}),Q.jsxs(xo.Group,{controlId:"formHorizontalMessage",children:[Q.jsx(xo.Label,{children:"Message"}),Q.jsx(xo.Control,{as:"textarea",rows:4,placeholder:"Message",name:"message",value:e.message,onChange:s,isValid:n.message==="success",isInvalid:n.message==="error"})]}),Q.jsx(xo.Group,{className:"mt-3",children:Q.jsx(yC,{className:"btnSend",disabled:o,onClick:o?void 0:l,children:o?"Sending email....":"Send"})})]})})})]})})]})})};var W0=function(r,e){return W0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},W0(r,e)};function Yt(r,e){W0(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var Fo=function(){return Fo=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++){t=arguments[n];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},Fo.apply(this,arguments)};function It(r,e,t,n){function i(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function s(c){try{l(n.next(c))}catch(h){a(h)}}function u(c){try{l(n.throw(c))}catch(h){a(h)}}function l(c){c.done?o(c.value):i(c.value).then(s,u)}l((n=n.apply(r,[])).next())})}function Dt(r,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},n,i,o,a;return a={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function s(l){return function(c){return u([l,c])}}function u(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(o=l[0]&2?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(c){l=[6,c],i=0}finally{n=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function py(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),i=0,e=0;e<t;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)n[i]=o[a];return n}var RC=function(r,e){return(RC=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function Ja(r,e){function t(){this.constructor=r}RC(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function Gt(r,e,t,n){return new(t||(t=Promise))(function(i,o){function a(l){try{u(n.next(l))}catch(c){o(c)}}function s(l){try{u(n.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t(function(c){c(l.value)}).then(a,s)}u((n=n.apply(r,[])).next())})}function Vt(r,e){var t,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return(function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(r,a)}catch(h){c=[6,h],n=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([u,l])}}}var TD=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t=MD(this.global.location.search);"tfjsflags"in t&&t.tfjsflags.split(",").forEach(function(n){var i=n.split(":"),o=i[0],a=i[1];e.urlFlags[o]=(function(s,u){if((u=u.toLowerCase())==="true"||u==="false")return u==="true";if(""+ +u===u)return+u;throw new Error("Could not parse value flag value "+u+" for flag "+s+".")})(o,a)})}},r})();function MD(r){var e={};return r.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(function(o,a,s){o[decodeURIComponent(a)]=decodeURIComponent(s||"")})(e,n[0],n[1]),n.join("=")}),e}var be=null;function AD(r){be=r}function H0(r,e,t){return Math.max(r,Math.min(e,t))}function IC(r){return r%2==0?r:r+1}function RD(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function te(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function An(r,e,t){t===void 0&&(t=""),te(Gr(r,e),function(){return t+" Shapes "+r+" and "+e+" must match"})}function Xc(r){te(r!=null,function(){return"The input to the tensor constructor must be a non-null value."})}function Nc(r,e){if(e===void 0&&(e=[]),e==null&&(e=[]),Array.isArray(r)||ja(r))for(var t=0;t<r.length;++t)Nc(r[t],e);else e.push(r);return e}function Pt(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function Gr(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function ao(r){return r%1==0}function ID(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function G0(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function vc(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function uS(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise(function(n,i){var o=0,a=function(){if(r())n();else{var s=e(++o);t!=null&&o>=t?i():setTimeout(a,s)}};a()})}function DD(r,e){for(var t=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)t*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=r.slice();return o[n]=e/t,o}function Mr(r,e){var t=e.length;return te((r=r==null?e.map(function(n,i){return i}):[].concat(r)).every(function(n){return n>=-t&&n<t}),function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r}),te(r.every(function(n){return ao(n)}),function(){return"All values in axis param must be integers but got axis "+r}),r.map(function(n){return n<0?t+n:n})}function Wu(r,e){for(var t=[],n=[],i=e==null?null:Mr(e,r).sort(),o=0,a=0;a<r.length;++a){if(i!=null){if(i[o]===a&&r[a]!==1)throw new Error("Can't squeeze axis "+a+" since its dim '"+r[a]+"' is not 1");(i[o]==null||i[o]>a)&&r[a]===1&&(t.push(r[a]),n.push(a)),i[o]<=a&&o++}r[a]!==1&&(t.push(r[a]),n.push(a))}return{newShape:t,keptDims:n}}function V0(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function um(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function ND(r,e,t){if(e==="float32")for(var n=0;n<r.length;n++){var i=r[n];if(isNaN(i)||!isFinite(i))throw Error("The result of the '"+t+"' is "+i+".")}}function PD(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function FD(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function OD(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function ja(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function DC(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function LD(r){if(r==null)return 0;var e=0;return r.forEach(function(t){return e+=2*t.length}),e}function NC(r){return typeof r=="string"||r instanceof String}function BD(r){return typeof r=="boolean"}function UD(r){return typeof r=="number"}function fd(r){return Array.isArray(r)?fd(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":UD(r)?"float32":NC(r)?"string":BD(r)?"bool":"float32"}function j0(r){return!!(r&&r.constructor&&r.call&&r.apply)}function q0(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function ol(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function PC(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Nc(r)),t&&PD(r,e),(function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"})(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+e)}function lS(r,e){if(r.length===0)return e[0];var t=r.reduce(function(n,i){return n*i});if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return(function n(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce(function(f,m){return f*m});for(l=0;l<u;l++)s[l]=n(i+l*h,c,a)}return s})(0,r,e)}function FC(r,e){for(var t=pd(r,e),n=0;n<t.length;n++)t[n]=1;return t}function pd(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function lm(){if(typeof performance<"u")return performance.now();if(typeof process<"u"){var r=process.hrtime();return 1e3*r[0]+r[1]/1e6}throw new Error("Cannot measure time in this environment. You should run tf.js in the browser or in Node.js")}function OC(r){r.forEach(function(e){te(Number.isInteger(e)&&e>=0,function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."})})}function LC(r,e){return be.platform.fetch(r,e)}var zD=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new WD)}return r.prototype.profileKernel=function(e,t){var n,i=this,o=this.backendTimer.time(function(){n=t()});return(Array.isArray(n)?n:[n]).forEach(function(a){var s=a.dataSync();ND(s,a.dtype,e),o.then(function(u){var l="";u.getExtraProfileInfo!=null&&(l=u.getExtraProfileInfo()),i.logger.logKernelProfile(e,a,s,u.kernelMs,l)})}),n},r})(),WD=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,i,o){var a=vc(i+"ms",9),s=vc(e,25),u=t.rank,l=t.size,c=vc(t.shape.toString(),14);console.log("%c"+s+"	%c"+a+"	%c"+u+"D "+c+"	%c"+l+"	%c"+o,"font-weight:bold","color:red","color:blue","color: orange","color: green")},r})(),cS=20,Ph=3,my=7;function HD(r,e,t,n){var i=ol(e),o=(function(l,c,h,f){var m=Pt(c),g=f[f.length-1],w=new Array(g).fill(0),v=c.length,y=h==="complex64"?Oh(l):l;if(v>1)for(var x=0;x<m/g;x++)for(var E=x*g,_=0;_<g;_++)w[_]=Math.max(w[_],Fh(y[E+_],0,h).length);return w})(r,e,t,i),a=e.length,s=(function l(c,h,f,m,g,w){w===void 0&&(w=!0);var v=f==="complex64"?2:1,y=h[0],x=h.length;if(x===0){if(f==="complex64"){var E=Oh(c);return[Fh(E[0],0,f)]}return f==="bool"?[BC(c[0])]:[c[0].toString()]}if(x===1){if(y>cS){var _=Ph*v,k=Array.from(c.slice(0,_)),C=Array.from(c.slice(y-Ph*v,y));return f==="complex64"&&(k=Oh(k),C=Oh(C)),["["+k.map(function(P,L){return Fh(P,g[L],f)}).join(", ")+", ..., "+C.map(function(P,L){return Fh(P,g[y-Ph+L],f)}).join(", ")+"]"]}var R=f==="complex64"?Oh(c):Array.from(c);return["["+R.map(function(P,L){return Fh(P,g[L],f)}).join(", ")+"]"]}var I=h.slice(1),T=m.slice(1),A=m[0]*v,N=[];if(y>cS){for(var O=0;O<Ph;O++){var V=O*A,F=V+A;N.push.apply(N,l(c.slice(V,F),I,f,T,g,!1))}N.push("...");for(var O=y-Ph;O<y;O++){var V=O*A,F=V+A;N.push.apply(N,l(c.slice(V,F),I,f,T,g,O===y-1))}}else for(var O=0;O<y;O++){var V=O*A,F=V+A;N.push.apply(N,l(c.slice(V,F),I,f,T,g,O===y-1))}var B=x===2?",":"";N[0]="["+N[0]+B;for(var O=1;O<N.length-1;O++)N[O]=" "+N[O]+B;for(var U=`,
`,O=2;O<x;O++)U+=`
`;return N[N.length-1]=" "+N[N.length-1]+"]"+(w?"":U),N})(r,e,t,i,o),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map(function(l){return"    "+l}).join(`
`)),u.join(`
`)}function Fh(r,e,t){return vc(Array.isArray(r)?parseFloat(r[0].toFixed(my))+" + "+parseFloat(r[1].toFixed(my))+"j":NC(r)?"'"+r+"'":t==="bool"?BC(r):parseFloat(r.toFixed(my)).toString(),e)}function BC(r){return r===0?"false":"true"}function Oh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var Zh=(function(){function r(e,t,n){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=Pt(e),n!=null){var o=n.length;te(o===this.size,function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."})}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||um(t,this.size),this.strides=ol(e)}return r.prototype.set=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),te(n.length===this.rank,function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"});var o=this.locToIndex(n);this.values[o]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[n]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return at.make(this.shape,{values:this.values},this.dtype)},r})(),Ni=null,Me=null,UC=null,at=(function(){function r(e,t,n,i,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=Pt(e),this.strides=ol(e),this.dataId=i??{},this.id=Ni().nextTensorId(),this.rankType=this.rank<5?this.rank.toString():"higher",Ni().registerTensor(this,o),n!=null&&Ni().write(o,this.dataId,n)}return r.make=function(e,t,n,i){return new r(e,n,t.values,t.dataId,i)},r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),te(this.size===1,function(){return"The array must have only 1 element."}),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),this.reshape([e,t,n,i])},r.prototype.as5D=function(e,t,n,i,o){return this.throwIfDisposed(),this.reshape([e,t,n,i,o])},r.prototype.asType=function(e){return this.throwIfDisposed(),Me.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return Gt(this,void 0,void 0,function(){var e;return Vt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Me.buffer(this.shape,this.dtype,e)]}})})},r.prototype.bufferSync=function(){return Me.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return Gt(this,void 0,void 0,function(){var e;return Vt(this,function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,lS(this.shape,e)]}})})},r.prototype.arraySync=function(){return lS(this.shape,this.dataSync())},r.prototype.data=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(e){return this.throwIfDisposed(),[2,Ni().read(this.dataId)]})})},r.prototype.dataSync=function(){return this.throwIfDisposed(),Ni().readSync(this.dataId)},r.prototype.dispose=function(){this.isDisposed||(Ni().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),Me.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),Me.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),Me.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),Me.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),Me.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Me.clone(this)},r.prototype.oneHot=function(e,t,n){return this.throwIfDisposed(),Me.oneHot(this,e,t,n)},r.prototype.toString=function(e){return e===void 0&&(e=!1),HD(this.dataSync(),this.shape,this.dtype,e)},r.prototype.tile=function(e){return this.throwIfDisposed(),Me.tile(this,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Me.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),Me.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),Me.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Me.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),Me.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),Me.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),Me.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Me.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),Me.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),Me.unstack(this,e)},r.prototype.pad=function(e,t){return t===void 0&&(t=0),Me.pad(this,e,t)},r.prototype.batchNormalization=function(e,t,n,i,o){return n===void 0&&(n=.001),UC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,n)},r.prototype.batchNorm=function(e,t,n,i,o){return o===void 0&&(o=.001),this.throwIfDisposed(),Me.batchNorm(this,e,t,n,i,o)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Me.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Me.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Me.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Me.cast(this,e)},r.prototype.add=function(e){return this.throwIfDisposed(),Me.add(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),Me.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),Me.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),Me.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),Me.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),Me.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),Me.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),Me.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),Me.mulStrict(this,e)},r.prototype.div=function(e){return this.throwIfDisposed(),Me.div(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),Me.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),Me.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),Me.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Me.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),Me.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Me.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),Me.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),Me.modStrict(this,e)},r.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Me.squaredDifference(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Me.squaredDifferenceStrict(this,e)},r.prototype.transpose=function(e){return this.throwIfDisposed(),Me.transpose(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),Me.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Me.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),Me.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),Me.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),Me.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),Me.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),Me.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Me.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),Me.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Me.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Me.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Me.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Me.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),Me.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),Me.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),Me.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),Me.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),Me.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),Me.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),Me.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),Me.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),Me.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),Me.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),Me.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),Me.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),Me.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),Me.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),Me.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),Me.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),Me.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),Me.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),Me.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),Me.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Me.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),Me.relu(this)},r.prototype.elu=function(){return this.throwIfDisposed(),Me.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),Me.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Me.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),Me.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),Me.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),Me.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),Me.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),Me.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),Me.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),Me.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),Me.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),Me.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),Me.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),Me.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),Me.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),Me.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),Me.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),Me.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),Me.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),Me.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),Me.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),Me.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),Me.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Me.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Me.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Me.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Me.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Me.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Me.conv1d(this,e,t,n,i,o,a)},r.prototype.conv2d=function(e,t,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Me.conv2d(this,e,t,n,i,o,a)},r.prototype.conv2dTranspose=function(e,t,n,i,o){return this.throwIfDisposed(),Me.conv2dTranspose(this,e,t,n,i,o)},r.prototype.depthwiseConv2D=function(e,t,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Me.depthwiseConv2d(this,e,t,n,i,o,a)},r.prototype.separableConv2d=function(e,t,n,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),Me.separableConv2d(this,e,t,n,i,o,a)},r.prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),Me.avgPool(this,e,t,n,i)},r.prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),Me.maxPool(this,e,t,n,i)},r.prototype.localResponseNormalization=function(e,t,n,i){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5),Me.localResponseNormalization(this,e,t,n,i)},r.prototype.pool=function(e,t,n,i,o){return this.throwIfDisposed(),Me.pool(this,e,t,n,i,o)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),md.variable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Me.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Me.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Me.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Me.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),Me.stridedSlice(this,e,t,n,i,o,a,s,u)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Me.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),Me.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),Me.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),Me.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),Me.spectral.irfft(this)},r})();Object.defineProperty(at,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var md=(function(r){function e(t,n,i){n===void 0&&(n=!0);var o=r.call(this,t.shape,t.dtype,null,t.dataId)||this;o.trainable=n,o.name=i,o.name==null&&(o.name=Ni().nextVariableId().toString());try{Ni().registerVariable(o)}catch(a){throw Ni().disposeTensor(o),a}return o}return Ja(e,r),e.variable=function(t,n,i,o){return n===void 0&&(n=!0),o!=null&&o!==t.dtype&&(t=t.asType(o)),new e(t,n,i)},e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!Gr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");Ni().disposeTensor(this),this.dataId=t.dataId,Ni().registerTensor(this)},e.prototype.dispose=function(){Ni().disposeVariable(this),this.isDisposedInternal=!0},e})(at);Object.defineProperty(md,Symbol.hasInstance,{value:function(r){return r instanceof at&&r.assign!=null&&r.assign instanceof Function}});var hS,$0,X0,Y0,K0;md.variable;(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})(hS||(hS={})),(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})($0||($0={})),(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(X0||(X0={})),(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(Y0||(Y0={})),(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(K0||(K0={}));var GD={float32:Y0,int32:$0,bool:X0,complex64:K0};function or(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return GD[r][e]}function gy(r){return or(r,"int32")}function ur(r,e){if(r.dtype===e.dtype)return[r,e];var t=or(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function VD(r,e){te(r.dtype===e.dtype,function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"})}function zC(r){var e=[];return(function t(n,i,o){if(n!=null){if(n instanceof at)return void i.push(n);if(a=n,!(!Array.isArray(a)&&typeof a!="object")){var a,s=n;for(var u in s){var l=s[u];o.has(l)||(o.add(l),t(l,i,o))}}}})(r,e,new Set),e}var vy,dS=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),jD=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new dS}return r.prototype.ready=function(){return Gt(this,void 0,void 0,function(){var e,t,n;return Vt(this,function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then(function(){})];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}})})},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return Gt(this,void 0,void 0,function(){var t,n,i;return Vt(this,function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=n,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.profiler=new zD(this.backendInstance),[2,!0]}})})},r.prototype.initializeBackend=function(e){var t=this,n=ve.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then(function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)}).catch(function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)});return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority})},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],i=this.initializeBackend(n),o=i.success,a=i.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){this.write(e,t,this.readSync(t))},r.prototype.tidy=function(e,t){var n,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun(function(){return i.startScope(o)},function(){return i.endScope(n)},function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n})},r.prototype.scopedRun=function(e,t,n){e();try{var i=n();return t(),i}catch(o){throw t(),o}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=at.make(e.shape,{dataId:e.dataId},e.dtype);return this.addTapeNode([e],t,function(n){return[n.toFloat()]}),t},r.prototype.runKernel=function(e,t,n){var i,o=this,a=[],s=this.isTapeOn(),u=this.state.activeScope!=null?this.state.activeScope.name:"",l=function(m){s&&(a=m.map(function(g){return o.keep(o.clone(g))}))},c=this.state.numBytes,h=this.state.numTensors;if(this.scopedRun(function(){return o.state.kernelDepth++},function(){return o.state.kernelDepth--},function(){i=o.ENV.getBool("DEBUG")?o.profiler.profileKernel(u,function(){return e(o.backend,l)}):e(o.backend,l)}),s){var f={id:this.state.nextTapeNodeId++,name:u,inputs:t,outputs:Array.isArray(i)?i:[i],saved:a};n!=null&&(f.gradient=function(m){return n(m,a)}),this.state.activeTape.push(f)}return this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-c,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map(function(m){return t[m].shape}),outputShape:Array.isArray(i)?i.map(function(m){return m.shape}):i.shape}),i},r.prototype.registerTensor=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*DC(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t??this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i,t!=null?t.register(e.dataId,e.shape,e.dtype):this.backend.register(e.dataId,e.shape,e.dtype)}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof md||this.track(e)},r.prototype.registerVariable=function(e){if(this.state.registeredVariables[e.name]!=null)throw new Error("Variable with name "+e.name+" was already registered");this.state.registeredVariables[e.name]=e},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return Gt(this,void 0,void 0,function(){var t,n;return Vt(this,function(i){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map(function(o){return o.totalBytesSnapshot})),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]})})},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n){var i={};e.forEach(function(a,s){i[s]=a});var o={id:this.state.nextTapeNodeId++,name:this.state.activeScope.name,inputs:i,outputs:[t],gradient:function(a){var s=n(a),u={};return s.forEach(function(l,c){u[c]=function(){return l}}),u}};this.state.activeTape.push(o)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=zC(e),i=new Set(n.map(function(u){return u.id})),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach(function(u){u.kept||u.scopeId!==s.id||t.track(u)})},r.prototype.gradients=function(e,t,n,i){var o=this;if(i===void 0&&(i=!1),te(t.length>0,function(){return"gradients() received an empty list of xs."}),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun(function(){return o.startTape()},function(){return o.endTape()},function(){return o.tidy("forward",e)});te(a instanceof at,function(){return"The result y returned by f() must be a tensor."});var s=(function(u,l,c){for(var h={},f={},m=0;m<l.length;m++)h[l[m].id]=!0;for(m=0;m<u.length;m++){var g=(C=u[m]).inputs;for(var w in g){for(var v=g[w],y=!1,x=0;x<l.length;x++)if(h[v.id]){C.outputs.forEach(function(A){return h[A.id]=!0}),y=!0,f[C.id]=!0;break}if(y)break}}var E={};E[c.id]=!0;var _={};for(m=u.length-1;m>=0;m--)for(g=(C=u[m]).inputs,x=0;x<C.outputs.length;x++)if(E[C.outputs[x].id]){for(var w in g)E[g[w].id]=!0,_[C.id]=!0;break}var k=[];for(m=0;m<u.length;m++){var C;if(f[(C=u[m]).id]&&_[C.id]){var R={};for(var w in C.inputs){var I=C.inputs[w];h[I.id]&&(R[w]=I)}var T=Object.assign({},C);T.inputs=R,T.outputs=C.outputs,k.push(T)}}return k})(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",function(){var u,l,c={};c[a.id]=n??(u=a.shape,l=FC(Pt(u),"float32"),at.make(u,{values:l})),(function(f,m,g){for(var w=function(y){var x=m[y],E=[];if(x.outputs.forEach(function(R){var I=f[R.id];if(I!=null)E.push(I);else{var T=at.make(R.shape,{values:pd(R.size,R.dtype)},R.dtype);E.push(T)}}),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.name+".");var _=x.gradient(x.outputs.length===1?E[0]:E),k=function(R){if(!(R in _))throw new Error("Cannot backprop through input "+R+". Available gradients found: "+Object.keys(_)+".");var I=g(function(){return _[R]()});if(I.dtype!=="float32")throw new Error("Error in gradient for op "+x.name+". The gradient of input "+R+" must have 'float32' dtype, but has '"+I.dtype+"'");var T=x.inputs[R];if(!Gr(I.shape,T.shape))throw new Error("Error in gradient for op "+x.name+". The gradient of input '"+R+"' has shape '"+I.shape+"', which does not match the shape of the input '"+T.shape+"'");if(f[T.id]==null)f[T.id]=I;else{var A=f[T.id];f[T.id]=A.add(I),A.dispose()}};for(var C in x.inputs)k(C)},v=m.length-1;v>=0;v--)w(v)})(c,s,function(f){return o.tidy(f)});var h=t.map(function(f){return c[f.id]});return o.state.gradientDepth===0&&(o.state.activeTape.forEach(function(f){for(var m in f.saved)f.saved[m].dispose()}),o.state.activeTape=null),{value:a,grads:h}})},r.prototype.customGrad=function(e){var t=this;return te(j0(e),function(){return"The f passed in customGrad(f) must be a function."}),function(){for(var n,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];te(i.every(function(s){return s instanceof at}),function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"});var a={};return i.forEach(function(s,u){a[u]=s}),t.runKernel(function(s,u){return te((n=e.apply(void 0,i.concat([u]))).value instanceof at,function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"}),te(j0(n.gradFunc),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."}),n.value},a,function(s,u){var l=n.gradFunc(s,u),c=Array.isArray(l)?l:[l];te(c.length===i.length,function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."}),te(c.every(function(f){return f instanceof at}),function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."});var h={};return c.forEach(function(f,m){h[m]=function(){return f}}),h})}},r.prototype.write=function(e,t,n){var i=this.state.tensorInfo.get(t),o=i.backend;if(e=e||this.backend,i.dtype==="string"){var a=LD(n);this.state.numBytes+=a-i.bytes,i.bytes=a}e!==o&&(o.disposeData(t),i.backend=e,e.register(t,i.shape,i.dtype)),e.write(t,n)},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.fromPixels=function(e,t){return this.backend.fromPixels(e,t)},r.prototype.time=function(e){return Gt(this,void 0,void 0,function(){var t,n;return Vt(this,function(i){switch(i.label){case 0:return t=lm(),[4,this.backend.time(e)];case 1:return(n=i.sent()).wallMs=lm()-t,[2,n]}})})},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new dS,this.registry)this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r})(),ve=(function(){var r=(function(){if(vy==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}vy=t}return vy})();if(r._tfengine==null){var e=new TD(r);r._tfengine=new jD(e)}return AD(r._tfengine.ENV),Ni=function(){return r._tfengine},r._tfengine})();function WC(){return typeof window<"u"||typeof WorkerGlobalScope<"u"}be.registerFlag("DEBUG",function(){return!1},function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")}),be.registerFlag("IS_BROWSER",function(){return WC()}),be.registerFlag("IS_NODE",function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0}),be.registerFlag("IS_CHROME",function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)}),be.registerFlag("PROD",function(){return!1}),be.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",function(){return be.getBool("DEBUG")}),be.registerFlag("DEPRECATION_WARNINGS_ENABLED",function(){return!0}),be.registerFlag("IS_TEST",function(){return!1});var Fu={},yy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function qD(r,e){Fu[r]=e}function ga(r){r in Fu||(Fu[r]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return n.addEventListener("webglcontextlost",function(i){i.preventDefault(),delete Fu[t]},!1),t===1?n.getContext("webgl",yy)||n.getContext("experimental-webgl",yy):n.getContext("webgl2",yy)})(r));var e=Fu[r];return e.isContextLost()?(delete Fu[r],ga(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Fu[r])}function Et(r,e,t){var n=t();return e&&(function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+KD(i,o))})(r),n}var $D=596e-10,XD=65504;function YD(r){return!!(be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||$D<Math.abs(r)&&Math.abs(r)<XD)}function KD(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function rp(r,e,t){return Za(r,e,function(){return r.getExtension(t)},'Extension "'+t+'" not supported on this browser.')}function JD(r,e,t){var n=Za(r,e,function(){return r.createShader(r.VERTEX_SHADER)},"Unable to create vertex WebGLShader.");if(Et(r,e,function(){return r.shaderSource(n,t)}),Et(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function ZD(r,e,t){var n=Za(r,e,function(){return r.createShader(r.FRAGMENT_SHADER)},"Unable to create fragment WebGLShader.");if(Et(r,e,function(){return r.shaderSource(n,t)}),Et(r,e,function(){return r.compileShader(n)}),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw(function(i,o){var a=QD.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map(function(v,y){return vc((y+1).toString(),l)+v}),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var m=c.slice(0,s-1),g=c.slice(s-1,s),w=c.slice(s);console.log(m.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+vc(g[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))})(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var by,wy,QD=/ERROR: [0-9]+:([0-9]+):/g;function eN(r,e){return Za(r,e,function(){return r.createProgram()},"Unable to create WebGLProgram.")}function tN(r,e,t){if(Et(r,e,function(){return r.linkProgram(t)}),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function _y(r,e,t){if(Et(r,e,function(){return r.validateProgram(t)}),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function nN(r,e,t){var n=Za(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Et(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),Et(r,e,function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function rN(r,e,t){var n=Za(r,e,function(){return r.createBuffer()},"Unable to create WebGLBuffer");return Et(r,e,function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)}),Et(r,e,function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)}),n}function iN(r,e){return Za(r,e,function(){return r.createTexture()},"Unable to create WebGLTexture.")}function oN(r,e){var t=be.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function aN(r,e){return Za(r,e,function(){return r.createFramebuffer()},"Unable to create WebGLFramebuffer.")}function fS(r,e,t,n,i,o,a,s){var u=r.getAttribLocation(t,n);return u!==-1&&(Et(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,i)}),Et(r,e,function(){return r.vertexAttribPointer(u,o,r.FLOAT,!1,a,s)}),Et(r,e,function(){return r.enableVertexAttribArray(u)}),!0)}function sN(r,e,t,n){dN(r,n),Et(r,e,function(){return r.activeTexture(r.TEXTURE0+n)}),Et(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)})}function uN(r,e,t,n){return Za(r,e,function(){return r.getUniformLocation(t,n)},'uniform "'+n+'" not present in program.')}function lN(r,e,t){return r.getUniformLocation(e,t)}function cN(r,e,t,n,i,o){Et(r,e,function(){return sN(r,e,n,o)}),Et(r,e,function(){return r.uniform1i(i,o)})}function xy(r,e,t,n){Et(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)}),Et(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)})}function pS(r,e,t){Et(r,e,function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)}),Et(r,e,function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)})}function ip(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+hN(r,e))}function hN(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Za(r,e,t,n){var i=Et(r,e,function(){return t()});if(i==null)throw new Error(n);return i}function dN(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function cm(r,e){return e===void 0&&(e=2),Pt(r.slice(0,r.length-e))}function hm(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Sy(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[cm(r)].concat(hm(r))),e}function fN(r,e){var t;e===void 0&&(e=!1);var n=be.getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map(function(l,c){return c>=r.length-2?IC(r[c]):r[c]})).length===1&&(r=[2,r[0]])),r.length!==2){var i=Wu(r);r=i.newShape}var o=Pt(r);if(r.length<=1&&o<=n)return[1,o];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var a=cm(r),s=2,u=2;return r.length&&(s=(t=hm(r))[0],u=t[1]),G0(o=a*(s/2)*(u/2)).map(function(l){return 2*l})}return G0(o)}function op(r){return r%2==0}function ap(r,e){if(Gr(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||op(t)&&op(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&op(r[0])&&op(e[0])}function pN(r){if(by==null){var e=ga(r);by=e.getParameter(e.MAX_TEXTURE_SIZE)}return by}function mN(r){if(wy==null){var e=ga(r);wy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,wy)}function gN(r){if(r===0)return 0;var e=ga(r);return Ju(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:Ju(e,"EXT_disjoint_timer_query")?1:0}function Ju(r,e){return r.getExtension(e)!=null}function mS(r){try{if(ga(r)!=null)return!0}catch{return!1}return!1}function vN(r){if(r===0)return!1;var e=ga(r);if(r===1){if(!Ju(e,"OES_texture_float"))return!1}else if(!Ju(e,"EXT_color_buffer_float"))return!1;return HC(e,r)}function yN(r){if(r===0)return!1;var e=ga(r);if(r===1){if(!Ju(e,"OES_texture_float")||!Ju(e,"WEBGL_color_buffer_float"))return!1}else if(!Ju(e,"EXT_color_buffer_float"))return!1;return HC(e,r)}function HC(r,e){var t=r.createFramebuffer(),n=r.createTexture();r.bindTexture(r.TEXTURE_2D,n);var i=e===2?r.RGBA32F:r.RGBA;r.texImage2D(r.TEXTURE_2D,0,i,1,1,0,r.RGBA,r.FLOAT,null),r.bindFramebuffer(r.FRAMEBUFFER,t),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,n,0);var o=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(n),r.deleteFramebuffer(t),o}function bN(r){return r===2&&ga(r).fenceSync!=null}function GC(r){be.getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function Rt(r,e){return ve.tidy(r,e)}function yi(r){zC(r).forEach(function(e){return e.dispose()})}function wN(r){return ve.keep(r)}function J0(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];be.getBool("IS_TEST")||console.warn.apply(console,r)}function ou(r){var e=r;if(ja(r))return[r.length];if(!Array.isArray(r))return[];for(var t=[];Array.isArray(e)||ja(e);)t.push(e.length),e=e[0];return Array.isArray(r)&&be.getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function n(i,o,a){if(a=a||[],!Array.isArray(i)&&!ja(i))return void te(o.length===0,function(){return"Element arr["+a.join("][")+"] is a primitive, but should be an array/TypedArray of "+o[0]+" elements"});te(o.length>0,function(){return"Element arr["+a.join("][")+"] should be a primitive, but is an array of "+i.length+" elements"}),te(i.length===o[0],function(){return"Element arr["+a.join("][")+"] should have "+o[0]+" elements, but has "+i.length+" elements"});for(var s=o.slice(1),u=0;u<i.length;++u)n(i[u],s,a.concat(u))})(r,t,[]),t}function gS(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function J(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof at)return gS(n,r.dtype,e,t),r;var i=fd(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),gS(n,i,e,t),r==null||!ja(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var o=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=ou(r);ja(r)||Array.isArray(r)||(r=[r]);var s=i!=="string"?PC(r,i,be.getBool("DEBUG")):Nc(r);return at.make(a,{values:s},i)}function dm(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map(function(i,o){return J(i,e+"["+o+"]",t)},n)}function VC(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function _N(r,e,t){for(var n=r.length+e.length,i=[],o=0,a=0,s=0;s<n;s++)t.indexOf(s)===-1?i.push(r[o++]):i.push(e[a++]);return i}function Lr(r,e){for(var t=[],n=r.length,i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);return[t,e.map(function(o){return r[o]})]}function so(r,e){return _N(r,e.map(function(t){return 1}),e)}function Ii(r,e,t){te(VC(e,t),function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."})}function va(r,e){if(VC(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach(function(i){return t.push(i)}),t}function bw(r){return r.map(function(e,t){return[t,e]}).sort(function(e,t){return e[1]-t[1]}).map(function(e){return e[0]})}function ya(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function xN(r,e){var t=r[0].length;r.forEach(function(i,o){te(i.length===t,function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"})}),te(e>=0&&e<t,function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."});var n=r[0];r.forEach(function(i,o){for(var a=0;a<t;a++)te(a===e||i[a]===n[a],function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+o+"."})})}function Pc(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function ue(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];ve.startScope(t);try{var s=n.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),ve.endScope(s),s}catch(u){throw ve.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}be.registerFlag("HAS_WEBGL",function(){return be.getNumber("WEBGL_VERSION")>0}),be.registerFlag("WEBGL_VERSION",function(){return mS(2)?2:mS(1)?1:0}),be.registerFlag("WEBGL_BUFFER_SUPPORTED",function(){return be.get("WEBGL_VERSION")===2}),be.registerFlag("WEBGL_CPU_FORWARD",function(){return!0}),be.registerFlag("WEBGL_PACK",function(){return be.getBool("HAS_WEBGL")}),be.registerFlag("WEBGL_PACK_NORMALIZATION",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_CLIP",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_DEPTHWISECONV",function(){return!1}),be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_PACK_REDUCE",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_LAZILY_UNPACK",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_CONV_IM2COL",function(){return be.getBool("WEBGL_PACK")}),be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",function(){return pN(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",function(){return mN(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",function(){var r=be.getNumber("WEBGL_VERSION");return r===0?0:gN(r)}),be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r}),be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",function(){return vN(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",function(){return yN(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_FENCE_API_ENABLED",function(){return bN(be.getNumber("WEBGL_VERSION"))}),be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",function(){return be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0}),UC=GC;var ni=ue({complex_:function(r,e){var t=J(r,"real","complex"),n=J(e,"imag","complex");return An(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),ve.runKernel(function(i){return i.complex(t,n)},{$real:t,$imag:n})}}),ua=ue({real_:function(r){var e=J(r,"input","real");return ve.runKernel(function(t){return t.real(e)},{$input:e})}}),Gs=ue({imag_:function(r){var e=J(r,"input","imag");return ve.runKernel(function(t){return t.imag(e)},{$input:e})}});function di(r,e,t){return au(r,e,ou(r),t)}function au(r,e,t,n){if(n==null&&(n=fd(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ja(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){OC(e);var i=Pt(e),o=Pt(t);te(i===o,function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o});for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==Pt(e.slice(a));te(t[a]===e[a]||!u,function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "})}}return ja(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?PC(r,n,be.getBool("DEBUG")):Nc(r),at.make(e,{values:r},n)}function dt(r,e){if((ja(r)||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");return au(r,[],[],e)}function fi(r,e){Xc(r);var t=ou(r);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return au(r,null,t,e)}function gd(r,e,t){if(Xc(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=ou(r);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return au(r,e,n,t)}function ww(r,e,t){if(Xc(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=ou(r);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return au(r,e,n,t)}function To(r,e,t){if(Xc(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=ou(r);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return au(r,e,n,t)}function SN(r,e,t){if(Xc(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=ou(r);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return au(r,e,n,t)}function EN(r,e,t){if(Xc(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=ou(r);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return au(r,e=e||n,n,t)}function Yc(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Yc(r,"float32"),n=Wn(r,"float32");return ni(t,n)}var i=FC(Pt(r),e);return at.make(r,{values:i},e)}function Wn(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Wn(r,"float32"),n=Wn(r,"float32");return ni(t,n)}var i=pd(Pt(r),e);return at.make(r,{values:i},e)}function yc(r,e,t){return ve.runKernel(function(n){return n.fill(r,e,t)},{})}function kN(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return ve.runKernel(function(n){return n.linspace(r,e,t)},{})}function jC(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Wn([0],n);var i=pd(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return fi(i,n)}var qC=ue({onesLike_:function(r){var e=J(r,"x","onesLike");if(e.dtype==="complex64"){var t=qC(ua(e)),n=pn(Gs(e));return ni(t,n)}return ve.runKernel(function(i){return i.onesLike(e)},{$x:e},function(i,o){return{$x:function(){return pn(i)}}})}}),pn=ue({zerosLike_:function(r){var e=J(r,"x","zerosLike");return ve.runKernel(function(t){return t.zerosLike(e)},{$x:e},function(t,n){return{$x:function(){return pn(t)}}})}}),Vr=ue({concat_:function(r,e){e===void 0&&(e=0),te(r.length>=1,function(){return"Pass at least one tensor to concat"});var t=dm(r,"tensors","concat");e=Mr(e,t[0].shape)[0];var n=Pc(t.map(function(a){return a.shape}),e);if(Pt(n)===0)return di([],n);if((t=t.filter(function(a){return a.size>0})).length===1)return t[0];var i=t.map(function(a){return a.shape});xN(i,e);var o=t;return ve.runKernel(function(a){return a.concat(t,e)},o,function(a){var s=i.map(function(u){return u[e]});return _w(a,s,e).map(function(u){return function(){return u}})})}}),CN=ue({concat1d_:function(r){return Vr(r,0)}}),TN=ue({concat2d_:function(r,e){return Vr(r,e)}}),MN=ue({concat3d_:function(r,e){return Vr(r,e)}}),AN=ue({concat4d_:function(r,e){return Vr(r,e)}}),_w=ue({split_:function(r,e,t){t===void 0&&(t=0);var n,i=J(r,"x","split");return t=Mr(t,i.shape)[0],typeof e=="number"?(te(i.shape[t]%e==0,function(){return"Number of splits must evenly divide the axis."}),n=new Array(e).fill(i.shape[t]/e)):(te(i.shape[t]===e.reduce(function(o,a){return o+a}),function(){return"The sum of sizes must match the size of the axis dimension."}),n=e),ve.runKernel(function(o){return o.split(i,n,t)},{$x:i},function(o){return{$x:function(){return Vr(o,t)}}})}});function al(r,e){return r(e={exports:{}},e.exports),e.exports}var RN=al(function(r){(function(e,t,n){function i(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var m=.02519603282416938*(u+=h.charCodeAt(f));m-=u=m>>>0,u=(m*=u)>>>0,u+=4294967296*(m-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,r)}),IN=al(function(r){(function(e,t,n){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,r)}),DN=al(function(r){(function(e,t,n){function i(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,r)}),NN=al(function(r){(function(e,t,n){function i(s){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},(function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()})(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,r)}),PN=al(function(r){(function(e,t,n){function i(s){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,m=u.i;return u.w=h=h+1640531527|0,c=f[m+34&127],l=f[m=m+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[m]=c^l,u.i=m,c+(h^h>>>16)|0},(function(l,c){var h,f,m,g,w,v=[],y=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,y=Math.max(y,c.length)),m=0,g=-32;g<y;++g)c&&(f^=c.charCodeAt((g+32)%c.length)),g===0&&(w=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(w=w+1640531527|0,m=(h=v[127&g]^=f+w)==0?m+1:0);for(m>=128&&(v[127&(c&&c.length||0)]=-1),m=127,g=512;g>0;--g)f=v[m+34&127],h=v[m=m+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,v[m]=f^h;l.w=w,l.X=v,l.i=m})(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,r)}),FN=al(function(r){(function(e,t,n){function i(s){var u=this,l="";u.next=function(){var h=u.b,f=u.c,m=u.d,g=u.a;return h=h<<25^h>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-m|0,u.d=m<<16^f>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,r)}),Ou=al(function(r){(function(e,t){var n,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function f(y,x,E){var _=[],k=w((function I(T,A){var N,O=[],V=typeof T;if(A&&V=="object")for(N in T)try{O.push(I(T[N],A-1))}catch{}return O.length?O:V=="string"?T:T+"\0"})((x=x==1?{entropy:!0}:x||{}).entropy?[y,v(e)]:y??(function(){try{var I;return n&&(I=n.randomBytes)?I=I(o):(I=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(I)),v(I)}catch{var T=i.navigator,A=T&&T.plugins;return[+new Date,i,A,i.screen,v(e)]}})(),3),_),C=new m(_),R=function(){for(var I=C.g(a),T=u,A=0;I<l;)I=(I+A)*o,T*=o,A=C.g(1);for(;I>=c;)I/=2,T/=2,A>>>=1;return(I+A)/T};return R.int32=function(){return 0|C.g(4)},R.quick=function(){return C.g(4)/4294967296},R.double=R,w(v(C.S),e),(x.pass||E||function(I,T,A,N){return N&&(N.S&&g(N,C),I.state=function(){return g(C,{})}),A?(t[s]=I,T):I})(R,k,"global"in x?x.global:this==t,x.state)}function m(y){var x,E=y.length,_=this,k=0,C=_.i=_.j=0,R=_.S=[];for(E||(y=[E++]);k<o;)R[k]=k++;for(k=0;k<o;k++)R[k]=R[C=h&C+y[k%E]+(x=R[k])],R[C]=x;(_.g=function(I){for(var T,A=0,N=_.i,O=_.j,V=_.S;I--;)T=V[N=h&N+1],A=A*o+V[h&(V[N]=V[O=h&O+T])+(V[O]=T)];return _.i=N,_.j=O,A})(o)}function g(y,x){return x.i=y.i,x.j=y.j,x.S=y.S.slice(),x}function w(y,x){for(var E,_=y+"",k=0;k<_.length;)x[h&k]=h&(E^=19*x[h&k])+_.charCodeAt(k++);return v(x)}function v(y){return String.fromCharCode.apply(0,y)}if(t["seed"+s]=f,w(t.random(),e),r.exports){r.exports=f;try{n=require("crypto")}catch{}}})([],Math)});Ou.alea=RN,Ou.xor128=IN,Ou.xorwow=DN,Ou.xorshift7=NN,Ou.xor4096=PN,Ou.tychei=FN;var xw=Ou.alea,$C=(function(){function r(e,t,n,i,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=xw(a.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,n=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),ON=(function(){function r(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1);var o=this;if(this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=xw(i)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})();function tn(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",OC(r),new Zh(r,e,t)}function LN(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var XC=ue({batchToSpaceND_:function(r,e,t){var n=J(r,"x","batchToSpaceND"),i=e.reduce(function(o,a){return o*a});return te(n.rank>=1+e.length,function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length}),te(t.length===e.length,function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length}),te(n.shape[0]%i==0,function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i}),ve.runKernel(function(o){return o.batchToSpaceND(n,e,t)},{$x:n},function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}})}}),BN=ue({cast_:function(r,e){var t=J(r,"x","cast");if(!FD(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");return ve.runKernel(function(n){return n.cast(t,e)},{$x:t},function(n){return{$x:function(){return n.clone()}}})}}),UN=ue({clone_:function(r){var e=J(r,"x","clone",null);return ve.runKernel(function(t){return at.make(e.shape,{dataId:e.dataId},e.dtype)},{$x:e},function(t){return{$x:function(){return t.toFloat()}}})}}),zN=ue({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var i=J(r,"x","cumsum"),o=va([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=ya(1,i.rank)[0],u=ve.runKernel(function(l){return l.cumsum(a,s,t,n)},{permutedX:a},function(l){return{permutedX:function(){return l.cumsum(e,t,!n)}}});return o!=null&&(u=u.transpose(o)),u}}),WN=ue({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=J(r,"x","depthToSpace"),i=t==="NHWC"?n.shape[1]:n.shape[2],o=t==="NHWC"?n.shape[2]:n.shape[3],a=t==="NHWC"?n.shape[3]:n.shape[1];return te(i*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+n.shape}),te(o*e>=0,function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+n.shape}),te(a%(e*e)==0,function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+n.shape}),ve.runKernel(function(s){return s.depthToSpace(n,e,t)},{$x:n})}}),eo=ue({expandDims_:function(r,e){e===void 0&&(e=0);var t=J(r,"x","expandDims",null);te(e<=t.rank,function(){return"Axis must be <= rank of the tensor"});var n=t.shape.slice();return e<0&&(te(-(t.rank+1)<=e,function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"}),e=t.rank+e+1),n.splice(e,0,1),Do(t,n)}}),YC=ue({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var i=tn([r,e],n),o=r<=e?r:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(r,e);if(t==null)return s;if(t.length===1)return bc(eo(s,0),[t[0],1,1]);if(t.length===2)return bc(eo(eo(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return bc(eo(eo(eo(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),HN=ue({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var i=J(r,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=ve.runKernel(function(l){return l.multinomial(s,n,e,t)},{logits2D:s});return a===1?u.as1D():u}}),Z0=ue({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=J(r,"indices","oneHot","int32"),o=i.shape.concat([e]);return i=i.flatten(),ve.runKernel(function(a){return a.oneHot(i,e,t,n)},{$indices:i},function(a){return{$indices:function(){return Wn(i.shape,"float32")}}}).reshape(o)}}),vd=ue({pad_:function(r,e,t){t===void 0&&(t=0);var n=J(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i=e.map(function(o){return o[0]});return ve.runKernel(function(o){return o.pad(n,e,t)},{$x:n},function(o){return{$x:function(){return o.slice(i,n.shape)}}})}}),GN=ue({pad1d_:function(r,e,t){return t===void 0&&(t=0),te(e.length===2,function(){return"Invalid number of paddings. Must be length of 2."}),vd(r,[e],t)}}),VN=ue({pad2d_:function(r,e,t){return t===void 0&&(t=0),te(e.length===2&&e[0].length===2&&e[1].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),vd(r,e,t)}}),jN=ue({pad3d_:function(r,e,t){return t===void 0&&(t=0),te(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),vd(r,e,t)}}),qN=ue({pad4d_:function(r,e,t){return t===void 0&&(t=0),te(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,function(){return"Invalid number of paddings. Must be length of 2 each."}),vd(r,e,t)}}),$N=ue({rand_:function(r,e,t){var n=Pt(r),i=null;if(t==null||t==="float32")i=new Float32Array(n);else if(t==="int32")i=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(n)}for(var o=0;o<n;o++)i[o]=e();return at.make(r,{values:i},t)}}),XN=ue({randomNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new $C(e,t,n,!1,i),a=tn(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),KC=ue({randomUniform_:function(r,e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var o=tn(r,n),a=new ON(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),Do=ue({reshape_:function(r,e){var t=J(r,"x","reshape",null);return e=DD(e,t.size),te(t.size===Pt(e),function(){return"new shape and old shape must have the same number of elements."}),ve.runKernel(function(n){return n.reshape(t,e)},{$x:t},function(n){return{$x:function(){return n.reshape(t.shape)}}})}}),JC=ue({spaceToBatchND_:function(r,e,t){var n=J(r,"x","spaceToBatchND");return te(n.rank>=1+e.length,function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length}),te(t.length===e.length,function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length}),te(n.shape.reduce(function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i},!0),function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()}),ve.runKernel(function(i){return i.spaceToBatchND(n,e,t)},{$x:n},function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}})}}),ZC=ue({squeeze_:function(r,e){var t=J(r,"x","squeeze");return Do(t,Wu(t.shape,e).newShape)}}),Oo=ue({stack_:function(r,e){e===void 0&&(e=0);var t=dm(r,"tensors","stack");if(te(t.length>=1,function(){return"Pass at least one tensor to tf.stack"}),t.length===1)return t[0].expandDims(e);var n=t[0].rank,i=t[0].shape,o=t[0].dtype;te(e<=n,function(){return"Axis must be <= rank of the tensor"}),t.forEach(function(s){An(i,s.shape,"All tensors passed to stack must have matching shapes")}),t.forEach(function(s){te(o===s.dtype,function(){return"All tensors passed to stack must have matching dtypes"})});var a=t.map(function(s){return s.expandDims(e)});return Vr(a,e)}}),bc=ue({tile_:function(r,e){var t=J(r,"x","tile",null);return te(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}),ve.runKernel(function(n,i){var o=n.tile(t,e);return i([t]),o},{$x:t},function(n,i){var o=i[0];return{$x:function(){var a=pn(o);if(o.rank===1)for(var s=0;s<e[0];++s)a=a.add(n.slice([s*o.shape[0]],[o.shape[0]]));else if(o.rank===2)for(s=0;s<e[0];++s)for(var u=0;u<e[1];++u)a=a.add(n.slice([s*o.shape[0],u*o.shape[1]],[o.shape[0],o.shape[1]]));else if(o.rank===3)for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(var l=0;l<e[2];++l)a=a.add(n.slice([s*o.shape[0],u*o.shape[1],l*o.shape[2]],[o.shape[0],o.shape[1],o.shape[2]]));else{if(o.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+o.rank+" tensors yet.");for(s=0;s<e[0];++s)for(u=0;u<e[1];++u)for(l=0;l<e[2];++l)for(var c=0;c<e[3];++c)a=a.add(n.slice([s*o.shape[0],u*o.shape[1],l*o.shape[2],c*o.shape[3]],[o.shape[0],o.shape[1],o.shape[2],o.shape[3]]))}return a}}})}}),YN=ue({truncatedNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new $C(e,t,n,!0,i),a=tn(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),Tr=ue({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=J(r,"x","unstack");return te(e>=-t.shape.length&&e<t.shape.length,function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"}),e<0&&(e+=t.shape.length),ve.runKernel(function(n){return n.unstack(t,e)},{$x:t},function(n){return{$x:function(){return Oo(n,e)}}})}}),KN=function(r,e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s,u,l,c,h;return Vt(this,function(f){switch(f.label){case 0:return t=J(r,"x","setdiff1d"),n=J(e,"y","setdiff1d"),te(t.dtype===n.dtype,function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."}),te(t.rank===1,function(){return"x should be 1D tensor, but got x ("+t.shape+")."}),te(n.rank===1,function(){return"y should be 1D tensor, but got y ("+n.shape+")."}),[4,t.data()];case 1:return i=f.sent(),[4,n.data()];case 2:for(o=f.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new Zh([s],t.dtype),l=new Zh([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}})})};function fm(r,e,t,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(e.slice(0))).push(r[0]/t),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([r[a+1]/e[a],e[a]]);i=i.concat(r.slice(o+1))}return i}function pm(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var i=e+1;i<r;++i)i<=2*e?(n.push(i),n.push(i-(e+1))):n.push(i)}else{var o=[],a=[];for(i=1;i<r;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);n.push.apply(n,o),n.push(0),n.push.apply(n,a)}return n}function mm(r,e,t,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/t):i.push(r[0]*t);for(var o=1;o<r.length;++o)o<=e.length?n?i.push(e[o-1]*r[o]):i.push(r[o]/e[o-1]):i.push(r[o]);return i}function QC(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function eT(r,e,t){for(var n=r.slice(0,1),i=0;i<t;++i)n.push(r[i+1]-e[i][0]-e[i][1]);return n}function tT(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=r.shape,s=t.slice();s.pop();var u=1;for(o=n;o<r.rank;++o)u*=a[o],s.push(a[o]);var l=ol(r.shape).map(function(c){return c/u}).concat([1]).slice(0,n);return[s,i,u,l]}var nT=30;function Ey(r){return r<=nT?r:q0(r,Math.floor(Math.sqrt(r)))}function JN(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}(function(n,i,o){var a=i.rank>1?i.shape[i.rank-1]:1,s=i.rank>1?i.rank-1:1,u="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+o.shape+", indices.shape: "+i.shape+", shape: "+n+", sliceDim: "+a+", and batchDim: "+s+".";if(o.rank<s)throw new Error(u+" update.rank < "+s+". ");if(n.length<a+(o.rank-s))throw new Error(u+" Output shape length < "+(a+(o.rank-s)));if(o.rank!==s+n.length-a)throw new Error(u+" update.rank != "+(s+n.length-a));for(var l=0;l<s;++l)if(o.shape[l]!==i.shape[l])throw new Error(u+" updates.shape["+l+"] ("+o.shape[l]+") != indices.shape["+l+"] ("+i.shape[l]+").");for(l=0;l<o.rank-s;++l)if(o.shape[l+s]!==n[l+a])throw new Error(u+" updates.shape["+(l+s)+"] ("+o.shape[l+s]+") != shape["+(l+s)+"] ("+n[l+s]+")")})(t,e,r)}function gm(r,e,t){for(var n=e.rank>1?e.shape[e.rank-1]:1,i=t.length,o=1,a=n;a<i;++a)o*=t[a];var s=n<1?1:n;return{sliceRank:n,numUpdates:e.size/s,sliceSize:o,strides:ol(t.slice(0,n)).concat([1]),outputSize:Pt(t)}}function Sw(r,e,t,n,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),a!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");for(var l=[],c=[],h=[],f=0;f<r.length;f++)l[f]=ZN(i,e,n,r,f),c[f]=QN(o,t,n,r,f),u&1<<f&&(c[f]=l[f]+1,h.push(f));var m=new Array(r.length).fill(0);return m=m.map(function(g,w){for(var v=0,y=n[w]||1,x=l[w];!(y>0?x>=c[w]:x<=c[w]);x+=y)v+=1;return v}),[l,m,h]}function ZN(r,e,t,n,i){var o=e[i],a=t[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=H0(0,o,s-1)}function QN(r,e,t,n,i){var o=e[i],a=t[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=a>0?H0(0,o,s):H0(-1,o,s-1)}function rT(r,e,t){for(var n=t.length,i=0;i<t.length;i++)if(t[i]>1){n=i;break}for(i=n+1;i<t.length;i++)if(e[i]>0||t[i]!==r[i])return!1;return!0}function iT(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function eP(r,e){te(j0(r),function(){return"The f passed in variableGrads(f) must be a function"}),te(e==null||Array.isArray(e)&&e.every(function(c){return c instanceof md}),function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"});var t=e!=null;if(!t)for(var n in e=[],ve.registeredVariables)e.push(ve.registeredVariables[n]);var i=t?e.filter(function(c){return!c.trainable}):null,o=e.length;te((e=e.filter(function(c){return c.trainable})).length>0,function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."});var a=ve.gradients(r,e,null,!0),s=a.value,u=a.grads;te(u.some(function(c){return c!=null}),function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."}),te(s.rank===0,function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"});var l={};return e.forEach(function(c,h){u[h]!=null&&(l[c.name]=u[h])}),i?.forEach(function(c){return l[c.name]=null}),{value:s,grads:l}}function yd(r){return ve.customGrad(r)}var su=ue({softmax_:function(r,e){e===void 0&&(e=-1);var t=J(r,"logits","softmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return yd(function(n,i){var o=n.logSumExp([e],!0),a=n.toFloat().sub(o).exp();return i([a]),{value:a,gradFunc:function(s,u){var l=u[0],c=s.mul(l);return c.sub(c.sum([e],!0).mul(l))}}})(t)}}),tP=ue({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=J(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return yd(function(n,i){var o=n.max(e,!0),a=n.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}})(t)}}),oT=(function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.data.delete(e)},r})();function mc(r,e){for(var t=r.length,n=[],i=0;i<t;i++){var o=t-1-i,a=r[o]||1;(e[e.length-1-i]||1)>1&&a===1&&n.unshift(o)}return n}function lr(r,e){for(var t=[],n=0;n<e.length;n++){var i=r[r.length-n-1],o=e.length-n-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function cn(r,e){for(var t=[],n=Math.max(r.length,e.length),i=0;i<n;i++){var o=r[r.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(o)}}return t}function Qh(r,e,t,n,i,o,a){a===void 0&&(a="channelsLast");var s,u=vm(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,r[3],r[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,r[1],r[1]]}return bd(r,s,t,n,i,o,!1,a)}function bd(r,e,t,n,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(s==="channelsLast")l=r[0],c=r[1],h=r[2],f=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=r[0],f=r[1],c=r[2],h=r[3]}var m,g=e[0],w=e[1],v=e[3],y=vm(t),x=y[0],E=y[1],_=vm(n),k=_[0],C=_[1],R=wc(g,k),I=wc(w,C),T=(function(F,B,U,P,L,H,W,z){var q,re,de;if(typeof F=="number"){var ye=F===0?"VALID":"NUMBER";q={top:F,bottom:F,left:F,right:F,type:ye};var ne=(function(Y,ot,Je,Xe,qe,Tt){qe==null&&(qe=nP(Y,ot,Xe));var Qe=Y[0],ft=Y[1],Mt=yS((Qe-ot+2*qe)/Xe+1,Tt);te(ao(Mt),function(){return"The output # of rows ("+Mt+") must be an integer. Change the stride and/or zero pad parameters"});var Ut=yS((ft-ot+2*qe)/Xe+1,Tt);return te(ao(Ut),function(){return"The output # of columns ("+Ut+") must be an integer. Change the stride and/or zero pad parameters"}),[Mt,Ut,Je]})([B,U,1],H,1,P,F,z);re=ne[0],de=ne[1]}else if(F==="same"){re=Math.ceil(B/P),de=Math.ceil(U/L);var ie=Math.max(0,(re-1)*P+H-B),fe=Math.max(0,(de-1)*L+W-U),Ae=Math.floor(ie/2),De=ie-Ae,Be=Math.floor(fe/2),lt=fe-Be;q={top:Ae,bottom:De,left:Be,right:lt,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);q={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((B-H+1)/P),de=Math.ceil((U-W+1)/L)}return{padInfo:q,outHeight:re,outWidth:de}})(i,c,h,x,E,R,I,o),A=T.padInfo,N=T.outHeight,O=T.outWidth,V=a?v*f:v;return s==="channelsFirst"?m=[l,V,N,O]:s==="channelsLast"&&(m=[l,N,O,V]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:f,outHeight:N,outWidth:O,outChannels:V,padInfo:A,strideHeight:x,strideWidth:E,filterHeight:g,filterWidth:w,effectiveFilterHeight:R,effectiveFilterWidth:I,dilationHeight:k,dilationWidth:C,inShape:r,outShape:m,filterShape:e}}function ky(r,e,t,n,i,o,a){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var s=[-1,-1,-1,-1,-1],u=s[0],l=s[1],c=s[2],h=s[3],f=s[4];if(a==="channelsLast")u=r[0],l=r[1],c=r[2],h=r[3],f=r[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);u=r[0],f=r[1],l=r[2],c=r[3],h=r[4]}var m,g=e[0],w=e[1],v=e[2],y=e[4],x=vS(t),E=x[0],_=x[1],k=x[2],C=vS(n),R=C[0],I=C[1],T=C[2],A=(function(U,P,L,H,W,z,q,re,de,ye){var ne,ie,fe,Ae;if(U==="same"){ie=Math.ceil(P/W),fe=Math.ceil(L/z),Ae=Math.ceil(H/q);var De=(ie-1)*W+re-P,Be=(fe-1)*z+de-L,lt=(Ae-1)*q+ye-H,Y=Math.floor(De/2),ot=De-Y,Je=Math.floor(Be/2),Xe=Be-Je,qe=Math.floor(lt/2),Tt=lt-qe;ne={top:Je,bottom:Xe,left:qe,right:Tt,front:Y,back:ot,type:"SAME"}}else{if(U!=="valid")throw Error("Unknown padding parameter: "+U);ne={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},ie=Math.ceil((P-re+1)/W),fe=Math.ceil((L-de+1)/z),Ae=Math.ceil((H-ye+1)/q)}return{padInfo:ne,outDepth:ie,outHeight:fe,outWidth:Ae}})(i,l,c,h,E,_,k,wc(g,R),wc(w,I),wc(v,T)),N=A.padInfo,O=A.outDepth,V=A.outHeight,F=A.outWidth,B=o?y*f:y;return a==="channelsFirst"?m=[u,B,O,V,F]:a==="channelsLast"&&(m=[u,O,V,F,B]),{batchSize:u,dataFormat:a,inDepth:l,inHeight:c,inWidth:h,inChannels:f,outDepth:O,outHeight:V,outWidth:F,outChannels:B,padInfo:N,strideDepth:E,strideHeight:_,strideWidth:k,filterDepth:g,filterHeight:w,filterWidth:v,dilationDepth:R,dilationHeight:I,dilationWidth:T,inShape:r,outShape:m,filterShape:e}}function nP(r,e,t,n){n===void 0&&(n=1);var i=wc(e,n);return Math.floor((r[0]*(t-1)-t+i)/2)}function vm(r){return typeof r=="number"?[r,r]:r}function vS(r){return typeof r=="number"?[r,r,r]:r}function wc(r,e){return e<=1?r:r+(r-1)*(e-1)}function yS(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function ym(r){var e=vm(r),t=e[0],n=e[1];return t===1&&n===1}function Js(r,e){return ym(r)||ym(e)}function aT(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Wn(r.shape),i=r.toFloat(),o=t.complex(i,n);return n.dispose(),i.dispose(),o}if(!OD(r.dtype,e))return at.make(r.shape,{dataId:r.dataId},e);if(r.dtype==="complex64"){var a=t.real(r);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(r);if(e==="bool"){var s=dt(0,r.dtype);return o=t.notEqual(r,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function Q0(r,e){return at.make(e,{dataId:r.dataId},r.dtype)}function sT(r,e,t){var n=(e-r)/(t-1),i=pd(t,"float32");i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return fi(i,"float32")}function eb(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function bS(r,e){return{real:r[2*e],imag:r[2*e+1]}}function rP(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function iP(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function Ew(r,e,t,n,i){for(var o=Array.from(e).map(function(m,g){return{score:m,boxIndex:g}}).filter(function(m){return m.score>i}).sort(function(m,g){return g.score-m.score}),a=[],s=0;s<o.length;s++){var u=o[s],l=u.score,c=u.boxIndex;if(l<i)break;for(var h=!1,f=a.length-1;f>=0;--f)if(oP(r,c,a[f])>=n){h=!0;break}if(!h&&(a.push(c),a.length>=t))break}return fi(a,"int32")}function oP(r,e,t){var n=r.subarray(4*e,4*e+4),i=r.subarray(4*t,4*t+4),o=Math.min(n[0],n[2]),a=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),m=(s-o)*(u-a),g=(h-l)*(f-c);if(m<=0||g<=0)return 0;var w=Math.max(o,l),v=Math.max(a,c),y=Math.min(s,h),x=Math.min(u,f),E=Math.max(y-w,0)*Math.max(x-v,0);return E/(m+g-E)}function uT(r,e,t){var n=new Array(r.rank).fill(0),i=r.shape.slice();return e.map(function(o){i[t]=o;var a=r.slice(n,i);return n[t]+=o,a})}function lT(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var i=tn(t,r.dtype);for(n=0;n<i.values.length;++n){for(var o=i.indexToLoc(n),a=new Array(r.rank),s=0;s<a.length;s++)a[s]=o[s]%r.shape[s];var u=r.locToIndex(a);i.values[n]=r.values[u]}return i.toTensor()}function cT(r,e,t,n,i){for(var o=e[e.length-1],a=[r.length/o,o],s=a[0],u=a[1],l=V0(t,s*n),c=V0("int32",s*n),h=0;h<s;h++){for(var f=h*u,m=r.subarray(f,f+u),g=[],w=0;w<m.length;w++)g.push({value:m[w],index:w});g.sort(function(_,k){return k.value-_.value});var v=h*n,y=l.subarray(v,v+n),x=c.subarray(v,v+n);for(w=0;w<n;w++)y[w]=g[w].value,x[w]=g[w].index}var E=e.slice();return E[E.length-1]=n,[di(l,E,t),di(c,E,"int32")]}function kw(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var i=tn(r,"int32"),o=tn([t.length,r.length],"int32");for(n=0;n<t.length;n++){var a=i.indexToLoc(t[n]),s=n*r.length;o.values.set(a,s)}return o.toTensor()}var aP=(function(){return function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `}})(),sP=(function(){return function(r,e){this.outputShape=[],this.usesPackedTextures=!0,this.outputShape=r,this.variableNames=e.map(function(i,o){return"T"+o});var t=[];this.variableNames.forEach(function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")});var n=this.variableNames.map(function(i){return"v"+i}).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `}})(),uP=(function(){return function(r,e,t){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,o=r.inSize,a=Math.ceil(o/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}})();function hT(r,e){return["x","y","z","w","u","v"].slice(0,e).map(function(t){return r+"."+t})}function pi(r,e){return e===1?[r]:hT(r,e)}function Ur(){var r,e,t,n,i,o,a,s,u,l;return be.getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0. || val < 0. || val == 0.) ? false : true;
      }
    `,u=`
      const float INFINITY = uintBitsToFloat(uint(0x7f800000));
    `,l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",i="texture2D",o="gl_FragColor",a="",s=`
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function ju(r,e,t){t===void 0&&(t="index");var n=ol(e);return n.map(function(i,o){return"int "+r[o]+" = "+t+" / "+i+"; "+(o===n.length-1?"int "+r[o+1]+" = "+t+" - "+r[o]+" * "+i:"index -= "+r[o]+" * "+i)+";"}).join("")}function Cw(r){var e=ol(r).map(function(t){return t.toString()});return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var dT=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function lP(r,e,t,n){var i=[];r.forEach(function(m){var g=Pt(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?i.push("uniform float "+m.name+(g>1?"["+g+"]":"")+";"):(i.push("uniform sampler2D "+m.name+";"),i.push("uniform int offset"+m.name+";"))});var o,a,s=i.join(`
`),u=r.map(function(m){return(function(g,w,v){v===void 0&&(v=!1);var y="";y+=v?fT(g):ac(g);var x=g.shapeInfo.logicalShape,E=w.logicalShape;return x.length<=E.length&&(y+=v?(function(_,k){var C,R=_.name,I=R.charAt(0).toUpperCase()+R.slice(1),T="get"+I+"AtOutCoords",A=_.shapeInfo.logicalShape.length,N=k.logicalShape.length,O=mc(_.shapeInfo.logicalShape,k.logicalShape),V=Pn(N),F=N-A,B=["x","y","z","w","u","v"];C=A===0?"":N<2&&O.length>=1?"coords = 0;":O.map(function(q){return"coords."+B[q+F]+" = 0;"}).join(`
`);var U="";U=N<2&&A>0?"coords":_.shapeInfo.logicalShape.map(function(q,re){return"coords."+B[re+F]}).join(", ");var P="return outputValue;",L=Pt(_.shapeInfo.logicalShape)===1,H=Pt(k.logicalShape)===1;if(A!==1||L||H){if(L&&!H)P=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(O.length){var W=A-2,z=A-1;O.indexOf(W)>-1&&O.indexOf(z)>-1?P="return vec4(outputValue.x);":O.indexOf(W)>-1?P="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(z)>-1&&(P="return vec4(outputValue.xx, outputValue.zz);")}}else P=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+V+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+I+"("+U+`);
      `+P+`
    }
  `})(g,w):(function(_,k){var C=_.name,R=C.charAt(0).toUpperCase()+C.slice(1),I="get"+R+"AtOutCoords",T=k.texShape,A=_.shapeInfo.texShape,N=_.shapeInfo.logicalShape.length,O=k.logicalShape.length;if(!_.shapeInfo.isUniform&&N===O&&_.shapeInfo.flatOffset==null&&Gr(A,T))return`
      float `+I+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var V,F=Pn(O),B=mc(_.shapeInfo.logicalShape,k.logicalShape),U=O-N,P=["x","y","z","w","u","v"];V=N===0?"":O<2&&B.length>=1?"coords = 0;":B.map(function(H){return"coords."+P[H+U]+" = 0;"}).join(`
`);var L="";return L=O<2&&N>0?"coords":_.shapeInfo.logicalShape.map(function(H,W){return"coords."+P[W+U]}).join(", "),`
    float `+I+`() {
      `+F+` coords = getOutputCoords();
      `+V+`
      return get`+R+"("+L+`);
    }
  `})(g,w)),y})(m,e,n)}).join(`
`),l=e.texShape,c=Ur(),h=(function(m){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+m.texture2D+`(textureSampler, uv).r;
    }
  `})(c),f=(function(m){return m.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+m.varyingFs+` vec2 resultUV;
    `+m.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    #define isnan(value) isnan_custom(value)
    `+m.defineSpecialNaN+`
    bvec4 isnan_custom(vec4 val) {
      return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
    }

    `+m.defineSpecialInf+`
    `+m.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+cP+`
    `+hP+`
    `+dP+`
  `})(c);return e.isPacked?(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `})(0,g);case 2:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(Gr(_,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var R=Math.ceil(_[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=m,v=g,y=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],x=Math.ceil(w[2]/2),E=x*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(_,k){for(var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],R=Math.ceil(_[_.length-1]/2),I=R*Math.ceil(_[_.length-2]/2),T=I,A="",N="b, r, c",O=2;O<_.length-1;O++)T*=_[_.length-O-1],A=`
      int b`+O+" = index / "+T+`;
      index -= b`+O+" * "+T+`;
    `+A,N="b"+O+", "+N;return`
    ivec`+_.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+A+`

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec`+_.length+"("+N+`);
    }
  `})(m,g)}var w,v,y,x,E})(e.logicalShape,l),a=(function(m){return`
    void setOutput(vec4 val) {
      `+m.output+` = val;
    }
  `})(c)):(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(y,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `})(0,g);case 2:return(function(y,x){return Gr(y,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:y[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:y[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+y[1]+`;
      int c = index - r * `+y[1]+`;
      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=g,v=ju(["r","c","d"],m),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(y,x){var E=ju(["r","c","d","d2"],y);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+E+`
      return ivec4(r, c, d, d2);
    }
  `})(m,g);case 5:return(function(y,x){var E=ju(["r","c","d","d2","d3"],y);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(m,g);case 6:return(function(y,x){var E=ju(["r","c","d","d2","d3","d4"],y);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(m,g);default:throw new Error(m.length+"-D output sampling is not yet supported")}var w,v})(e.logicalShape,l),a=(function(m){return`
    void setOutput(float val) {
      `+m.output+` = vec4(val, 0, 0, 0);
    }
  `})(c)),n&&(f+=fP),[f,h,a,s,o,u,t].join(`
`)}function ac(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=Cu(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+n+`, uv);
    }
  `})(r);case 1:return(function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+zl(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=Cu(n);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+n+`, uv);
    }
  `})(r);case 2:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&Gr(n,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=Wu(n),c=l.newShape,h=l.keptDims,f=c;if(f.length<n.length){var m=sc(t,f);return`
      `+ac(m)+`
      float `+o+`(int row, int col) {
        return `+o+"("+uc(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+zl(t)+`
      }
    `;var g=a[0],w=a[1],v=Cu(i);return w===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+g+", "+w+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(r);case 3:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[1]*n[2],s=n[2],u=Wu(n),l=u.newShape,c=u.keptDims,h=l;if(h.length<n.length){var f=sc(t,h);return`
        `+ac(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+uc(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+zl(t)+`
      }
    `;var m=t.shapeInfo.texShape,g=m[0],w=m[1],v=t.shapeInfo.flatOffset;if(w===a&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+g+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(w===s&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var y=Cu(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+y+`;
        vec2 uv = uvFromFlat(`+g+", "+w+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(r);case 4:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[3],s=n[2]*a,u=n[1]*s,l=Wu(n),c=l.newShape,h=l.keptDims;if(c.length<n.length){var f=sc(t,c);return`
      `+ac(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+uc(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+zl(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,w=g[0],v=g[1];if(v===u&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=Cu(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+v+", index + "+y+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(r);case 5:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[4],s=n[3]*a,u=n[2]*s,l=n[1]*u,c=Wu(n),h=c.newShape,f=c.keptDims;if(h.length<n.length){var m=sc(t,h);return`
      `+ac(m)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+uc(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+zl(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,v=w[0],y=w[1];if(y===l&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===a&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=Cu(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(r);case 6:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=Wu(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var l=sc(t,s);return`
      `+ac(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+uc(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=n[5],h=n[4]*c,f=n[3]*h,m=n[2]*f,g=n[1]*m;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+g+", "+m+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+zl(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,y=v[0],x=v[1];if(x===g&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+m+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var E=Cu(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+g+" + col * "+m+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+E+`;
      vec2 uv = uvFromFlat(`+y+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function fT(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Ur(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Ur();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `})(r);case 2:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=Ur();if(u!=null&&Gr(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],m=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+m+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `})(r);case 3:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=sc(i,c);return`
        `+fT(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+uc(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],m=l[1],g=Math.ceil(o[2]/2),w=g*Math.ceil(o[1]/2),v=Ur();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+m+", "+w+", "+g+`, b, row, col);
      return `+v.texture2D+"("+a+`, uv);
    }
  `})(r);default:return(function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],m=Math.ceil(o[a-1]/2),g=m*Math.ceil(o[a-2]/2),w="int b, int row, int col",v="b * "+g+" + (row / 2) * "+m+" + (col / 2)",y=2;y<a-1;y++)w="int b"+y+", "+w,g*=o[a-y-1],v="b"+y+" * "+g+" + "+v;var x=Ur();return`
    vec4 `+u+"("+w+`) {
      int index = `+v+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `})(r)}}var cP=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,hP=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,dP=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,fP=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Cu(r){return"offset"+r}function zl(r){var e=r.name,t=Pt(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Pn(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function sc(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function uc(r,e){return e.map(function(t){return r[t]}).join(", ")}var pP=(function(){return function(r,e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,te(r.length>2,function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."});var i=r[r.length-1],o=Math.ceil(i/e);this.outputShape=r.slice(0,-1),o>1&&this.outputShape.push(o),n||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Pn(l),h=pi("coords",l);if(o===1){var f=Pn(s=l+1);a=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var m=["x","y","z","w","u","v"].slice(0,s),g="."+m[s-1],w=m.map(function(I){return"int "+I}),v=pi("sourceLocR",s-1).concat("inIdx.r"),y=pi("sourceLocG",s-1).concat("inIdx.g"),x=pi("sourceLocB",s-1).concat("inIdx.b"),E=pi("sourceLocA",s-1).concat("inIdx.a"),_=t==="max"?"greaterThan":"lessThan",k=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+E.join()+")));",C=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+E.join()+") : 0.)",R=n?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+R+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+_+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}})(),mP=(function(){return function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterHeight,u=r.effectiveFilterWidth,l=s-1-r.padInfo.top,c=u-1-r.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}})(),gP=(function(){return function(r,e,t,n,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],cn(r,e),cn(r,t);var a="0.0";n!=null&&(cn(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(cn(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}})(),vP=(function(){return function(r,e,t,n,i,o){this.usesPackedTextures=!0,this.variableNames=["x","mean","variance"],cn(r,e),cn(r,t);var a="vec4(0.0)";n!=null&&(cn(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(cn(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `}})(),yP="return areal * breal - aimag * bimag;",bP="return areal * bimag + aimag * breal;",wS=(function(){return function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=cn(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}})(),Cy="return a + b;",Ty="return a - b;",_S="return a * b;",jn=(function(){return function(r,e,t){this.variableNames=["A","B"],this.outputShape=cn(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}})(),Ra=(function(){return function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.usesPackedTextures=!0,this.outputShape=cn(e,t);var i=this.outputShape.length,o="";if(n)if(i===0||Pt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Pn(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=pi("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `}})(),wP=(function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, min, max));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"min"),n.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r})(),_P=(function(){function r(e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=e,this.userCode=`
      uniform float min;
      uniform float max;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(min), vec4(max)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"min"),n.maxLoc=i.getUniformLocationNoThrow(o,"max")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r})(),xP=(function(){return function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}})(),SP=(function(){return function(r){this.outputShape=[],this.outputShape=Pc(r,1),this.variableNames=r.map(function(s,u){return"T"+u});var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];n.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `}})(),EP=(function(){return function(r,e){this.usesPackedTextures=!0,this.outputShape=[],this.outputShape=Pc(r,e);var t=this.outputShape,n=t.length,i=Pn(n),o=pi("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map(function(w,v){return"T"+v});var s=new Array(r.length-1);s[0]=r[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][e];var l=a[e],c="vec2("+a.slice(-2).join()+")",h=a.join(),f="if ("+l+" < "+s[0]+`)
          return getChannel(getT0(`+h+"), "+c+");";for(u=1;u<s.length;u++){var m=s[u-1];f+=`
        else if (`+l+" < "+s[u]+`) {
          `+l+" -= "+m+`;
          return getChannel(getT`+u+"("+h+"), "+c+`);
        }`}var g=s.length;f+=`
        else {
          `+l+" -= "+s[s.length-1]+`;
          return getChannel(getT`+g+"("+h+"), "+c+`);
        }`,this.userCode=`
      float getValue(`+a.map(function(w){return"int "+w})+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);
        if (++`+o[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+o+`);
        }
        if (++`+o[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+o+`);
        }
        if (`+o[n-2]+" < "+t[n-2]+` &&
            --`+o[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `}})(),kP=(function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),CP=(function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=e-1-r.padInfo.top,a=t-1-r.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, d2);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),TP=(function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,o=r.padInfo.top,a=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+a+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),MP=(function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=e-1-r.padInfo.front,u=t-1-r.padInfo.top,l=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),AP=(function(){return function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TODO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),RP=(function(){return function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=e-1-r.padInfo.top,a=t-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TODO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),IP=(function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.top,t=r.padInfo.left,n=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,a=r.dilationWidth,s=r.filterHeight,u=r.filterWidth,l=4*Math.floor(r.inChannels/4),c=r.inChannels%4;this.userCode=`
      const ivec2 strides = ivec2(`+n+", "+i+`);
      const ivec2 pads = ivec2(`+e+", "+t+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`; wR++) {
          int xR = xRCorner + wR * `+o+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+u+`; wC++) {
            int xC = xCCorner + wC * `+a+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+l+`; d1 += 4) {
              vec4 xValues = vec4(
                getX(batch, xR, xC, d1),
                getX(batch, xR, xC, d1 + 1),
                getX(batch, xR, xC, d1 + 2),
                getX(batch, xR, xC, d1 + 3)
              );
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              dotProd += dot(xValues, wValues);
            }

            if (`+(c===1)+`) {
              dotProd +=
                getX(batch, xR, xC, `+l+`) *
                getW(wR, wC, `+l+`, d2);
            } else if (`+(c===2)+`) {
              vec2 xValues = vec2(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1)
              );
              vec2 wValues = vec2(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2)
              );
              dotProd += dot(xValues, wValues);
            } else if (`+(c===3)+`) {
              vec3 xValues = vec3(
                getX(batch, xR, xC, `+l+`),
                getX(batch, xR, xC, `+l+` + 1),
                getX(batch, xR, xC, `+l+` + 2)
              );
              vec3 wValues = vec3(
                getW(wR, wC, `+l+`, d2),
                getW(wR, wC, `+l+` + 1, d2),
                getW(wR, wC, `+l+` + 2, d2)
              );
              dotProd += dot(xValues, wValues);
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),DP=(function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.filterDepth,h=r.filterHeight,f=r.filterWidth,m=4*Math.floor(r.inChannels/4),g=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}})(),NP=(function(){return function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.inHeight,t=r.inWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.filterHeight,c=r.filterWidth,h=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+n+", "+i+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+h+`;
        int q = d2 - d1 * `+h+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TODO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+l+`; wR++) {
          int xR = xRCorner + wR * `+s+`;

          if (xR < 0 || xR >= `+e+`) {
            continue;
          }

          for (int wC = 0; wC < `+c+`; wC++) {
            int xC = xCCorner + wC * `+u+`;

            if (xC < 0 || xC >= `+t+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }
        setOutput(dotProd);
      }
    `}})(),PP=(function(){return function(r){this.variableNames=["x","W"],this.usesPackedTextures=!0,this.outputShape=r.outShape;for(var e=r.inHeight,t=r.inWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.strideHeight,a=r.strideWidth,s=r.dilationHeight,u=r.dilationWidth,l=r.filterHeight,c=r.filterWidth,h=c,f="int xR; int xC; int xCOffset;",m=0;m<l;m++)for(var g=0;g<c;g++)f+=`
          vec4 xTexelR`+m+"C"+2*g+` = vec4(0.);
          vec4 wR`+m+"C"+g+` = vec4(0.);
          vec4 xR`+m+"C"+g+" = vec4(0.);";for(m=0;m<l;m++)for(var w=0;w<h;w++){if(f+=`
          xR = xRCorner + `+m*s+`;
          xC = xCCorner + `+(g=2*w)*u+`;
        `,a===1){if(g<c&&(f+=i%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+e+" && xCOffset >= 0 && xCOffset < "+t+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);
                  xR`+m+"C"+g+" = vec4(previous.zw, xTexelR"+m+"C"+g+`.xy);
                } else {
                  xR`+m+"C"+g+" = vec4(0, 0, xTexelR"+m+"C"+g+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+e+" && xC >= 0 && xC < "+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xR`+m+"C"+g+" = xTexelR"+m+"C"+g+`;
              `,g+1<c)){var v=i%2==0?IC(u):u;u%2==0&&i%2==1||u%2!=0&&i%2!=1?(f+=`
                  xCOffset = xC + `+i%2+" + "+v+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,u>1&&(f+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+e+` &&
                      xCOffset >= 0 && xCOffset < `+t+`) {
                      xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+m+"C"+g+` = vec4(0.);
                    }
                  `),f+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.xy);
                `):f+=`
                  xCOffset = xC + `+v+`;

                  if(xR >= 0 && xR < `+e+` &&
                    xCOffset >= 0 && xCOffset < `+t+`) {
                    xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+m+"C"+(g+1)+" = xTexelR"+m+"C"+(g+2)+`;
                `}}else g<c&&(f+=`
              if(xR >= 0 && xR < `+e+`) {
            `,i%2==1?(f+=`
                xCOffset = xC + 1 - `+a+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+t+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
              `,g+1<c&&(f+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+a+`;
                  if(xCOffset >= 0 && xCOffset < `+t+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+m+"C"+(g+1)+" = vec4(xTexelR"+m+"C"+(g+2)+`.xy, final.xy);
                `)):(f+=`
                if(xC >= 0 && xC < `+t+`) {
                  xTexelR`+m+"C"+g+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+m+"C"+g+` = vec4(0.);
                }

                xCOffset = xC + `+a+`;
                if(xCOffset >= 0 && xCOffset < `+t+`) {
                  xTexelR`+m+"C"+(g+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+m+"C"+(g+2)+` = vec4(0.);
                }

                xR`+m+"C"+g+` = vec4(
                  xTexelR`+m+"C"+g+".xy, xTexelR"+m+"C"+(g+2)+`.xy);
              `,g+1<c&&(f+=`
                  xR`+m+"C"+(g+1)+` = vec4(
                    xTexelR`+m+"C"+g+".zw, xTexelR"+m+"C"+(g+2)+`.zw);
                `)),f+="}");g<c&&(f+=`
            vec4 wTexelR`+m+"C"+g+" = getW("+m+", "+g+`, d1, q);
            wR`+m+"C"+g+" = vec4(wTexelR"+m+"C"+g+".xz, wTexelR"+m+"C"+g+`.xz);
          `,g+1<c&&(f+=`
              vec4 wTexelR`+m+"C"+(g+1)+" = getW("+m+", "+(g+1)+`, d1, q);
              wR`+m+"C"+(g+1)+` =
                vec4(wTexelR`+m+"C"+(g+1)+".xz, wTexelR"+m+"C"+(g+1)+".xz);"))}for(m=0;m<l;m++)for(g=0;g<c;g++)f+="result += xR"+m+"C"+g+" * wR"+m+"C"+g+";";this.userCode=`
      const ivec2 strides = ivec2(`+o+", "+a+`);
      const ivec2 pads = ivec2(`+n+", "+i+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 result = vec4(0.);

        `+f+`

        setOutput(result);
      }
    `}})(),FP=(function(){return function(r,e,t,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=r[0],a=r[1],s=r[2],u=r[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var f=n==="bilinear"?1:0,m=[a-1+".0",s-1+".0"],g=m[0],w=m[1],v=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],y=v[0],x=v[1],E=v[2],_=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],k=_[0],C=_[1],R=_[2];this.userCode=`
      const float height_ratio = float(`+y+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+C+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+R+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}})(),OP=(function(){return function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Pn(n)+` coords = getOutputCoords();
        int end = `+xS(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+xS(n,"coords")+` = idx;
          val += getX(`+(function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")})(n,"coords")+`);
        }
        setOutput(val);
      }
    `}})();function xS(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var LP=(function(){return function(r,e){this.variableNames=["A"];var t=Ur();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ju(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `}})(),BP=(function(){return function(r,e){this.variableNames=["A"],this.usesPackedTextures=!0;var t=Ur();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+ju(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `}})(),UP=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})(),zP=(function(){return function(r){this.variableNames=["A"];var e=Ur();this.outputShape=r,this.userCode=`
      `+dT+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `}})(),WP=(function(){return function(r){this.variableNames=["A"],this.usesPackedTextures=!0;var e=Ur();this.outputShape=r,this.userCode=`
      `+dT+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `}})(),HP=(function(){return function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=Ur(),i=e[0],o=e[1];this.outputShape=r;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+Cw(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex /= 4;
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `}})(),GP=(function(){return function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=Ur(),i=e[0],o=e[1];this.outputShape=r;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+r[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+r[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);
    
              flatIndex /= 4;
              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+Cw(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;
        
        `+a+`

        `+n.output+" = "+s+`;
      }
    `}})(),VP="return real * expR - imag * expI;",jP="return real * expI + imag * expR;",SS=(function(){return function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}})(),qP=(function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(t.valueLoc,e)}},r})(),$P=(function(){return function(r){this.variableNames=["A"];var e=Ur(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}})(),XP=(function(){return function(r){this.variableNames=["A"];var e=Ur(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `}})(),YP=(function(){return function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var i=Pn(this.rank),o=(function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()})(r,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}})(),Ro,Pi,KP=(function(){return function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=Pn(e.length),i=Pn(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}})();function Qm(r,e){return[e,r]}function My(r){var e=Pt(r);return G0(Math.ceil(e/4))}function wd(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function JP(r,e){var t=Ur();return JD(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function ZP(r,e){return nN(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function QP(r,e){return rN(r,e,new Uint16Array([0,1,2,2,1,3]))}function eF(r,e){var t,n,i,o,a,s,u,l,c=r;return be.getNumber("WEBGL_VERSION")===2?(t=c.R32F,n=c.R16F,i=c.RGBA16F,o=c.RGBA32F,a=c.RED,s=4,u=1,l=c.HALF_FLOAT):(t=r.RGBA,n=r.RGBA,i=r.RGBA,o=c.RGBA,a=r.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l}}function _d(r,e,t,n,i,o,a){oN(t,n);var s=iN(r,e),u=r.TEXTURE_2D;return Et(r,e,function(){return r.bindTexture(u,s)}),Et(r,e,function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)}),Et(r,e,function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)}),Et(r,e,function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)}),Et(r,e,function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)}),Et(r,e,function(){return r.texImage2D(u,0,i,t,n,0,o,a,null)}),Et(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)}),s}function tF(r,e,t,n,i){var o=Qm(t,n);return _d(r,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function nF(r,e,t,n,i){var o=Qm(t,n);return _d(r,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function rF(r,e,t,n,i){var o=Qm(t,n);return _d(r,e,o[0],o[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function iF(r,e,t,n,i){var o=wd(t,n);return _d(r,e,o[0],o[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function oF(r,e,t,n,i){var o=wd(t,n);return _d(r,e,o[0],o[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function aF(r,e,t,n){return Et(r,e,function(){return r.bindBuffer(r.ARRAY_BUFFER,n)}),fS(r,e,t,"clipSpacePos",n,3,20,0)&&fS(r,e,t,"uv",n,2,20,12)}function sF(r,e,t,n,i,o,a){var s,u,l;Et(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),o instanceof Uint8Array?(s=new Uint8Array(n*i*4),u=r.UNSIGNED_BYTE,l=r.RGBA):(s=new Float32Array(n*i*4),u=r.FLOAT,l=a.internalFormatPackedFloat),s.set(o),Et(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,l,n,i,0,r.RGBA,u,s)}),Et(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function uF(r,e,t,n){Et(r,e,function(){return r.bindTexture(r.TEXTURE_2D,t)}),n.data instanceof Uint8Array?Et(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)}):Et(r,e,function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)}),Et(r,e,function(){return r.bindTexture(r.TEXTURE_2D,null)})}function lF(r,e,t,n,i){var o=r.createBuffer();Et(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,o)});var a=16*t*n;return Et(r,e,function(){return r.bufferData(r.PIXEL_PACK_BUFFER,a,r.STREAM_READ)}),Et(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)}),Et(r,e,function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}),o}function cF(r,e,t){var n=r,i=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function hF(r,e,t,n,i){var o=Qm(t,n),a=o[0],s=o[1],u=new Uint8Array(t*n*4);return Et(r,e,function(){return r.readPixels(0,0,a,s,i.downloadTextureFormat,r.UNSIGNED_BYTE,u)}),new Float32Array(u.buffer)}function dF(r,e,t,n,i,o,a,s){var u=r,l=new Float32Array((function(c,h){var f=wd(c,h);return f[0]*f[1]*4})(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function fF(r,e,t,n){var i=new Float32Array(t*n*4);return Et(r,e,function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)}),i}(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Ro||(Ro={})),(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Pi||(Pi={}));var pF=(function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=be.getNumber("WEBGL_VERSION");e!=null?(this.gl=e,qD(t,e)):this.gl=ga(t),be.getNumber("WEBGL_VERSION")===1?(this.textureFloatExtension=rp(this.gl,this.debug,"OES_texture_float"),this.colorBufferFloatExtension=this.gl.getExtension("WEBGL_color_buffer_float"),be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")||(this.textureHalfFloatExtension=rp(this.gl,this.debug,"OES_texture_half_float"),this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float"))):this.colorBufferFloatExtension=rp(this.gl,this.debug,"EXT_color_buffer_float"),this.vertexBuffer=ZP(this.gl,this.debug),this.indexBuffer=QP(this.gl,this.debug),this.framebuffer=aN(this.gl,this.debug),this.textureConfig=eF(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return be.getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Et(t,this.debug,function(){return t.finish()}),Et(t,this.debug,function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)}),Et(t,this.debug,function(){return t.deleteFramebuffer(e.framebuffer)}),Et(t,this.debug,function(){return t.bindBuffer(t.ARRAY_BUFFER,null)}),Et(t,this.debug,function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)}),Et(t,this.debug,function(){return t.deleteBuffer(e.indexBuffer)}),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),tF(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),nF(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),rF(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),uF(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,i){this.throwIfDisposed(),sF(this.gl,this.debug,e,t,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),oF(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),iF(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(pS(this.gl,this.debug,this.framebuffer),this.outputTexture=null),Et(this.gl,this.debug,function(){return t.gl.deleteTexture(e)})},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return hF(i.gl,i.debug,t,n,i.textureConfig)})},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,i,o,a){return dF(this.gl,e,0,0,0,o,a,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return cF(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var i=lF(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,i=this;if(be.getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(t,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,function(){return fF(i.gl,i.debug,t,n)})},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=ZD(t,this.debug,e),i=JP(t,this.debug),o=eN(t,this.debug);return Et(t,this.debug,function(){return t.attachShader(o,i)}),Et(t,this.debug,function(){return t.attachShader(o,n)}),tN(t,this.debug,o),this.debug&&_y(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=aF(t,this.debug,this.program,this.vertexBuffer)),o},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&Et(this.gl,this.debug,function(){return t.gl.deleteProgram(e)})},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&_y(this.gl,this.debug,this.program),Et(this.gl,this.debug,function(){return t.gl.useProgram(e)})},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?uN(this.gl,this.debug,e,t):lN(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),Et(this.gl,this.debug,function(){return n.gl.getAttribLocation(e,t)})},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),cN(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var i=wd(t,n),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&_y(this.gl,this.debug,this.program),ip(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Et(e,this.debug,function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)})},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),Et(this.gl,this.debug,function(){return e.gl.finish()})},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=rp(this.gl,this.debug,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},r.prototype.endQuery=function(){if(be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return Gt(this,void 0,void 0,function(){var t=this;return Vt(this,function(n){switch(n.label){case 0:return[4,uS(function(){return t.disposed||t.isQueryAvailable(e,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))})];case 1:return n.sent(),[2,this.getQueryTime(e,be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}})})},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise(function(n){t.addItemToPoll(function(){return e.isFencePassed()},function(){return n()})})},r.prototype.pollItems=function(){for(var e=(function(n){for(var i=0;i<n.length;++i){var o=n[i]();if(!o)break}return i-1})(this.itemsToPoll.map(function(n){return n.isDoneFn})),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||uS(function(){return n.pollItems(),n.itemsToPoll.length===0})},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),xy(this.gl,this.debug,e,this.framebuffer),this.debug&&ip(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(xy(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&ip(this.gl)):pS(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var i=this.gl;xy(i,this.debug,e,this.framebuffer),this.debug&&ip(i),this.outputTexture=e,Et(i,this.debug,function(){return i.viewport(0,0,t,n)}),Et(i,this.debug,function(){return i.scissor(0,0,t,n)})},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,i){var o=this;this.throwIfDisposed(),Et(this.gl,this.debug,function(){return o.gl.scissor(e,t,n,i)})},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function ES(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach(function(t,n){var i=t.logicalShape,o=e[n],a=o.shape;if(!Gr(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!Gr(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}})}var mF=(function(){return function(r,e,t){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r;var n=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=s.left,f=s.top,m=i*n,g=Ur();this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            int blockIndex = rc.y + col;
            int pos = rc.x + row;

            if(blockIndex >= `+r[1]+" || pos >= "+r[0]+`) continue;

            int offsetY = int(blockIndex / (`+u+")) * "+a+" - "+f+`;
            int d0 = offsetY + `+c+" * (pos / "+m+`);

            if(d0 >= `+e[0]+` || d0 < 0) continue;

            int offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+h+`.);
            int d1 = offsetX + `+l+" * (int(mod(float(pos), "+m+".) / "+i+`.));

            if(d1 >= `+e[1]+` || d1 < 0) continue;

            vec2 innerDims = vec2(d1, int(mod(float(pos), `+i+`.)));
            result[row * 2 + col] = getChannel(getA(d0, int(innerDims.x),
                                              int(innerDims.y)), innerDims);
          }
        }

        `+g.output+` = result;
      }
    `}})(),gF=(function(){return function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `}})(),vF=(function(){return function(r,e,t,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}})(),yF=(function(){return function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[],this.usesPackedTextures=!0;var o,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `}})(),bF=(function(){return function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,o=r.effectiveFilterWidth,a=i-1-r.padInfo.top,s=o-1-r.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}})(),Ay=(function(){return function(r,e,t,n,i,o){t===void 0&&(t=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=null),this.variableNames=["matrixA","matrixB"],this.usesPackedTextures=!0,this.outputShape=e;var a=t?r[1]:r[2],s=Math.ceil(a/2),u=t?"i * 2, rc.y":"rc.y, i * 2",l=n?"rc.z, i * 2":"i * 2, rc.z",c=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",m="";o&&(f=`vec4 activation(vec4 x) {
        `+o+`
      }`,m="result = activation(result);");var g=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),this.userCode=`
      `+f+`

      const float sharedDimension = `+s+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+s+`; i++) {
          vec4 a = getMatrixA(rc.x, `+u+`);
          vec4 b = getMatrixB(rc.x, `+l+`);

          result += (`+c[0]+" * "+h[0]+") + ("+c[1]+" * "+h[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+g+`

        `+m+`

        setOutput(result);
      }
    `}})(),wF=(function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r})(),_F=(function(){return function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `}})(),xF=(function(){return function(r){this.variableNames=["A"],this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=pi("rc",e),n=Pn(e),i=(function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c})(e,r,t),o=(function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `})(e,r[r.length-1],r[r.length-2],t),a=(function(s,u){var l=s.length,c=(function(h,f){for(var m=[],g=0;g<=1;g++)for(var w=0;w<=1;w++){for(var v=(g===0?"r":"rp1")+", "+(w===0?"c":"cp1"),y=2;y<h;y++)v=f[f.length-1-y]+","+v;m.push(v)}return m})(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"})(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}}})(),SF=(function(){return function(r,e,t){this.variableNames=["x"],this.outputShape=e.map(function(u,l){return u[0]+r[l]+u[1]});var n=r.length,i=Pn(n),o=e.map(function(u){return u[0]}).join(","),a=e.map(function(u,l){return u[0]+r[l]}).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `}})(),EF=(function(){return function(r,e,t){this.variableNames=["x"],this.usesPackedTextures=!0,this.outputShape=e.map(function(v,y){return v[0]+r[y]+v[1]});for(var n=r.length,i=Pn(n),o=e.map(function(v){return v[0]}).join(","),a=e.map(function(v,y){return v[0]+r[y]}).join(","),s=pi("rc",n),u=pi("source",n),l=s[n-1]+" < "+this.outputShape[n-1],c=n===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[n-1]+` += 1;
       if(`+l+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+s[n-2]+` += 1;
       if(`+s[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+s[n-1]+` += 1;
         if(`+l+") {"],f=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",g=0,w=n===1?2:4;g<w;g++)m+=`
        `+h[g]+`
        if (`+f+`) {
          result[`+g+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+g+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;m+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `}})(),Ry=(function(){return function(r,e,t){if(this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var n=r.filterWidth,i=r.strideHeight,o=r.strideWidth,a=r.dilationHeight,s=r.dilationWidth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,c=r.padInfo.top,h=r.padInfo.left;this.outputShape=r.outShape;var f=e==="avg",m="0.0";if(f||(m="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+i+", "+o+`);
        const ivec2 pads = ivec2(`+c+", "+h+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+u+`;
              wR += `+a+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+l+`;
                wC += `+s+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = wR * `+l+` + wC;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var g=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(g="avgValue / count");var w=4*Math.floor(n/4),v=n%4,y=`
      if (`+f+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+i+", "+o+`);
      const ivec2 pads = ivec2(`+c+", "+h+`);
      const float initializationValue = `+m+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+m+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+u+`;
            wR += `+a+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+w+`; wC += 4) {
            int xC = xCCorner + wC * `+s+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              getValue(batch, xR, xC + 3 * `+s+`, d)
            );

            `+y+`
          }

          int xC = xCCorner + `+w+`;
          if (`+(v===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+y+`
          } else if (`+(v===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              initializationValue,
              initializationValue
            );

            `+y+`
          } else if (`+(v===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+s+`, d),
              getValue(batch, xR, xC + 2 * `+s+`, d),
              initializationValue
            );

            `+y+`
          }
        }
        setOutput(`+g+`);
      }
    `}}})(),kF=(function(){return function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,i=r.inSize,o=Math.ceil(i/t);this.outputShape=[n,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var m="";i%t>0&&(m=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `}})(),CF=(function(){return function(r,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+ju(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+Cw(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `}})(),TF=(function(){return function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}})(),MF=(function(){return function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],l=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}})(),AF=(function(){return function(r,e,t,n){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],l=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));
        
        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`; 
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}})(),RF=(function(){return function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}})(),IF=(function(){return function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],l=[n&&e>1?e-1:e,n&&t>1?t-1:t],c=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}})(),DF=(function(){return function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map(function(o,a){return(function(s){return e.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"})(a)}).join(","),i=Pn(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `}})(),NF=(function(){return function(r,e){this.variableNames=["x"],this.usesPackedTextures=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=pi("rc",t),i=n[t-1]+" + 1 < "+this.outputShape[t-1],o=n[t-2]+" + 1 < "+this.outputShape[t-2],a=Pn(t);function s(u){var l=r.map(function(c,h){return(function(f,m){return e.indexOf(f)!==-1&&r[f]!==1?r[f]+" - "+m[f]+" - 1":""+m[f]})(h,u)});return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(u){return s(u)})(n.slice())+`;
          if(`+i+`){
            result.g = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)})(n.slice())+`;
          }
          if(`+o+`) {
            result.b = `+(function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)})(n.slice())+`;
            if(`+i+`) {
              result.a = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)})(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `}})(),kS=(function(){return function(r,e,t,n,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Pn(i.length),u=Pn(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";n===1?h="i":n===2&&(h="i, coords[1]");var f="getUpdates("+h+")",m=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}})(),PF=(function(){return function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,i=r.inSize,o=r.numSegments,a=o*Math.ceil(i/t);this.outputShape=[n,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `}})(),FF=(function(){return function(r,e,t){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",n="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<r&&a.push(""+o[u]);n=a.join(),i=s.join()}var l=Pn(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `}})(),OF=(function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Pn(this.rank),i="uniform int start["+this.rank+"];",o=(function(a){if(a===1)return"sourceLoc";if(a<=6)return Iy.slice(0,a).map(function(s){return"sourceLoc."+s}).join(",");throw Error("Slicing for rank "+a+" is not yet supported")})(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map(function(a,s){return"sourceLoc."+Iy[s]+" = start["+s+"] + coords."+Iy[s]+";"}).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r})(),Iy=["x","y","z","w","u","v"],LF=(function(){function r(e){this.variableNames=["source"],this.usesPackedTextures=!0,this.outputShape=e,this.rank=e.length;var t=Pn(this.rank),n=pi("coords",this.rank),i=pi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map(function(c,h){return"start["+h+"]"}).join()+");":e.map(function(c,h){return i[h]+" = "+n[h]+" + start["+h+"];"}).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+` 
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r})(),BF=(function(){return function(r,e,t,n){this.variableNames=["x"];var i=t.filter(function(c,h){return n.indexOf(h)===-1});this.outputShape=i;var o=t.length,a=Pn(t.length),s=Pn(i.length),u="";if(o===1)u="coords * strides + begin";else{var l=0;u=t.map(function(c,h){return n.indexOf(h)===-1?(l++,i.length===1?"coords * strides["+h+"] + begin["+h+"]":"coords["+(l-1)+"] * strides["+h+"] + begin["+h+"]"):"begin["+h+"]"}).join(",")}this.userCode=`
      `+a+" begin = "+a+"("+r+`);
      `+a+" strides = "+a+"("+e+`);

      void main() {
        `+s+` coords = getOutputCoords();
        setOutput(getX(`+u+`));
      }
    `}})(),UF=(function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var i,o=CS(t,n),a=TS(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===Pi.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Pi.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Pi.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Pi.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Pi.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},r.prototype.releaseTexture=function(e,t,n,i){if(this.freeTextures!=null){var o=TS(t,CS(n,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach(function(n){e.gpgpu.deleteMatrixTexture(n)});for(var t in this.usedTextures)this.usedTextures[t].forEach(function(i){e.gpgpu.deleteMatrixTexture(i)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r})();function CS(r,e){if(r===Ro.UPLOAD)return Pi.PACKED_2X2_FLOAT32;if(r===Ro.RENDER||r==null)return e?be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Pi.PACKED_2X2_FLOAT32:Pi.PACKED_2X2_FLOAT16:be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?Pi.UNPACKED_FLOAT32:Pi.UNPACKED_FLOAT16;if(r===Ro.DOWNLOAD||r===Ro.PIXELS)return Pi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function TS(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var zF=(function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var i=Pn(this.rank),o=(function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()})(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `}})(),WF=(function(){return function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var i=Pn(this.rank),o=(function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `}})(),HF=(function(){return function(r,e){this.variableNames=["A"],this.usesPackedTextures=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Pn(this.rank),o=hT("rc",this.rank),a=new Array(this.rank);for(n=0;n<e.length;n++)a[e[n]]=o[n];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }  
      setOutput(result);
    }
    `}})(),Tw=1.7580993408473768,Mw=1.0507009873554805,Zt=(function(){return function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}})(),sl="if (isnan(x)) return x;",GF="return x;",MS=sl+`
  return (x < 0.0) ? 0.0 : x;
`,VF=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+Tw+`;
  float scale = `+Mw+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,AS="return exp(x);",jF=sl+`
  return sin(x);
`,qF=sl+`
  return cos(x);
`,$F=sl+`
  return atan(x);
`,XF=sl+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,YF=sl+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,KF="return x;",RS=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Dy=(function(){return function(r,e){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}})(),JF=(function(){return function(r){this.variableNames=["A"],this.usesPackedTextures=!0,this.outputShape=r;var e=r.length,t=pi("rc",e),n=Pn(e),i=(function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l})(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `}})(),sp={},ZF=600,QF=(function(){function r(e){if(this.gpgpu=e,this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.disposed=!1,!be.getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){var t=ga(be.getNumber("WEBGL_VERSION"));this.binaryCache=((n=be.getNumber("WEBGL_VERSION"))in sp||(sp[n]={}),sp[n]),this.gpgpu=new pF(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;var n;this.textureManager=new UF(this.gpgpu),this.numMBBeforeWarning=be.global.screen==null?1024:be.global.screen.height*be.global.screen.width*window.devicePixelRatio*ZF/1024/1024,this.texData=new oT(this,ve)}return r.prototype.register=function(e,t,n){if(this.texData.has(e))throw new Error("Data buffer is already registered");this.texData.set(e,{shape:t,dtype:n})},r.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=[e.height,e.width],i=[e.height,e.width,t];if(be.getBool("IS_BROWSER")){if(!(e instanceof HTMLVideoElement||e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e.data instanceof Uint8Array))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(e instanceof HTMLVideoElement){if(this.fromPixels2DContext==null){if(document.readyState!=="complete")throw new Error("The DOM is not ready yet. Please call tf.browser.fromPixels() once the DOM is ready. One way to do that is to add an event listener for `DOMContentLoaded` on the document object");this.fromPixels2DContext=document.createElement("canvas").getContext("2d")}this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),e=this.fromPixels2DContext.canvas}}var o,a,s=this.makeTensorHandle(n,"int32");if(this.texData.get(s.dataId).usage=Ro.PIXELS,this.gpgpu.uploadPixelDataToTexture(this.getTexture(s.dataId),e),be.getBool("WEBGL_PACK")){o=new XP(i);var u=this.makePackedTensor(o.outputShape,s.dtype);a=this.compileAndRun(o,[s],u)}else o=new $P(i),a=this.compileAndRun(o,[s]);return this.disposeData(s.dataId),a},r.prototype.makeTensorHandle=function(e,t){var n={};return this.register(n,e,t),{dataId:n,shape:e,dtype:t}},r.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendWebGL.write(): values can not be null");if(be.getBool("DEBUG"))for(var n=0;n<t.length;n++){var i=t[n];if(!YD(i))throw Error("The value "+i+" cannot be represented on this device.")}var o=this.texData.get(e);if(o.dtype==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.releaseGPUData(e),o.usage=Ro.UPLOAD,o.values=t},r.prototype.readSync=function(e){var t=this.texData.get(e),n=t.values,i=t.dtype,o=t.complexTensors,a=t.slice,s=t.shape;if(a!=null){var u=new Zt(s,"return x;"),l=this.compileAndRun(u,[{dataId:e,shape:s,dtype:i}]),c=this.readSync(l.dataId);return l.dispose(),c}if(n!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return n;var h,f,m=this.activeTimers!=null;return m&&(h=performance.now()),i==="complex64"?f=eb(o.real.dataSync(),o.imag.dataSync()):f=this.getValuesFromTexture(e),m&&(this.downloadWaitMs+=performance.now()-h),this.convertAndCacheOnCPU(e,f)},r.prototype.read=function(e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C;return Vt(this,function(R){switch(R.label){case 0:if(this.pendingRead.has(e))return n=this.pendingRead.get(e),[2,new Promise(function(I){return n.push(I)})];if(i=this.texData.get(e),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,s!=null)return c=new Zt(a,"return x;"),h=this.compileAndRun(c,[{dataId:e,shape:a,dtype:u}]),f=this.read(h.dataId),h.dispose(),[2,f];if(o!=null)return[2,this.convertAndCacheOnCPU(e)];if(!be.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&be.getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return m=null,u!=="complex64"&&be.get("WEBGL_BUFFER_SUPPORTED")&&(g=this.decode(e),e=g.dataId,w=this.texData.get(g.dataId),m=(t=this.gpgpu).createBufferFromTexture.apply(t,[w.texture].concat(My(a)))),this.pendingRead.set(e,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:R.sent(),R.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return y=R.sent(),x=y[0],E=y[1],v=eb(x,E),[3,5];case 4:m==null?v=this.getValuesFromTexture(e):(_=Pt(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(m,_),this.disposeData(e)),R.label=5;case 5:return k=this.convertAndCacheOnCPU(e,v),C=this.pendingRead.get(e),this.pendingRead.delete(e),C.forEach(function(I){return I(k)}),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)),[2,k]}})})},r.prototype.getValuesFromTexture=function(e){var t,n=this,i=this.texData.get(e),o=i.shape,a=i.dtype,s=i.isPacked,u=Pt(o);if(be.getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(e),c=this.texData.get(l.dataId),h=(t=this.gpgpu).downloadMatrixFromPackedTexture.apply(t,[c.texture].concat(My(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=be.getBool("WEBGL_PACK")&&s===!0,m=f?Sy(o):o,g=this.makeTensorHandle(m,"float32");g.size=Pt(o),this.texData.get(g.dataId).usage=Ro.DOWNLOAD;var w=Rt(function(){var x=f?new WP(m):new zP(m);return n.compileAndRun(x,[{shape:m,dtype:a,dataId:e}],g,null)}),v=this.texData.get(w.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(g.dataId),y},r.prototype.time=function(e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s,u;return Vt(this,function(l){switch(l.label){case 0:return t=this.activeTimers,n=[],i=!1,this.programTimersStack==null?(this.programTimersStack=n,i=!0):this.activeTimers.push(n),this.activeTimers=n,e(),o=Nc(this.activeTimers.map(function(c){return c.query})).filter(function(c){return c!=null}),a=Nc(this.activeTimers.map(function(c){return c.name})).filter(function(c){return c!=null}),this.activeTimers=t,i&&(this.programTimersStack=null),[4,Promise.all(o)];case 1:return s=l.sent(),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:RD(s),getExtraProfileInfo:function(){return s.map(function(c,h){return{name:a[h],ms:c}}).map(function(c){return c.name+": "+c.ms}).join(", ")},wallMs:null},this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}})})},r.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},r.prototype.startTimer=function(){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?this.gpgpu.beginQuery():{startMs:performance.now(),endMs:null}},r.prototype.endTimer=function(e){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(this.gpgpu.endQuery(),e):(e.endMs=performance.now(),e)},r.prototype.getQueryTime=function(e){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(n){return be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?[2,this.gpgpu.waitForQueryAndGetTime(e)]:[2,(t=e).endMs-t.startMs]})})},r.prototype.disposeData=function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))this.pendingDisposal.add(e);else if(this.texData.has(e)){this.releaseGPUData(e);var t=this.texData.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.texData.delete(e)}}},r.prototype.releaseGPUData=function(e){var t=this.texData.get(e),n=t.texture,i=t.dtype,o=t.texShape,a=t.usage,s=t.isPacked,u=t.slice,l=u&&u.origDataId||e,c=this.dataRefCount.get(l);c>1?this.dataRefCount.set(l,c-1):(this.dataRefCount.delete(l),n!=null&&(this.numBytesInGPU-=this.computeBytes(o,i),this.textureManager.releaseTexture(n,o,a,s)));var h=this.texData.get(e);h.texture=null,h.texShape=null,h.isPacked=!1,h.slice=null},r.prototype.getTexture=function(e){return this.uploadToGPU(e),this.texData.get(e).texture},r.prototype.getCPUBackend=function(){return be.getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=ve.findBackend("cpu")),this.cpuBackend):null},r.prototype.shouldExecuteOnCPU=function(e,t){var n=this;return t===void 0&&(t=128),this.getCPUBackend()!=null&&e.every(function(i){return n.texData.get(i.dataId).texture==null&&i.size<t})},r.prototype.getGPGPUContext=function(){return this.gpgpu},r.prototype.complex=function(e,t){var n=this.makeOutputArray(e.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:ve.keep(e.clone()),imag:ve.keep(t.clone())},n},r.prototype.real=function(e){return this.texData.get(e.dataId).complexTensors.real.clone()},r.prototype.imag=function(e){return this.texData.get(e.dataId).complexTensors.imag.clone()},r.prototype.slice=function(e,t,n){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.slice(e,t,n);if(Pt(n)===0)return di([],n,e.dtype);var i=this.texData.get(e.dataId).isPacked,o=rT(e.shape,t,n);if(i||!o){var a=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LF(n):new OF(n),s=a.getCustomSetupFunc(t);return this.compileAndRun(a,[e],null,s)}return this.uploadToGPU(e.dataId),this.shallowSlice(e,t,n)},r.prototype.shallowSlice=function(e,t,n){var i=this.texData.get(e.dataId),o=at.make(n,{},e.dtype,this),a=this.texData.get(o.dataId);Object.assign(a,i),a.shape=n,a.dtype=e.dtype;var s=iT(t,e.strides);i.slice&&(s+=i.slice.flatOffset),a.slice={flatOffset:s,origDataId:i.slice&&i.slice.origDataId||e.dataId};var u=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,u+1),o},r.prototype.stridedSlice=function(e,t,n,i,o,a,s,u,l){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.stridedSlice(e,t,n,i,o,a,s,u,l);var c=Sw(e.shape,t,n,i,o,a,s,u,l),h=c[0],f=c[1],m=c[2],g=f.filter(function(v,y){return m.indexOf(y)===-1});if(g.some(function(v){return v===0}))return di([],g);var w=new BF(h,i,f,m);return this.compileAndRun(w,[e])},r.prototype.reverse=function(e,t){var n=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NF(e.shape,t):new DF(e.shape,t);return this.compileAndRun(n,[e])},r.prototype.concat=function(e,t){if(this.shouldExecuteOnCPU(e))return this.cpuBackend.concat(e,t);if(e.length===1)return e[0];if(e.length>be.getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(e.length/2),i=this.concat(e.slice(0,n),t),o=this.concat(e.slice(n),t);return this.concat([i,o],t)}if(be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].rank>1){var a=new EP(e.map(function(c){return c.shape}),t);return this.compileAndRun(a,e)}var s=Pc(e.map(function(c){return c.shape}),t),u=e.map(function(c){return c.as2D(-1,Pt(c.shape.slice(t)))}),l=new SP(u.map(function(c){return c.shape}));return this.compileAndRun(l,u).reshape(s)},r.prototype.neg=function(e){var t=new Zt(e.shape,"return -x;");return this.compileAndRun(t,[e])},r.prototype.batchMatMul=function(e,t,n,i){var o=n?e.shape[2]:e.shape[1],a=i?t.shape[1]:t.shape[2],s=n?e.shape[1]:e.shape[2],u=e.shape[0];if((o===1||a===1)&&s>1e3){n&&(e=e.transpose([0,2,1])),i&&(t=t.transpose([0,2,1]));var l=a===1?e:e.as3D(u,s,1),c=a===1?2:1,h=a===1?t.as3D(u,1,s):t;return this.multiply(l,h).sum(c,!0)}var f=or(e.dtype,t.dtype),m=new Ay(e.shape,[u,o,a],n,i),g=this.makePackedTensor(m.outputShape,f);return this.compileAndRun(m,[e,t],g)},r.prototype.fusedBatchMatMul=function(e,t,n,i,o,a){var s=n?e.shape[2]:e.shape[1],u=i?t.shape[1]:t.shape[2],l=e.shape[0],c=or(e.dtype,t.dtype),h=new Ay(e.shape,[l,s,u],n,i,!!o,a?(function(g,w){if(g==="linear")return w?KF:GF;if(g==="relu")return w?RS:MS;throw new Error("Activation "+g+" has not been implemented for the WebGL backend.")})(a,!0):null),f=this.makePackedTensor(h.outputShape,c),m=[e,t];return o&&m.push(o),this.compileAndRun(h,m,f)},r.prototype.multiply=function(e,t){if(e.dtype==="complex64"){var n=this.texData.get(e.dataId),i=this.texData.get(t.dataId),o=new wS(yP,e.shape,t.shape),a=new wS(bP,e.shape,t.shape),s=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag),this.makeComplexComponentTensorHandle(t,i.complexTensors.real),this.makeComplexComponentTensorHandle(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l);return u.dispose(),l.dispose(),c}if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.multiply(e,t);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,_S,e.dtype);var h=new jn(_S,e.shape,t.shape),f=this.makeOutputArray(h.outputShape,e.dtype);return this.compileAndRun(h,[e,t],f)},r.prototype.batchNormalization=function(e,t,n,i,o,a){var s=[e,t,n],u=null;a!=null&&(u=a.shape,s.push(a));var l=null;if(o!=null&&(l=o.shape,s.push(o)),be.getBool("WEBGL_PACK_NORMALIZATION")){var c=new vP(e.shape,t.shape,n.shape,u,l,i);return this.compileAndRun(c,s)}var h=new gP(e.shape,t.shape,n.shape,u,l,i);return this.compileAndRun(h,s)},r.prototype.localResponseNormalization4D=function(e,t,n,i,o){var a=be.getBool("WEBGL_PACK_NORMALIZATION")?new yF(e.shape,t,n,i,o):new gF(e.shape,t,n,i,o);return this.compileAndRun(a,[e])},r.prototype.LRNGrad=function(e,t,n,i,o,a,s){var u=new vF(t.shape,i,o,a,s);return this.compileAndRun(u,[t,n,e])},r.prototype.tile=function(e,t){if(e.dtype==="string")return lT(tn(e.shape,e.dtype,this.readSync(e.dataId)),t);var n=new zF(e.shape,t);return this.compileAndRun(n,[e])},r.prototype.pad=function(e,t,n){var i=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new EF(e.shape,t,n):new SF(e.shape,t,n);return this.compileAndRun(i,[e])},r.prototype.transpose=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.transpose(e,t);var n=be.getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HF(e.shape,t):new WF(e.shape,t);return this.compileAndRun(n,[e])},r.prototype.gather=function(e,t,n){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.gather(e,t,n);var i=new YP(e.shape,t.size,n);return this.compileAndRun(i,[e,t])},r.prototype.batchToSpaceND=function(e,t,n){te(e.rank<=4,function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(c,h){return c*h}),o=fm(e.shape,t,i),a=pm(o.length,t.length),s=mm(e.shape,t,i),u=QC(n,t.length),l=eT(s,n,t.length);return e.reshape(o).transpose(a).reshape(s).slice(u,l)},r.prototype.spaceToBatchND=function(e,t,n){te(e.rank<=4,function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"});var i=t.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var s=e.pad(o),u=fm(s.shape,t,i,!1),l=pm(u.length,t.length,!1),c=mm(s.shape,t,i,!1);return s.reshape(u).transpose(l).reshape(c)},r.prototype.reduce=function(e,t,n){var i=e.shape[0],o=e.shape[1],a=Ey(o),s=new kF({windowSize:a,inSize:o,batchSize:i},t),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],n);return this.compileAndRun(s,[e],h),h.shape[1]===1?h:this.reduce(h,t,n)},r.prototype.argReduce=function(e,t,n){n===void 0&&(n=null);var i=e.shape[0],o=e.shape[1];n!=null&&(i=n.shape[0],o=n.shape[1]);var a=Ey(o),s=new uP({windowSize:a,inSize:o,batchSize:i},t,n==null),u=s.outputShape,l=u[0],c=u[1],h=this.makeOutputArray([l,c],"int32"),f=[e];return n!=null&&f.push(n),this.compileAndRun(s,f,h),h.shape[1]===1?h:this.argReduce(e,t,h)},r.prototype.argReducePacked=function(e,t,n){n===void 0&&(n=null);var i=n!=null?n.shape:e.shape,o=Ey(i[i.length-1]),a=new pP(i,o,t,n==null),s=this.makePackedTensor(a.outputShape,"int32"),u=n==null?[e]:[e,n];return this.compileAndRun(a,u,s),s.rank===e.rank?this.argReducePacked(e,t,s):s},r.prototype.sum=function(e,t){Ii("sum",t,e.rank);var n=Lr(e.shape,t),i=n[0],o=Pt(n[1]),a=e.as2D(-1,o),s=gy(e.dtype);return this.reduce(a,"sum",s).reshape(i)},r.prototype.prod=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.prod(e,t);var n=Lr(e.shape,t),i=n[0],o=Pt(n[1]),a=e.as2D(-1,o),s=gy(e.dtype);return this.reduce(a,"prod",s).reshape(i)},r.prototype.unsortedSegmentSum=function(e,t,n){var i=0,o=va([i],e.rank),a=e;o!=null&&(a=e.transpose(o),i=ya(1,e.rank)[0]);var s=(function(f,m,g){for(var w=[],v=f.length,y=0;y<v;y++)y!==m?w.push(f[y]):w.push(g);return w})(a.shape,i,n),u=Pt([a.shape[i]]),l=a.as2D(-1,u),c=gy(e.dtype),h=this.segOpCompute(l,"unsortedSegmentSum",t,c,n).reshape(s);return o!=null&&(h=h.transpose(bw(o))),h},r.prototype.segOpCompute=function(e,t,n,i,o){var a=e.shape[0],s=e.shape[1],u=(function(g,w){var v,y=!1;for(g<=nT?(v=g,y=!0):v=q0(g,Math.floor(Math.sqrt(g)));!y;)v>w||v===g?y=!0:v=q0(g,v+1);return v})(s,o),l=new PF({windowSize:u,inSize:s,batchSize:a,numSegments:o},t),c=l.outputShape,h=c[0],f=c[1],m=this.makeOutputArray([h,f],i);return this.compileAndRun(l,[e,n],m),m.shape[1]===o?m:(n=jC(0,o).tile([s/u]),this.segOpCompute(m,t,n,i,o))},r.prototype.argMinMaxReduce=function(e,t,n){var i=[t];if(Ii("arg"+n.charAt(0).toUpperCase()+n.slice(1),i,e.rank),!be.getBool("WEBGL_PACK_REDUCE")||e.rank<=2){var o=Lr(e.shape,i),a=o[0],s=Pt(o[1]),u=e.as2D(-1,s);return this.argReduce(u,n).reshape(a)}return this.argReducePacked(e,n)},r.prototype.argMin=function(e,t){return this.argMinMaxReduce(e,t,"min")},r.prototype.argMax=function(e,t){return this.argMinMaxReduce(e,t,"max")},r.prototype.cumsum=function(e,t,n,i){if(t!==e.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(e.rank-1)+" but got axis="+t);var o=new OP(e.shape,n,i);return this.compileAndRun(o,[e])},r.prototype.equal=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(equal(a, b));
`,"bool");var n=new jn("return float(a == b);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.notEqual=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(notEqual(a, b));
`,"bool");var n=new jn("return float(a != b);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.less=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.less(e,t);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThan(a, b));
`,"bool");var n=new jn("return float(a < b);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.lessEqual=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(lessThanEqual(a, b));
`,"bool");var n=new jn("return float(a <= b);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.greater=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.greater(e,t);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThan(a, b));
`,"bool");var n=new jn("return float(a > b);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.greaterEqual=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var n=new jn("return float(a >= b);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.logicalNot=function(e){var t=new Zt(e.shape,"return float(!(x >= 1.0));");return this.compileAndRun(t,[e])},r.prototype.logicalAnd=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var n=new jn("return float(a >= 1.0 && b >= 1.0);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.logicalOr=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var n=new jn("return float(a >= 1.0 || b >= 1.0);",e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"bool");return this.compileAndRun(n,[e,t],i)},r.prototype.select=function(e,t,n){var i=new FF(e.rank,t.shape,t.rank),o=this.makeOutputArray(i.outputShape,or(t.dtype,n.dtype));return this.compileAndRun(i,[e,t,n],o)},r.prototype.where=function(e){J0("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return kw(e.shape,t)},r.prototype.topk=function(e,t,n){return cT(e.dataSync(),e.shape,e.dtype,t)},r.prototype.min=function(e,t){Ii("min",t,e.rank);var n=Lr(e.shape,t),i=n[0],o=Pt(n[1]),a=e.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(i)},r.prototype.minimum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.minimum(e,t);var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.mod=function(e,t){var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`if (b == 0.0) return NAN;
  return mod(a, b);`,e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.max=function(e,t){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.max(e,t);Ii("max",t,e.rank);var n=Lr(e.shape,t),i=n[0],o=Pt(n[1]),a=e.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(i)},r.prototype.maximum=function(e,t){if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.maximum(e,t);var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.all=function(e,t){Ii("all",t,e.rank);var n=Lr(e.shape,t),i=n[0],o=Pt(n[1]),a=e.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(i)},r.prototype.any=function(e,t){Ii("any",t,e.rank);var n=Lr(e.shape,t),i=n[0],o=Pt(n[1]),a=e.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(i)},r.prototype.squaredDifference=function(e,t){var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra("return (a - b) * (a - b);",e.shape,t.shape):new jn("return (a - b) * (a - b);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.realDivide=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(b.x == 0.0) {
    result.x = NAN;
  } else if(a.x == b.x) {
    result.x = 1.;
  }
  if(b.y == 0.0) {
    result.y = NAN;
  } else if(a.y == b.y) {
    result.y = 1.;
  }
  if(b.z == 0.0) {
    result.z = NAN;
  } else if(a.z == b.z) {
    result.z = 1.;
  }
  if(b.w == 0.0) {
    result.w = NAN;
  } else if(a.w == b.w) {
    result.w = 1.;
  }
  
  return result;
`,"float32",!0);var n=new jn(`
if (b == 0.0) {
  return NAN;
} 
if (a == b) {
  return 1.0;
};
return a / b;`,e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e,t],i)},r.prototype.floorDiv=function(e,t){if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var n=new jn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,e.shape,t.shape),i=this.makeOutputArray(n.outputShape,"int32");return this.compileAndRun(n,[e,t],i)},r.prototype.add=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,Cy);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.add(e,t);var n=or(e.dtype,t.dtype);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Cy,n);var i=new jn(Cy,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,n);return this.compileAndRun(i,[e,t],o)},r.prototype.packedBinaryOp=function(e,t,n,i,o){o===void 0&&(o=!1);var a=new Ra(n,e.shape,t.shape,o),s=this.makePackedTensor(a.outputShape,i);return this.compileAndRun(a,[e,t],s)},r.prototype.complexSeparableBinaryOp=function(e,t,n){var i=this,o=this.texData.get(e.dataId),a=this.texData.get(t.dataId),s=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map(function(h){var f=h[0],m=h[1],g=i.makeComplexComponentTensorHandle(e,f),w=i.makeComplexComponentTensorHandle(t,m),v=new jn(n,e.shape,t.shape),y=i.makeOutputArray(v.outputShape,or(f.dtype,m.dtype));return i.compileAndRun(v,[g,w],y)}),u=s[0],l=s[1],c=this.complex(u,l);return u.dispose(),l.dispose(),c},r.prototype.makeComplexComponentTensorHandle=function(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}},r.prototype.addN=function(e){if(e.length===1)return e[0];if(e.length>be.get("WEBGL_MAX_TEXTURES_IN_SHADER")){var t=Math.floor(e.length/2),n=this.addN(e.slice(0,t)),i=this.addN(e.slice(t));return this.addN([n,i])}var o=e.map(function(c){return c.dtype}).reduce(function(c,h){return or(c,h)}),a=e.map(function(c){return c.shape}),s=be.getBool("WEBGL_PACK"),u=s?new sP(e[0].shape,a):new aP(e[0].shape,a),l=s?this.makePackedTensor(u.outputShape,o):this.makeOutputArray(u.outputShape,o);return this.compileAndRun(u,e,l)},r.prototype.subtract=function(e,t){if(e.dtype==="complex64"&&t.dtype==="complex64")return this.complexSeparableBinaryOp(e,t,Ty);if(this.shouldExecuteOnCPU([e,t]))return this.cpuBackend.subtract(e,t);var n=or(e.dtype,t.dtype);if(be.getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(e,t,Ty,e.dtype);var i=new jn(Ty,e.shape,t.shape),o=this.makeOutputArray(i.outputShape,n);return this.compileAndRun(i,[e,t],o)},r.prototype.pow=function(e,t){var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=n?new Ra(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,e.shape,t.shape),o=or(e.dtype,t.dtype),a=n?this.makePackedTensor(i.outputShape,o):this.makeOutputArray(i.outputShape,o);return this.compileAndRun(i,[e,t],a)},r.prototype.ceil=function(e){var t=new Zt(e.shape,"return ceil(x);");return this.compileAndRun(t,[e])},r.prototype.floor=function(e){var t=new Zt(e.shape,"return floor(x);");return this.compileAndRun(t,[e])},r.prototype.sign=function(e){var t=new Zt(e.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(t,[e])},r.prototype.isNaN=function(e){var t=new Zt(e.shape,"return float(isnan(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},r.prototype.isInf=function(e){var t=new Zt(e.shape,"return float(isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},r.prototype.isFinite=function(e){var t=new Zt(e.shape,"return float(!isnan(x) && !isinf(x));"),n=this.makeOutputArray(t.outputShape,"bool");return this.compileAndRun(t,[e],n)},r.prototype.round=function(e){var t=new Zt(e.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(t,[e])},r.prototype.exp=function(e){var t;return t=be.getBool("WEBGL_PACK")?new Dy(e.shape,AS):new Zt(e.shape,AS),this.compileAndRun(t,[e])},r.prototype.expm1=function(e){var t=new Zt(e.shape,"return exp(x) - 1.0;");return this.compileAndRun(t,[e])},r.prototype.log=function(e){var t;return t=be.getBool("WEBGL_PACK")?new Dy(e.shape,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`):new Zt(e.shape,`if (x < 0.0) return NAN;
  return log(x);`),this.compileAndRun(t,[e])},r.prototype.log1p=function(e){var t=new Zt(e.shape,"return log(1.0 + x);");return this.compileAndRun(t,[e])},r.prototype.sqrt=function(e){var t=new Zt(e.shape,"return sqrt(x);");return this.compileAndRun(t,[e])},r.prototype.rsqrt=function(e){if(this.shouldExecuteOnCPU([e]))return this.cpuBackend.rsqrt(e);var t=new Zt(e.shape,"return inversesqrt(x);");return this.compileAndRun(t,[e])},r.prototype.square=function(e){var t=new Zt(e.shape,"return x * x;");return this.compileAndRun(t,[e])},r.prototype.reciprocal=function(e){var t=new Zt(e.shape,"return 1.0 / x;");return this.compileAndRun(t,[e])},r.prototype.relu=function(e){var t;return t=be.getBool("WEBGL_PACK")?new Dy(e.shape,RS):new Zt(e.shape,MS),this.compileAndRun(t,[e])},r.prototype.prelu=function(e,t){var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra(`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,e.shape,t.shape):new jn("return (a < 0.) ? b * a : a;",e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.elu=function(e){var t=new Zt(e.shape,"return (x >= 0.0) ? x : (exp(x) - 1.0);");return this.compileAndRun(t,[e])},r.prototype.eluDer=function(e,t){var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,e.shape,t.shape):new jn("return (b >= 1.0) ? a : a * (b + 1.0);",e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.selu=function(e){var t=new Zt(e.shape,VF);return this.compileAndRun(t,[e])},r.prototype.int=function(e){var t=new Zt(e.shape,"return float(int(x));"),n=this.makeOutputArray(t.outputShape,"int32");return this.compileAndRun(t,[e],n)},r.prototype.clip=function(e,t,n){var i,o=(i=be.getBool("WEBGL_PACK_CLIP")?new _P(e.shape):new wP(e.shape)).getCustomSetupFunc(t,n);return this.compileAndRun(i,[e],null,o)},r.prototype.abs=function(e){var t=new Zt(e.shape,"return abs(x);");return this.compileAndRun(t,[e])},r.prototype.complexAbs=function(e){var t=this.texData.get(e.dataId),n=new xP(e.shape),i=[this.makeComplexComponentTensorHandle(e,t.complexTensors.real),this.makeComplexComponentTensorHandle(e,t.complexTensors.imag)];return this.compileAndRun(n,i)},r.prototype.sigmoid=function(e){var t=new Zt(e.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(t,[e])},r.prototype.softplus=function(e){var t=new Zt(e.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(t,[e])},r.prototype.sin=function(e){var t=new Zt(e.shape,jF);return this.compileAndRun(t,[e])},r.prototype.cos=function(e){var t=new Zt(e.shape,qF);return this.compileAndRun(t,[e])},r.prototype.tan=function(e){var t=new Zt(e.shape,"return tan(x);");return this.compileAndRun(t,[e])},r.prototype.asin=function(e){var t=new Zt(e.shape,"return asin(x);");return this.compileAndRun(t,[e])},r.prototype.acos=function(e){var t=new Zt(e.shape,"return acos(x);");return this.compileAndRun(t,[e])},r.prototype.atan=function(e){var t=new Zt(e.shape,$F);return this.compileAndRun(t,[e])},r.prototype.atan2=function(e,t){var n=be.getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ra(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,e.shape,t.shape):new jn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,e.shape,t.shape);return this.compileAndRun(n,[e,t])},r.prototype.sinh=function(e){var t=new Zt(e.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},r.prototype.cosh=function(e){var t=new Zt(e.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(t,[e])},r.prototype.tanh=function(e){var t=new Zt(e.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(t,[e])},r.prototype.asinh=function(e){var t=new Zt(e.shape,"return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(t,[e])},r.prototype.acosh=function(e){var t=new Zt(e.shape,XF);return this.compileAndRun(t,[e])},r.prototype.atanh=function(e){var t=new Zt(e.shape,YF);return this.compileAndRun(t,[e])},r.prototype.erf=function(e){var t=new Zt(e.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float t = 1.0 / (1.0 + p * x);
  return 1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x);
`);return this.compileAndRun(t,[e])},r.prototype.step=function(e,t){var n=new Zt(e.shape,(function(i){return i===void 0&&(i=0),sl+`
    return x > 0.0 ? 1.0 : float(`+i+`);
  `})(t));return this.compileAndRun(n,[e])},r.prototype.conv2dByMatMul=function(e,t,n){var i=e.shape,o=this.texData.get(e.dataId),a=n.inChannels,s=i[0]*i[1]*i[2],u=n.outChannels,l=(s===1||u===1)&&a>1e3,c=i[2]%2!=0&&!!o.isPacked;if(l||!be.getBool("WEBGL_LAZILY_UNPACK")||!be.getBool("WEBGL_PACK_BINARY_OPERATIONS")||!c){var h=this.reshape(e,[1,i[0]*i[1]*i[2],n.inChannels]),f=this.reshape(t,[1,n.inChannels,n.outChannels]);return this.reshape(this.batchMatMul(h,f,!1,!1),n.outShape)}var m=at.make([1,i[0]*i[1]*(i[2]+1),n.inChannels],{dataId:e.dataId},e.dtype,this),g=o.shape;o.shape=o.shape.slice(),o.shape[o.shape.length-2]++,te(ap(o.shape,m.shape),function(){return"packed reshape "+o.shape+" to "+m.shape+" isn't free"});var w=this.reshape(t,[1,n.inChannels,n.outChannels]),v=this.batchMatMul(m,w,!1,!1),y=this.texData.get(v.dataId);return te(y.isPacked,function(){return"batchMatMul result is expected to be packed"}),o.shape=g,y.shape=n.outShape,at.make(n.outShape,{dataId:v.dataId},v.dtype,this)},r.prototype.conv2dWithIm2Row=function(e,t,n){var i=n.filterWidth,o=n.filterHeight,a=n.inChannels,s=n.outWidth,u=n.outHeight,l=i*o*a,c=u*s,h=[l,c],f=e.squeeze([0]),m=t.reshape([1,l,-1]),g=new mF(h,f.shape,n),w=this.compileAndRun(g,[f]).reshape([1,h[0],h[1]]),v=new Ay(w.shape,[1,c,n.outChannels],!0,!1);return this.compileAndRun(v,[w,m]).reshape([1,u,s,n.outChannels])},r.prototype.conv2d=function(e,t,n){if(n.filterHeight===1&&n.filterWidth===1&&n.dilationHeight===1&&n.dilationWidth===1&&n.strideHeight===1&&n.strideWidth===1&&(n.padInfo.type==="SAME"||n.padInfo.type==="VALID"))return this.conv2dByMatMul(e,t,n);if(be.getBool("WEBGL_CONV_IM2COL")&&e.shape[0]===1)return this.conv2dWithIm2Row(e,t,n);var i=new IP(n);return this.compileAndRun(i,[e,t])},r.prototype.conv2dDerInput=function(e,t,n){var i=new CP(n);return this.compileAndRun(i,[e,t])},r.prototype.conv2dDerFilter=function(e,t,n){var i=new kP(n);return this.compileAndRun(i,[e,t])},r.prototype.depthwiseConv2D=function(e,t,n){var i;return be.getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(i=new PP(n),this.compileAndRun(i,[e,t],this.makePackedTensor(n.outShape,e.dtype))):(i=new NP(n),this.compileAndRun(i,[e,t]))},r.prototype.depthwiseConv2DDerInput=function(e,t,n){var i=new RP(n);return this.compileAndRun(i,[e,t])},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){var i=new AP(n);return this.compileAndRun(i,[e,t])},r.prototype.conv3d=function(e,t,n){var i=new DP(n);return this.compileAndRun(i,[e,t])},r.prototype.conv3dDerInput=function(e,t,n){var i=new MP(n);return this.compileAndRun(i,[e,t])},r.prototype.conv3dDerFilter=function(e,t,n){var i=new TP(n);return this.compileAndRun(i,[e,t])},r.prototype.maxPool=function(e,t){var n=new Ry(t,"max",!1),i=this.makeOutputArray(n.outputShape,e.dtype);return this.compileAndRun(n,[e],i)},r.prototype.avgPool=function(e,t){var n=new Ry(t,"avg",!1),i=this.makeOutputArray(n.outputShape,"float32");return this.compileAndRun(n,[e],i)},r.prototype.maxPoolBackprop=function(e,t,n,i){var o=new Ry(i,"max",!0),a=this.compileAndRun(o,[t]),s=new bF(i),u=this.makeOutputArray(s.outputShape,t.dtype),l=this.compileAndRun(s,[e,a],u);return a.dispose(),l},r.prototype.avgPoolBackprop=function(e,t,n){var i=new mP(n),o=this.makeOutputArray(i.outputShape,t.dtype);return this.compileAndRun(i,[e],o)},r.prototype.cast=function(e,t){return aT(e,t,this)},r.prototype.unstack=function(e,t){for(var n=e.shape[t],i=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(i[o++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(n);for(a=0;a<l.length;a++)s[t]=a,l[a]=this.slice(e,s,u).reshape(i);return l},r.prototype.reshape=function(e,t){var n=this.texData.get(e.dataId);return!n.isPacked||ap(e.shape,t)||n.texture!==null&&ap(n.shape,t)?Q0(e,t):this.packedReshape(e,t)},r.prototype.resizeBilinear=function(e,t,n,i){var o=be.getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new AF(e.shape,t,n,i):new MF(e.shape,t,n,i);return this.compileAndRun(o,[e])},r.prototype.resizeBilinearBackprop=function(e,t,n){var i=new TF(e,t,n);return this.compileAndRun(i,[e])},r.prototype.resizeNearestNeighbor=function(e,t,n,i){var o=new IF(e.shape,t,n,i);return this.compileAndRun(o,[e])},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){var i=new RF(e,t,n);return this.compileAndRun(i,[e])},r.prototype.multinomial=function(e,t,n,i){var o=t?e:su(e),a=o.shape[0],s=o.shape[1],u=new wF(a,s,n),l=this.makeOutputArray(u.outputShape,"int32"),c=u.getCustomSetupFunc(i);return this.compileAndRun(u,[o],l,c)},r.prototype.oneHot=function(e,t,n,i){var o=new _F(e.size,t,n,i);return this.compileAndRun(o,[e])},r.prototype.nonMaxSuppression=function(e,t,n,i,o){return J0("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Ew(e.dataSync(),t.dataSync(),n,i,o)},r.prototype.cropAndResize=function(e,t,n,i,o,a){var s=new FP(e.shape,t.shape,i,o,a);return this.compileAndRun(s,[e,t,n])},r.prototype.depthToSpace=function(e,t,n){te(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});var i=e.shape[0],o=n==="NHWC"?e.shape[1]:e.shape[2],a=n==="NHWC"?e.shape[2]:e.shape[3],s=n==="NHWC"?e.shape[3]:e.shape[1],u=o*t,l=a*t,c=s/(t*t),h=new UP(n==="NHWC"?[i,u,l,c]:[i,c,u,l],t,n);return this.compileAndRun(h,[e])},r.prototype.split=function(e,t,n){return uT(e,t,n)},r.prototype.scatterND=function(e,t,n){var i=gm(0,e,n),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=[l/s,s],h=e.reshape([a,o]),f=t.reshape([a,s]);if(l===0)return Q0(di([]),n);var m=dt(0),g=new kS(a,o,h.rank,f.rank,u,c);return this.compileAndRun(g,[f,h,m]).reshape(n)},r.prototype.sparseToDense=function(e,t,n,i){var o=gm(0,e,n),a=o.sliceRank,s=o.numUpdates,u=o.strides,l=o.outputSize,c=new kS(s,a,e.rank,t.rank,u,[l,1],!1);return this.compileAndRun(c,[t,e,i]).reshape(n)},r.prototype.fft=function(e){return this.fftImpl(e,!1)},r.prototype.ifft=function(e){return this.fftImpl(e,!0)},r.prototype.fftImpl=function(e,t){var n=this.texData.get(e.dataId),i=new SS(VP,e.shape,t),o=new SS(jP,e.shape,t),a=[this.makeComplexComponentTensorHandle(e,n.complexTensors.real),this.makeComplexComponentTensorHandle(e,n.complexTensors.imag)],s=this.compileAndRun(i,a),u=this.compileAndRun(o,a),l=this.complex(s,u).as2D(e.shape[0],e.shape[1]);return s.dispose(),u.dispose(),l},r.prototype.gatherND=function(e,t){var n=t.shape,i=n[n.length-1],o=tT(e,t),a=o[0],s=o[1],u=o[2],l=o[3],c=t.reshape([s,i]),h=e.reshape([e.size/u,u]),f=new KP(i,l,[s,u]);return this.compileAndRun(f,[h,c]).reshape(a)},r.prototype.fill=function(e,t,n){if((n=n||fd(t))==="string"){var i=um(n,Pt(e));return i.fill(t),at.make(e,{values:i},n)}var o=new qP(e,t),a=o.getCustomSetupFunc(t),s=this.makeOutputArray(e,n);return this.compileAndRun(o,[],s,a)},r.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(e.shape,1,e.dtype)},r.prototype.zerosLike=function(e){return this.fill(e.shape,e.dtype==="string"?"":0,e.dtype)},r.prototype.linspace=function(e,t,n){return sT(e,t,n)},r.prototype.makeOutputArray=function(e,t){return at.make(e,{},t,this)},r.prototype.makePackedTensor=function(e,t){var n=at.make(e,{},t,this);return this.texData.get(n.dataId).isPacked=!0,n},r.prototype.unpackTensor=function(e){var t=new JF(e.shape);return this.compileAndRun(t,[e],at.make(t.outputShape,{},e.dtype,this))},r.prototype.packTensor=function(e){var t=new xF(e.shape);return this.compileAndRun(t,[e],this.makePackedTensor(e.shape,e.dtype),null,!0)},r.prototype.packedReshape=function(e,t){var n=e.reshape([cm(e.shape)].concat(hm(e.shape))),i=[cm(t)].concat(hm(t)),o=new CF(i,n.shape);return this.compileAndRun(o,[n]).reshape(t)},r.prototype.decode=function(e){var t,n=this.texData.get(e),i=n.isPacked,o=n.shape,a=n.dtype,s=Sy(o),u=My(o),l=this.makeTensorHandle(o,"float32");return this.texData.get(l.dataId).isPacked=!0,this.texData.get(l.dataId).dtype=a,this.texData.get(l.dataId).texShape=u.map(function(c){return 2*c}),t=i?new BP(s,u):new LP(s,u),this.compileAndRun(t,[{shape:s,dtype:a,dataId:e}],l,null,!0),l},r.prototype.compileAndRun=function(e,t,n,i,o){var a=this;if(o===void 0&&(o=!1),n==null&&(n=e.usesPackedTextures?this.makePackedTensor(e.outputShape,t[0].dtype):this.makeOutputArray(e.outputShape,t[0].dtype)),n.size===0)return this.texData.get(n.dataId).values=V0(n.dtype,0),n;var s=t.map(function(m){if(m.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var g=a.texData.get(m.dataId);if(g.texture==null){if(!e.usesPackedTextures&&Pt(m.shape)<=be.getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:m.shape,texData:null,isUniform:!0,uniformValues:g.values};e.usesPackedTextures&&(g.isPacked=!0,g.shape=m.shape)}else if(!!g.isPacked!=!!e.usesPackedTextures)m=g.isPacked?a.unpackTensor(m):a.packTensor(m),g=a.texData.get(m.dataId);else if(g.isPacked&&!ap(g.shape,m.shape)){var w=m,v=m.shape;m.shape=g.shape,m=a.packedReshape(m,v),g=a.texData.get(m.dataId),w.shape=v}return a.uploadToGPU(m.dataId),{shape:m.shape,texData:g,isUniform:!1}});this.uploadToGPU(n.dataId);var u,l={shape:n.shape,texData:this.texData.get(n.dataId),isUniform:!1},c=(function(m,g,w){var v="";g.concat(w).forEach(function(E){var _=E.texData!=null&&E.texData.slice!=null&&E.texData.slice.flatOffset>0,k=E.isUniform?"uniform":E.texData.texShape;v+=E.shape+"_"+k+"_"+_});var y=m.userCode,x=m.constructor.name;return x+="_"+v+"_"+y})(e,s,l),h=this.getAndSaveBinary(c,function(){return(function(m,g,w,v){var y=g.userCode,x=w.map(function(O,V){var F={logicalShape:O.shape,texShape:O.isUniform?null:O.texData.texShape,isUniform:O.isUniform,isPacked:!O.isUniform&&O.texData.isPacked,flatOffset:null};return O.texData!=null&&O.texData.slice!=null&&O.texData.slice.flatOffset>0&&(F.flatOffset=O.texData.slice.flatOffset),{name:g.variableNames[V],shapeInfo:F}}),E=x.map(function(O){return O.shapeInfo}),_={logicalShape:v.shape,texShape:v.texData.texShape,isUniform:!1,isPacked:v.texData.isPacked,flatOffset:null},k=lP(x,_,y,g.usesPackedTextures),C=m.createProgram(k),R=null,I=m.getUniformLocation(C,"NAN",!1);be.getNumber("WEBGL_VERSION")===1&&(R=m.getUniformLocation(C,"INFINITY",!1));for(var T={},A=0;A<g.variableNames.length;A++){var N=g.variableNames[A];T[N]=m.getUniformLocation(C,N,!1),T["offset"+N]=m.getUniformLocation(C,"offset"+N,!1)}return{program:g,source:k,webGLProgram:C,uniformLocations:T,inShapeInfos:E,outShapeInfo:_,infLoc:R,nanLoc:I}})(a.gpgpu,e,s,l)}),f=this.activeTimers!=null;return f&&(u=this.startTimer()),(function(m,g,w,v,y){ES(g.inShapeInfos,w),ES([g.outShapeInfo],[v]);var x=v.texData.texture,E=v.texData.texShape;v.texData.isPacked?m.setOutputPackedMatrixTexture(x,E[0],E[1]):m.setOutputMatrixTexture(x,E[0],E[1]),m.setProgram(g.webGLProgram),be.getNumber("WEBGL_VERSION")===1&&g.infLoc!==null&&m.gl.uniform1f(g.infLoc,1/0),g.nanLoc!==null&&m.gl.uniform1f(g.nanLoc,NaN),w.forEach(function(_,k){var C=g.program.variableNames[k],R=g.uniformLocations[C],I=g.uniformLocations["offset"+C];if(R!=null)if(_.isUniform)if(Pt(_.shape)<2)m.gl.uniform1f(R,_.uniformValues[0]);else{var T=_.uniformValues;T instanceof Float32Array||(T=new Float32Array(T)),m.gl.uniform1fv(R,T)}else _.texData.slice!=null&&I!=null&&m.gl.uniform1i(I,_.texData.slice.flatOffset),m.setInputMatrixTexture(_.texData.texture,R,k)}),y?.(m,g.webGLProgram),m.executeProgram()})(this.gpgpu,h,s,l,i),f&&(u=this.endTimer(u),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(u)})),!be.getBool("WEBGL_LAZILY_UNPACK")&&this.texData.get(n.dataId).isPacked&&o===!1?this.unpackTensor(n):n},r.prototype.getAndSaveBinary=function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]},r.prototype.getTextureManager=function(){return this.textureManager},r.prototype.dispose=function(){this.disposed||(this.textureManager.dispose(),this.canvas!=null&&this.canvas.remove!=null?this.canvas.remove():this.canvas=null,this.fromPixels2DContext!=null&&this.fromPixels2DContext.canvas.remove!=null&&this.fromPixels2DContext.canvas.remove(),this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},r.prototype.floatPrecision=function(){var e=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=Rt(function(){var t=be.getBool("DEBUG");be.set("DEBUG",!1);var n=e.abs(dt(1e-8)).dataSync()[0];return be.set("DEBUG",t),n>0?32:16})),this.floatPrecisionValue},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.uploadToGPU=function(e){var t,n=this.texData.get(e),i=n.shape,o=n.dtype,a=n.values,s=n.texture,u=n.usage,l=n.isPacked;if(s==null){var c,h=this.activeTimers!=null;h&&(c=performance.now());var f=n.texShape;if(f==null&&(f=fN(i,l),n.texShape=f),a!=null){var m=Sy(i),g=void 0,w=f[1],v=f[0],y=a instanceof Uint8Array;l?(w=(t=wd(f[0],f[1]))[0],v=t[1],g=new GP(m,[v,w],y)):g=new HP(m,[v,w],y);var x=this.makeTensorHandle([v,w],o);this.texData.get(x.dataId).usage=y?Ro.PIXELS:Ro.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),w,v,a);var E=this.makeTensorHandle(g.outputShape,x.dtype);E.size=Pt(g.outputShape),this.texData.get(E.dataId).isPacked=l,this.compileAndRun(g,[x],E);var _=this.texData.get(E.dataId);n.texture=_.texture,n.texShape=_.texShape,n.isPacked=_.isPacked,n.usage=_.usage,this.disposeData(x.dataId),this.texData.delete(E.dataId),n.values=null,h&&(this.uploadWaitMs+=performance.now()-c)}else{var k=this.acquireTexture(f,u,o,l);n.texture=k}}},r.prototype.convertAndCacheOnCPU=function(e,t){var n=this.texData.get(e),i=n.dtype;return this.releaseGPUData(e),t!=null&&(n.values=(function(o,a){if(a==="float32"||a==="complex64")return o;if(a==="int32"||a==="bool"){for(var s=a==="int32"?new Int32Array(o.length):new Uint8Array(o.length),u=0;u<s.length;++u)s[u]=Math.round(o[u]);return s}throw new Error("Unknown dtype "+a)})(t,i)),n.values},r.prototype.acquireTexture=function(e,t,n,i){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,i)},r.prototype.computeBytes=function(e,t){return e[0]*e[1]*DC(t)},r})();WC()&&ve.registerBackend("webgl",function(){return new QF},2);var e5=ue({abs_:function(r){var e=J(r,"x","abs");return e.dtype==="complex64"?ve.runKernel(function(t){return t.complexAbs(e)},{$x:e}):ve.runKernel(function(t,n){var i=t.abs(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.toFloat().step(-1))}}})}}),t5=ue({acos_:function(r){var e=J(r,"x","acos");return ve.runKernel(function(t,n){var i=t.acos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(dt(1).sub(i.toFloat().square()).sqrt()).neg()}}})}}),n5=ue({acosh_:function(r){var e=J(r,"x","acosh");return ve.runKernel(function(t,n){var i=t.acosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}})}}),r5=ue({asin_:function(r){var e=J(r,"x","asin");return ve.runKernel(function(t,n){var i=t.asin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(dt(1).sub(i.toFloat().square()).sqrt())}}})}}),i5=ue({asinh_:function(r){var e=J(r,"x","asinh");return ve.runKernel(function(t,n){var i=t.asinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.divStrict(dt(1).add(i.toFloat().square()).sqrt())}}})}}),o5=ue({atan_:function(r){var e=J(r,"x","atan");return ve.runKernel(function(t,n){var i=t.atan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}})}}),a5=ue({atanh_:function(r){var e=J(r,"x","atanh");return ve.runKernel(function(t,n){var i=t.atanh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(dt(1).sub(i.toFloat().square()))}}})}}),s5=ue({ceil_:function(r){var e=J(r,"x","ceil");return ve.runKernel(function(t){return t.ceil(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),Aw=ue({clipByValue_:function(r,e,t){var n=J(r,"x","clipByValue");return te(e<=t,function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}),ve.runKernel(function(i,o){var a=i.clip(n,e,t);return o([n]),a},{$x:n},function(i,o){var a=o[0];return{$x:function(){return i.where(a.greaterEqual(e).logicalAnd(a.lessEqual(t)),pn(i))}}})}}),u5=ue({cos_:function(r){var e=J(r,"x","cos");return ve.runKernel(function(t,n){var i=t.cos(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sin().neg().mul(t)}}})}}),l5=ue({cosh_:function(r){var e=J(r,"x","cosh");return ve.runKernel(function(t,n){var i=t.cosh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}})}}),c5=ue({erf_:function(r){var e=J(r,"x","erf");return te(e.dtype==="int32"||e.dtype==="float32",function(){return"Input dtype must be `int32` or `float32`."}),e.dtype==="int32"&&(e=e.toFloat()),ve.runKernel(function(t,n){var i=t.erf(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}})}}),tb=ue({exp_:function(r){var e=J(r,"x","exp");return ve.runKernel(function(t,n){var i=t.exp(e);return n([i]),i},{$x:e},function(t,n){return{$x:function(){return t.mulStrict(n[0])}}})}}),h5=ue({expm1_:function(r){var e=J(r,"x","expm1");return ve.runKernel(function(t,n){var i=t.expm1(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.exp())}}})}}),d5=ue({floor_:function(r){var e=J(r,"x","floor");return ve.runKernel(function(t){return t.floor(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),f5=ue({log_:function(r){var e=J(r,"x","log");return ve.runKernel(function(t,n){var i=t.log(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat())}}})}}),p5=ue({log1p_:function(r){var e=J(r,"x","log1p");return ve.runKernel(function(t,n){var i=t.log1p(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.add(1))}}})}}),m5=ue({logSigmoid_:function(r){var e=J(r,"x","logSigmoid");return ve.runKernel(function(t,n){var i=t.softplus(e.neg()).neg();return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}})}}),bm=ue({neg_:function(r){var e=J(r,"x","neg");return ve.runKernel(function(t){return t.neg(e)},{$x:e},function(t){return{$x:function(){return t.neg()}}})}}),g5=ue({reciprocal_:function(r){var e=J(r,"x","reciprocal");return ve.runKernel(function(t,n){var i=t.reciprocal(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.square().neg())}}})}}),v5=ue({round_:function(r){var e=J(r,"x","round");return ve.runKernel(function(t){return t.round(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),pT=ue({rsqrt_:function(r){var e=J(r,"x","rsqrt");return ve.runKernel(function(t,n){var i=t.rsqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.pow(1.5).mul(2)).neg()}}})}}),mT=ue({sigmoid_:function(r){var e=J(r,"x","sigmoid");return ve.runKernel(function(t,n){var i=t.sigmoid(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.mul(dt(1).sub(i)))}}})}}),y5=ue({sign_:function(r){var e=J(r,"x","sign");return ve.runKernel(function(t){return t.sign(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),b5=ue({isNaN_:function(r){var e=J(r,"x","isNaN");return ve.runKernel(function(t){return t.isNaN(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),w5=ue({isInf_:function(r){var e=J(r,"x","isInf");return ve.runKernel(function(t){return t.isInf(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),_5=ue({isFinite_:function(r){var e=J(r,"x","isFinite");return ve.runKernel(function(t){return t.isFinite(e)},{$x:e},function(t){return{$x:function(){return pn(t)}}})}}),x5=ue({sin_:function(r){var e=J(r,"x","sin");return ve.runKernel(function(t,n){var i=t.sin(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cos().mul(t)}}})}}),S5=ue({sinh_:function(r){var e=J(r,"x","sinh");return ve.runKernel(function(t,n){var i=t.sinh(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}})}}),E5=ue({softplus_:function(r){var e=J(r,"x","softplus");return ve.runKernel(function(t,n){var i=t.softplus(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.sigmoid())}}})}}),k5=ue({sqrt_:function(r){var e=J(r,"x","sqrt");return ve.runKernel(function(t,n){var i=t.sqrt(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}})}}),C5=ue({square_:function(r){var e=J(r,"x","square");return ve.runKernel(function(t,n){return n([e]),t.square(e)},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mul(i.toFloat().mul(2))}}})}}),T5=ue({step_:function(r,e){e===void 0&&(e=0);var t=J(r,"x","step");return ve.runKernel(function(n){return n.step(t,e)},{$x:t},function(n){return{$x:function(){return pn(n)}}})}}),M5=ue({tan_:function(r){var e=J(r,"x","tan");return ve.runKernel(function(t,n){var i=t.tan(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.div(i.cos().square())}}})}}),A5=ue({tanh_:function(r){var e=J(r,"x","tanh");return ve.runKernel(function(t,n){var i=t.tanh(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return dt(1).sub(i.square()).mulStrict(t)}}})}});function gT(r,e,t,n,i,o){var a,s,u=J(r,"x","batchNorm"),l=J(e,"mean","batchNorm"),c=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),n!=null&&(s=J(n,"offset","batchNorm")),te(u.rank===2,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),te(l.rank===2||l.rank===1,function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."}),te(c.rank===2||c.rank===1,function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."}),a!=null&&te(a.rank===2||a.rank===1,function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."}),s!=null&&te(s.rank===2||s.rank===1,function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."}),xd(u,l,c,s,a,o)}function vT(r,e,t,n,i,o){var a,s,u=J(r,"x","batchNorm"),l=J(e,"mean","batchNorm"),c=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),n!=null&&(s=J(n,"offset","batchNorm")),te(u.rank===3,function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."}),te(l.rank===3||l.rank===1,function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."}),te(c.rank===3||c.rank===1,function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."}),a!=null&&te(a.rank===3||a.rank===1,function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."}),s!=null&&te(s.rank===3||s.rank===1,function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."}),xd(u,l,c,s,a,o)}function yT(r,e,t,n,i,o){var a,s,u=J(r,"x","batchNorm"),l=J(e,"mean","batchNorm"),c=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),n!=null&&(s=J(n,"offset","batchNorm")),te(u.rank===4,function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."}),te(l.rank===4||l.rank===1,function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."}),te(c.rank===4||c.rank===1,function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."}),a!=null&&te(a.rank===4||a.rank===1,function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."}),s!=null&&te(s.rank===4||s.rank===1,function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."}),xd(u,l,c,s,a,o)}function xd(r,e,t,n,i,o){o==null&&(o=.001);var a,s,u,l=J(r,"x","batchNorm"),c=J(e,"mean","batchNorm"),h=J(t,"variance","batchNorm");return i!=null&&(a=J(i,"scale","batchNorm")),n!=null&&(s=J(n,"offset","batchNorm")),te(c.rank===h.rank,function(){return"Batch normalization gradient requires mean and variance to have equal ranks."}),te(s==null||c.rank===s.rank,function(){return"Batch normalization gradient requires mean and offset to have equal ranks."}),te(a==null||c.rank===a.rank,function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}),u=l.rank===0||l.rank===1?l.as4D(1,1,1,l.size):l.rank===2?l.as4D(1,1,l.shape[0],l.shape[1]):l.rank===3?l.as4D(1,l.shape[0],l.shape[1],l.shape[2]):l,ve.runKernel(function(f,m){var g=f.batchNormalization(u,up(c),up(h),o,up(a),up(s));return m([l,c,h,a]),g},{$x:l,$mean:c,$variance:h,$scale:a,$offset:s},function(f,m){var g=m,w=g[0],v=g[1],y=g[2],x=g[3],E=x??dt(1),_=lr(v.shape,u.shape),k=[];if(v.rank===1){for(var C=0;C<u.shape.length-1;++C)k.push(u.shape[C]);k.push(1)}var R=w.sub(v),I=f.mul(E),T=pT(y.add(dt(o))),A=T.mul(T).mul(T).mul(dt(-.5));return{$x:function(){return v.rank===1?f.mul(bc(T.as4D(1,1,1,v.shape[0]),k)).mul(E).reshape(w.shape):f.mul(T).mul(E).reshape(w.shape)},$mean:function(){var N=T.mul(dt(-1)).mul(I);return v.rank===1&&(N=N.sum(_)),N.reshape(v.shape)},$variance:function(){var N=A.mul(R).mul(I);return v.rank===1&&(N=N.sum(_)),N.reshape(v.shape)},$scale:function(){var N=R.mul(T),O=f.mul(N);return v.rank===1&&(O=O.sum(_)),O.reshape(v.shape)},$offset:function(){var N=f;return v.rank===1&&(N=N.sum(_)),N.reshape(v.shape)}}}).reshape(l.shape)}function up(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function eg(){GC("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}var R5=ue({batchNormalization2d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),eg(),gT(r,e,t,o,i,n)}}),I5=ue({batchNormalization3d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),eg(),vT(r,e,t,o,i,n)}}),D5=ue({batchNormalization4d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),eg(),yT(r,e,t,o,i,n)}}),N5=ue({batchNormalization_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),eg(),xd(r,e,t,o,i,n)}}),bT=ue({batchNorm_:xd}),P5=ue({batchNorm2d_:gT}),F5=ue({batchNorm3d_:vT}),O5=ue({batchNorm4d_:yT});function wT(r,e,t,n,i,o){te(r.length===e.rank,function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"});var a=r,s=e,u=!1;e.rank===3&&(u=!0,s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),a=[1,r[0],r[1],r[2]]);var l=a[3],c=s.shape[3];te(a.length===4,function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+a.length+"."}),te(s.rank===4,function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+s.rank}),te(t.rank===4,function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}),te(l===t.shape[2],function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+t.shape[2]+"."}),te(c===t.shape[3],function(){return"Error in conv2dDerInput: depth of output ("+c+") must match output depth for filter "+t.shape[3]+"."}),o!=null&&te(ao(i),function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var h=bd(a,t.shape,n,1,i,o),f=ve.runKernel(function(m,g){var w=m.conv2dDerInput(s,t,h);return g([t,s]),w},{dy4D:s,filter:t},function(m,g){var w=g[0],v=g[1];return{dy4D:function(){return Qa(m,w,n,i,"NHWC",1,o)},filter:function(){return xT(m,v,w.shape,n,i,o)}}});return u?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}function _T(r,e,t,n,i,o){var a=r;r.rank===3&&(a=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var s=e;s.rank===3&&(s=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),te(a.rank===4,function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+a.shape+"."}),te(s.rank===4,function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+s.shape+"."}),te(t.length===4,function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}),te(a.shape[3]===t[2],function(){return"Error in conv2dDerFilter: depth of input "+a.shape[3]+") must match input depth in filter ("+t[2]+"."}),te(s.shape[3]===t[3],function(){return"Error in conv2dDerFilter: depth of dy ("+s.shape[3]+") must match output depth for filter ("+t[3]+")."}),o!=null&&te(ao(i),function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var u=bd(a.shape,t,n,1,i,o);return ve.runKernel(function(l){return l.conv2dDerFilter(a,s,u)},{x4D:a,dy4D:s})}function Ny(r){var e=(function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o})(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}var L5=ue({conv1d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=J(r,"x","conv1d"),u=J(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),te(l.rank===3,function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."}),te(u.rank===3,function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."}),a!=null&&te(ao(n),function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),te(l.shape[2]===u.shape[1],function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."}),te(Js(t,o),function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"}),te(i==="NWC",function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."});var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),m=Qa(f,h,[1,t],n,"NHWC",[1,o],a);return c?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),Qa=ue({conv2d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=J(r,"x","conv2d"),u=J(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),te(l.rank===4,function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."}),te(u.rank===4,function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."}),a!=null&&te(ao(n),function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}),te(l.shape[3]===u.shape[2],function(){return"Error in conv2d: depth of input ("+l.shape[3]+") must match input depth for filter "+u.shape[2]+"."}),te(Js(t,o),function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),te(i==="NHWC",function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."});var h=bd(l.shape,u.shape,t,o,n,a),f=ve.runKernel(function(m,g){var w=m.conv2d(l,u,h);return g([u,l]),w},{x:l,$filter:u},function(m,g){var w=g,v=w[0],y=w[1];return te(ym(o),function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}),{x:function(){return wT(y.shape,m,v,t,n)},$filter:function(){return _T(y,m,v.shape,t,n)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),B5=ue({conv3d_:function(r,e,t,n,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=J(r,"x","conv3d"),s=J(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),te(u.rank===5,function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."}),te(s.rank===5,function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."}),te(u.shape[4]===s.shape[3],function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."}),te((function(f,m){return Ny(f)||Ny(m)})(t,o),function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),te(i==="NDHWC",function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."});var c=ky(u.shape,s.shape,t,o,n),h=ve.runKernel(function(f,m){var g=f.conv3d(u,s,c);return m([u,s]),g},{x:u,$filter:s},function(f,m){te(Ny(o),function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"});var g=m[0],w=m[1];return{x:function(){return(function(v,y,x,E,_){te(v.length===y.rank,function(){return"Length of inShape ("+v.length+") and rank of dy ("+y.rank+") must match"});var k=v,C=y,R=!1;y.rank===4&&(R=!0,C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3]),k=[1,v[0],v[1],v[2],v[3]]);var I=k[4],T=C.shape[4];te(k.length===5,function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+k.length+"."}),te(C.rank===5,function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+C.rank}),te(x.rank===5,function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+x.rank}),te(I===x.shape[3],function(){return"Error in conv3dDerInput: depth of input ("+I+") must match input depth for filter "+x.shape[3]+"."}),te(T===x.shape[4],function(){return"Error in conv3dDerInput: depth of output ("+T+") must match output depth for filter "+x.shape[4]+"."});var A=ky(k,x.shape,E,1,_),N=ve.runKernel(function(O){return O.conv3dDerInput(C,x,A)},{dy5D:C});return R?N.as4D(N.shape[1],N.shape[2],N.shape[3],N.shape[4]):N})(g.shape,f,w,t,n)},$filter:function(){return(function(v,y,x,E,_){var k=v;v.rank===4&&(k=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var C=y;C.rank===4&&(C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),te(k.rank===5,function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."}),te(C.rank===5,function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."}),te(x.length===5,function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."}),te(k.shape[4]===x[3],function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+x[3]+"."}),te(C.shape[4]===x[4],function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+x[4]+")."});var R=ky(k.shape,x,E,1,_);return ve.runKernel(function(I){return I.conv3dDerFilter(k,C,R)},{x5D:k,dy5D:C})})(g,f,w.shape,t,n)}}});return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),xT=ue({conv2dDerFilter_:_T}),Rw=ue({depthwiseConv2d_:function(r,e,t,n,i,o,a){o===void 0&&(o=[1,1]);var s=J(r,"x","depthwiseConv2d"),u=J(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),te(l.rank===4,function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."}),te(u.rank===4,function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."}),te(l.shape[3]===u.shape[2],function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."}),o==null&&(o=[1,1]),te(Js(t,o),function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}),a!=null&&te(ao(n),function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."});var h=bd(l.shape,u.shape,t,o,n,a,!0),f=ve.runKernel(function(m,g){var w=m.depthwiseConv2D(l,u,h);return g([l,u]),w},{x:l,$filter:u},function(m,g){te(ym(o),function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"});var w=g[0],v=g[1];return{x:function(){return(function(y,x,E,_){var k=x,C=!1;x.rank===3&&(C=!0,k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2]));var R=ve.runKernel(function(I){return I.depthwiseConv2DDerInput(k,E,_)},{dy4D:k});return C?R.as3D(R.shape[1],R.shape[2],R.shape[3]):R})(w.shape,m,v,h)},$filter:function(){return(function(y,x,E,_){var k=y;y.rank===3&&(k=y.as4D(1,y.shape[0],y.shape[1],y.shape[2]));var C=x;return C.rank===3&&(C=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),ve.runKernel(function(R){return R.depthwiseConv2DDerFilter(k,C,_)},{x4D:k,dy4D:C})})(w,m,v.shape,h)}}});return c?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),ST=ue({separableConv2d_:function(r,e,t,n,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=J(r,"x","separableConv2d"),u=J(e,"depthwiseFilter","separableConv2d"),l=J(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");te(c.rank===4,function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."}),te(u.rank===4,function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."}),te(l.rank===4,function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."}),te(l.shape[0]===1,function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."}),te(l.shape[1]===1,function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."});var f=u.shape[2],m=u.shape[3];te(l.shape[2]===f*m,function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*m+", but got "+l.shape[2]+"."});var g=Rw(c,u,n,i,a,o),w=Qa(g,l,1,"valid",a);return h?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),U5=ue({conv2dTranspose_:function(r,e,t,n,i,o){return wT(t,J(r,"x","conv2dTranspose"),J(e,"filter","conv2dTranspose"),n,i,o)}}),Iw=ue({matMul_:function(r,e,t,n){var i;t===void 0&&(t=!1),n===void 0&&(n=!1);var o=J(r,"a","matMul"),a=J(e,"b","matMul");i=ur(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),f=a.shape.slice(0,-2),m=Pt(h),g=Pt(f);te(o.rank>=2&&a.rank>=2&&o.rank===a.rank,function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."}),te(Gr(h,f),function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."}),te(s===u,function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var w=o.shape.slice(0,-2).concat([l,c]),v=t?o.as3D(m,s,l):o.as3D(m,l,s),y=n?a.as3D(g,c,u):a.as3D(g,u,c);return ve.runKernel(function(x,E){var _=x.batchMatMul(v,y,t,n);return E([v,y]),_},{$a:v,$b:y},function(x,E){var _=E,k=_[0],C=_[1];return t||n?!t&&n?{$a:function(){return x.matMul(C,!1,!1)},$b:function(){return x.matMul(k,!0,!1)}}:t&&!n?{$a:function(){return C.matMul(x,!1,!0)},$b:function(){return k.matMul(x,!1,!1)}}:{$a:function(){return C.matMul(x,!0,!0)},$b:function(){return x.matMul(k,!0,!0)}}:{$a:function(){return x.matMul(C,!1,!0)},$b:function(){return k.matMul(x,!0,!1)}}}).reshape(w)}}),z5=ue({dot_:function(r,e){var t=J(r,"t1","dot"),n=J(e,"t2","dot");te(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."});var i=t.rank===1?t.size:t.shape[1],o=n.rank===1?n.size:n.shape[0];return te(i===o,function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."}),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),W5=ue({outerProduct_:function(r,e){var t=J(r,"v1","outerProduct"),n=J(e,"v2","outerProduct");return te(t.rank===1&&n.rank===1,function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."}),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),Sd=ue({reverse_:function(r,e){var t=J(r,"x","reverse");if(t.rank===0)return t.clone();var n=Mr(e,t.shape);return ve.runKernel(function(i){return i.reverse(t,n)},{$x:t},function(i){return{$x:function(){return i.reverse(n)}}}).reshapeAs(t)}}),H5=ue({reverse1d_:function(r){var e=J(r,"x","reverse");return te(e.rank===1,function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."}),Sd(e,0)}}),G5=ue({reverse2d_:function(r,e){var t=J(r,"x","reverse");return te(t.rank===2,function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."}),Sd(t,e)}}),V5=ue({reverse3d_:function(r,e){var t=J(r,"x","reverse");return te(t.rank===3,function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."}),Sd(t,e)}}),j5=ue({reverse4d_:function(r,e){var t=J(r,"x","reverse");return te(t.rank===4,function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."}),Sd(t,e)}});function ET(r,e,t,n,i,o){var a=J(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),te(s.rank===4,function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."}),te(Js(t,n),function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}),o!=null&&te(ao(i),function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Qh(s.shape,e,t,n,i,o),c=ve.runKernel(function(h,f){var m=h.maxPool(s,l);return f([s,m]),m},{x:s},function(h,f){var m=f[0],g=f[1];return{x:function(){return(function(w,v,y,x,E,_,k,C){var R=J(w,"dy","maxPoolBackprop"),I=J(v,"input","maxPoolBackprop"),T=J(y,"output","maxPoolBackprop");te(I.rank===R.rank,function(){return"Rank of input ("+I.rank+") does not match rank of dy ("+R.rank+")"}),te(Js(E,_),function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+E+" and dilations '"+_+"'"}),te(R.rank===4,function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+R.rank+"."}),te(I.rank===4,function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+I.rank+"."});var A=Qh(I.shape,x,E,_,k,C);return ve.runKernel(function(N){return N.maxPoolBackprop(R,I,T,A)},{$dy:R,$input:I})})(h,m,g,e,t,n,i)}}});return u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}function kT(r,e,t,n,i,o){var a=J(r,"x","avgPool","float32");te(Js(t,n),function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"});var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),te(s.rank===4,function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."}),o!=null&&te(ao(i),function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."});var l=Qh(s.shape,e,t,n,i,o),c=ve.runKernel(function(h){return h.avgPool(s,l)},{x:s},function(h){return{x:function(){return(function(f,m,g,w,v,y){var x=J(f,"dy","avgPoolBackprop"),E=J(m,"input","avgPoolBackprop");te(E.rank===x.rank,function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+x.rank+")"}),te(Js(w,v),function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+v+"'"});var _=E,k=x,C=!1;E.rank===3&&(C=!0,_=E.as4D(1,E.shape[0],E.shape[1],E.shape[2]),k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),te(k.rank===4,function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."}),te(_.rank===4,function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."});var R=Qh(_.shape,g,w,v,y),I=ve.runKernel(function(T){return T.avgPoolBackprop(k,_,R)},{dy4D:k,input4D:_});return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I})(h,s,e,t,n,i)}}});return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Fc=ue({maxPool_:function(r,e,t,n,i){return ET(r,e,t,1,n,i)}}),Ed=ue({avgPool_:function(r,e,t,n,i){return kT(r,e,t,1,n,i)}}),q5=ue({pool_:function(r,e,t,n,i,o){i==null&&(i=[1,1]),o==null&&(o=1),n===0&&(n="valid");var a=J(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),te(Js(o,i),function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"});var l,c=Qh(s.shape,e,o,i,n),h=[c.dilationHeight,c.dilationWidth];l=n==="same"?(function(_,k){var C=_.map(function(T,A){return T+(T-1)*(k[A]-1)}).map(function(T){return T-1}),R=C.map(function(T){return Math.floor(T/2)}),I=C.map(function(T,A){return T-R[A]});return C.map(function(T,A){return[R[A],I[A]]})})([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,m=(function(_,k,C){var R=C.map(function(F){return F[0]}),I=C.map(function(F){return F[1]}),T=_.concat(R,I),A=k.map(function(F,B){return(F-T[B]%F)%F}),N=I.map(function(F,B){return F+A[B]}),O=k.map(function(F,B){return[R[B],N[B]]}),V=k.map(function(F,B){return[0,A[B]]});return[O,V]})([c.inHeight,c.inWidth],h,l),g=m[0],w=m[1],v=f?n:"valid",y=f?s:JC(s,h,g),x=(t==="avg"?function(){return kT(y,e,o,1,v)}:function(){return ET(y,e,o,1,v)})(),E=f?x:XC(x,h,w);return u?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),fa=ue({slice_:function(r,e,t){var n,i,o=J(r,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");n=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice(),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map(function(s,u){return s>=0?s:(te(s===-1,function(){return"Bad value in size"}),o.shape[u]-n[u])}),(function(s,u,l){te(s.rank===u.length,function(){return"Error in slice"+s.rank+"D: Length of begin "+u+" must match the rank of the array ("+s.rank+")."}),te(s.rank===l.length,function(){return"Error in slice"+s.rank+"D: Length of size "+l+" must match the rank of the array ("+s.rank+")."});for(var c=function(f){te(u[f]+l[f]<=s.shape[f],function(){return"Error in slice"+s.rank+"D: begin["+f+"] + size["+f+"] ("+(u[f]+l[f])+") would overflow input.shape["+f+"] ("+s.shape[f]+")"})},h=0;h<s.rank;++h)c(h)})(o,n,i);var a=o.shape;return ve.runKernel(function(s){return s.slice(o,n,i)},{$x:o},function(s){for(var u=[],l=0;l<s.rank;l++)u.push([n[l],a[l]-n[l]-i[l]]);return{$x:function(){return s.pad(u)}}})}}),$5=ue({slice1d_:function(r,e,t){var n=J(r,"x","slice1d");return te(n.rank===1,function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"}),fa(n,[e],[t])}}),X5=ue({slice2d_:function(r,e,t){var n=J(r,"x","slice2d");return te(n.rank===2,function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"}),fa(n,e,t)}}),CT=ue({slice3d_:function(r,e,t){var n=J(r,"x","slice3d");return te(n.rank===3,function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"}),fa(n,e,t)}}),Y5=ue({slice4d_:function(r,e,t){var n=J(r,"x","slice4d");return te(n.rank===4,function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"}),fa(n,e,t)}});function TT(r,e,t,n,i){return e.rank<t.rank&&(e=e.reshape(so(e.shape,n))),r.rank<t.rank&&(r=r.reshape(so(r.shape,n))),{$x:function(){var o=r.mul(t.equal(e).cast(r.dtype));return i==null?o:o.transpose(i)}}}var K5=ue({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","all","bool"),i=Mr(e,n.shape),o=i,a=va(o,n.rank);a!=null&&(n=n.transpose(a),o=ya(o.length,n.rank));var s=ve.runKernel(function(l){return l.all(n,o)},{$x:n});if(t){var u=so(s.shape,i);return s.reshape(u)}return s}}),J5=ue({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","any","bool"),i=Mr(e,n.shape),o=i,a=va(o,n.rank);a!=null&&(n=n.transpose(a),o=ya(o.length,n.rank));var s=ve.runKernel(function(l){return l.any(n,o)},{$x:n});if(t){var u=so(s.shape,i);return s.reshape(u)}return s}}),Z5=ue({argMax_:function(r,e){e===void 0&&(e=0);var t=J(r,"x","argMax");e==null&&(e=0);var n=Mr(e,t.shape),i=va(n,t.rank);return i!=null&&(t=t.transpose(i),n=ya(n.length,t.rank)),ve.runKernel(function(o,a){var s=o.argMax(t,n[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return pn(s)}}})}}),Q5=ue({argMin_:function(r,e){e===void 0&&(e=0);var t=J(r,"x","argMin");e==null&&(e=0);var n=Mr(e,t.shape),i=va(n,t.rank);return i!=null&&(t=t.transpose(i),n=ya(n.length,t.rank)),ve.runKernel(function(o,a){var s=o.argMin(t,n[0]);return a([t]),s},{$x:t},function(o,a){var s=a[0];return{$x:function(){return pn(s)}}})}}),eO=ue({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","logSumExp"),i=Mr(e,n.shape),o=n.max(i,!0),a=n.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=so(s.shape,i);return s.reshape(u)}return s}}),tg=ue({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","max"),i=n,o=Mr(e,n.shape),a=o,s=va(a,n.rank);s!=null&&(n=n.transpose(s),a=ya(a.length,n.rank));var u=ve.runKernel(function(c,h){var f=c.max(n,a);return h([i,f]),f},{$x:n},function(c,h){return TT(c,h[1],h[0],o,s)});if(t){var l=so(u.shape,o);u=u.reshape(l)}return u}}),tO=ue({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","mean"),i=Mr(e,n.shape),o=Pt(Lr(n.shape,i)[1]);return yd(function(a){var s=dt(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach(function(c){l[c]=1}),u.reshape(l).mul(Yc(a.shape,"float32")).div(o)}}})(n)}}),nO=ue({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","min"),i=n,o=Mr(e,n.shape),a=o,s=va(a,n.rank);s!=null&&(n=n.transpose(s),a=ya(a.length,n.rank));var u=ve.runKernel(function(c,h){var f=c.min(n,a);return h([i,f]),f},{$x:n},function(c,h){return TT(c,h[1],h[0],o,s)});if(t){var l=so(u.shape,o);u=u.reshape(l)}return u}}),rO=ue({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=Mr(e,(r=J(r,"x","moments")).shape),i=r.mean(n,t),o=i.shape;t||(o=so(i.shape,n));var a=r.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(n,t)}}}),MT=ue({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=Mr(e,n.shape);return yd(function(o){var a=va(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=ya(s.length,o.rank));var l=ve.runKernel(function(h){return h.sum(u,s)},{permutedX:u});if(t){var c=so(l.shape,i);l=l.reshape(c)}return{value:l,gradFunc:function(h){var f=o.shape.slice();return i.forEach(function(m){f[m]=1}),h.reshape(f).mul(Yc(o.shape,"float32"))}}})(n)}}),iO=ue({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=J(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=Mr(e,n.shape),o=va(i,n.rank),a=i,s=n;o!=null&&(s=n.transpose(o),a=ya(a.length,n.rank));var u=ve.runKernel(function(c){return c.prod(s,a)},{permutedX:s});if(t){var l=so(u.shape,i);u=u.reshape(l)}return u}}),AT=ue({equal_:function(r,e){var t,n=J(r,"a","equal"),i=J(e,"b","equal");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o){return o.equal(n,i)},{$a:n,$b:i})}}),oO=ue({equalStrict_:function(r,e){var t=J(r,"a","equalStrict"),n=J(e,"b","equalStrict");return An(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),aO=ue({greater_:function(r,e){var t,n=J(r,"a","greater"),i=J(e,"b","greater");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o){return o.greater(n,i)},{$a:n,$b:i})}}),RT=ue({greaterEqual_:function(r,e){var t,n=J(r,"a","greaterEqual"),i=J(e,"b","greaterEqual");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o,a){var s=o.greaterEqual(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return pn(s)},$b:function(){return pn(u)}}})}}),sO=ue({greaterEqualStrict_:function(r,e){var t=J(r,"a","greaterEqualStrict"),n=J(e,"b","greaterEqualStrict");return An(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),uO=ue({greaterStrict_:function(r,e){var t=J(r,"a","greaterStrict"),n=J(e,"b","greaterStrict");return An(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),lO=ue({less_:function(r,e){var t,n=J(r,"a","less"),i=J(e,"b","less");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o){return o.less(n,i)},{$a:n,$b:i})}}),cO=ue({lessEqual_:function(r,e){var t,n=J(r,"a","lessEqual"),i=J(e,"b","lessEqual");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o){return o.lessEqual(n,i)},{$a:n,$b:i})}}),hO=ue({lessEqualStrict_:function(r,e){var t=J(r,"a","lessEqualStrict"),n=J(e,"b","lessEqualStrict");return An(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),dO=ue({lessStrict_:function(r,e){var t=J(r,"a","lessStrict"),n=J(e,"b","lessStrict");return An(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),fO=ue({notEqual_:function(r,e){var t,n=J(r,"a","notEqual"),i=J(e,"b","notEqual");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o){return o.notEqual(n,i)},{$a:n,$b:i})}}),pO=ue({notEqualStrict_:function(r,e){var t=J(r,"a","notEqualStrict"),n=J(e,"b","notEqualStrict");return An(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}}),wn=ue({add_:function(r,e){var t,n=J(r,"a","add"),i=J(e,"b","add");t=ur(n,i),n=t[0],i=t[1];var o=cn(n.shape,i.shape);return ve.runKernel(function(a){return a.add(n,i)},{$a:n,$b:i},function(a){return{$a:function(){var s=a,u=lr(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},$b:function(){var s=a,u=lr(i.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(i.shape)}}})}}),mO=ue({addN_:function(r){te(Array.isArray(r),function(){return"The argument passed to tf.addN() must be a list of tensors"}),te(r.length>=1,function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length});var e=r.map(function(i,o){return J(i,"tensors"+o,"addN")}),t=e[0];e.forEach(function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")}),e.forEach(function(i){if(!Gr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")});var n=e;return ve.runKernel(function(i){return i.addN(e)},n,function(i){var o={};return e.forEach(function(a,s){o[s]=function(){return i.clone()}}),o})}}),gO=ue({addStrict_:function(r,e){var t=J(r,"a","addStrict"),n=J(e,"b","addStrict");return An(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),vO=ue({atan2_:function(r,e){var t,n=J(r,"a","atan2"),i=J(e,"b","atan2");t=ur(n,i),n=t[0],i=t[1];var o=cn(n.shape,i.shape);return ve.runKernel(function(a,s){var u=a.atan2(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=wn(u.square(),l.square()),h=a.mul(l.div(c)),f=lr(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=wn(u.square(),l.square()),h=bm(a.mul(u.div(c))),f=lr(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}})}}),ta=ue({div_:function(r,e){var t,n=J(r,"a","div"),i=J(e,"b","div");if(t=ur(n,i),n=t[0],i=t[1],n.dtype==="int32"&&i.dtype==="int32")return IT(n,i);var o=cn(n.shape,i.shape);return ve.runKernel(function(a,s){var u=a.realDivide(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.div(l.toFloat()),h=lr(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=lr(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}})}}),yO=ue({divStrict_:function(r,e){var t=J(r,"a","div"),n=J(e,"b","div");return An(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),IT=ue({floorDiv_:function(r,e){var t,n=J(r,"a","floorDiv"),i=J(e,"b","floorDiv");t=ur(n,i),n=t[0],i=t[1];var o=cn(n.shape,i.shape);return ve.runKernel(function(a,s){var u=a.floorDiv(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.div(l.toFloat()),h=lr(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=lr(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}})}}),Dw=ue({maximum_:function(r,e){var t,n=J(r,"a","maximum"),i=J(e,"b","maximum");return t=ur(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),cn(n.shape,i.shape),ve.runKernel(function(o,a){var s=o.maximum(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.greaterEqual(u).toFloat())},$b:function(){return o.mul(s.less(u).toFloat())}}})}}),bO=ue({maximumStrict_:function(r,e){var t=J(r,"a","maximumStrict"),n=J(e,"b","maximumStrict");return An(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),DT=ue({minimum_:function(r,e){var t,n=J(r,"a","minimum"),i=J(e,"b","minimum");return t=ur(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),cn(n.shape,i.shape),ve.runKernel(function(o,a){var s=o.minimum(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1];return{$a:function(){return o.mul(s.lessEqual(u).toFloat())},$b:function(){return o.mul(s.greater(u).toFloat())}}})}}),wO=ue({minimumStrict_:function(r,e){var t=J(r,"a","minimumStrict"),n=J(e,"b","minimumStrict");return An(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),_O=ue({mod_:function(r,e){var t,n=J(r,"a","mod"),i=J(e,"b","mod");t=ur(n,i),n=t[0],i=t[1];var o=cn(n.shape,i.shape);return ve.runKernel(function(a,s){var u=a.mod(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=lr(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=lr(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),xO=ue({modStrict_:function(r,e){var t=J(r,"a","modStrict"),n=J(e,"b","modStrict");return An(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),Ha=ue({mul_:function(r,e){var t,n=J(r,"a","mul"),i=J(e,"b","mul");t=ur(n,i),n=t[0],i=t[1];var o=cn(n.shape,i.shape);return ve.runKernel(function(a,s){var u=a.multiply(n,i);return s([n,i]),u},{$a:n,$b:i},function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=a.mul(l.toFloat()),h=lr(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},$b:function(){var c=a.mul(u.toFloat()),h=lr(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}})}}),SO=ue({mulStrict_:function(r,e){var t=J(r,"a","mul"),n=J(e,"b","mul");return An(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),wm=ue({pow_:function(r,e){var t=J(r,"base","pow"),n=J(e,"exp","pow"),i=cn(t.shape,n.shape);return r=t.cast(or(t.dtype,n.dtype)),e=n.cast(or(t.dtype,n.dtype)),ve.runKernel(function(o,a){var s=o.pow(t,n);return a([t,n,s]),s},{$base:t,$exp:n},function(o,a){var s=a[0],u=a[1],l=a[2];return{$base:function(){var c=u.toFloat(),h=o.mul(c.mul(s.pow(c.sub(dt(1))))),f=lr(s.shape,i);return f.length>0&&(h=h.sum(f)),h.reshape(s.shape)},$exp:function(){var c=s.greater(0),h=s.log().where(c,pn(s)),f=o.mul(l.mul(h)),m=lr(u.shape,i);return m.length>0&&(f=f.sum(m)),f.reshape(u.shape)}}})}}),EO=ue({powStrict_:function(r,e){return An(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),kO=ue({squaredDifference_:function(r,e){var t,n=J(r,"a","squaredDifference"),i=J(e,"b","squaredDifference");return t=ur(n,i),n=t[0],i=t[1],cn(n.shape,i.shape),ve.runKernel(function(o,a){var s=o.squaredDifference(n,i);return a([n,i]),s},{$a:n,$b:i},function(o,a){var s=a[0],u=a[1],l=dt(2);return{$a:function(){return o.mul(s.sub(u).mul(l))},$b:function(){return o.mul(u.sub(s).mul(l))}}})}}),CO=ue({squaredDifferenceStrict_:function(r,e){var t=J(r,"a","squaredDifferenceStrict"),n=J(e,"b","squaredDifferenceStrict");return An(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),xi=ue({sub_:function(r,e){var t,n=J(r,"a","sub"),i=J(e,"b","sub");t=ur(n,i),n=t[0],i=t[1];var o=cn(n.shape,i.shape);return ve.runKernel(function(a){return a.subtract(n,i)},{$a:n,$b:i},function(a){return{$a:function(){var s=a,u=lr(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},$b:function(){var s=a,u=lr(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}})}}),TO=ue({subStrict_:function(r,e){var t=J(r,"a","subStrict"),n=J(e,"b","subStrict");return An(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),Nw=ue({logicalAnd_:function(r,e){var t=J(r,"a","logicalAnd","bool"),n=J(e,"b","logicalAnd","bool");return cn(t.shape,n.shape),ve.runKernel(function(i){return i.logicalAnd(t,n)},{$a:t,$b:n})}}),MO=ue({logicalNot_:function(r){var e=J(r,"x","logicalNot","bool");return ve.runKernel(function(t){return t.logicalNot(e)},{$x:e})}}),NT=ue({logicalOr_:function(r,e){var t=J(r,"a","logicalOr","bool"),n=J(e,"b","logicalOr","bool");return cn(t.shape,n.shape),ve.runKernel(function(i){return i.logicalOr(t,n)},{$a:t,$b:n})}}),AO=ue({logicalXor_:function(r,e){var t=J(r,"a","logicalXor","bool"),n=J(e,"b","logicalXor","bool");return cn(t.shape,n.shape),NT(r,e).logicalAnd(Nw(r,e).logicalNot())}}),ed=ue({where_:function(r,e,t){var n=J(e,"a","where"),i=J(t,"b","where"),o=J(r,"condition","where","bool");return An(n.shape,i.shape,"Error in where: "),o.rank===1?te(o.shape[0]===n.shape[0],function(){return"The first dimension of `a` must match the size of `condition`."}):An(o.shape,i.shape,"Error in where: "),ve.runKernel(function(a,s){var u=a.select(o,n,i);return s([o]),u},{$condition:o,$a:n,$b:i},function(a,s){var u=s[0];return{$condition:function(){return pn(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}})}}),RO=function(r){return Gt(this,void 0,void 0,function(){var e,t,n;return Vt(this,function(i){switch(i.label){case 0:return[4,(e=J(r,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),n=kw(e.shape,t),r!==e&&e.dispose(),[2,n]}})})},IO=ue({elu_:function(r){var e=J(r,"x","elu");return ve.runKernel(function(t,n){var i=t.elu(e);return n([i]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return ve.runKernel(function(o){return o.eluDer(t,i)},{dy:t,y:i})}}})}}),DO=ue({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=J(r,"x","leakyRelu");return Dw(dt(e).mul(t),t)}}),NO=ue({prelu_:function(r,e){var t=J(r,"x","prelu"),n=J(e,"alpha","prelu");return ve.runKernel(function(i,o){var a=i.prelu(t,n);return o([t,n]),a},{$x:t,$alpha:n},function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{$x:function(){return ed(u,i,i.mul(s))},$alpha:function(){var l=ed(u,pn(i),i.mul(a)),c=lr(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}})}}),er=ue({relu_:function(r){var e=J(r,"x","relu");return e.dtype==="bool"?e.toInt():ve.runKernel(function(t,n){var i=t.relu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){return t.mulStrict(i.step().toFloat())}}})}}),PO=ue({selu_:function(r){var e=J(r,"x","selu");return ve.runKernel(function(t,n){var i=t.selu(e);return n([e]),i},{$x:e},function(t,n){var i=n[0];return{$x:function(){var o=i.greater(dt(0)),a=dt(Tw),s=dt(Mw),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return ed(o,u,l)}}})}}),Zs=ue({transpose_:function(r,e){var t=J(r,"x","transpose");return e==null&&(e=t.shape.map(function(n,i){return i}).reverse()),te(t.rank===e.length,function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."}),e.forEach(function(n){te(n>=0&&n<t.rank,function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e})}),t.rank<=1?t.clone():ve.runKernel(function(n){return n.transpose(t,e)},{$x:t},function(n){var i=bw(e);return{$x:function(){return n.transpose(i)}}})}}),FO=ue({localResponseNormalization_:function(r,e,t,n,i){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5);var o=J(r,"x","localResponseNormalization");te(o.rank===4||o.rank===3,function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."}),te(ao(e),function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."});var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=ve.runKernel(function(l,c){var h=l.localResponseNormalization4D(a,e,t,n,i);return c([a,h]),h},{x4D:a},function(l,c){var h=c[0],f=c[1];return{x4D:function(){return ve.runKernel(function(m){return m.LRNGrad(l,h,f,e,t,n,i)},{})}}});return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),PT=ue({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var i=(function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(dt(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)})(r=J(r,"x","norm"),e,t),o=i.shape;if(n){var a=Mr(t,r.shape);o=so(i.shape,a)}return i.reshape(o)}});function IS(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function DS(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var FT=ue({gather_:function(r,e,t){t===void 0&&(t=0);var n=J(r,"x","gather"),i=J(e,"indices","gather","int32");t=Mr(t,n.shape)[0];var o=(function(a,s,u){for(var l=a.shape[u],c=[],h=1,f=1,m=0;m<u;m++)c.push(a.shape[m]),h*=a.shape[m];for(m=0;m<s.rank;m++)c.push(s.shape[m]);for(m=u+1;m<a.rank;m++)c.push(a.shape[m]),f*=a.shape[m];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}})(n,i,t);return ve.runKernel(function(a,s){var u=a.gather(n,i.flatten(),t);return s([i]),u},{$x:n},function(a,s){var u=s[0];return{$x:function(){var l=n.shape,c=u.size,h=l.slice(0,t),f=h.length,m=l.slice(t,l.length).slice(1),g=m.length,w=IS(0,f),v=IS(f+1,f+1+g),y=DS([h,[c],m]),x=a.reshape(y),E=u.reshape([c]),_=DS([[f],w,v]),k=x.transpose(_),C=OT(k,E,n.shape[t]),R=bw(_);return C=C.transpose(R)}}}).reshape(o.outputShape)}}),OT=ue({unsortedSegmentSum_:function(r,e,t){var n=J(r,"x","unsortedSegmentSum"),i=J(e,"segmentIds","unsortedSegmentSum","int32");return te(ao(t),function(){return"numSegments must be of dtype int"}),ve.runKernel(function(o,a){var s=o.unsortedSegmentSum(n,i,t);return a([i]),s},{$x:n},function(o,a){var s=a[0];return{$x:function(){return(function(u,l){for(var c=Dw(l,pn(l)),h=FT(u,c),f=RT(l,dt(0,"int32")),m=h.rank-f.rank,g=0;g<m;++g)f=eo(f,g+1);f=Nw(f,Yc(h.shape,"bool"));var w=pn(h);return ed(f,h,w)})(o,s)}}})}}),OO=ue({basicLSTMCell_:function(r,e,t,n,i,o){var a=J(r,"forgetBias","basicLSTMCell"),s=J(e,"lstmKernel","basicLSTMCell"),u=J(t,"lstmBias","basicLSTMCell"),l=J(n,"data","basicLSTMCell"),c=J(i,"c","basicLSTMCell"),h=J(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(s).add(u),m=f.shape[0],g=f.shape[1]/4,w=[m,g],v=f.slice([0,0],w),y=f.slice([0,g],w),x=f.slice([0,2*g],w),E=f.slice([0,3*g],w),_=v.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid())),k=_.tanh().mulStrict(E.sigmoid());return[_,k]}}),LO=ue({multiRNNCell_:function(r,e,t,n){for(var i=J(e,"data","multiRNNCell"),o=dm(t,"c","multiRNNCell"),a=dm(n,"h","multiRNNCell"),s=i,u=[],l=0;l<r.length;l++){var c=r[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),BO=ue({movingAverage_:function(r,e,t,n,i){i===void 0&&(i=!0);var o=J(r,"v","movingAverage"),a=J(e,"x","movingAverage"),s=J(t,"decay","movingAverage");VD(o,a),te(Gr(o.shape,a.shape),function(){return"Shape mismatch in v and x"});var u=dt(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){te(n!=null,function(){return"When using zeroDebias: true, step is required."});var h=J(n,"step","movingAverage");c=c.div(u.sub(wm(s,h)))}return o.add(c)}}),UO=ue({stridedSlice_:function(r,e,t,n,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),a!==0)throw new Error("ellipsis mask is not yet supported");if(s!==0)throw new Error("new axis mask is not yet supported");var l=J(r,"x","stridedSlice");if(n.every(function(w){return w===1})){var c=Sw(l.shape,e,t,n,i,o,a,s,u),h=c[0],f=c[1],m=c[2],g=f.filter(function(w,v){return m.indexOf(v)===-1});return fa(l,h,f).reshape(g)}return ve.runKernel(function(w){return w.stridedSlice(l,e,t,n,i,o,a,s,u)},{$x:l})}}),zO=ue({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=J(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=ve.runKernel(function(a){return a.topk(n,e,t)},{$x:n});return{values:o[0],indices:o[1]}}}),WO=ue({scatterND_:function(r,e,t){var n=J(r,"indices","scatterND","int32"),i=J(e,"updates","scatterND");return JN(i,n,t),ve.runKernel(function(o){return o.scatterND(n,i,t)},{$indices:n,$updates:i})}}),Pw=ue({fft_:function(r){te(r.dtype==="complex64",function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return ve.runKernel(function(i){return i.fft(n)},{input:r}).reshape(r.shape)}}),_m=ue({ifft_:function(r){te(r.dtype==="complex64",function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."});var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return ve.runKernel(function(i){return i.ifft(n)},{input:r}).reshape(r.shape)}}),LT=ue({rfft_:function(r,e){te(r.dtype==="float32",function(){return"The dtype for rfft() must be real value but got "+r.dtype});var t,n=r.shape[r.shape.length-1],i=r.size/n;if(e!=null&&e<n){var o=r.shape.map(function(y){return 0}),a=r.shape.map(function(y){return y});a[r.shape.length-1]=e,t=r.slice(o,a),n=e}else if(e!=null&&e>n){var s=r.shape.map(function(y){return y});s[r.shape.length-1]=e-n,t=r.concat(Wn(s),r.shape.length-1),n=e}else t=r;var u=t.zerosLike(),l=ni(t,u).as2D(i,n),c=Pw(l),h=Math.floor(n/2)+1,f=ua(c),m=Gs(c),g=f.split([h,n-h],f.shape.length-1),w=m.split([h,n-h],m.shape.length-1),v=t.shape.slice();return v[t.shape.length-1]=h,ni(g[0],w[0]).reshape(v)}}),BT=ue({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),i=_m(n);return ua(i)}var o=[t,2*(e-1)],a=ua(r).as2D(t,e),s=Gs(r).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(dt(-1)),c=a.concat(u,1),h=s.concat(l,1);return n=ni(c,h).as2D(o[0],o[1]),i=_m(n),ua(i)}}),HO=Object.freeze({fft:Pw,ifft:_m,rfft:LT,irfft:BT}),GO=ue({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var i=J(r,"sparseIndices","sparseToDense","int32"),o=J(e,"sparseValues","sparseToDense"),a=J(n,"defaultValue","sparseToDense",o.dtype);return(function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var m=u.size;if(u.rank!==0&&(u.rank!==1||m!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,o,t,a),ve.runKernel(function(s){return s.sparseToDense(i,o,t,a)},{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),VO=ue({gatherND_:function(r,e){var t=J(e,"indices","gatherND","int32"),n=J(r,"x","gatherND");return ve.runKernel(function(i){return i.gatherND(n,t)},{$x:n,$indices:t})}}),jO=ue({dropout_:function(r,e,t,n){if(t!=null&&!Gr(r.shape,t))throw new Error("Non-default noise shape is not implemented yet: "+JSON.stringify(t));var i=KC(r.shape,0,1,"float32",n).greater(e);return i=i.div(xi(1,e)),r.mul(i)}});function UT(r,e,t){for(var n=1-r%2,i=new Float32Array(r),o=0;o<r;++o){var a=2*Math.PI*o/(r+n-1);i[o]=e-t*Math.cos(a)}return fi(i,"float32")}var zr,zT=ue({hannWindow_:function(r){return UT(r,.5,.5)}}),WT=ue({hammingWindow_:function(r){return UT(r,.54,.46)}}),HT=ue({frame_:function(r,e,t,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=r.size;)a.push(fa(r,o,e)),o+=t;if(n){var s=o+e-r.size,u=Vr([fa(r,o,e-s),yc([s],i)]);a.push(u)}return a.length===0?gd([],[0,e]):Vr(a).as2D(a.length,e)}}),qO=Object.freeze({hannWindow:zT,hammingWindow:WT,frame:HT});(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(zr||(zr={}));var $O=ue({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=zr.SUM_BY_NONZERO_WEIGHTS);var i=J(r,"labels","absoluteDifference"),o=J(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=J(t,"weights","absoluteDifference")),An(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return es(s,a,n)}}),es=ue({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=zr.SUM_BY_NONZERO_WEIGHTS);var n=J(r,"losses","computeWeightedLoss"),i=null;e!=null&&(i=J(e,"weights","computeWeightedLoss"));var o=i==null?n:n.mul(i);if(t===zr.NONE)return o;if(t===zr.SUM)return o.sum();if(t===zr.MEAN){if(i==null)return o.mean();var a=n.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(dt(a)):s}if(t===zr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(dt(n.size));var u=i.mul(Yc(n.shape)).notEqual(dt(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),XO=ue({cosineDistance_:function(r,e,t,n,i){i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(r,"labels","cosineDistance"),a=J(e,"predictions","cosineDistance"),s=null;n!=null&&(s=J(n,"weights","cosineDistance")),An(o.shape,a.shape,"Error in cosineDistance: ");var u=dt(1).sub(o.mul(a).sum(t,!0));return es(u,s,i)}}),YO=ue({hingeLoss_:function(r,e,t,n){n===void 0&&(n=zr.SUM_BY_NONZERO_WEIGHTS);var i=J(r,"labels","hingeLoss"),o=J(e,"predictions","hingeLoss"),a=null;t!=null&&(a=J(t,"weights","hingeLoss")),An(i.shape,o.shape,"Error in hingeLoss: ");var s=dt(1);i=dt(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return es(u,a,n)}}),KO=ue({huberLoss_:function(r,e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(r,"labels","huberLoss"),a=J(e,"predictions","huberLoss"),s=null;t!=null&&(s=J(t,"weights","huberLoss")),An(o.shape,a.shape,"Error in huberLoss: ");var u=dt(n),l=a.sub(o).abs(),c=DT(l,u),h=l.sub(c),f=dt(.5).mul(c.square()).add(u.mul(h));return es(f,s,i)}}),JO=ue({logLoss_:function(r,e,t,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(r,"labels","logLoss"),a=J(e,"predictions","logLoss"),s=null;t!=null&&(s=J(t,"weights","logLoss")),An(o.shape,a.shape,"Error in logLoss: ");var u=dt(1),l=dt(n),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return es(c,s,i)}}),ZO=ue({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=zr.SUM_BY_NONZERO_WEIGHTS);var i=J(r,"labels","meanSquaredError"),o=J(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=J(t,"weights","meanSquaredError")),An(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return es(s,a,n)}}),QO=ue({sigmoidCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(r,"multiClassLabels","sigmoidCrossEntropy"),a=J(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=J(t,"weights","sigmoidCrossEntropy")),An(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=dt(n),l=dt(1),c=dt(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=(function(f,m){var g=J(f,"labels","sigmoidCrossEntropyWithLogits"),w=J(m,"logits","sigmoidCrossEntropyWithLogits");An(g.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=w.relu(),y=w.mul(g),x=w.abs().neg().exp().log1p();return v.sub(y).add(x)})(o,a);return es(h,s,i)}}),eL=ue({softmaxCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=zr.SUM_BY_NONZERO_WEIGHTS);var o=J(r,"onehotLabels","softmaxCrossEntropy"),a=J(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=J(t,"weights","softmaxCrossEntropy")),An(o.shape,a.shape,"Error in softmaxCrossEntropy: "),n>0){var u=dt(n),l=dt(1),c=dt(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=(function(f,m,g){if(g===void 0&&(g=-1),g===-1&&(g=m.rank-1),g!==m.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+m.rank+" and dim was "+g);return yd(function(w,v,y){var x=v.logSumExp([g],!0),E=v.toFloat().sub(x);return y([w,E]),{value:E.mul(w).neg().sum([g]),gradFunc:function(_,k){var C=k[0],R=k[1],I=so(_.shape,[g]);return[_.reshape(I).mul(C.toFloat().sub(R.exp())),_.reshape(I).mul(R.exp().sub(C.toFloat()))]}}})(f,m)})(o,a);return es(h,s,i)}}),tL=Object.freeze({get Reduction(){return zr},absoluteDifference:$O,computeWeightedLoss:es,cosineDistance:XO,hingeLoss:YO,huberLoss:KO,logLoss:JO,meanSquaredError:ZO,sigmoidCrossEntropy:QO,softmaxCrossEntropy:eL});function NS(r,e){return e===void 0&&(e=!1),ve.tidy(function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],i=YC(t),o=r.clone(),a=gd([[1]],[1,1]),s=a.clone(),u=t>=n?n:t,l=function(h){var f,m=o,g=s,w=i;f=ve.tidy(function(){var v=o.slice([h,h],[t-h,1]),y=v.norm(),x=o.slice([h,h],[1,1]),E=x.sign().neg(),_=x.sub(E.mul(y)),k=v.div(_);s=k.shape[0]===1?a.clone():a.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var C=E.matMul(_).div(y).neg(),R=o.slice([h,0],[t-h,n]),I=C.mul(s);o=h===0?R.sub(I.matMul(s.transpose().matMul(R))):o.slice([0,0],[h,n]).concat(R.sub(I.matMul(s.transpose().matMul(R))),0);var T=i.slice([0,h],[t,i.shape[1]-h]);return i=h===0?T.sub(T.matMul(s).matMul(I.transpose())):i.slice([0,0],[t,h]).concat(T.sub(T.matMul(s).matMul(I.transpose())),1),[s,o,i]}),s=f[0],o=f[1],i=f[2],yi([m,g,w])},c=0;c<u;++c)l(c);return!e&&t>n&&(i=i.slice([0,0],[t,n]),o=o.slice([0,0],[n,n])),[i,o]})}var nL=ue({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,te(r!=null&&r.length>0,function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"});for(var t=r[0].shape[0],n=function(u){te(r[u].shape[0]===t,function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+t+")"})},i=1;i<r.length;++i)n(i)}else e=!0,r=_w(r,r.shape[0],0).map(function(u){return ZC(u,[0])});te(r.length<=r[0].shape[0],function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."});var o=[],a=r,s=function(u){o.push(ve.tidy(function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=MT(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(PT(l,"euclidean"))}))};for(i=0;i<r.length;++i)s(i);return e?Oo(o,0):o}}),rL=ue({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return NS(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce(function(a,s){return a*s}),n=Tr(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],o=[];return n.forEach(function(a){var s=NS(a,e),u=s[0],l=s[1];i.push(u),o.push(l)}),[Oo(i,0).reshape(r.shape),Oo(o,0).reshape(r.shape)]}}),iL=Object.freeze({gramSchmidt:nL,qr:rL});function GT(r,e,t,n,i){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY);var o=r.shape[0];return t=Math.min(t,o),te(0<=n&&n<=1,function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"}),te(r.rank===2,function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"}),te(r.shape[1]===4,function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]}),te(e.rank===1,function(){return"scores must be a 1D tensor"}),te(e.shape[0]===o,function(){return"scores has incompatible shape with boxes. Expected "+o+", but was "+e.shape[0]}),{maxOutputSize:t,iouThreshold:n,scoreThreshold:i}}var oL=ue({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=J(r,"images","resizeBilinear");te(n.rank===3||n.rank===4,function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."}),te(e.length===2,function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."});var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=ve.runKernel(function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return ve.runKernel(function(h){return h.resizeBilinearBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),aL=ue({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=J(r,"images","resizeNearestNeighbor");te(n.rank===3||n.rank===4,function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."}),te(e.length===2,function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."}),te(n.dtype==="float32"||n.dtype==="int32",function(){return"`images` must have `int32` or `float32` as dtype"});var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=ve.runKernel(function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)},{batchImages:i},function(l,c){return{batchImages:function(){return ve.runKernel(function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)},{})}}});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),sL=ue({nonMaxSuppression_:function(r,e,t,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=J(r,"boxes","nonMaxSuppression"),a=J(e,"scores","nonMaxSuppression"),s=GT(o,a,t,n,i);return t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,ve.runKernel(function(u){return u.nonMaxSuppression(o,a,t,n,i)},{$boxes:o})}}),uL=function(r,e,t,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),Gt(this,void 0,void 0,function(){var o,a,s,u,l,c;return Vt(this,function(h){switch(h.label){case 0:return o=J(r,"boxes","nonMaxSuppressionAsync"),a=J(e,"scores","nonMaxSuppressionAsync"),s=GT(o,a,t,n,i),t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,[4,o.data()];case 1:return u=h.sent(),[4,a.data()];case 2:return l=h.sent(),c=Ew(u,l,t,n,i),o!==r&&o.dispose(),a!==e&&a.dispose(),[2,c]}})})},lL=ue({cropAndResize_:function(r,e,t,n,i,o){var a=J(r,"image","cropAndResize","float32"),s=J(e,"boxes","cropAndResize","float32"),u=J(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return te(a.rank===4,function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."}),te(s.rank===2&&s.shape[1]===4,function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."}),te(u.rank===1&&u.shape[0]===l,function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."}),te(n.length===2,function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."}),te(n[0]>=1&&n[1]>=1,function(){return"cropSize must be atleast [1,1], but was "+n}),te(i==="bilinear"||i==="nearest",function(){return"method must be bilinear or nearest, but was "+i}),ve.runKernel(function(c,h){return c.cropAndResize(a,s,u,n,i,o)},{$image:a,$boxes:s})}}),VT=Object.freeze({resizeBilinear:oL,resizeNearestNeighbor:aL,nonMaxSuppression:sL,nonMaxSuppressionAsync:uL,cropAndResize:lL}),cL=ue({matMul_:function(r,e,t,n,i,o){var a;t===void 0&&(t=!1),n===void 0&&(n=!1),o===void 0&&(o="linear");var s=J(r,"a","fused matMul"),u=J(e,"b","fused matMul");a=ur(s,u),s=a[0],u=a[1];var l=t?s.shape[s.rank-2]:s.shape[s.rank-1],c=n?u.shape[u.rank-1]:u.shape[u.rank-2],h=t?s.shape[s.rank-1]:s.shape[s.rank-2],f=n?u.shape[u.rank-2]:u.shape[u.rank-1],m=s.shape.slice(0,-2),g=u.shape.slice(0,-2),w=Pt(m),v=Pt(g);te(s.rank>=2&&u.rank>=2&&s.rank===u.rank,function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+s.rank+" and "+u.rank+"."}),te(Gr(m,g),function(){return"Error in fused matMul: outer dimensions ("+m+") and ("+g+") of Tensors with shapes "+s.shape+" and "+u.shape+" must match."}),te(l===c,function(){return"Error in fused matMul: inner shapes ("+l+") and ("+c+") of Tensors with shapes "+s.shape+" and "+u.shape+" and transposeA="+t+" and transposeB="+n+" must match."});var y,x=s.shape.slice(0,-2).concat([h,f]),E=t?s.as3D(w,l,h):s.as3D(w,h,l),_=n?u.as3D(v,f,c):u.as3D(v,c,f);i!=null&&cn(x,(y=ur(y=J(i,"bias","fused matMul"),s)[0]).shape);var k={$a:E,$b:_};return i!=null&&(k.$bias=y),ve.runKernel(function(C,R){var I=C.fusedBatchMatMul(E,_,t,n,y,o);return R([E,_,I]),I},k,function(C,R){var I,T=R[0],A=R[1],N=R[2];if(o==null||o==="linear")I=C;else{if(o!=="relu")throw new Error("Gradient for activation "+o+" has not been implemented yet.");I=C.mul(N.step())}var O={};return i!=null&&(O={$bias:function(){var V=I,F=lr(y.shape,I.shape);return F.length>0&&(V=V.sum(F)),V.reshape(y.shape)}}),Object.assign(t||n?!t&&n?{$a:function(){return I.matMul(A,!1,!1)},$b:function(){return I.matMul(T,!0,!1)}}:t&&!n?{$a:function(){return A.matMul(I,!1,!0)},$b:function(){return T.matMul(I,!1,!1)}}:{$a:function(){return A.matMul(I,!0,!0)},$b:function(){return I.matMul(T,!0,!0)}}:{$a:function(){return I.matMul(A,!1,!0)},$b:function(){return T.matMul(I,!0,!1)}},O)}).reshape(x)}}),hL=Object.freeze({matMul:cL}),dL=Object.freeze({image:VT,linalg:iL,losses:tL,spectral:HO,fused:hL,signal:qO,op:ue,batchNormalization2d:R5,batchNormalization3d:I5,batchNormalization4d:D5,batchNormalization:N5,batchNorm:bT,batchNorm2d:P5,batchNorm3d:F5,batchNorm4d:O5,complex:ni,real:ua,imag:Gs,concat:Vr,concat1d:CN,concat2d:TN,concat3d:MN,concat4d:AN,split:_w,conv1d:L5,conv2d:Qa,conv3d:B5,conv2dDerFilter:xT,depthwiseConv2d:Rw,separableConv2d:ST,conv2dTranspose:U5,matMul:Iw,dot:z5,outerProduct:W5,reverse:Sd,reverse1d:H5,reverse2d:G5,reverse3d:V5,reverse4d:j5,maxPool:Fc,avgPool:Ed,pool:q5,slice:fa,slice1d:$5,slice2d:X5,slice3d:CT,slice4d:Y5,abs:e5,acos:t5,acosh:n5,asin:r5,asinh:i5,atan:o5,atanh:a5,ceil:s5,clipByValue:Aw,cos:u5,cosh:l5,erf:c5,exp:tb,expm1:h5,floor:d5,log:f5,log1p:p5,logSigmoid:m5,neg:bm,reciprocal:g5,round:v5,rsqrt:pT,sigmoid:mT,sign:y5,isNaN:b5,isInf:w5,isFinite:_5,sin:x5,sinh:S5,softplus:E5,sqrt:k5,square:C5,step:T5,tan:M5,tanh:A5,all:K5,any:J5,argMax:Z5,argMin:Q5,logSumExp:eO,max:tg,mean:tO,min:nO,moments:rO,sum:MT,prod:iO,equal:AT,equalStrict:oO,greater:aO,greaterEqual:RT,greaterEqualStrict:sO,greaterStrict:uO,less:lO,lessEqual:cO,lessEqualStrict:hO,lessStrict:dO,notEqual:fO,notEqualStrict:pO,add:wn,addN:mO,addStrict:gO,atan2:vO,div:ta,divStrict:yO,floorDiv:IT,maximum:Dw,maximumStrict:bO,minimum:DT,minimumStrict:wO,mod:_O,modStrict:xO,mul:Ha,mulStrict:SO,pow:wm,powStrict:EO,squaredDifference:kO,squaredDifferenceStrict:CO,sub:xi,subStrict:TO,elu:IO,leakyRelu:DO,prelu:NO,relu:er,selu:PO,logicalAnd:Nw,logicalNot:MO,logicalOr:NT,logicalXor:AO,where:ed,whereAsync:RO,buffer:tn,print:LN,batchToSpaceND:XC,cast:BN,clone:UN,cumsum:zN,depthToSpace:WN,expandDims:eo,eye:YC,multinomial:HN,oneHot:Z0,pad:vd,pad1d:GN,pad2d:VN,pad3d:jN,pad4d:qN,rand:$N,randomNormal:XN,randomUniform:KC,reshape:Do,spaceToBatchND:JC,squeeze:ZC,stack:Oo,tile:bc,truncatedNormal:YN,unstack:Tr,setdiff1dAsync:KN,fill:yc,linspace:kN,ones:Yc,range:jC,scalar:dt,tensor:di,tensor1d:fi,tensor2d:gd,tensor3d:ww,tensor4d:To,tensor5d:SN,tensor6d:EN,zeros:Wn,onesLike:qC,zerosLike:pn,transpose:Zs,softmax:su,logSoftmax:tP,localResponseNormalization:FO,norm:PT,gather:FT,unsortedSegmentSum:OT,basicLSTMCell:OO,multiRNNCell:LO,movingAverage:BO,stridedSlice:UO,topk:zO,scatterND:WO,fft:Pw,ifft:_m,rfft:LT,irfft:BT,sparseToDense:GO,gatherND:VO,dropout:jO,hannWindow:zT,hammingWindow:WT,frame:HT}),fL=(function(){function r(){if(this.blockSize=48,this.firstUse=!0,be.get("IS_BROWSER")){var e=(function(){if(typeof OffscreenCanvas<"u")return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})();this.fromPixels2DContext=e.getContext("2d")}this.data=new oT(this,ve)}return r.prototype.register=function(e,t,n){if(this.firstUse&&(this.firstUse=!1,be.get("IS_NODE")&&J0(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================
`)),this.data.has(e))throw new Error("Data buffer is already registered");this.data.set(e,{dtype:n})},r.prototype.write=function(e,t){if(t==null)throw new Error("MathBackendCPU.write(): values can not be null");this.data.get(e).values=t},r.prototype.fromPixels=function(e,t){if(e==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n,i;if(be.get("IS_NODE")&&e.getContext==null)throw new Error("When running in node, pixels must be an HTMLCanvasElement like the one returned by the `canvas` npm package");if(e.getContext!=null)n=e.getContext("2d").getImageData(0,0,e.width,e.height).data;else if(e instanceof ImageData||e.data instanceof Uint8Array)n=e.data;else{if(!(e instanceof HTMLImageElement||e instanceof HTMLVideoElement))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData or {data: Uint32Array, width: number, height: number}, but was "+e.constructor.name);if(this.fromPixels2DContext==null)throw new Error("Can't read pixels from HTMLImageElement outside the browser.");this.fromPixels2DContext.canvas.width=e.width,this.fromPixels2DContext.canvas.height=e.height,this.fromPixels2DContext.drawImage(e,0,0,e.width,e.height),n=this.fromPixels2DContext.getImageData(0,0,e.width,e.height).data}if(t===4)i=new Int32Array(n);else{var o=e.width*e.height;i=new Int32Array(o*t);for(var a=0;a<o;a++)for(var s=0;s<t;++s)i[a*t+s]=n[4*a+s]}return ww(i,[e.height,e.width,t],"int32")},r.prototype.read=function(e){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){return[2,this.readSync(e)]})})},r.prototype.readSync=function(e){var t=this.data.get(e),n=t.dtype,i=t.complexTensors;return n==="complex64"?eb(this.readSync(i.real.dataId),this.readSync(i.imag.dataId)):this.data.get(e).values},r.prototype.bufferSync=function(e){return tn(e.shape,e.dtype,this.readSync(e.dataId))},r.prototype.disposeData=function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensors;t!=null&&(t.real.dispose(),t.imag.dispose()),this.data.delete(e)}},r.prototype.time=function(e){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(n){return t=lm(),e(),[2,{kernelMs:lm()-t}]})})},r.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},r.prototype.complex=function(e,t){var n=at.make(e.shape,{},"complex64");return this.data.get(n.dataId).complexTensors={real:ve.keep(e.clone()),imag:ve.keep(t.clone())},n},r.prototype.real=function(e){return this.data.get(e.dataId).complexTensors.real.clone()},r.prototype.imag=function(e){return this.data.get(e.dataId).complexTensors.imag.clone()},r.prototype.assertNotComplex=function(e,t){Array.isArray(e)||(e=[e]),e.forEach(function(n){n!=null&&te(n.dtype!=="complex64",function(){return t+" does not support complex64 tensors."})})},r.prototype.slice=function(e,t,n){if(this.assertNotComplex(e,"slice"),rT(e.shape,t,n)){var i=iT(t,e.strides),o=Pt(n);return di(this.readSync(e.dataId).subarray(i,i+o),n,e.dtype)}for(var a=tn(n,e.dtype),s=this.bufferSync(e),u=0;u<a.size;++u){var l=a.indexToLoc(u).map(function(c,h){return c+t[h]});a.values[u]=s.get.apply(s,l)}return a.toTensor()},r.prototype.stridedSlice=function(e,t,n,i,o,a,s,u,l){this.assertNotComplex(e,"stridedSlice");var c=Sw(e.shape,t,n,i,o,a,s,u,l),h=c[0],f=c[1],m=c[2],g=f.filter(function(k,C){return m.indexOf(C)===-1});if(g.some(function(k){return k===0}))return di([],g);for(var w=tn(f,e.dtype),v=this.bufferSync(e),y=0;y<w.size;y++){for(var x=w.indexToLoc(y),E=new Array(x.length),_=0;_<E.length;_++)E[_]=x[_]*i[_]+h[_];w.set.apply(w,[v.get.apply(v,E)].concat(x))}return w.toTensor().reshape(g)},r.prototype.unstack=function(e,t){for(var n=e.shape[t],i=new Array(e.rank-1),o=0,a=0;a<e.rank;a++)a!==t&&(i[o++]=e.shape[a]);var s=new Array(e.rank).fill(0),u=e.shape.slice();u[t]=1;var l=new Array(n);for(a=0;a<l.length;a++)s[t]=a,l[a]=this.slice(e,s,u).reshape(i);return l},r.prototype.reverse=function(e,t){this.assertNotComplex(e,"reverse");for(var n=tn(e.shape,e.dtype),i=this.bufferSync(e),o=function(s){var u=n.indexToLoc(s),l=u.slice();t.forEach(function(c){return l[c]=e.shape[c]-1-l[c]}),n.set.apply(n,[i.get.apply(i,l)].concat(u))},a=0;a<n.size;a++)o(a);return n.toTensor()},r.prototype.concat=function(e,t){var n=this;this.assertNotComplex(e,"concat");var i=e.map(function(c){var h=Pt(c.shape.slice(t));return c.as2D(-1,h)}),o=Pc(i.map(function(c){return c.shape}),1),a=tn(o,e[0].dtype).values;if(i[0].shape[0]===1){var s=0;i.forEach(function(c){a.set(n.readSync(c.dataId),s),s+=c.size})}else{var u=0;i.forEach(function(c){for(var h=n.readSync(c.dataId),f=0,m=0;m<c.shape[0];++m)for(var g=m*o[1]+u,w=0;w<c.shape[1];++w)a[g+w]=h[f++];u+=c.shape[1]})}var l=Pc(e.map(function(c){return c.shape}),t);return di(a,l,e[0].dtype)},r.prototype.neg=function(e){return this.assertNotComplex(e,"neg"),this.multiply(dt(-1),e)},r.prototype.add=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(n,i,o,a){return{real:n+o,imag:i+a}}):this.broadcastedBinaryOp(e,t,or(e.dtype,t.dtype),function(n,i){return n+i})},r.prototype.addN=function(e){var t=this;this.assertNotComplex(e,"addN");for(var n=e.map(function(l){return t.readSync(l.dataId)}),i=tn(e[0].shape,e[0].dtype),o=i.values,a=0;a<e.length;a++)for(var s=n[a],u=0;u<o.length;u++)o[u]+=s[u];return i.toTensor()},r.prototype.subtract=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(n,i,o,a){return{real:n-o,imag:i-a}}):this.broadcastedBinaryOp(e,t,or(e.dtype,t.dtype),function(n,i){return n-i})},r.prototype.pow=function(e,t){return this.assertNotComplex([e,t],"pow"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){return Math.pow(n,i)})},r.prototype.batchMatMul=function(e,t,n,i){this.assertNotComplex([e,t],"matMul");for(var o=n?e.shape[1]:e.shape[2],a=n?e.shape[2]:e.shape[1],s=i?t.shape[1]:t.shape[2],u=e.shape[0],l=this.readSync(e.dataId),c=this.readSync(t.dataId),h=n?[e.strides[0],1,e.strides[1]]:[e.strides[0],e.strides[1],1],f=h[0],m=h[1],g=h[2],w=i?[1,t.strides[1],t.strides[0]]:[t.strides[1],1,t.strides[0]],v=w[0],y=w[1],x=w[2],E=a*s,_=tn([u,a,s],e.dtype),k=_.values,C=this.blockSize,R=0;R<u;R++)for(var I=0;I<a;I+=C)for(var T=0;T<s;T+=C)for(var A=0;A<o;A+=C)for(var N=Math.min(I+C,a),O=Math.min(T+C,s),V=Math.min(A+C,o),F=I;F<N;F++)for(var B=T;B<O;B++){for(var U=0,P=A;P<V;P++)U+=l[R*f+F*m+P*g]*c[P*v+B*y+R*x];k[R*E+(F*s+B)]+=U}return _.toTensor()},r.prototype.fusedBatchMatMul=function(e,t,n,i,o,a){var s=this.batchMatMul(e,t,n,i);return o&&(s=this.add(s,o)),a&&(s=(function(u,l,c){if(l==="linear")return u.linear(c);if(l==="relu")return u.relu(c);throw new Error("Activation "+l+" has not been implemented for the CPU backend.")})(this,a,s)),s},r.prototype.multiply=function(e,t){return e.dtype==="complex64"||t.dtype==="complex64"?this.broadcastedBinaryComplexOp(e.cast("complex64"),t.cast("complex64"),function(n,i,o,a){return{real:n*o-i*a,imag:n*a+i*o}}):this.broadcastedBinaryOp(e,t,or(e.dtype,t.dtype),function(n,i){return n*i})},r.prototype.realDivide=function(e,t){return this.assertNotComplex([e,t],"realDivide"),this.broadcastedBinaryOp(e,t,"float32",function(n,i){return n/i})},r.prototype.floorDiv=function(e,t){return this.assertNotComplex([e,t],"floorDiv"),this.broadcastedBinaryOp(e,t,"int32",function(n,i){return Math.floor(n/i)})},r.prototype.sum=function(e,t){this.assertNotComplex(e,"sum"),Ii("sum",t,e.rank);for(var n=Lr(e.shape,t),i=n[0],o=n[1],a=Wn(i,or(e.dtype,"int32")),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=0,m=0;m<s;++m)f+=l[h+m];u[c]=f}return a},r.prototype.prod=function(e,t){this.assertNotComplex(e,"sum");for(var n=Lr(e.shape,t),i=n[0],o=n[1],a=Wn(i,or(e.dtype,"int32")),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=1,m=0;m<s;++m)f*=l[h+m];u[c]=f}return a},r.prototype.unsortedSegmentSum=function(e,t,n){this.assertNotComplex(e,"unsortedSegmentSum");for(var i=[],o=e.rank-t.rank,a=0;a<o;++a)t=t.expandDims(a+1);for(a=0;a<n;++a){var s=dt(a,"int32"),u=AT(s,t).asType("float32").mul(e).sum(0);i.push(u)}return Oo(i)},r.prototype.argMin=function(e,t){this.assertNotComplex(e,"argMin");var n=[t];Ii("argMin",n,e.rank);for(var i=Lr(e.shape,n),o=i[0],a=i[1],s=Wn(o,"int32"),u=Pt(a),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0,w=0;w<u;++w){var v=c[f+w];v<m&&(m=v,g=w)}l[h]=g}return s},r.prototype.argMax=function(e,t){this.assertNotComplex(e,"argMax");var n=[t];Ii("argMax",n,e.rank);for(var i=Lr(e.shape,n),o=i[0],a=i[1],s=Wn(o,"int32"),u=Pt(a),l=this.readSync(s.dataId),c=this.readSync(e.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0,w=0;w<u;++w){var v=c[f+w];v>m&&(m=v,g=w)}l[h]=g}return s},r.prototype.cumsum=function(e,t,n,i){if(this.assertNotComplex(e,"cumsum"),t!==e.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(e.rank-1)+" but got axis="+t);for(var o=or(e.dtype,"int32"),a=Wn(e.shape,o),s=this.readSync(a.dataId),u=this.readSync(e.dataId),l=e.shape[e.rank-1],c=i?function(w,v){return w+l-v-1}:function(w,v){return w+v},h=0;h<u.length;h+=l)for(var f=0;f<l;f++){var m=c(h,f);if(f===0)s[m]=n?0:u[m];else{var g=c(h,f-1);s[m]=n?u[g]+s[g]:u[m]+s[g]}}return a},r.prototype.equal=function(e,t){return this.assertNotComplex([e,t],"equal"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n===i?1:0})},r.prototype.notEqual=function(e,t){return this.assertNotComplex([e,t],"notEqual"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n!==i?1:0})},r.prototype.less=function(e,t){return this.assertNotComplex([e,t],"less"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n<i?1:0})},r.prototype.lessEqual=function(e,t){return this.assertNotComplex([e,t],"lessEqual"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n<=i?1:0})},r.prototype.greater=function(e,t){return this.assertNotComplex([e,t],"greater"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n>i?1:0})},r.prototype.greaterEqual=function(e,t){return this.assertNotComplex([e,t],"greaterEqual"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n>=i?1:0})},r.prototype.logicalNot=function(e){this.assertNotComplex(e,"logicalNot");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),i=0;i<t.length;++i)n[i]=t[i]?0:1;return at.make(e.shape,{values:n},"bool")},r.prototype.logicalAnd=function(e,t){return this.assertNotComplex([e,t],"logicalAnd"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n&&i})},r.prototype.logicalOr=function(e,t){return this.assertNotComplex([e,t],"logicalOr"),this.broadcastedBinaryOp(e,t,"bool",function(n,i){return n||i})},r.prototype.select=function(e,t,n){this.assertNotComplex([e,t,n],"select");for(var i=this.readSync(e.dataId),o=this.readSync(t.dataId),a=this.readSync(n.dataId),s=Wn(t.shape,or(t.dtype,n.dtype)),u=this.readSync(s.dataId),l=0,c=e.rank===0||e.rank>1||t.rank===1?1:t.shape[1],h=0;h<i.length;h++)for(var f=0;f<c;f++)i[h]===1?u[l++]=o[h]:u[l++]=a[h];return s},r.prototype.where=function(e){this.assertNotComplex([e],"where");var t=this.readSync(e.dataId);return kw(e.shape,t)},r.prototype.topk=function(e,t,n){return this.assertNotComplex(e,"topk"),cT(this.readSync(e.dataId),e.shape,e.dtype,t)},r.prototype.min=function(e,t){this.assertNotComplex(e,"min"),Ii("min",t,e.rank);for(var n=Lr(e.shape,t),i=n[0],o=n[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];g<f&&(f=g)}u[c]=f}return a},r.prototype.minimum=function(e,t){return this.assertNotComplex([e,t],"minimum"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){return Math.min(n,i)})},r.prototype.mod=function(e,t){return this.assertNotComplex([e,t],"mod"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){var o=n%i;return n<0&&i<0||n>=0&&i>=0?o:(o+i)%i})},r.prototype.max=function(e,t){this.assertNotComplex(e,"max"),Ii("max",t,e.rank);for(var n=Lr(e.shape,t),i=n[0],o=n[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];g>f&&(f=g)}u[c]=f}return a},r.prototype.maximum=function(e,t){return this.assertNotComplex([e,t],"maximum"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){return Math.max(n,i)})},r.prototype.all=function(e,t){this.assertNotComplex(e,"all"),Ii("all",t,e.rank);for(var n=Lr(e.shape,t),i=n[0],o=n[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];f=f&&g}u[c]=f}return a},r.prototype.any=function(e,t){this.assertNotComplex(e,"any"),Ii("any",t,e.rank);for(var n=Lr(e.shape,t),i=n[0],o=n[1],a=Wn(i,e.dtype),s=Pt(o),u=this.readSync(a.dataId),l=this.readSync(e.dataId),c=0;c<u.length;++c){for(var h=c*s,f=l[h],m=0;m<s;++m){var g=l[h+m];f=f||g}u[c]=f}return a},r.prototype.squaredDifference=function(e,t){return this.assertNotComplex([e,t],"squaredDifference"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){var o=n-i;return o*o})},r.prototype.ceil=function(e){this.assertNotComplex(e,"ceil");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i)n[i]=Math.ceil(t[i]);return at.make(e.shape,{values:n})},r.prototype.floor=function(e){this.assertNotComplex(e,"floor");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i)n[i]=Math.floor(t[i]);return at.make(e.shape,{values:n})},r.prototype.sign=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i)t[i]<0?n[i]=-1:t[i]>0?n[i]=1:n[i]=0;return at.make(e.shape,{values:n})},r.prototype.isNaN=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isNaN(t[i])&&(n[i]=1);return at.make(e.shape,{values:n},"bool")},r.prototype.isInf=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),i=0;i<t.length;++i)Math.abs(t[i])===1/0&&(n[i]=1);return at.make(e.shape,{values:n},"bool")},r.prototype.isFinite=function(e){this.assertNotComplex(e,"x");for(var t=this.readSync(e.dataId),n=new Uint8Array(t.length),i=0;i<t.length;++i)Number.isFinite(t[i])&&(n[i]=1);return at.make(e.shape,{values:n},"bool")},r.prototype.round=function(e){this.assertNotComplex(e,"round");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i){var o=Math.floor(t[i]);t[i]-o<.5?n[i]=Math.floor(t[i]):t[i]-o>.5?n[i]=Math.ceil(t[i]):n[i]=o%2==0?o:o+1}return at.make(e.shape,{values:n})},r.prototype.exp=function(e){this.assertNotComplex(e,"exp");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i)n[i]=Math.exp(t[i]);return at.make(e.shape,{values:n})},r.prototype.expm1=function(e){this.assertNotComplex(e,"expm1");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i)n[i]=Math.expm1(t[i]);return at.make(e.shape,{values:n})},r.prototype.log=function(e){this.assertNotComplex(e,"log");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];n[i]=Math.log(o)}return at.make(e.shape,{values:n})},r.prototype.log1p=function(e){this.assertNotComplex(e,"log1p");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];n[i]=Math.log1p(o)}return at.make(e.shape,{values:n})},r.prototype.sqrt=function(e){this.assertNotComplex(e,"sqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];n[i]=Math.sqrt(o)}return at.make(e.shape,{values:n})},r.prototype.rsqrt=function(e){this.assertNotComplex(e,"rsqrt");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];n[i]=1/Math.sqrt(o)}return at.make(e.shape,{values:n})},r.prototype.square=function(e){this.assertNotComplex(e,"square");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i){var o=t[i];n[i]=o*o}return at.make(e.shape,{values:n})},r.prototype.reciprocal=function(e){this.assertNotComplex(e,"reciprocal");for(var t=this.readSync(e.dataId),n=new Float32Array(t.length),i=0;i<t.length;++i)n[i]=1/t[i];return at.make(e.shape,{values:n})},r.prototype.linear=function(e){return e},r.prototype.relu=function(e){this.assertNotComplex(e,"relu");for(var t=Wn(e.shape,e.dtype),n=this.readSync(t.dataId),i=this.readSync(e.dataId),o=0;o<i.length;++o)n[o]=Math.max(0,i[o]);return t},r.prototype.prelu=function(e,t){return this.assertNotComplex([e,t],"prelu"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){return n<0?i*n:n})},r.prototype.elu=function(e){this.assertNotComplex(e,"elu");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i){var o=n[i];t[i]=o>=0?o:Math.exp(o)-1}return at.make(e.shape,{values:t})},r.prototype.eluDer=function(e,t){this.assertNotComplex([e,t],"eluDer");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=this.readSync(e.dataId),a=0;a<i.length;++a){var s=i[a];n[a]=s>=1?o[a]:o[a]*(s+1)}return at.make(t.shape,{values:n})},r.prototype.selu=function(e){this.assertNotComplex(e,"selu");for(var t=Tw,n=Mw,i=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var s=o[a];i[a]=s>=0?n*s:t*(Math.exp(s)-1)}return at.make(e.shape,{values:i})},r.prototype.clip=function(e,t,n){this.assertNotComplex(e,"clip");for(var i=new Float32Array(e.size),o=this.readSync(e.dataId),a=0;a<o.length;++a){var s=o[a];i[a]=s>n?n:s<t?t:s}return at.make(e.shape,{values:i})},r.prototype.abs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.abs(n[i]);return at.make(e.shape,{values:t})},r.prototype.complexAbs=function(e){for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<e.size;++i){var o=n[2*i],a=n[2*i+1];t[i]=Math.hypot(o,a)}return at.make(e.shape,{values:t})},r.prototype.int=function(e){this.assertNotComplex(e,"int");for(var t=new Int32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=n[i];return at.make(e.shape,{values:t},"int32")},r.prototype.sigmoid=function(e){this.assertNotComplex(e,"sigmoid");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=1/(1+Math.exp(-n[i]));return at.make(e.shape,{values:t})},r.prototype.softplus=function(e){this.assertNotComplex(e,"softplus");for(var t=Math.log(11920928955078125e-23)+2,n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=i[o]>-t,s=i[o]<t,u=Math.exp(i[o]),l=void 0;l=s?u:a?i[o]:Math.log(1+u),n[o]=l}return at.make(e.shape,{values:n})},r.prototype.sin=function(e){this.assertNotComplex(e,"sin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.sin(n[i]);return at.make(e.shape,{values:t})},r.prototype.cos=function(e){this.assertNotComplex(e,"cos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.cos(n[i]);return at.make(e.shape,{values:t})},r.prototype.tan=function(e){this.assertNotComplex(e,"tan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.tan(n[i]);return at.make(e.shape,{values:t})},r.prototype.asin=function(e){this.assertNotComplex(e,"asin");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.asin(n[i]);return at.make(e.shape,{values:t})},r.prototype.acos=function(e){this.assertNotComplex(e,"acos");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.acos(n[i]);return at.make(e.shape,{values:t})},r.prototype.atan=function(e){this.assertNotComplex(e,"atan");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.atan(n[i]);return at.make(e.shape,{values:t})},r.prototype.atan2=function(e,t){return this.assertNotComplex([e,t],"atan2"),this.broadcastedBinaryOp(e,t,e.dtype,function(n,i){return Math.atan2(n,i)})},r.prototype.sinh=function(e){this.assertNotComplex(e,"sinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.sinh(n[i]);return at.make(e.shape,{values:t})},r.prototype.cosh=function(e){this.assertNotComplex(e,"cosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.cosh(n[i]);return at.make(e.shape,{values:t})},r.prototype.tanh=function(e){this.assertNotComplex(e,"tanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=ID(n[i]);return at.make(e.shape,{values:t})},r.prototype.asinh=function(e){this.assertNotComplex(e,"asinh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.asinh(n[i]);return at.make(e.shape,{values:t})},r.prototype.acosh=function(e){this.assertNotComplex(e,"acosh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.acosh(n[i]);return at.make(e.shape,{values:t})},r.prototype.atanh=function(e){this.assertNotComplex(e,"atanh");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i)t[i]=Math.atanh(n[i]);return at.make(e.shape,{values:t})},r.prototype.erf=function(e){this.assertNotComplex(e,"erf");for(var t=new Float32Array(e.size),n=this.readSync(e.dataId),i=0;i<n.length;++i){var o=n[i],a=1/(1+.3275911*o);t[i]=1-((((1.061405429*a-1.453152027)*a+1.421413741)*a-.284496736)*a+.254829592)*a*Math.exp(-o*o)}return at.make(e.shape,{values:t})},r.prototype.step=function(e,t){t===void 0&&(t=0),this.assertNotComplex(e,"step");for(var n=new Float32Array(e.size),i=this.readSync(e.dataId),o=0;o<i.length;++o){var a=i[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:t}return at.make(e.shape,{values:n})},r.prototype.conv2d=function(e,t,n){this.assertNotComplex([e,t],"conv2d");for(var i=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.padInfo.left,l=n.padInfo.top,c=tn(n.outShape,e.dtype),h=this.readSync(e.dataId),f=this.readSync(t.dataId),m=c.values,g=0;g<n.batchSize;++g)for(var w=g*e.strides[0],v=g*c.strides[0],y=0;y<n.outHeight;++y)for(var x=v+y*c.strides[1],E=y*n.strideHeight-l,_=0;_<i;_++){var k=E+_*a;if(!(k<0||k>=n.inHeight))for(var C=_*t.strides[0],R=w+k*e.strides[1],I=0;I<n.outWidth;++I)for(var T=x+I*n.outChannels,A=I*n.strideWidth-u,N=0;N<o;N++){var O=A+N*s;if(!(O<0||O>=n.inWidth))for(var V=C+N*t.strides[1],F=R+O*n.inChannels,B=V,U=0;U<n.inChannels;++U){for(var P=h[F+U],L=0;L<n.outChannels;++L)m[T+L]+=P*f[B+L];B+=n.outChannels}}}return c.toTensor()},r.prototype.conv3d=function(e,t,n){for(var i=n.filterDepth,o=n.filterHeight,a=n.filterWidth,s=n.dilationDepth,u=n.dilationHeight,l=n.dilationWidth,c=n.padInfo.front,h=n.padInfo.left,f=n.padInfo.top,m=tn(n.outShape,e.dtype),g=this.readSync(e.dataId),w=this.readSync(t.dataId),v=m.values,y=0;y<n.batchSize;++y)for(var x=y*e.strides[0],E=y*m.strides[0],_=0;_<n.outDepth;++_)for(var k=E+_*m.strides[1],C=_*n.strideDepth-c,R=0;R<i;R++){var I=C+R*s;if(!(I<0||I>=n.inDepth))for(var T=R*t.strides[0],A=x+I*e.strides[1],N=0;N<n.outHeight;++N)for(var O=k+N*m.strides[2],V=N*n.strideHeight-f,F=0;F<o;F++){var B=V+F*u;if(!(B<0||B>=n.inHeight))for(var U=T+F*t.strides[1],P=A+B*e.strides[2],L=0;L<n.outWidth;++L)for(var H=O+L*n.outChannels,W=L*n.strideWidth-h,z=0;z<a;z++){var q=W+z*l;if(!(q<0||q>=n.inWidth))for(var re=U+z*t.strides[2],de=P+q*n.inChannels,ye=re,ne=0;ne<n.inChannels;++ne){for(var ie=g[de+ne],fe=0;fe<n.outChannels;++fe)v[H+fe]+=ie*w[ye+fe];ye+=n.outChannels}}}}return m.toTensor()},r.prototype.conv2dDerInput=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerInput");for(var i=tn(n.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=this.readSync(e.dataId),h=e.strides,f=h[0],m=h[1],g=h[2],w=this.readSync(t.dataId),v=t.strides,y=v[0],x=v[1],E=v[2],_=n.batchSize,k=n.filterHeight,C=n.filterWidth,R=n.inChannels,I=n.inHeight,T=n.inWidth,A=n.outChannels,N=n.outHeight,O=n.outWidth,V=n.strideHeight,F=n.strideWidth,B=k-1-n.padInfo.top,U=C-1-n.padInfo.left,P=0;P<_;++P)for(var L=0;L<R;++L)for(var H=0;H<I;++H)for(var W=H-B,z=Math.max(0,Math.ceil(W/V)),q=Math.min(N,(k+W)/V),re=0;re<T;++re){for(var de=re-U,ye=Math.max(0,Math.ceil(de/F)),ne=Math.min(O,(C+de)/F),ie=0,fe=z;fe<q;++fe)for(var Ae=fe*V-W,De=ye;De<ne;++De)for(var Be=f*P+m*fe+g*De,lt=y*(k-1-Ae)+x*(C-1-(De*F-de))+E*L,Y=0;Y<A;++Y)ie+=c[Be+Y]*w[lt+Y];o[s*P+u*H+l*re+L]=ie}return i.toTensor()},r.prototype.conv3dDerInput=function(e,t,n){for(var i=tn(n.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(e.dataId),f=e.strides,m=f[0],g=f[1],w=f[2],v=f[3],y=this.readSync(t.dataId),x=t.strides,E=x[0],_=x[1],k=x[2],C=x[3],R=n.batchSize,I=n.filterDepth,T=n.filterHeight,A=n.filterWidth,N=n.inChannels,O=n.inDepth,V=n.inHeight,F=n.inWidth,B=n.outChannels,U=n.outDepth,P=n.outHeight,L=n.outWidth,H=n.strideDepth,W=n.strideHeight,z=n.strideWidth,q=I-1-n.padInfo.front,re=T-1-n.padInfo.top,de=A-1-n.padInfo.left,ye=0;ye<R;++ye)for(var ne=0;ne<N;++ne)for(var ie=0;ie<O;++ie)for(var fe=ie-q,Ae=Math.max(0,Math.ceil(fe/H)),De=Math.min(U,(I+fe)/H),Be=0;Be<V;++Be)for(var lt=Be-re,Y=Math.max(0,Math.ceil(lt/W)),ot=Math.min(P,(T+lt)/W),Je=0;Je<F;++Je){for(var Xe=Je-de,qe=Math.max(0,Math.ceil(Xe/z)),Tt=Math.min(L,(A+Xe)/z),Qe=0,ft=Ae;ft<De;++ft)for(var Mt=ft*H-fe,Ut=Y;Ut<ot;++Ut)for(var Z=Ut*W-lt,j=qe;j<Tt;++j)for(var me=m*ye+g*ft+w*Ut+v*j,Re=E*(I-1-Mt)+_*(T-1-Z)+k*(A-1-(j*z-Xe))+C*ne,Pe=0;Pe<B;++Pe)Qe+=h[me+Pe]*y[Re+Pe];o[s*ye+u*ie+l*Be+c*Je+ne]=Qe}return i.toTensor()},r.prototype.conv2dDerFilter=function(e,t,n){this.assertNotComplex([e,t],"conv2dDerFilter");for(var i=n.strideHeight,o=n.strideWidth,a=n.filterHeight,s=n.filterWidth,u=tn(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,h=this.bufferSync(e),f=this.bufferSync(t),m=0;m<a;++m)for(var g=Math.max(0,Math.ceil((c-m)/i)),w=Math.min(n.outHeight,(n.inHeight+c-m)/i),v=0;v<s;++v)for(var y=Math.max(0,Math.ceil((l-v)/o)),x=Math.min(n.outWidth,(n.inWidth+l-v)/o),E=0;E<n.inChannels;++E)for(var _=0;_<n.outChannels;++_){for(var k=0,C=0;C<n.batchSize;++C)for(var R=g;R<w;++R)for(var I=m+R*i-c,T=y;T<x;++T){var A=v+T*o-l;k+=h.get(C,I,A,E)*f.get(C,R,T,_)}u.set(k,m,v,E,_)}return u.toTensor()},r.prototype.conv3dDerFilter=function(e,t,n){for(var i=n.strideDepth,o=n.strideHeight,a=n.strideWidth,s=n.filterDepth,u=n.filterHeight,l=n.filterWidth,c=tn(n.filterShape,"float32"),h=c.values,f=c.strides,m=f[0],g=f[1],w=f[2],v=f[3],y=this.readSync(t.dataId),x=t.strides,E=x[0],_=x[1],k=x[2],C=x[3],R=this.readSync(e.dataId),I=e.strides,T=I[0],A=I[1],N=I[2],O=I[3],V=n.padInfo.front,F=n.padInfo.left,B=n.padInfo.top,U=0;U<s;++U)for(var P=Math.max(0,Math.ceil((V-U)/i)),L=Math.min(n.outDepth,(n.inDepth+V-U)/i),H=U*m,W=0;W<u;++W)for(var z=Math.max(0,Math.ceil((B-W)/o)),q=Math.min(n.outHeight,(n.inHeight+B-W)/o),re=W*g+H,de=0;de<l;++de)for(var ye=Math.max(0,Math.ceil((F-de)/a)),ne=Math.min(n.outWidth,(n.inWidth+F-de)/a),ie=de*w+re,fe=0;fe<n.inChannels;++fe)for(var Ae=fe*v+ie,De=0;De<n.outChannels;++De){for(var Be=0,lt=0;lt<n.batchSize;++lt)for(var Y=lt*T,ot=lt*E,Je=P;Je<L;++Je)for(var Xe=(U+Je*i-V)*A+Y,qe=Je*_+ot,Tt=z;Tt<q;++Tt)for(var Qe=(W+Tt*o-B)*N+Xe,ft=Tt*k+qe,Mt=ye;Mt<ne;++Mt){var Ut=Mt*C+ft;Be+=R[(de+Mt*a-F)*O+Qe+fe]*y[Ut+De]}h[Ae+De]=Be}return c.toTensor()},r.prototype.depthwiseConv2D=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2D");for(var i=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,s=n.dilationWidth,u=n.padInfo.left,l=n.padInfo.top,c=n.outChannels/n.inChannels,h=tn(n.outShape,e.dtype),f=this.readSync(e.dataId),m=this.readSync(t.dataId),g=h.values,w=0;w<n.batchSize;++w)for(var v=w*e.strides[0],y=w*h.strides[0],x=0;x<n.outHeight;++x)for(var E=y+x*h.strides[1],_=x*n.strideHeight-u,k=0;k<i;++k){var C=_+k*a;if(!(C<0||C>=n.inHeight))for(var R=k*t.strides[0],I=v+C*e.strides[1],T=0;T<n.outWidth;++T)for(var A=E+T*h.strides[2],N=T*n.strideWidth-l,O=0;O<o;++O){var V=N+O*s;if(!(V<0||V>=n.inWidth))for(var F=R+O*t.strides[1],B=I+V*n.inChannels,U=A,P=F,L=0;L<n.inChannels;++L){for(var H=f[B+L],W=0;W<c;++W)g[U+W]+=H*m[P+W];U+=c,P+=c}}}return h.toTensor()},r.prototype.depthwiseConv2DDerInput=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerInput");for(var i=tn(n.inShape,"float32"),o=i.values,a=i.strides,s=a[0],u=a[1],l=a[2],c=this.readSync(e.dataId),h=e.strides,f=h[0],m=h[1],g=h[2],w=this.readSync(t.dataId),v=t.strides,y=v[0],x=v[1],E=v[2],_=n.batchSize,k=n.filterHeight,C=n.filterWidth,R=n.inChannels,I=n.inHeight,T=n.inWidth,A=n.outChannels,N=n.outHeight,O=n.outWidth,V=n.strideHeight,F=n.strideWidth,B=k-1-n.padInfo.top,U=C-1-n.padInfo.left,P=A/R,L=0;L<_;++L)for(var H=0;H<R;++H)for(var W=0;W<I;++W)for(var z=W-B,q=Math.max(0,Math.ceil(z/V)),re=Math.min(N,(k+z)/V),de=0;de<T;++de){for(var ye=de-U,ne=Math.max(0,Math.ceil(ye/F)),ie=Math.min(O,(C+ye)/F),fe=0,Ae=q;Ae<re;++Ae)for(var De=Ae*V-z,Be=ne;Be<ie;++Be)for(var lt=f*L+m*Ae+g*Be,Y=y*(k-1-De)+x*(C-1-(Be*F-ye))+E*H,ot=0;ot<P;++ot)fe+=c[lt+(H*P+ot)]*w[Y+ot];o[s*L+u*W+l*de+H]=fe}return i.toTensor()},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){this.assertNotComplex([e,t],"depthwiseConv2DDerFilter");for(var i=n.strideHeight,o=n.strideWidth,a=n.filterHeight,s=n.filterWidth,u=tn(n.filterShape,"float32"),l=n.padInfo.left,c=n.padInfo.top,h=n.outChannels/n.inChannels,f=this.bufferSync(e),m=this.bufferSync(t),g=0;g<a;++g)for(var w=Math.max(0,Math.ceil((c-g)/i)),v=Math.min(n.outHeight,(n.inHeight+c-g)/i),y=0;y<s;++y)for(var x=Math.max(0,Math.ceil((l-y)/o)),E=Math.min(n.outWidth,(n.inWidth+l-y)/o),_=0;_<n.outChannels;++_){for(var k=Math.trunc(_/h),C=_%h,R=0,I=0;I<n.batchSize;++I)for(var T=w;T<v;++T)for(var A=g+T*i-c,N=x;N<E;++N){var O=y+N*o-l;R+=f.get(I,A,O,k)*m.get(I,T,N,_)}u.set(R,g,y,k,C)}return u.toTensor()},r.prototype.tile=function(e,t){return this.assertNotComplex(e,"tile"),lT(this.bufferSync(e),t)},r.prototype.pad=function(e,t,n){this.assertNotComplex(e,"pad");var i=t.map(function(h,f){return h[0]+e.shape[f]+h[1]}),o=t.map(function(h){return h[0]}),a=this.bufferSync(e),s=tn(i,e.dtype);n!==0&&s.values.fill(n);for(var u=0;u<e.size;u++){var l=a.indexToLoc(u),c=l.map(function(h,f){return h+o[f]});s.set.apply(s,[a.get.apply(a,l)].concat(c))}return s.toTensor()},r.prototype.transpose=function(e,t){this.assertNotComplex(e,"transpose");for(var n=new Array(e.rank),i=0;i<n.length;i++)n[i]=e.shape[t[i]];var o=this.readSync(e.dataId),a=tn(n,e.dtype),s=this.bufferSync(e);for(i=0;i<e.size;++i){for(var u=s.indexToLoc(i),l=new Array(u.length),c=0;c<l.length;c++)l[c]=u[t[c]];var h=a.locToIndex(l);a.values[h]=o[i]}return a.toTensor()},r.prototype.gather=function(e,t,n){this.assertNotComplex([e,t],"gather");var i=e.shape.slice(),o=this.readSync(t.dataId);i[n]=o.length;for(var a=tn(i,e.dtype),s=this.bufferSync(e),u=0;u<a.size;++u){var l=a.indexToLoc(u),c=l.slice();c[n]=o[l[n]];var h=s.locToIndex(c);a.values[u]=s.values[h]}return a.toTensor()},r.prototype.batchToSpaceND=function(e,t,n){this.assertNotComplex([e],"batchToSpaceND");var i=t.reduce(function(c,h){return c*h}),o=fm(e.shape,t,i),a=pm(o.length,t.length),s=mm(e.shape,t,i),u=QC(n,t.length),l=eT(s,n,t.length);return e.reshape(o).transpose(a).reshape(s).slice(u,l)},r.prototype.spaceToBatchND=function(e,t,n){this.assertNotComplex([e],"spaceToBatchND");var i=t.reduce(function(h,f){return h*f}),o=[[0,0]];o.push.apply(o,n);for(var a=1+t.length;a<e.shape.length;++a)o.push([0,0]);var s=e.pad(o),u=fm(s.shape,t,i,!1),l=pm(u.length,t.length,!1),c=mm(s.shape,t,i,!1);return s.reshape(u).transpose(l).reshape(c)},r.prototype.pool=function(e,t,n){this.assertNotComplex(e,"pool");for(var i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,f=n==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=this.readSync(e.dataId),g=tn(t.outShape,e.dtype),w=g.values,v=t.outShape[1]*t.outShape[2]*t.outShape[3],y=t.outShape[2]*t.outShape[3],x=t.outShape[3],E=0;E<t.batchSize;++E)for(var _=E*v,k=E*e.strides[0],C=0;C<t.inChannels;++C)for(var R=0;R<t.outHeight;++R)for(var I=R*i-c,T=Math.max(0,I),A=Math.min(t.inHeight,u+I),N=_+R*y,O=0;O<t.outWidth;++O){for(var V=O*o-h,F=Math.max(0,V),B=Math.min(t.inWidth,l+V),U=f,P=0,L=0,H=T;H<A;H+=a){for(var W=k+H*e.strides[1],z=F;z<B;z+=s){var q=m[W+z*e.strides[2]+C];n==="max"&&q>U?U=q:n==="avg"&&(P+=q,L++)}if(isNaN(U))break}w[N+O*x+C]=n==="avg"?P/L:U}return g.toTensor()},r.prototype.maxPool=function(e,t){return this.pool(e,t,"max")},r.prototype.maxPoolPositions=function(e,t){for(var n=tn(t.outShape,"int32"),i=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,l=t.effectiveFilterWidth,c=t.padInfo.top,h=t.padInfo.left,f=this.bufferSync(e),m=0;m<t.batchSize;++m)for(var g=0;g<t.inChannels;++g)for(var w=0;w<t.outHeight;++w){for(var v=w*i-c,y=v;y<0;)y+=a;for(var x=Math.min(t.inHeight,u+v),E=0;E<t.outWidth;++E){for(var _=E*o-h,k=_;k<0;)k+=s;for(var C=Math.min(t.inWidth,l+_),R=Number.NEGATIVE_INFINITY,I=-1,T=y;T<x;T+=a)for(var A=T-v,N=k;N<C;N+=s){var O=N-_,V=f.get(m,T,N,g);V>R&&(R=V,I=A*l+O)}n.set(I,m,w,E,g)}}return n.toTensor()},r.prototype.maxPoolBackprop=function(e,t,n,i){this.assertNotComplex([t,n],"maxPoolBackprop");for(var o=this.maxPoolPositions(t,i),a=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=h-1-i.padInfo.left,m=c-1-i.padInfo.top,g=tn(t.shape,"float32"),w=this.bufferSync(o),v=this.bufferSync(e),y=0;y<i.batchSize;++y)for(var x=0;x<i.inChannels;++x)for(var E=0;E<i.inHeight;++E)for(var _=0;_<i.inWidth;++_){for(var k=E-m,C=_-f,R=0,I=0;I<c;I+=u){var T=(k+I)/a;if(!(T<0||T>=i.outHeight||Math.floor(T)!==T))for(var A=0;A<h;A+=l){var N=(C+A)/s;if(!(N<0||N>=i.outWidth||Math.floor(N)!==N)){var O=c*h-1-w.get(y,T,N,x)===I*h+A?1:0;O!==0&&(R+=v.get(y,T,N,x)*O)}}}g.set(R,y,E,_,x)}return g.toTensor()},r.prototype.avgPoolBackprop=function(e,t,n){this.assertNotComplex([e,t],"avgPoolBackprop");for(var i=n.strideHeight,o=n.strideWidth,a=n.filterHeight,s=n.filterWidth,u=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterHeight,h=n.effectiveFilterWidth,f=h-1-n.padInfo.left,m=c-1-n.padInfo.top,g=tn(t.shape,"float32"),w=1/(a*s),v=this.bufferSync(e),y=0;y<n.batchSize;++y)for(var x=0;x<n.inChannels;++x)for(var E=0;E<n.inHeight;++E)for(var _=0;_<n.inWidth;++_){for(var k=E-m,C=_-f,R=0,I=0;I<c;I+=u){var T=(k+I)/i;if(!(T<0||T>=n.outHeight||Math.floor(T)!==T))for(var A=0;A<h;A+=l){var N=(C+A)/o;N<0||N>=n.outWidth||Math.floor(N)!==N||(R+=v.get(y,T,N,x))}}g.set(R*w,y,E,_,x)}return g.toTensor()},r.prototype.cast=function(e,t){return aT(e,t,this)},r.prototype.reshape=function(e,t){return Q0(e,t)},r.prototype.avgPool=function(e,t){return this.assertNotComplex(e,"avgPool"),this.pool(e,t,"avg").toFloat()},r.prototype.resizeBilinear=function(e,t,n,i){this.assertNotComplex(e,"resizeBilinear");for(var o=e.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=this.readSync(e.dataId),h=new Float32Array(Pt([a,t,n,l])),f=[i&&t>1?s-1:s,i&&n>1?u-1:u],m=[i&&t>1?t-1:t,i&&n>1?n-1:n],g=0,w=f[0]/m[0],v=f[1]/m[1],y=0;y<a;y++)for(var x=0;x<t;x++)for(var E=w*x,_=Math.floor(E),k=E-_,C=Math.min(s-1,Math.ceil(E)),R=y*e.strides[0]+_*e.strides[1],I=y*e.strides[0]+C*e.strides[1],T=0;T<n;T++)for(var A=v*T,N=Math.floor(A),O=A-N,V=Math.min(u-1,Math.ceil(A)),F=R+N*e.strides[2],B=I+N*e.strides[2],U=R+ +V*e.strides[2],P=I+V*e.strides[2],L=0;L<l;L++){var H=c[F+L],W=c[B+L],z=H+(c[U+L]-H)*O,q=z+(W+(c[P+L]-W)*O-z)*k;h[g++]=q}return di(h,[a,t,n,l])},r.prototype.resizeBilinearBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeBilinearBackprop");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],f=new Float32Array(o*a*s*u),m=[n&&c>1?a-1:a,n&&h>1?s-1:s],g=[n&&c>1?c-1:c,n&&h>1?h-1:h],w=m[0]/g[0],v=m[1]/g[1],y=this.readSync(e.dataId),x=0,E=0;E<o;E++)for(var _=E*t.strides[0],k=0;k<c;k++)for(var C=k*w,R=Math.floor(C),I=Math.min(Math.ceil(C),a-1),T=_+R*t.strides[1],A=_+I*t.strides[1],N=C-R,O=1-N,V=0;V<h;V++)for(var F=V*v,B=Math.floor(F),U=Math.min(Math.ceil(F),s-1),P=F-B,L=1-P,H=T+B*t.strides[2],W=T+U*t.strides[2],z=A+B*t.strides[2],q=A+U*t.strides[2],re=O*L,de=O*P,ye=N*L,ne=N*P,ie=0;ie<u;ie++){var fe=y[x++];f[H+ie]+=fe*re,f[W+ie]+=fe*de,f[z+ie]+=fe*ye,f[q+ie]+=fe*ne}return To(f,[o,s,a,u],t.dtype)},r.prototype.resizeNearestNeighbor=function(e,t,n,i){this.assertNotComplex(e,"resizeNearestNeighbor");for(var o=e.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=this.readSync(e.dataId),h=new Float32Array(a*t*n*l),f=[i&&t>1?s-1:s,i&&n>1?u-1:u],m=[i&&t>1?t-1:t,i&&n>1?n-1:n],g=f[0]/m[0],w=f[1]/m[1],v=0,y=0;y<a;y++)for(var x=y*e.strides[0],E=0;E<t;E++)for(var _=g*E,k=x+Math.min(s-1,i?Math.round(_):Math.floor(_))*e.strides[1],C=0;C<n;C++)for(var R=w*C,I=k+Math.min(u-1,i?Math.round(R):Math.floor(R))*e.strides[2],T=0;T<l;T++){var A=c[I+T];h[v++]=A}return di(h,[a,t,n,l],e.dtype)},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){this.assertNotComplex([e,t],"resizeNearestNeighborBackprop");for(var i=t.shape,o=i[0],a=i[1],s=i[2],u=i[3],l=e.shape,c=l[1],h=l[2],f=new Float32Array(o*a*s*u),m=this.readSync(e.dataId),g=[n&&c>1?a-1:a,n&&h>1?s-1:s],w=[n&&c>1?c-1:c,n&&h>1?h-1:h],v=g[0]/w[0],y=g[1]/w[1],x=1/v,E=1/y,_=2*Math.ceil(x)+2,k=2*Math.ceil(E)+2,C=0;C<o;C++)for(var R=C*t.strides[0],I=0;I<a;I++)for(var T=R+I*t.strides[1],A=Math.floor(I*x),N=Math.floor(A-_/2),O=0;O<s;O++)for(var V=T+O*t.strides[2],F=Math.floor(O*E),B=Math.floor(F-k/2),U=0;U<u;U++){for(var P=0,L=0;L<_;L++){var H=L+N;if(!(H<0||H>=c)){var W=R+H*e.strides[1],z=H*v;if(I===Math.min(a-1,n?Math.round(z):Math.floor(z)))for(var q=0;q<k;q++){var re=q+B;if(!(re<0||re>=h)){var de=W+re*e.strides[2],ye=re*y;O===Math.min(s-1,n?Math.round(ye):Math.floor(ye))&&(P+=m[de+U])}}}}f[V+U]=P}return To(f,t.shape,t.dtype)},r.prototype.batchNormalization=function(e,t,n,i,o,a){this.assertNotComplex([e,t,n,o,a],"batchNorm");for(var s=this.readSync(e.dataId),u=this.readSync(t.dataId),l=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),h=a?this.readSync(a.dataId):new Float32Array([0]),f=new Float32Array(s.length),m=h.length,g=c.length,w=l.length,v=u.length,y=0,x=0,E=0,_=0,k=0;k<s.length;++k)f[k]=h[y++]+(s[k]-u[x++])*c[E++]/Math.sqrt(l[_++]+i),y>=m&&(y=0),x>=v&&(x=0),E>=g&&(E=0),_>=w&&(_=0);return To(f,e.shape)},r.prototype.localResponseNormalization4D=function(e,t,n,i,o){this.assertNotComplex(e,"localResponseNormalization4D");var a=e.shape[3],s=a-1,u=this.readSync(e.dataId),l=e.size,c=new Float32Array(l);function h(w){for(var v=w%a,y=w-v+Math.max(0,v-t),x=w-v+Math.min(v+t,s),E=0;y<=x;y++){var _=u[y];E+=_*_}return E}for(var f=0;f<l;f++){var m=h(f),g=u[f]*Math.pow(n+i*m,-o);c[f]=g}return To(c,e.shape)},r.prototype.LRNGrad=function(e,t,n,i,o,a,s){this.assertNotComplex(e,"LRNGrad");for(var u=e.shape[3],l=this.readSync(e.dataId),c=this.readSync(t.dataId),h=this.readSync(n.dataId),f=new Float32Array(e.size),m=e.size,g=0;g<m;g++){for(var w=g%u,v=g-w+Math.max(0,w-i),y=g-w+Math.min(u,w+i+1),x=0,E=v;E<y;E++)x+=Math.pow(c[E],2);for(x=a*x+o,E=v;E<y;E++){var _=-2*a*s*c[E]*h[g]/x;g===E&&(_+=Math.pow(x,-s)),_*=l[g],f[E]+=_}}return To(f,e.shape)},r.prototype.multinomial=function(e,t,n,i){this.assertNotComplex(e,"multinomial");for(var o=t?e:su(e),a=o.shape[0],s=o.shape[1],u=Wn([a,n],"int32"),l=this.readSync(u.dataId),c=this.readSync(o.dataId),h=0;h<a;++h){var f=h*s,m=new Float32Array(s-1);m[0]=c[f];for(var g=1;g<m.length;++g)m[g]=m[g-1]+c[f+g];for(var w=xw(i.toString()),v=h*n,y=0;y<n;++y){var x=w();l[v+y]=m.length;for(var E=0;E<m.length;E++)if(x<m[E]){l[v+y]=E;break}}}return u},r.prototype.oneHot=function(e,t,n,i){this.assertNotComplex(e,"oneHot");var o=new Float32Array(e.size*t);o.fill(i);for(var a=this.readSync(e.dataId),s=0;s<e.size;++s)a[s]>=0&&a[s]<t&&(o[s*t+a[s]]=n);return gd(o,[e.size,t],"int32")},r.prototype.nonMaxSuppression=function(e,t,n,i,o){return this.assertNotComplex(e,"nonMaxSuppression"),Ew(this.readSync(e.dataId),this.readSync(t.dataId),n,i,o)},r.prototype.fft=function(e){return this.fftBatch(e,!1)},r.prototype.ifft=function(e){return this.fftBatch(e,!0)},r.prototype.fftBatch=function(e,t){for(var n=e.shape[0],i=e.shape[1],o=tn(e.shape,"float32"),a=tn(e.shape,"float32"),s=ua(e).as2D(n,i),u=Gs(e).as2D(n,i),l=0;l<n;l++)for(var c=s.slice([l,0],[1,i]),h=u.slice([l,0],[1,i]),f=ni(c,h),m=this.readSync(this.fftImpl(f,t).dataId),g=0;g<i;g++){var w=bS(m,g);o.values[l*i+g]=w.real,a.values[l*i+g]=w.imag}return ni(o.toTensor(),a.toTensor()).as2D(n,i)},r.prototype.fftImpl=function(e,t){var n=e.as1D(),i=n.size;if(this.isExponentOf2(i)){var o=this.fftRadix2(n,i,t).as2D(e.shape[0],e.shape[1]);return t&&(o=ni(ua(o).div(dt(i)),Gs(o).div(dt(i)))),o}var a=this.readSync(e.dataId),s=(function(u){for(var l=new Float32Array(u.length/2),c=new Float32Array(u.length/2),h=0;h<u.length;h+=2)l[h/2]=u[h],c[h/2]=u[h+1];return{real:l,imag:c}})(this.fourierTransformByMatmul(a,i,t));return ni(s.real,s.imag).as2D(e.shape[0],e.shape[1])},r.prototype.isExponentOf2=function(e){return(e&e-1)==0},r.prototype.fftRadix2=function(e,t,n){if(t===1)return e;var i=this.readSync(e.dataId),o=t/2,a=(function(v){for(var y=Math.ceil(v.length/4),x=new Float32Array(y),E=new Float32Array(y),_=0;_<v.length;_+=4)x[Math.floor(_/4)]=v[_],E[Math.floor(_/4)]=v[_+1];return{real:x,imag:E}})(i),s=ni(a.real,a.imag).as1D(),u=(function(v){for(var y=Math.floor(v.length/4),x=new Float32Array(y),E=new Float32Array(y),_=2;_<v.length;_+=4)x[Math.floor(_/4)]=v[_],E[Math.floor(_/4)]=v[_+1];return{real:x,imag:E}})(i),l=ni(u.real,u.imag).as1D();s=this.fftRadix2(s,o,n),l=this.fftRadix2(l,o,n);var c=(function(v,y){for(var x=new Float32Array(v/2),E=new Float32Array(v/2),_=0;_<Math.ceil(v/2);_++){var k=(y?2:-2)*Math.PI*(_/v);x[_]=Math.cos(k),E[_]=Math.sin(k)}return{real:x,imag:E}})(t,n),h=ni(c.real,c.imag).mul(l),f=s.add(h),m=s.sub(h),g=ua(f).concat(ua(m)),w=Gs(f).concat(Gs(m));return ni(g,w).as1D()},r.prototype.fourierTransformByMatmul=function(e,t,n){for(var i=new Float32Array(2*t),o=0;o<t;o++){for(var a=0,s=0,u=0;u<t;u++){var l=iP(o*u,t,n),c=bS(e,u);a+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}n&&(a/=t,s/=t),rP(i,a,s,o)}return i},r.prototype.depthToSpace=function(e,t,n){te(n==="NHWC",function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n}),te(t>1,function(){return"blockSize should be > 1 for depthToSpace, but was: "+t});for(var i=e.shape[0],o=e.shape[1],a=e.shape[2],s=e.shape[3],u=o*t,l=a*t,c=s/(t*t),h=this.readSync(e.dataId),f=new Float32Array(i*u*l*c),m=0,g=0;g<i;++g)for(var w=0;w<u;++w)for(var v=Math.floor(w/t),y=w%t,x=0;x<l;++x)for(var E=Math.floor(x/t),_=(y*t+x%t)*c,k=0;k<c;++k){var C=k+_+s*(E+a*(v+o*g));f[m++]=h[C]}return To(f,[i,u,l,c])},r.prototype.broadcastedBinaryOp=function(e,t,n,i){var o=cn(e.shape,t.shape),a=tn(o,n),s=this.readSync(e.dataId),u=this.readSync(t.dataId),l=mc(e.shape,o),c=mc(t.shape,o),h=a.values;if(l.length+c.length===0)for(var f=0;f<h.length;++f)h[f]=i(s[f%s.length],u[f%u.length]);else{var m=this.bufferSync(e),g=this.bufferSync(t),w=function(v){var y=a.indexToLoc(v),x=y.slice(-e.rank);l.forEach(function(C){return x[C]=0});var E=m.locToIndex(x),_=y.slice(-t.rank);c.forEach(function(C){return _[C]=0});var k=g.locToIndex(_);h[v]=i(s[E],u[k])};for(f=0;f<h.length;++f)w(f)}return a.toTensor()},r.prototype.broadcastedBinaryComplexOp=function(e,t,n){var i=cn(e.shape,t.shape),o=tn(i,"float32"),a=tn(i,"float32"),s=this.readSync(e.dataId),u=this.readSync(t.dataId),l=mc(e.shape,i),c=mc(t.shape,i),h=o.values,f=a.values;if(l.length+c.length===0)for(var m=0;m<h.length;m++){var g=m%s.length,w=m%u.length,v=n(s[2*g],s[2*g+1],u[2*w],u[2*w+1]);h[m]=v.real,f[m]=v.imag}else{var y=this.bufferSync(this.data.get(e.dataId).complexTensors.real),x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),E=function(_){var k=o.indexToLoc(_),C=k.slice(-e.rank);l.forEach(function(N){return C[N]=0});var R=y.locToIndex(C),I=k.slice(-t.rank);c.forEach(function(N){return I[N]=0});var T=x.locToIndex(I),A=n(s[2*R],s[2*R+1],u[2*T],u[2*T+1]);h[_]=A.real,f[_]=A.imag};for(m=0;m<h.length;m++)E(m)}return this.complex(o.toTensor(),a.toTensor())},r.prototype.split=function(e,t,n){return uT(e,t,n)},r.prototype.dispose=function(){},r.prototype.floatPrecision=function(){return 32},r.prototype.epsilon=function(){return 1e-7},r.prototype.cropAndResize=function(e,t,n,i,o,a){for(var s=e.shape,u=s[0],l=s[1],c=s[2],h=s[3],f=t.shape[0],m=i[0],g=i[1],w=tn([f,m,g,h],e.dtype),v=this.readSync(t.dataId),y=this.readSync(n.dataId),x=this.readSync(e.dataId),E=e.strides,_=w.strides,k=0;k<f;k++){var C=4*k,R=v[C],I=v[C+1],T=v[C+2],A=v[C+3],N=y[k];if(!(N>=u))for(var O=m>1?(T-R)*(l-1)/(m-1):0,V=g>1?(A-I)*(c-1)/(g-1):0,F=0;F<m;F++){var B=m>1?R*(l-1)+F*O:.5*(R+T)*(l-1);if(B<0||B>l-1)for(var U=0;U<g;U++)for(var P=0;P<h;P++){var L=P+U*_[2]+F*_[1]+k*_[0];w.values[L]=a}else if(o==="bilinear"){var H=Math.floor(B),W=Math.ceil(B),z=B-H;for(U=0;U<g;U++)if((De=g>1?I*(c-1)+U*V:.5*(I+A)*(c-1))<0||De>c-1)for(P=0;P<h;P++)L=P+U*_[2]+F*_[1]+k*_[0],w.values[L]=a;else{var q=Math.floor(De),re=Math.ceil(De),de=De-q;for(P=0;P<h;P++){var ye=x[L=P+q*E[2]+H*E[1]+N*E[0]],ne=x[L=P+re*E[2]+H*E[1]+N*E[0]],ie=x[L=P+q*E[2]+W*E[1]+N*E[0]],fe=ye+(ne-ye)*de,Ae=ie+(x[L=P+re*E[2]+W*E[1]+N*E[0]]-ie)*de;L=P+U*_[2]+F*_[1]+k*_[0],w.values[L]=fe+(Ae-fe)*z}}}else for(U=0;U<g;++U){var De;if((De=g>1?I*(c-1)+U*V:.5*(I+A)*(c-1))<0||De>c-1)for(P=0;P<h;P++)L=P+U*_[2]+F*_[1]+k*_[0],w.values[L]=a;else{var Be=Math.round(De),lt=Math.round(B);for(P=0;P<h;P++){var Y=P+Be*E[2]+lt*E[1]+N*E[0],ot=P+U*_[2]+F*_[1]+k*_[0];w.values[ot]=x[Y]}}}}}return w.toTensor()},r.prototype.sparseToDense=function(e,t,n,i){var o=gm(0,e,n),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize;return this.scatter(e,t,n,c,u,s,a,l,i,!1)},r.prototype.gatherND=function(e,t){var n=t.shape,i=n[n.length-1],o=tT(e,t),a=o[0],s=o[1],u=o[2],l=o[3];if(s===0)return di([],a,e.dtype);for(var c=new Zh([s,u],e.dtype),h=this.readSync(t.dataId),f=this.readSync(e.dataId),m=0;m<s;m++){for(var g=[],w=0,v=0;v<i;v++){var y=h[m*i+v];w+=y*l[v],g.push(y)}if(w<0||w>=e.size/u)throw new Error("Invalid indices: "+g+" does not index into "+e.shape);for(var x=0;x<u;x++)c.values[m*u+x]=f[w*u+x]}return c.toTensor().reshape(a)},r.prototype.scatterND=function(e,t,n){var i=gm(0,e,n),o=i.sliceRank,a=i.numUpdates,s=i.sliceSize,u=i.strides,l=i.outputSize,c=dt(0);return this.scatter(e,t,n,l,s,a,o,u,c,!0)},r.prototype.fill=function(e,t,n){var i=um(n=n||fd(t),Pt(e));return i.fill(t),at.make(e,{values:i},n)},r.prototype.onesLike=function(e){if(e.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(e.shape,1,e.dtype)},r.prototype.zerosLike=function(e){var t=um(e.dtype,Pt(e.shape));return at.make(e.shape,{values:t},e.dtype)},r.prototype.linspace=function(e,t,n){return sT(e,t,n)},r.prototype.scatter=function(e,t,n,i,o,a,s,u,l,c){var h=[i/o,o],f=this.readSync(e.dataId),m=this.readSync(t.dataId);if(i===0)return di([],n,t.dtype);var g=new Zh(h,t.dtype);g.values.fill(this.readSync(l.dataId)[0]);for(var w=0;w<a;w++){for(var v=[],y=0,x=0;x<s;x++){var E=f[w*s+x];v.push(E),y+=E*u[x]}if(y<0||y>=i/o)throw new Error("Invalid indices: "+v+" does not index into "+n);for(var _=0;_<o;_++)c?g.values[y*o+_]+=m[w*o+_]:g.values[y*o+_]=t.rank===0?m[0]:m[w*o+_]}return g.toTensor().reshape(n)},r})();ve.registerBackend("cpu",function(){return new fL},1);var pL=(function(){function r(){this.textEncoder=new TextEncoder,this.textDecoder=new TextDecoder}return r.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},r.prototype.decodeUTF8=function(e){return this.textDecoder.decode(e)},r.prototype.fetch=function(e,t){return fetch(e,t)},r})();be.get("IS_BROWSER")&&be.setPlatform("browser",new pL);var Py,mL=function(){return require("node-fetch")},gL=(function(){function r(){var e=require("util");this.textEncoder=new e.TextEncoder,this.textDecoder=new e.TextDecoder}return r.prototype.encodeUTF8=function(e){return this.textEncoder.encode(e)},r.prototype.decodeUTF8=function(e){return e.length===0?"":this.textDecoder.decode(e)},r.prototype.fetch=function(e,t){return be.global.fetch!=null?be.global.fetch(e,t):(Py==null&&(Py=mL()),Py(e,t))},r})();be.get("IS_NODE")&&be.setPlatform("node",new gL);var nb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function PS(r){return nb?Buffer.byteLength(r):new Blob([r]).size}function vL(r){var e=0;r.forEach(function(i){e+=i.byteLength});var t=new Uint8Array(e),n=0;return r.forEach(function(i){t.set(new Uint8Array(i),n),n+=i.byteLength}),t.buffer}function ng(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:PS(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:PS(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var nl=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var i=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach(function(o){var a=o(e,n);a!==null&&i.push(a)}),i},r})(),FS="://",jT=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){te(e!=null,function(){return"scheme must not be undefined or null."}),e.endsWith(FS)&&(e=e.slice(0,e.indexOf(FS))),te(e.length>0,function(){return"scheme must not be an empty string."});var n=r.getInstance();te(n.managers[e]==null,function(){return"A model store manager is already registered for scheme '"+e+"'."}),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r})(),qu="models_store",Vs="model_info_store";function qT(){if(!be.getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function rb(r){var e=r.result;e.createObjectStore(qu,{keyPath:"modelPath"}),e.createObjectStore(Vs,{keyPath:"modelPath"})}var _c=(function(){function r(e){if(this.indexedDB=qT(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]})})},r.prototype.load=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(e){return[2,this.databaseAction(this.modelPath)]})})},r.prototype.databaseAction=function(e,t){var n=this;return new Promise(function(i,o){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return rb(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(qu,"readonly"),l=u.objectStore(qu).get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(w){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=ng(t),f=s.transaction(Vs,"readwrite"),m=f.objectStore(Vs),g=m.put({modelPath:n.modelPath,modelArtifactsInfo:h});g.onsuccess=function(){var w=(c=s.transaction(qu,"readwrite")).objectStore(qu).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:h});w.onsuccess=function(){return i({modelArtifactsInfo:h})},w.onerror=function(v){var y=(m=f.objectStore(Vs)).delete(n.modelPath);y.onsuccess=function(){return s.close(),o(w.error)},y.onerror=function(x){return s.close(),o(w.error)}}},g.onerror=function(w){return s.close(),o(g.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}})},r.URL_SCHEME="indexeddb://",r})(),OS=function(r){return be.getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(_c.URL_SCHEME)?(e=r.slice(_c.URL_SCHEME.length),new _c(e)):null;var e};nl.registerSaveRouter(OS),nl.registerLoadRouter(OS);var yL=(function(){function r(){this.indexedDB=qT()}return r.prototype.listModels=function(){return Gt(this,void 0,void 0,function(){var e=this;return Vt(this,function(t){return[2,new Promise(function(n,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return rb(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(Vs,"readonly"),u=s.objectStore(Vs).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}n(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}})]})})},r.prototype.removeModel=function(e){return Gt(this,void 0,void 0,function(){var t=this;return Vt(this,function(n){var i;return e=(i=e).startsWith(_c.URL_SCHEME)?i.slice(_c.URL_SCHEME.length):i,[2,new Promise(function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return rb(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(Vs,"readwrite"),h=c.objectStore(Vs),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var m=h.delete(e),g=function(){var w=(u=l.transaction(qu,"readwrite")).objectStore(qu).delete(e);w.onsuccess=function(){return o(f.result.modelArtifactsInfo)},w.onerror=function(v){return a(f.error)}};m.onsuccess=g,m.onerror=function(w){return g(),l.close(),a(f.error)}},f.onerror=function(m){return l.close(),a(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}})]})})},r})();if(be.getBool("IS_BROWSER"))try{jT.registerManager(_c.URL_SCHEME,new yL)}catch{}var za="/",lc="tensorflowjs_models",$T="info",bL="model_topology",wL="weight_specs",_L="weight_data",xL="model_metadata";function XT(r){return{info:[lc,r,$T].join(za),topology:[lc,r,bL].join(za),weightSpecs:[lc,r,wL].join(za),weightData:[lc,r,_L].join(za),modelMetadata:[lc,r,xL].join(za)}}function SL(r){var e=r.split(za);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(za)}var xc=(function(){function r(e){if(!be.getBool("IS_BROWSER")||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=XT(this.modelPath)}return r.prototype.save=function(e){return Gt(this,void 0,void 0,function(){var t,n,i;return Vt(this,function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),i=ng(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(a=e.weightData,nb?Buffer.from(a).toString("base64"):btoa(String.fromCharCode.apply(null,new Uint8Array(a))))),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}var a;return[2]})})},r.prototype.load=function(){return Gt(this,void 0,void 0,function(){var e,t,n,i,o,a,s;return Vt(this,function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(l){if(nb){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),m=0;m<h.length;++m)f.set([h.charCodeAt(m)],m);return f.buffer})(s),[2,t]})})},r.URL_SCHEME="localstorage://",r})(),LS=function(r){return be.getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(xc.URL_SCHEME)?(e=r.slice(xc.URL_SCHEME.length),new xc(e)):null;var e};nl.registerSaveRouter(LS),nl.registerLoadRouter(LS);var EL=(function(){function r(){te(be.getBool("IS_BROWSER"),function(){return"Current environment is not a web browser"}),te(window.localStorage!==void 0,function(){return"Current browser does not appear to support localStorage"}),this.LS=window.localStorage}return r.prototype.listModels=function(){return Gt(this,void 0,void 0,function(){var e,t,n,i,o,a;return Vt(this,function(s){for(e={},t=lc+za,n=za+$T,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(n)&&(a=SL(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]})})},r.prototype.removeModel=function(e){return Gt(this,void 0,void 0,function(){var t,n;return Vt(this,function(i){var o;if(e=(o=e).startsWith(xc.URL_SCHEME)?o.slice(xc.URL_SCHEME.length):o,t=XT(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]})})},r})();if(be.getBool("IS_BROWSER"))try{jT.registerManager(xc.URL_SCHEME,new EL)}catch{}var kL="model",CL=".json",TL=".weights.bin";function BS(r){return new Promise(function(e){return setTimeout(e)}).then(r)}var Fy=(function(){function r(e){if(!be.getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=kL),this.modelTopologyFileName=e+CL,this.weightDataFileName=e+TL}return r.prototype.save=function(e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s;return Vt(this,function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,BS(function(){return a.dispatchEvent(new MouseEvent("click"))})];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,BS(function(){return s.dispatchEvent(new MouseEvent("click"))})]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:ng(e)}]}})})},r.URL_SCHEME="downloads://",r})();function US(r,e,t,n){(function(o){te(o!=null&&Array.isArray(o)&&o.length>0,function(){return"promises must be a none empty array"})})(r),(function(o,a){te(o>=0&&o<=1,function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o}),te(a>=0&&a<=1,function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a}),te(a>=o,function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a})})(t=t??0,n=n??1);var i=0;return Promise.all(r.map(function(o){return o.then(function(a){var s=t+ ++i/r.length*(n-t);return e(s),a}),o}))}function ML(r,e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s,u,l,c;return Vt(this,function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?LC:e.fetchFunc,n=r.map(function(f){return t(f,e.requestInit)}),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return a=h.sent(),[3,4];case 2:return[4,US(n,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map(function(f){return f.arrayBuffer()}),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,US(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}})})}nl.registerSaveRouter(function(r){return be.getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Fy.URL_SCHEME)?(e=r.slice(Fy.URL_SCHEME.length),e===void 0&&(e="model"),new Fy(e)):null;var e});var YT=(function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(te(typeof t.fetchFunc=="function",function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"}),this.fetch=t.fetchFunc):this.fetch=LC,te(e!=null&&e.length>0,function(){return"URL path for http must not be null, undefined or empty."}),Array.isArray(e)&&te(e.length===2,function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."}),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return Gt(this,void 0,void 0,function(){var t,n,i,o;return Vt(this,function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:ng(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}})})},r.prototype.load=function(){return Gt(this,void 0,void 0,function(){var e,t,n,i,o,a,s,u;return Vt(this,function(l){switch(l.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=l.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");l.label=2;case 2:return l.trys.push([2,4,,5]),[4,e.json()];case 3:return t=l.sent(),[3,5];case 4:throw l.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.modelTopology,o=t.weightsManifest,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:u=l.sent(),a=u[0],s=u[1],l.label=7;case 7:return[2,{modelTopology:i,weightSpecs:a,weightData:s}]}})})},r.prototype.loadWeights=function(e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s,u,l,c,h,f;return Vt(this,function(m){switch(m.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=(function(g){var w=g.lastIndexOf("/"),v=g.lastIndexOf("?"),y=g.substring(0,w),x=v>w?g.substring(v):"";return[y+"/",x]})(t),i=n[0],o=n[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach(function(g){g.paths.forEach(function(w){h.push(a+w+o)})}),[4,ML(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=m.sent(),[2,[s,vL(f)]]}})})},r.URL_SCHEME_REGEX=/^https?:\/\//,r})();function zS(r){return r.match(YT.URL_SCHEME_REGEX)!=null}var WS=function(r,e){return(Array.isArray(r)?r.every(function(t){return zS(t)}):zS(r))?AL(r,{onProgress:e}):null};function AL(r,e){return new YT(r,e)}nl.registerSaveRouter(WS),nl.registerLoadRouter(WS);ue({confusionMatrix_:function(r,e,t){var n=J(r,"labels","confusionMatrix"),i=J(e,"predictions","confusionMatrix");te(t==null||t>0&&Number.isInteger(t),function(){return"If provided, numClasses must be a positive integer, but got "+t}),te(n.rank===1,function(){return"Expected the rank of labels to be 1, but got "+n.rank}),te(i.rank===1,function(){return"Expected the rank of predictions to be 1, but got "+i.rank}),te(n.shape[0]===i.shape[0],function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."}),te(t>0&&Number.isInteger(t),function(){return"numClasses is required to be a positive integer, but got "+t});var o=Z0(n.asType("int32"),t),a=Z0(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var RL=ue({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");return ve.fromPixels(r,e)}}),IL=Object.freeze({toPixels:function(r,e){return Gt(this,void 0,void 0,function(){var t,n,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,R,I;return Vt(this,function(T){switch(T.label){case 0:if(t=J(r,"img","toPixels"),r instanceof at||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),i=n[0],o=n[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=T.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=T.sent(),h=c[0],f=c[1],m=h[0],g=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(m<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+m+" - "+g+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(m<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+m+" - "+g+"].")}for(w=t.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),y=0;y<i*o;++y)x=void 0,E=void 0,_=void 0,k=void 0,a===1?(x=s[y]*w,E=s[y]*w,_=s[y]*w,k=255):a===3?(x=s[3*y]*w,E=s[3*y+1]*w,_=s[3*y+2]*w,k=255):a===4&&(x=s[4*y]*w,E=s[4*y+1]*w,_=s[4*y+2]*w,k=s[4*y+3]*w),v[0+(C=4*y)]=Math.round(x),v[C+1]=Math.round(E),v[C+2]=Math.round(_),v[C+3]=Math.round(k);return e!=null&&(e.width=o,e.height=i,R=e.getContext("2d"),I=new ImageData(v,o,i),R.putImageData(I,0,0)),t!==r&&t.dispose(),[2,v]}})})},fromPixels:RL}),DL=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r})(),NL=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r})();function ul(r){te(r.className!=null,function(){return"Class being registered does not have the static className property defined."}),te(typeof r.className=="string",function(){return"className is required to be a string, but got type "+typeof r.className}),te(r.className.length>0,function(){return"Class being registered has an empty-string as its className, which is disallowed."}),NL.register(r)}var ll=(function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return Ja(e,r),e.prototype.minimize=function(t,n,i){n===void 0&&(n=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map(function(l){return{name:l.name,tensor:s[l.name]}});this.applyGradients(u)}else this.applyGradients(s);return yi(s),n?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return eP(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&yi(this.iterations_)},e.prototype.saveIterations=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:dt(this.iterations_,"int32")}]})})},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())})})},e.prototype.extractIterations=function(t){return Gt(this,void 0,void 0,function(){var n;return Vt(this,function(i){switch(i.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,t.slice(1)]}})})},e})(DL);Object.defineProperty(ll,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var PL=(function(r){function e(t,n,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=ve.backend.epsilon()),o}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:Rt(function(){return pn(a).variable(!1)})}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:Rt(function(){return pn(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedGrads[o].variable,l=n.accumulatedUpdates[o].variable;Rt(function(){var c=u.mul(n.rho).add(s.square().mul(1-n.rho)),h=l.add(n.epsilon).sqrt().div(u.add(n.epsilon).sqrt()).mul(s),f=l.mul(n.rho).add(h.square().mul(1-n.rho));u.assign(c),l.assign(f);var m=h.mul(-n.learningRate).add(a);a.assign(m)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(yi(this.accumulatedGrads.map(function(t){return t.variable})),yi(this.accumulatedUpdates.map(function(t){return t.variable})))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){var n;return Vt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedUpdates=t.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="AdadeltaOptimizer",e})(ll);ul(PL);var FL=(function(r){function e(t,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:Rt(function(){return yc(a.shape,n.initialAccumulatorValue).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedGrads[o].variable;Rt(function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(ve.backend.epsilon()).sqrt()).mul(-n.learningRate).add(a);a.assign(c)})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&yi(this.accumulatedGrads.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e})(ll);ul(FL);var OL=(function(r){function e(t,n,i,o){o===void 0&&(o=null);var a=r.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],Rt(function(){a.accBeta1=dt(n).variable(),a.accBeta2=dt(i).variable()}),o==null&&(a.epsilon=ve.backend.epsilon()),a}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Rt(function(){var o=xi(1,n.accBeta1),a=xi(1,n.accBeta2);i.forEach(function(s,u){var l=ve.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:Rt(function(){return pn(l).variable(!1)})}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:Rt(function(){return pn(l).variable(!1)})});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=n.accumulatedFirstMoment[u].variable,f=n.accumulatedSecondMoment[u].variable,m=h.mul(n.beta1).add(c.mul(1-n.beta1)),g=f.mul(n.beta2).add(c.square().mul(1-n.beta2)),w=m.div(o),v=g.div(a);h.assign(m),f.assign(g);var y=w.div(v.sqrt().add(n.epsilon)).mul(-n.learningRate).add(l);l.assign(y)}}),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&yi(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedSecondMoment!=null&&yi(this.accumulatedSecondMoment.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){var n,i=this;return Vt(this,function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),Rt(function(){i.accBeta1.assign(wm(i.beta1,i.iterations_+1)),i.accBeta2.assign(wm(i.beta2,i.iterations_+1))}),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),this.accumulatedSecondMoment=t.slice(n,2*n).map(function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e})(ll);ul(OL);var LL=(function(r){function e(t,n,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],Rt(function(){s.iteration=dt(0).variable(),s.accBeta1=dt(n).variable()}),o==null&&(s.epsilon=ve.backend.epsilon()),s}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map(function(o){return o.name}):Object.keys(t);Rt(function(){var o=xi(1,n.accBeta1),a=ta(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach(function(s,u){var l=ve.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:pn(l).variable(!1)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:pn(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=n.accumulatedFirstMoment[u].variable,f=n.accumulatedWeightedInfNorm[u].variable,m=h.mul(n.beta1).add(c.mul(1-n.beta1)),g=f.mul(n.beta2),w=c.abs(),v=g.maximum(w);h.assign(m),f.assign(v);var y=a.div(o).mul(m.div(v.add(n.epsilon))).add(l);l.assign(y)}}),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))}),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&yi(this.accumulatedFirstMoment.map(function(t){return t.variable})),this.accumulatedWeightedInfNorm!=null&&yi(this.accumulatedWeightedInfNorm.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){throw new Error("getWeights() is not implemented for Adamax yet.")})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(n){throw new Error("setWeights() is not implemented for Adamax yet.")})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e})(ll);ul(LL);var KT=(function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=ve.registeredVariables[i];Rt(function(){var u=n.c.mul(a).add(s);s.assign(u)})}}),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=wN(dt(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e})(ll);ul(KT);var BL=(function(r){function e(t,n,i){i===void 0&&(i=!1);var o=r.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=i,o.accumulations=[],o.m=dt(o.momentum),o}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];n.accumulations[o]==null&&(n.accumulations[o]={originalName:i+"/momentum",variable:Rt(function(){return pn(a).variable(!1)})});var s=n.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&Rt(function(){var l,c=n.m.mul(s).add(u);l=n.useNesterov?n.c.mul(u.add(c.mul(n.m))).add(a):n.c.mul(c).add(a),s.assign(c),a.assign(l)})}),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&yi(this.accumulations.map(function(t){return t.variable}))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){return Vt(this,function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map(function(n){return{name:n.originalName,tensor:n.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){return Vt(this,function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map(function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}}),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="MomentumOptimizer",e})(KT);ul(BL);var UL=(function(r){function e(t,n,i,o,a){n===void 0&&(n=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=r.call(this)||this;return s.learningRate=t,s.decay=n,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=ve.backend.epsilon()),s}return Ja(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map(function(i){return i.name}):Object.keys(t)).forEach(function(i,o){var a=ve.registeredVariables[i];n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:Rt(function(){return pn(a).variable(!1)})}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:Rt(function(){return pn(a).variable(!1)})}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:Rt(function(){return pn(a).variable(!1)})});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedMeanSquares[o].variable,l=n.accumulatedMoments[o].variable;Rt(function(){var c=u.mul(n.decay).add(s.square().mul(1-n.decay));if(n.centered){var h=n.accumulatedMeanGrads[o].variable,f=h.mul(n.decay).add(s.mul(1-n.decay)),m=l.mul(n.momentum).add(s.mul(n.learningRate).div(c.sub(f.square().add(n.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(m);var g=a.sub(m);a.assign(g)}else{var w=u.mul(n.decay).add(s.square().mul(1-n.decay));m=l.mul(n.momentum).add(s.mul(n.learningRate).div(w.add(n.epsilon).sqrt())),u.assign(w),l.assign(m),g=a.sub(m),a.assign(g)}})}}),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&yi(this.accumulatedMeanSquares.map(function(t){return t.variable})),this.accumulatedMeanGrads!=null&&this.centered&&yi(this.accumulatedMeanGrads.map(function(t){return t.variable})),this.accumulatedMoments!=null&&yi(this.accumulatedMoments.map(function(t){return t.variable}))},e.prototype.getWeights=function(){return Gt(this,void 0,void 0,function(){var t;return Vt(this,function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map(function(i){return{name:i.originalName,tensor:i.variable}}))]}})})},e.prototype.setWeights=function(t){return Gt(this,void 0,void 0,function(){var n;return Vt(this,function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.accumulatedMoments=t.slice(n,2*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map(function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}})})},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e})(ll);ul(UL);Me=dL;var JT=function(r,e){return(JT=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])})(r,e)};function Wo(r,e){function t(){this.constructor=r}JT(r,e),r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function wt(r,e,t,n){return new(t||(t=Promise))((function(i,o){function a(l){try{u(n.next(l))}catch(c){o(c)}}function s(l){try{u(n.throw(l))}catch(c){o(c)}}function u(l){l.done?i(l.value):new t((function(c){c(l.value)})).then(a,s)}u((n=n.apply(r,[])).next())}))}function _t(r,e){var t,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function s(u){return function(l){return(function(c){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,n=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(c[0]===6||c[0]===2)){a=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(c[0]===6&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=e.call(r,a)}catch(h){c=[6,h],n=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}})([u,l])}}}var zL=(function(){function r(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return r.prototype.setPlatform=function(e,t){this.platform!=null&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+t+"."),this.platformName=e,this.platform=t},r.prototype.registerFlag=function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},this.urlFlags[e]!=null){var i=this.urlFlags[e];console.warn("Setting feature override from URL "+e+": "+i+"."),this.set(e,i)}},r.prototype.get=function(e){return e in this.flags?this.flags[e]:(this.flags[e]=this.evaluateFlag(e),this.flags[e])},r.prototype.getNumber=function(e){return this.get(e)},r.prototype.getBool=function(e){return this.get(e)},r.prototype.getFlags=function(){return this.flags},Object.defineProperty(r.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),r.prototype.set=function(e,t){if(this.flagRegistry[e]==null)throw new Error("Cannot set flag "+e+" as it has not been registered.");this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)},r.prototype.evaluateFlag=function(e){if(this.flagRegistry[e]==null)throw new Error("Cannot evaluate flag '"+e+"': no evaluation function found.");return this.flagRegistry[e].evaluationFn()},r.prototype.setFlags=function(e){this.flags=Object.assign({},e)},r.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},r.prototype.populateURLFlags=function(){var e=this;if(this.global!==void 0&&this.global.location!==void 0&&this.global.location.search!==void 0){var t,n,i=(t=this.global.location.search,n={},t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(o){for(var a=[],s=1;s<arguments.length;s++)a[s-1]=arguments[s];return WL(n,a[0],a[1]),a.join("=")})),n);"tfjsflags"in i&&i.tfjsflags.split(",").forEach((function(o){var a=o.split(":"),s=a[0],u=a[1];e.urlFlags[s]=(function(l,c){if((c=c.toLowerCase())==="true"||c==="false")return c==="true";if(""+ +c===c)return+c;throw new Error("Could not parse value flag value "+c+" for flag "+l+".")})(s,u)}))}},r})();function WL(r,e,t){r[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Ne(){return ZT}var ZT=null,xm=new Map,ib=new Map;function QT(r,e){var t=t3(r,e);return xm.get(t)}function HS(r){return ib.get(r)}function GS(r){for(var e=xm.entries(),t=[];;){var n=e.next(),i=n.done,o=n.value;if(i)break;var a=o[0],s=o[1];a.split("_")[0]===r&&t.push(s)}return t}function e3(r){var e=r.kernelName,t=r.backendName,n=t3(e,t);if(xm.has(n))throw new Error("The kernel '"+e+"' for backend '"+t+"' is already registered");xm.set(n,r)}function HL(r){var e=r.kernelName;ib.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),ib.set(e,r)}function t3(r,e){return e+"_"+r}function ob(r,e,t){return Math.max(r,Math.min(e,t))}function n3(r){return r%2==0?r:r+1}function GL(r){for(var e=0,t=0;t<r.length;t++)e+=r[t];return e}function K(r,e){if(!r)throw new Error(typeof e=="string"?e:e())}function En(r,e,t){t===void 0&&(t=""),K(wr(r,e),(function(){return t+" Shapes "+r+" and "+e+" must match"}))}function Kc(r){K(r!=null,(function(){return"The input to the tensor constructor must be a non-null value."}))}function Oc(r,e,t){if(e===void 0&&(e=[]),t===void 0&&(t=!1),e==null&&(e=[]),Array.isArray(r)||da(r)&&!t)for(var n=0;n<r.length;++n)Oc(r[n],e,t);else e.push(r);return e}function bt(r){if(r.length===0)return 1;for(var e=r[0],t=1;t<r.length;t++)e*=r[t];return e}function wr(r,e){if(r===e)return!0;if(r==null||e==null||r.length!==e.length)return!1;for(var t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Jn(r){return r%1==0}function VL(r){if(Math.tanh!=null)return Math.tanh(r);if(r===1/0)return 1;if(r===-1/0)return-1;var e=Math.exp(2*r);return(e-1)/(e+1)}function ab(r){var e=Math.ceil(Math.sqrt(r));return[e,Math.ceil(r/e)]}function Sc(r,e){return e<=r.length?r:r+" ".repeat(e-r.length)}function VS(r,e,t){return e===void 0&&(e=function(n){return 0}),new Promise((function(n,i){var o=0,a=function(){if(r())n();else{o++;var s=e(o);t!=null&&o>=t?i():setTimeout(a,s)}};a()}))}function jL(r,e){for(var t=1,n=-1,i=0;i<r.length;++i)if(r[i]>=0)t*=r[i];else if(r[i]===-1){if(n!==-1)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+n+" and dim "+i);n=i}else if(r[i]<0)throw Error("Shapes can not be < 0. Found "+r[i]+" at dim "+i);if(n===-1){if(e>0&&e!==t)throw Error("Size("+e+") must match the product of shape "+r);return r}if(t===0)throw Error("Cannot infer the missing size in ["+r+"] when there are 0 elements");if(e%t!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+t);var o=r.slice();return o[n]=e/t,o}function dr(r,e){var t=e.length;return K((r=r==null?e.map((function(n,i){return i})):[].concat(r)).every((function(n){return n>=-t&&n<t})),(function(){return"All values in axis param must be in range [-"+t+", "+t+") but got axis "+r})),K(r.every((function(n){return Jn(n)})),(function(){return"All values in axis param must be integers but got axis "+r})),r.map((function(n){return n<0?t+n:n}))}function Hu(r,e){for(var t=[],n=[],i=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||i?null:dr(e,r).sort(),a=0,s=0;s<r.length;++s){if(o!=null){if(o[a]===s&&r[s]!==1)throw new Error("Can't squeeze axis "+s+" since its dim '"+r[s]+"' is not 1");(o[a]==null||o[a]>s)&&r[s]===1&&(t.push(r[s]),n.push(s)),o[a]<=s&&a++}r[s]!==1&&(t.push(r[s]),n.push(s))}return{newShape:t,keptDims:n}}function Lc(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else{if(r!=="bool")throw new Error("Unknown data type "+r);t=new Uint8Array(e)}return t}function Sm(r,e){var t=null;if(r==null||r==="float32")t=new Float32Array(e);else if(r==="int32")t=new Int32Array(e);else if(r==="bool")t=new Uint8Array(e);else{if(r!=="string")throw new Error("Unknown data type "+r);t=new Array(e)}return t}function qL(r,e){for(var t=0;t<r.length;t++){var n=r[t];if(isNaN(n)||!isFinite(n))throw Error("A tensor of type "+e+" being uploaded contains "+n+".")}}function $L(r){return r==="bool"||r==="complex64"||r==="float32"||r==="int32"||r==="string"}function XL(r,e){return e!=="complex64"&&(e!=="float32"||r==="complex64")&&(e!=="int32"||r==="float32"||r==="complex64")&&(e!=="bool"||r!=="bool")}function da(r){return r instanceof Float32Array||r instanceof Int32Array||r instanceof Uint8Array}function r3(r){if(r==="float32"||r==="int32")return 4;if(r==="complex64")return 8;if(r==="bool")return 1;throw new Error("Unknown dtype "+r)}function YL(r){if(r==null)return 0;var e=0;return r.forEach((function(t){return e+=t.length})),e}function Fw(r){return typeof r=="string"||r instanceof String}function KL(r){return typeof r=="boolean"}function JL(r){return typeof r=="number"}function kd(r){return Array.isArray(r)?kd(r[0]):r instanceof Float32Array?"float32":r instanceof Int32Array||r instanceof Uint8Array?"int32":JL(r)?"float32":Fw(r)?"string":KL(r)?"bool":"float32"}function sb(r){return!!(r&&r.constructor&&r.call&&r.apply)}function ub(r,e){for(var t=e;t<r;++t)if(r%t==0)return t;return r}function Wi(r){var e=r.length;if(e<2)return[];var t=new Array(e-1);t[e-2]=r[e-1];for(var n=e-3;n>=0;--n)t[n]=t[n+1]*r[n+1];return t}function i3(r,e,t){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(r)&&(r=Oc(r)),t&&qL(r,e),(function(o,a){return o instanceof Float32Array&&a==="float32"||o instanceof Int32Array&&a==="int32"||o instanceof Uint8Array&&a==="bool"})(r,e))return r;if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool"){for(var n=new Uint8Array(r.length),i=0;i<n.length;++i)Math.round(r[i])!==0&&(n[i]=1);return n}throw new Error("Unknown data type "+e)}function jS(r,e){if(r.length===0)return e[0];var t=r.reduce((function(n,i){return n*i}));if(t===0)return[];if(t!==e.length)throw new Error("["+r+"] does not match the input size.");return(function n(i,o,a){var s=new Array;if(o.length===1)for(var u=o[0],l=0;l<u;l++)s[l]=a[i+l];else{u=o[0];var c=o.slice(1),h=c.reduce((function(f,m){return f*m}));for(l=0;l<u;l++)s[l]=n(i+l*h,c,a)}return s})(0,r,e)}function o3(r,e){for(var t=Cd(r,e),n=0;n<t.length;n++)t[n]=1;return t}function Cd(r,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(r);if(e==="int32")return new Int32Array(r);if(e==="bool")return new Uint8Array(r);throw new Error("Unknown data type "+e)}function na(){return Ne().platform.now()}function a3(r){r.forEach((function(e){K(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+r+"]."}))}))}function ZL(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ne().platform.encode(r,e)}function Em(r,e){return e===void 0&&(e="utf-8"),e=e||"utf-8",Ne().platform.decode(r,e)}function lb(r,e,t){if(e===0)return 0;if(e===1)return r[0];for(var n=r[r.length-1],i=0;i<r.length-1;++i)n+=t[i]*r[i];return n}function s3(r,e,t){if(e===0)return[];if(e===1)return[r];for(var n=new Array(e),i=0;i<n.length-1;++i)n[i]=Math.floor(r/t[i]),r-=n[i]*t[i];return n[n.length-1]=r,n}var QL=(function(){function r(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new eB)}return r.prototype.profileKernel=function(e,t,n){var i,o=this,a=this.backendTimer.time((function(){i=n()}));return i.forEach((function(s){s.data().then((function(u){(function(l,c,h){if(c!=="float32")return!1;for(var f=0;f<l.length;f++){var m=l[f];if(isNaN(m)||!isFinite(m))return console.warn("Found "+m+" in the result of '"+h+"'"),!0}})(u,s.dtype,e),a.then((function(l){var c="";l.getExtraProfileInfo!=null&&(c=l.getExtraProfileInfo()),o.logger.logKernelProfile(e,s,u,l.kernelMs,t,c)}))}))})),i},r})(),eB=(function(){function r(){}return r.prototype.logKernelProfile=function(e,t,n,i,o,a){var s=typeof i=="number"?Sc(i+"ms",9):i.error,u=Sc(e,25),l=t.rank,c=t.size,h=Sc(t.shape.toString(),14),f="";for(var m in o){var g=o[m].shape||t.shape,w=g.length;f+=m+": "+w+"D "+(w>0?g:"")+" "}console.log("%c"+u+"	%c"+s+"	%c"+l+"D "+h+"	%c"+c+"	%c"+f+"	%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},r})(),qS=20,Lh=3,Oy=7;function tB(r,e,t,n){var i=Wi(e),o=(function(l,c,h,f){var m=bt(c),g=f[f.length-1],w=new Array(g).fill(0),v=c.length,y=h==="complex64"?Uh(l):l;if(v>1)for(var x=0;x<m/g;x++)for(var E=x*g,_=0;_<g;_++)w[_]=Math.max(w[_],Bh(y[E+_],0,h).length);return w})(r,e,t,i),a=e.length,s=(function l(c,h,f,m,g,w){w===void 0&&(w=!0);var v=f==="complex64"?2:1,y=h[0],x=h.length;if(x===0)return f==="complex64"?[Bh(Uh(c)[0],0,f)]:f==="bool"?[u3(c[0])]:[c[0].toString()];if(x===1){if(y>qS){var E=Lh*v,_=Array.from(c.slice(0,E)),k=Array.from(c.slice((y-Lh)*v,y*v));return f==="complex64"&&(_=Uh(_),k=Uh(k)),["["+_.map((function(B,U){return Bh(B,g[U],f)})).join(", ")+", ..., "+k.map((function(B,U){return Bh(B,g[y-Lh+U],f)})).join(", ")+"]"]}return["["+(f==="complex64"?Uh(c):Array.from(c)).map((function(B,U){return Bh(B,g[U],f)})).join(", ")+"]"]}var C=h.slice(1),R=m.slice(1),I=m[0]*v,T=[];if(y>qS){for(var A=0;A<Lh;A++){var N=(O=A*I)+I;T.push.apply(T,l(c.slice(O,N),C,f,R,g,!1))}for(T.push("..."),A=y-Lh;A<y;A++)N=(O=A*I)+I,T.push.apply(T,l(c.slice(O,N),C,f,R,g,A===y-1))}else for(A=0;A<y;A++){var O;N=(O=A*I)+I,T.push.apply(T,l(c.slice(O,N),C,f,R,g,A===y-1))}var V=x===2?",":"";for(T[0]="["+T[0]+V,A=1;A<T.length-1;A++)T[A]=" "+T[A]+V;var F=`,
`;for(A=2;A<x;A++)F+=`
`;return T[T.length-1]=" "+T[T.length-1]+"]"+(w?"":F),T})(r,e,t,i,o),u=["Tensor"];return n&&(u.push("  dtype: "+t),u.push("  rank: "+a),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(l){return"    "+l})).join(`
`)),u.join(`
`)}function Bh(r,e,t){return Sc(Array.isArray(r)?parseFloat(r[0].toFixed(Oy))+" + "+parseFloat(r[1].toFixed(Oy))+"j":Fw(r)?"'"+r+"'":t==="bool"?u3(r):parseFloat(r.toFixed(Oy)).toString(),e)}function u3(r){return r===0?"false":"true"}function Uh(r){for(var e=[],t=0;t<r.length;t+=2)e.push([r[t],r[t+1]]);return e}var td=(function(){function r(e,t,n){var i=this;if(this.dtype=t,this.shape=e.slice(),this.size=bt(e),n!=null){var o=n.length;K(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+i.size+"'."}))}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||Sm(t,this.size),this.strides=Wi(e)}return r.prototype.set=function(e){for(var t=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];n.length===0&&(n=[0]),K(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+t.rank+")"}));var o=this.locToIndex(n);this.values[o]=e},r.prototype.get=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];e.length===0&&(e=[0]);for(var n=0,i=0,o=e;i<o.length;i++){var a=o[i];if(a<0||a>=this.shape[n]){var s="Requested out of range element at "+e+".   Buffer shape="+this.shape;throw new Error(s)}n++}for(var u=e[e.length-1],l=0;l<e.length-1;++l)u+=this.strides[l]*e[l];return this.values[u]},r.prototype.locToIndex=function(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t},r.prototype.indexToLoc=function(e){if(this.rank===0)return[];if(this.rank===1)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.toTensor=function(){return oa().makeTensor(this.values,this.shape,this.dtype)},r})(),oa=null,Ie=null,l3=null,Nn=(function(){function r(e,t,n,i){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=bt(e),this.strides=Wi(e),this.dataId=n,this.id=i,this.rankType=this.rank<5?this.rank.toString():"higher"}return r.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},r.prototype.asScalar=function(){return this.throwIfDisposed(),K(this.size===1,(function(){return"The array must have only 1 element."})),this.reshape([])},r.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},r.prototype.as2D=function(e,t){return this.throwIfDisposed(),this.reshape([e,t])},r.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),this.reshape([e,t,n])},r.prototype.as4D=function(e,t,n,i){return this.throwIfDisposed(),this.reshape([e,t,n,i])},r.prototype.as5D=function(e,t,n,i,o){return this.throwIfDisposed(),this.reshape([e,t,n,i,o])},r.prototype.asType=function(e){return this.throwIfDisposed(),Ie.cast(this,e)},Object.defineProperty(r.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),r.prototype.buffer=function(){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,Ie.buffer(this.shape,this.dtype,e)]}}))}))},r.prototype.bufferSync=function(){return Ie.buffer(this.shape,this.dtype,this.dataSync())},r.prototype.array=function(){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){switch(t.label){case 0:return[4,this.data()];case 1:return e=t.sent(),[2,jS(this.shape,e)]}}))}))},r.prototype.arraySync=function(){return jS(this.shape,this.dataSync())},r.prototype.data=function(){return wt(this,void 0,void 0,(function(){var e,t;return _t(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),e=oa().read(this.dataId),this.dtype!=="string"?[3,2]:[4,e];case 1:t=n.sent();try{return[2,t.map((function(i){return Em(i)}))]}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,e]}}))}))},r.prototype.dataSync=function(){this.throwIfDisposed();var e=oa().readSync(this.dataId);if(this.dtype==="string")try{return e.map((function(t){return Em(t)}))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e},r.prototype.bytes=function(){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){switch(t.label){case 0:return this.throwIfDisposed(),[4,oa().read(this.dataId)];case 1:return e=t.sent(),this.dtype==="string"?[2,e]:[2,new Uint8Array(e.buffer)]}}))}))},r.prototype.dispose=function(){this.isDisposed||(oa().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(r.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),r.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},r.prototype.toFloat=function(){return this.asType("float32")},r.prototype.toInt=function(){return this.asType("int32")},r.prototype.toBool=function(){return this.asType("bool")},r.prototype.print=function(e){return e===void 0&&(e=!1),Ie.print(this,e)},r.prototype.reshape=function(e){return this.throwIfDisposed(),Ie.reshape(this,e)},r.prototype.reshapeAs=function(e){return this.throwIfDisposed(),this.reshape(e.shape)},r.prototype.expandDims=function(e){return e===void 0&&(e=0),Ie.expandDims(this,e)},r.prototype.cumsum=function(e,t,n){return e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1),Ie.cumsum(this,e,t,n)},r.prototype.squeeze=function(e){return this.throwIfDisposed(),Ie.squeeze(this,e)},r.prototype.clone=function(){return this.throwIfDisposed(),Ie.clone(this)},r.prototype.toString=function(e){return e===void 0&&(e=!1),tB(this.dataSync(),this.shape,this.dtype,e)},r.prototype.gather=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ie.gather(this,e,t)},r.prototype.matMul=function(e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!1),this.throwIfDisposed(),Ie.matMul(this,e,t,n)},r.prototype.dot=function(e){return this.throwIfDisposed(),Ie.dot(this,e)},r.prototype.norm=function(e,t,n){return e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1),this.throwIfDisposed(),Ie.norm(this,e,t,n)},r.prototype.slice=function(e,t){return this.throwIfDisposed(),Ie.slice(this,e,t)},r.prototype.reverse=function(e){return this.throwIfDisposed(),Ie.reverse(this,e)},r.prototype.concat=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),e instanceof r&&(e=[e]),Ie.concat([this].concat(e),t)},r.prototype.split=function(e,t){return t===void 0&&(t=0),this.throwIfDisposed(),Ie.split(this,e,t)},r.prototype.stack=function(e,t){return t===void 0&&(t=0),Ie.stack([this,e],t)},r.prototype.unstack=function(e){return e===void 0&&(e=0),Ie.unstack(this,e)},r.prototype.batchNormalization=function(e,t,n,i,o){return n===void 0&&(n=.001),l3("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(e,t,o,i,n)},r.prototype.all=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.all(this,e,t)},r.prototype.any=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.any(this,e,t)},r.prototype.logSumExp=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.logSumExp(this,e,t)},r.prototype.sum=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.sum(this,e,t)},r.prototype.prod=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.prod(this,e,t)},r.prototype.mean=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.mean(this,e,t)},r.prototype.min=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.min(this,e,t)},r.prototype.max=function(e,t){return e===void 0&&(e=null),t===void 0&&(t=!1),this.throwIfDisposed(),Ie.max(this,e,t)},r.prototype.argMin=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ie.argMin(this,e)},r.prototype.argMax=function(e){return e===void 0&&(e=null),this.throwIfDisposed(),Ie.argMax(this,e)},r.prototype.cast=function(e){return this.throwIfDisposed(),Ie.cast(this,e)},r.prototype.addStrict=function(e){return this.throwIfDisposed(),Ie.addStrict(this,e)},r.prototype.atan2=function(e){return this.throwIfDisposed(),Ie.atan2(this,e)},r.prototype.sub=function(e){return this.throwIfDisposed(),Ie.sub(this,e)},r.prototype.subStrict=function(e){return this.throwIfDisposed(),Ie.subStrict(this,e)},r.prototype.pow=function(e){return this.throwIfDisposed(),Ie.pow(this,e)},r.prototype.powStrict=function(e){return this.throwIfDisposed(),Ie.powStrict(this,e)},r.prototype.mul=function(e){return this.throwIfDisposed(),Ie.mul(this,e)},r.prototype.mulStrict=function(e){return this.throwIfDisposed(),Ie.mulStrict(this,e)},r.prototype.floorDiv=function(e){return this.throwIfDisposed(),Ie.floorDiv(this,e)},r.prototype.divStrict=function(e){return this.throwIfDisposed(),Ie.divStrict(this,e)},r.prototype.minimum=function(e){return this.throwIfDisposed(),Ie.minimum(this,e)},r.prototype.minimumStrict=function(e){return this.throwIfDisposed(),Ie.minimumStrict(this,e)},r.prototype.maximum=function(e){return this.throwIfDisposed(),Ie.maximum(this,e)},r.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Ie.maximumStrict(this,e)},r.prototype.mod=function(e){return this.throwIfDisposed(),Ie.mod(this,e)},r.prototype.modStrict=function(e){return this.throwIfDisposed(),Ie.modStrict(this,e)},r.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Ie.squaredDifferenceStrict(this,e)},r.prototype.notEqual=function(e){return this.throwIfDisposed(),Ie.notEqual(this,e)},r.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Ie.notEqualStrict(this,e)},r.prototype.less=function(e){return this.throwIfDisposed(),Ie.less(this,e)},r.prototype.lessStrict=function(e){return this.throwIfDisposed(),Ie.lessStrict(this,e)},r.prototype.equal=function(e){return this.throwIfDisposed(),Ie.equal(this,e)},r.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ie.equalStrict(this,e)},r.prototype.lessEqual=function(e){return this.throwIfDisposed(),Ie.lessEqual(this,e)},r.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),Ie.lessEqualStrict(this,e)},r.prototype.greater=function(e){return this.throwIfDisposed(),Ie.greater(this,e)},r.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Ie.greaterStrict(this,e)},r.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ie.greaterEqual(this,e)},r.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Ie.greaterEqualStrict(this,e)},r.prototype.logicalAnd=function(e){return this.throwIfDisposed(),Ie.logicalAnd(this,e)},r.prototype.logicalOr=function(e){return this.throwIfDisposed(),Ie.logicalOr(this,e)},r.prototype.logicalNot=function(){return this.throwIfDisposed(),Ie.logicalNot(this)},r.prototype.logicalXor=function(e){return this.throwIfDisposed(),Ie.logicalXor(this,e)},r.prototype.where=function(e,t){return this.throwIfDisposed(),Ie.where(e,this,t)},r.prototype.neg=function(){return this.throwIfDisposed(),Ie.neg(this)},r.prototype.ceil=function(){return this.throwIfDisposed(),Ie.ceil(this)},r.prototype.floor=function(){return this.throwIfDisposed(),Ie.floor(this)},r.prototype.sign=function(){return this.throwIfDisposed(),Ie.sign(this)},r.prototype.isNaN=function(){return this.throwIfDisposed(),Ie.isNaN(this)},r.prototype.isInf=function(){return this.throwIfDisposed(),Ie.isInf(this)},r.prototype.isFinite=function(){return this.throwIfDisposed(),Ie.isFinite(this)},r.prototype.exp=function(){return this.throwIfDisposed(),Ie.exp(this)},r.prototype.expm1=function(){return this.throwIfDisposed(),Ie.expm1(this)},r.prototype.log=function(){return this.throwIfDisposed(),Ie.log(this)},r.prototype.log1p=function(){return this.throwIfDisposed(),Ie.log1p(this)},r.prototype.sqrt=function(){return this.throwIfDisposed(),Ie.sqrt(this)},r.prototype.rsqrt=function(){return this.throwIfDisposed(),Ie.rsqrt(this)},r.prototype.square=function(){return this.throwIfDisposed(),Ie.square(this)},r.prototype.reciprocal=function(){return this.throwIfDisposed(),Ie.reciprocal(this)},r.prototype.abs=function(){return this.throwIfDisposed(),Ie.abs(this)},r.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),Ie.clipByValue(this,e,t)},r.prototype.relu=function(){return this.throwIfDisposed(),Ie.relu(this)},r.prototype.relu6=function(){return this.throwIfDisposed(),Ie.relu6(this)},r.prototype.elu=function(){return this.throwIfDisposed(),Ie.elu(this)},r.prototype.selu=function(){return this.throwIfDisposed(),Ie.selu(this)},r.prototype.leakyRelu=function(e){return e===void 0&&(e=.2),this.throwIfDisposed(),Ie.leakyRelu(this,e)},r.prototype.prelu=function(e){return this.throwIfDisposed(),Ie.prelu(this,e)},r.prototype.sigmoid=function(){return this.throwIfDisposed(),Ie.sigmoid(this)},r.prototype.logSigmoid=function(){return this.throwIfDisposed(),Ie.logSigmoid(this)},r.prototype.softplus=function(){return this.throwIfDisposed(),Ie.softplus(this)},r.prototype.zerosLike=function(){return this.throwIfDisposed(),Ie.zerosLike(this)},r.prototype.onesLike=function(){return this.throwIfDisposed(),Ie.onesLike(this)},r.prototype.sin=function(){return this.throwIfDisposed(),Ie.sin(this)},r.prototype.cos=function(){return this.throwIfDisposed(),Ie.cos(this)},r.prototype.tan=function(){return this.throwIfDisposed(),Ie.tan(this)},r.prototype.asin=function(){return this.throwIfDisposed(),Ie.asin(this)},r.prototype.acos=function(){return this.throwIfDisposed(),Ie.acos(this)},r.prototype.atan=function(){return this.throwIfDisposed(),Ie.atan(this)},r.prototype.sinh=function(){return this.throwIfDisposed(),Ie.sinh(this)},r.prototype.cosh=function(){return this.throwIfDisposed(),Ie.cosh(this)},r.prototype.tanh=function(){return this.throwIfDisposed(),Ie.tanh(this)},r.prototype.asinh=function(){return this.throwIfDisposed(),Ie.asinh(this)},r.prototype.acosh=function(){return this.throwIfDisposed(),Ie.acosh(this)},r.prototype.atanh=function(){return this.throwIfDisposed(),Ie.atanh(this)},r.prototype.erf=function(){return this.throwIfDisposed(),Ie.erf(this)},r.prototype.round=function(){return this.throwIfDisposed(),Ie.round(this)},r.prototype.step=function(e){return e===void 0&&(e=0),this.throwIfDisposed(),Ie.step(this,e)},r.prototype.softmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ie.softmax(this,e)},r.prototype.logSoftmax=function(e){return e===void 0&&(e=-1),this.throwIfDisposed(),Ie.logSoftmax(this,e)},r.prototype.resizeBilinear=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ie.image.resizeBilinear(this,e,t)},r.prototype.resizeNearestNeighbor=function(e,t){return t===void 0&&(t=!1),this.throwIfDisposed(),Ie.image.resizeNearestNeighbor(this,e,t)},r.prototype.conv1d=function(e,t,n,i,o,a){return i===void 0&&(i="NWC"),o===void 0&&(o=1),this.throwIfDisposed(),Ie.conv1d(this,e,t,n,i,o,a)},r.prototype.conv2d=function(e,t,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Ie.conv2d(this,e,t,n,i,o,a)},r.prototype.conv2dTranspose=function(e,t,n,i,o){return this.throwIfDisposed(),Ie.conv2dTranspose(this,e,t,n,i,o)},r.prototype.depthwiseConv2D=function(e,t,n,i,o,a){return i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]),this.throwIfDisposed(),Ie.depthwiseConv2d(this,e,t,n,i,o,a)},r.prototype.separableConv2d=function(e,t,n,i,o,a){return o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC"),this.throwIfDisposed(),Ie.separableConv2d(this,e,t,n,i,o,a)},r.prototype.avgPool=function(e,t,n,i){return this.throwIfDisposed(),Ie.avgPool(this,e,t,n,i)},r.prototype.maxPool=function(e,t,n,i){return this.throwIfDisposed(),Ie.maxPool(this,e,t,n,i)},r.prototype.localResponseNormalization=function(e,t,n,i){return e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5),Ie.localResponseNormalization(this,e,t,n,i)},r.prototype.pool=function(e,t,n,i,o){return this.throwIfDisposed(),Ie.pool(this,e,t,n,i,o)},r.prototype.variable=function(e,t,n){return e===void 0&&(e=!0),this.throwIfDisposed(),oa().makeVariable(this,e,t,n)},r.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),Ie.unsortedSegmentSum(this,e,t)},r.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),Ie.batchToSpaceND(this,e,t)},r.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Ie.spaceToBatchND(this,e,t)},r.prototype.topk=function(e,t){return e===void 0&&(e=1),t===void 0&&(t=!0),this.throwIfDisposed(),Ie.topk(this,e,t)},r.prototype.stridedSlice=function(e,t,n,i,o,a,s,u){return i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),this.throwIfDisposed(),Ie.stridedSlice(this,e,t,n,i,o,a,s,u)},r.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Ie.depthToSpace(this,e,t)},r.prototype.fft=function(){return this.throwIfDisposed(),Ie.spectral.fft(this)},r.prototype.ifft=function(){return this.throwIfDisposed(),Ie.spectral.ifft(this)},r.prototype.rfft=function(){return this.throwIfDisposed(),Ie.spectral.rfft(this)},r.prototype.irfft=function(){return this.throwIfDisposed(),Ie.spectral.irfft(this)},r})();Object.defineProperty(Nn,Symbol.hasInstance,{value:function(r){return!!r&&r.dataId!=null&&r.shape!=null&&r.dtype!=null}});var $S,cb,hb,db,fb,Bc=(function(r){function e(t,n,i,o){var a=r.call(this,t.shape,t.dtype,t.dataId,o)||this;return a.trainable=n,a.name=i,a}return Wo(e,r),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!wr(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");oa().disposeTensor(this),this.dataId=t.dataId,oa().incRef(this,null)},e.prototype.dispose=function(){oa().disposeVariable(this),this.isDisposedInternal=!0},e})(Nn);Object.defineProperty(Bc,Symbol.hasInstance,{value:function(r){return r instanceof Nn&&r.assign!=null&&r.assign instanceof Function}}),(function(r){r.R0="R0",r.R1="R1",r.R2="R2",r.R3="R3",r.R4="R4",r.R5="R5",r.R6="R6"})($S||($S={})),(function(r){r.float32="float32",r.int32="int32",r.bool="int32",r.complex64="complex64"})(cb||(cb={})),(function(r){r.float32="float32",r.int32="int32",r.bool="bool",r.complex64="complex64"})(hb||(hb={})),(function(r){r.float32="float32",r.int32="float32",r.bool="float32",r.complex64="complex64"})(db||(db={})),(function(r){r.float32="complex64",r.int32="complex64",r.bool="complex64",r.complex64="complex64"})(fb||(fb={}));var nB={float32:db,int32:cb,bool:hb,complex64:fb};function kr(r,e){if(r==="string"||e==="string"){if(r==="string"&&e==="string")return"string";throw new Error("Can not upcast "+r+" with "+e)}return nB[r][e]}function Ly(r){return kr(r,"int32")}function Gn(r,e){if(r.dtype===e.dtype)return[r,e];var t=kr(r.dtype,e.dtype);return[r.cast(t),e.cast(t)]}function rB(r,e){K(r.dtype===e.dtype,(function(){return"The dtypes of the first("+r.dtype+") and second("+e.dtype+") input must match"}))}function c3(r){var e=[];return(function t(n,i,o){if(n!=null){if(n instanceof Nn)return void i.push(n);if(a=n,!(!Array.isArray(a)&&typeof a!="object")){var a,s=n;for(var u in s){var l=s[u];o.has(l)||(o.add(l),t(l,i,o))}}}})(r,e,new Set),e}var By,XS=(function(){function r(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return r.prototype.dispose=function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()},r})(),iB=(function(){function r(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new XS}return r.prototype.ready=function(){return wt(this,void 0,void 0,(function(){var e,t,n;return _t(this,(function(i){switch(i.label){case 0:if(this.pendingBackendInit!=null)return[2,this.pendingBackendInit.then((function(){}))];if(this.backendInstance!=null)return[2];e=this.getSortedBackends(),t=0,i.label=1;case 1:return t<e.length?(n=e[t],[4,this.initializeBackend(n).success]):[3,5];case 2:return i.sent()?[4,this.setBackend(n)]:[3,4];case 3:return i.sent(),[2];case 4:return t++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(r.prototype,"backend",{get:function(){if(this.pendingBackendInit!=null)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(this.backendInstance==null){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '"+t+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance},enumerable:!0,configurable:!0}),r.prototype.backendNames=function(){return Object.keys(this.registryFactory)},r.prototype.findBackend=function(e){return!(e in this.registry)&&(!(e in this.registryFactory)||this.initializeBackend(e).asyncInit)?null:this.registry[e]},r.prototype.findBackendFactory=function(e){return e in this.registryFactory?this.registryFactory[e].factory:null},r.prototype.registerBackend=function(e,t,n){return n===void 0&&(n=1),e in this.registryFactory?(console.warn(e+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)},r.prototype.setBackend=function(e){return wt(this,void 0,void 0,(function(){var t,n,i;return _t(this,(function(o){switch(o.label){case 0:if(this.registryFactory[e]==null)throw new Error("Backend name '"+e+"' not found in registry");return this.backendName=e,this.registry[e]!=null?[3,4]:(this.backendInstance=null,t=this.initializeBackend(e),n=t.success,t.asyncInit?[4,n]:[3,2]);case 1:return i=o.sent(),[3,3];case 2:i=n,o.label=3;case 3:if(!i)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new QL(this.backendInstance),[2,!0]}}))}))},r.prototype.setupRegisteredKernels=function(){var e=this;GS(this.backendName).forEach((function(t){t.setupFunc!=null&&t.setupFunc(e.backendInstance)}))},r.prototype.disposeRegisteredKernels=function(e){var t=this;GS(e).forEach((function(n){n.disposeFunc!=null&&n.disposeFunc(t.registry[e])}))},r.prototype.initializeBackend=function(e){var t=this,n=this.registryFactory[e];if(n==null)throw new Error("Cannot initialize backend "+e+", no registration found.");try{var i=n.factory();if(Promise.resolve(i)===i){var o=++this.pendingBackendInitId,a=i.then((function(s){return!(o<t.pendingBackendInitId)&&(t.registry[e]=s,t.pendingBackendInit=null,!0)})).catch((function(s){return!(o<t.pendingBackendInitId)&&(t.pendingBackendInit=null,console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),!1)}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[e]=i,{success:!0,asyncInit:!1}}catch(s){return console.warn("Initialization of backend "+e+" failed"),console.warn(s.stack||s.message),{success:!1,asyncInit:!1}}},r.prototype.removeBackend=function(e){if(!(e in this.registryFactory))throw new Error(e+" backend not found in registry");this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},r.prototype.getSortedBackends=function(){var e=this;if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))},r.prototype.initializeBackendsAndReturnBest=function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],i=this.initializeBackend(n),o=i.success,a=i.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},r.prototype.moveData=function(e,t){var n=this.state.tensorInfo.get(t),i=n.backend,o=this.readSync(t);i.disposeData(t),n.backend=e,e.move(t,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},r.prototype.tidy=function(e,t){var n,i=this,o=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}return this.scopedRun((function(){return i.startScope(o)}),(function(){return i.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},r.prototype.scopedRun=function(e,t,n){e();try{var i=n();return t(),i}catch(o){throw t(),o}},r.prototype.nextTensorId=function(){return r.nextTensorId++},r.prototype.nextVariableId=function(){return r.nextVariableId++},r.prototype.clone=function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(i){return{x:function(){return i.toFloat()}}}),[],{}),t},r.prototype.runKernel=function(e,t,n,i,o){return this.runKernelFunc(null,t,null,e,n,i,o)},r.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},r.prototype.checkKernelForMemLeak=function(e,t,n){var i=this.backend.numDataIds(),o=0;n.forEach((function(u){o+=u.dtype==="complex64"?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],s=i-t-o-a;if(s>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+s+" data ids) after running '"+e+"'")},r.prototype.runKernelFunc=function(e,t,n,i,o,a,s){var u,l=this,c=[],h=this.isTapeOn();i==null&&(i=this.state.activeScope!=null?this.state.activeScope.name:"");var f,m=this.state.numBytes,g=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var w,v=QT(i,this.backendName);if(v!=null)f=function(){var x=l.backend.numDataIds();w=v.kernelFunc({inputs:t,attrs:o,backend:l.backend});var E=Array.isArray(w)?w:[w];l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,E);var _=E.map((function(R){var I=R.dataId,T=R.shape,A=R.dtype;return l.makeTensorFromDataId(I,T,A)}));if(h){var k=l.getTensorsForGradient(i,t,_);if(k==null){s==null&&(s=[]);var C=_.filter((function(R,I){return s[I]}));k=(a||[]).slice().concat(C)}c=l.saveTensorsForBackwardMode(k)}return _};else{var y=function(x){h&&(c=x.map((function(E){return l.keep(l.clone(E))})))};f=function(){var x=l.backend.numDataIds();w=l.tidy((function(){return e(l.backend,y)}));var E=Array.isArray(w)?w:[w];return l.shouldCheckForMemLeaks()&&l.checkKernelForMemLeak(i,x,E),E}}return this.scopedRun((function(){return l.state.kernelDepth++}),(function(){return l.state.kernelDepth--}),(function(){u=l.ENV.getBool("DEBUG")?l.profiler.profileKernel(i,t,(function(){return f()})):f()})),h&&this.addTapeNode(i,t,u,n,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:i,bytesAdded:this.state.numBytes-m,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-g,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(x){return t[x].shape})),outputShapes:u.map((function(x){return x.shape}))}),Array.isArray(w)?u:u[0]},r.prototype.saveTensorsForBackwardMode=function(e){var t=this;return e.map((function(n){return t.keep(t.clone(n))}))},r.prototype.getTensorsForGradient=function(e,t,n){var i=HS(e);if(i!=null){var o=i.inputsToSave||[],a=i.outputsToSave||[],s=void 0;i.saveAllInputs?(K(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),s=Object.keys(t).map((function(l){return t[l]}))):s=o.map((function(l){return t[l]}));var u=n.filter((function(l,c){return a[c]}));return s.concat(u)}return null},r.prototype.makeTensor=function(e,t,n,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",i=i||this.backend;var o=e;n==="string"&&Fw(e[0])&&(o=e.map((function(c){return ZL(c)})));var a=i.write(o,t,n),s=new Nn(t,n,a,this.nextTensorId());if(this.incRef(s,i),n==="string"){var u=this.state.tensorInfo.get(a),l=YL(o);this.state.numBytes+=l-u.bytes,u.bytes=l}return s},r.prototype.makeTensorFromDataId=function(e,t,n,i){var o=new Nn(t,n=n||"float32",e,this.nextTensorId());return this.incRef(o,i),o},r.prototype.makeVariable=function(e,t,n,i){t===void 0&&(t=!0),n=n||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.asType(i));var o=new Bc(e,t,n,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},r.prototype.incRef=function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++,n===0){this.state.numDataBuffers++;var i=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(i=e.size*r3(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:i,refCount:0}),this.state.numBytes+=i}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof Bc||this.track(e)},r.prototype.disposeTensor=function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,e.dtype==="string"&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?(e.dtype!=="complex64"&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):this.state.tensorInfo.get(e.dataId).refCount--}},r.prototype.disposeVariables=function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}},r.prototype.disposeVariable=function(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]},r.prototype.memory=function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e},r.prototype.profile=function(e){return wt(this,void 0,void 0,(function(){var t,n;return _t(this,(function(i){return this.state.profiling=!0,t=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(o){return o.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},r.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&this.state.kernelDepth===0},r.prototype.addTapeNode=function(e,t,n,i,o,a){var s=this,u={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:o},l=HS(e);l!=null&&(i=l.gradFunc),i!=null&&(u.gradient=function(c){return c=c.map((function(h,f){if(h==null){var m=n[f],g=Cd(m.size,m.dtype);return s.makeTensor(g,m.shape,m.dtype)}return h})),i(c.length>1?c:c[0],o,a)}),this.state.activeTape.push(u)},r.prototype.keep=function(e){return e.kept=!0,e},r.prototype.startTape=function(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++},r.prototype.endTape=function(){this.state.gradientDepth--},r.prototype.startScope=function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t},r.prototype.endScope=function(e){for(var t=this,n=c3(e),i=new Set(n.map((function(u){return u.id}))),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||i.has(a.id)||a.dispose()}var s=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(u){u.kept||u.scopeId!==s.id||t.track(u)}))},r.prototype.gradients=function(e,t,n,i){var o=this;if(i===void 0&&(i=!1),K(t.length>0,(function(){return"gradients() received an empty list of xs."})),n!=null&&n.dtype!=="float32")throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",e)}));K(a instanceof Nn,(function(){return"The result y returned by f() must be a tensor."}));var s=(function(u,l,c){for(var h={},f={},m=0;m<l.length;m++)h[l[m].id]=!0;for(m=0;m<u.length;m++){var g=(C=u[m]).inputs;for(var w in g){for(var v=g[w],y=!1,x=0;x<l.length;x++)if(h[v.id]){C.outputs.forEach((function(A){return h[A.id]=!0})),y=!0,f[C.id]=!0;break}if(y)break}}var E={};E[c.id]=!0;var _={};for(m=u.length-1;m>=0;m--)for(g=(C=u[m]).inputs,x=0;x<C.outputs.length;x++)if(E[C.outputs[x].id]){for(var w in g)E[g[w].id]=!0,_[C.id]=!0;break}var k=[];for(m=0;m<u.length;m++){var C;if(f[(C=u[m]).id]&&_[C.id]){var R={};for(var w in C.inputs){var I=C.inputs[w];h[I.id]&&(R[w]=I)}var T=Object.assign({},C);T.inputs=R,T.outputs=C.outputs,k.push(T)}}return k})(this.state.activeTape,t,a);if(!i&&s.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var u,l,c={};c[a.id]=n??(u=a.shape,l=o3(bt(u),"float32"),le.makeTensor(l,u,"float32")),(function(f,m,g){for(var w=function(y){var x=m[y],E=[];if(x.outputs.forEach((function(R){var I=f[R.id];I!=null?E.push(I):E.push(null)})),x.gradient==null)throw new Error("Cannot compute gradient: gradient function not found for "+x.kernelName+".");var _=x.gradient(E),k=function(R){if(!(R in _))throw new Error("Cannot backprop through input "+R+". Available gradients found: "+Object.keys(_)+".");var I=g((function(){return _[R]()}));if(I.dtype!=="float32")throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input "+R+" must have 'float32' dtype, but has '"+I.dtype+"'");var T=x.inputs[R];if(!wr(I.shape,T.shape))throw new Error("Error in gradient for op "+x.kernelName+". The gradient of input '"+R+"' has shape '"+I.shape+"', which does not match the shape of the input '"+T.shape+"'");if(f[T.id]==null)f[T.id]=I;else{var A=f[T.id];f[T.id]=A.add(I),A.dispose()}};for(var C in x.inputs)k(C)},v=m.length-1;v>=0;v--)w(v)})(c,s,(function(f){return o.tidy(f)}));var h=t.map((function(f){return c[f.id]}));return o.state.gradientDepth===0&&(o.state.activeTape.forEach((function(f){for(var m=0,g=f.saved;m<g.length;m++)g[m].dispose()})),o.state.activeTape=null),{value:a,grads:h}}))},r.prototype.customGrad=function(e){var t=this;return K(sb(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];K(i.every((function(s){return s instanceof Nn})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return i.forEach((function(s,u){a[u]=s})),t.runKernelFunc((function(s,u){return K((n=e.apply(void 0,i.concat([u]))).value instanceof Nn,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),K(sb(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(s,u){var l=n.gradFunc(s,u),c=Array.isArray(l)?l:[l];K(c.length===i.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),K(c.every((function(f){return f instanceof Nn})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var h={};return c.forEach((function(f,m){h[m]=function(){return f}})),h}))}},r.prototype.readSync=function(e){return this.state.tensorInfo.get(e).backend.readSync(e)},r.prototype.read=function(e){return this.state.tensorInfo.get(e).backend.read(e)},r.prototype.time=function(e){return wt(this,void 0,void 0,(function(){var t,n;return _t(this,(function(i){switch(i.label){case 0:return t=na(),[4,this.backend.time(e)];case 1:return(n=i.sent()).wallMs=na()-t,[2,n]}}))}))},r.prototype.track=function(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e},Object.defineProperty(r.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),r.prototype.reset=function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new XS,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},r.nextTensorId=0,r.nextVariableId=0,r})(),le=(function(){var r=(function(){if(By==null){var t=void 0;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else{if(typeof self>"u")throw new Error("Could not find a global object");t=self}By=t}return By})();if(r._tfengine==null){var e=new zL(r);r._tfengine=new iB(e)}return(function(t){ZT=t})(r._tfengine.ENV),oa=function(){return r._tfengine},r._tfengine})();function h3(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ia=Ne();Ia.registerFlag("DEBUG",(function(){return!1}),(function(r){r&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Ia.registerFlag("IS_BROWSER",(function(){return h3()})),Ia.registerFlag("IS_NODE",(function(){return typeof process<"u"&&process.versions!==void 0&&process.versions.node!==void 0})),Ia.registerFlag("IS_CHROME",(function(){return typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Ia.registerFlag("PROD",(function(){return!1})),Ia.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Ia.getBool("DEBUG")})),Ia.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Ia.registerFlag("IS_TEST",(function(){return!1}));var nd,Li,Fi,Lu={},Uy={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function oB(r,e){Lu[r]=e}function ba(r){r in Lu||(Lu[r]=(function(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=(function(i){if(typeof OffscreenCanvas<"u"&&i===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")})(t);return n.addEventListener("webglcontextlost",(function(i){i.preventDefault(),delete Lu[t]}),!1),t===1?n.getContext("webgl",Uy)||n.getContext("experimental-webgl",Uy):n.getContext("webgl2",Uy)})(r));var e=Lu[r];return e.isContextLost()?(delete Lu[r],ba(r)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Lu[r])}function rg(r,e){return[e,r]}function $h(r){var e=bt(r);return ab(Math.ceil(e/4))}function Td(r,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(r/2))]}function Ow(r,e){var t,n,i,o,a,s,u,l,c,h=r;return Ne().getNumber("WEBGL_VERSION")===2?(t=h.R32F,n=h.R16F,i=h.RGBA16F,o=h.RGBA32F,a=h.RED,s=4,u=1,l=h.HALF_FLOAT,c=h.FLOAT):(t=r.RGBA,n=r.RGBA,i=r.RGBA,o=h.RGBA,a=r.RGBA,s=4,u=4,l=e!=null?e.HALF_FLOAT_OES:null,c=r.FLOAT),{internalFormatFloat:t,internalFormatHalfFloat:n,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:r.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:l,textureTypeFloat:c}}function kt(r,e,t){var n=t();return e&&(function(i){var o=i.getError();if(o!==i.NO_ERROR)throw new Error("WebGL Error: "+lB(i,o))})(r),n}(function(r){r[r.DENSE=0]="DENSE",r[r.SHARED_BATCH=1]="SHARED_BATCH"})(nd||(nd={})),(function(r){r[r.RENDER=0]="RENDER",r[r.UPLOAD=1]="UPLOAD",r[r.PIXELS=2]="PIXELS",r[r.DOWNLOAD=3]="DOWNLOAD"})(Li||(Li={})),(function(r){r[r.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",r[r.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",r[r.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",r[r.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",r[r.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(Fi||(Fi={}));var aB=596e-10,sB=65504;function uB(r){return!!(Ne().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||r===0||aB<Math.abs(r)&&Math.abs(r)<sB)}function lB(r,e){switch(e){case r.NO_ERROR:return"NO_ERROR";case r.INVALID_ENUM:return"INVALID_ENUM";case r.INVALID_VALUE:return"INVALID_VALUE";case r.INVALID_OPERATION:return"INVALID_OPERATION";case r.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case r.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case r.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function lp(r,e,t){return ts(r,e,(function(){return r.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function cB(r,e,t){var n=ts(r,e,(function(){return r.createShader(r.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(kt(r,e,(function(){return r.shaderSource(n,t)})),kt(r,e,(function(){return r.compileShader(n)})),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw console.log(r.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function hB(r,e,t){var n=ts(r,e,(function(){return r.createShader(r.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(kt(r,e,(function(){return r.shaderSource(n,t)})),kt(r,e,(function(){return r.compileShader(n)})),r.getShaderParameter(n,r.COMPILE_STATUS)===!1)throw(function(i,o){var a=dB.exec(o);if(a==null)return console.log("Couldn't parse line number in error: "+o),void console.log(i);for(var s=+a[1],u=i.split(`
`),l=u.length.toString().length+2,c=u.map((function(v,y){return Sc((y+1).toString(),l)+v})),h=0,f=0;f<c.length;f++)h=Math.max(c[f].length,h);var m=c.slice(0,s-1),g=c.slice(s-1,s),w=c.slice(s);console.log(m.join(`
`)),console.log(o.split(`
`)[0]),console.log("%c "+Sc(g[0],h),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(w.join(`
`))})(t,r.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var zy,Wy,dB=/ERROR: [0-9]+:([0-9]+):/g;function fB(r,e){return ts(r,e,(function(){return r.createProgram()}),"Unable to create WebGLProgram.")}function pB(r,e,t){if(kt(r,e,(function(){return r.linkProgram(t)})),r.getProgramParameter(t,r.LINK_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}function Hy(r,e,t){if(kt(r,e,(function(){return r.validateProgram(t)})),r.getProgramParameter(t,r.VALIDATE_STATUS)===!1)throw console.log(r.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function mB(r,e,t){var n=ts(r,e,(function(){return r.createBuffer()}),"Unable to create WebGLBuffer");return kt(r,e,(function(){return r.bindBuffer(r.ARRAY_BUFFER,n)})),kt(r,e,(function(){return r.bufferData(r.ARRAY_BUFFER,t,r.STATIC_DRAW)})),n}function gB(r,e,t){var n=ts(r,e,(function(){return r.createBuffer()}),"Unable to create WebGLBuffer");return kt(r,e,(function(){return r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,n)})),kt(r,e,(function(){return r.bufferData(r.ELEMENT_ARRAY_BUFFER,t,r.STATIC_DRAW)})),n}function vB(r,e){return ts(r,e,(function(){return r.createTexture()}),"Unable to create WebGLTexture.")}function yB(r,e){var t=Ne().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(r<=0||e<=0){var n="["+r+"x"+e+"]";throw new Error("Requested texture size "+n+" is invalid.")}if(r>t||e>t)throw n="["+r+"x"+e+"]",new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+("["+t+"x"+t+"]")+".")}function bB(r,e){return ts(r,e,(function(){return r.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function YS(r,e,t,n,i,o,a,s){var u=r.getAttribLocation(t,n);return u!==-1&&(kt(r,e,(function(){return r.bindBuffer(r.ARRAY_BUFFER,i)})),kt(r,e,(function(){return r.vertexAttribPointer(u,o,r.FLOAT,!1,a,s)})),kt(r,e,(function(){return r.enableVertexAttribArray(u)})),!0)}function wB(r,e,t,n){kB(r,n),kt(r,e,(function(){return r.activeTexture(r.TEXTURE0+n)})),kt(r,e,(function(){return r.bindTexture(r.TEXTURE_2D,t)}))}function _B(r,e,t,n){return ts(r,e,(function(){return r.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function xB(r,e,t){return r.getUniformLocation(e,t)}function SB(r,e,t,n,i,o){kt(r,e,(function(){return wB(r,e,n,o)})),kt(r,e,(function(){return r.uniform1i(i,o)}))}function Gy(r,e,t,n){kt(r,e,(function(){return r.bindFramebuffer(r.FRAMEBUFFER,n)})),kt(r,e,(function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0)}))}function KS(r,e,t){kt(r,e,(function(){return r.bindFramebuffer(r.FRAMEBUFFER,t)})),kt(r,e,(function(){return r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,null,0)}))}function cp(r){var e=r.checkFramebufferStatus(r.FRAMEBUFFER);if(e!==r.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+EB(r,e))}function EB(r,e){switch(e){case r.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case r.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case r.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function ts(r,e,t,n){var i=kt(r,e,(function(){return t()}));if(i==null)throw new Error(n);return i}function kB(r,e){var t=r.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+r.TEXTURE0;if(n<r.TEXTURE0||n>t)throw new Error("textureUnit must be in "+("[gl.TEXTURE0, gl.TEXTURE"+t+"]")+".")}function km(r,e){return e===void 0&&(e=2),bt(r.slice(0,r.length-e))}function Cm(r){if(r.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[r.length>1?r[r.length-2]:1,r[r.length-1]]}function Vy(r){var e=[1,1,1];return r.length===0||r.length===1&&r[0]===1||(e=[km(r)].concat(Cm(r))),e}function CB(r,e){var t;e===void 0&&(e=!1);var n=Ne().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,(r=r.map((function(l,c){return c>=r.length-2?n3(r[c]):r[c]}))).length===1&&(r=[2,r[0]])),r.length!==2){var i=Hu(r);r=i.newShape}var o=bt(r);if(r.length<=1&&o<=n)return[1,o];if(r.length===2&&r[0]<=n&&r[1]<=n)return r;if(r.length===3&&r[0]*r[1]<=n&&r[2]<=n)return[r[0]*r[1],r[2]];if(r.length===3&&r[0]<=n&&r[1]*r[2]<=n)return[r[0],r[1]*r[2]];if(r.length===4&&r[0]*r[1]*r[2]<=n&&r[3]<=n)return[r[0]*r[1]*r[2],r[3]];if(r.length===4&&r[0]<=n&&r[1]*r[2]*r[3]<=n)return[r[0],r[1]*r[2]*r[3]];if(e){var a=km(r),s=2,u=2;return r.length&&(s=(t=Cm(r))[0],u=t[1]),ab(o=a*(s/2)*(u/2)).map((function(l){return 2*l}))}return ab(o)}function hp(r){return r%2==0}function dp(r,e){if(wr(r=r.slice(-2),e=e.slice(-2))||!r.length||!e.length||r[0]===0||r[1]===0||e[0]===0||e[1]===0)return!0;if(r.length!==e.length){var t=r.slice(-1)[0],n=e.slice(-1)[0];if(t===n||hp(t)&&hp(n)&&(r[0]===1||e[0]===1))return!0}return r[1]===e[1]&&hp(r[0])&&hp(e[0])}function TB(r){if(zy==null){var e=ba(r);zy=e.getParameter(e.MAX_TEXTURE_SIZE)}return zy}function MB(r){if(Wy==null){var e=ba(r);Wy=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Wy)}function AB(r){if(r===0)return 0;var e=ba(r);return ro(e,"EXT_disjoint_timer_query_webgl2")&&r===2?2:ro(e,"EXT_disjoint_timer_query")?1:0}function ro(r,e){return r.getExtension(e)!=null}function JS(r){try{if(ba(r)!=null)return!0}catch{return!1}return!1}function RB(r){if(r===0)return!1;var e=ba(r);if(r===1){if(!ro(e,"OES_texture_float"))return!1}else if(!ro(e,"EXT_color_buffer_float"))return!1;return pb(e)}function IB(r){if(r===0)return!1;var e=ba(r);if(r!==1){if(ro(e,"EXT_color_buffer_float"))return pb(e);if(ro(e,"EXT_color_buffer_half_float")){var t=e.getExtension("EXT_color_buffer_half_float");return(function(n,i){var o=Ow(n,i),a=n.createTexture();n.bindTexture(n.TEXTURE_2D,a),n.texImage2D(n.TEXTURE_2D,0,o.internalFormatHalfFloat,1,1,0,o.textureFormatFloat,o.textureTypeHalfFloat,null);var s=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,s),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,a,0);var u=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(a),n.deleteFramebuffer(s),u})(e,t)}return!1}return!!ro(e,"OES_texture_float")&&!!ro(e,"WEBGL_color_buffer_float")&&pb(e)}function pb(r){var e=Ow(r),t=r.createTexture();r.bindTexture(r.TEXTURE_2D,t),r.texImage2D(r.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var n=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,n),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,t,0);var i=r.checkFramebufferStatus(r.FRAMEBUFFER)===r.FRAMEBUFFER_COMPLETE;return r.bindTexture(r.TEXTURE_2D,null),r.bindFramebuffer(r.FRAMEBUFFER,null),r.deleteTexture(t),r.deleteFramebuffer(n),i}function DB(r){return r===2&&ba(r).fenceSync!=null}var $t=Ne();function d3(r){Ne().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(r+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function _n(r,e){return le.tidy(r,e)}function bi(r){c3(r).forEach((function(e){return e.dispose()}))}function NB(r){return le.keep(r)}function Tm(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];Ne().getBool("IS_TEST")||console.warn.apply(console,r)}function uu(r,e){var t=r;if(da(r))return e==="string"?[]:[r.length];if(!Array.isArray(r))return[];for(var n=[];Array.isArray(t)||da(t)&&e!=="string";)n.push(t.length),t=t[0];return Array.isArray(r)&&Ne().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&(function i(o,a,s){if(s=s||[],!Array.isArray(o)&&!da(o))return void K(a.length===0,(function(){return"Element arr["+s.join("][")+"] is a primitive, but should be an array/TypedArray of "+a[0]+" elements"}));K(a.length>0,(function(){return"Element arr["+s.join("][")+"] should be a primitive, but is an array of "+o.length+" elements"})),K(o.length===a[0],(function(){return"Element arr["+s.join("][")+"] should have "+a[0]+" elements, but has "+o.length+" elements"}));for(var u=a.slice(1),l=0;l<o.length;++l)i(o[l],u,s.concat(l))})(r,n,[]),n}function ZS(r,e,t,n){if(r!=null&&(r!=="numeric"&&r!==e||r==="numeric"&&e==="string"))throw new Error("Argument '"+t+"' passed to '"+n+"' must be "+r+" tensor, but got "+e+" tensor")}function X(r,e,t,n){if(n===void 0&&(n="numeric"),r instanceof Nn)return ZS(n,r.dtype,e,t),r;var i=kd(r);if(i!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(i=n),ZS(n,i,e,t),r==null||!da(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string"){var o=r==null?"null":r.constructor.name;throw new Error("Argument '"+e+"' passed to '"+t+"' must be a Tensor or TensorLike, but got '"+o+"'")}var a=uu(r,i);da(r)||Array.isArray(r)||(r=[r]);var s=i!=="string"?i3(r,i,Ne().getBool("DEBUG")):Oc(r,[],!0);return le.makeTensor(s,a,i)}function Mm(r,e,t,n){if(n===void 0&&(n="numeric"),!Array.isArray(r))throw new Error("Argument "+e+" passed to "+t+" must be a `Tensor[]` or `TensorLike[]`");return r.map((function(i,o){return X(i,e+"["+o+"]",t)}),n)}function f3(r,e){for(var t=0;t<r.length;++t)if(r[r.length-t-1]!==e-1-t)return!1;return!0}function PB(r,e,t){for(var n=r.length+e.length,i=[],o=0,a=0,s=0;s<n;s++)t.indexOf(s)===-1?i.push(r[o++]):i.push(e[a++]);return i}function Br(r,e){for(var t=[],n=r.length,i=0;i<n;i++)e.indexOf(i)===-1&&t.push(r[i]);return[t,e.map((function(o){return r[o]}))]}function Si(r,e){return PB(r,e.map((function(t){return 1})),e)}function Di(r,e,t){K(f3(e,t),(function(){return r+" supports only inner-most axes for now. Got axes "+e+" and rank-"+t+" input."}))}function wa(r,e){if(f3(r,e))return null;for(var t=[],n=0;n<e;++n)r.indexOf(n)===-1&&t.push(n);return r.forEach((function(i){return t.push(i)})),t}function Lw(r){return r.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function _a(r,e){for(var t=[],n=e-r;n<e;++n)t.push(n);return t}function FB(r,e){var t=r[0].length;r.forEach((function(i,o){K(i.length===t,(function(){return"Error in concat"+t+"D: rank of tensors["+o+"] must be the same as the rank of the rest ("+t+")"}))})),K(e>=0&&e<t,(function(){return"Error in concat"+t+"D: axis must be between 0 and "+(t-1)+"."}));var n=r[0];r.forEach((function(i,o){for(var a=0;a<t;a++)K(a===e||i[a]===n[a],(function(){return"Error in concat"+t+"D: Shape of tensors["+o+"] ("+i+") does not match the shape of the rest ("+n+") along the non-concatenated axis "+o+"."}))}))}function Uc(r,e){for(var t=r[0].slice(),n=1;n<r.length;n++)t[e]+=r[n][e];return t}function oe(r){var e=Object.keys(r);if(e.length!==1)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var t=e[0],n=r[t];t.endsWith("_")&&(t=t.substring(0,t.length-1));var i=function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];le.startScope(t);try{var s=n.apply(void 0,o);return s instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),le.endScope(s),s}catch(u){throw le.endScope(null),u}};return Object.defineProperty(i,"name",{value:t,configurable:!0}),i}$t.registerFlag("HAS_WEBGL",(function(){return $t.getNumber("WEBGL_VERSION")>0})),$t.registerFlag("WEBGL_VERSION",(function(){return JS(2)?2:JS(1)?1:0})),$t.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return $t.get("WEBGL_VERSION")===2})),$t.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),$t.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),$t.registerFlag("WEBGL_PACK",(function(){return $t.getBool("HAS_WEBGL")})),$t.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_CLIP",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),$t.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_PACK_REDUCE",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_CONV_IM2COL",(function(){return $t.getBool("WEBGL_PACK")})),$t.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return TB($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return MB($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var r=$t.getNumber("WEBGL_VERSION");return r===0?0:AB(r)})),$t.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return $t.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(r=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(r)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(r.substr(0,4))));var r})),$t.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return RB($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!$t.getBool("WEBGL_FORCE_F16_TEXTURES")&&$t.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),$t.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return IB($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return DB($t.getNumber("WEBGL_VERSION"))})),$t.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return $t.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),l3=d3;var Er=oe({complex_:function(r,e){var t=X(r,"real","complex"),n=X(e,"imag","complex");return En(t.shape,n.shape,"real and imag shapes, "+t.shape+" and "+n.shape+", must match in call to tf.complex()."),le.runKernelFunc((function(i){return i.complex(t,n)}),{$real:t,$imag:n})}}),no=oe({real_:function(r){var e=X(r,"input","real");return le.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),aa=oe({imag_:function(r){var e=X(r,"input","imag");return le.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function Cr(r,e,t){return lu(r,e,uu(r,t),t)}function lu(r,e,t,n){if(n==null&&(n=kd(r)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!da(r)&&!Array.isArray(r)&&typeof r!="number"&&typeof r!="boolean"&&typeof r!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){a3(e);var i=bt(e),o=bt(t);K(i===o,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+i+" values but has "+o}));for(var a=0;a<t.length;++a){var s=t[a],u=a!==t.length-1||s!==bt(e.slice(a));K(t[a]===e[a]||!u,(function(){return"Error creating a new Tensor. Inferred shape ("+t+") does not match the provided shape ("+e+"). "}))}}return da(r)||Array.isArray(r)||(r=[r]),e=e||t,r=n!=="string"?i3(r,n,Ne().getBool("DEBUG")):Oc(r,[],!0),le.makeTensor(r,e,n)}function Ct(r,e){if((da(r)&&e!=="string"||Array.isArray(r))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&da(r)&&!(r instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return lu(r,[],[],e)}function zo(r,e){Kc(r);var t=uu(r,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return lu(r,null,t,e)}function Zu(r,e,t){if(Kc(r),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");var n=uu(r,t);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return lu(r,e,n,t)}function p3(r,e,t){if(Kc(r),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");var n=uu(r,t);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return lu(r,e,n,t)}function ra(r,e,t){if(Kc(r),e!=null&&e.length!==4)throw new Error("tensor4d() requires shape to have four numbers");var n=uu(r,t);if(n.length!==4&&n.length!==1)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return lu(r,e,n,t)}function OB(r,e,t){if(Kc(r),e!=null&&e.length!==5)throw new Error("tensor5d() requires shape to have five numbers");var n=uu(r,t);if(n.length!==5&&n.length!==1)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return lu(r,e,n,t)}function LB(r,e,t){if(Kc(r),e!=null&&e.length!==6)throw new Error("tensor6d() requires shape to have six numbers");var n=uu(r,t);if(n.length!==6&&n.length!==1)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return lu(r,e=e||n,n,t)}function BB(r,e,t,n){return e===void 0&&(e=!0),le.makeVariable(r,e,t,n)}function Jc(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Jc(r,"float32"),n=Xn(r,"float32");return Er(t,n)}var i=o3(bt(r),e);return le.makeTensor(i,r,e)}function Xn(r,e){if(e===void 0&&(e="float32"),e==="complex64"){var t=Xn(r,"float32"),n=Xn(r,"float32");return Er(t,n)}var i=Cd(bt(r),e);return le.makeTensor(i,r,e)}function Qu(r,e,t){return le.runKernelFunc((function(n){return n.fill(r,e,t)}),{})}function UB(r,e,t){if(t<=0)throw new Error("The number of values should be positive.");return le.runKernelFunc((function(n){return n.linspace(r,e,t)}),{})}function Am(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t===0)throw new Error("Cannot have a step of zero");if(r===e||r<e&&t<0||e<r&&t>1)return Xn([0],n);var i=Cd(Math.abs(Math.ceil((e-r)/t)),n);e<r&&t===1&&(t=-1),i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+t;return zo(i,n)}var m3=oe({onesLike_:function(r){var e=X(r,"x","onesLike");if(e.dtype==="complex64"){var t=m3(no(e)),n=hn(aa(e));return Er(t,n)}return le.runKernelFunc((function(i){return i.onesLike(e)}),{x:e},(function(i,o){return{x:function(){return hn(i)}}}),"OnesLike")}}),hn=oe({zerosLike_:function(r){var e=X(r,"x","zerosLike");return le.runKernelFunc((function(t){return t.zerosLike(e)}),{x:e},(function(t,n){return{x:function(){return hn(t)}}}),"ZerosLike")}}),uo=oe({concat_:function(r,e){e===void 0&&(e=0),K(r.length>=1,(function(){return"Pass at least one tensor to concat"}));var t=Mm(r,"tensors","concat");t[0].dtype==="complex64"&&t.forEach((function(s){if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype `+s.dtype+". ")})),e=dr(e,t[0].shape)[0];var n=Uc(t.map((function(s){return s.shape})),e);if(bt(n)===0)return Cr([],n);if((t=t.filter((function(s){return s.size>0}))).length===1)return t[0];var i=t.map((function(s){return s.shape}));FB(i,e);var o=t,a={axis:e};return le.runKernelFunc((function(s){return s.concat(t,e)}),o,(function(s){var u=i.map((function(l){return l[e]}));return Bw(s,u,e).map((function(l){return function(){return l}}))}),"Concat",a)}}),zB=oe({concat1d_:function(r){return uo(r,0)}}),WB=oe({concat2d_:function(r,e){return uo(r,e)}}),HB=oe({concat3d_:function(r,e){return uo(r,e)}}),GB=oe({concat4d_:function(r,e){return uo(r,e)}}),Bw=oe({split_:function(r,e,t){t===void 0&&(t=0);var n,i=X(r,"x","split");return t=dr(t,i.shape)[0],typeof e=="number"?(K(i.shape[t]%e==0,(function(){return"Number of splits must evenly divide the axis."})),n=new Array(e).fill(i.shape[t]/e)):(K(i.shape[t]===e.reduce((function(o,a){return o+a})),(function(){return"The sum of sizes must match the size of the axis dimension."})),n=e),le.runKernelFunc((function(o){return o.split(i,n,t)}),{$x:i},(function(o){return{$x:function(){return uo(o,t)}}}))}});function Xt(r,e,t){return e===void 0&&(e="float32"),e=e||"float32",a3(r),new td(r,e,t)}function VB(r,e){e===void 0&&(e=!1),console.log(r.toString(e))}var g3=oe({batchToSpaceND_:function(r,e,t){var n=X(r,"x","batchToSpaceND"),i=e.reduce((function(o,a){return o*a}));return K(n.rank>=1+e.length,(function(){return"input rank is "+n.rank+" but should be > than blockShape.length "+e.length})),K(t.length===e.length,(function(){return"crops.length is "+t.length+" but should be equal to blockShape.length  "+e.length})),K(n.shape[0]%i==0,(function(){return"input tensor batch is "+n.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+i})),le.runKernelFunc((function(o){return o.batchToSpaceND(n,e,t)}),{$x:n},(function(o){return{$x:function(){return o.spaceToBatchND(e,t)}}}))}}),jB=oe({cast_:function(r,e){var t=X(r,"x","cast");if(!$L(e))throw new Error("Failed to cast to unknown dtype "+e);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");var n={dtype:e};return le.runKernelFunc((function(i){return i.cast(t,e)}),{x:t},(function(i){return{x:function(){return i.clone()}}}),"Cast",n)}}),qB=oe({cumsum_:function(r,e,t,n){e===void 0&&(e=0),t===void 0&&(t=!1),n===void 0&&(n=!1);var i=X(r,"x","cumsum"),o=wa([e|=0],i.rank),a=i;o!=null&&(a=i.transpose(o));var s=_a(1,i.rank)[0],u=le.runKernelFunc((function(l){return l.cumsum(a,s,t,n)}),{permutedX:a},(function(l){return{permutedX:function(){return l.cumsum(e,t,!n)}}}));return o!=null&&(u=u.transpose(o)),u}}),$B=oe({depthToSpace_:function(r,e,t){t===void 0&&(t="NHWC");var n=X(r,"x","depthToSpace"),i=t==="NHWC"?n.shape[1]:n.shape[2],o=t==="NHWC"?n.shape[2]:n.shape[3],a=t==="NHWC"?n.shape[3]:n.shape[1];return K(i*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+i+" and "+e+`  for depthToSpace with input shape
      `+n.shape})),K(o*e>=0,(function(){return`Negative dimension size caused by overflow when multiplying
      `+o+" and "+e+` for depthToSpace with input shape
          `+n.shape})),K(a%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+a+" for depthToSpace with input shape "+n.shape})),le.runKernelFunc((function(s){return s.depthToSpace(n,e,t)}),{$x:n})}}),Ws=oe({expandDims_:function(r,e){e===void 0&&(e=0);var t=X(r,"x","expandDims",null);K(e<=t.rank,(function(){return"Axis must be <= rank of the tensor"}));var n=t.shape.slice();return e<0&&(K(-(t.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(t.rank+1)+", "+t.rank+"]"})),e=t.rank+e+1),n.splice(e,0,1),Ua(t,n)}}),Ua=oe({reshape_:function(r,e){var t=X(r,"x","reshape",null);e=jL(e,t.size),K(t.size===bt(e),(function(){return"new shape and old shape must have the same number of elements."}));var n={shape:e};return le.runKernelFunc((function(i){return i.reshape(t,e)}),{x:t},(function(i){return{x:function(){return i.reshape(t.shape)}}}),"Reshape",n)}}),v3=oe({spaceToBatchND_:function(r,e,t){var n=X(r,"x","spaceToBatchND");return K(n.rank>=1+e.length,(function(){return"input rank "+n.rank+" should be > than [blockShape] "+e.length})),K(t.length===e.length,(function(){return"paddings.shape[0] "+t.length+" must be equal to [blockShape] "+e.length})),K(n.shape.reduce((function(i,o,a){return a>0&&a<=e.length?i&&(o+t[a-1][0]+t[a-1][1])%e[a-1]==0:i}),!0),(function(){return"input spatial dimensions "+n.shape.slice(1)+" with paddings "+t.toString()+" must be divisible by blockShapes "+e.toString()})),le.runKernelFunc((function(i){return i.spaceToBatchND(n,e,t)}),{$x:n},(function(i){return{$x:function(){return i.batchToSpaceND(e,t)}}}))}}),y3=oe({squeeze_:function(r,e){var t=X(r,"x","squeeze");return Ua(t,Hu(t.shape,e).newShape)}}),Qs=oe({stack_:function(r,e){e===void 0&&(e=0);var t=Mm(r,"tensors","stack");if(K(t.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),t.length===1)return t[0].expandDims(e);var n=t[0].rank,i=t[0].shape,o=t[0].dtype;K(e<=n,(function(){return"Axis must be <= rank of the tensor"})),t.forEach((function(s){En(i,s.shape,"All tensors passed to stack must have matching shapes")})),t.forEach((function(s){K(o===s.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var a=t.map((function(s){return s.expandDims(e)}));return uo(a,e)}}),ig=oe({unstack_:function(r,e){e===void 0&&(e=0),e=e||0;var t=X(r,"x","unstack");K(e>=-t.shape.length&&e<t.shape.length,(function(){return"Axis = "+e+" is not in [-"+t.shape.length+", "+t.shape.length+")"})),e<0&&(e+=t.shape.length);var n={axis:e};return le.runKernelFunc((function(i){return i.unstack(t,e)}),{x:t},(function(i){return{x:function(){return Qs(i,e)}}}),"Unpack",n)}}),XB=function(r,e){return wt(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,l,c,h;return _t(this,(function(f){switch(f.label){case 0:return t=X(r,"x","setdiff1d"),n=X(e,"y","setdiff1d"),K(t.dtype===n.dtype,(function(){return"x and y should have the same dtype, but got x ("+t.dtype+") and y ("+n.dtype+")."})),K(t.rank===1,(function(){return"x should be 1D tensor, but got x ("+t.shape+")."})),K(n.rank===1,(function(){return"y should be 1D tensor, but got y ("+n.shape+")."})),[4,t.data()];case 1:return i=f.sent(),[4,n.data()];case 2:for(o=f.sent(),a=new Set(o),s=0,c=0;c<i.length;c++)a.has(i[c])||s++;for(u=new td([s],t.dtype),l=new td([s],"int32"),c=0,h=0;c<i.length;c++)a.has(i[c])||(u.values[h]=i[c],l.values[h]=c,h++);return[2,[u.toTensor(),l.toTensor()]]}}))}))};function Rm(r,e,t,n){n===void 0&&(n=!0);var i=[];if(n)(i=i.concat(e.slice(0))).push(r[0]/t),i=i.concat(r.slice(1));else{i=i.concat(r[0]);for(var o=e.length,a=0;a<o;++a)i=i.concat([r[a+1]/e[a],e[a]]);i=i.concat(r.slice(o+1))}return i}function Im(r,e,t){t===void 0&&(t=!0);var n=[];if(t){n.push(e);for(var i=e+1;i<r;++i)i<=2*e?(n.push(i),n.push(i-(e+1))):n.push(i)}else{var o=[],a=[];for(i=1;i<r;++i)i>=2*e+1||i%2==1?a.push(i):o.push(i);n.push.apply(n,o),n.push(0),n.push.apply(n,a)}return n}function Dm(r,e,t,n){n===void 0&&(n=!0);var i=[];n?i.push(r[0]/t):i.push(r[0]*t);for(var o=1;o<r.length;++o)o<=e.length?n?i.push(e[o-1]*r[o]):i.push(r[o]/e[o-1]):i.push(r[o]);return i}function b3(r,e){for(var t=[0],n=0;n<e;++n)t.push(r[n][0]);return t}function w3(r,e,t){for(var n=r.slice(0,1),i=0;i<t;++i)n.push(r[i+1]-e[i][0]-e[i][1]);return n}var _3="Add",og="Div",ag="SquaredDifference",x3="BroadcastTo",S3="OneHot",E3="Identity",k3="Tile",C3="PadV2",lo=oe({add_:function(r,e){var t,n=X(r,"a","add"),i=X(e,"b","add");t=Gn(n,i),n=t[0],i=t[1];var o={a:n,b:i};return le.runKernelFunc((function(a,s){var u=a.add(n,i);return s([n,i]),u}),o,null,_3)}});function js(r,e){for(var t=r.length,n=[],i=0;i<t;i++){var o=t-1-i,a=r[o]||1;(e[e.length-1-i]||1)>1&&a===1&&n.unshift(o)}return n}function ar(r,e){for(var t=[],n=0;n<e.length;n++){var i=r[r.length-n-1],o=e.length-n-1,a=e[o];(i==null||i===1&&a>1)&&t.unshift(o)}return t}function on(r,e){for(var t=[],n=Math.max(r.length,e.length),i=0;i<n;i++){var o=r[r.length-i-1];o==null&&(o=1);var a=e[e.length-i-1];if(a==null&&(a=1),o===1)t.unshift(a);else if(a===1)t.unshift(o);else{if(o!==a)throw Error("Operands could not be broadcast together with shapes "+r+" and "+e+".");t.unshift(o)}}return t}var YB=oe({abs_:function(r){var e=X(r,"x","abs");return e.dtype==="complex64"?le.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):le.runKernelFunc((function(t,n){var i=t.abs(e);return n([e]),i}),{x:e},(function(t,n){var i=n[0];return{x:function(){return t.mul(i.toFloat().step(-1))}}}),"Abs")}}),KB=oe({acos_:function(r){var e=X(r,"x","acos");return le.runKernelFunc((function(t,n){var i=t.acos(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Ct(1).sub(i.toFloat().square()).sqrt()).neg()}}}))}}),JB=oe({acosh_:function(r){var e=X(r,"x","acosh");return le.runKernelFunc((function(t,n){var i=t.acosh(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.divStrict(i.toFloat().square().sub(1).sqrt())}}}))}}),ZB=oe({asin_:function(r){var e=X(r,"x","asin");return le.runKernelFunc((function(t,n){var i=t.asin(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Ct(1).sub(i.toFloat().square()).sqrt())}}}))}}),QB=oe({asinh_:function(r){var e=X(r,"x","asinh");return le.runKernelFunc((function(t,n){var i=t.asinh(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.divStrict(Ct(1).add(i.toFloat().square()).sqrt())}}}))}}),e6=oe({atan_:function(r){var e=X(r,"x","atan");return le.runKernelFunc((function(t,n){var i=t.atan(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().square().add(1))}}}))}}),t6=oe({atanh_:function(r){var e=X(r,"x","atanh");return le.runKernelFunc((function(t,n){var i=t.atanh(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.div(Ct(1).sub(i.toFloat().square()))}}}))}}),n6=oe({ceil_:function(r){var e=X(r,"x","ceil");return le.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),r6=oe({clipByValue_:function(r,e,t){var n=X(r,"x","clipByValue");K(e<=t,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+t+")."}));var i=[n],o={min:e,max:t};return le.runKernelFunc((function(a,s){var u=a.clip(n,e,t);return s([n]),u}),{x:n},(function(a,s){var u=s[0];return{x:function(){return a.where(u.greaterEqual(e).logicalAnd(u.lessEqual(t)),hn(a))}}}),"ClipByValue",o,i)}}),i6=oe({cos_:function(r){var e=X(r,"x","cos"),t=[e];return le.runKernelFunc((function(n,i){var o=n.cos(e);return i([e]),o}),{x:e},(function(n,i){var o=i[0];return{x:function(){return o.toFloat().sin().neg().mul(n)}}}),"Cos",{},t)}}),o6=oe({cosh_:function(r){var e=X(r,"x","cosh");return le.runKernelFunc((function(t,n){var i=t.cosh(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return i.toFloat().sinh().mulStrict(t)}}}))}}),a6=oe({erf_:function(r){var e=X(r,"x","erf");return K(e.dtype==="int32"||e.dtype==="float32",(function(){return"Input dtype must be `int32` or `float32`."})),e.dtype==="int32"&&(e=e.toFloat()),le.runKernelFunc((function(t,n){var i=t.erf(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.mul(i.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),s6=oe({exp_:function(r){var e=X(r,"x","exp");return le.runKernelFunc((function(t,n){var i=t.exp(e);return n([i]),i}),{x:e},(function(t,n){return{x:function(){return t.mulStrict(n[0])}}}),"Exp",{},[],[!0])}}),u6=oe({expm1_:function(r){var e=X(r,"x","expm1");return le.runKernelFunc((function(t,n){var i=t.expm1(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.mul(i.exp())}}}))}}),l6=oe({floor_:function(r){var e=X(r,"x","floor");return le.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),c6=oe({log_:function(r){var e=X(r,"x","log"),t=[e];return le.runKernelFunc((function(n,i){var o=n.log(e);return i([e]),o}),{x:e},(function(n,i){var o=i[0];return{x:function(){return n.div(o.toFloat())}}}),"Log",{},t)}}),h6=oe({log1p_:function(r){var e=X(r,"x","log1p");return le.runKernelFunc((function(t,n){var i=t.log1p(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.div(i.add(1))}}}))}}),d6=oe({logSigmoid_:function(r){var e=X(r,"x","logSigmoid");return le.runKernelFunc((function(t,n){var i=t.softplus(e.neg()).neg();return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.mul(i.neg().sigmoid())}}}))}}),Uw=oe({neg_:function(r){var e=X(r,"x","neg"),t=[e];return le.runKernelFunc((function(n){return n.neg(e)}),{x:e},(function(n){return{x:function(){return n.neg()}}}),"Neg",{},t)}}),f6=oe({reciprocal_:function(r){var e=X(r,"x","reciprocal");return le.runKernelFunc((function(t,n){var i=t.reciprocal(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.div(i.square().neg())}}}))}}),p6=oe({round_:function(r){var e=X(r,"x","round");return le.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),T3=oe({rsqrt_:function(r){var e=X(r,"x","rsqrt"),t=[e];return le.runKernelFunc((function(n,i){var o=n.rsqrt(e);return i([e]),o}),{x:e},(function(n,i){var o=i[0];return{x:function(){return n.div(o.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},t)}}),m6=oe({sigmoid_:function(r){var e=X(r,"x","sigmoid");return le.runKernelFunc((function(t,n){var i=t.sigmoid(e);return n([i]),i}),{x:e},(function(t,n){var i=n[0];return{x:function(){return t.mul(i.mul(Ct(1).sub(i)))}}}),"Sigmoid")}}),g6=oe({sign_:function(r){var e=X(r,"x","sign");return le.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),v6=oe({isNaN_:function(r){var e=X(r,"x","isNaN");return le.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),y6=oe({isInf_:function(r){var e=X(r,"x","isInf");return le.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),b6=oe({isFinite_:function(r){var e=X(r,"x","isFinite");return le.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return hn(t)}}}))}}),w6=oe({sin_:function(r){var e=X(r,"x","sin"),t=[e];return le.runKernelFunc((function(n,i){var o=n.sin(e);return i([e]),o}),{x:e},(function(n,i){var o=i[0];return{x:function(){return o.toFloat().cos().mul(n)}}}),"Sin",{},t)}}),_6=oe({sinh_:function(r){var e=X(r,"x","sinh");return le.runKernelFunc((function(t,n){var i=t.sinh(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return i.toFloat().cosh().mulStrict(t)}}}))}}),x6=oe({softplus_:function(r){var e=X(r,"x","softplus");return le.runKernelFunc((function(t,n){var i=t.softplus(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.mul(i.sigmoid())}}}))}}),S6=oe({sqrt_:function(r){var e=X(r,"x","sqrt");return le.runKernelFunc((function(t,n){var i=t.sqrt(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.div(i.toFloat().sqrt().mul(2))}}}))}}),E6=oe({step_:function(r,e){e===void 0&&(e=0);var t=X(r,"x","step");return le.runKernelFunc((function(n){return n.step(t,e)}),{$x:t},(function(n){return{$x:function(){return hn(n)}}}))}}),k6=oe({tan_:function(r){var e=X(r,"x","tan");return le.runKernelFunc((function(t,n){var i=t.tan(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return t.div(i.cos().square())}}}))}}),C6=oe({tanh_:function(r){var e=X(r,"x","tanh");return le.runKernelFunc((function(t,n){var i=t.tanh(e);return n([i]),i}),{x:e},(function(t,n){var i=n[0];return{x:function(){return Ct(1).sub(i.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}}),T6=oe({addStrict_:function(r,e){var t=X(r,"a","addStrict"),n=X(e,"b","addStrict");return En(t.shape,n.shape,"Error in addStrict: "),t.add(n)}}),M6=oe({atan2_:function(r,e){var t,n=X(r,"a","atan2"),i=X(e,"b","atan2");t=Gn(n,i),n=t[0],i=t[1];var o=on(n.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.atan2(n,i);return s([n,i]),u}),{$a:n,$b:i},(function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=lo(u.square(),l.square()),h=a.mul(l.div(c)),f=ar(u.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(u.shape)},$b:function(){var c=lo(u.square(),l.square()),h=Uw(a.mul(u.div(c))),f=ar(l.shape,o);return f.length>0&&(h=h.sum(f)),h.reshape(l.shape)}}}))}}),A6=oe({divStrict_:function(r,e){var t=X(r,"a","div"),n=X(e,"b","div");return En(t.shape,n.shape,"Error in divideStrict: "),t.div(n)}}),M3=oe({floorDiv_:function(r,e){var t,n=X(r,"a","floorDiv"),i=X(e,"b","floorDiv");t=Gn(n,i),n=t[0],i=t[1];var o=on(n.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.floorDiv(n,i);return s([n,i]),u}),{a:n,b:i},(function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.div(l.toFloat()),h=ar(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=ar(l.shape,o);h.length>0&&(c=c.sum(h).reshape(l.shape));var f=l.square();return c.div(f.toFloat()).neg()}}}),"FloorDiv")}}),zw=oe({maximum_:function(r,e){var t,n=X(r,"a","maximum"),i=X(e,"b","maximum");return t=Gn(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),on(n.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.maximum(n,i);return a([n,i]),s}),{a:n,b:i},(function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.greaterEqual(u).toFloat())},b:function(){return o.mul(s.less(u).toFloat())}}}),"Maximum")}}),R6=oe({maximumStrict_:function(r,e){var t=X(r,"a","maximumStrict"),n=X(e,"b","maximumStrict");return En(t.shape,n.shape,"Error in maximumStrict: "),t.maximum(n)}}),A3=oe({minimum_:function(r,e){var t,n=X(r,"a","minimum"),i=X(e,"b","minimum");return t=Gn(n,i),n=t[0],i=t[1],n.dtype==="bool"&&(n=n.toInt(),i=i.toInt()),on(n.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.minimum(n,i);return a([n,i]),s}),{a:n,b:i},(function(o,a){var s=a[0],u=a[1];return{a:function(){return o.mul(s.lessEqual(u).toFloat())},b:function(){return o.mul(s.greater(u).toFloat())}}}),"Minimum")}}),I6=oe({minimumStrict_:function(r,e){var t=X(r,"a","minimumStrict"),n=X(e,"b","minimumStrict");return En(t.shape,n.shape,"Error in minimumStrict: "),t.minimum(n)}}),D6=oe({mod_:function(r,e){var t,n=X(r,"a","mod"),i=X(e,"b","mod");t=Gn(n,i),n=t[0],i=t[1];var o=on(n.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.mod(n,i);return s([n,i]),u}),{$a:n,$b:i},(function(a,s){var u=s[0],l=s[1];return{$a:function(){var c=ar(u.shape,o);return c.length>0?a.sum(c).reshape(u.shape):a},$b:function(){var c=a.mul(u.div(l).floor().neg()),h=ar(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}}))}}),N6=oe({modStrict_:function(r,e){var t=X(r,"a","modStrict"),n=X(e,"b","modStrict");return En(t.shape,n.shape,"Error in modStrict: "),t.mod(n)}}),$n=oe({mul_:function(r,e){var t,n=X(r,"a","mul"),i=X(e,"b","mul");t=Gn(n,i),n=t[0],i=t[1];var o=on(n.shape,i.shape);return le.runKernelFunc((function(a,s){var u=a.multiply(n,i);return s([n,i]),u}),{a:n,b:i},(function(a,s){var u=s[0],l=s[1];return{a:function(){var c=a.mul(l.toFloat()),h=ar(u.shape,o);return h.length>0?c.sum(h).reshape(u.shape):c},b:function(){var c=a.mul(u.toFloat()),h=ar(l.shape,o);return h.length>0?c.sum(h).reshape(l.shape):c}}}),"Mul")}}),P6=oe({mulStrict_:function(r,e){var t=X(r,"a","mul"),n=X(e,"b","mul");return En(t.shape,n.shape,"Error in multiplyStrict: "),t.mul(n)}}),Nm=oe({pow_:function(r,e){var t,n=X(r,"base","pow"),i=X(e,"exp","pow");t=Gn(n,i),n=t[0],i=t[1];var o=on(n.shape,i.shape),a=[n,i];return le.runKernelFunc((function(s,u){var l=s.pow(n,i);return u([n,i,l]),l}),{a:n,b:i},(function(s,u){var l=u[0],c=u[1],h=u[2];return{a:function(){var f=c.toFloat(),m=s.mul(f.mul(l.pow(f.sub(Ct(1))))),g=ar(l.shape,o);return g.length>0&&(m=m.sum(g)),m.reshape(l.shape)},b:function(){var f=l.greater(0),m=l.log().where(f,hn(l)),g=s.mul(h.mul(m)),w=ar(c.shape,o);return w.length>0&&(g=g.sum(w)),g.reshape(c.shape)}}}),"Pow",{},a,[!0])}}),F6=oe({powStrict_:function(r,e){return En(r.shape,e.shape,"Error in powStrict: "),r.pow(e)}}),O6=oe({squaredDifferenceStrict_:function(r,e){var t=X(r,"a","squaredDifferenceStrict"),n=X(e,"b","squaredDifferenceStrict");return En(t.shape,n.shape,"Error in squaredDifferenceStrict: "),t.squaredDifference(n)}}),Lo=oe({sub_:function(r,e){var t,n=X(r,"a","sub"),i=X(e,"b","sub");t=Gn(n,i),n=t[0],i=t[1];var o=on(n.shape,i.shape);return le.runKernelFunc((function(a){return a.subtract(n,i)}),{a:n,b:i},(function(a){return{a:function(){var s=a,u=ar(n.shape,o);return u.length>0&&(s=s.sum(u)),s.reshape(n.shape)},b:function(){var s=a,u=ar(i.shape,o);return u.length>0&&(s=s.sum(u)),s.neg().reshape(i.shape)}}}),"Sub")}}),L6=oe({subStrict_:function(r,e){var t=X(r,"a","subStrict"),n=X(e,"b","subStrict");return En(t.shape,n.shape,"Error in subStrict: "),t.sub(n)}}),eu=oe({div_:function(r,e){var t,n=X(r,"a","div"),i=X(e,"b","div");if(t=Gn(n,i),n=t[0],i=t[1],n.dtype==="int32"&&i.dtype==="int32")return M3(n,i);var o={a:n,b:i};return le.runKernelFunc((function(a,s){var u=a.realDivide(n,i);return s([n,i]),u}),o,null,og,{})}});function R3(r,e){if(r.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+r.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(e.dtype!=="int32")throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>r.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+r.rank);if(r.size===0)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+r.shape+".");for(var t=e.shape,n=t[t.length-1],i=1,o=0;o<t.length-1;++o)i*=t[o];var a=r.shape,s=t.slice();s.pop();var u=1;for(o=n;o<r.rank;++o)u*=a[o],s.push(a[o]);var l=Wi(r.shape).map((function(c){return c/u})).concat([1]).slice(0,n);return[s,i,u,l]}var I3=30;function jy(r){return r<=I3?r:ub(r,Math.floor(Math.sqrt(r)))}function B6(r,e,t){var n=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,o="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+t.shape+", indices.shape: "+e.shape+", shape: "+r+", sliceDim: "+n+", and batchDim: "+i+".";if(t.rank<i)throw new Error(o+" update.rank < "+i+". ");if(r.length<n+(t.rank-i))throw new Error(o+" Output shape length < "+(n+(t.rank-i)));if(t.rank!==i+r.length-n)throw new Error(o+" update.rank != "+(i+r.length-n));for(var a=0;a<i;++a)if(t.shape[a]!==e.shape[a])throw new Error(o+" updates.shape["+a+"] ("+t.shape[a]+") != indices.shape["+a+"] ("+e.shape[a]+").");for(a=0;a<t.rank-i;++a)if(t.shape[a+i]!==r[a+n])throw new Error(o+" updates.shape["+(a+i)+"] ("+t.shape[a+i]+") != shape["+(a+i)+"] ("+r[a+i]+")")}function U6(r,e,t){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(r.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+r.rank+".");if(e.dtype!=="int32")throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(t.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+t);if(t.length===0){if(e.size===0)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(r.size===0)throw new Error("Updates specified for empty output. updates shape: "+r.shape)}B6(t,e,r)}function Pm(r,e,t){for(var n=e.shape.length,i=n>1?e.shape[n-1]:1,o=t.length,a=1,s=i;s<o;++s)a*=t[s];var u=i<1?1:i;return{sliceRank:i,numUpdates:bt(e.shape)/u,sliceSize:a,strides:Wi(t.slice(0,i)).concat([1]),outputSize:bt(t)}}function z6(r,e,t){K(r.rank===e.length,(function(){return"Error in slice"+r.rank+"D: Length of begin "+e+" must match the rank of the array ("+r.rank+")."})),K(r.rank===t.length,(function(){return"Error in slice"+r.rank+"D: Length of size "+t+" must match the rank of the array ("+r.rank+")."}));for(var n=function(o){K(e[o]+t[o]<=r.shape[o],(function(){return"Error in slice"+r.rank+"D: begin["+o+"] + size["+o+"] ("+(e[o]+t[o])+") would overflow input.shape["+o+"] ("+r.shape[o]+")"}))},i=0;i<r.rank;++i)n(i)}function QS(r){for(var e=[],t=0;r>0;)1&r&&e.push(t),r/=2,t++;return e}function Ww(r,e,t){for(var n=[],i=0;i<r.length;i++)n[i]=Math.ceil((e[i]-r[i])/t[i]);return n}function W6(r,e,t,n,i){var o=e[i],a=t[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=ob(0,o,s-1)}function H6(r,e,t,n,i){var o=e[i],a=t[i]||1;(r&1<<i||o==null)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=n[i];return o<0&&(o+=s),o=a>0?ob(0,o,s):ob(-1,o,s-1)}function D3(r,e,t){for(var n=t.length,i=0;i<t.length;i++)if(t[i]>1){n=i;break}for(i=n+1;i<t.length;i++)if(e[i]>0||t[i]!==r[i])return!1;return!0}function N3(r,e){for(var t=r.length>0?r[r.length-1]:1,n=0;n<r.length-1;n++)t+=r[n]*e[n];return t}function G6(r,e){K(sb(r),(function(){return"The f passed in variableGrads(f) must be a function"})),K(e==null||Array.isArray(e)&&e.every((function(c){return c instanceof Bc})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var t=e!=null;if(!t)for(var n in e=[],le.registeredVariables)e.push(le.registeredVariables[n]);var i=t?e.filter((function(c){return!c.trainable})):null,o=e.length;K((e=e.filter((function(c){return c.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+o+" variables is trainable."}));var a=le.gradients(r,e,null,!0),s=a.value,u=a.grads;K(u.some((function(c){return c!=null})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),K(s.rank===0,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var l={};return e.forEach((function(c,h){u[h]!=null&&(l[c.name]=u[h])})),i?.forEach((function(c){return l[c.name]=null})),{value:s,grads:l}}function sg(r){return le.customGrad(r)}var ug=oe({softmax_:function(r,e){e===void 0&&(e=-1);var t=X(r,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and dim was "+e);return le.runKernelFunc((function(n,i){var o=n.softmax(t,e);return i([o]),o}),{logits:t},(function(n,i){var o=i[0],a=n.mul(o);return{logits:function(){return a.sub(a.sum([e],!0).mul(o))}}}),"Softmax",{dim:e},[],[!0])}}),V6=oe({logSoftmax_:function(r,e){e===void 0&&(e=-1);var t=X(r,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+t.rank+" and axis was "+e);return sg((function(n,i){var o=n.max(e,!0),a=n.sub(o),s=a.toFloat().sub(a.exp().sum(e,!0).log());return i([s]),{value:s,gradFunc:function(u,l){var c=l[0].exp();return u.sub(u.sum(e,!0).mul(c))}}}))(t)}}),Mo=oe({transpose_:function(r,e){var t=X(r,"x","transpose");if(e==null&&(e=t.shape.map((function(i,o){return o})).reverse()),K(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of perm "+e+"."})),e.forEach((function(i){K(i>=0&&i<t.rank,(function(){return"All entries in 'perm' must be between 0 and "+(t.rank-1)+" but got "+e}))})),t.rank<=1)return t.clone();var n={perm:e};return le.runKernelFunc((function(i){return i.transpose(t,e)}),{x:t},null,"Transpose",n)}}),P3=(function(){function r(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}return r.prototype.get=function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)},r.prototype.set=function(e,t){this.dataIdsCount++,this.data.set(e,t)},r.prototype.has=function(e){return this.data.has(e)},r.prototype.delete=function(e){return this.dataIdsCount--,this.data.delete(e)},r.prototype.numDataIds=function(){return this.dataIdsCount},r})(),F3=(function(){function r(){}return r.prototype.time=function(e){return xe("time")},r.prototype.read=function(e){return xe("read")},r.prototype.readSync=function(e){return xe("readSync")},r.prototype.numDataIds=function(){return xe("numDataIds")},r.prototype.disposeData=function(e){return xe("disposeData")},r.prototype.write=function(e,t,n){return xe("write")},r.prototype.move=function(e,t,n,i){return xe("move")},r.prototype.memory=function(){return xe("memory")},r.prototype.floatPrecision=function(){return xe("floatPrecision")},r.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},r.prototype.batchMatMul=function(e,t,n,i){return xe("batchMatMul")},r.prototype.fusedBatchMatMul=function(e){return e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights,xe("fusedBatchMatMul")},r.prototype.slice=function(e,t,n){return xe("slice")},r.prototype.stridedSlice=function(e,t,n,i){return xe("stridedSlice")},r.prototype.unstack=function(e,t){return xe("unstack")},r.prototype.reverse=function(e,t){return xe("reverse")},r.prototype.concat=function(e,t){return xe("concat")},r.prototype.neg=function(e){return xe("neg")},r.prototype.add=function(e,t){return xe("add")},r.prototype.addN=function(e){return xe("addN")},r.prototype.subtract=function(e,t){return xe("subtract")},r.prototype.multiply=function(e,t){return xe("multiply")},r.prototype.realDivide=function(e,t){return xe("realDivide")},r.prototype.floorDiv=function(e,t){return xe("floorDiv")},r.prototype.sum=function(e,t){return xe("sum")},r.prototype.prod=function(e,t){return xe("prod")},r.prototype.unsortedSegmentSum=function(e,t,n){return xe("unsortedSegmentSum")},r.prototype.argMin=function(e,t){return xe("argMin")},r.prototype.argMax=function(e,t){return xe("argMax")},r.prototype.equal=function(e,t){return xe("equal")},r.prototype.notEqual=function(e,t){return xe("notEqual")},r.prototype.less=function(e,t){return xe("less")},r.prototype.lessEqual=function(e,t){return xe("lessEqual")},r.prototype.greater=function(e,t){return xe("greater")},r.prototype.greaterEqual=function(e,t){return xe("greaterEqual")},r.prototype.logicalNot=function(e){return xe("logicalNot")},r.prototype.logicalAnd=function(e,t){return xe("logicalAnd")},r.prototype.logicalOr=function(e,t){return xe("logicalOr")},r.prototype.where=function(e){return xe("where")},r.prototype.select=function(e,t,n){return xe("select")},r.prototype.topk=function(e,t,n){return xe("topk")},r.prototype.min=function(e,t){return xe("min")},r.prototype.minimum=function(e,t){return xe("minimum")},r.prototype.mod=function(e,t){return xe("mod")},r.prototype.max=function(e,t){return xe("max")},r.prototype.maximum=function(e,t){return xe("maximum")},r.prototype.all=function(e,t){return xe("all")},r.prototype.any=function(e,t){return xe("any")},r.prototype.squaredDifference=function(e,t){return xe("squaredDifference")},r.prototype.ceil=function(e){return xe("ceil")},r.prototype.floor=function(e){return xe("floor")},r.prototype.round=function(e){return xe("round")},r.prototype.sign=function(e){return xe("sign")},r.prototype.isNaN=function(e){return xe("isNaN")},r.prototype.isInf=function(e){return xe("isInf")},r.prototype.isFinite=function(e){return xe("isFinite")},r.prototype.pow=function(e,t){return xe("pow")},r.prototype.exp=function(e){return xe("exp")},r.prototype.expm1=function(e){return xe("expm1")},r.prototype.softmax=function(e,t){return xe("softmax")},r.prototype.log=function(e){return xe("log")},r.prototype.log1p=function(e){return xe("log1p")},r.prototype.sqrt=function(e){return xe("sqrt")},r.prototype.rsqrt=function(e){return xe("rsqrt")},r.prototype.square=function(e){return xe("square")},r.prototype.reciprocal=function(e){return xe("reciprocal")},r.prototype.relu=function(e){return xe("relu")},r.prototype.relu6=function(e){return xe("relu6")},r.prototype.prelu=function(e,t){return xe("prelu")},r.prototype.elu=function(e){return xe("elu")},r.prototype.eluDer=function(e,t){return xe("eluDer")},r.prototype.selu=function(e){return xe("selu")},r.prototype.int=function(e){return xe("int")},r.prototype.clip=function(e,t,n){return xe("clip")},r.prototype.abs=function(e){return xe("abs")},r.prototype.complexAbs=function(e){return xe("complexAbs")},r.prototype.sigmoid=function(e){return xe("sigmoid")},r.prototype.softplus=function(e){return xe("softplus")},r.prototype.sin=function(e){return xe("sin")},r.prototype.cos=function(e){return xe("cos")},r.prototype.tan=function(e){return xe("tan")},r.prototype.asin=function(e){return xe("asin")},r.prototype.acos=function(e){return xe("acos")},r.prototype.atan=function(e){return xe("atan")},r.prototype.atan2=function(e,t){return xe("atan2")},r.prototype.sinh=function(e){return xe("sinh")},r.prototype.cosh=function(e){return xe("cosh")},r.prototype.tanh=function(e){return xe("tanh")},r.prototype.asinh=function(e){return xe("asinh")},r.prototype.acosh=function(e){return xe("acosh")},r.prototype.atanh=function(e){return xe("atanh")},r.prototype.erf=function(e){return xe("erf")},r.prototype.step=function(e,t){return xe("step")},r.prototype.fusedConv2d=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xe("fusedConv2d")},r.prototype.conv2d=function(e,t,n){return xe("conv2d")},r.prototype.conv2dDerInput=function(e,t,n){return xe("conv2dDerInput")},r.prototype.conv2dDerFilter=function(e,t,n){return xe("conv2dDerFilter")},r.prototype.fusedDepthwiseConv2D=function(e){return e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights,xe("fusedDepthwiseConv2D")},r.prototype.depthwiseConv2D=function(e,t,n){return xe("depthwiseConv2D")},r.prototype.depthwiseConv2DDerInput=function(e,t,n){return xe("depthwiseConv2DDerInput")},r.prototype.depthwiseConv2DDerFilter=function(e,t,n){return xe("depthwiseConv2DDerFilter")},r.prototype.conv3d=function(e,t,n){return xe("conv3d")},r.prototype.conv3dDerInput=function(e,t,n){return xe("conv3dDerInput")},r.prototype.conv3dDerFilter=function(e,t,n){return xe("conv3dDerFilter")},r.prototype.maxPool=function(e,t){return xe("maxPool")},r.prototype.maxPoolBackprop=function(e,t,n,i){return xe("maxPoolBackprop")},r.prototype.avgPool=function(e,t){return xe("avgPool")},r.prototype.avgPoolBackprop=function(e,t,n){return xe("avgPoolBackprop")},r.prototype.avgPool3d=function(e,t){return xe("avgPool3d")},r.prototype.avgPool3dBackprop=function(e,t,n){return xe("avgPool3dBackprop")},r.prototype.maxPool3d=function(e,t){return xe("maxPool3d")},r.prototype.maxPool3dBackprop=function(e,t,n,i){return xe("maxPool3dBackprop")},r.prototype.reshape=function(e,t){return xe("reshape")},r.prototype.cast=function(e,t){return xe("cast")},r.prototype.tile=function(e,t){return xe("tile")},r.prototype.pad=function(e,t,n){return xe("pad")},r.prototype.transpose=function(e,t){return xe("transpose")},r.prototype.gather=function(e,t,n){return xe("gather")},r.prototype.gatherND=function(e,t){return xe("gatherND")},r.prototype.scatterND=function(e,t,n){return xe("scatterND")},r.prototype.batchToSpaceND=function(e,t,n){return xe("batchToSpaceND")},r.prototype.spaceToBatchND=function(e,t,n){return xe("spaceToBatchND")},r.prototype.resizeBilinear=function(e,t,n,i){return xe("resizeBilinear")},r.prototype.resizeBilinearBackprop=function(e,t,n){return xe("resizeBilinearBackprop")},r.prototype.resizeNearestNeighbor=function(e,t,n,i){return xe("resizeNearestNeighbor")},r.prototype.resizeNearestNeighborBackprop=function(e,t,n){return xe("resizeNearestNeighborBackprop")},r.prototype.batchNormalization=function(e,t,n,i,o,a){return xe("batchNormalization")},r.prototype.localResponseNormalization4D=function(e,t,n,i,o){return xe("localResponseNormalization4D")},r.prototype.LRNGrad=function(e,t,n,i,o,a,s){return xe("LRNGrad")},r.prototype.multinomial=function(e,t,n,i){return xe("multinomial")},r.prototype.oneHot=function(e,t,n,i){return xe("oneHot")},r.prototype.cumsum=function(e,t,n,i){return xe("cumsum")},r.prototype.nonMaxSuppression=function(e,t,n,i,o){return xe("nonMaxSuppression")},r.prototype.fft=function(e){return xe("fft")},r.prototype.ifft=function(e){return xe("ifft")},r.prototype.complex=function(e,t){return xe("complex")},r.prototype.real=function(e){return xe("real")},r.prototype.imag=function(e){return xe("imag")},r.prototype.cropAndResize=function(e,t,n,i,o,a){return xe("cropAndResize")},r.prototype.depthToSpace=function(e,t,n){return xe("depthToSpace")},r.prototype.split=function(e,t,n){return xe("split")},r.prototype.sparseToDense=function(e,t,n,i){return xe("sparseToDense")},r.prototype.diag=function(e){return xe("diag")},r.prototype.fill=function(e,t,n){return xe("fill")},r.prototype.onesLike=function(e){return xe("onesLike")},r.prototype.zerosLike=function(e){return xe("zerosLike")},r.prototype.linspace=function(e,t,n){return xe("linspace")},r.prototype.dispose=function(){return xe("dispose")},r})();function xe(r){throw new Error("'"+r+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function rl(r,e,t,n,i,o,a){a===void 0&&(a="channelsLast");var s,u=Lm(e),l=u[0],c=u[1];if(a==="channelsLast")s=[l,c,r[3],r[3]];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);s=[l,c,r[1],r[1]]}return cl(r,s,t,n,i,o,!1,a)}function Fm(r,e,t,n,i,o,a){a===void 0&&(a="NDHWC");var s,u,l=mb(e),c=l[0],h=l[1],f=l[2];if(a==="NDHWC")u="channelsLast",s=[c,h,f,r[4],r[4]];else{if(a!=="NCDHW")throw new Error("Unknown dataFormat "+a);u="channelsFirst",s=[c,h,f,r[1],r[1]]}return Om(r,s,t,n,i,!1,u,o)}function cl(r,e,t,n,i,o,a,s){a===void 0&&(a=!1),s===void 0&&(s="channelsLast");var u=[-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3];if(s==="channelsLast")l=r[0],c=r[1],h=r[2],f=r[3];else{if(s!=="channelsFirst")throw new Error("Unknown dataFormat "+s);l=r[0],f=r[1],c=r[2],h=r[3]}var m,g=e[0],w=e[1],v=e[3],y=Lm(t),x=y[0],E=y[1],_=Lm(n),k=_[0],C=_[1],R=Ec(g,k),I=Ec(w,C),T=(function(F,B,U,P,L,H,W,z){var q,re,de;if(typeof F=="number"){q={top:F,bottom:F,left:F,right:F,type:F===0?"VALID":"NUMBER"};var ye=(function(Be,lt,Y,ot,Je){ot==null&&(ot=O3(Be,lt,Y));var Xe=Be[0],qe=Be[1],Tt=Xh((Xe-lt+2*ot)/Y+1,Je);K(Jn(Tt),(function(){return"The output # of rows ("+Tt+") must be an integer. Change the stride and/or zero pad parameters"}));var Qe=Xh((qe-lt+2*ot)/Y+1,Je);return K(Jn(Qe),(function(){return"The output # of columns ("+Qe+") must be an integer. Change the stride and/or zero pad parameters"})),[Tt,Qe]})([B,U],H,P,F,z);re=ye[0],de=ye[1]}else if(F==="same"){re=Math.ceil(B/P),de=Math.ceil(U/L);var ne=Math.max(0,(re-1)*P+H-B),ie=Math.max(0,(de-1)*L+W-U),fe=Math.floor(ne/2),Ae=ne-fe,De=Math.floor(ie/2);q={top:fe,bottom:Ae,left:De,right:ie-De,type:"SAME"}}else{if(F!=="valid")throw Error("Unknown padding parameter: "+F);q={top:0,bottom:0,left:0,right:0,type:"VALID"},re=Math.ceil((B-H+1)/P),de=Math.ceil((U-W+1)/L)}return{padInfo:q,outHeight:re,outWidth:de}})(i,c,h,x,E,R,I,o),A=T.padInfo,N=T.outHeight,O=T.outWidth,V=a?v*f:v;return s==="channelsFirst"?m=[l,V,N,O]:s==="channelsLast"&&(m=[l,N,O,V]),{batchSize:l,dataFormat:s,inHeight:c,inWidth:h,inChannels:f,outHeight:N,outWidth:O,outChannels:V,padInfo:A,strideHeight:x,strideWidth:E,filterHeight:g,filterWidth:w,effectiveFilterHeight:R,effectiveFilterWidth:I,dilationHeight:k,dilationWidth:C,inShape:r,outShape:m,filterShape:e}}function Om(r,e,t,n,i,o,a,s){o===void 0&&(o=!1),a===void 0&&(a="channelsLast");var u=[-1,-1,-1,-1,-1],l=u[0],c=u[1],h=u[2],f=u[3],m=u[4];if(a==="channelsLast")l=r[0],c=r[1],h=r[2],f=r[3],m=r[4];else{if(a!=="channelsFirst")throw new Error("Unknown dataFormat "+a);l=r[0],m=r[1],c=r[2],h=r[3],f=r[4]}var g,w=e[0],v=e[1],y=e[2],x=e[4],E=mb(t),_=E[0],k=E[1],C=E[2],R=mb(n),I=R[0],T=R[1],A=R[2],N=Ec(w,I),O=Ec(v,T),V=Ec(y,A),F=(function(W,z,q,re,de,ye,ne,ie,fe,Ae,De){var Be,lt,Y,ot;if(typeof W=="number"){Be={top:W,bottom:W,left:W,right:W,front:W,back:W,type:W===0?"VALID":"NUMBER"};var Je=(function(j,me,Re,Pe,ke,Ue){ke==null&&(ke=O3(j,me,Pe));var _e=j[0],rt=j[1],Ze=j[2],Oe=Xh((_e-me+2*ke)/Pe+1,Ue);K(Jn(Oe),(function(){return"The output # of depths ("+Oe+") must be an integer. Change the stride and/or zero pad parameters"}));var $e=Xh((rt-me+2*ke)/Pe+1,Ue);K(Jn($e),(function(){return"The output # of rows ("+$e+") must be an integer. Change the stride and/or zero pad parameters"}));var pt=Xh((Ze-me+2*ke)/Pe+1,Ue);return K(Jn(pt),(function(){return"The output # of columns ("+pt+") must be an integer. Change the stride and/or zero pad parameters"})),[Oe,$e,pt,Re]})([z,q,re,1],ie,1,de,W,De);lt=Je[0],Y=Je[1],ot=Je[2]}else if(W==="same"){lt=Math.ceil(z/de),Y=Math.ceil(q/ye),ot=Math.ceil(re/ne);var Xe=(lt-1)*de+ie-z,qe=(Y-1)*ye+fe-q,Tt=(ot-1)*ne+Ae-re,Qe=Math.floor(Xe/2),ft=Xe-Qe,Mt=Math.floor(qe/2),Ut=qe-Mt,Z=Math.floor(Tt/2);Be={top:Mt,bottom:Ut,left:Z,right:Tt-Z,front:Qe,back:ft,type:"SAME"}}else{if(W!=="valid")throw Error("Unknown padding parameter: "+W);Be={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},lt=Math.ceil((z-ie+1)/de),Y=Math.ceil((q-fe+1)/ye),ot=Math.ceil((re-Ae+1)/ne)}return{padInfo:Be,outDepth:lt,outHeight:Y,outWidth:ot}})(i,c,h,f,_,k,C,N,O,V,s),B=F.padInfo,U=F.outDepth,P=F.outHeight,L=F.outWidth,H=o?x*m:x;return a==="channelsFirst"?g=[l,H,U,P,L]:a==="channelsLast"&&(g=[l,U,P,L,H]),{batchSize:l,dataFormat:a,inDepth:c,inHeight:h,inWidth:f,inChannels:m,outDepth:U,outHeight:P,outWidth:L,outChannels:H,padInfo:B,strideDepth:_,strideHeight:k,strideWidth:C,filterDepth:w,filterHeight:v,filterWidth:y,effectiveFilterDepth:N,effectiveFilterHeight:O,effectiveFilterWidth:V,dilationDepth:I,dilationHeight:T,dilationWidth:A,inShape:r,outShape:g,filterShape:e}}function O3(r,e,t,n){n===void 0&&(n=1);var i=Ec(e,n);return Math.floor((r[0]*(t-1)-t+i)/2)}function Lm(r){return typeof r=="number"?[r,r,r]:r.length===2?[r[0],r[1],1]:r}function mb(r){return typeof r=="number"?[r,r,r]:r}function Ec(r,e){return e<=1?r:r+(r-1)*(e-1)}function Xh(r,e){if(!e)return r;switch(e){case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"floor":return Math.floor(r);default:throw new Error("Unknown roundingMode "+e)}}function zc(r){var e=Lm(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function ri(r,e){return zc(r)||zc(e)}function Hw(r){if(r==="NHWC")return"channelsLast";if(r==="NCHW")return"channelsFirst";throw new Error("Unknown dataFormat "+r)}function L3(r,e,t){if(e==="complex64"){if(r.dtype==="complex64")return r.clone();var n=Xn(r.shape),i=r.toFloat(),o=t.complex(i,n);return n.dispose(),i.dispose(),o}if(!XL(r.dtype,e))return le.makeTensorFromDataId(r.dataId,r.shape,e);if(r.dtype==="complex64"){var a=t.real(r);return o=a.cast(e),a.dispose(),o}if(e==="int32")return t.int(r);if(e==="bool"){var s=Ct(0,r.dtype);return o=t.notEqual(r,s),s.dispose(),o}throw new Error("Error in Cast: failed to cast "+r.dtype+" to "+e)}function gb(r,e){return le.makeTensorFromDataId(r.dataId,e,r.dtype)}function B3(r,e,t){var n=(e-r)/(t-1),i=Cd(t,"float32");i[0]=r;for(var o=1;o<i.length;o++)i[o]=i[o-1]+n;return zo(i,"float32")}function vb(r,e){if(r.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+r.length+", imag: "+e.length+".");for(var t=new Float32Array(2*r.length),n=0;n<t.length;n+=2)t[n]=r[n/2],t[n+1]=e[n/2];return t}function eE(r,e){return{real:r[2*e],imag:r[2*e+1]}}function j6(r,e,t,n){r[2*n]=e,r[2*n+1]=t}function q6(r,e,t){var n=(t?2:-2)*Math.PI*(r/e);return{real:Math.cos(n),imag:Math.sin(n)}}function $6(r,e,t){var n=(function(o,a,s){return(function(u,l,c){for(var h=0,f=u.length,m=0,g=!1;h<f;){var w=c(l,u[m=h+(f-h>>>1)]);w>0?h=m+1:(f=m,g=!w)}return g?h:-h-1})(o,a,s||X6)})(r,e,t),i=n<0?-(n+1):n;r.splice(i,0,e)}function X6(r,e){return r>e?1:r<e?-1:0}function Gw(r,e,t,n,i){return U3(r,e,t,n,i,0).selectedIndices}function Vw(r,e,t,n,i,o){var a=U3(r,e,t,n,i,o);return a.numValidOutputs.dispose(),{selectedIndices:a.selectedIndices,selectedScores:a.selectedScores}}function U3(r,e,t,n,i,o,a,s){s===void 0&&(s=!1);for(var u=Array.from(e).map((function(_,k){return{score:_,boxIndex:k,suppressBeginIndex:0}})).filter((function(_){return _.score>i})).sort(tE),l=o>0?-.5/o:0,c=[],h=[];c.length<t&&u.length>0;){var f=u.pop(),m=f.score,g=f.boxIndex,w=f.suppressBeginIndex;if(m<i)break;for(var v=!1,y=c.length-1;y>=w;--y){var x=Y6(r,g,c[y]);if(x>=n){v=!0;break}if(f.score=f.score*K6(n,l,x),f.score<=i)break}f.suppressBeginIndex=c.length,v||(f.score===m?(c.push(g),h.push(f.score)):f.score>i&&$6(u,f,tE))}var E=c.length;return s&&(c.fill(0,E),h.fill(0,E)),{selectedIndices:zo(c,"int32"),selectedScores:zo(h,"float32"),numValidOutputs:Ct(E,"int32")}}function Y6(r,e,t){var n=r.subarray(4*e,4*e+4),i=r.subarray(4*t,4*t+4),o=Math.min(n[0],n[2]),a=Math.min(n[1],n[3]),s=Math.max(n[0],n[2]),u=Math.max(n[1],n[3]),l=Math.min(i[0],i[2]),c=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),f=Math.max(i[1],i[3]),m=(s-o)*(u-a),g=(h-l)*(f-c);if(m<=0||g<=0)return 0;var w=Math.max(o,l),v=Math.max(a,c),y=Math.min(s,h),x=Math.min(u,f),E=Math.max(y-w,0)*Math.max(x-v,0);return E/(m+g-E)}function K6(r,e,t){var n=Math.exp(e*t*t);return t<=r?n:0}function tE(r,e){return r.score-e.score||r.score===e.score&&e.boxIndex-r.boxIndex}function z3(r,e,t){var n=new Array(r.rank).fill(0),i=r.shape.slice();return e.map((function(o){i[t]=o;var a=r.slice(n,i);return n[t]+=o,a}))}function W3(r,e){for(var t=new Array(r.rank),n=0;n<t.length;n++)t[n]=r.shape[n]*e[n];var i=Xt(t,r.dtype);for(n=0;n<i.values.length;++n){for(var o=i.indexToLoc(n),a=new Array(r.rank),s=0;s<a.length;s++)a[s]=o[s]%r.shape[s];var u=r.locToIndex(a);i.values[n]=r.values[u]}return i.toTensor()}function H3(r,e,t,n,i){for(var o=e[e.length-1],a=[r.length/o,o],s=a[0],u=a[1],l=Lc(t,s*n),c=Lc("int32",s*n),h=0;h<s;h++){for(var f=h*u,m=r.subarray(f,f+u),g=[],w=0;w<m.length;w++)g.push({value:m[w],index:w});g.sort((function(_,k){return k.value-_.value}));var v=h*n,y=l.subarray(v,v+n),x=c.subarray(v,v+n);for(w=0;w<n;w++)y[w]=g[w].value,x[w]=g[w].index}var E=e.slice();return E[E.length-1]=n,[Cr(l,E,t),Cr(c,E,"int32")]}function jw(r,e){for(var t=[],n=0;n<e.length;n++)e[n]&&t.push(n);var i=Xt(r,"int32"),o=Xt([t.length,r.length],"int32");for(n=0;n<t.length;n++){var a=i.indexToLoc(t[n]),s=n*r.length;o.values.set(a,s)}return o.toTensor()}var J6=function(r,e){this.outputShape=[],this.outputShape=r,this.variableNames=e.map((function(i,o){return"T"+o}));var t=[];this.variableNames.forEach((function(i){t.push("float v"+i+" = get"+i+"AtOutCoords();")}));var n=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        float result = `+n+`;
        setOutput(result);
      }
    `},Z6=function(r,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.variableNames=e.map((function(i,o){return"T"+o}));var t=[];this.variableNames.forEach((function(i){t.push("vec4 v"+i+" = get"+i+"AtOutCoords();")}));var n=this.variableNames.map((function(i){return"v"+i})).join(" + ");this.userCode=`
      void main() {
        `+t.join(`
        `)+`

        vec4 result = `+n+`;
        setOutput(result);
      }
    `},Q6=function(r,e,t){this.variableNames=["A"];var n=r.windowSize,i=r.batchSize,o=r.inSize,a=Math.ceil(o/n);t||this.variableNames.push("bestIndicesA"),this.outputShape=[i,a];var s=e==="max"?">":"<",u=t?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+n+`;

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < `+n+`; i++) {
          int inIdx = `+u+`;
          float candidate = getA(batch, inIdx);
          if (candidate `+s+` bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `};function G3(r,e){return["x","y","z","w","u","v"].slice(0,e).map((function(t){return r+"."+t}))}function mi(r,e){return e===1?[r]:G3(r,e)}function Wr(){var r,e,t,n,i,o,a,s,u,l;return Ne().getNumber("WEBGL_VERSION")===2?(r="#version 300 es",e="in",t="out",n="in",i="texture",o="outputColor",a="out vec4 outputColor;",s=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,u="",l=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(r="",e="attribute",t="varying",n="varying",i="texture2D",o="gl_FragColor",a="",s=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,u=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,l=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:r,attribute:e,varyingVs:t,varyingFs:n,texture2D:i,output:o,defineOutput:a,defineSpecialNaN:s,defineSpecialInf:u,defineRound:l}}function $u(r,e,t){t===void 0&&(t="index");var n=Wi(e);return n.map((function(i,o){return"int "+r[o]+" = "+t+" / "+i+"; "+(o===n.length-1?"int "+r[o+1]+" = "+t+" - "+r[o]+" * "+i:"index -= "+r[o]+" * "+i)+";"})).join("")}function qw(r){var e=Wi(r).map((function(t){return t.toString()}));return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * `+e[0]+" + coords.y * "+e[1]+` + coords.z;
  }
`}var V3=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;function e8(r,e,t,n){var i=[];r.forEach((function(m){var g=bt(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?i.push("uniform float "+m.name+(g>1?"["+g+"]":"")+";"):(i.push("uniform sampler2D "+m.name+";"),i.push("uniform int offset"+m.name+";"))}));var o,a,s=i.join(`
`),u=r.map((function(m){return(function(g,w,v){v===void 0&&(v=!1);var y="";y+=v?j3(g):cc(g);var x=g.shapeInfo.logicalShape,E=w.logicalShape;return x.length<=E.length&&(y+=v?(function(_,k){var C,R=_.name,I=R.charAt(0).toUpperCase()+R.slice(1),T="get"+I+"AtOutCoords",A=_.shapeInfo.logicalShape.length,N=k.logicalShape.length,O=js(_.shapeInfo.logicalShape,k.logicalShape),V=Fn(N),F=N-A,B=["x","y","z","w","u","v"];C=A===0?"":N<2&&O.length>=1?"coords = 0;":O.map((function(q){return"coords."+B[q+F]+" = 0;"})).join(`
`);var U="";U=N<2&&A>0?"coords":_.shapeInfo.logicalShape.map((function(q,re){return"coords."+B[re+F]})).join(", ");var P="return outputValue;",L=bt(_.shapeInfo.logicalShape)===1,H=bt(k.logicalShape)===1;if(A!==1||L||H){if(L&&!H)P=N===1?`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:`
        return vec4(outputValue.x);
      `;else if(O.length){var W=A-2,z=A-1;O.indexOf(W)>-1&&O.indexOf(z)>-1?P="return vec4(outputValue.x);":O.indexOf(W)>-1?P="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":O.indexOf(z)>-1&&(P="return vec4(outputValue.xx, outputValue.zz);")}}else P=`
      return vec4(outputValue.xy, outputValue.xy);
    `;return`
    vec4 `+T+`() {
      `+V+` coords = getOutputCoords();
      `+C+`
      vec4 outputValue = get`+I+"("+U+`);
      `+P+`
    }
  `})(g,w):(function(_,k){var C=_.name,R=C.charAt(0).toUpperCase()+C.slice(1),I="get"+R+"AtOutCoords",T=k.texShape,A=_.shapeInfo.texShape,N=_.shapeInfo.logicalShape.length,O=k.logicalShape.length;if(!_.shapeInfo.isUniform&&N===O&&_.shapeInfo.flatOffset==null&&wr(A,T))return`
      float `+I+`() {
        return sampleTexture(`+C+`, resultUV);
      }
    `;var V,F=Fn(O),B=js(_.shapeInfo.logicalShape,k.logicalShape),U=O-N,P=["x","y","z","w","u","v"];V=N===0?"":O<2&&B.length>=1?"coords = 0;":B.map((function(H){return"coords."+P[H+U]+" = 0;"})).join(`
`);var L="";return L=O<2&&N>0?"coords":_.shapeInfo.logicalShape.map((function(H,W){return"coords."+P[W+U]})).join(", "),`
    float `+I+`() {
      `+F+` coords = getOutputCoords();
      `+V+`
      return get`+R+"("+L+`);
    }
  `})(g,w)),y})(m,e,n)})).join(`
`),l=e.texShape,c=Wr(),h=(function(m){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return `+m.texture2D+`(textureSampler, uv).r;
    }
  `})(c),f=(function(m){return m.version+`
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    `+m.varyingFs+` vec2 resultUV;
    `+m.defineOutput+`
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    `+m.defineSpecialNaN+`
    `+m.defineSpecialInf+`
    `+m.defineRound+`

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    `+t8+`
    `+n8+`
    `+r8+`
  `})(c);return e.isPacked?(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];return C[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * `+C[1]+`.0);
      }
    `:C[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * `+C[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      return 2 * (resTexRC.x * `+C[1]+` + resTexRC.y);
    }
  `})(0,g);case 2:return(function(_,k){var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)];if(wr(_,k))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(`+C[0]+", "+C[1]+`));
      }
    `;var R=Math.ceil(_[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));

      int index = resTexRC.x * `+C[1]+` + resTexRC.y;
      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=m,v=g,y=[Math.ceil(v[0]/2),Math.ceil(v[1]/2)],x=Math.ceil(w[2]/2),E=x*Math.ceil(w[1]/2),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+y[0]+", "+y[1]+`));
      int index = resTexRC.x * `+y[1]+` + resTexRC.y;

      int b = index / `+E+`;
      index -= b * `+E+`;

      int r = 2 * (index / `+x+`);
      int c = imod(index, `+x+`) * 2;

      return ivec3(b, r, c);
    }
  `;default:return(function(_,k){for(var C=[Math.ceil(k[0]/2),Math.ceil(k[1]/2)],R=Math.ceil(_[_.length-1]/2),I=R*Math.ceil(_[_.length-2]/2),T=I,A="",N="b, r, c",O=2;O<_.length-1;O++)T*=_[_.length-O-1],A=`
      int b`+O+" = index / "+T+`;
      index -= b`+O+" * "+T+`;
    `+A,N="b"+O+", "+N;return`
    ivec`+_.length+` getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+C[0]+", "+C[1]+`));
      int index = resTexRC.x * `+C[1]+` + resTexRC.y;

      `+A+`

      int b = index / `+I+`;
      index -= b * `+I+`;

      int r = 2 * (index / `+R+`);
      int c = imod(index, `+R+`) * 2;

      return ivec`+_.length+"("+N+`);
    }
  `})(m,g)}var w,v,y,x,E})(e.logicalShape,l),a=(function(m){return`
    void setOutput(vec4 val) {
      `+m.output+` = val;
    }
  `})(c)):(o=(function(m,g){switch(m.length){case 0:return`
    int getOutputCoords() {
      return 0;
    }
  `;case 1:return(function(y,x){return x[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * `+x[1]+`.0);
      }
    `:x[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * `+x[0]+`.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      return resTexRC.x * `+x[1]+` + resTexRC.y;
    }
  `})(0,g);case 2:return(function(y,x){return wr(y,x)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(`+x[0]+", "+x[1]+`));
      }
    `:y[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(index, 0);
      }
    `:y[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(`+x[0]+", "+x[1]+`));
        int index = resTexRC.x * `+x[1]+` + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      int r = index / `+y[1]+`;
      int c = index - r * `+y[1]+`;
      return ivec2(r, c);
    }
  `})(m,g);case 3:return w=g,v=$u(["r","c","d"],m),`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(`+w[0]+", "+w[1]+`));
      int index = resTexRC.x * `+w[1]+` + resTexRC.y;
      `+v+`
      return ivec3(r, c, d);
    }
  `;case 4:return(function(y,x){var E=$u(["r","c","d","d2"],y);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;
      `+E+`
      return ivec4(r, c, d, d2);
    }
  `})(m,g);case 5:return(function(y,x){var E=$u(["r","c","d","d2","d3"],y);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(`+x[0]+`,
                             `+x[1]+`));

      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `})(m,g);case 6:return(function(y,x){var E=$u(["r","c","d","d2","d3","d4"],y);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(`+x[0]+", "+x[1]+`));
      int index = resTexRC.x * `+x[1]+` + resTexRC.y;

      `+E+`

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `})(m,g);default:throw new Error(m.length+"-D output sampling is not yet supported")}var w,v})(e.logicalShape,l),a=(function(m){return`
    void setOutput(float val) {
      `+m.output+` = vec4(val, 0, 0, 0);
    }
  `})(c)),n&&(f+=i8),[f,h,a,s,o,u,t].join(`
`)}function cc(r){var e=r.shapeInfo.logicalShape;switch(e.length){case 0:return(function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return"float "+i+"() {return "+n+";}";var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(a===1&&s===1)return`
      float `+i+`() {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=t.shapeInfo.texShape,l=u[0],c=u[1],h=Tu(n);return`
    float `+i+`() {
      vec2 uv = uvFromFlat(`+l+", "+c+", "+h+`);
      return sampleTexture(`+n+`, uv);
    }
  `})(r);case 1:return(function(t){var n=t.name,i="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float `+i+`(int index) {
        `+Wl(t)+`
      }
    `;var o=t.shapeInfo.texShape,a=o[0],s=o[1];if(s===1&&a===1)return`
      float `+i+`(int index) {
        return sampleTexture(`+n+`, halfCR);
      }
    `;var u=Tu(n);return s===1?`
      float `+i+`(int index) {
        vec2 uv = vec2(0.5, (float(index + `+u+") + 0.5) / "+a+`.0);
        return sampleTexture(`+n+`, uv);
      }
    `:a===1?`
      float `+i+`(int index) {
        vec2 uv = vec2((float(index + `+u+") + 0.5) / "+s+`.0, 0.5);
        return sampleTexture(`+n+`, uv);
      }
    `:`
    float `+i+`(int index) {
      vec2 uv = uvFromFlat(`+a+", "+s+", index + "+u+`);
      return sampleTexture(`+n+`, uv);
    }
  `})(r);case 2:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=t.shapeInfo.texShape;if(a!=null&&wr(n,a)){var s=a[0],u=a[1];return`
    float `+o+`(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(`+u+".0, "+s+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `}var l=Hu(n),c=l.newShape,h=l.keptDims,f=c;if(f.length<n.length){var m=hc(t,f);return`
      `+cc(m)+`
      float `+o+`(int row, int col) {
        return `+o+"("+dc(["row","col"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(`+n[1]+`, 1)));
        `+Wl(t)+`
      }
    `;var g=a[0],w=a[1],v=Tu(i);return w===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / `+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `:g===1?`
    float `+o+`(int row, int col) {
      float index = dot(vec3(row, col, `+v+"), vec3("+n[1]+`, 1, 1));
      vec2 uv = vec2((index + 0.5) / `+w+`.0, 0.5);
      return sampleTexture(`+i+`, uv);
    }
  `:`
  float `+o+`(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * `+n[1]+" + col + "+v+`;
    vec2 uv = uvFromFlat(`+g+", "+w+`, index);
    return sampleTexture(`+i+`, uv);
  }
`})(r);case 3:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[1]*n[2],s=n[2],u=Hu(n),l=u.newShape,c=u.keptDims,h=l;if(h.length<n.length){var f=hc(t,h);return`
        `+cc(f)+`
        float `+o+`(int row, int col, int depth) {
          return `+o+"("+dc(["row","col","depth"],c)+`);
        }
      `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(`+a+", "+s+`, 1)));
        `+Wl(t)+`
      }
    `;var m=t.shapeInfo.texShape,g=m[0],w=m[1],v=t.shapeInfo.flatOffset;if(w===a&&v==null)return`
        float `+o+`(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(`+s+`, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(`+w+".0, "+g+`.0);
          return sampleTexture(`+i+`, uv);
        }
      `;if(w===s&&v==null)return`
    float `+o+`(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(`+n[1]+`, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+w+".0, "+g+`.0);
      return sampleTexture(`+i+`, uv);
    }
  `;var y=Tu(i);return`
      float `+o+`(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * `+a+" + col * "+s+" + depth + "+y+`;
        vec2 uv = uvFromFlat(`+g+", "+w+`, index);
        return sampleTexture(`+i+`, uv);
      }
  `})(r);case 4:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[3],s=n[2]*a,u=n[1]*s,l=Hu(n),c=l.newShape,h=l.keptDims;if(c.length<n.length){var f=hc(t,c);return`
      `+cc(f)+`
      float `+o+`(int row, int col, int depth, int depth2) {
        return `+o+"("+dc(["row","col","depth","depth2"],h)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(`+u+", "+s+", "+a+`, 1)));
        `+Wl(t)+`
      }
    `;var m=t.shapeInfo.flatOffset,g=t.shapeInfo.texShape,w=g[0],v=g[1];if(v===u&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(`+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(v===a&&m==null)return`
      float `+o+`(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(`+n[1]*n[2]+", "+n[2]+`, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+v+".0, "+w+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var y=Tu(i);return`
    float `+o+`(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+u+" + col * "+s+` +
          depth * `+a+` + depth2;
      vec2 uv = uvFromFlat(`+w+", "+v+", index + "+y+`);
      return sampleTexture(`+i+`, uv);
    }
  `})(r);case 5:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=n[4],s=n[3]*a,u=n[2]*s,l=n[1]*u,c=Hu(n),h=c.newShape,f=c.keptDims;if(h.length<n.length){var m=hc(t,h);return`
      `+cc(m)+`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        return `+o+"("+dc(["row","col","depth","depth2","depth3"],f)+`);
      }
    `}if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(`+l+", "+u+", "+s+", "+a+`)) +
          depth3;
        `+Wl(t)+`
      }
    `;var g=t.shapeInfo.flatOffset,w=t.shapeInfo.texShape,v=w[0],y=w[1];if(y===l&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(`+u+", "+s+", "+a+`, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(y===a&&g==null)return`
      float `+o+`(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]+`,
               `+n[2]*n[3]+", "+n[3]+`, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+y+".0, "+v+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var x=Tu(i);return`
    float `+o+`(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+l+" + col * "+u+" + depth * "+s+` +
          depth2 * `+a+" + depth3 + "+x+`;
      vec2 uv = uvFromFlat(`+v+", "+y+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(r);case 6:return(function(t){var n=t.shapeInfo.logicalShape,i=t.name,o="get"+i.charAt(0).toUpperCase()+i.slice(1),a=Hu(n),s=a.newShape,u=a.keptDims;if(s.length<n.length){var l=hc(t,s);return`
      `+cc(l)+`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return `+o+"("+dc(["row","col","depth","depth2","depth3","depth4"],u)+`);
      }
    `}var c=n[5],h=n[4]*c,f=n[3]*h,m=n[2]*f,g=n[1]*m;if(t.shapeInfo.isUniform)return`
      float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(`+g+", "+m+", "+f+", "+h+`)) +
          dot(
            vec2(depth3, depth4),
            vec2(`+c+`, 1)));
        `+Wl(t)+`
      }
    `;var w=t.shapeInfo.flatOffset,v=t.shapeInfo.texShape,y=v[0],x=v[1];if(x===g&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(`+m+", "+f+", "+h+", "+c+`)) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;if(x===c&&w==null)return`
      float `+o+`(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(`+n[1]*n[2]*n[3]*n[4]+`,
               `+n[2]*n[3]*n[4]+`,
               `+n[3]*n[4]+`,
               `+n[4]+`)) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(`+x+".0, "+y+`.0);
        return sampleTexture(`+i+`, uv);
      }
    `;var E=Tu(i);return`
    float `+o+`(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * `+g+" + col * "+m+" + depth * "+f+` +
          depth2 * `+h+" + depth3 * "+c+" + depth4 + "+E+`;
      vec2 uv = uvFromFlat(`+y+", "+x+`, index);
      return sampleTexture(`+i+`, uv);
    }
  `})(r);default:throw new Error(e.length+"-D input sampling is not yet supported")}}function j3(r){var e,t,n;switch(r.shapeInfo.logicalShape.length){case 0:return e=r.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Wr(),`
    vec4 `+t+`() {
      return `+n.texture2D+"("+e+`, halfCR);
    }
  `;case 1:return(function(i){var o=i.name,a="get"+o.charAt(0).toUpperCase()+o.slice(1),s=i.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],l=Wr();return`
    vec4 `+a+`(int index) {
      vec2 uv = packedUVfrom1D(
        `+u[0]+", "+u[1]+`, index);
      return `+l.texture2D+"("+o+`, uv);
    }
  `})(r);case 2:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=u[0],c=u[1],h=Wr();if(u!=null&&wr(o,u))return`
      vec4 `+s+`(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(`+c+".0, "+l+`.0);

        return `+h.texture2D+"("+a+`, uv);
      }
    `;var f=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)],m=Math.ceil(o[1]/2);return`
    vec4 `+s+`(int row, int col) {
      vec2 uv = packedUVfrom2D(`+m+", "+f[0]+", "+f[1]+`, row, col);
      return `+h.texture2D+"("+a+`, uv);
    }
  `})(r);case 3:return(function(i){var o=i.shapeInfo.logicalShape,a=i.name,s="get"+a.charAt(0).toUpperCase()+a.slice(1),u=i.shapeInfo.texShape,l=[Math.ceil(u[0]/2),Math.ceil(u[1]/2)];if(o[0]===1){var c=o.slice(1),h=hc(i,c);return`
        `+j3(h)+`
        vec4 `+s+`(int b, int row, int col) {
          return `+s+"("+dc(["b","row","col"],[1,2])+`);
        }
      `}var f=l[0],m=l[1],g=Math.ceil(o[2]/2),w=g*Math.ceil(o[1]/2),v=Wr();return`
    vec4 `+s+`(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        `+f+", "+m+", "+w+", "+g+`, b, row, col);
      return `+v.texture2D+"("+a+`, uv);
    }
  `})(r);default:return(function(i){for(var o=i.shapeInfo.logicalShape,a=o.length,s=i.name,u="get"+s.charAt(0).toUpperCase()+s.slice(1),l=i.shapeInfo.texShape,c=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)],h=c[0],f=c[1],m=Math.ceil(o[a-1]/2),g=m*Math.ceil(o[a-2]/2),w="int b, int row, int col",v="b * "+g+" + (row / 2) * "+m+" + (col / 2)",y=2;y<a-1;y++)w="int b"+y+", "+w,g*=o[a-y-1],v="b"+y+" * "+g+" + "+v;var x=Wr();return`
    vec4 `+u+"("+w+`) {
      int index = `+v+`;
      int texR = index / `+f+`;
      int texC = index - texR * `+f+`;
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+f+", "+h+`);
      return `+x.texture2D+"("+s+`, uv);
    }
  `})(r)}}var t8=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,n8=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,r8=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,i8=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function Tu(r){return"offset"+r}function Wl(r){var e=r.name,t=bt(r.shapeInfo.logicalShape);return t<2?"return "+e+";":`
    for (int i = 0; i < `+t+`; i++) {
      if (i == index) {
        return `+e+`[i];
      }
    }
  `}function Fn(r){if(r<=1)return"int";if(r===2)return"ivec2";if(r===3)return"ivec3";if(r===4)return"ivec4";if(r===5)return"ivec5";if(r===6)return"ivec6";throw Error("GPU for rank "+r+" is not yet supported")}function hc(r,e){var t=JSON.parse(JSON.stringify(r));return t.shapeInfo.logicalShape=e,t}function dc(r,e){return e.map((function(t){return r[t]})).join(", ")}var o8=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,K(r.length>2,(function(){return"Packed arg"+(t.charAt(0).toUpperCase()+t.slice(1))+" supports only inputs with rank above 2."}));var i=r[r.length-1],o=Math.ceil(i/e);this.outputShape=r.slice(0,-1),o>1&&this.outputShape.push(o),n||this.variableNames.push("bestIndicesA");var a,s,u=this.outputShape,l=u.length,c=Fn(l),h=mi("coords",l);if(o===1){var f=Fn(s=l+1);a=`
        `+f+" sourceLocR = "+f+"("+h.join()+`, 0);
        ++`+h[l-1]+`;
        `+f+" sourceLocG = "+f+"("+h.join()+`, 0);
        ++`+h[l-2]+`;
        `+f+" sourceLocA = "+f+"("+h.join()+`, 0);
        --`+h[l-1]+`;
        `+f+" sourceLocB = "+f+"("+h.join()+`, 0);
        --`+h[l-2]+";"}else s=l,a=`
        `+c+` sourceLocR = coords;
        ++`+h[l-1]+`;
        `+c+` sourceLocG = coords;
        ++`+h[l-2]+`;
        `+c+` sourceLocA = coords;
        --`+h[l-1]+`;
        `+c+` sourceLocB = coords;
        --`+h[l-2]+";";var m=["x","y","z","w","u","v"].slice(0,s),g="."+m[s-1],w=m.map((function(I){return"int "+I})),v=mi("sourceLocR",s-1).concat("inIdx.r"),y=mi("sourceLocG",s-1).concat("inIdx.g"),x=mi("sourceLocB",s-1).concat("inIdx.b"),E=mi("sourceLocA",s-1).concat("inIdx.a"),_=t==="max"?"greaterThan":"lessThan",k=n?"":`
          inIdx = round(vec4(getBestIndicesAChannel(`+v.join()+`),
                             getBestIndicesAChannel(`+y.join()+`),
                             getBestIndicesAChannel(`+x.join()+`),
                             getBestIndicesAChannel(`+E.join()+")));",C=`vec4(
            getAChannel(`+v.join()+`),
            hasNextCol ? getAChannel(`+y.join()+`) : 0.,
            hasNextRow ? getAChannel(`+x.join()+`) : 0.,
            hasNextRow && hasNextCol ? getAChannel(`+E.join()+") : 0.)",R=n?"":`
      float getBestIndicesAChannel(`+w.join()+`) {
        return getChannel(getBestIndicesA(`+m.join()+`),
                                          vec2(`+m.slice(-2).join()+`));
      }`;this.userCode=`
      float getAChannel(`+w.join()+`) {
        return getChannel(getA(`+m.join()+`),
                               vec2(`+m.slice(-2).join()+`));
      }
      `+R+`
      void main() {
        `+c+` coords = getOutputCoords();
        bool hasNextCol = `+h[l-1]+" < "+(u[l-1]-1)+`;
        bool hasNextRow = `+h[l-2]+" < "+(u[l-2]-1)+`;
        `+a+`
        ivec4 srcIdx = ivec4(sourceLocR`+g+", sourceLocG"+g+`,
          sourceLocB`+g+", sourceLocA"+g+") * "+e+`;
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = `+C+`;

        for (int i = 0; i < `+e+`; i++) {
          inIdx = srcIdx;
          `+k+`
          vec4 candidate = `+C+`;
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(`+_+`(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `},a8=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterHeight,u=r.effectiveFilterWidth,l=s-1-r.padInfo.top,c=u-1-r.padInfo.left,h=1/(e*t);this.userCode=`
      const ivec2 pads = ivec2(`+l+", "+c+`);
      const float avgMultiplier = float(`+h+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+s+`;
            wR += `+o+`) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+u+`;
            wC+= `+a+`) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `},s8=function(r){this.variableNames=["dy"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterDepth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,m=c-1-r.padInfo.front,g=h-1-r.padInfo.top,w=f-1-r.padInfo.left,v=1/(e*t*n);this.userCode=`
      const ivec3 pads = ivec3(`+m+", "+g+", "+w+`);
      const float avgMultiplier = float(`+v+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+c+`;
            wD += `+s+`) {
          float dyD = float(dyDCorner + wD) / `+i+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+h+`;
              wR += `+u+`) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+f+`;
                wC += `+l+`) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `},u8=function(r,e,t,n,i,o){this.outputShape=[],this.variableNames=["x","mean","variance"],on(r,e),on(r,t);var a="0.0";n!=null&&(on(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="1.0";i!=null&&(on(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = `+a+`;
        float scale = `+s+`;
        float inv = scale * inversesqrt(variance + float(`+o+`));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `},l8=function(r,e,t,n,i,o){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],on(r,e),on(r,t);var a="vec4(0.0)";n!=null&&(on(r,n),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");var s="vec4(1.0)";i!=null&&(on(r,i),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=r,this.userCode=`
      void main() {
        vec4 offset = `+a+`;
        vec4 scale = `+s+`;

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(`+o+`));

        setOutput((x - mean) * inv + offset);
      }
    `},c8="return areal * breal - aimag * bimag;",h8="return areal * bimag + aimag * breal;",nE=function(r,e,t){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=on(e,t),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        `+r+`
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `},qy="return a + b;",$y="return a - b;",rE="return a * b;",d8=`
if (a == b) {
  return 1.0;
};
return a / b;`,q3="return (a < 0.) ? b * a : a;",qn=function(r,e,t){this.variableNames=["A","B"],this.outputShape=on(e,t),this.userCode=`
      float binaryOperation(float a, float b) {
        `+r+`
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `},f8=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,$3=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`,Qo=function(r,e,t,n){n===void 0&&(n=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=on(e,t);var i=this.outputShape.length,o="";if(n)if(i===0||bt(this.outputShape)===1)o=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(o=`
          `+Fn(i)+` coords = getOutputCoords();
        `,i===1)o+=`
            result.y = (coords + 1) >= `+this.outputShape[0]+` ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{var a=mi("coords",i);o+=`
            bool nextRowOutOfBounds =
              (`+a[i-2]+" + 1) >= "+this.outputShape[i-2]+`;
            bool nextColOutOfBounds =
              (`+a[i-1]+" + 1) >= "+this.outputShape[i-1]+`;
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        `+r+`
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        `+o+`

        setOutput(result);
      }
    `},p8=(function(){function r(e){this.variableNames=["A"],this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r})(),m8=(function(){function r(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}return r.prototype.getCustomSetupFunc=function(e,t){var n=this;return function(i,o){n.minLoc==null&&(n.minLoc=i.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=i.getUniformLocationNoThrow(o,"maxVal")),i.gl.uniform1f(n.minLoc,e),i.gl.uniform1f(n.maxLoc,t)}},r})(),g8=function(r){this.variableNames=["real","imag"],this.outputShape=r,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `},v8=function(r){this.outputShape=[],this.outputShape=Uc(r,1),this.variableNames=r.map((function(s,u){return"T"+u}));var e=new Array(r.length-1);e[0]=r[0][1];for(var t=1;t<e.length;t++)e[t]=e[t-1]+r[t][1];var n=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(t=1;t<e.length;t++){var i=e[t-1];n.push("else if (yC < "+e[t]+") setOutput(getT"+t+"(yR, yC-"+i+"));")}var o=e.length,a=e[e.length-1];n.push("else setOutput(getT"+o+"(yR, yC-"+a+"));"),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        `+n.join(`
        `)+`
      }
    `},y8=function(r,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Uc(r,e);var t=this.outputShape,n=t.length,i=Fn(n),o=mi("coords",n),a=["x","y","z","w","u","v"].slice(0,n);this.variableNames=r.map((function(v,y){return"T"+y}));var s=new Array(r.length-1);s[0]=r[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+r[u][e];var l=a[e],c=a.slice(-2),h=a.join(),f="if ("+l+" < "+s[0]+`) {
        return getChannel(
            getT0(`+h+"), vec2("+c.join()+`));
        }`;for(u=1;u<s.length;u++){var m=s[u-1];f+=`
        if (`+l+" < "+s[u]+"  && "+l+" >= "+s[u-1]+`) {
          return getChannel(
            getT`+u+"("+fp(a,l,m)+`),
            vec2(`+fp(c,l,m)+`));
        }`}var g=s.length,w=s[s.length-1];f+=`
        return getChannel(
          getT`+g+"("+fp(a,l,w)+`),
          vec2(`+fp(c,l,w)+"));",this.userCode=`
      float getValue(`+a.map((function(v){return"int "+v}))+`) {
        `+f+`
      }

      void main() {
        `+i+` coords = getOutputCoords();
        vec4 result = vec4(getValue(`+o+`), 0., 0., 0.);

        `+o[n-1]+" = "+o[n-1]+` + 1;
        if (`+o[n-1]+" < "+t[n-1]+`) {
          result.g = getValue(`+o+`);
        }

        `+o[n-2]+" = "+o[n-2]+` + 1;
        if (`+o[n-2]+" < "+t[n-2]+`) {
          result.a = getValue(`+o+`);
        }

        `+o[n-1]+" = "+o[n-1]+` - 1;
        if (`+o[n-2]+" < "+t[n-2]+` &&
            `+o[n-1]+" < "+t[n-1]+`) {
          result.b = getValue(`+o+`);
        }
        setOutput(result);
      }
    `};function fp(r,e,t){var n=r.indexOf(e);return r.map((function(i,o){return o===n?i+" - "+t:i})).join()}var b8=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              if (`+o+`) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},w8=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=r.dataFormat==="channelsLast",a=e-1-r.padInfo.top,s=t-1-r.padInfo.left,u=o?1:2,l=o?2:3,c=o?3:1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[`+c+`];

        ivec2 dyCorner = ivec2(coords[`+u+"], coords["+l+`]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {

              if (`+o+`) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `},_8=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.padInfo.front,o=r.padInfo.top,a=r.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yF = 0; yF < `+r.outDepth+`; yF++) {
            int xF = wF + yF * `+e+" - "+i+`;

            if (xF < 0 || xF >= `+r.inDepth+`) {
              continue;
            }

            for (int yR = 0; yR < `+r.outHeight+`; yR++) {
              int xR = wR + yR * `+t+" - "+o+`;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int yC = 0; yC < `+r.outWidth+`; yC++) {
                int xC = wC + yC * `+n+" - "+a+`;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},x8=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterDepth,t=r.filterHeight,n=r.filterWidth,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=e-1-r.padInfo.front,u=t-1-r.padInfo.top,l=n-1-r.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(`+s+", "+u+", "+l+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < `+e+`; wF++) {
          float dyF = float(dyFCorner + wF) / `+i+`.0;

          if (dyF < 0.0 || dyF >= `+r.outDepth+`.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = `+e+` - 1 - wF;

          for (int wR = 0; wR < `+t+`; wR++) {
            float dyR = float(dyRCorner + wR) / `+o+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = `+t+` - 1 - wR;

            for (int wC = 0; wC < `+n+`; wC++) {
              float dyC = float(dyCCorner + wC) / `+a+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = `+n+` - 1 - wC;

              for (int d2 = 0; d2 < `+r.outChannels+`; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},S8=function(r){this.variableNames=["x","dy"],this.outputShape=r.filterShape;var e=r.strideHeight,t=r.strideWidth,n=r.padInfo.top,i=r.padInfo.left,o=r.outChannels/r.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * `+o+` + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < `+r.batchSize+`; b++) {
          for (int yR = 0; yR < `+r.outHeight+`; yR++) {
            int xR = wR + yR * `+e+" - "+n+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int yC = 0; yC < `+r.outWidth+`; yC++) {
              int xC = wC + yC * `+t+" - "+i+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `},E8=function(r){this.variableNames=["dy","W"],this.outputShape=r.inShape;var e=r.filterHeight,t=r.filterWidth,n=r.strideHeight,i=r.strideWidth,o=e-1-r.padInfo.top,a=t-1-r.padInfo.left,s=r.outChannels/r.inChannels;this.userCode=`
      const ivec2 pads = ivec2(`+o+", "+a+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < `+e+`; wR++) {
          float dyR = float(dyRCorner + wR) / `+n+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = `+e+` - 1 - wR;

          for (int wC = 0; wC < `+t+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+i+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = `+t+` - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < `+s+`; dm++) {
              int d2 = d1 * `+s+` + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `},iE=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.padInfo.top,o=r.padInfo.left,a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.filterHeight,h=r.filterWidth,f=4*Math.floor(r.inChannels/4),m=r.inChannels%4,g=r.dataFormat==="channelsLast",w=g?1:2,v=g?2:3,y=g?3:1,x="",E="";t&&(x=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,E="result = activation(result);");var _=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+x+`

      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+i+", "+o+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[`+y+`];

        ivec2 xRCCorner =
            ivec2(coords[`+w+"], coords["+v+`]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+c+`; wR++) {
          int xR = xRCorner + wR * `+u+`;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+h+`; wC++) {
            int xC = xCCorner + wC * `+l+`;

            if (xC < 0 || xC >= `+r.inWidth+`) {
              continue;
            }

            for (int d1 = 0; d1 < `+f+`; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (`+g+`) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (`+(m===1)+`) {

              if (`+g+`) {
                dotProd +=
                    getX(batch, xR, xC, `+f+`) *
                    getW(wR, wC, `+f+`, d2);
              } else {
                dotProd +=
                    getX(batch, `+f+`, xR, xC) *
                    getW(wR, wC, `+f+`, d2);
              }

            } else if (`+(m===2)+`) {
              vec2 wValues = vec2(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2)
              );

              if (`+g+`) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (`+(m===3)+`) {
              vec3 wValues = vec3(
                getW(wR, wC, `+f+`, d2),
                getW(wR, wC, `+f+` + 1, d2),
                getW(wR, wC, `+f+` + 2, d2)
              );

              if (`+g+`) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, `+f+`),
                  getX(batch, xR, xC, `+f+` + 1),
                  getX(batch, xR, xC, `+f+` + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, `+f+`, xR, xC),
                  getX(batch, `+f+` + 1, xR, xC),
                  getX(batch, `+f+` + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        `+_+`
        `+E+`
        setOutput(result);
      }
    `},k8=function(r){this.variableNames=["x","W"],this.outputShape=r.outShape;var e=r.padInfo.front,t=r.padInfo.top,n=r.padInfo.left,i=r.strideDepth,o=r.strideHeight,a=r.strideWidth,s=r.dilationDepth,u=r.dilationHeight,l=r.dilationWidth,c=r.filterDepth,h=r.filterHeight,f=r.filterWidth,m=4*Math.floor(r.inChannels/4),g=r.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(`+i+", "+o+", "+a+`);
      const ivec3 pads = ivec3(`+e+", "+t+", "+n+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < `+c+`; wF++) {
          int xF = xFCorner + wF * `+s+`;

          if (xF < 0 || xF >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+h+`; wR++) {
            int xR = xRCorner + wR * `+u+`;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+f+`; wC++) {
              int xC = xCCorner + wC * `+l+`;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              for (int d1 = 0; d1 < `+m+`; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (`+(g===1)+`) {
                dotProd +=
                  getX(batch, xF, xR, xC, `+m+`) *
                  getW(wF, wR, wC, `+m+`, d2);
              } else if (`+(g===2)+`) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (`+(g===3)+`) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, `+m+`),
                  getX(batch, xF, xR, xC, `+m+` + 1),
                  getX(batch, xF, xR, xC, `+m+` + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, `+m+`, d2),
                  getW(wF, wR, wC, `+m+` + 1, d2),
                  getW(wF, wR, wC, `+m+` + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `},oE=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.outputShape=r.outShape;var i=r.inHeight,o=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,h=r.dilationWidth,f=r.filterHeight,m=r.filterWidth,g=r.outChannels/r.inChannels,w="",v="";t&&(w=n?`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`
          float activation(float x) {
            `+t+`
          }
        `,v="result = activation(result);");var y=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+w+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / `+g+`;
        int q = d2 - d1 * `+g+`;

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < `+f+`; wR++) {
          int xR = xRCorner + wR * `+c+`;

          if (xR < 0 || xR >= `+i+`) {
            continue;
          }

          for (int wC = 0; wC < `+m+`; wC++) {
            int xC = xCCorner + wC * `+h+`;

            if (xC < 0 || xC >= `+o+`) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        `+y+`
        `+v+`
        setOutput(result);
      }
    `},aE=function(r,e,t,n){e===void 0&&(e=!1),t===void 0&&(t=null),n===void 0&&(n=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.outShape;for(var i=r.inHeight,o=r.inWidth,a=r.padInfo.top,s=r.padInfo.left,u=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,h=r.dilationWidth,f=r.filterHeight,m=r.filterWidth,g=m,w="int xR; int xC; int xCOffset;",v=0;v<f;v++)for(var y=0;y<m;y++)w+=`
          vec4 xTexelR`+v+"C"+2*y+` = vec4(0.);
          vec4 wR`+v+"C"+y+` = vec4(0.);
          vec4 xR`+v+"C"+y+" = vec4(0.);";for(v=0;v<f;v++)for(var x=0;x<g;x++){if(w+=`
          xR = xRCorner + `+v*c+`;
          xC = xCCorner + `+(y=2*x)*h+`;
        `,l===1){if(y<m&&(w+=s%2==1?`
                xCOffset = xC + 1;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    xTexelR`+v+"C"+y+`.zw = vec2(0.);
                  }
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                xCOffset = xC + 1 - 2;
                if(xR >= 0 && xR < `+i+" && xCOffset >= 0 && xCOffset < "+o+`) {
                  vec4 previous = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if(xCOffset + 1 >= `+o+`) {
                    previous.zw = vec2(0.);
                  }

                  xR`+v+"C"+y+" = vec4(previous.zw, xTexelR"+v+"C"+y+`.xy);
                } else {
                  xR`+v+"C"+y+" = vec4(0, 0, xTexelR"+v+"C"+y+`.xy);
                }
              `:`
                if(xR >= 0 && xR < `+i+" && xC >= 0 && xC < "+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                xR`+v+"C"+y+" = xTexelR"+v+"C"+y+`;
              `,y+1<m)){var E=s%2==0?n3(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(w+=`
                  xCOffset = xC + `+s%2+" + "+E+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                  }
                `,h>1&&(w+=`
                    xCOffset -= 2;
                    if(xR >= 0 && xR < `+i+` &&
                      xCOffset >= 0 && xCOffset < `+o+`) {
                      xTexelR`+v+"C"+y+` = getX(batch, xR, xCOffset, d1);
                    } else {
                      xTexelR`+v+"C"+y+` = vec4(0.);
                    }
                  `),w+=`
                  xR`+v+"C"+(y+1)+` = vec4(
                    xTexelR`+v+"C"+y+".zw, xTexelR"+v+"C"+(y+2)+`.xy);
                `):w+=`
                  xCOffset = xC + `+E+`;

                  if(xR >= 0 && xR < `+i+` &&
                    xCOffset >= 0 && xCOffset < `+o+`) {
                    xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                  }

                  xR`+v+"C"+(y+1)+" = xTexelR"+v+"C"+(y+2)+`;
                `}}else y<m&&(w+=`
              if(xR >= 0 && xR < `+i+`) {
            `,s%2==1?(w+=`
                xCOffset = xC + 1 - `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                if(xC + 1 >= 0 && xC + 1 < `+o+`) {
                  xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xC + 1, d1);
                } else {
                  xTexelR`+v+"C"+(y+2)+` = vec4(0.);
                }

                xR`+v+"C"+y+` = vec4(
                  xTexelR`+v+"C"+y+".zw, xTexelR"+v+"C"+(y+2)+`.zw);
              `,y+1<m&&(w+=`
                  vec4 final = vec4(0.);
                  xCOffset = xC + 1 + `+l+`;
                  if(xCOffset >= 0 && xCOffset < `+o+`) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xR`+v+"C"+(y+1)+" = vec4(xTexelR"+v+"C"+(y+2)+`.xy, final.xy);
                `)):(w+=`
                if(xC >= 0 && xC < `+o+`) {
                  xTexelR`+v+"C"+y+` = getX(batch, xR, xC, d1);
                } else {
                  xTexelR`+v+"C"+y+` = vec4(0.);
                }

                xCOffset = xC + `+l+`;
                if(xCOffset >= 0 && xCOffset < `+o+`) {
                  xTexelR`+v+"C"+(y+2)+` = getX(batch, xR, xCOffset, d1);
                } else {
                  xTexelR`+v+"C"+(y+2)+` = vec4(0.);
                }

                xR`+v+"C"+y+` = vec4(
                  xTexelR`+v+"C"+y+".xy, xTexelR"+v+"C"+(y+2)+`.xy);
              `,y+1<m&&(w+=`
                  xR`+v+"C"+(y+1)+` = vec4(
                    xTexelR`+v+"C"+y+".zw, xTexelR"+v+"C"+(y+2)+`.zw);
                `)),w+="}");y<m&&(w+=`
            vec4 wTexelR`+v+"C"+y+" = getW("+v+", "+y+`, d1, q);
            wR`+v+"C"+y+" = vec4(wTexelR"+v+"C"+y+".xz, wTexelR"+v+"C"+y+`.xz);
          `,y+1<m&&(w+=`
              vec4 wTexelR`+v+"C"+(y+1)+" = getW("+v+", "+(y+1)+`, d1, q);
              wR`+v+"C"+(y+1)+` =
                vec4(wTexelR`+v+"C"+(y+1)+".xz, wTexelR"+v+"C"+(y+1)+".xz);"))}for(v=0;v<f;v++)for(y=0;y<m;y++)w+="dotProd += xR"+v+"C"+y+" * wR"+v+"C"+y+";";var _="",k="";t&&(_=n?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+t+`
        }`:`vec4 activation(vec4 x) {
          `+t+`
        }`,k="result = activation(result);");var C=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),n&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+_+`

      const ivec2 strides = ivec2(`+u+", "+l+`);
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2;
        int q = 0;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        vec4 dotProd = vec4(0.);

        `+w+`

        vec4 result = dotProd;
        `+C+`
        `+k+`
        setOutput(result);
      }
    `},C8=function(r,e,t,n,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=r[0],a=r[1],s=r[2],u=r[3],l=e[0],c=t[0],h=t[1];this.outputShape=[l,c,h,u];var f=n==="bilinear"?1:0,m=[a-1+".0",s-1+".0"],g=m[0],w=m[1],v=c>1?[""+(a-1)/(c-1),"(y2-y1) * height_ratio","y1*"+g+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+g],y=v[0],x=v[1],E=v[2],_=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+w+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+w],k=_[0],C=_[1],R=_[2];this.userCode=`
      const float height_ratio = float(`+y+`);
      const float width_ratio = float(`+k+`);
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= `+o+`) {
          return;
        }

        float height_scale = `+x+`;
        float width_scale = `+C+`;

        float in_y = `+E+`;
        if( in_y < 0.0 || in_y > `+g+` ) {
          setOutput(float(`+i+`));
          return;
        }
        float in_x = `+R+`;
        if( in_x < 0.0 || in_x > `+w+` ) {
          setOutput(float(`+i+`));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(`+f+` == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `},T8=function(r,e,t){this.variableNames=["x"],this.outputShape=r;var n=r.length,i=r[r.length-1],o=t?"<":">";this.userCode=`
      int getIndex(int i) {
        `+(t?"return "+i+" -i - 1;":"return i;")+`
      }

      void main() {
        `+Fn(n)+` coords = getOutputCoords();
        int end = `+sE(n,"coords")+`;
        float val = 0.0;
        for (int i = `+i+` - 1; i >= 0; i -= 1) {
          int idx = getIndex(i);
          if (idx `+o+` end) {
            continue;
          }
          if (idx == end && `+e+`) {
            continue;
          }
          `+sE(n,"coords")+` = idx;
          val += getX(`+(function(a,s){if(a===1)return""+s;if(a===2)return s+".x, "+s+".y";if(a===3)return s+".x, "+s+".y, "+s+".z";if(a===4)return s+".x, "+s+".y, "+s+".z, "+s+".w";throw Error("Cumulative sum for rank "+a+" is not yet supported")})(n,"coords")+`);
        }
        setOutput(val);
      }
    `};function sE(r,e){if(r===1)return""+e;if(r===2)return e+".y";if(r===3)return e+".z";if(r===4)return e+".w";throw Error("Cumulative sum for rank "+r+" is not yet supported")}var M8=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=nd.DENSE;var e=$h(r),t=Wr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+$u(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        `+t.output+` = result;
      }
    `},A8=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=nd.DENSE;var e=$h(r),t=Wr();this.outputShape=r,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        `+$u(["r","c","d"],r)+`
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(`+e[0]+", "+e[1]+`));
        int index = 4 * (resTexRC.x * `+e[1]+` + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        `+t.output+` = result;
      }
    `},R8=(function(){function r(e,t,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = `+this.getHeightCoordString()+`;
      int w = `+this.getWidthCoordString()+`;
      int d = `+this.getDepthCoordString()+`;

      int in_h = h / `+t+`;
      int offset_h = imod(h, `+t+`);
      int in_w = w / `+t+`;
      int offset_w = imod(w, `+t+`);
      int offset_d = (offset_h * `+t+` + offset_w) *
        `+this.getOutputDepthSize()+`;
      int in_d = d + offset_d;

      float result = `+this.getInputSamplingString()+`;
      setOutput(result);
    }
  `}return r.prototype.getHeightCoordString=function(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"},r.prototype.getWidthCoordString=function(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"},r.prototype.getDepthCoordString=function(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"},r.prototype.getOutputDepthSize=function(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]},r.prototype.getInputSamplingString=function(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},r})(),I8=function(r){this.variableNames=["X"],this.outputShape=[r,r],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `},D8=function(r){this.variableNames=["A"],this.outTexUsage=Li.DOWNLOAD;var e=Wr();this.outputShape=r,this.userCode=`
      `+V3+`

      void main() {
        float x = getAAtOutCoords();
        `+e.output+` = encode_float(x);
      }
    `},N8=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Li.DOWNLOAD;var e=Wr();this.outputShape=r,this.userCode=`
      `+V3+`

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        `+e.output+` = encode_float(x);
      }
    `},P8=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"];var n=Wr(),i=e[0],o=e[1];this.outputShape=r;var a="result";t&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      `+qw(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);
        
        int r = flatIndex / `+o+`;
        int c = imod(flatIndex, `+o+`);
        vec2 uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
        vec4 values = `+n.texture2D+`(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        `+n.output+" = vec4("+a+`, 0., 0., 0.);
      }
    `},F8=function(r,e,t){t===void 0&&(t=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=Wr(),i=e[0],o=e[1];this.outputShape=r;var a="",s="result";t&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var l=0;l<=1;l++){var c=2*u+l;a+=`
          localCoords = coords;
          if(localCoords[2] + `+l+" < "+r[2]+`) {
            localCoords[2] += `+l+`;
            if(localCoords[1] + `+u+" < "+r[1]+`) {
              localCoords[1] += `+u+`;

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / `+o+`;
              c = imod(flatIndex, `+o+`);
              uv = (vec2(c, r) + halfCR) / vec2(`+o+".0, "+i+`.0);
              values = `+n.texture2D+`(A, uv);

              if(offset == 0) {
                result[`+c+`] = values[0];
              } else if(offset == 1) {
                result[`+c+`] = values[1];
              } else if(offset == 2) {
                result[`+c+`] = values[2];
              } else {
                result[`+c+`] = values[3];
              }
            }
          }
        `}this.userCode=`
      `+qw(r)+`

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        `+a+`

        `+n.output+" = "+s+`;
      }
    `},O8="return real * expR - imag * expI;",L8="return real * expI + imag * expR;",uE=function(r,e,t){this.variableNames=["real","imag"];var n=e[1];this.outputShape=e;var i=t?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,o=t?n+".0":"1.0";this.userCode=`
      const float exponentMultiplier = `+i+`;

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        `+r+`
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(`+n+`);
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < `+n+`; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / `+o+`;
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `},B8=(function(){function r(e,t){this.outputShape=[],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.valueLoc==null&&(t.valueLoc=n.getUniformLocationNoThrow(i,"value")),n.gl.uniform1f(t.valueLoc,e)}},r})(),U8=function(r,e,t){this.variableNames=["A","indices"];var n=r.slice();n[t]=e,this.outputShape=n,this.rank=n.length;var i=Fn(this.rank),o=(function(a,s){var u=a.length;if(u>4)throw Error("Gather for rank "+u+" is not yet supported");if(u===1)return"int(getIndices(resRC))";for(var l=["resRC.x","resRC.y","resRC.z","resRC.w"],c=[],h=0;h<a.length;h++)h===s?c.push("int(getIndices("+l[h]+"))"):c.push(""+l[h]);return c.join()})(r,t);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},z8=function(r,e,t){this.sliceDim=r,this.strides=e,this.variableNames=["x","indices"],this.outputShape=t;var n=Fn(e.length),i=Fn(t.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        `+n+" strides = "+n+"("+this.strides+`);
         void main() {
          `+i+` coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < `+this.sliceDim+`; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * `+o+`;
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `};function W8(r,e){var t=Wr();return cB(r,e,t.version+`
    precision highp float;
    `+t.attribute+` vec3 clipSpacePos;
    `+t.attribute+` vec2 uv;
    `+t.varyingVs+` vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`)}function H8(r,e){return mB(r,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function G8(r,e){return gB(r,e,new Uint16Array([0,1,2,2,1,3]))}function Md(r,e,t,n,i,o,a){yB(t,n);var s=vB(r,e),u=r.TEXTURE_2D;return kt(r,e,(function(){return r.bindTexture(u,s)})),kt(r,e,(function(){return r.texParameteri(u,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE)})),kt(r,e,(function(){return r.texParameteri(u,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE)})),kt(r,e,(function(){return r.texParameteri(u,r.TEXTURE_MIN_FILTER,r.NEAREST)})),kt(r,e,(function(){return r.texParameteri(u,r.TEXTURE_MAG_FILTER,r.NEAREST)})),kt(r,e,(function(){return r.texImage2D(u,0,i,t,n,0,o,a,null)})),kt(r,e,(function(){return r.bindTexture(r.TEXTURE_2D,null)})),s}function V8(r,e,t,n,i){var o=rg(t,n);return Md(r,e,o[0],o[1],i.internalFormatFloat,i.textureFormatFloat,r.FLOAT)}function j8(r,e,t,n,i){var o=rg(t,n);return Md(r,e,o[0],o[1],i.internalFormatHalfFloat,i.textureFormatFloat,i.textureTypeHalfFloat)}function q8(r,e,t,n,i){var o=rg(t,n);return Md(r,e,o[0],o[1],r.RGBA,r.RGBA,r.UNSIGNED_BYTE)}function $8(r,e,t,n,i){var o=Td(t,n);return Md(r,e,o[0],o[1],i.internalFormatPackedFloat,r.RGBA,r.FLOAT)}function X8(r,e,t,n,i){var o=Td(t,n);return Md(r,e,o[0],o[1],i.internalFormatPackedHalfFloat,r.RGBA,i.textureTypeHalfFloat)}function Y8(r,e,t,n){return kt(r,e,(function(){return r.bindBuffer(r.ARRAY_BUFFER,n)})),YS(r,e,t,"clipSpacePos",n,3,20,0)&&YS(r,e,t,"uv",n,2,20,12)}function K8(r,e,t,n,i,o,a){var s,u,l;kt(r,e,(function(){return r.bindTexture(r.TEXTURE_2D,t)})),o instanceof Uint8Array?(s=new Uint8Array(n*i*4),u=r.UNSIGNED_BYTE,l=r.RGBA):(s=new Float32Array(n*i*4),u=r.FLOAT,l=a.internalFormatPackedFloat),s.set(o),kt(r,e,(function(){return r.texImage2D(r.TEXTURE_2D,0,l,n,i,0,r.RGBA,u,s)})),kt(r,e,(function(){return r.bindTexture(r.TEXTURE_2D,null)}))}function J8(r,e,t,n){kt(r,e,(function(){return r.bindTexture(r.TEXTURE_2D,t)})),n.data instanceof Uint8Array?kt(r,e,(function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n.width,n.height,0,r.RGBA,r.UNSIGNED_BYTE,n.data)})):kt(r,e,(function(){return r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n)})),kt(r,e,(function(){return r.bindTexture(r.TEXTURE_2D,null)}))}function Z8(r,e,t,n,i){var o=r.createBuffer();kt(r,e,(function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,o)}));var a=16*t*n;return kt(r,e,(function(){return r.bufferData(r.PIXEL_PACK_BUFFER,a,r.STREAM_READ)})),kt(r,e,(function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,0)})),kt(r,e,(function(){return r.bindBuffer(r.PIXEL_PACK_BUFFER,null)})),o}function Q8(r,e,t){var n=r,i=new Float32Array(t);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,i),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),i}function eU(r,e,t,n,i){var o=rg(t,n),a=o[0],s=o[1],u=new Uint8Array(t*n*4);return kt(r,e,(function(){return r.readPixels(0,0,a,s,i.downloadTextureFormat,r.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function tU(r,e,t,n,i,o,a,s){var u=r,l=new Float32Array((function(c,h){var f=Td(c,h);return f[0]*f[1]*4})(o,a));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,l),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),l}function nU(r,e,t,n){var i=new Float32Array(t*n*4);return kt(r,e,(function(){return r.readPixels(0,0,n,t,r.RGBA,r.FLOAT,i)})),i}var rU=(function(){function r(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var t=Ne().getNumber("WEBGL_VERSION");e!=null?(this.gl=e,oB(t,e)):this.gl=ba(t);var n="WEBGL_color_buffer_float";if(Ne().getNumber("WEBGL_VERSION")===1){if(this.textureFloatExtension=lp(this.gl,this.debug,"OES_texture_float"),ro(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=lp(this.gl,this.debug,"OES_texture_half_float");else if(Ne().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ro(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=lp(this.gl,this.debug,"EXT_color_buffer_half_float");else if(Ne().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ro(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!ro(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=H8(this.gl,this.debug),this.indexBuffer=G8(this.gl,this.debug),this.framebuffer=bB(this.gl,this.debug),this.textureConfig=Ow(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(r.prototype,"debug",{get:function(){return Ne().getBool("DEBUG")},enumerable:!0,configurable:!0}),r.prototype.dispose=function(){var e=this;if(!this.disposed){this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;kt(t,this.debug,(function(){return t.finish()})),kt(t,this.debug,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),kt(t,this.debug,(function(){return t.deleteFramebuffer(e.framebuffer)})),kt(t,this.debug,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),kt(t,this.debug,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),kt(t,this.debug,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}},r.prototype.createFloat32MatrixTexture=function(e,t){return this.throwIfDisposed(),V8(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createFloat16MatrixTexture=function(e,t){return this.throwIfDisposed(),j8(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createUnsignedBytesMatrixTexture=function(e,t){return this.throwIfDisposed(),q8(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.uploadPixelDataToTexture=function(e,t){this.throwIfDisposed(),J8(this.gl,this.debug,e,t)},r.prototype.uploadDenseMatrixToTexture=function(e,t,n,i){this.throwIfDisposed(),K8(this.gl,this.debug,e,t,n,i,this.textureConfig)},r.prototype.createFloat16PackedMatrixTexture=function(e,t){return this.throwIfDisposed(),X8(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.createPackedMatrixTexture=function(e,t){return this.throwIfDisposed(),$8(this.gl,this.debug,e,t,this.textureConfig)},r.prototype.deleteMatrixTexture=function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(KS(this.gl,this.debug,this.framebuffer),this.outputTexture=null),kt(this.gl,this.debug,(function(){return t.gl.deleteTexture(e)}))},r.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,(function(){return eU(i.gl,i.debug,t,n,i.textureConfig)}))},r.prototype.downloadPackedMatrixFromBuffer=function(e,t,n,i,o,a){return tU(this.gl,e,0,0,0,o,a,this.textureConfig)},r.prototype.downloadFloat32MatrixFromBuffer=function(e,t){return Q8(this.gl,e,t)},r.prototype.createBufferFromTexture=function(e,t,n){this.bindTextureToFrameBuffer(e);var i=Z8(this.gl,this.debug,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),i},r.prototype.createAndWaitForFence=function(){var e=this.createFence(this.gl);return this.pollFence(e)},r.prototype.createFence=function(e){var t,n,i=this;if(Ne().getBool("WEBGL_FENCE_API_ENABLED")){var o=e,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var s=o.clientWaitSync(a,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},t=a}else Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return i.isQueryAvailable(t,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}},r.prototype.downloadMatrixFromPackedTexture=function(e,t,n){var i=this;return this.downloadMatrixDriver(e,(function(){return nU(i.gl,i.debug,t,n)}))},r.prototype.createProgram=function(e){this.throwIfDisposed();var t=this.gl,n=hB(t,this.debug,e),i=W8(t,this.debug),o=fB(t,this.debug);return kt(t,this.debug,(function(){return t.attachShader(o,i)})),kt(t,this.debug,(function(){return t.attachShader(o,n)})),pB(t,this.debug,o),this.debug&&Hy(t,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Y8(t,this.debug,this.program,this.vertexBuffer)),o},r.prototype.deleteProgram=function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&kt(this.gl,this.debug,(function(){return t.gl.deleteProgram(e)}))},r.prototype.setProgram=function(e){var t=this;this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&Hy(this.gl,this.debug,this.program),kt(this.gl,this.debug,(function(){return t.gl.useProgram(e)}))},r.prototype.getUniformLocation=function(e,t,n){return n===void 0&&(n=!0),this.throwIfDisposed(),n?_B(this.gl,this.debug,e,t):xB(this.gl,e,t)},r.prototype.getAttributeLocation=function(e,t){var n=this;return this.throwIfDisposed(),kt(this.gl,this.debug,(function(){return n.gl.getAttribLocation(e,t)}))},r.prototype.getUniformLocationNoThrow=function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)},r.prototype.setInputMatrixTexture=function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),SB(this.gl,this.debug,this.program,e,t,n)},r.prototype.setOutputMatrixTexture=function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)},r.prototype.setOutputPackedMatrixTexture=function(e,t,n){this.throwIfDisposed();var i=Td(t,n),o=i[0],a=i[1];this.setOutputMatrixTextureDriver(e,o,a)},r.prototype.setOutputMatrixWriteRegion=function(e,t,n,i){this.setOutputMatrixWriteRegionDriver(n,e,i,t)},r.prototype.setOutputPackedMatrixWriteRegion=function(e,t,n,i){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},r.prototype.debugValidate=function(){this.program!=null&&Hy(this.gl,this.debug,this.program),cp(this.gl)},r.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),kt(e,this.debug,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))},r.prototype.blockUntilAllProgramsCompleted=function(){var e=this;this.throwIfDisposed(),kt(this.gl,this.debug,(function(){return e.gl.finish()}))},r.prototype.getQueryTimerExtension=function(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=lp(this.gl,this.debug,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},r.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},r.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},r.prototype.beginQuery=function(){if(Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var i=this.getQueryTimerExtensionWebGL1(),o=i.createQueryEXT();return i.beginQueryEXT(i.TIME_ELAPSED_EXT,o),o},r.prototype.endQuery=function(){if(Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")!==2){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}},r.prototype.waitForQueryAndGetTime=function(e){return wt(this,void 0,void 0,(function(){var t=this;return _t(this,(function(n){switch(n.label){case 0:return[4,VS((function(){return t.disposed||t.isQueryAvailable(e,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(e,Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},r.prototype.getQueryTime=function(e,t){if(t===0)return null;if(t===2){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var i=this.getQueryTimerExtensionWebGL1();return i.getQueryObjectEXT(e,i.QUERY_RESULT_EXT)/1e6},r.prototype.isQueryAvailable=function(e,t){if(t===0)return!0;if(t===2){var n=this.gl,i=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(i=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT),this.disjoint==null&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint},r.prototype.pollFence=function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))},r.prototype.pollItems=function(){for(var e=(function(n){for(var i=0;i<n.length&&n[i]();++i);return i-1})(this.itemsToPoll.map((function(n){return n.isDoneFn}))),t=0;t<=e;++t)(0,this.itemsToPoll[t].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(e+1)},r.prototype.addItemToPoll=function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||VS((function(){return n.pollItems(),n.itemsToPoll.length===0}))},r.prototype.bindTextureToFrameBuffer=function(e){this.throwIfDisposed(),Gy(this.gl,this.debug,e,this.framebuffer),this.debug&&cp(this.gl)},r.prototype.unbindTextureToFrameBuffer=function(){this.outputTexture!=null?(Gy(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&cp(this.gl)):KS(this.gl,this.debug,this.framebuffer)},r.prototype.downloadMatrixDriver=function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n},r.prototype.setOutputMatrixTextureDriver=function(e,t,n){this.throwIfDisposed();var i=this.gl;Gy(i,this.debug,e,this.framebuffer),this.debug&&cp(i),this.outputTexture=e,kt(i,this.debug,(function(){return i.viewport(0,0,t,n)})),kt(i,this.debug,(function(){return i.scissor(0,0,t,n)}))},r.prototype.setOutputMatrixWriteRegionDriver=function(e,t,n,i){var o=this;this.throwIfDisposed(),kt(this.gl,this.debug,(function(){return o.gl.scissor(e,t,n,i)}))},r.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},r.prototype.throwIfNoProgram=function(){if(this.program==null)throw new Error("No GPU program is currently set.")},r})();function lE(r,e){if(r.length!==e.length)throw Error("Binary was compiled with "+r.length+" inputs, but was executed with "+e.length+" inputs");r.forEach((function(t,n){var i=t.logicalShape,o=e[n],a=o.shape;if(!wr(i,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+i+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var s=t.texShape,u=o.isUniform?null:o.texData.texShape;if(!wr(s,u))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+s+" and "+u+" must match")}}))}var iU=function(r,e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var n=t.filterWidth,i=t.inChannels,o=t.strideWidth,a=t.strideHeight,s=t.padInfo,u=t.outWidth,l=t.dilationWidth,c=t.dilationHeight,h=t.dataFormat,f=s.left,m=s.top,g=i*n,w=Wr(),v=h==="channelsLast",y=v?0:1,x=v?1:2,E="",_=0;_<=1;_++)for(var k=0;k<=1;k++)E+=`
          blockIndex = rc.y + `+k+`;
          pos = rc.x + `+_+`;

          if(blockIndex < `+r[1]+" && pos < "+r[0]+`) {
            offsetY = int(blockIndex / (`+u+")) * "+a+" - "+m+`;
            d0 = offsetY + `+c+" * (pos / "+g+`);

            if(d0 < `+e[y]+` && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), `+u+".) * "+o+". - "+f+`.);
              d1 = offsetX + `+l+" * (int(mod(float(pos), "+g+".) / "+i+`.));

              if(d1 < `+e[x]+` && d1 >= 0) {

                ch = int(mod(float(pos), `+i+`.));

                if (`+v+`) {
                  innerDims = vec2(d1, ch);
                  result[`+(2*_+k)+`] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[`+(2*_+k)+`] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        `+E+`

        `+w.output+` = result;
      }
    `},oU=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[];var o,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -`+a+"; j <= "+a+`; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  `+s+`) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * `+o+`;
        setOutput(val);
      }
    `},aU=function(r,e,t,n,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=r,this.depth=r[3],this.depthRadius=e,this.bias=t,this.alpha=n,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < `+this.depth+`; ++d) {
          int depthBegin = int(max(0.0, float(d - `+e+`)));
          int depthEnd = int(min(float(`+this.depth+`),
              float(d + `+e+` + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = `+this.depth+`;

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(`+n+") * norm + float("+t+`);

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(`+n+`)
                * float(`+i+`)
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * `+i+`);
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `},sU=function(r,e,t,n,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,a=e,s=r[3]-1;this.outputShape=r;var u="float("+t+") + float("+n+") * sum";o=i===.5?"inversesqrt("+u+")":i===1?"1.0/("+u+")":"exp(log("+u+") * float(-"+i+"));",this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < `+this.outputShape[3]+`;
        bool hasNextRow = c < `+this.outputShape[2]+`;

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - `+a+`;
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - `+a+"; j <= "+a+`; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(`+s+`));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * `+o+`;
        setOutput(result);
      }
    `},uU=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideHeight,t=r.strideWidth,n=r.dilationHeight,i=r.effectiveFilterHeight,o=r.effectiveFilterWidth,a=i-1-r.padInfo.top,s=o-1-r.padInfo.left,u=i*o-1;this.userCode=`
      const ivec2 pads = ivec2(`+a+", "+s+`);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < `+i+`;
          wR += `+n+`) {
          float dyR = float(dyRCorner + wR) / `+e+`.0;

          if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < `+o+`; wC++) {
            float dyC = float(dyCCorner + wC) / `+t+`.0;

            if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = `+u+` - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * `+o+` + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `},lU=function(r){this.variableNames=["dy","maxPos"],this.outputShape=r.inShape;var e=r.strideDepth,t=r.strideHeight,n=r.strideWidth,i=r.dilationDepth,o=r.dilationHeight,a=r.dilationWidth,s=r.effectiveFilterDepth,u=r.effectiveFilterHeight,l=r.effectiveFilterWidth,c=s-1-r.padInfo.front,h=u-1-r.padInfo.top,f=l-1-r.padInfo.left,m=s*u*l-1;this.userCode=`
      const ivec3 pads = ivec3(`+c+", "+h+", "+f+`);

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < `+s+`;
           wD += `+i+`) {
          float dyD = float(dyDCorner + wD) / `+e+`.0;

          if (dyD < 0.0 || dyD >= `+r.outDepth+`.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < `+u+`;
              wR += `+o+`) {
            float dyR = float(dyRCorner + wR) / `+t+`.0;

            if (dyR < 0.0 || dyR >= `+r.outHeight+`.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < `+l+`;
                wC += `+a+`) {
              float dyC = float(dyCCorner + wC) / `+n+`.0;

              if (dyC < 0.0 || dyC >= `+r.outWidth+`.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = `+m+` -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * `+u+" * "+l+` +
                  wR * `+l+` + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `},Xy=function(r,e,t,n,i,o,a){t===void 0&&(t=!1),n===void 0&&(n=!1),i===void 0&&(i=!1),o===void 0&&(o=null),a===void 0&&(a=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=t?r[1]:r[2],u=Math.ceil(s/2),l=t?"i * 2, rc.y":"rc.y, i * 2",c=n?"rc.z, i * 2":"i * 2, rc.z",h=t?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=n?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";o&&(m=a?`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          `+o+`
        }`:`vec4 activation(vec4 x) {
          `+o+`
        }`,g="result = activation(result);");var w=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),this.userCode=`
      `+m+`

      const float sharedDimension = `+u+`.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < `+u+`; i++) {
          vec4 a = getMatrixA(rc.x, `+l+`);
          vec4 b = getMatrixB(rc.x, `+c+`);

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (`+h[0]+" * "+f[0]+`);
          result += (`+h[1]+" * "+f[1]+`);
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        `+w+`

        `+g+`

        setOutput(result);
      }
    `},cU=(function(){function r(e,t,n){this.variableNames=["probs"],this.outputShape=[e,n],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < `+(t-1)+`; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(`+(t-1)+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;return function(n,i){t.seedLoc==null&&(t.seedLoc=n.getUniformLocation(i,"seed")),n.gl.uniform1f(t.seedLoc,e)}},r})(),hU=function(r,e,t,n){this.variableNames=["indices"],this.outputShape=[r,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(`+n+"), float("+t+`),
                      float(index == coords.y)));
      }
    `},dU=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=r;var e=r.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{var t=mi("rc",e),n=Fn(e),i=(function(s,u,l){if(s===1)return"rc > "+u[0];for(var c="",h=s-2;h<s;h++)c+=l[h]+" >= "+u[h],h<s-1&&(c+="||");return c})(e,r,t),o=(function(s,u,l,c){if(s===1)return"";var h=c.slice(-2);return`
    int r = `+h[0]+`;
    int c = `+h[1]+`;
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= `+u+`;
    bool rEdge = rp1 >= `+l+`;
  `})(e,r[r.length-1],r[r.length-2],t),a=(function(s,u){var l=s.length,c=(function(h,f){for(var m=[],g=0;g<=1;g++)for(var w=0;w<=1;w++){for(var v=(g===0?"r":"rp1")+", "+(w===0?"c":"cp1"),y=2;y<h;y++)v=f[f.length-1-y]+","+v;m.push(v)}return m})(l,u);return l===1?`getA(rc),
            rc + 1 >= `+s[0]+` ? 0. : getA(rc + 1),
            0, 0`:"getA("+c[0]+`),
          cEdge ? 0. : getA(`+c[1]+`),
          rEdge ? 0. : getA(`+c[2]+`),
          rEdge || cEdge ? 0. : getA(`+c[3]+")"})(r,t);this.userCode=`
        void main() {
          `+n+` rc = getOutputCoords();

          if(`+i+`) {
            setOutput(vec4(0));
          } else {
            `+o+`

            setOutput(vec4(`+a+`));
          }
        }
      `}},fU=function(r,e,t){this.variableNames=["x"],this.outputShape=e.map((function(u,l){return u[0]+r[l]+u[1]}));var n=r.length,i=Fn(n),o=e.map((function(u){return u[0]})).join(","),a=e.map((function(u,l){return u[0]+r[l]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,n);this.userCode=n!==1?`
      `+i+" start = "+i+"("+o+`);
      `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(float(`+t+`));
        } else {
          `+i+` coords = outC - start;
          setOutput(getX(`+s+`));
        }
      }
    `:`
        int start = `+o+`;
        int end = `+a+`;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(float(`+t+`));
          } else {
            setOutput(getX(outC - start));
          }
        }
      `},pU=function(r,e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(v,y){return v[0]+r[y]+v[1]}));for(var n=r.length,i=Fn(n),o=e.map((function(v){return v[0]})).join(","),a=e.map((function(v,y){return v[0]+r[y]})).join(","),s=mi("rc",n),u=mi("source",n),l=s[n-1]+" < "+this.outputShape[n-1],c=n===1?"source":"vec2("+u.slice(-2).join()+")",h=[i+" rc = outputLoc;",s[n-1]+` += 1;
       if(`+l+`) {
      `,n===1?"":`}
       rc = outputLoc;
       `+s[n-2]+` += 1;
       if(`+s[n-2]+" < "+this.outputShape[n-2]+") {",n===1?"":"  "+s[n-1]+` += 1;
         if(`+l+") {"],f=n===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="",g=0,w=n===1?2:4;g<w;g++)m+=`
        `+h[g]+`
        if (`+f+`) {
          result[`+g+"] = float("+t+`);
        } else {
          `+i+` source = rc - start;
          result[`+g+"] = getChannel(getX("+u.join()+"), "+c+`);
        }
      `;m+=n===1?"} ":"}}",this.userCode=`
      const `+i+" start = "+i+"("+o+`);
      const `+i+" end = "+i+"("+a+`);

      void main() {
        `+i+` outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        `+m+`
        setOutput(result);
      }
    `},Yh=function(r,e,t,n,i){if(n===void 0&&(n=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=r.filterWidth,a=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,l=r.dilationWidth,c=r.effectiveFilterHeight,h=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left;this.outputShape=r.outShape;var g=e==="avg",w="((batch  * "+r.inHeight+" + xR) * "+r.inWidth+" + xC) * "+r.inChannels+" + d",v="(xR * "+r.inWidth+" + xC) * "+r.inChannels+" + d",y="0.0";if(g||(y="-1.0 / 1e-20"),t)this.userCode=`
        const ivec2 strides = ivec2(`+a+", "+s+`);
        const ivec2 pads = ivec2(`+f+", "+m+`);

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < `+c+`;
              wR += `+u+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+h+`;
                wC += `+l+`) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= `+r.inWidth+`) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value >= currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = `+(n?i?w:v:"wR * "+h+" + wC")+`;
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var x=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(x="avgValue / count");var E=4*Math.floor(o/4),_=o%4,k=`
      if (`+g+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(`+a+", "+s+`);
      const ivec2 pads = ivec2(`+f+", "+m+`);
      const float initializationValue = `+y+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+y+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < `+c+`;
            wR += `+u+`) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= `+r.inHeight+`) {
            continue;
          }

          for (int wC = 0; wC < `+E+`; wC += 4) {
            int xC = xCCorner + wC * `+l+`;

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              getValue(batch, xR, xC + 3 * `+l+`, d)
            );

            `+k+`
          }

          int xC = xCCorner + `+E+`;
          if (`+(_===1)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(_===2)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              initializationValue,
              initializationValue
            );

            `+k+`
          } else if (`+(_===3)+`) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + `+l+`, d),
              getValue(batch, xR, xC + 2 * `+l+`, d),
              initializationValue
            );

            `+k+`
          }
        }
        setOutput(`+x+`);
      }
    `}},Yy=function(r,e,t,n,i){if(n===void 0&&(n=!1),i===void 0&&(i=!1),this.variableNames=["x"],e==="avg"&&t)throw new Error("Cannot compute positions for average pool.");var o=r.filterWidth,a=r.strideDepth,s=r.strideHeight,u=r.strideWidth,l=r.dilationDepth,c=r.dilationHeight,h=r.dilationWidth,f=r.effectiveFilterDepth,m=r.effectiveFilterHeight,g=r.effectiveFilterWidth,w=r.padInfo.front,v=r.padInfo.top,y=r.padInfo.left;this.outputShape=r.outShape;var x=e==="avg",E="0.0";if(x||(E="-1.0 / 1e-20"),t)this.userCode=`
        const ivec3 strides =
            ivec3(`+a+", "+s+", "+u+`);
        const ivec3 pads = ivec3(`+w+", "+v+", "+y+`);

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < `+f+`;
              wD += `+l+`) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= `+r.inDepth+`) {
              continue;
            }

            for (int wR = 0; wR < `+m+`;
                wR += `+c+`) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= `+r.inHeight+`) {
                continue;
              }

              for (int wC = 0; wC < `+g+`;
                  wC += `+h+`) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= `+r.inWidth+`) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value >= currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = `+(n?i?"(((batch * "+r.inDepth+" + xD) * "+r.inHeight+" + xR) * "+r.inWidth+" + xC) * "+r.inChannels+" + ch":"((xD * "+r.inHeight+" + xR) * "+r.inWidth+" + xC) * "+r.inChannels+" + ch":"wD * "+m+" * "+g+` +
                      wR * `+g+" + wC")+`;
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;else{var _=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="avg"&&(_="avgValue / count");var k=4*Math.floor(o/4),C=o%4,R=`
      if (`+x+`) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = max(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(`+a+", "+s+", "+u+`);
      const ivec3 pads = ivec3(`+w+", "+v+", "+y+`);
      const float initializationValue = `+E+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= `+r.inWidth+`) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(`+E+`);
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < `+f+`;
            wD += `+l+`) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= `+r.inDepth+`) {
            continue;
          }

          for (int wR = 0; wR < `+m+`;
            wR += `+c+`) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= `+r.inHeight+`) {
              continue;
            }

            for (int wC = 0; wC < `+k+`; wC += 4) {
              int xC = xCCorner + wC * `+h+`;

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                getValue(batch, xD, xR, xC + 3 * `+h+`, ch)
              );

              `+R+`
            }

            int xC = xCCorner + `+k+`;
            if (`+(C===1)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              `+R+`
            } else if (`+(C===2)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                initializationValue,
                initializationValue
              );

              `+R+`
            } else if (`+(C===3)+`) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + `+h+`, ch),
                getValue(batch, xD, xR, xC + 2 * `+h+`, ch),
                initializationValue
              );

              `+R+`
            }
          }
          setOutput(`+_+`);
        }
      }
    `}},mU=function(r,e){this.variableNames=["x"];var t=r.windowSize,n=r.batchSize,i=r.inSize,o=Math.ceil(i/t);this.outputShape=[n,o];var a="0.0",s="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",s="min"):e==="max"&&(a="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";e==="sum"?u="sumValue":e==="prod"?u="prodValue":e==="all"?u="allValue":e==="any"&&(u="anyValue");var l=4*Math.floor(t/4),c=t%4,h=`
      if (`+(e==="sum")+`) {
        sumValue += dot(values, ones);
      } else if (`+(e==="prod")+`) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = `+s+`(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",h=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",h=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");var m="";i%t>0&&(m=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = `+a+`;
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        `+m+`
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * `+t+`;

        vec4 minMaxValue = vec4(`+a+`);
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < `+l+`; i += 4) {
          int inIdx = inOffset + i;
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          `+h+`
        }

        int inIdx = inOffset + `+l+`;
        if (`+(c===1)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===2)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          `+h+`
        } else if (`+(c===3)+`) {
          `+f+" values = "+f+`(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          `+h+`
        }
        setOutput(`+u+`);
      }
    `},gU=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;for(var t="",n=0;n<4;n++){var i="thisRC = rc;";n%2==1&&(i+="thisRC.z += 1;"),n>1&&(i+="thisRC.y += 1;"),t+=`
        `+i+`
        `+(n>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+`
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[`+n+`] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        `+(n>0?"}":"")+`
      `}this.userCode=`
      
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      `+$u(["r","c","d"],e)+`
      return ivec3(r, c, d);
    }
  
      `+qw(r)+`

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = `+r[1]+`;
        int cols = `+r[2]+`;

        `+t+`

        setOutput(result);
      }
    `},vU=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), `+(i-1)+`.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), `+(o-1)+`.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},yU=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],l=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `},bU=function(r,e,t,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],l=[n&&e>1?e-1:e,n&&t>1?t-1:t];this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`,
          `+u[1]/l[1]+`);
      const vec3 inputShapeRC = vec3(`+o+".0, "+a+`.0,
                                     `+a+`.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < `+(s-1)+`;
        bool hasNextRow = coords.z < `+(t-1)+`;

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `},wU=function(r,e,t){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var n=e.shape,i=n[1],o=n[2],a=r.shape,s=a[1],u=a[2],l=[t&&s>1?i-1:i,t&&u>1?o-1:o],c=[t&&s>1?s-1:s,t&&u>1?u-1:u],h=l[0]/c[0],f=l[1]/c[1],m=1/h,g=1/f,w=2*Math.ceil(m)+2,v=2*Math.ceil(g)+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(`+h+`);
        const float widthScale = float(`+f+`);

        const float invHeightScale = float(`+m+`);
        const float invWidthScale = float(`+g+`);

        const int winHeight = int(`+w+`);
        const int winWidth = int(`+v+`);

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= `+s+`) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= `+u+`) {
              continue;
            }

            float sourceFracRow =
              float(`+l[0]+`) *
                (float(dyR) / float(`+c[0]+`));

            float sourceFracCol =
                float(`+l[1]+`) *
                  (float(dyC) / float(`+c[1]+`));

            int sourceNearestRow = int(min(
                float(int(`+i+`) - 1),
                `+t+` ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(`+o+`) - 1),
                `+t+` ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `},_U=function(r,e,t,n){this.variableNames=["A"],this.outputShape=[];var i=r[0],o=r[1],a=r[2],s=r[3];this.outputShape=[i,e,t,s];var u=[n&&e>1?o-1:o,n&&t>1?a-1:a],l=[n&&e>1?e-1:e,n&&t>1?t-1:t],c=n?"0.5":"0.0";this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          `+u[0]/l[0]+`,
          `+u[1]/l[1]+`);
      const vec2 inputShapeRC = vec2(`+o+".0, "+a+`.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + `+c+`)));

        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `},xU=function(r,e){this.variableNames=["x"];var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");if(this.outputShape=r,t!==1){var n=r.map((function(o,a){return(function(s){return e.indexOf(s)!==-1&&r[s]!==1?r[s]+" - coords["+s+"] - 1":"coords["+s+"]"})(a)})).join(","),i=Fn(t);this.userCode=`
      void main() {
        `+i+` coords = getOutputCoords();
        setOutput(getX(`+n+`));
      }
    `}else this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(`+r[0]+` - coord - 1));
        }
      `},SU=function(r,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var t=r.length;if(t>4)throw new Error("WebGL backend: Reverse of rank-"+t+" tensor is not yet supported");this.outputShape=r;var n=mi("rc",t),i=n[t-1]+" + 1 < "+this.outputShape[t-1],o=n[t-2]+" + 1 < "+this.outputShape[t-2],a=Fn(t);function s(u){var l=r.map((function(c,h){return(function(f,m){return e.indexOf(f)!==-1&&r[f]!==1?r[f]+" - "+m[f]+" - 1":""+m[f]})(h,u)}));return"getChannel(getX("+l.join(",")+"), vec2("+l.slice(-2).join(",")+"))"}this.userCode=t===1?`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(`+r[0]+` - rc - 1),
            `+r[0]+` - rc - 1);
          if(`+i+`){
              result.g = getChannel(getX(`+r[0]+` - (rc  + 1) - 1),
                `+r[0]+` - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:`
        void main() {
          `+a+` rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = `+(function(u){return s(u)})(n.slice())+`;
          if(`+i+`){
            result.g = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",s(u)})(n.slice())+`;
          }
          if(`+o+`) {
            result.b = `+(function(u){return u[t-2]="("+u[t-2]+" + 1)",s(u)})(n.slice())+`;
            if(`+i+`) {
              result.a = `+(function(u){return u[t-1]="("+u[t-1]+" + 1)",u[t-2]="("+u[t-2]+" + 1)",s(u)})(n.slice())+`;
            }
          }
          setOutput(result);
        }
    `},cE=function(r,e,t,n,i,o,a){this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=Fn(i.length),u=Fn(o.length),l="";t===1?l="i":t===2&&(l="i, j");var c="getIndices("+l+")",h="";n===1?h="i":n===2&&(h="i, coords[1]");var f="getUpdates("+h+")",m=e>1?"strides[j]":"strides";this.userCode=`
        `+s+" strides = "+s+"("+i+`);

        void main() {
          `+u+` coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < `+r+`; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < `+e+`; j++) {
              int index = round(`+c+`);
              flattenedIndex += index * `+m+`;
            }
            if (flattenedIndex == coords[0]) {
              sum += `+f+`;
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `},EU=function(r,e){this.variableNames=["x","segmentIds"];var t=r.windowSize,n=r.batchSize,i=r.inSize,o=r.numSegments,a=o*Math.ceil(i/t);this.outputShape=[n,a];var s=4*Math.floor(t/4),u=t%4,l=`
        sumValue += dot(values, segFilter);
    `,c="";i%t>0&&(c=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return initializationValue;
        }
      `);var h="";i%t>0&&(h=`
        if (inIdx < 0 || inIdx >= `+i+`) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = 0.0;

      float getValue(int batch, int inIdx) {
        `+c+`
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        `+h+`
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          `+o+")) * float("+t+`));
        int currentSeg = int(mod(float(outIdx), float(`+o+`)));

        float sumValue = 0.0;

        for (int i = 0; i < `+s+`; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          `+l+`
        }

        int inIdx = inOffset + `+s+`;
        if (`+(u===1)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          `+l+`
        } else if (`+(u===2)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          `+l+`
        } else if (`+(u===3)+`) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          `+l+`
        }
        setOutput(sumValue);
      }
    `},kU=function(r,e,t){var n,i;if(this.variableNames=["c","a","b"],this.outputShape=e,t>4)throw Error("Where for rank "+t+" is not yet supported");if(t===1)i="resRC",n="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],a=[],s=[],u=0;u<e.length;u++)s.push(""+o[u]),u<r&&a.push(""+o[u]);n=a.join(),i=s.join()}var l=Fn(t);this.userCode=`
      void main() {
        `+l+` resRC = getOutputCoords();
        float cVal = getC(`+n+`);
        if (cVal >= 1.0) {
          setOutput(getA(`+i+`));
        } else {
          setOutput(getB(`+i+`));
        }
      }
    `},CU=(function(){function r(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;var t,n=Fn(this.rank),i="uniform int start["+this.rank+"];",o=(function(a){if(a===1)return"sourceLoc";if(a<=6)return Ky.slice(0,a).map((function(s){return"sourceLoc."+s})).join(",");throw Error("Slicing for rank "+a+" is not yet supported")})(this.rank);t=`
        `+n+` sourceLoc;
        `+n+` coords = getOutputCoords();
        `+e.map((function(a,s){return"sourceLoc."+Ky[s]+" = start["+s+"] + coords."+Ky[s]+";"})).join(`
`)+`
      `,this.userCode=`
      `+i+`
      void main() {
        `+t+`
        setOutput(getSource(`+o+`));
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r})(),Ky=["x","y","z","w","u","v"],TU=(function(){function r(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length;var t=Fn(this.rank),n=mi("coords",this.rank),i=mi("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":"vec2("+i.slice(-2).join()+")",a="getChannel(getSource("+i.join()+"), "+o+")",s=`
      result.x = `+a+`;
      if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
        ++`+i[this.rank-1]+`;
        result.y = `+a+`;
        --`+i[this.rank-1]+`;
      }
    `,u=this.rank===1?"":`
      --`+n[this.rank-1]+`;
      if (++`+n[this.rank-2]+" < "+e[this.rank-2]+`) {
        ++`+i[this.rank-2]+`;
        result.z = `+a+`;
        if (++`+n[this.rank-1]+" < "+e[this.rank-1]+`) {
          ++`+i[this.rank-1]+`;
          result.w = `+a+`;
        }
      }
    `,l=this.rank<=4?`sourceLoc = coords +
            `+t+"("+e.map((function(c,h){return"start["+h+"]"})).join()+");":e.map((function(c,h){return i[h]+" = "+n[h]+" + start["+h+"];"})).join(`
`);this.userCode=`
      uniform int start[`+this.rank+`];
      void main() {
        `+t+` coords = getOutputCoords();
        `+t+` sourceLoc;
        `+l+`
        vec4 result = vec4(0.);
        `+s+`
        `+u+`
        setOutput(result);
      }
    `}return r.prototype.getCustomSetupFunc=function(e){var t=this;if(e.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+e.length+")");return function(n,i){t.startLoc==null&&(t.startLoc=n.getUniformLocationNoThrow(i,"start"),t.startLoc==null)||n.gl.uniform1iv(t.startLoc,e)}},r})(),MU=function(r,e,t){this.variableNames=["x"],this.outputShape=t;var n=t.length,i=Fn(t.length),o=Fn(t.length),a="";if(n===1)a="coords * strides + begin";else{var s=0;a=t.map((function(u,l){return s++,t.length===1?"coords * strides["+l+"] + begin["+l+"]":"coords["+(s-1)+"] * strides["+l+"] + begin["+l+"]"})).join(",")}this.userCode=`
      `+i+" begin = "+i+"("+r+`);
      `+i+" strides = "+i+"("+e+`);

      void main() {
        `+o+` coords = getOutputCoords();
        setOutput(getX(`+a+`));
      }
    `},AU=(function(){function r(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return r.prototype.acquireTexture=function(e,t,n){var i,o=hE(t,n),a=dE(e,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return this.numUsedTextures++,this.log(),o===Fi.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===Fi.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===Fi.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===Fi.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===Fi.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),i},r.prototype.releaseTexture=function(e,t,n,i){if(this.freeTextures!=null){var o=dE(t,hE(n,i),i);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(e),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],s=a.indexOf(e);if(s<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(s,1),this.log()}},r.prototype.log=function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+e+")")}},r.prototype.getNumUsedTextures=function(){return this.numUsedTextures},r.prototype.getNumFreeTextures=function(){return this.numFreeTextures},r.prototype.dispose=function(){var e=this;if(this.freeTextures!=null){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(n){e.gpgpu.deleteMatrixTexture(n)}));for(var t in this.usedTextures)this.usedTextures[t].forEach((function(i){e.gpgpu.deleteMatrixTexture(i)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},r})();function hE(r,e){if(r===Li.UPLOAD)return Fi.PACKED_2X2_FLOAT32;if(r===Li.RENDER||r==null)return(function(t){return Ne().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?Fi.PACKED_2X2_FLOAT32:Fi.UNPACKED_FLOAT32:t?Fi.PACKED_2X2_FLOAT16:Fi.UNPACKED_FLOAT16})(e);if(r===Li.DOWNLOAD||r===Li.PIXELS)return Fi.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+r)}function dE(r,e,t){return r[0]+"_"+r[1]+"_"+e+"_"+t}var RU=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[n]*e[n];this.outputShape=t,this.rank=t.length;var i=Fn(this.rank),o=(function(a){var s=a.length;if(s>5)throw Error("Tile for rank "+s+" is not yet supported");if(s===1)return"imod(resRC, "+a[0]+")";for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],l=[],c=0;c<a.length;c++)l.push("imod("+u[c]+", "+a[c]+")");return l.join()})(r);this.userCode=`
      void main() {
        `+i+` resRC = getOutputCoords();
        setOutput(getA(`+o+`));
      }
    `},$w=1.7580993408473768,Xw=1.0507009873554805,Kt=function(r,e){this.variableNames=["A"],this.outputShape=r,this.userCode=`
      float unaryOperation(float x) {
        `+e+`
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `},Ho="if (isnan(x)) return x;",IU="return x;",fE="return abs(x);",X3=Ho+`
  return (x < 0.0) ? 0.0 : x;
`,Y3=Ho+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,K3="return (x >= 0.0) ? x : (exp(x) - 1.0);",DU=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = `+$w+`;
  float scale = `+Xw+`;
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,pE="return -x;",mE="return ceil(x);",gE="return floor(x);",vE="return exp(x);",yE="return exp(x) - 1.0;",NU=Ho+`
  return sin(x);
`,PU=Ho+`
  return cos(x);
`,FU=Ho+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,OU=Ho+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,LU=Ho+`
  return atan(x);
`,BU=Ho+"return log(x + sqrt(x * x + 1.0));",UU=Ho+`
  if (x < 1.0) return NAN;
  return log(x + sqrt(x * x - 1.0));`,zU=Ho+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
  return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,pp="return x;",WU="return x;",J3=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Z3=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Q3=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,zh=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        `+e+`
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `},HU=function(r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=r;var e=r.length,t=mi("rc",e),n=Fn(e),i=(function(s,u){if(s===1)return"rc";for(var l="",c=0;c<s;c++)l+=u[c],c<s-1&&(l+=",");return l})(e,t),o=t.slice(-2),a=e<=1?"rc":"vec2("+o.join(",")+")";this.userCode=`
      void main() {
        `+n+` rc = getOutputCoords();
        vec4 packedInput = getA(`+i+`);

        setOutput(getChannel(packedInput, `+a+`));
      }
    `},mp={};function gp(r,e){if(e===void 0&&(e=!1),r==="linear")return e?WU:IU;if(r==="relu")return e?J3:X3;if(r==="elu")return e?Q3:K3;if(r==="relu6")return e?Z3:Y3;if(r==="prelu")return e?$3:q3;throw new Error("Activation "+r+" has not been implemented for the WebGL backend.")}var GU=600,VU=(function(r){function e(t){var n,i=r.call(this)||this;if(i.pendingRead=new WeakMap,i.pendingDisposal=new WeakSet,i.dataRefCount=new WeakMap,i.numBytesInGPU=0,i.uploadWaitMs=0,i.downloadWaitMs=0,i.warnedAboutMemory=!1,i.pendingDeletes=0,i.disposed=!1,!Ne().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(t==null){var o=ba(Ne().getNumber("WEBGL_VERSION"));i.binaryCache=((n=Ne().getNumber("WEBGL_VERSION"))in mp||(mp[n]={}),mp[n]),i.gpgpu=new rU(o),i.canvas=o.canvas,i.gpgpuCreatedLocally=!0}else i.gpgpu=t,i.binaryCache={},i.gpgpuCreatedLocally=!1,i.canvas=t.gl.canvas;return i.textureManager=new AU(i.gpgpu),i.numMBBeforeWarning=Ne().global.screen==null?1024:Ne().global.screen.height*Ne().global.screen.width*window.devicePixelRatio*GU/1024/1024,i.texData=new P3(i,le),i}return Wo(e,r),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,n,i){if(Ne().getBool("DEBUG")&&this.checkNumericalProblems(t),i==="complex64"&&t!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var o={};return this.texData.set(o,{shape:n,dtype:i,values:t,usage:Li.UPLOAD}),o},e.prototype.move=function(t,n,i,o){if(Ne().getBool("DEBUG")&&this.checkNumericalProblems(n),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:i,dtype:o,values:n,usage:Li.UPLOAD})},e.prototype.readSync=function(t){var n=this.texData.get(t),i=n.values,o=n.dtype,a=n.complexTensors,s=n.slice,u=n.shape,l=n.isPacked;if(s!=null){var c=void 0;c=l?new zh(u,pp):new Kt(u,pp);var h=this.runWebGLProgram(c,[{dataId:t,shape:u,dtype:o}],o),f=this.readSync(h.dataId);return this.disposeData(h.dataId),f}if(i!=null)return this.convertAndCacheOnCPU(t);if(o==="string")return i;var m,g,w=this.activeTimers!=null;return w&&(m=na()),o==="complex64"?g=vb(a.real.dataSync(),a.imag.dataSync()):g=this.getValuesFromTexture(t),w&&(this.downloadWaitMs+=na()-m),this.convertAndCacheOnCPU(t,g)},e.prototype.read=function(t){return wt(this,void 0,void 0,(function(){var n,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,R,I;return _t(this,(function(T){switch(T.label){case 0:if(this.pendingRead.has(t))return n=this.pendingRead.get(t),[2,new Promise((function(A){return n.push(A)}))];if(i=this.texData.get(t),o=i.values,a=i.shape,s=i.slice,u=i.dtype,l=i.complexTensors,c=i.isPacked,s!=null)return h=void 0,h=c?new zh(a,pp):new Kt(a,pp),f=this.runWebGLProgram(h,[{dataId:t,shape:a,dtype:u}],u),m=this.read(f.dataId),this.disposeData(f.dataId),[2,m];if(o!=null)return[2,this.convertAndCacheOnCPU(t)];if(!Ne().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&Ne().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return g=null,u!=="complex64"&&Ne().get("WEBGL_BUFFER_SUPPORTED")&&(w=this.decode(t),v=this.texData.get(w.dataId),g=(I=this.gpgpu).createBufferFromTexture.apply(I,[v.texture].concat($h(a)))),this.pendingRead.set(t,[]),u==="complex64"?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:T.sent(),T.label=2;case 2:return u!=="complex64"?[3,4]:[4,Promise.all([l.real.data(),l.imag.data()])];case 3:return x=T.sent(),E=x[0],_=x[1],y=vb(E,_),[3,5];case 4:g==null?y=this.getValuesFromTexture(t):(k=bt(a),y=this.gpgpu.downloadFloat32MatrixFromBuffer(g,k)),T.label=5;case 5:return w!=null&&this.disposeData(w.dataId),C=this.convertAndCacheOnCPU(t,y),R=this.pendingRead.get(t),this.pendingRead.delete(t),R.forEach((function(A){return A(C)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,C]}}))}))},e.prototype.checkNumericalProblems=function(t){if(t!=null)for(var n=0;n<t.length;n++){var i=t[n];if(!uB(i))throw Ne().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error("The value "+i+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'"):Error("The value "+i+" cannot be represented on this device.")}},e.prototype.getValuesFromTexture=function(t){var n,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.isPacked,u=bt(o);if(Ne().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var l=this.decode(t),c=this.texData.get(l.dataId),h=(n=this.gpgpu).downloadMatrixFromPackedTexture.apply(n,[c.texture].concat($h(o))).subarray(0,u);return this.disposeData(l.dataId),h}var f=Ne().getBool("WEBGL_PACK")&&s===!0,m=f?Vy(o):o,g=f?new N8(m):new D8(m),w=this.runWebGLProgram(g,[{shape:m,dtype:a,dataId:t}],"float32"),v=this.texData.get(w.dataId),y=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(v.texture,v.texShape[0],v.texShape[1]).subarray(0,u);return this.disposeData(w.dataId),y},e.prototype.time=function(t){return wt(this,void 0,void 0,(function(){var n,i,o,a,s,u,l;return _t(this,(function(c){switch(c.label){case 0:return n=this.activeTimers,i=[],o=!1,this.programTimersStack==null?(this.programTimersStack=i,o=!0):this.activeTimers.push(i),this.activeTimers=i,t(),a=Oc(this.activeTimers.map((function(h){return h.query}))).filter((function(h){return h!=null})),s=Oc(this.activeTimers.map((function(h){return h.name}))).filter((function(h){return h!=null})),this.activeTimers=n,o&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return l=c.sent(),u.kernelMs=GL(l),u.getExtraProfileInfo=function(){return l.map((function(h,f){return{name:s[f],ms:h}})).map((function(h){return h.name+": "+h.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:na(),endMs:null}},e.prototype.endTimer=function(t){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=na(),t)},e.prototype.getQueryTime=function(t){return wt(this,void 0,void 0,(function(){var n;return _t(this,(function(i){return Ne().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(n=t).endMs-n.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var n=this.texData.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var n=this.texData.get(t),i=n.texture,o=n.dtype,a=n.texShape,s=n.usage,u=n.isPacked,l=n.slice,c=l&&l.origDataId||t,h=this.dataRefCount.get(c);h>1?this.dataRefCount.set(c,h-1):(this.dataRefCount.delete(c),i!=null&&(this.numBytesInGPU-=this.computeBytes(a,o),this.textureManager.releaseTexture(i,a,s,u)));var f=this.texData.get(t);f.texture=null,f.texShape=null,f.isPacked=!1,f.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return Ne().getBool("WEBGL_CPU_FORWARD")?(this.cpuBackend==null&&(this.cpuBackend=le.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,n){var i=this;return n===void 0&&(n=128),this.getCPUBackend()!=null&&t.every((function(o){return i.texData.get(o.dataId).texture==null&&bt(o.shape)<n}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,n){var i=this.makeOutput(t.shape,"complex64");return this.texData.get(i.dataId).complexTensors={real:le.keep(t.clone()),imag:le.keep(n.clone())},i},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,n,i);if(bt(i)===0)return Cr([],i,t.dtype);var o=this.texData.get(t.dataId).isPacked,a=D3(t.shape,n,i);if(o||!a){var s=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new TU(i):new CU(i),u=s.getCustomSetupFunc(n);return this.compileAndRun(s,[t],null,u)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,n,i)},e.prototype.shallowSlice=function(t,n,i){var o=this.texData.get(t.dataId),a=this.makeOutput(i,t.dtype),s=this.texData.get(a.dataId);Object.assign(s,o),s.shape=i,s.dtype=t.dtype;var u=N3(n,t.strides);o.slice&&(u+=o.slice.flatOffset),s.slice={flatOffset:u,origDataId:o.slice&&o.slice.origDataId||t.dataId};var l=this.dataRefCount.get(s.slice.origDataId)||1;return this.dataRefCount.set(s.slice.origDataId,l+1),a},e.prototype.stridedSlice=function(t,n,i,o){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,n,i,o);var a=Ww(n,i,o);if(a.some((function(u){return u===0})))return Cr([],a);var s=new MU(n,o,a);return this.compileAndRun(s,[t])},e.prototype.reverse=function(t,n){var i=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new SU(t.shape,n):new xU(t.shape,n);return this.compileAndRun(i,[t])},e.prototype.concat=function(t,n){if(t[0].dtype==="complex64"){var i=t.map((function(m){return no(m)})),o=t.map((function(m){return aa(m)}));return Er(this.concat(i,n),this.concat(o,n))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,n);if(t.length===1)return t[0];if(t.length>Ne().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var a=Math.floor(t.length/2),s=this.concat(t.slice(0,a),n),u=this.concat(t.slice(a),n);return this.concat([s,u],n)}if(Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var l=new y8(t.map((function(m){return m.shape})),n);return this.compileAndRun(l,t)}var c=Uc(t.map((function(m){return m.shape})),n),h=t.map((function(m){return m.as2D(-1,bt(m.shape.slice(n)))})),f=new v8(h.map((function(m){return m.shape})));return this.compileAndRun(f,h).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,pE,t.dtype);var n=new Kt(t.shape,pE);return this.compileAndRun(n,[t])},e.prototype.batchMatMul=function(t,n,i,o){var a=i?t.shape[2]:t.shape[1],s=o?n.shape[1]:n.shape[2],u=i?t.shape[1]:t.shape[2],l=t.shape[0];if((a===1||s===1)&&u>1e3){i&&(t=Mo(t,[0,2,1])),o&&(n=Mo(n,[0,2,1]));var c=s===1?t:t.as3D(l,u,1),h=s===1?2:1,f=s===1?n.as3D(l,1,u):n;return this.multiply(c,f).sum(h,!0)}var m=kr(t.dtype,n.dtype),g=new Xy(t.shape,[l,a,s],i,o);return this.compileAndRun(g,[t,n],m)},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=o?n.shape[2]:n.shape[1],h=a?i.shape[1]:i.shape[2],f=n.shape[0],m=kr(n.dtype,i.dtype),g=s!=null,w=l!=null,v=u?gp(u,!0):null,y=new Xy(n.shape,[f,c,h],o,a,g,v,w),x=[n,i];return s&&x.push(s),l&&x.push(l),this.compileAndRun(y,x,m)},e.prototype.multiply=function(t,n){if(t.dtype==="complex64"){var i=this.texData.get(t.dataId),o=this.texData.get(n.dataId),a=new nE(c8,t.shape,n.shape),s=new nE(h8,t.shape,n.shape),u=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag),this.makeComplexComponentTensorInfo(n,o.complexTensors.real),this.makeComplexComponentTensorInfo(n,o.complexTensors.imag)],l=this.compileAndRun(a,u),c=this.compileAndRun(s,u),h=this.complex(l,c);return l.dispose(),c.dispose(),h}if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.multiply(t,n);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,rE,t.dtype);var f=new qn(rE,t.shape,n.shape);return this.compileAndRun(f,[t,n],t.dtype)},e.prototype.batchNormalization=function(t,n,i,o,a,s){var u=[t,n,i],l=null;s!=null&&(l=s.shape,u.push(s));var c=null;if(a!=null&&(c=a.shape,u.push(a)),Ne().getBool("WEBGL_PACK_NORMALIZATION")){var h=new l8(t.shape,n.shape,i.shape,l,c,o);return this.compileAndRun(h,u)}var f=new u8(t.shape,n.shape,i.shape,l,c,o);return this.compileAndRun(f,u)},e.prototype.localResponseNormalization4D=function(t,n,i,o,a){var s=Ne().getBool("WEBGL_PACK_NORMALIZATION")?new sU(t.shape,n,i,o,a):new oU(t.shape,n,i,o,a);return this.compileAndRun(s,[t])},e.prototype.LRNGrad=function(t,n,i,o,a,s,u){var l=new aU(n.shape,o,a,s,u);return this.compileAndRun(l,[n,i,t])},e.prototype.tile=function(t,n){if(t.dtype==="string"){var i=this.readSync(t.dataId).map((function(a){return Em(a)}));return W3(Xt(t.shape,t.dtype,i),n)}var o=new RU(t.shape,n);return this.compileAndRun(o,[t])},e.prototype.pad=function(t,n,i){var o=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pU(t.shape,n,i):new fU(t.shape,n,i);return this.compileAndRun(o,[t])},e.prototype.gather=function(t,n,i){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.gather(t,n,i);var o=new U8(t.shape,n.size,i);return this.compileAndRun(o,[t,n])},e.prototype.batchToSpaceND=function(t,n,i){K(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var o=n.reduce((function(h,f){return h*f})),a=Rm(t.shape,n,o),s=Im(a.length,n.length),u=Dm(t.shape,n,o),l=b3(i,n.length),c=w3(u,i,n.length);return Mo(t.reshape(a),s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,n,i){K(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var o=n.reduce((function(f,m){return f*m})),a=[[0,0]];a.push.apply(a,i);for(var s=1+n.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=Rm(u.shape,n,o,!1),c=Im(l.length,n.length,!1),h=Dm(u.shape,n,o,!1);return Mo(u.reshape(l),c).reshape(h)},e.prototype.reduce=function(t,n,i){var o=t.shape[0],a=t.shape[1],s=jy(a),u=new mU({windowSize:s,inSize:a,batchSize:o},n),l=this.compileAndRun(u,[t],i);return l.shape[1]===1?l:this.reduce(l,n,i)},e.prototype.argReduce=function(t,n,i){i===void 0&&(i=null);var o=t.shape[0],a=t.shape[1];i!=null&&(o=i.shape[0],a=i.shape[1]);var s=jy(a),u=new Q6({windowSize:s,inSize:a,batchSize:o},n,i==null),l=[t];i!=null&&l.push(i);var c=this.compileAndRun(u,l,"int32");return c.shape[1]===1?c:this.argReduce(t,n,c)},e.prototype.argReducePacked=function(t,n,i){i===void 0&&(i=null);var o=i!=null?i.shape:t.shape,a=jy(o[o.length-1]),s=new o8(o,a,n,i==null),u=i==null?[t]:[t,i],l=this.compileAndRun(s,u,"int32");return l.rank===t.rank?this.argReducePacked(t,n,l):l},e.prototype.sum=function(t,n){Di("sum",n,t.rank);var i=Br(t.shape,n),o=i[0],a=bt(i[1]),s=t.as2D(-1,a),u=Ly(t.dtype);return this.reduce(s,"sum",u).reshape(o)},e.prototype.prod=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,n);var i=Br(t.shape,n),o=i[0],a=bt(i[1]),s=t.as2D(-1,a),u=Ly(t.dtype);return this.reduce(s,"prod",u).reshape(o)},e.prototype.unsortedSegmentSum=function(t,n,i){var o=0,a=wa([o],t.rank),s=t;a!=null&&(s=Mo(t,a),o=_a(1,t.rank)[0]);var u=(function(m,g,w){for(var v=[],y=m.length,x=0;x<y;x++)x!==g?v.push(m[x]):v.push(w);return v})(s.shape,o,i),l=bt([s.shape[o]]),c=s.as2D(-1,l),h=Ly(t.dtype),f=this.segOpCompute(c,"unsortedSegmentSum",n,h,i).reshape(u);return a!=null&&(f=Mo(f,Lw(a))),f},e.prototype.segOpCompute=function(t,n,i,o,a){var s=t.shape[0],u=t.shape[1],l=(function(f,m){var g,w=!1;for(f<=I3?(g=f,w=!0):g=ub(f,Math.floor(Math.sqrt(f)));!w;)g>m||g===f?w=!0:g=ub(f,g+1);return g})(u,a),c=new EU({windowSize:l,inSize:u,batchSize:s,numSegments:a}),h=this.compileAndRun(c,[t,i],o);return h.shape[1]===a?h:(i=Am(0,a).tile([u/l]),this.segOpCompute(h,n,i,o,a))},e.prototype.argMinMaxReduce=function(t,n,i){var o=[n];if(Di("arg"+i.charAt(0).toUpperCase()+i.slice(1),o,t.rank),!Ne().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var a=Br(t.shape,o),s=a[0],u=bt(a[1]),l=t.as2D(-1,u);return this.argReduce(l,i).reshape(s)}return this.argReducePacked(t,i)},e.prototype.argMin=function(t,n){return this.argMinMaxReduce(t,n,"min")},e.prototype.argMax=function(t,n){return this.argMinMaxReduce(t,n,"max")},e.prototype.cumsum=function(t,n,i,o){if(n!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+n);var a=new T8(t.shape,i,o);return this.compileAndRun(a,[t])},e.prototype.equal=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(equal(a, b));
`,"bool");var i=new qn("return float(a == b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.notEqual=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(notEqual(a, b));
`,"bool");var i=new qn("return float(a != b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.less=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.less(t,n);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThan(a, b));
`,"bool");var i=new qn("return float(a < b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.lessEqual=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(lessThanEqual(a, b));
`,"bool");var i=new qn("return float(a <= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greater=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.greater(t,n);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThan(a, b));
`,"bool");var i=new qn("return float(a > b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.greaterEqual=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(greaterThanEqual(a, b));
`,"bool");var i=new qn("return float(a >= b);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalNot=function(t){var n=new Kt(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(n,[t])},e.prototype.logicalAnd=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,"bool");var i=new qn("return float(a >= 1.0 && b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.logicalOr=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,"bool");var i=new qn("return float(a >= 1.0 || b >= 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n],"bool")},e.prototype.select=function(t,n,i){var o=new kU(t.rank,n.shape,n.rank);return this.compileAndRun(o,[t,n,i],kr(n.dtype,i.dtype))},e.prototype.where=function(t){Tm("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var n=t.dataSync();return jw(t.shape,n)},e.prototype.topk=function(t,n,i){return H3(t.dataSync(),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Di("min",n,t.rank);var i=Br(t.shape,n),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"min",s.dtype).reshape(o)},e.prototype.minimum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.minimum(t,n);var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo(`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new qn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return min(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.mod=function(t,n){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo(`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new qn(`if (b == 0.0) return NAN;
  return mod(a, b);`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.max=function(t,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,n);Di("max",n,t.rank);var i=Br(t.shape,n),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"max",s.dtype).reshape(o)},e.prototype.maximum=function(t,n){if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.maximum(t,n);var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo(`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new qn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return max(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.all=function(t,n){Di("all",n,t.rank);var i=Br(t.shape,n),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"all",s.dtype).reshape(o)},e.prototype.any=function(t,n){Di("any",n,t.rank);var i=Br(t.shape,n),o=i[0],a=bt(i[1]),s=t.as2D(-1,a);return this.reduce(s,"any",s.dtype).reshape(o)},e.prototype.floorDiv=function(t,n){if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,"int32");var i=new qn(`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,t.shape,n.shape);return this.compileAndRun(i,[t,n],"int32")},e.prototype.add=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,qy);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.add(t,n);var i=kr(t.dtype,n.dtype);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,qy,i);var o=new qn(qy,t.shape,n.shape);return this.compileAndRun(o,[t,n],i)},e.prototype.packedUnaryOp=function(t,n,i){var o=new zh(t.shape,n);return this.compileAndRun(o,[t],i)},e.prototype.packedBinaryOp=function(t,n,i,o,a){a===void 0&&(a=!1);var s=new Qo(i,t.shape,n.shape,a);return this.compileAndRun(s,[t,n],o)},e.prototype.complexSeparableBinaryOp=function(t,n,i){var o=this,a=this.texData.get(t.dataId),s=this.texData.get(n.dataId),u=[[a.complexTensors.real,s.complexTensors.real],[a.complexTensors.imag,s.complexTensors.imag]].map((function(f){var m=f[0],g=f[1],w=o.makeComplexComponentTensorInfo(t,m),v=o.makeComplexComponentTensorInfo(n,g),y=new qn(i,t.shape,n.shape);return o.compileAndRun(y,[w,v],kr(m.dtype,g.dtype))})),l=u[0],c=u[1],h=this.complex(l,c);return l.dispose(),c.dispose(),h},e.prototype.makeComplexComponentTensorInfo=function(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}},e.prototype.addN=function(t){if(t.length===1)return t[0];if(t.length>Ne().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var n=Math.floor(t.length/2),i=this.addN(t.slice(0,n)),o=this.addN(t.slice(n));return this.addN([i,o])}var a=t.map((function(l){return l.dtype})).reduce((function(l,c){return kr(l,c)})),s=t.map((function(l){return l.shape})),u=Ne().getBool("WEBGL_PACK")?new Z6(t[0].shape,s):new J6(t[0].shape,s);return this.compileAndRun(u,t,a)},e.prototype.subtract=function(t,n){if(t.dtype==="complex64"&&n.dtype==="complex64")return this.complexSeparableBinaryOp(t,n,$y);if(this.shouldExecuteOnCPU([t,n]))return this.cpuBackend.subtract(t,n);var i=kr(t.dtype,n.dtype);if(Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,n,$y,t.dtype);var o=new qn($y,t.shape,n.shape);return this.compileAndRun(o,[t,n],i)},e.prototype.pow=function(t,n){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo(`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new qn(`
if(a < 0.0 && floor(b) < b){
  return NAN;
}
if (b == 0.0) {
  return 1.0;
}
return (round(mod(b, 2.0)) != 1) ?
    pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,t.shape,n.shape),o=kr(t.dtype,n.dtype);return this.compileAndRun(i,[t,n],o)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,mE,t.dtype);var n=new Kt(t.shape,mE);return this.compileAndRun(n,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,gE,t.dtype);var n=new Kt(t.shape,gE);return this.compileAndRun(n,[t])},e.prototype.sign=function(t){var n=new Kt(t.shape,`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`);return this.compileAndRun(n,[t])},e.prototype.isNaN=function(t){var n=new Kt(t.shape,"return float(isnan(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isInf=function(t){var n=new Kt(t.shape,"return float(isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.isFinite=function(t){var n=new Kt(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(n,[t],"bool")},e.prototype.round=function(t){var n=new Kt(t.shape,`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`);return this.compileAndRun(n,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,vE,t.dtype);var n=new Kt(t.shape,vE);return this.compileAndRun(n,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,yE,t.dtype);var n=new Kt(t.shape,yE);return this.compileAndRun(n,[t])},e.prototype.softmax=function(t,n){var i=dr([n],t.shape),o=this.max(t,i),a=Si(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return eu(u,l)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,t.dtype);var n=new Kt(t.shape,`if (x < 0.0) return NAN;
  return log(x);`);return this.compileAndRun(n,[t])},e.prototype.log1p=function(t){var n=new Kt(t.shape,"return log(1.0 + x);");return this.compileAndRun(n,[t])},e.prototype.sqrt=function(t){var n=new Kt(t.shape,"return sqrt(x);");return this.compileAndRun(n,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var n=new Kt(t.shape,"return inversesqrt(x);");return this.compileAndRun(n,[t])},e.prototype.reciprocal=function(t){var n=new Kt(t.shape,"return 1.0 / x;");return this.compileAndRun(n,[t])},e.prototype.relu=function(t){var n;return n=Ne().getBool("WEBGL_PACK")?new zh(t.shape,J3):new Kt(t.shape,X3),this.compileAndRun(n,[t])},e.prototype.relu6=function(t){var n;return n=Ne().getBool("WEBGL_PACK")?new zh(t.shape,Z3):new Kt(t.shape,Y3),this.compileAndRun(n,[t])},e.prototype.prelu=function(t,n){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo($3,t.shape,n.shape):new qn(q3,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.elu=function(t){if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Q3,t.dtype);var n=new Kt(t.shape,K3);return this.compileAndRun(n,[t])},e.prototype.eluDer=function(t,n){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo(`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,t.shape,n.shape):new qn("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.selu=function(t){var n=new Kt(t.shape,DU);return this.compileAndRun(n,[t])},e.prototype.int=function(t){var n=new Kt(t.shape,"return float(int(x));");return this.compileAndRun(n,[t],"int32")},e.prototype.clip=function(t,n,i){var o,a=(o=Ne().getBool("WEBGL_PACK_CLIP")?new m8(t.shape):new p8(t.shape)).getCustomSetupFunc(n,i);return this.compileAndRun(o,[t],null,a)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(Ne().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,fE,t.dtype);var n=new Kt(t.shape,fE);return this.compileAndRun(n,[t])},e.prototype.complexAbs=function(t){var n=this.texData.get(t.dataId),i=new g8(t.shape),o=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)];return this.compileAndRun(i,o)},e.prototype.sigmoid=function(t){var n=new Kt(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(n,[t])},e.prototype.softplus=function(t){var n=new Kt(t.shape,`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`);return this.compileAndRun(n,[t])},e.prototype.sin=function(t){var n=new Kt(t.shape,NU);return this.compileAndRun(n,[t])},e.prototype.cos=function(t){var n=new Kt(t.shape,PU);return this.compileAndRun(n,[t])},e.prototype.tan=function(t){var n=new Kt(t.shape,"return tan(x);");return this.compileAndRun(n,[t])},e.prototype.asin=function(t){var n=new Kt(t.shape,FU);return this.compileAndRun(n,[t])},e.prototype.acos=function(t){var n=new Kt(t.shape,OU);return this.compileAndRun(n,[t])},e.prototype.atan=function(t){var n=new Kt(t.shape,LU);return this.compileAndRun(n,[t])},e.prototype.atan2=function(t,n){var i=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo(`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;

  return result;
`,t.shape,n.shape):new qn(`
  if (isnan(a)) return a;
  if (isnan(b)) return b;

  return atan(a, b);
`,t.shape,n.shape);return this.compileAndRun(i,[t,n])},e.prototype.sinh=function(t){var n=new Kt(t.shape,`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.cosh=function(t){var n=new Kt(t.shape,`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`);return this.compileAndRun(n,[t])},e.prototype.tanh=function(t){var n=new Kt(t.shape,`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`);return this.compileAndRun(n,[t])},e.prototype.asinh=function(t){var n=new Kt(t.shape,BU);return this.compileAndRun(n,[t])},e.prototype.acosh=function(t){var n=new Kt(t.shape,UU);return this.compileAndRun(n,[t])},e.prototype.atanh=function(t){var n=new Kt(t.shape,zU);return this.compileAndRun(n,[t])},e.prototype.erf=function(t){var n=new Kt(t.shape,`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = 0.3275911;
  float a1 = 0.254829592;
  float a2 = -0.284496736;
  float a3 = 1.421413741;
  float a4 = -1.453152027;
  float a5 = 1.061405429;

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`);return this.compileAndRun(n,[t])},e.prototype.step=function(t,n){var i=new Kt(t.shape,(function(o){return o===void 0&&(o=0),Ho+`
    return x > 0.0 ? 1.0 : float(`+o+`);
  `})(n));return this.compileAndRun(i,[t])},e.prototype.conv2dByMatMul=function(t,n,i,o,a,s){var u=t.shape,l=this.texData.get(t.dataId),c=i.inChannels,h=u[0]*u[1]*u[2],f=i.outChannels,m=i.dataFormat==="channelsLast",g=(h===1||f===1)&&c>1e3,w=u[2]%2!=0&&!!l.isPacked;if(g||!Ne().getBool("WEBGL_LAZILY_UNPACK")||!Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!w){var v=m?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],y=this.reshape(t,[1,v,i.inChannels]),x=this.reshape(n,[1,i.inChannels,i.outChannels]);return this.reshape(this.fusedBatchMatMul({a:y,b:x,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),i.outShape)}var E=m?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),_={dataId:t.dataId,shape:[1,E,i.inChannels],dtype:t.dtype},k=l.shape;l.shape=l.shape.slice(),l.shape[l.shape.length-2]++,K(dp(l.shape,_.shape),(function(){return"packed reshape "+l.shape+" to "+_.shape+" isn't free"}));var C=this.reshape(n,[1,i.inChannels,i.outChannels]),R=this.fusedBatchMatMul({a:_,b:C,transposeA:!1,transposeB:!1,bias:o,activation:a,preluActivationWeights:s}),I=this.texData.get(R.dataId);return K(I.isPacked,(function(){return"batchMatMul result is expected to be packed"})),l.shape=k,I.shape=i.outShape,le.makeTensorFromDataId(R.dataId,i.outShape,R.dtype)},e.prototype.conv2dWithIm2Row=function(t,n,i,o,a,s){var u=i.filterWidth,l=i.filterHeight,c=i.inChannels,h=i.outWidth,f=i.outHeight,m=i.dataFormat==="channelsLast",g=u*l*c,w=f*h,v=[g,w],y=t.squeeze([0]),x=n.reshape([1,g,-1]),E=new iU(v,y.shape,i),_=this.compileAndRun(E,[y]).reshape([1,v[0],v[1]]),k=o!=null,C=s!=null,R=a?gp(a,!0):null,I=new Xy(_.shape,[1,w,i.outChannels],!0,!1,k,R,C),T=[_,x];o&&T.push(o),C&&T.push(s);var A=this.compileAndRun(I,T);return m?A.reshape([1,f,h,i.outChannels]):A.reshape([1,i.outChannels,f,h])},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights;if(o.filterHeight===1&&o.filterWidth===1&&o.dilationHeight===1&&o.dilationWidth===1&&o.strideHeight===1&&o.strideWidth===1&&(o.padInfo.type==="SAME"||o.padInfo.type==="VALID"))return this.conv2dByMatMul(n,i,o,a,s,u);if(Ne().getBool("WEBGL_CONV_IM2COL")&&n.shape[0]===1)return this.conv2dWithIm2Row(n,i,o,a,s,u);var l=a!=null,c=u!=null,h=s?gp(s,!1):null,f=new iE(o,l,h,c),m=[n,i];return a&&m.push(a),u&&m.push(u),this.compileAndRun(f,m)},e.prototype.conv2d=function(t,n,i){if(i.filterHeight===1&&i.filterWidth===1&&i.dilationHeight===1&&i.dilationWidth===1&&i.strideHeight===1&&i.strideWidth===1&&(i.padInfo.type==="SAME"||i.padInfo.type==="VALID"))return this.conv2dByMatMul(t,n,i);if(Ne().getBool("WEBGL_CONV_IM2COL")&&t.shape[0]===1)return this.conv2dWithIm2Row(t,n,i);var o=new iE(i);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerInput=function(t,n,i){var o=new w8(i);return this.compileAndRun(o,[t,n])},e.prototype.conv2dDerFilter=function(t,n,i){var o=new b8(i);return this.compileAndRun(o,[t,n])},e.prototype.fusedDepthwiseConv2D=function(t){var n,i=t.input,o=t.filter,a=t.convInfo,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=Ne().getBool("WEBGL_PACK_DEPTHWISECONV")&&a.strideWidth<=2&&a.outChannels/a.inChannels==1,h=u?gp(u,c):null,f=[i,o],m=s!=null,g=l!=null;return m&&f.push(s),g&&f.push(l),c?(n=new aE(a,m,h,g),this.compileAndRun(n,f)):(n=new oE(a,m,h,g),this.compileAndRun(n,f))},e.prototype.depthwiseConv2D=function(t,n,i){var o;return Ne().getBool("WEBGL_PACK_DEPTHWISECONV")&&i.strideWidth<=2&&i.outChannels/i.inChannels==1?(o=new aE(i),this.compileAndRun(o,[t,n])):(o=new oE(i),this.compileAndRun(o,[t,n]))},e.prototype.depthwiseConv2DDerInput=function(t,n,i){var o=new E8(i);return this.compileAndRun(o,[t,n])},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){var o=new S8(i);return this.compileAndRun(o,[t,n])},e.prototype.conv3d=function(t,n,i){var o=new k8(i);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerInput=function(t,n,i){var o=new x8(i);return this.compileAndRun(o,[t,n])},e.prototype.conv3dDerFilter=function(t,n,i){var o=new _8(i);return this.compileAndRun(o,[t,n])},e.prototype.maxPool=function(t,n){var i=new Yh(n,"max",!1);return this.compileAndRun(i,[t])},e.prototype.avgPool=function(t,n){var i=new Yh(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPoolBackprop=function(t,n,i,o){var a=new Yh(o,"max",!0),s=this.compileAndRun(a,[n]),u=new uU(o),l=this.compileAndRun(u,[t,s],n.dtype);return s.dispose(),l},e.prototype.avgPoolBackprop=function(t,n,i){var o=new a8(i);return this.compileAndRun(o,[t],n.dtype)},e.prototype.cast=function(t,n){return L3(t,n,this)},e.prototype.unstack=function(t,n){for(var i=t.shape[n],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==n&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[n]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[n]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.avgPool3d=function(t,n){var i=new Yy(n,"avg",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,n,i){var o=new s8(i);return this.compileAndRun(o,[t],n.dtype)},e.prototype.maxPool3d=function(t,n){var i=new Yy(n,"max",!1);return this.compileAndRun(i,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,n,i,o){var a=new Yy(o,"max",!0),s=this.compileAndRun(a,[n]),u=new lU(o),l=this.compileAndRun(u,[t,s],n.dtype);return s.dispose(),l},e.prototype.reshape=function(t,n){var i=this.texData.get(t.dataId);if(i.isPacked&&!dp(t.shape,n)&&(i.texture===null||!dp(i.shape,n))){var o=this.packedReshape(t,n);return le.makeTensorFromDataId(o.dataId,o.shape,o.dtype)}return gb(t,n)},e.prototype.resizeBilinear=function(t,n,i,o){var a=Ne().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new bU(t.shape,n,i,o):new yU(t.shape,n,i,o);return this.compileAndRun(a,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,n,i){var o=new vU(t,n,i);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighbor=function(t,n,i,o){var a=new _U(t.shape,n,i,o);return this.compileAndRun(a,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){var o=new wU(t,n,i);return this.compileAndRun(o,[t])},e.prototype.multinomial=function(t,n,i,o){var a=n?t:ug(t),s=a.shape[0],u=a.shape[1],l=new cU(s,u,i),c=l.getCustomSetupFunc(o);return this.compileAndRun(l,[a],"int32",c)},e.prototype.oneHot=function(t,n,i,o){var a=new hU(t.size,n,i,o);return this.compileAndRun(a,[t])},e.prototype.diag=function(t){var n=new I8(t.size);return this.compileAndRun(n,[t])},e.prototype.nonMaxSuppression=function(t,n,i,o,a){return Tm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Gw(t.dataSync(),n.dataSync(),i,o,a)},e.prototype.cropAndResize=function(t,n,i,o,a,s){var u=new C8(t.shape,n.shape,o,a,s);return this.compileAndRun(u,[t,n,i],"float32")},e.prototype.depthToSpace=function(t,n,i){K(n>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+n}));var o=t.shape[0],a=i==="NHWC"?t.shape[1]:t.shape[2],s=i==="NHWC"?t.shape[2]:t.shape[3],u=i==="NHWC"?t.shape[3]:t.shape[1],l=a*n,c=s*n,h=u/(n*n),f=new R8(i==="NHWC"?[o,l,c,h]:[o,h,l,c],n,i);return this.compileAndRun(f,[t])},e.prototype.split=function(t,n,i){return z3(t,n,i)},e.prototype.scatterND=function(t,n,i){var o=Pm(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=[c/u,u],f=t.reshape([s,a]),m=n.reshape([s,u]);if(c===0)return gb(Cr([]),i);var g=Ct(0),w=new cE(s,a,f.rank,m.rank,l,h);return this.compileAndRun(w,[m,f,g]).reshape(i)},e.prototype.sparseToDense=function(t,n,i,o){var a=Pm(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.strides,c=a.outputSize,h=new cE(u,s,t.rank,n.rank,l,[c,1]);return this.compileAndRun(h,[n,t,o]).reshape(i)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,n){var i=this.texData.get(t.dataId),o=new uE(O8,t.shape,n),a=new uE(L8,t.shape,n),s=[this.makeComplexComponentTensorInfo(t,i.complexTensors.real),this.makeComplexComponentTensorInfo(t,i.complexTensors.imag)],u=this.compileAndRun(o,s),l=this.compileAndRun(a,s),c=this.complex(u,l).as2D(t.shape[0],t.shape[1]);return u.dispose(),l.dispose(),c},e.prototype.gatherND=function(t,n){var i=n.shape,o=i[i.length-1],a=R3(t,n),s=a[0],u=a[1],l=a[2],c=a[3],h=n.reshape([u,o]),f=t.reshape([t.size/l,l]),m=new z8(o,c,[u,l]);return this.compileAndRun(m,[f,h]).reshape(s)},e.prototype.fill=function(t,n,i){if((i=i||kd(n))==="string"){var o=Sm(i,bt(t));return o.fill(n),le.makeTensor(o,t,i,this)}var a=new B8(t,n),s=a.getCustomSetupFunc(n);return this.compileAndRun(a,[],i,s)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,t.dtype==="string"?"":0,t.dtype)},e.prototype.linspace=function(t,n,i){return B3(t,n,i)},e.prototype.makeTensorInfo=function(t,n){var i=this.write(null,t,n);return this.texData.get(i).usage=null,{dataId:i,shape:t,dtype:n}},e.prototype.makeOutput=function(t,n){var i=this.makeTensorInfo(t,n).dataId;return le.makeTensorFromDataId(i,t,n,this)},e.prototype.unpackTensor=function(t){var n=new HU(t.shape);return this.runWebGLProgram(n,[t],t.dtype)},e.prototype.packTensor=function(t){var n=new dU(t.shape);return this.runWebGLProgram(n,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,n){var i=[km(t.shape)].concat(Cm(t.shape)),o={dtype:t.dtype,shape:i,dataId:t.dataId},a=[km(n)].concat(Cm(n)),s=new gU(a,i),u=this.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:u.dataId,shape:n,dtype:u.dtype}},e.prototype.decode=function(t){var n,i=this.texData.get(t),o=i.isPacked,a=i.shape,s=i.dtype,u=Vy(a);return n=o?new A8(u):new M8(u),{dtype:s,shape:a,dataId:this.runWebGLProgram(n,[{shape:u,dtype:s,dataId:t}],s,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,n,i,o,a){var s=this;a===void 0&&(a=!1);var u=this.makeTensorInfo(t.outputShape,i),l=this.texData.get(u.dataId);if(t.packedOutput&&(l.isPacked=!0),t.outPackingScheme===nd.DENSE){var c=$h(t.outputShape);l.texShape=c.map((function(E){return 2*E}))}if(t.outTexUsage!=null&&(l.usage=t.outTexUsage),bt(u.shape)===0)return l.values=Lc(u.dtype,0),u;var h=[],f=n.map((function(E){if(E.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var _=s.texData.get(E.dataId);if(_.texture==null){if(!t.packedInputs&&bt(E.shape)<=Ne().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:E.shape,texData:null,isUniform:!0,uniformValues:_.values};t.packedInputs&&(_.isPacked=!0,_.shape=E.shape)}else if(!!_.isPacked!=!!t.packedInputs)E=_.isPacked?s.unpackTensor(E):s.packTensor(E),h.push(E),_=s.texData.get(E.dataId);else if(_.isPacked&&!dp(_.shape,E.shape)){var k=E,C=E.shape;E.shape=_.shape,E=s.packedReshape(E,C),h.push(E),_=s.texData.get(E.dataId),k.shape=C}return s.uploadToGPU(E.dataId),{shape:E.shape,texData:_,isUniform:!1}}));this.uploadToGPU(u.dataId);var m,g={shape:u.shape,texData:l,isUniform:!1},w=(function(E,_,k){var C="";_.concat(k).forEach((function(T){var A=T.texData!=null&&T.texData.slice!=null&&T.texData.slice.flatOffset>0,N=T.isUniform?"uniform":T.texData.texShape;C+=T.shape+"_"+N+"_"+A}));var R=E.userCode,I=E.constructor.name;return I+="_"+C+"_"+R})(t,f,g),v=this.getAndSaveBinary(w,(function(){return(function(E,_,k,C){var R=_.userCode,I=k.map((function(L,H){var W={logicalShape:L.shape,texShape:L.isUniform?null:L.texData.texShape,isUniform:L.isUniform,isPacked:!L.isUniform&&L.texData.isPacked,flatOffset:null};return L.texData!=null&&L.texData.slice!=null&&L.texData.slice.flatOffset>0&&(W.flatOffset=L.texData.slice.flatOffset),{name:_.variableNames[H],shapeInfo:W}})),T=I.map((function(L){return L.shapeInfo})),A={logicalShape:C.shape,texShape:C.texData.texShape,isUniform:!1,isPacked:C.texData.isPacked,flatOffset:null},N=e8(I,A,R,_.packedInputs),O=E.createProgram(N),V=null,F=E.getUniformLocation(O,"NAN",!1);Ne().getNumber("WEBGL_VERSION")===1&&(V=E.getUniformLocation(O,"INFINITY",!1));for(var B={},U=0;U<_.variableNames.length;U++){var P=_.variableNames[U];B[P]=E.getUniformLocation(O,P,!1),B["offset"+P]=E.getUniformLocation(O,"offset"+P,!1)}return{program:_,source:N,webGLProgram:O,uniformLocations:B,inShapeInfos:T,outShapeInfo:A,infLoc:V,nanLoc:F}})(s.gpgpu,t,f,g)})),y=this.activeTimers!=null;if(y&&(m=this.startTimer()),(function(E,_,k,C,R){lE(_.inShapeInfos,k),lE([_.outShapeInfo],[C]);var I=C.texData.texture,T=C.texData.texShape;C.texData.isPacked?E.setOutputPackedMatrixTexture(I,T[0],T[1]):E.setOutputMatrixTexture(I,T[0],T[1]),E.setProgram(_.webGLProgram),Ne().getNumber("WEBGL_VERSION")===1&&_.infLoc!==null&&E.gl.uniform1f(_.infLoc,1/0),_.nanLoc!==null&&E.gl.uniform1f(_.nanLoc,NaN),k.forEach((function(A,N){var O=_.program.variableNames[N],V=_.uniformLocations[O],F=_.uniformLocations["offset"+O];if(V!=null)if(A.isUniform)if(bt(A.shape)<2)E.gl.uniform1f(V,A.uniformValues[0]);else{var B=A.uniformValues;B instanceof Float32Array||(B=new Float32Array(B)),E.gl.uniform1fv(V,B)}else A.texData.slice!=null&&F!=null&&E.gl.uniform1i(F,A.texData.slice.flatOffset),E.setInputMatrixTexture(A.texData.texture,V,N)})),R?.(E,_.webGLProgram),E.executeProgram()})(this.gpgpu,v,f,g,o),h.forEach((function(E){return s.disposeData(E.dataId)})),y&&(m=this.endTimer(m),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(m)})),!Ne().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&a===!1){var x=this.unpackTensor(u);return this.disposeData(u.dataId),x}return u},e.prototype.compileAndRun=function(t,n,i,o,a){a===void 0&&(a=!1),i=i||n[0].dtype;var s=this.runWebGLProgram(t,n,i,o,a);return le.makeTensorFromDataId(s.dataId,s.shape,s.dtype)},e.prototype.getAndSaveBinary=function(t,n){return t in this.binaryCache||(this.binaryCache[t]=n()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(Ne().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(n){t.gpgpu.deleteProgram(t.binaryCache[n].webGLProgram),delete t.binaryCache[n]})),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return this.floatPrecisionValue==null&&(this.floatPrecisionValue=_n((function(){if(!Ne().get("WEBGL_RENDER_FLOAT32_ENABLED")){var n=Ne().getBool("DEBUG");Ne().set("DEBUG",!1);var i=t.abs(Ct(1e-8)).dataSync()[0];if(Ne().set("DEBUG",n),i>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return this.floatPrecision()===32?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var n,i=this.texData.get(t),o=i.shape,a=i.dtype,s=i.values,u=i.texture,l=i.usage,c=i.isPacked;if(u==null){var h,f=this.activeTimers!=null;f&&(h=na());var m=i.texShape;if(m==null&&(m=CB(o,c),i.texShape=m),s!=null){var g=Vy(o),w=void 0,v=m[1],y=m[0],x=s instanceof Uint8Array;c?(v=(n=Td(m[0],m[1]))[0],y=n[1],w=new F8(g,[y,v],x)):w=new P8(g,[y,v],x);var E=this.makeTensorInfo([y,v],a);this.texData.get(E.dataId).usage=x?Li.PIXELS:Li.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(E.dataId),v,y,s);var _=this.runWebGLProgram(w,[E],a,null,!0),k=this.texData.get(_.dataId);i.texture=k.texture,i.texShape=k.texShape,i.isPacked=k.isPacked,i.usage=k.usage,this.disposeData(E.dataId),this.texData.delete(_.dataId),i.values=null,f&&(this.uploadWaitMs+=na()-h)}else{var C=this.acquireTexture(m,l,a,c);i.texture=C}}},e.prototype.convertAndCacheOnCPU=function(t,n){var i=this.texData.get(t),o=i.dtype;return this.releaseGPUData(t),n!=null&&(i.values=(function(a,s){if(s==="float32"||s==="complex64")return a;if(s==="int32"||s==="bool"){for(var u=s==="int32"?new Int32Array(a.length):new Uint8Array(a.length),l=0;l<u.length;++l)u[l]=Math.round(a[l]);return u}throw new Error("Unknown dtype "+s)})(n,o)),i.values},e.prototype.acquireTexture=function(t,n,i,o){if(this.numBytesInGPU+=this.computeBytes(t,i),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+a+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,n,o)},e.prototype.computeBytes=function(t,n){return t[0]*t[1]*r3(n)},e})(F3);h3()&&le.registerBackend("webgl",(function(){return new VU}),2);function hl(r,e){return r(e={exports:{}},e.exports),e.exports}var jU=hl((function(r){(function(e,t,n){function i(s){var u,l=this,c=(u=4022871197,function(h){h=h.toString();for(var f=0;f<h.length;f++){var m=.02519603282416938*(u+=h.charCodeAt(f));m-=u=m>>>0,u=(m*=u)>>>0,u+=4294967296*(m-=u)}return 23283064365386963e-26*(u>>>0)});l.next=function(){var h=2091639*l.s0+23283064365386963e-26*l.c;return l.s0=l.s1,l.s1=l.s2,l.s2=h-(l.c=0|h)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(s),l.s0<0&&(l.s0+=1),l.s1-=c(s),l.s1<0&&(l.s1+=1),l.s2-=c(s),l.s2<0&&(l.s2+=1),c=null}function o(s,u){return u.c=s.c,u.s0=s.s0,u.s1=s.s1,u.s2=s.s2,u}function a(s,u){var l=new i(s),c=u&&u.state,h=l.next;return h.int32=function(){return 4294967296*l.next()|0},h.double=function(){return h()+11102230246251565e-32*(2097152*h()|0)},h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.alea=a})(0,r)})),qU=hl((function(r){(function(e,t,n){function i(s){var u=this,l="";u.x=0,u.y=0,u.z=0,u.w=0,u.next=function(){var h=u.x^u.x<<11;return u.x=u.y,u.y=u.z,u.z=u.w,u.w^=u.w>>>19^h^h>>>8},s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor128=a})(0,r)})),$U=hl((function(r){(function(e,t,n){function i(s){var u=this,l="";u.next=function(){var h=u.x^u.x>>>2;return u.x=u.y,u.y=u.z,u.z=u.w,u.w=u.v,(u.d=u.d+362437|0)+(u.v=u.v^u.v<<4^h^h<<1)|0},u.x=0,u.y=0,u.z=0,u.w=0,u.v=0,s===(0|s)?u.x=s:l+=s;for(var c=0;c<l.length+64;c++)u.x^=0|l.charCodeAt(c),c==l.length&&(u.d=u.x<<10^u.x>>>4),u.next()}function o(s,u){return u.x=s.x,u.y=s.y,u.z=s.z,u.w=s.w,u.v=s.v,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorwow=a})(0,r)})),XU=hl((function(r){(function(e,t,n){function i(s){var u=this;u.next=function(){var l,c,h=u.x,f=u.i;return l=h[f],c=(l^=l>>>7)^l<<24,c^=(l=h[f+1&7])^l>>>10,c^=(l=h[f+3&7])^l>>>3,c^=(l=h[f+4&7])^l<<7,l=h[f+7&7],c^=(l^=l<<13)^l<<9,h[f]=c,u.i=f+1&7,c},(function(l,c){var h,f=[];if(c===(0|c))f[0]=c;else for(c=""+c,h=0;h<c.length;++h)f[7&h]=f[7&h]<<15^c.charCodeAt(h)+f[h+1&7]<<13;for(;f.length<8;)f.push(0);for(h=0;h<8&&f[h]===0;++h);for(h==8?f[7]=-1:f[h],l.x=f,l.i=0,h=256;h>0;--h)l.next()})(u,s)}function o(s,u){return u.x=s.x.slice(),u.i=s.i,u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.x&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xorshift7=a})(0,r)})),YU=hl((function(r){(function(e,t,n){function i(s){var u=this;u.next=function(){var l,c,h=u.w,f=u.X,m=u.i;return u.w=h=h+1640531527|0,c=f[m+34&127],l=f[m=m+1&127],c^=c<<13,l^=l<<17,c^=c>>>15,l^=l>>>12,c=f[m]=c^l,u.i=m,c+(h^h>>>16)|0},(function(l,c){var h,f,m,g,w,v=[],y=128;for(c===(0|c)?(f=c,c=null):(c+="\0",f=0,y=Math.max(y,c.length)),m=0,g=-32;g<y;++g)c&&(f^=c.charCodeAt((g+32)%c.length)),g===0&&(w=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,g>=0&&(w=w+1640531527|0,m=(h=v[127&g]^=f+w)==0?m+1:0);for(m>=128&&(v[127&(c&&c.length||0)]=-1),m=127,g=512;g>0;--g)f=v[m+34&127],h=v[m=m+1&127],f^=f<<13,h^=h<<17,f^=f>>>15,h^=h>>>12,v[m]=f^h;l.w=w,l.X=v,l.i=m})(u,s)}function o(s,u){return u.i=s.i,u.w=s.w,u.X=s.X.slice(),u}function a(s,u){s==null&&(s=+new Date);var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(c.X&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.xor4096=a})(0,r)})),KU=hl((function(r){(function(e,t,n){function i(s){var u=this,l="";u.next=function(){var h=u.b,f=u.c,m=u.d,g=u.a;return h=h<<25^h>>>7^f,f=f-m|0,m=m<<24^m>>>8^g,g=g-h|0,u.b=h=h<<20^h>>>12^f,u.c=f=f-m|0,u.d=m<<16^f>>>16^g,u.a=g-h|0},u.a=0,u.b=0,u.c=-1640531527,u.d=1367130551,s===Math.floor(s)?(u.a=s/4294967296|0,u.b=0|s):l+=s;for(var c=0;c<l.length+20;c++)u.b^=0|l.charCodeAt(c),u.next()}function o(s,u){return u.a=s.a,u.b=s.b,u.c=s.c,u.d=s.d,u}function a(s,u){var l=new i(s),c=u&&u.state,h=function(){return(l.next()>>>0)/4294967296};return h.double=function(){do var f=((l.next()>>>11)+(l.next()>>>0)/4294967296)/2097152;while(f===0);return f},h.int32=l.next,h.quick=h,c&&(typeof c=="object"&&o(c,l),h.state=function(){return o(l,{})}),h}t&&t.exports?t.exports=a:this.tychei=a})(0,r)})),Bu=hl((function(r){(function(e,t){var n,i=this,o=256,a=6,s="random",u=t.pow(o,a),l=t.pow(2,52),c=2*l,h=o-1;function f(y,x,E){var _=[],k=w((function I(T,A){var N,O=[],V=typeof T;if(A&&V=="object")for(N in T)try{O.push(I(T[N],A-1))}catch{}return O.length?O:V=="string"?T:T+"\0"})((x=x==1?{entropy:!0}:x||{}).entropy?[y,v(e)]:y??(function(){try{var I;return n&&(I=n.randomBytes)?I=I(o):(I=new Uint8Array(o),(i.crypto||i.msCrypto).getRandomValues(I)),v(I)}catch{var T=i.navigator,A=T&&T.plugins;return[+new Date,i,A,i.screen,v(e)]}})(),3),_),C=new m(_),R=function(){for(var I=C.g(a),T=u,A=0;I<l;)I=(I+A)*o,T*=o,A=C.g(1);for(;I>=c;)I/=2,T/=2,A>>>=1;return(I+A)/T};return R.int32=function(){return 0|C.g(4)},R.quick=function(){return C.g(4)/4294967296},R.double=R,w(v(C.S),e),(x.pass||E||function(I,T,A,N){return N&&(N.S&&g(N,C),I.state=function(){return g(C,{})}),A?(t[s]=I,T):I})(R,k,"global"in x?x.global:this==t,x.state)}function m(y){var x,E=y.length,_=this,k=0,C=_.i=_.j=0,R=_.S=[];for(E||(y=[E++]);k<o;)R[k]=k++;for(k=0;k<o;k++)R[k]=R[C=h&C+y[k%E]+(x=R[k])],R[C]=x;(_.g=function(I){for(var T,A=0,N=_.i,O=_.j,V=_.S;I--;)T=V[N=h&N+1],A=A*o+V[h&(V[N]=V[O=h&O+T])+(V[O]=T)];return _.i=N,_.j=O,A})(o)}function g(y,x){return x.i=y.i,x.j=y.j,x.S=y.S.slice(),x}function w(y,x){for(var E,_=y+"",k=0;k<_.length;)x[h&k]=h&(E^=19*x[h&k])+_.charCodeAt(k++);return v(x)}function v(y){return String.fromCharCode.apply(0,y)}if(t["seed"+s]=f,w(t.random(),e),r.exports){r.exports=f;try{n=require("crypto")}catch{}}})([],Math)}));Bu.alea=jU,Bu.xor128=qU,Bu.xorwow=$U,Bu.xorshift7=XU,Bu.xor4096=YU,Bu.tychei=KU;var lg=Bu.alea,JU=oe({addN_:function(r){K(Array.isArray(r),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),K(r.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+r.length}));var e=r.map((function(i,o){return X(i,"tensors"+o,"addN")})),t=e[0];e.forEach((function(i){if(i.dtype!==t.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(i){if(!wr(i.shape,t.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var n=e;return le.runKernelFunc((function(i,o){return i.addN(e)}),n,null,"AddN")}});function cg(){d3("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function eM(r){return r.rank===0||r.rank===1?r.as4D(1,1,1,r.size):r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}function tM(r,e,t,n,i,o){o==null&&(o=.001);var a,s,u=X(r,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");i!=null&&(a=X(i,"scale","batchNorm")),n!=null&&(s=X(n,"offset","batchNorm")),K(l.rank===c.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),K(s==null||l.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),K(a==null||l.rank===a.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h={x:u,scale:a,offset:s,mean:l,variance:c},f={varianceEpsilon:o};return le.runKernelFunc((function(m,g){var w=eM(u),v=m.batchNormalization(w,vp(l),vp(c),o,vp(a),vp(s));return g([u,l,c,a]),v}),h,null,"FusedBatchNorm",f).reshape(u.shape)}function vp(r){return r==null?null:r.rank===0?r.as1D():r.rank===1?r:r.rank===2?r.as4D(1,1,r.shape[0],r.shape[1]):r.rank===3?r.as4D(1,r.shape[0],r.shape[1],r.shape[2]):r}var ZU=oe({batchNormalization_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),cg(),tM(r,e,t,o,i,n)}}),Ad=oe({batchNorm_:tM});function nM(r,e,t,n,i,o){var a,s,u=X(r,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");return i!=null&&(a=X(i,"scale","batchNorm")),n!=null&&(s=X(n,"offset","batchNorm")),K(u.rank===2,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),K(l.rank===2||l.rank===1,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+l.rank+"."})),K(c.rank===2||c.rank===1,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+c.rank+"."})),a!=null&&K(a.rank===2||a.rank===1,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+a.rank+"."})),s!=null&&K(s.rank===2||s.rank===1,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),Ad(u,l,c,s,a,o)}var QU=oe({batchNormalization2d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),cg(),nM(r,e,t,o,i,n)}}),e7=oe({batchNorm2d_:nM});function rM(r,e,t,n,i,o){var a,s,u=X(r,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");return i!=null&&(a=X(i,"scale","batchNorm")),n!=null&&(s=X(n,"offset","batchNorm")),K(u.rank===3,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),K(l.rank===3||l.rank===1,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+l.rank+"."})),K(c.rank===3||c.rank===1,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+c.rank+"."})),a!=null&&K(a.rank===3||a.rank===1,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+a.rank+"."})),s!=null&&K(s.rank===3||s.rank===1,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),Ad(u,l,c,s,a,o)}var t7=oe({batchNormalization3d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),cg(),rM(r,e,t,o,i,n)}}),n7=oe({batchNorm3d_:rM});function iM(r,e,t,n,i,o){var a,s,u=X(r,"x","batchNorm"),l=X(e,"mean","batchNorm"),c=X(t,"variance","batchNorm");return i!=null&&(a=X(i,"scale","batchNorm")),n!=null&&(s=X(n,"offset","batchNorm")),K(u.rank===4,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),K(l.rank===4||l.rank===1,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+l.rank+"."})),K(c.rank===4||c.rank===1,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+c.rank+"."})),a!=null&&K(a.rank===4||a.rank===1,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+a.rank+"."})),s!=null&&K(s.rank===4||s.rank===1,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),Ad(u,l,c,s,a,o)}var r7=oe({batchNormalization4d_:function(r,e,t,n,i,o){return n===void 0&&(n=.001),cg(),iM(r,e,t,o,i,n)}}),i7=oe({batchNorm4d_:iM}),oM=oe({broadcastTo_:function(r,e){var t=X(r,"broadcastTo","x"),n=t.shape;if(e.some((function(h){return!(h>0)||h%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<t.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+t.rank+".");if(e.length>t.rank){for(var i=t.shape.slice();i.length<e.length;)i.unshift(1);t=t.reshape(i)}for(var o=t.shape,a=Array.from(e),s=e.length-1;s>=0;s--)if(o[s]===e[s])a[s]=1;else if(t.shape[s]!==1)throw new Error("broadcastTo(): ["+n+"] cannot be broadcast to ["+e+"].");var u=a.map((function(h,f){return h>1?f:-1})).filter((function(h){return h>=0}));if(u.length===0)return t.clone();var l={x:t},c={shape:e,inputShape:o};return le.runKernelFunc((function(h){return h.tile(t,a)}),l,(function(h){return{x:function(){return h.sum(u,!0)}}}),x3,c)}}),o7=oe({clone_:function(r){var e=X(r,"x","clone",null);return le.runKernelFunc((function(){return le.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{x:e},null,E3)}}),hg=oe({logicalAnd_:function(r,e){var t=X(r,"a","logicalAnd","bool"),n=X(e,"b","logicalAnd","bool");return on(t.shape,n.shape),le.runKernelFunc((function(i){return i.logicalAnd(t,n)}),{a:t,b:n},null,"LogicalAnd")}}),a7=oe({logicalNot_:function(r){var e=X(r,"x","logicalNot","bool");return le.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),aM=oe({logicalOr_:function(r,e){var t=X(r,"a","logicalOr","bool"),n=X(e,"b","logicalOr","bool");return on(t.shape,n.shape),le.runKernelFunc((function(i){return i.logicalOr(t,n)}),{$a:t,$b:n})}}),s7=oe({logicalXor_:function(r,e){var t=X(r,"a","logicalXor","bool"),n=X(e,"b","logicalXor","bool");return on(t.shape,n.shape),aM(r,e).logicalAnd(hg(r,e).logicalNot())}}),il=oe({where_:function(r,e,t){var n=X(e,"a","where"),i=X(t,"b","where"),o=X(r,"condition","where","bool");return En(n.shape,i.shape,"Error in where: "),o.rank===1?K(o.shape[0]===n.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):En(o.shape,i.shape,"Error in where: "),le.runKernelFunc((function(a,s){var u=a.select(o,n,i);return s([o]),u}),{$condition:o,$a:n,$b:i},(function(a,s){var u=s[0];return{$condition:function(){return hn(u).toFloat()},$a:function(){return a.mul(u.cast(a.dtype))},$b:function(){return a.mul(u.logicalNot().cast(a.dtype))}}}))}}),sM=function(r){return wt(this,void 0,void 0,(function(){var e,t,n;return _t(this,(function(i){switch(i.label){case 0:return[4,(e=X(r,"condition","whereAsync","bool")).data()];case 1:return t=i.sent(),n=jw(e.shape,t),r!==e&&e.dispose(),[2,n]}}))}))},uM=oe({divNoNan_:function(r,e){var t,n=X(r,"a","div"),i=X(e,"b","div");n=(t=Gn(n,i))[0],i=t[1];var o=eu(n,i),a=hn(o),s=i.equal(a);return il(s,a,o)}}),kc=oe({tile_:function(r,e){var t=X(r,"x","tile",null);K(t.rank===e.length,(function(){return"Error in transpose: rank of input "+t.rank+" must match length of reps "+e+"."}));var n=[t],i={x:t},o={reps:e};return le.runKernelFunc((function(a,s){var u=a.tile(t,e);return s([t]),u}),i,null,k3,o,n)}}),lM=oe({eye_:function(r,e,t,n){n===void 0&&(n="float32"),e==null&&(e=r);for(var i=Xt([r,e],n),o=r<=e?r:e,a=0;a<o;++a)i.set(1,a,a);var s=i.toTensor().as2D(r,e);if(t==null)return s;if(t.length===1)return kc(Ws(s,0),[t[0],1,1]);if(t.length===2)return kc(Ws(Ws(s,0),0),[t[0],t[1],1,1]);if(t.length===3)return kc(Ws(Ws(Ws(s,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+t.length+"D.")}}),u7=oe({multinomial_:function(r,e,t,n){n===void 0&&(n=!1);var i=X(r,"logits","multinomial"),o=i.size,a=i.rank;if(o<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+o+".");if(a>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+a);t=t||Math.random();var s=a===1?i.as2D(1,-1):i,u=le.runKernelFunc((function(l){return l.multinomial(s,n,e,t)}),{logits2D:s});return a===1?u.as1D():u}}),Bm=oe({oneHot_:function(r,e,t,n){if(t===void 0&&(t=1),n===void 0&&(n=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var i=X(r,"indices","oneHot","int32"),o=i.shape.concat([e]),a={indices:i=i.flatten()},s={depth:e,onValue:t,offValue:n};return le.runKernelFunc((function(u,l){return l([i]),u.oneHot(i,e,t,n)}),a,null,S3,s).reshape(o)}}),ns=oe({pad_:function(r,e,t){t===void 0&&(t=0);var n=X(r,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var i={paddings:e,constantValue:t},o={x:n};return le.runKernelFunc((function(a,s){return s([n]),a.pad(n,e,t)}),o,null,C3,i)}}),l7=oe({pad1d_:function(r,e,t){return t===void 0&&(t=0),K(e.length===2,(function(){return"Invalid number of paddings. Must be length of 2."})),ns(r,[e],t)}}),c7=oe({pad2d_:function(r,e,t){return t===void 0&&(t=0),K(e.length===2&&e[0].length===2&&e[1].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ns(r,e,t)}}),h7=oe({pad3d_:function(r,e,t){return t===void 0&&(t=0),K(e.length===3&&e[0].length===2&&e[1].length===2&&e[2].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ns(r,e,t)}}),d7=oe({pad4d_:function(r,e,t){return t===void 0&&(t=0),K(e.length===4&&e[0].length===2&&e[1].length===2&&e[2].length===2&&e[3].length===2,(function(){return"Invalid number of paddings. Must be length of 2 each."})),ns(r,e,t)}}),f7=oe({rand_:function(r,e,t){var n=bt(r),i=null;if(t==null||t==="float32")i=new Float32Array(n);else if(t==="int32")i=new Int32Array(n);else{if(t!=="bool")throw new Error("Unknown data type "+t);i=new Uint8Array(n)}for(var o=0;o<n;o++)i[o]=e();return le.makeTensor(i,r,t)}}),Yw=(function(){function r(e,t,n,i,o){this.mean=e,this.stdDev=t,this.dtype=n,this.nextVal=NaN,this.truncated=i,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=lg(a.toString())}return r.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,i=!1;!i;){var o=void 0,a=void 0,s=void 0;do s=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a;while(s>=1||s===0);var u=Math.sqrt(-2*Math.log(s)/s);t=this.mean+this.stdDev*o*u,n=this.mean+this.stdDev*a*u,this.truncated&&!this.isValidTruncated(t)||(i=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)},r.prototype.convertValue=function(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)},r.prototype.isValidTruncated=function(e){return e<=this.upper&&e>=this.lower},r})(),p7=(function(){function r(e,t,n,i){this.alpha=e,this.beta=1/t,this.dtype=n;var o=i||Math.random();this.randu=lg(o.toString()),this.randn=new Yw(0,1,n,!1,this.randu()),this.d=e<1?e+2/3:e-1/3,this.c=1/Math.sqrt(9*this.d)}return r.prototype.nextValue=function(){for(var e,t,n,i,o,a;;){do i=this.randn.nextValue(),a=1+this.c*i;while(a<=0);if(a*=a*a,t=1-.331*(e=i*i)*e,n=.5*e+this.d*(1-a+Math.log(a)),(o=this.randu())<t||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},r.prototype.convertValue=function(e){return this.dtype==="float32"?e:Math.round(e)},r})(),m7=(function(){function r(e,t,n,i){var o=this;if(e===void 0&&(e=0),t===void 0&&(t=1),this.canReturnFloat=function(){return o.dtype==null||o.dtype==="float32"},this.min=e,this.range=t-e,this.dtype=n,i==null&&(i=Math.random()),typeof i=="number"&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+e+" - "+t+" <= 1 and dtype is not float");this.random=lg(i)}return r.prototype.convertValue=function(e){return this.canReturnFloat()?e:Math.round(e)},r.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},r})(),g7=oe({randomGamma_:function(r,e,t,n,i){if(t===void 0&&(t=1),n===void 0&&(n="float32"),t==null&&(t=1),n==null&&(n="float32"),n!=="float32"&&n!=="int32")throw new Error("Unsupported data type "+n);for(var o=new p7(e,t,n,i),a=Xt(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),v7=oe({randomNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type "+n);for(var o=new Yw(e,t,n,!1,i),a=Xt(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),cM=oe({randomUniform_:function(r,e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=1),n===void 0&&(n="float32");for(var o=Xt(r,n),a=new m7(e,t,null,i),s=0;s<o.values.length;s++)o.values[s]=a.nextValue();return o.toTensor()}}),hM=oe({square_:function(r){var e=X(r,"x","square"),t=[e];return le.runKernelFunc((function(n,i){return i([e]),n.square(e)}),{x:e},null,"Square",{},t,[])}}),dM=oe({squaredDifference_:function(r,e){var t,n=X(r,"a","squaredDifference"),i=X(e,"b","squaredDifference");t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape);var o={a:n,b:i},a=[n,i];return le.runKernelFunc((function(s,u){var l=s.squaredDifference(n,i);return u([n,i]),l}),o,(function(s,u){var l=u[0],c=u[1],h=Ct(2);return{a:function(){return s.mul(l.sub(c).mul(h))},b:function(){return s.mul(c.sub(l).mul(h))}}}),ag,{},a,[])}}),y7=oe({truncatedNormal_:function(r,e,t,n,i){if(e===void 0&&(e=0),t===void 0&&(t=1),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");for(var o=new Yw(e,t,n,!0,i),a=Xt(r,n),s=0;s<a.values.length;s++)a.values[s]=o.nextValue();return a.toTensor()}}),fM=oe({equal_:function(r,e){var t,n=X(r,"a","equal"),i=X(e,"b","equal");return t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape),le.runKernelFunc((function(o){return o.equal(n,i)}),{$a:n,$b:i})}}),b7=oe({equalStrict_:function(r,e){var t=X(r,"a","equalStrict"),n=X(e,"b","equalStrict");return En(t.shape,n.shape,"Error in equalStrict: "),t.equal(n)}}),w7=oe({greater_:function(r,e){var t,n=X(r,"a","greater"),i=X(e,"b","greater");return t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape),le.runKernelFunc((function(o){return o.greater(n,i)}),{a:n,b:i},null,"Greater")}}),pM=oe({greaterEqual_:function(r,e){var t,n=X(r,"a","greaterEqual"),i=X(e,"b","greaterEqual");return t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.greaterEqual(n,i);return a([n,i]),s}),{a:n,b:i},(function(o,a){var s=a[0],u=a[1];return{a:function(){return hn(s)},b:function(){return hn(u)}}}),"GreaterEqual")}}),_7=oe({greaterEqualStrict_:function(r,e){var t=X(r,"a","greaterEqualStrict"),n=X(e,"b","greaterEqualStrict");return En(t.shape,n.shape,"Error in greaterEqualStrict: "),t.greaterEqual(n)}}),x7=oe({greaterStrict_:function(r,e){var t=X(r,"a","greaterStrict"),n=X(e,"b","greaterStrict");return En(t.shape,n.shape,"Error in greaterStrict: "),t.greater(n)}}),S7=oe({less_:function(r,e){var t,n=X(r,"a","less"),i=X(e,"b","less");return t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape),le.runKernelFunc((function(o){return o.less(n,i)}),{a:n,b:i},null,"Less")}}),E7=oe({lessEqual_:function(r,e){var t,n=X(r,"a","lessEqual"),i=X(e,"b","lessEqual");return t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape),le.runKernelFunc((function(o,a){var s=o.lessEqual(n,i);return a([n,i]),s}),{a:n,b:i},null,"LessEqual")}}),k7=oe({lessEqualStrict_:function(r,e){var t=X(r,"a","lessEqualStrict"),n=X(e,"b","lessEqualStrict");return En(t.shape,n.shape,"Error in lessEqualStrict: "),t.lessEqual(n)}}),C7=oe({lessStrict_:function(r,e){var t=X(r,"a","lessStrict"),n=X(e,"b","lessStrict");return En(t.shape,n.shape,"Error in lessStrict: "),t.less(n)}}),T7=oe({notEqual_:function(r,e){var t,n=X(r,"a","notEqual"),i=X(e,"b","notEqual");return t=Gn(n,i),n=t[0],i=t[1],on(n.shape,i.shape),le.runKernelFunc((function(o){return o.notEqual(n,i)}),{a:n,b:i},null,"NotEqual")}}),M7=oe({notEqualStrict_:function(r,e){var t=X(r,"a","notEqualStrict"),n=X(e,"b","notEqualStrict");return En(t.shape,n.shape,"Error in notEqualStrict: "),t.notEqual(n)}});function bE(r,e){for(var t=[],n=r;n<e;++n)t.push(n);return t}function wE(r){for(var e=[],t=0;t<r.length;++t)for(var n=0;n<r[t].length;++n)e.push(r[t][n]);return e}var Kw=oe({gather_:function(r,e,t){t===void 0&&(t=0);var n=X(r,"x","gather"),i=X(e,"indices","gather","int32");t=dr(t,n.shape)[0];var o=(function(a,s,u){for(var l=a.shape[u],c=[],h=1,f=1,m=0;m<u;m++)c.push(a.shape[m]),h*=a.shape[m];for(m=0;m<s.rank;m++)c.push(s.shape[m]);for(m=u+1;m<a.rank;m++)c.push(a.shape[m]),f*=a.shape[m];return{batchSize:h,sliceSize:f,dimSize:l,outputShape:c}})(n,i,t);return le.runKernelFunc((function(a,s){var u=a.gather(n,i.flatten(),t);return s([i]),u}),{x:n,indices:i},(function(a,s){var u=s[0];return{x:function(){var l=n.shape,c=u.size,h=l.slice(0,t),f=h.length,m=l.slice(t,l.length).slice(1),g=m.length,w=bE(0,f),v=bE(f+1,f+1+g),y=wE([h,[c],m]),x=a.reshape(y),E=u.reshape([c]),_=wE([[f],w,v]),k=x.transpose(_),C=mM(k,E,n.shape[t]),R=Lw(_);return C=C.transpose(R)},indices:function(){return u}}}),"Gather",{axis:t}).reshape(o.outputShape)}}),mM=oe({unsortedSegmentSum_:function(r,e,t){var n=X(r,"x","unsortedSegmentSum"),i=X(e,"segmentIds","unsortedSegmentSum","int32");return K(Jn(t),(function(){return"numSegments must be of dtype int"})),le.runKernelFunc((function(o,a){var s=o.unsortedSegmentSum(n,i,t);return a([i]),s}),{$x:n},(function(o,a){var s=a[0];return{$x:function(){return(function(u,l){for(var c=zw(l,hn(l)),h=Kw(u,c),f=pM(l,Ct(0,"int32")),m=h.rank-f.rank,g=0;g<m;++g)f=Ws(f,g+1);f=hg(f,Jc(h.shape,"bool"));var w=hn(h);return il(f,h,w)})(o,s)}}}))}}),A7=function(r,e,t){return wt(this,void 0,void 0,(function(){var n,i,o,a,s,u,l,c,h,f,m,g,w;return _t(this,(function(v){switch(v.label){case 0:for(n=X(r,"tensor","boolMask"),i=X(e,"mask","boolMask","bool"),o=t??0,a=i.rank,s=n.shape,K(a>0,(function(){return"mask cannot be scalar"})),En(s.slice(o,o+a),i.shape,"mask's shape must match the first K dimensions of tensor's shape,"),u=1,l=o;l<o+a;l++)u*=s[l];return c=s.slice(0,o).concat([u],s.slice(o+a)),h=n.reshape(c),f=i.reshape([-1]),[4,sM(f)];case 1:return m=v.sent(),g=m.squeeze([1]),w=Kw(h,g,o),r!==n&&n.dispose(),e!==i&&i.dispose(),g.dispose(),h.dispose(),f.dispose(),m.dispose(),[2,w]}}))}))};function gM(r,e,t,n,i,o,a){o===void 0&&(o="NHWC"),K(r.length===e.rank,(function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"}));var s=r,u=e,l=!1;e.rank===3&&(l=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,r[0],r[1],r[2]]),K(s.length===4,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),K(u.rank===4,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),K(t.rank===4,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+t.rank}));var c=o==="NHWC"?s[3]:s[1],h=o==="NHWC"?u.shape[3]:u.shape[1];K(c===t.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+c+") must match input depth for filter "+t.shape[2]+"."})),K(h===t.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+t.shape[3]+"."})),a!=null&&K(Jn(i),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var f=Hw(o),m=cl(s,t.shape,n,1,i,a,!1,f),g=le.runKernelFunc((function(w,v){var y=w.conv2dDerInput(u,t,m);return v([t,u]),y}),{dy4D:u,filter:t},(function(w,v){var y=v[0],x=v[1];return{dy4D:function(){return dl(w,y,n,i,o,1,a)},filter:function(){return Jw(w,x,y.shape,n,i,o,a)}}}));return l?g.as3D(g.shape[1],g.shape[2],g.shape[3]):g}function Jy(r){var e=(function(o){return typeof o=="number"?[o,o,o]:o.length===2?[o[0],o[1],1]:o})(r),t=e[0],n=e[1],i=e[2];return t===1&&n===1&&i===1}function vM(r,e,t,n,i){K(r.length===e.rank,(function(){return"Length of inShape ("+r.length+") and rank of dy ("+e.rank+") must match"}));var o=r,a=e,s=!1;e.rank===4&&(s=!0,a=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),o=[1,r[0],r[1],r[2],r[3]]);var u=o[4],l=a.shape[4];K(o.length===5,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+o.length+"."})),K(a.rank===5,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+a.rank})),K(t.rank===5,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+t.rank})),K(u===t.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+t.shape[3]+"."})),K(l===t.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+l+") must match output depth for filter "+t.shape[4]+"."}));var c=Om(o,t.shape,n,1,i),h=le.runKernelFunc((function(f){return f.conv3dDerInput(a,t,c)}),{dy5D:a});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var R7=oe({conv1d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NWC"),o===void 0&&(o=1);var s=X(r,"x","conv1d"),u=X(e,"filter","conv1d"),l=s,c=!1;s.rank===2&&(c=!0,l=s.as3D(1,s.shape[0],s.shape[1])),K(l.rank===3,(function(){return"Error in conv1d: input must be rank 3, but got rank "+l.rank+"."})),K(u.rank===3,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),a!=null&&K(Jn(n),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."})),K(l.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+l.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),K(ri(t,o),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+t+" and dilation '"+o+"'"})),K(i==="NWC",(function(){return"Error in conv1d: got dataFormat of "+i+" but only NWC is currently supported."}));var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),f=l.as4D(l.shape[0],1,l.shape[1],l.shape[2]),m=dl(f,h,[1,t],n,"NHWC",[1,o],a);return c?m.as2D(m.shape[2],m.shape[3]):m.as3D(m.shape[0],m.shape[2],m.shape[3])}}),dl=oe({conv2d_:function(r,e,t,n,i,o,a){i===void 0&&(i="NHWC"),o===void 0&&(o=[1,1]);var s=X(r,"x","conv2d"),u=X(e,"filter","conv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),K(l.rank===4,(function(){return"Error in conv2d: input must be rank 4, but got rank "+l.rank+"."})),K(u.rank===4,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),a!=null&&K(Jn(n),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}));var h=i==="NHWC"?l.shape[3]:l.shape[1];K(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),K(ri(t,o),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"}));var f=Hw(i),m=cl(l.shape,u.shape,t,o,n,a,!1,f),g=[u,l],w=le.runKernelFunc((function(v,y){var x=v.conv2d(l,u,m);return y([u,l]),x}),{x:l,filter:u},(function(v,y){var x=y,E=x[0],_=x[1];return K(zc(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"})),{x:function(){return yM(_.shape,v,E,t,n,i)},filter:function(){return Jw(_,v,E.shape,t,n,i)}}}),"Conv2D",m,g);return c?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),I7=oe({conv3d_:function(r,e,t,n,i,o){i===void 0&&(i="NDHWC"),o===void 0&&(o=[1,1,1]);var a=X(r,"x","conv3d"),s=X(e,"filter","conv3d"),u=a,l=!1;a.rank===4&&(l=!0,u=a.as5D(1,a.shape[0],a.shape[1],a.shape[2],a.shape[3])),K(u.rank===5,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),K(s.rank===5,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),K(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),K((function(f,m){return Jy(f)||Jy(m)})(t,o),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),K(i==="NDHWC",(function(){return"Error in conv3d: got dataFormat of "+i+" but only NDHWC is currently supported."}));var c=Om(u.shape,s.shape,t,o,n),h=le.runKernelFunc((function(f,m){var g=f.conv3d(u,s,c);return m([u,s]),g}),{x:u,$filter:s},(function(f,m){K(Jy(o),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+o+"'"}));var g=m[0],w=m[1];return{x:function(){return vM(g.shape,f,w,t,n)},$filter:function(){return(function(v,y,x,E,_){var k=v;v.rank===4&&(k=v.as5D(1,v.shape[0],v.shape[1],v.shape[2],v.shape[3]));var C=y;C.rank===4&&(C=y.as5D(1,y.shape[0],y.shape[1],y.shape[2],y.shape[3])),K(k.rank===5,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+k.shape+"."})),K(C.rank===5,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+C.shape+"."})),K(x.length===5,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+x+"."})),K(k.shape[4]===x[3],(function(){return"Error in conv3dDerFilter: depth of input "+k.shape[4]+") must match input depth in filter ("+x[3]+"."})),K(C.shape[4]===x[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+C.shape[4]+") must match output depth for filter ("+x[4]+")."}));var R=Om(k.shape,x,E,1,_);return le.runKernelFunc((function(I){return I.conv3dDerFilter(k,C,R)}),{x5D:k,dy5D:C})})(g,f,w.shape,t,n)}}}));return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Jw=oe({conv2dDerFilter_:function(r,e,t,n,i,o,a){o===void 0&&(o="NHWC");var s=r;r.rank===3&&(s=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var u=e;u.rank===3&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),K(s.rank===4,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),K(u.rank===4,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),K(t.length===4,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+t+"."}));var l=o==="NHWC"?s.shape[3]:s.shape[1],c=o==="NHWC"?u.shape[3]:u.shape[1];K(l===t[2],(function(){return"Error in conv2dDerFilter: depth of input "+l+") must match input depth in filter ("+t[2]+"."})),K(c===t[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+c+") must match output depth for filter ("+t[3]+")."})),a!=null&&K(Jn(i),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+i+"."}));var h=Hw(o),f=cl(s.shape,t,n,1,i,a,!1,h);return le.runKernelFunc((function(m){return m.conv2dDerFilter(s,u,f)}),{x4D:s,dy4D:u})}}),yM=oe({conv2dDerInput_:gM}),Zw=oe({depthwiseConv2d_:function(r,e,t,n,i,o,a){o===void 0&&(o=[1,1]);var s=X(r,"x","depthwiseConv2d"),u=X(e,"filter","depthwiseConv2d"),l=s,c=!1;s.rank===3&&(c=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),K(l.rank===4,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+l.rank+"."})),K(u.rank===4,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),K(l.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+l.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),o==null&&(o=[1,1]),K(ri(t,o),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+o+"'"})),a!=null&&K(Jn(n),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+n+"."}));var h=cl(l.shape,u.shape,t,o,n,a,!0),f=[l,u],m=le.runKernelFunc((function(g,w){var v=g.depthwiseConv2D(l,u,h);return w([l,u]),v}),{x:l,filter:u},(function(g,w){K(zc(o),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+o+"'"}));var v=w[0],y=w[1];return{x:function(){return bM(v.shape,g,y,h)},filter:function(){return wM(v,g,y.shape,h)}}}),"DepthwiseConv2dNative",h,f);return c?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),bM=oe({depthwiseConv2dDerInput_:function(r,e,t,n){var i=e,o=!1;e.rank===3&&(o=!0,i=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var a=le.runKernelFunc((function(s){return s.depthwiseConv2DDerInput(i,t,n)}),{dy4D:i});return o?a.as3D(a.shape[1],a.shape[2],a.shape[3]):a}}),wM=oe({depthwiseConv2dDerFilter_:function(r,e,t,n){var i=r;r.rank===3&&(i=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var o=e;return o.rank===3&&(o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),le.runKernelFunc((function(a){return a.depthwiseConv2DDerFilter(i,o,n)}),{x4D:i,dy4D:o})}}),_M=oe({separableConv2d_:function(r,e,t,n,i,o,a){o===void 0&&(o=[1,1]),a===void 0&&(a="NHWC");var s=X(r,"x","separableConv2d"),u=X(e,"depthwiseFilter","separableConv2d"),l=X(t,"pointwiseFilter","separableConv2d"),c=s,h=!1;if(s.rank===3&&(h=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),a==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");K(c.rank===4,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+c.rank+"."})),K(u.rank===4,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),K(l.rank===4,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),K(l.shape[0]===1,(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+l.shape[0]+"."})),K(l.shape[1]===1,(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+l.shape[1]+"."}));var f=u.shape[2],m=u.shape[3];K(l.shape[2]===f*m,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+f*m+", but got "+l.shape[2]+"."}));var g=Zw(c,u,n,i,a,o),w=dl(g,l,1,"valid",a);return h?w.as3D(w.shape[1],w.shape[2],w.shape[3]):w}}),D7=oe({conv2dTranspose_:function(r,e,t,n,i,o){return gM(t,X(r,"x","conv2dTranspose"),X(e,"filter","conv2dTranspose"),n,i,"NHWC",o)}}),N7=oe({conv3dTranspose_:function(r,e,t,n,i){return vM(t,X(r,"x","conv3dTranspose"),X(e,"filter","conv3dTranspose"),n,i)}}),xM=oe({matMul_:function(r,e,t,n){var i;t===void 0&&(t=!1),n===void 0&&(n=!1);var o=X(r,"a","matMul"),a=X(e,"b","matMul");i=Gn(o,a),o=i[0],a=i[1];var s=t?o.shape[o.rank-2]:o.shape[o.rank-1],u=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=t?o.shape[o.rank-1]:o.shape[o.rank-2],c=n?a.shape[a.rank-2]:a.shape[a.rank-1],h=o.shape.slice(0,-2),f=a.shape.slice(0,-2),m=bt(h),g=bt(f);K(o.rank>=2&&a.rank>=2&&o.rank===a.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+o.rank+" and "+a.rank+"."})),K(wr(h,f),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+f+") of Tensors with shapes "+o.shape+" and "+a.shape+" must match."})),K(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+o.shape+" and "+a.shape+" and transposeA="+t+" and transposeB="+n+" must match."}));var w=o.shape.slice(0,-2).concat([l,c]),v=t?o.as3D(m,s,l):o.as3D(m,l,s),y=n?a.as3D(g,c,u):a.as3D(g,u,c),x={transposeA:t,transposeB:n};return le.runKernelFunc((function(E,_){var k=E.batchMatMul(v,y,t,n);return _([v,y]),k}),{a:v,b:y},(function(E,_){var k=_,C=k[0],R=k[1];return t||n?!t&&n?{a:function(){return E.matMul(R,!1,!1)},b:function(){return E.matMul(C,!0,!1)}}:t&&!n?{a:function(){return R.matMul(E,!1,!0)},b:function(){return C.matMul(E,!1,!1)}}:{a:function(){return R.matMul(E,!0,!0)},b:function(){return E.matMul(C,!0,!0)}}:{a:function(){return E.matMul(R,!1,!0)},b:function(){return C.matMul(E,!0,!1)}}}),"BatchMatMul",x).reshape(w)}}),P7=oe({dot_:function(r,e){var t=X(r,"t1","dot"),n=X(e,"t2","dot");K(!(t.rank!==1&&t.rank!==2||n.rank!==1&&n.rank!==2),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+t.rank+" and "+n.rank+"."}));var i=t.rank===1?t.size:t.shape[1],o=n.rank===1?n.size:n.shape[0];return K(i===o,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+i+" and "+o+"."})),t.rank===1&&n.rank===1?t.as2D(1,-1).matMul(n.as2D(-1,1)).asScalar():t.rank===1&&n.rank===2?t.as2D(1,-1).matMul(n.as2D(n.shape[0],n.shape[1])).as1D():t.rank===2&&n.rank===1?t.matMul(n.as2D(-1,1)).as1D():t.matMul(n.as2D(n.shape[0],n.shape[1]))}}),F7=oe({outerProduct_:function(r,e){var t=X(r,"v1","outerProduct"),n=X(e,"v2","outerProduct");return K(t.rank===1&&n.rank===1,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+t.rank+" and "+n.rank+"."})),t.as2D(-1,1).matMul(n.as2D(1,-1))}}),Rd=oe({reverse_:function(r,e){var t=X(r,"x","reverse");if(t.rank===0)return t.clone();var n=dr(e,t.shape);return le.runKernelFunc((function(i){return i.reverse(t,n)}),{$x:t},(function(i){return{$x:function(){return i.reverse(n)}}})).reshapeAs(t)}}),O7=oe({reverse1d_:function(r){var e=X(r,"x","reverse");return K(e.rank===1,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),Rd(e,0)}}),L7=oe({reverse2d_:function(r,e){var t=X(r,"x","reverse");return K(t.rank===2,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+t.rank+"."})),Rd(t,e)}}),B7=oe({reverse3d_:function(r,e){var t=X(r,"x","reverse");return K(t.rank===3,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+t.rank+"."})),Rd(t,e)}}),U7=oe({reverse4d_:function(r,e){var t=X(r,"x","reverse");return K(t.rank===4,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+t.rank+"."})),Rd(t,e)}});function SM(r,e,t,n,i,o){var a=X(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),K(s.rank===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),K(ri(t,n),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"})),o!=null&&K(Jn(i),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var l=rl(s.shape,e,t,n,i,o);if(l.filterWidth===1&&l.filterHeight===1&&wr(l.inShape,l.outShape))return a.clone();var c=[s],h=le.runKernelFunc((function(f,m){var g=f.maxPool(s,l);return m([s,g]),g}),{x:s},(function(f,m){var g=m[0],w=m[1];return{x:function(){return(function(v,y,x,E,_,k,C,R){var I=X(v,"dy","maxPoolBackprop"),T=X(y,"input","maxPoolBackprop"),A=X(x,"output","maxPoolBackprop");K(T.rank===I.rank,(function(){return"Rank of input ("+T.rank+") does not match rank of dy ("+I.rank+")"})),K(ri(_,k),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+k+"'"})),K(I.rank===4,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+I.rank+"."})),K(T.rank===4,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+T.rank+"."}));var N=rl(T.shape,E,_,k,C,R);return le.runKernelFunc((function(O){return O.maxPoolBackprop(I,T,A,N)}),{$dy:I,$input:T})})(f,g,w,e,t,n,i)}}}),"MaxPool",l,c);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function EM(r,e,t,n,i,o){var a=X(r,"x","avgPool","float32");K(ri(t,n),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+n+"'"}));var s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),K(s.rank===4,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),o!=null&&K(Jn(i),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+i+"."}));var l=rl(s.shape,e,t,n,i,o);if(l.filterWidth===1&&l.filterHeight===1&&wr(l.inShape,l.outShape))return a.clone();var c=le.runKernelFunc((function(h){return h.avgPool(s,l)}),{x:s},(function(h){return{x:function(){return(function(f,m,g,w,v,y){var x=X(f,"dy","avgPoolBackprop"),E=X(m,"input","avgPoolBackprop");K(E.rank===x.rank,(function(){return"Rank of input ("+E.rank+") does not match rank of dy ("+x.rank+")"})),K(ri(w,v),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+w+" and dilations '"+v+"'"}));var _=E,k=x,C=!1;E.rank===3&&(C=!0,_=E.as4D(1,E.shape[0],E.shape[1],E.shape[2]),k=x.as4D(1,x.shape[0],x.shape[1],x.shape[2])),K(k.rank===4,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+k.rank+"."})),K(_.rank===4,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+_.rank+"."}));var R=rl(_.shape,g,w,v,y),I=le.runKernelFunc((function(T){return T.avgPoolBackprop(k,_,R)}),{dy4D:k,input4D:_});return C?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I})(h,s,e,t,n,i)}}}),"AvgPool",l);return c=c.cast(a.dtype),u?c.as3D(c.shape[1],c.shape[2],c.shape[3]):c}var Ri=oe({maxPool_:function(r,e,t,n,i){return SM(r,e,t,1,n,i)}}),z7=oe({avgPool_:function(r,e,t,n,i){return EM(r,e,t,1,n,i)}}),W7=oe({pool_:function(r,e,t,n,i,o){i==null&&(i=[1,1]),o==null&&(o=1),n===0&&(n="valid");var a=X(r,"x","maxPool"),s=a,u=!1;a.rank===3&&(u=!0,s=a.as4D(1,a.shape[0],a.shape[1],a.shape[2])),K(ri(o,i),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+i+"'"}));var l,c=rl(s.shape,e,o,i,n),h=[c.dilationHeight,c.dilationWidth];l=n==="same"?(function(_,k){var C=_.map((function(T,A){return T+(T-1)*(k[A]-1)})).map((function(T){return T-1})),R=C.map((function(T){return Math.floor(T/2)})),I=C.map((function(T,A){return T-R[A]}));return C.map((function(T,A){return[R[A],I[A]]}))})([c.filterHeight,c.filterWidth],h):[[0,0],[0,0]];var f=h[0]===1&&h[1]===1,m=(function(_,k,C){var R=C.map((function(F){return F[0]})),I=C.map((function(F){return F[1]})),T=_.concat(R,I),A=k.map((function(F,B){return(F-T[B]%F)%F})),N=I.map((function(F,B){return F+A[B]})),O=k.map((function(F,B){return[R[B],N[B]]})),V=k.map((function(F,B){return[0,A[B]]}));return[O,V]})([c.inHeight,c.inWidth],h,l),g=m[0],w=m[1],v=f?n:"valid",y=f?s:v3(s,h,g),x=(t==="avg"?function(){return EM(y,e,o,1,v)}:function(){return SM(y,e,o,1,v)})(),E=f?x:g3(x,h,w);return u?E.as3D(E.shape[1],E.shape[2],E.shape[3]):E}}),H7=oe({maxPool3d_:function(r,e,t,n,i,o,a){o===void 0&&(o="NDHWC");var s=X(r,"x","maxPool3d"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),K(u.rank===5,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),K(o==="NDHWC",(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),K(ri(t,a),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),i!=null&&K(Jn(n),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."}));var c=Fm(u.shape,e,t,a,n,i,o),h=le.runKernelFunc((function(f,m){var g=f.maxPool3d(u,c);return m([u,g]),g}),{x:u},(function(f,m){var g=m[0],w=m[1];return{x:function(){return(function(v,y,x,E,_,k,C,R){var I=X(v,"dy","maxPool3dBackprop"),T=X(y,"input","maxPool3dBackprop"),A=X(x,"output","maxPool3dBackprop"),N=I,O=T,V=A,F=!1;T.rank===4&&(F=!0,N=I.as5D(1,I.shape[0],I.shape[1],I.shape[2],I.shape[3]),O=T.as5D(1,T.shape[0],T.shape[1],T.shape[2],T.shape[3]),V=A.as5D(1,A.shape[0],A.shape[1],A.shape[2],A.shape[3])),K(N.rank===5,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+N.rank+"."})),K(O.rank===5,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+O.rank+"."})),K(V.rank===5,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+V.rank+"."})),k==null&&(k=[1,1,1]),K(ri(_,k),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+_+" and dilations '"+k+"'"})),R!=null&&K(Jn(C),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+R+" but got pad "+C+"."}));var B=Fm(O.shape,E,_,k,C,R),U=le.runKernelFunc((function(P){return P.maxPool3dBackprop(N,O,V,B)}),{dy5D:N,input5D:O});return F?U.as4D(U.shape[1],U.shape[2],U.shape[3],U.shape[4]):U})(f,g,w,e,t,a,n,i)}}}));return l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),G7=oe({avgPool3d_:function(r,e,t,n,i,o,a){o===void 0&&(o="NDHWC");var s=X(r,"x","avgPool3d","float32"),u=s,l=!1;s.rank===4&&(l=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),a==null&&(a=[1,1,1]),K(u.rank===5,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),K(o==="NDHWC",(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+o})),K(ri(t,a),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+t+" and dilations '"+a+"'"})),i!=null&&K(Jn(n),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+n+"."}));var c=Fm(u.shape,e,t,a,n,i,o),h=le.runKernelFunc((function(f){return f.avgPool3d(u,c)}),{x:u},(function(f){return{x:function(){return(function(m,g,w,v,y,x,E){var _=X(m,"dy","avgPool3dBackprop"),k=X(g,"input","avgPool3dBackprop"),C=_,R=k,I=!1;k.rank===4&&(I=!0,C=_.as5D(1,_.shape[0],_.shape[1],_.shape[2],_.shape[3]),R=k.as5D(1,k.shape[0],k.shape[1],k.shape[2],k.shape[3])),K(C.rank===5,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+C.rank+"."})),K(R.rank===5,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+R.rank+"."})),y==null&&(y=[1,1,1]),K(ri(v,y),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+v+" and dilations '"+y+"'"})),E!=null&&K(Jn(x),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+E+" but got pad "+x+"."}));var T=Fm(R.shape,w,v,y,x,E),A=le.runKernelFunc((function(N){return N.avgPool3dBackprop(C,R,T)}),{dy5D:C,input5D:R});return I?A.as4D(A.shape[1],A.shape[2],A.shape[3],A.shape[4]):A})(f,u,e,t,a,n,i)}}}));return h=h.cast(u.dtype),l?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),V7=oe({maxPoolWithArgmax_:function(r,e,t,n,i){i===void 0&&(i=!1);var o=X(r,"x","maxPoolWithArgmax"),a={filterSize:e,strides:t,pad:n,includeBatchInIndex:i},s=le.runKernel("MaxPoolWithArgmax",{x:o},a);return{result:s[0],indexes:s[1]}}}),tu=oe({slice_:function(r,e,t){var n,i,o=X(r,"x","slice");if(o.rank===0)throw new Error("Slicing scalar is not possible");(n=typeof e=="number"?[e].concat(new Array(o.rank-1).fill(0)):e.length<o.rank?e.concat(new Array(o.rank-e.length).fill(0)):e.slice()).forEach((function(u){K(u!==-1,(function(){return"slice() does not support negative begin indexing."}))})),i=(i=t==null?new Array(o.rank).fill(-1):typeof t=="number"?[t].concat(new Array(o.rank-1).fill(-1)):t.length<o.rank?t.concat(new Array(o.rank-t.length).fill(-1)):t).map((function(u,l){return u>=0?u:(K(u===-1,(function(){return"Negative size values should be exactly -1 but got "+u+" for the slice() size at index "+l+"."})),o.shape[l]-n[l])})),z6(o,n,i);var a=o.shape,s={begin:n,size:i};return le.runKernelFunc((function(u){return u.slice(o,n,i)}),{x:o},(function(u){for(var l=[],c=0;c<u.rank;c++)l.push([n[c],a[c]-n[c]-i[c]]);return{x:function(){return ns(u,l)}}}),"Slice",s)}}),j7=oe({slice1d_:function(r,e,t){var n=X(r,"x","slice1d");return K(n.rank===1,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+n.rank+" tensor"})),tu(n,[e],[t])}}),q7=oe({slice2d_:function(r,e,t){var n=X(r,"x","slice2d");return K(n.rank===2,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+n.rank+" tensor"})),tu(n,e,t)}}),$7=oe({slice3d_:function(r,e,t){var n=X(r,"x","slice3d");return K(n.rank===3,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+n.rank+" tensor"})),tu(n,e,t)}}),X7=oe({slice4d_:function(r,e,t){var n=X(r,"x","slice4d");return K(n.rank===4,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+n.rank+" tensor"})),tu(n,e,t)}});function kM(r,e,t,n,i){return e.rank<t.rank&&(e=e.reshape(Si(e.shape,n))),r.rank<t.rank&&(r=r.reshape(Si(r.shape,n))),{x:function(){var o=r.mul(t.equal(e).cast(r.dtype));return i==null?o:o.transpose(i)}}}var Y7=oe({all_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","all","bool"),i=dr(e,n.shape),o=i,a=wa(o,n.rank);a!=null&&(n=n.transpose(a),o=_a(o.length,n.rank));var s=le.runKernelFunc((function(l){return l.all(n,o)}),{$x:n});if(t){var u=Si(s.shape,i);return s.reshape(u)}return s}}),K7=oe({any_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","any","bool"),i=dr(e,n.shape),o=i,a=wa(o,n.rank);a!=null&&(n=n.transpose(a),o=_a(o.length,n.rank));var s=le.runKernelFunc((function(l){return l.any(n,o)}),{$x:n});if(t){var u=Si(s.shape,i);return s.reshape(u)}return s}}),J7=oe({argMax_:function(r,e){e===void 0&&(e=0);var t=X(r,"x","argMax");e==null&&(e=0);var n=dr(e,t.shape),i=wa(n,t.rank);i!=null&&(t=t.transpose(i),n=_a(n.length,t.rank));var o={axis:n[0]},a=[t];return le.runKernelFunc((function(s,u){var l=s.argMax(t,n[0]);return u([t]),l}),{x:t},(function(s,u){var l=u[0];return{x:function(){return hn(l)}}}),"ArgMax",o,a)}}),Z7=oe({argMin_:function(r,e){e===void 0&&(e=0);var t=X(r,"x","argMin");e==null&&(e=0);var n=dr(e,t.shape),i=wa(n,t.rank);return i!=null&&(t=t.transpose(i),n=_a(n.length,t.rank)),le.runKernelFunc((function(o,a){var s=o.argMin(t,n[0]);return a([t]),s}),{$x:t},(function(o,a){var s=a[0];return{$x:function(){return hn(s)}}}))}}),Q7=oe({logSumExp_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","logSumExp"),i=dr(e,n.shape),o=n.max(i,!0),a=n.sub(o).exp().sum(i).log(),s=o.reshape(a.shape).add(a);if(t){var u=Si(s.shape,i);return s.reshape(u)}return s}}),e9=oe({max_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","max"),i=n,o=dr(e,n.shape),a=o,s=wa(a,n.rank);s!=null&&(n=n.transpose(s),a=_a(a.length,n.rank));var u=[n],l=le.runKernelFunc((function(h,f){var m=h.max(n,a);return f([i,m]),m}),{x:n},(function(h,f){return kM(h,f[1],f[0],o,s)}),"Max",{axes:a},u,[!0]);if(t){var c=Si(l.shape,o);l=l.reshape(c)}return l}}),t9=oe({mean_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","mean"),i=dr(e,n.shape),o=bt(Br(n.shape,i)[1]);return sg((function(a){var s=Ct(o);return{value:(s.dtype===a.dtype?a:a.cast(s.dtype)).div(s).sum(e,t),gradFunc:function(u){var l=a.shape.slice();return i.forEach((function(c){l[c]=1})),u.reshape(l).mul(Jc(a.shape,"float32")).div(o)}}}))(n)}}),n9=oe({min_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","min"),i=n,o=dr(e,n.shape),a=o,s=wa(a,n.rank);s!=null&&(n=n.transpose(s),a=_a(a.length,n.rank));var u=[n],l=le.runKernelFunc((function(h,f){var m=h.min(n,a);return f([i,m]),m}),{x:n},(function(h,f){return kM(h,f[1],f[0],o,s)}),"Min",{axes:a},u,[!0]);if(t){var c=Si(l.shape,o);l=l.reshape(c)}return l}}),r9=oe({moments_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=dr(e,(r=X(r,"x","moments")).shape),i=r.mean(n,t),o=i.shape;t||(o=Si(i.shape,n));var a=r.toFloat().sub(i.reshape(o)).square();return{mean:i,variance:a.mean(n,t)}}}),Hs=oe({sum_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","sum");n.dtype==="bool"&&(n=n.toInt());var i=dr(e,n.shape);return sg((function(o){var a=wa(i,o.rank),s=i,u=o;a!=null&&(u=o.transpose(a),s=_a(s.length,o.rank));var l=function(m){var g=o.shape.slice();return i.forEach((function(w){g[w]=1})),m.reshape(g).mul(Jc(o.shape,"float32"))},c={axes:s},h=le.runKernelFunc((function(m){return m.sum(u,s)}),{x:u},(function(m){return{x:function(){return l(m)}}}),"Sum",c);if(t){var f=Si(h.shape,i);h=h.reshape(f)}return{value:h,gradFunc:l}}))(n)}}),i9=oe({prod_:function(r,e,t){e===void 0&&(e=null),t===void 0&&(t=!1);var n=X(r,"x","prod");n.dtype==="bool"&&(n=n.toInt());var i=dr(e,n.shape),o=wa(i,n.rank),a=i,s=n;o!=null&&(s=n.transpose(o),a=_a(a.length,n.rank));var u=le.runKernelFunc((function(c){return c.prod(s,a)}),{permutedX:s});if(t){var l=Si(u.shape,i);u=u.reshape(l)}return u}}),CM=oe({elu_:function(r){var e=X(r,"x","elu");return le.runKernelFunc((function(t,n){var i=t.elu(e);return n([i]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){return le.runKernelFunc((function(o){return o.eluDer(t,i)}),{dy:t,y:i})}}}))}}),o9=oe({leakyRelu_:function(r,e){e===void 0&&(e=.2);var t=X(r,"x","leakyRelu");return zw(Ct(e).mul(t),t)}}),TM=oe({prelu_:function(r,e){var t=X(r,"x","prelu"),n=X(e,"alpha","prelu");return le.runKernelFunc((function(i,o){var a=i.prelu(t,n);return o([t,n]),a}),{x:t,alpha:n},(function(i,o){var a=o[0],s=o[1],u=a.greater(0);return{x:function(){return il(u,i,i.mul(s))},alpha:function(){var l=il(u,hn(i),i.mul(a)),c=ar(s.shape,i.shape);return c.length>0&&(l=l.sum(c)),l.reshape(s.shape)}}}),"Prelu")}}),dg=oe({relu_:function(r){var e=X(r,"x","relu");return e.dtype==="bool"?e.toInt():le.runKernelFunc((function(t,n){var i=t.relu(e);return n([e]),i}),{x:e},(function(t,n){var i=n[0];return{x:function(){return t.mulStrict(i.step().toFloat())}}}),"Relu")}}),MM=oe({relu6_:function(r){var e=X(r,"x","relu6");return e.dtype==="bool"?e.toInt():le.runKernelFunc((function(t,n){var i=t.relu6(e);return n([e]),i}),{x:e},(function(t,n){var i=n[0],o=i.lessEqual(6).mul(i.step());return{x:function(){return t.mulStrict(o.toFloat())}}}),"Relu6")}}),a9=oe({selu_:function(r){var e=X(r,"x","selu");return le.runKernelFunc((function(t,n){var i=t.selu(e);return n([e]),i}),{$x:e},(function(t,n){var i=n[0];return{$x:function(){var o=i.greater(Ct(0)),a=Ct($w),s=Ct(Xw),u=t.mul(s),l=t.mul(a).mul(i.toFloat().exp());return il(o,u,l)}}}))}}),s9=oe({localResponseNormalization_:function(r,e,t,n,i){e===void 0&&(e=5),t===void 0&&(t=1),n===void 0&&(n=1),i===void 0&&(i=.5);var o=X(r,"x","localResponseNormalization");K(o.rank===4||o.rank===3,(function(){return`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank `+o.rank+"."})),K(Jn(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var a=o,s=!1;o.rank===3&&(s=!0,a=o.as4D(1,o.shape[0],o.shape[1],o.shape[2]));var u=le.runKernelFunc((function(l,c){var h=l.localResponseNormalization4D(a,e,t,n,i);return c([a,h]),h}),{x4D:a},(function(l,c){var h=c[0],f=c[1];return{x4D:function(){return le.runKernelFunc((function(m){return m.LRNGrad(l,h,f,e,t,n,i)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),AM=oe({norm_:function(r,e,t,n){e===void 0&&(e="euclidean"),t===void 0&&(t=null),n===void 0&&(n=!1);var i=(function s(u,l,c){if(c===void 0&&(c=null),u.rank===0)return u.abs();if(u.rank!==1&&c===null)return s(u.reshape([-1]),l,c);if(u.rank===1||typeof c=="number"||Array.isArray(c)&&c.length===1){if(l===1)return u.abs().sum(c);if(l===1/0)return u.abs().max(c);if(l===-1/0)return u.abs().min(c);if(l==="euclidean"||l===2)return u.abs().pow(Ct(2,"int32")).sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}if(Array.isArray(c)&&c.length===2){if(l===1)return u.abs().sum(c[0]).max(c[1]-1);if(l===1/0)return u.abs().sum(c[1]).max(c[0]);if(l===-1/0)return u.abs().sum(c[1]).min(c[0]);if(l==="fro"||l==="euclidean")return u.square().sum(c).sqrt();throw new Error("Error in norm: invalid ord value: "+l)}throw new Error("Error in norm: invalid axis: "+c)})(r=X(r,"x","norm"),e,t),o=i.shape;if(n){var a=dr(t,r.shape);o=Si(i.shape,a)}return i.reshape(o)}}),u9=oe({basicLSTMCell_:function(r,e,t,n,i,o){var a=X(r,"forgetBias","basicLSTMCell"),s=X(e,"lstmKernel","basicLSTMCell"),u=X(t,"lstmBias","basicLSTMCell"),l=X(n,"data","basicLSTMCell"),c=X(i,"c","basicLSTMCell"),h=X(o,"h","basicLSTMCell"),f=l.concat(h,1).matMul(s).add(u),m=f.shape[0],g=f.shape[1]/4,w=[m,g],v=f.slice([0,0],w),y=f.slice([0,g],w),x=f.slice([0,2*g],w),E=f.slice([0,3*g],w),_=v.sigmoid().mulStrict(y.tanh()).addStrict(c.mulStrict(a.add(x).sigmoid())),k=_.tanh().mulStrict(E.sigmoid());return[_,k]}}),l9=oe({multiRNNCell_:function(r,e,t,n){for(var i=X(e,"data","multiRNNCell"),o=Mm(t,"c","multiRNNCell"),a=Mm(n,"h","multiRNNCell"),s=i,u=[],l=0;l<r.length;l++){var c=r[l](s,o[l],a[l]);u.push(c[0]),u.push(c[1]),s=c[1]}var h=[],f=[];for(l=0;l<u.length;l+=2)h.push(u[l]),f.push(u[l+1]);return[h,f]}}),c9=oe({movingAverage_:function(r,e,t,n,i){i===void 0&&(i=!0);var o=X(r,"v","movingAverage"),a=X(e,"x","movingAverage"),s=X(t,"decay","movingAverage");rB(o,a),K(wr(o.shape,a.shape),(function(){return"Shape mismatch in v and x"}));var u=Ct(1),l=u.sub(s),c=a.sub(o).mul(l);if(i){K(n!=null,(function(){return"When using zeroDebias: true, step is required."}));var h=X(n,"step","movingAverage");c=c.div(u.sub(Nm(s,h)))}return o.add(c)}}),h9=oe({stridedSlice_:function(r,e,t,n,i,o,a,s,u){if(i===void 0&&(i=0),o===void 0&&(o=0),a===void 0&&(a=0),s===void 0&&(s=0),u===void 0&&(u=0),n==null&&(n=new Array(e.length)),a!==0)throw new Error("ellipsis mask is not yet supported");var l=X(r,"x","stridedSlice"),c=QS(s),h=l.shape.slice();c.forEach((function(v){e[v]=0,t[v]=1,h.splice(v,0,1)})),l=l.reshape(h);for(var f=0;f<l.rank;f++)e[f]=W6(i,e,n,l.shape,f),t[f]=H6(o,t,n,l.shape,f),n[f]=n[f]||1;var m=QS(u);m.forEach((function(v){t[v]=e[v]+1,n[v]=1}));var g=Ww(e,t,n),w=g.filter((function(v,y){return m.indexOf(y)===-1}));return n.every((function(v){return v===1}))?tu(l,e,g).reshape(w):le.runKernelFunc((function(v){return v.stridedSlice(l,e,t,n)}),{$x:l}).reshape(w)}}),d9=oe({topk_:function(r,e,t){e===void 0&&(e=1),t===void 0&&(t=!0);var n=X(r,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");var i=n.shape[n.shape.length-1];if(e>i)throw new Error("'k' passed to topk() must be <= the last dimension ("+i+") but got "+e);var o=le.runKernelFunc((function(a){return a.topk(n,e,t)}),{$x:n});return{values:o[0],indices:o[1]}}}),f9=oe({scatterND_:function(r,e,t){var n=X(r,"indices","scatterND","int32"),i=X(e,"updates","scatterND");return U6(i,n,t),le.runKernelFunc((function(o){return o.scatterND(n,i,t)}),{indices:n,updates:i},null,"ScatterNd",{shape:t})}}),Qw=oe({fft_:function(r){K(r.dtype==="complex64",(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+r.dtype+"."}));var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return le.runKernelFunc((function(i){return i.fft(n)}),{input:r}).reshape(r.shape)}}),Um=oe({ifft_:function(r){K(r.dtype==="complex64",(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+r.dtype+"."}));var e=r.shape[r.shape.length-1],t=r.size/e,n=r.as2D(t,e);return le.runKernelFunc((function(i){return i.ifft(n)}),{input:r}).reshape(r.shape)}}),e1=oe({rfft_:function(r,e){K(r.dtype==="float32",(function(){return"The dtype for rfft() must be real value but got "+r.dtype}));var t,n=r.shape[r.shape.length-1],i=r.size/n;if(e!=null&&e<n){var o=r.shape.map((function(y){return 0})),a=r.shape.map((function(y){return y}));a[r.shape.length-1]=e,t=r.slice(o,a),n=e}else if(e!=null&&e>n){var s=r.shape.map((function(y){return y}));s[r.shape.length-1]=e-n,t=r.concat(Xn(s),r.shape.length-1),n=e}else t=r;var u=t.zerosLike(),l=Er(t,u).as2D(i,n),c=Qw(l),h=Math.floor(n/2)+1,f=no(c),m=aa(c),g=f.split([h,n-h],f.shape.length-1),w=m.split([h,n-h],m.shape.length-1),v=t.shape.slice();return v[t.shape.length-1]=h,Er(g[0],w[0]).reshape(v)}}),RM=oe({irfft_:function(r){var e=r.shape[r.shape.length-1],t=r.size/e;if(e<=2){var n=r.as2D(t,e),i=Um(n);return no(i)}var o=[t,2*(e-1)],a=no(r).as2D(t,e),s=aa(r).as2D(t,e),u=a.slice([0,1],[t,e-2]).reverse(1),l=s.slice([0,1],[t,e-2]).reverse(1).mul(Ct(-1)),c=a.concat(u,1),h=s.concat(l,1);return n=Er(c,h).as2D(o[0],o[1]),i=Um(n),no(i)}}),p9=Object.freeze({fft:Qw,ifft:Um,rfft:e1,irfft:RM}),m9=oe({sparseToDense_:function(r,e,t,n){n===void 0&&(n=0);var i=X(r,"sparseIndices","sparseToDense","int32"),o=X(e,"sparseValues","sparseToDense"),a=X(n,"defaultValue","sparseToDense",o.dtype);return(function(s,u,l,c){if(s.dtype!=="int32")throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+s.dtype+".");if(s.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+s.shape+".");var h=s.rank>0?s.shape[0]:1,f=s.rank>1?s.shape[1]:1;if(l.length!==f)throw new Error("outputShape has incorrect number of elements:, "+l.length+", should be: "+f+".");var m=u.size;if(u.rank!==0&&(u.rank!==1||m!==h))throw new Error("sparseValues has incorrect shape "+u.shape+", should be [] or ["+h+"]");if(u.dtype!==c.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")})(i,o,t,a),le.runKernelFunc((function(s){return s.sparseToDense(i,o,t,a)}),{$sparseIndices:i,$sparseValues:o,$defaultValue:a})}}),g9=oe({gatherND_:function(r,e){var t=X(e,"indices","gatherND","int32"),n=X(r,"x","gatherND");return le.runKernelFunc((function(i){return i.gatherND(n,t)}),{x:n,indices:t},null,"GatherNd")}}),v9=oe({diag_:function(r){var e=X(r,"x","diag").flatten(),t=r.shape.concat(r.shape);return le.runKernelFunc((function(n){return n.diag(e)}),{$x:e}).reshape(t)}}),y9=oe({dropout_:function(r,e,t,n){var i=X(r,"x","dropout");if(K(i.dtype==="float32",(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+i.dtype+" tensor instead."})),K(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),e===0)return r instanceof Nn?i.clone():i;var o=(function(u,l){if(l==null)return u.shape.slice();if(wr(u.shape,l))return l;if(u.shape.length===l.length){for(var c=[],h=0;h<u.shape.length;h++)l[h]==null&&u.shape[h]!=null?c.push(u.shape[h]):c.push(l[h]);return c}return l})(i,t),a=1-e,s=cM(o,0,1,"float32",n).add(a).floor().div(a);return i.mul(s)}});function IM(r,e,t){for(var n=1-r%2,i=new Float32Array(r),o=0;o<r;++o){var a=2*Math.PI*o/(r+n-1);i[o]=e-t*Math.cos(a)}return zo(i,"float32")}var t1=oe({hannWindow_:function(r){return IM(r,.5,.5)}}),DM=oe({hammingWindow_:function(r){return IM(r,.54,.46)}}),n1=oe({frame_:function(r,e,t,n,i){n===void 0&&(n=!1),i===void 0&&(i=0);for(var o=0,a=[];o+e<=r.size;)a.push(tu(r,o,e)),o+=t;if(n)for(;o<r.size;){var s=o+e-r.size,u=uo([tu(r,o,e-s),Qu([s],i)]);a.push(u),o+=t}return a.length===0?Zu([],[0,e]):uo(a).as2D(a.length,e)}}),NM=oe({stft_:function(r,e,t,n,i){var o;i===void 0&&(i=t1),n==null&&(o=e,n=Math.floor(Math.pow(2,Math.ceil(Math.log(o)/Math.log(2)))));for(var a=n1(r,e,t),s=$n(a,i(e)),u=[],l=0;l<a.shape[0];l++)u.push(e1(s.slice([l,0],[1,e]),n));return uo(u)}}),b9=Object.freeze({hannWindow:t1,hammingWindow:DM,frame:n1,stft:NM}),Hr,w9=function(r,e,t){return t===void 0&&(t=1),wt(this,void 0,void 0,(function(){var n,i,o,a,s,u,l,c,h,f,m,g,w,v;return _t(this,(function(y){switch(y.label){case 0:return n=X(r,"predictions","inTopK"),i=X(e,"targets","inTopK"),K(n.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+n.rank})),K(n.rank-1===i.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+n.rank+" and targets rank "+i.rank})),En(n.shape.slice(0,n.shape.length-1),i.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),o=n.shape[n.shape.length-1],K(t>0&&t<=o,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+o+"), but got "+t})),[4,n.data()];case 1:return a=y.sent(),[4,i.data()];case 2:for(s=y.sent(),u=[a.length/o,o],c=u[1],h=Lc("bool",l=u[0]),f=0;f<l;f++){for(m=f*c,g=a.subarray(m,m+c),w=[],v=0;v<g.length;v++)w.push({value:g[v],index:v});for(w.sort((function(x,E){return E.value-x.value})),h[f]=0,v=0;v<t;v++)if(w[v].index===s[f]){h[f]=1;break}}return r!==n&&n.dispose(),e!==i&&i.dispose(),[2,Cr(h,i.shape,"bool")]}}))}))};(function(r){r[r.NONE=0]="NONE",r[r.MEAN=1]="MEAN",r[r.SUM=2]="SUM",r[r.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"})(Hr||(Hr={}));var _9=oe({absoluteDifference_:function(r,e,t,n){n===void 0&&(n=Hr.SUM_BY_NONZERO_WEIGHTS);var i=X(r,"labels","absoluteDifference"),o=X(e,"predictions","absoluteDifference"),a=null;t!=null&&(a=X(t,"weights","absoluteDifference")),En(i.shape,o.shape,"Error in absoluteDifference: ");var s=i.sub(o).abs();return rs(s,a,n)}}),rs=oe({computeWeightedLoss_:function(r,e,t){t===void 0&&(t=Hr.SUM_BY_NONZERO_WEIGHTS);var n=X(r,"losses","computeWeightedLoss"),i=null;e!=null&&(i=X(e,"weights","computeWeightedLoss"));var o=i==null?n:n.mul(i);if(t===Hr.NONE)return o;if(t===Hr.SUM)return o.sum();if(t===Hr.MEAN){if(i==null)return o.mean();var a=n.size/i.size,s=o.sum().div(i.sum());return a>1?s.div(Ct(a)):s}if(t===Hr.SUM_BY_NONZERO_WEIGHTS){if(i==null)return o.sum().div(Ct(n.size));var u=i.mul(Jc(n.shape)).notEqual(Ct(0)).sum().toFloat();return o.sum().div(u)}throw Error("Unknown reduction: "+t)}}),x9=oe({cosineDistance_:function(r,e,t,n,i){i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(r,"labels","cosineDistance"),a=X(e,"predictions","cosineDistance"),s=null;n!=null&&(s=X(n,"weights","cosineDistance")),En(o.shape,a.shape,"Error in cosineDistance: ");var u=Ct(1).sub(o.mul(a).sum(t,!0));return rs(u,s,i)}}),S9=oe({hingeLoss_:function(r,e,t,n){n===void 0&&(n=Hr.SUM_BY_NONZERO_WEIGHTS);var i=X(r,"labels","hingeLoss"),o=X(e,"predictions","hingeLoss"),a=null;t!=null&&(a=X(t,"weights","hingeLoss")),En(i.shape,o.shape,"Error in hingeLoss: ");var s=Ct(1);i=Ct(2).mul(i).sub(s);var u=s.sub(i.mul(o)).relu();return rs(u,a,n)}}),E9=oe({huberLoss_:function(r,e,t,n,i){n===void 0&&(n=1),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(r,"labels","huberLoss"),a=X(e,"predictions","huberLoss"),s=null;t!=null&&(s=X(t,"weights","huberLoss")),En(o.shape,a.shape,"Error in huberLoss: ");var u=Ct(n),l=a.sub(o).abs(),c=A3(l,u),h=l.sub(c),f=Ct(.5).mul(c.square()).add(u.mul(h));return rs(f,s,i)}}),k9=oe({logLoss_:function(r,e,t,n,i){n===void 0&&(n=1e-7),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(r,"labels","logLoss"),a=X(e,"predictions","logLoss"),s=null;t!=null&&(s=X(t,"weights","logLoss")),En(o.shape,a.shape,"Error in logLoss: ");var u=Ct(1),l=Ct(n),c=o.mul(a.add(l).log()).neg().sub(u.sub(o).mul(u.sub(a).add(l).log()));return rs(c,s,i)}}),C9=oe({meanSquaredError_:function(r,e,t,n){n===void 0&&(n=Hr.SUM_BY_NONZERO_WEIGHTS);var i=X(r,"labels","meanSquaredError"),o=X(e,"predictions","meanSquaredError"),a=null;t!=null&&(a=X(t,"weights","meanSquaredError")),En(i.shape,o.shape,"Error in meanSquaredError: ");var s=i.squaredDifference(o);return rs(s,a,n)}}),T9=oe({sigmoidCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(r,"multiClassLabels","sigmoidCrossEntropy"),a=X(e,"logits","sigmoidCrossEntropy"),s=null;if(t!=null&&(s=X(t,"weights","sigmoidCrossEntropy")),En(o.shape,a.shape,"Error in sigmoidCrossEntropy: "),n>0){var u=Ct(n),l=Ct(1),c=Ct(.5);o=o.mul(l.sub(u)).add(c.mul(u))}var h=(function(f,m){var g=X(f,"labels","sigmoidCrossEntropyWithLogits"),w=X(m,"logits","sigmoidCrossEntropyWithLogits");En(g.shape,w.shape,"Error in sigmoidCrossEntropyWithLogits: ");var v=w.relu(),y=w.mul(g),x=w.abs().neg().exp().log1p();return v.sub(y).add(x)})(o,a);return rs(h,s,i)}}),M9=oe({softmaxCrossEntropy_:function(r,e,t,n,i){n===void 0&&(n=0),i===void 0&&(i=Hr.SUM_BY_NONZERO_WEIGHTS);var o=X(r,"onehotLabels","softmaxCrossEntropy"),a=X(e,"logits","softmaxCrossEntropy"),s=null;if(t!=null&&(s=X(t,"weights","softmaxCrossEntropy")),En(o.shape,a.shape,"Error in softmaxCrossEntropy: "),n>0){var u=Ct(n),l=Ct(1),c=Ct(o.shape[1]);o=o.mul(l.sub(u)).add(u.div(c))}var h=(function(f,m,g){if(g===void 0&&(g=-1),g===-1&&(g=m.rank-1),g!==m.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+m.rank+" and dim was "+g);return sg((function(w,v,y){var x=v.logSumExp([g],!0),E=v.toFloat().sub(x);return y([w,E]),{value:E.mul(w).neg().sum([g]),gradFunc:function(_,k){var C=k[0],R=k[1],I=Si(_.shape,[g]);return[_.reshape(I).mul(C.toFloat().sub(R.exp())),_.reshape(I).mul(R.exp().sub(C.toFloat()))]}}}))(f,m)})(o,a);return rs(h,s,i)}}),A9=Object.freeze({get Reduction(){return Hr},absoluteDifference:_9,computeWeightedLoss:rs,cosineDistance:x9,hingeLoss:S9,huberLoss:E9,logLoss:k9,meanSquaredError:C9,sigmoidCrossEntropy:T9,softmaxCrossEntropy:M9});function _E(r,e){return e===void 0&&(e=!1),le.tidy((function(){if(r.shape.length!==2)throw new Error("qr2d() requires a 2D Tensor, but got a "+r.shape.length+"D Tensor.");for(var t=r.shape[0],n=r.shape[1],i=lM(t),o=r.clone(),a=Zu([[1]],[1,1]),s=a.clone(),u=t>=n?n:t,l=function(h){var f,m=o,g=s,w=i;f=le.tidy((function(){var v=o.slice([h,h],[t-h,1]),y=v.norm(),x=o.slice([h,h],[1,1]),E=Zu([[-1]]).where(x.greater(0),Zu([[1]])),_=x.sub(E.mul(y)),k=v.div(_);s=k.shape[0]===1?a.clone():a.concat(k.slice([1,0],[k.shape[0]-1,k.shape[1]]),0);var C=E.matMul(_).div(y).neg(),R=o.slice([h,0],[t-h,n]),I=C.mul(s),T=s.transpose();if(h===0)o=R.sub(I.matMul(T.matMul(R)));else{var A=R.sub(I.matMul(T.matMul(R)));o=o.slice([0,0],[h,n]).concat(A,0)}var N=I.transpose(),O=i.slice([0,h],[t,i.shape[1]-h]);if(h===0)i=O.sub(O.matMul(s).matMul(N));else{var V=O.sub(O.matMul(s).matMul(N));i=i.slice([0,0],[t,h]).concat(V,1)}return[s,o,i]})),s=f[0],o=f[1],i=f[2],bi([m,g,w])},c=0;c<u;++c)l(c);return!e&&t>n&&(i=i.slice([0,0],[t,n]),o=o.slice([0,0],[n,n])),[i,o]}))}var R9=oe({bandPart_:function(r,e,t){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(t%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+t+".");var n=X(r,"a","bandPart");if(n.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+n.rank+".");var i=n.shape,o=n.shape.slice(-2),a=o[0],s=o[1];if(!(e<=a))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+a+").");if(!(t<=s))throw new Error("bandPart(): numUpper ("+t+") must not be greater than the number of columns ("+s+").");e<0&&(e=a),t<0&&(t=s);var u=Am(0,a,1,"int32").reshape([-1,1]),l=Am(0,s,1,"int32"),c=Lo(u,l),h=hg(c.lessEqual(Ct(+e,"int32")),c.greaterEqual(Ct(-t,"int32"))),f=Xn([a,s],n.dtype);return Qs(ig(n.reshape([-1,a,s])).map((function(m){return il(h,m,f)}))).reshape(i)}}),I9=oe({gramSchmidt_:function(r){var e;if(Array.isArray(r)){e=!1,K(r!=null&&r.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var t=r[0].shape[0],n=function(u){K(r[u].shape[0]===t,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+r[u].shape[0]+" vs. "+t+")"}))},i=1;i<r.length;++i)n(i)}else e=!0,r=Bw(r,r.shape[0],0).map((function(u){return y3(u,[0])}));K(r.length<=r[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+r.length+") exceeds number of dimensions ("+r[0].shape[0]+")."}));var o=[],a=r,s=function(u){o.push(le.tidy((function(){var l=a[u];if(u>0)for(var c=0;c<u;++c){var h=Hs(o[c].mulStrict(l)).mul(o[c]);l=l.sub(h)}return l.div(AM(l,"euclidean"))})))};for(i=0;i<r.length;++i)s(i);return e?Qs(o,0):o}}),D9=oe({qr_:function(r,e){if(e===void 0&&(e=!1),r.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+r.rank);if(r.rank===2)return _E(r,e);var t=r.shape.slice(0,r.shape.length-2).reduce((function(a,s){return a*s})),n=ig(r.reshape([t,r.shape[r.shape.length-2],r.shape[r.shape.length-1]]),0),i=[],o=[];return n.forEach((function(a){var s=_E(a,e),u=s[0],l=s[1];i.push(u),o.push(l)})),[Qs(i,0).reshape(r.shape),Qs(o,0).reshape(r.shape)]}}),N9=Object.freeze({bandPart:R9,gramSchmidt:I9,qr:D9});function fg(r,e,t,n,i,o){n==null&&(n=.5),i==null&&(i=Number.NEGATIVE_INFINITY),o==null&&(o=0);var a=r.shape[0];return t=Math.min(t,a),K(0<=n&&n<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+n+"'"})),K(r.rank===2,(function(){return"boxes must be a 2D tensor, but was of rank '"+r.rank+"'"})),K(r.shape[1]===4,(function(){return"boxes must have 4 columns, but 2nd dimension was "+r.shape[1]})),K(e.rank===1,(function(){return"scores must be a 1D tensor"})),K(e.shape[0]===a,(function(){return"scores has incompatible shape with boxes. Expected "+a+", but was "+e.shape[0]})),K(0<=o&&o<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+o+"'"})),{maxOutputSize:t,iouThreshold:n,scoreThreshold:i,softNmsSigma:o}}var P9=oe({resizeBilinear_:function(r,e,t){t===void 0&&(t=!1);var n=X(r,"images","resizeBilinear");K(n.rank===3||n.rank===4,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+n.rank+"."})),K(e.length===2,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=le.runKernelFunc((function(l,c){return c([i]),l.resizeBilinear(i,a,s,t)}),{x:i},(function(l,c){return{x:function(){return le.runKernelFunc((function(h){return h.resizeBilinearBackprop(l,c[0],t)}),{})}}}),"ResizeBilinear",{alignCorners:t,newHeight:a,newWidth:s});return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),F9=oe({resizeNearestNeighbor_:function(r,e,t){t===void 0&&(t=!1);var n=X(r,"images","resizeNearestNeighbor");K(n.rank===3||n.rank===4,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+n.rank+"."})),K(e.length===2,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),K(n.dtype==="float32"||n.dtype==="int32",(function(){return"`images` must have `int32` or `float32` as dtype"}));var i=n,o=!1;n.rank===3&&(o=!0,i=n.as4D(1,n.shape[0],n.shape[1],n.shape[2]));var a=e[0],s=e[1],u=le.runKernelFunc((function(l,c){return c([i]),l.resizeNearestNeighbor(i,a,s,t)}),{batchImages:i},(function(l,c){return{batchImages:function(){return le.runKernelFunc((function(h){return h.resizeNearestNeighborBackprop(l,c[0],t)}),{})}}}));return o?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),O9=oe({nonMaxSuppression_:function(r,e,t,n,i){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY);var o=X(r,"boxes","nonMaxSuppression"),a=X(e,"scores","nonMaxSuppression"),s=fg(o,a,t,n,i);t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold;var u={maxOutputSize:t,iouThreshold:n,scoreThreshold:i};return le.runKernelFunc((function(l){return l.nonMaxSuppression(o,a,t,n,i)}),{boxes:o,scores:a},null,"NonMaxSuppressionV3",u)}}),L9=function(r,e,t,n,i){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),wt(this,void 0,void 0,(function(){var o,a,s,u,l,c,h;return _t(this,(function(f){switch(f.label){case 0:return o=X(r,"boxes","nonMaxSuppressionAsync"),a=X(e,"scores","nonMaxSuppressionAsync"),s=fg(o,a,t,n,i),t=s.maxOutputSize,n=s.iouThreshold,i=s.scoreThreshold,[4,Promise.all([o.data(),a.data()])];case 1:return u=f.sent(),l=u[0],c=u[1],h=Gw(l,c,t,n,i),o!==r&&o.dispose(),a!==e&&a.dispose(),[2,h]}}))}))},B9=oe({nonMaxSuppressionWithScore_:function(r,e,t,n,i,o){n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0);var a=X(r,"boxes","nonMaxSuppression"),s=X(e,"scores","nonMaxSuppression"),u=fg(a,s,t,n,i,o),l={maxOutputSize:t=u.maxOutputSize,iouThreshold:n=u.iouThreshold,scoreThreshold:i=u.scoreThreshold,softNmsSigma:o=u.softNmsSigma},c=le.runKernel("NonMaxSuppressionV5",{boxes:a,scores:s},l);return{selectedIndices:c[0],selectedScores:c[1]}}}),U9=function(r,e,t,n,i,o){return n===void 0&&(n=.5),i===void 0&&(i=Number.NEGATIVE_INFINITY),o===void 0&&(o=0),wt(this,void 0,void 0,(function(){var a,s,u,l,c,h,f;return _t(this,(function(m){switch(m.label){case 0:return a=X(r,"boxes","nonMaxSuppressionAsync"),s=X(e,"scores","nonMaxSuppressionAsync"),u=fg(a,s,t,n,i,o),t=u.maxOutputSize,n=u.iouThreshold,i=u.scoreThreshold,o=u.softNmsSigma,[4,Promise.all([a.data(),s.data()])];case 1:return l=m.sent(),c=l[0],h=l[1],f=Vw(c,h,t,n,i,o),a!==r&&a.dispose(),s!==e&&s.dispose(),[2,f]}}))}))},z9=oe({cropAndResize_:function(r,e,t,n,i,o){var a=X(r,"image","cropAndResize"),s=X(e,"boxes","cropAndResize","float32"),u=X(t,"boxInd","cropAndResize","int32");i=i||"bilinear",o=o||0;var l=s.shape[0];return K(a.rank===4,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+a.rank+"."})),K(s.rank===2&&s.shape[1]===4,(function(){return"Error in cropAndResize: boxes must be have size ["+l+",4] but had shape "+s.shape+"."})),K(u.rank===1&&u.shape[0]===l,(function(){return"Error in cropAndResize: boxInd must be have size ["+l+"] but had shape "+s.shape+"."})),K(n.length===2,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+n.length+"."})),K(n[0]>=1&&n[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+n})),K(i==="bilinear"||i==="nearest",(function(){return"method must be bilinear or nearest, but was "+i})),le.runKernelFunc((function(c,h){return c.cropAndResize(a,s,u,n,i,o)}),{images:a,boxes:s,boxInd:u},null,"CropAndResize",{method:i,extrapolationValue:o,cropSize:n})}}),PM=Object.freeze({resizeBilinear:P9,resizeNearestNeighbor:F9,nonMaxSuppression:O9,nonMaxSuppressionAsync:L9,nonMaxSuppressionWithScore:B9,nonMaxSuppressionWithScoreAsync:U9,cropAndResize:z9}),r1=function(r,e){return!(r>0)||e==="linear"},i1=function(r,e,t){if(t==null||t==="linear")return r;if(t==="relu")return r.mul(e.step());throw new Error("Gradient for activation "+t+" has not been implemented yet.")},o1=function(r,e){var t=e,n=ar(r.shape,e.shape);return n.length>0&&(t=t.sum(n)),t.reshape(r.shape)},a1=function(r,e,t){if(e==="linear")return r;if(e==="relu")return dg(r);if(e==="elu")return CM(r);if(e==="relu6")return MM(r);if(e==="prelu")return TM(r,t);throw new Error("Unknown fused activation "+e+".")},W9=oe({fusedMatMul_:function(r){var e,t=r.a,n=r.b,i=r.transposeA,o=i!==void 0&&i,a=r.transposeB,s=a!==void 0&&a,u=r.bias,l=r.activation,c=l===void 0?"linear":l,h=r.preluActivationWeights;if(r1(le.state.gradientDepth,c)===!1){var f=xM(t,n,o,s);return u!=null&&(f=lo(f,u)),a1(f,c,h)}var m=X(t,"a","fused matMul"),g=X(n,"b","fused matMul");e=Gn(m,g),m=e[0],g=e[1];var w=o?m.shape[m.rank-2]:m.shape[m.rank-1],v=s?g.shape[g.rank-1]:g.shape[g.rank-2],y=o?m.shape[m.rank-1]:m.shape[m.rank-2],x=s?g.shape[g.rank-2]:g.shape[g.rank-1],E=m.shape.slice(0,-2),_=g.shape.slice(0,-2),k=bt(E),C=bt(_);K(m.rank>=2&&g.rank>=2&&m.rank===g.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+m.rank+" and "+g.rank+"."})),K(wr(E,_),(function(){return"Error in fused matMul: outer dimensions ("+E+") and ("+_+") of Tensors with shapes "+m.shape+" and "+g.shape+" must match."})),K(w===v,(function(){return"Error in fused matMul: inner shapes ("+w+") and ("+v+") of Tensors with shapes "+m.shape+" and "+g.shape+" and transposeA="+o+" and transposeB="+s+" must match."}));var R,I,T=m.shape.slice(0,-2).concat([y,x]),A=o?m.as3D(k,w,y):m.as3D(k,y,w),N=s?g.as3D(C,x,v):g.as3D(C,v,x);u!=null&&on(T,(R=Gn(R=X(u,"bias","fused matMul"),m)[0]).shape),h!=null&&(I=X(h,"prelu weights","fused matMul"));var O={a:A,b:N};u!=null&&(O.bias=R),h!=null&&(O.preluActivationWeights=I);var V=[A,N];return le.runKernelFunc((function(F,B){var U=F.fusedBatchMatMul({a:A,b:N,transposeA:o,transposeB:s,bias:R,activation:c,preluActivationWeights:I});return B([A,N,U]),U}),O,(function(F,B){var U=B[0],P=B[1],L=B[2],H=i1(F,L,c),W={};return u!=null&&(W={bias:function(){return o1(R,H)}}),Object.assign(o||s?!o&&s?{a:function(){return H.matMul(P,!1,!1)},b:function(){return H.matMul(U,!0,!1)}}:o&&!s?{a:function(){return P.matMul(H,!1,!0)},b:function(){return U.matMul(H,!1,!1)}}:{a:function(){return P.matMul(H,!0,!0)},b:function(){return H.matMul(U,!0,!0)}}:{a:function(){return H.matMul(P,!1,!0)},b:function(){return U.matMul(H,!0,!1)}},W)}),"_FusedMatMul",{transposeA:o,transposeB:s,activation:c},V,[!0]).reshape(T)}}),H9=oe({fusedConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,o=r.dataFormat,a=o===void 0?"NHWC":o,s=r.dilations,u=s===void 0?[1,1]:s,l=r.dimRoundingMode,c=r.bias,h=r.activation,f=h===void 0?"linear":h,m=r.preluActivationWeights;if(f=f||"linear",r1(le.state.gradientDepth,f)===!1){var g=dl(e,t,n,i,a,u,l);return c!=null&&(g=lo(g,c)),a1(g,f,m)}var w=X(e,"x","conv2d"),v=X(t,"filter","conv2d"),y=w,x=!1;w.rank===3&&(x=!0,y=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),K(y.rank===4,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+y.rank+"."})),K(v.rank===4,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+v.rank+"."})),l!=null&&K(Jn(i),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+l+" but got pad "+i+"."})),K(y.shape[3]===v.shape[2],(function(){return"Error in conv2d: depth of input ("+y.shape[3]+") must match input depth for filter "+v.shape[2]+"."})),K(ri(n,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"})),K(a==="NHWC",(function(){return"Error in conv2d: got dataFormat of "+a+" but only NHWC is currently supported."}));var E,_,k=cl(y.shape,v.shape,n,u,i,l);c!=null&&(E=Gn(E=X(c,"bias","fused conv2d"),w)[0],on(k.outShape,E.shape)),m!=null&&(_=X(m,"prelu weights","fused conv2d"));var C={x:y,filter:v};c!=null&&(C.bias=E),m!=null&&(C.preluActivationWeights=_);var R=[v,y],I=le.runKernelFunc((function(T,A){var N=T.fusedConv2d({input:y,filter:v,convInfo:k,bias:E,activation:f,preluActivationWeights:_});return A([v,y,N]),N}),C,(function(T,A){var N=A,O=N[0],V=N[1],F=N[2],B=i1(T,F,f);K(zc(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var U={};return c!=null&&(U={bias:function(){return o1(E,B)}}),Object.assign({x:function(){return yM(V.shape,B,O,n,i)},filter:function(){return Jw(V,B,O.shape,n,i)}},U)}),"FusedConv2D",{convInfo:k,activation:f},R,[!0]);return x?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),G9=oe({fusedDepthwiseConv2d_:function(r){var e=r.x,t=r.filter,n=r.strides,i=r.pad,o=r.dataFormat,a=o===void 0?"NHWC":o,s=r.dilations,u=s===void 0?[1,1]:s,l=r.dimRoundingMode,c=r.bias,h=r.activation,f=h===void 0?"linear":h,m=r.preluActivationWeights;if(r1(le.state.gradientDepth,f)===!1){var g=Zw(e,t,n,i,a,u,l);return c!=null&&(g=lo(g,c)),a1(g,f,m)}var w=X(e,"x","depthwiseConv2d"),v=X(t,"filter","depthwiseConv2d"),y=w,x=!1;w.rank===3&&(x=!0,y=w.as4D(1,w.shape[0],w.shape[1],w.shape[2])),K(y.rank===4,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+y.rank+"."})),K(v.rank===4,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+v.rank+"."})),K(y.shape[3]===v.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+y.shape[3]+") must match the inChannels dimension in filter "+v.shape[2]+"."})),u==null&&(u=[1,1]),K(ri(n,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+u+"'"})),l!=null&&K(Jn(i),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+l+" but got pad "+i+"."}));var E,_,k=cl(y.shape,v.shape,n,u,i,l,!0);c!=null&&(E=Gn(E=X(c,"bias","fused conv2d"),w)[0],on(k.outShape,E.shape)),m!=null&&(_=X(m,"prelu weights","fused depthwiseConv2d"));var C={x:y,filter:v};c!=null&&(C.bias=E),m!=null&&(C.preluActivationWeights=_);var R=[v,y],I=le.runKernelFunc((function(T,A){var N=T.fusedDepthwiseConv2D({input:y,filter:v,convInfo:k,bias:E,activation:f,preluActivationWeights:_});return A([v,y,N]),N}),C,(function(T,A){K(zc(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var N=A[0],O=A[1],V=A[2],F=i1(T,V,f),B={};return c!=null&&(B={bias:function(){return o1(E,F)}}),Object.assign({x:function(){return bM(O.shape,F,N,k)},filter:function(){return wM(O,F,N.shape,k)}},B)}),"FusedDepthwiseConv2D",{convInfo:k,activation:f},R,[!0]);return x?I.as3D(I.shape[1],I.shape[2],I.shape[3]):I}}),V9=Object.freeze({matMul:W9,conv2d:H9,depthwiseConv2d:G9}),j9=Object.freeze({image:PM,linalg:N9,losses:A9,spectral:p9,fused:V9,signal:b9,add:lo,addN:JU,batchNorm:Ad,batchNormalization:ZU,batchNorm2d:e7,batchNormalization2d:QU,batchNorm3d:n7,batchNormalization3d:t7,batchNorm4d:i7,batchNormalization4d:r7,broadcastTo:oM,clone:o7,div:eu,divNoNan:uM,eye:lM,multinomial:u7,oneHot:Bm,pad:ns,pad1d:l7,pad2d:c7,pad3d:h7,pad4d:d7,rand:f7,randomGamma:g7,randomNormal:v7,randomUniform:cM,square:hM,squaredDifference:dM,tile:kc,truncatedNormal:y7,conv1d:R7,conv2d:dl,conv3d:I7,depthwiseConv2d:Zw,separableConv2d:_M,conv2dTranspose:D7,conv3dTranspose:N7,op:oe,booleanMaskAsync:A7,complex:Er,real:no,imag:aa,concat:uo,concat1d:zB,concat2d:WB,concat3d:HB,concat4d:GB,split:Bw,matMul:xM,dot:P7,outerProduct:F7,reverse:Rd,reverse1d:O7,reverse2d:L7,reverse3d:B7,reverse4d:U7,maxPool:Ri,avgPool:z7,pool:W7,maxPool3d:H7,avgPool3d:G7,maxPoolWithArgmax:V7,slice:tu,slice1d:j7,slice2d:q7,slice3d:$7,slice4d:X7,abs:YB,acos:KB,acosh:JB,asin:ZB,asinh:QB,atan:e6,atanh:t6,ceil:n6,clipByValue:r6,cos:i6,cosh:o6,erf:a6,exp:s6,expm1:u6,floor:l6,log:c6,log1p:h6,logSigmoid:d6,neg:Uw,reciprocal:f6,round:p6,rsqrt:T3,sigmoid:m6,sign:g6,isNaN:v6,isInf:y6,isFinite:b6,sin:w6,sinh:_6,softplus:x6,sqrt:S6,step:E6,tan:k6,tanh:C6,all:Y7,any:K7,argMax:J7,argMin:Z7,logSumExp:Q7,max:e9,mean:t9,min:n9,moments:r9,sum:Hs,prod:i9,equal:fM,equalStrict:b7,greater:w7,greaterEqual:pM,greaterEqualStrict:_7,greaterStrict:x7,less:S7,lessEqual:E7,lessEqualStrict:k7,lessStrict:C7,notEqual:T7,notEqualStrict:M7,addStrict:T6,atan2:M6,divStrict:A6,floorDiv:M3,maximum:zw,maximumStrict:R6,minimum:A3,minimumStrict:I6,mod:D6,modStrict:N6,mul:$n,mulStrict:P6,pow:Nm,powStrict:F6,squaredDifferenceStrict:O6,sub:Lo,subStrict:L6,elu:CM,leakyRelu:o9,prelu:TM,relu:dg,relu6:MM,selu:a9,logicalAnd:hg,logicalNot:a7,logicalOr:aM,logicalXor:s7,where:il,whereAsync:sM,buffer:Xt,print:VB,batchToSpaceND:g3,cast:jB,cumsum:qB,depthToSpace:$B,expandDims:Ws,reshape:Ua,spaceToBatchND:v3,squeeze:y3,stack:Qs,unstack:ig,setdiff1dAsync:XB,fill:Qu,linspace:UB,ones:Jc,range:Am,scalar:Ct,tensor:Cr,tensor1d:zo,tensor2d:Zu,tensor3d:p3,tensor4d:ra,tensor5d:OB,tensor6d:LB,variable:BB,zeros:Xn,onesLike:m3,zerosLike:hn,transpose:Mo,softmax:ug,logSoftmax:V6,localResponseNormalization:s9,norm:AM,gather:Kw,unsortedSegmentSum:mM,basicLSTMCell:u9,multiRNNCell:l9,movingAverage:c9,stridedSlice:h9,topk:d9,scatterND:f9,fft:Qw,ifft:Um,rfft:e1,irfft:RM,sparseToDense:m9,gatherND:g9,diag:v9,dropout:y9,hannWindow:t1,hammingWindow:DM,frame:n1,stft:NM,inTopKAsync:w9});function Le(r,e){Array.isArray(r)||(r=[r]),r.forEach((function(t){t!=null&&K(t.dtype!=="complex64",(function(){return e+" does not support complex64 tensors."}))}))}function yb(r,e,t,n,i,o){for(var a=i.strideHeight,s=i.strideWidth,u=i.dilationHeight,l=i.dilationWidth,c=i.effectiveFilterHeight,h=i.effectiveFilterWidth,f=i.padInfo.top,m=i.padInfo.left,g=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Xt(i.outShape,t),v=w.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],x=i.outShape[2]*i.outShape[3],E=i.outShape[3],_=0;_<i.batchSize;++_)for(var k=_*y,C=_*n[0],R=0;R<i.inChannels;++R)for(var I=0;I<i.outHeight;++I)for(var T=I*a-f,A=Math.max(0,T),N=Math.min(i.inHeight,c+T),O=k+I*x,V=0;V<i.outWidth;++V){for(var F=V*s-m,B=Math.max(0,F),U=Math.min(i.inWidth,h+F),P=g,L=0,H=0,W=A;W<N;W+=u){for(var z=C+W*n[1],q=B;q<U;q+=l){var re=r[z+q*n[2]+R];o==="max"&&re>P?P=re:o==="avg"&&(L+=re,H++)}if(isNaN(P))break}v[O+V*E+R]=o==="avg"?L/H:P}return w}function FM(r,e,t,n,i,o){i===void 0&&(i=!1),o===void 0&&(o=!1);for(var a=Xt(n.outShape,"int32"),s=n.strideHeight,u=n.strideWidth,l=n.dilationHeight,c=n.dilationWidth,h=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=n.padInfo.top,g=n.padInfo.left,w=Xt(e,t,r),v=0;v<n.batchSize;++v)for(var y=0;y<n.inChannels;++y)for(var x=0;x<n.outHeight;++x){for(var E=x*s-m,_=E;_<0;)_+=l;for(var k=Math.min(n.inHeight,h+E),C=0;C<n.outWidth;++C){for(var R=C*u-g,I=R;I<0;)I+=c;for(var T=Math.min(n.inWidth,f+R),A=Number.NEGATIVE_INFINITY,N=-1,O=_;O<k;O+=l)for(var V=O-E,F=I;F<T;F+=c){var B=F-R,U=w.get(v,O,F,y);U>A&&(A=U,N=i?o?((v*n.inHeight+O)*n.inWidth+F)*n.inChannels+y:(O*n.inWidth+F)*n.inChannels+y:V*f+B)}a.set(N,v,x,C,y)}}return a}function Zy(r,e,t,n){if(t==="linear")return r.linear(e);if(t==="relu")return r.relu(e);if(t==="elu")return r.elu(e);if(t==="relu6")return r.relu6(e);if(t==="prelu")return r.prelu(e,n);throw new Error("Activation "+t+" has not been implemented for the CPU backend.")}var q9=(function(r){function e(){var t=r.call(this)||this;return t.blockSize=48,t.firstUse=!0,t.data=new P3(t,le),t}return Wo(e,r),e.prototype.write=function(t,n,i){this.firstUse&&(this.firstUse=!1,Ne().get("IS_NODE")&&Tm(`
============================
Hi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));var o={};return this.data.set(o,{values:t,dtype:i}),o},e.prototype.move=function(t,n,i,o){this.data.set(t,{values:n,dtype:o})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(n){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var n=this.data.get(t),i=n.dtype,o=n.complexTensors;return i==="complex64"?vb(this.readSync(o.real.dataId),this.readSync(o.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var n=this.readSync(t.dataId),i=n;if(t.dtype==="string")try{i=n.map((function(o){return Em(o)}))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Xt(t.shape,t.dtype,i)},e.prototype.makeOutput=function(t,n,i){var o=this.write(t,n,i);return le.makeTensorFromDataId(o,n,i,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var n=this.data.get(t).complexTensors;n!=null&&(n.real.dispose(),n.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return wt(this,void 0,void 0,(function(){var n;return _t(this,(function(i){return n=na(),t(),[2,{kernelMs:na()-n}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,n){var i=this.makeOutput(null,t.shape,"complex64");return this.data.get(i.dataId).complexTensors={real:le.keep(t.clone()),imag:le.keep(n.clone())},i},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,n,i){if(Le(t,"slice"),D3(t.shape,n,i)){var o=N3(n,t.strides),a=bt(i);return Cr(this.readSync(t.dataId).subarray(o,o+a),i,t.dtype)}for(var s=Xt(i,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l).map((function(h,f){return h+n[f]}));s.values[l]=u.get.apply(u,c)}return s.toTensor()},e.prototype.stridedSlice=function(t,n,i,o){Le(t,"stridedSlice");var a=Ww(n,i,o);if(a.some((function(m){return m===0})))return Cr([],a);for(var s=Xt(a,t.dtype),u=this.bufferSync(t),l=0;l<s.size;l++){for(var c=s.indexToLoc(l),h=new Array(c.length),f=0;f<h.length;f++)h[f]=c[f]*o[f]+n[f];s.set.apply(s,[u.get.apply(u,h)].concat(c))}return s.toTensor()},e.prototype.diag=function(t){for(var n=this.readSync(t.dataId),i=Xt([t.size,t.size],t.dtype),o=i.values,a=0;a<n.length;a++)o[a*t.size+a]=n[a];return i.toTensor()},e.prototype.unstack=function(t,n){for(var i=t.shape[n],o=new Array(t.rank-1),a=0,s=0;s<t.rank;s++)s!==n&&(o[a++]=t.shape[s]);var u=new Array(t.rank).fill(0),l=t.shape.slice();l[n]=1;var c=new Array(i);for(s=0;s<c.length;s++)u[n]=s,c[s]=this.slice(t,u,l).reshape(o);return c},e.prototype.reverse=function(t,n){Le(t,"reverse");for(var i=Xt(t.shape,t.dtype),o=this.bufferSync(t),a=function(u){var l=i.indexToLoc(u),c=l.slice();n.forEach((function(h){return c[h]=t.shape[h]-1-c[h]})),i.set.apply(i,[o.get.apply(o,c)].concat(l))},s=0;s<i.size;s++)a(s);return i.toTensor()},e.prototype.concat=function(t,n){var i=this;if(t[0].dtype==="complex64"){var o=t.map((function(m){return no(m)})),a=t.map((function(m){return aa(m)}));return Er(this.concat(o,n),this.concat(a,n))}var s=t.map((function(m){var g=bt(m.shape.slice(n));return m.as2D(-1,g)})),u=Uc(s.map((function(m){return m.shape})),1),l=Xt(u,t[0].dtype).values;if(s[0].shape[0]===1){var c=0;s.forEach((function(m){l.set(i.readSync(m.dataId),c),c+=m.size}))}else{var h=0;s.forEach((function(m){for(var g=i.readSync(m.dataId),w=0,v=0;v<m.shape[0];++v)for(var y=v*u[1]+h,x=0;x<m.shape[1];++x)l[y+x]=g[w++];h+=m.shape[1]}))}var f=Uc(t.map((function(m){return m.shape})),n);return Cr(l,f,t[0].dtype)},e.prototype.neg=function(t){return Le(t,"neg"),this.multiply(Ct(-1),t)},e.prototype.add=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),(function(i,o,a,s){return{real:i+a,imag:o+s}})):this.broadcastedBinaryOp(t,n,kr(t.dtype,n.dtype),(function(i,o){return i+o}))},e.prototype.addN=function(t){var n=this;Le(t,"addN");for(var i=t.map((function(c){return n.readSync(c.dataId)})),o=Xt(t[0].shape,t[0].dtype),a=o.values,s=0;s<t.length;s++)for(var u=i[s],l=0;l<a.length;l++)a[l]+=u[l];return o.toTensor()},e.prototype.softmax=function(t,n){var i=dr([n],t.shape),o=this.max(t,i),a=Si(o.shape,i),s=this.subtract(t,o.reshape(a)),u=this.exp(s),l=this.sum(u,i).reshape(a);return eu(u,l)},e.prototype.subtract=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),(function(i,o,a,s){return{real:i-a,imag:o-s}})):this.broadcastedBinaryOp(t,n,kr(t.dtype,n.dtype),(function(i,o){return i-o}))},e.prototype.pow=function(t,n){return Le([t,n],"pow"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){return Math.pow(i,o)}))},e.prototype.batchMatMul=function(t,n,i,o){Le([t,n],"matMul");for(var a=i?t.shape[1]:t.shape[2],s=i?t.shape[2]:t.shape[1],u=o?n.shape[1]:n.shape[2],l=t.shape[0],c=this.readSync(t.dataId),h=this.readSync(n.dataId),f=i?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],m=f[0],g=f[1],w=f[2],v=o?[1,n.strides[1],n.strides[0]]:[n.strides[1],1,n.strides[0]],y=v[0],x=v[1],E=v[2],_=s*u,k=Xt([l,s,u],t.dtype),C=k.values,R=this.blockSize,I=0;I<l;I++)for(var T=0;T<s;T+=R)for(var A=0;A<u;A+=R)for(var N=0;N<a;N+=R)for(var O=Math.min(T+R,s),V=Math.min(A+R,u),F=Math.min(N+R,a),B=T;B<O;B++)for(var U=A;U<V;U++){for(var P=0,L=N;L<F;L++)P+=c[I*m+B*g+L*w]*h[L*y+U*x+I*E];C[I*_+(B*u+U)]+=P}return k.toTensor()},e.prototype.fusedBatchMatMul=function(t){var n=t.a,i=t.b,o=t.transposeA,a=t.transposeB,s=t.bias,u=t.activation,l=t.preluActivationWeights,c=this.batchMatMul(n,i,o,a);return s&&(c=this.add(c,s)),u&&(c=Zy(this,c,u,l)),c},e.prototype.multiply=function(t,n){return t.dtype==="complex64"||n.dtype==="complex64"?this.broadcastedBinaryComplexOp(t.cast("complex64"),n.cast("complex64"),(function(i,o,a,s){return{real:i*a-o*s,imag:i*s+o*a}})):this.broadcastedBinaryOp(t,n,kr(t.dtype,n.dtype),(function(i,o){return i*o}))},e.prototype.floorDiv=function(t,n){return Le([t,n],"floorDiv"),this.broadcastedBinaryOp(t,n,"int32",(function(i,o){return Math.floor(i/o)}))},e.prototype.sum=function(t,n){Le(t,"sum"),Di("sum",n,t.rank);for(var i=Br(t.shape,n),o=i[0],a=i[1],s=Xn(o,kr(t.dtype,"int32")),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=0,g=0;g<u;++g)m+=c[f+g];l[h]=m}return s},e.prototype.prod=function(t,n){Le(t,"sum");for(var i=Br(t.shape,n),o=i[0],a=i[1],s=Xn(o,kr(t.dtype,"int32")),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=1,g=0;g<u;++g)m*=c[f+g];l[h]=m}return s},e.prototype.unsortedSegmentSum=function(t,n,i){Le(t,"unsortedSegmentSum");for(var o=[],a=t.rank-n.rank,s=0;s<a;++s)n=n.expandDims(s+1);for(s=0;s<i;++s){var u=Ct(s,"int32"),l=fM(u,n).asType("float32").mul(t).sum(0);o.push(l)}return Qs(o)},e.prototype.argMin=function(t,n){Le(t,"argMin");var i=[n];Di("argMin",i,t.rank);for(var o=Br(t.shape,i),a=o[0],s=o[1],u=Xn(a,"int32"),l=bt(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),f=0;f<c.length;++f){for(var m=f*l,g=h[m],w=0,v=0;v<l;++v){var y=h[m+v];y<g&&(g=y,w=v)}c[f]=w}return u},e.prototype.argMax=function(t,n){Le(t,"argMax");var i=[n];Di("argMax",i,t.rank);for(var o=Br(t.shape,i),a=o[0],s=o[1],u=Xn(a,"int32"),l=bt(s),c=this.readSync(u.dataId),h=this.readSync(t.dataId),f=0;f<c.length;++f){for(var m=f*l,g=h[m],w=0,v=0;v<l;++v){var y=h[m+v];y>g&&(g=y,w=v)}c[f]=w}return u},e.prototype.cumsum=function(t,n,i,o){if(Le(t,"cumsum"),n!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+n);for(var a=kr(t.dtype,"int32"),s=Xn(t.shape,a),u=this.readSync(s.dataId),l=this.readSync(t.dataId),c=t.shape[t.rank-1],h=o?function(v,y){return v+c-y-1}:function(v,y){return v+y},f=0;f<l.length;f+=c)for(var m=0;m<c;m++){var g=h(f,m);if(m===0)u[g]=i?0:l[g];else{var w=h(f,m-1);u[g]=i?l[w]+u[w]:l[g]+u[w]}}return s},e.prototype.equal=function(t,n){return Le([t,n],"equal"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i===o?1:0}))},e.prototype.notEqual=function(t,n){return Le([t,n],"notEqual"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i!==o?1:0}))},e.prototype.less=function(t,n){return Le([t,n],"less"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i<o?1:0}))},e.prototype.lessEqual=function(t,n){return Le([t,n],"lessEqual"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i<=o?1:0}))},e.prototype.greater=function(t,n){return Le([t,n],"greater"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i>o?1:0}))},e.prototype.greaterEqual=function(t,n){return Le([t,n],"greaterEqual"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i>=o?1:0}))},e.prototype.logicalNot=function(t){Le(t,"logicalNot");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)i[o]=n[o]?0:1;return this.makeOutput(i,t.shape,"bool")},e.prototype.logicalAnd=function(t,n){return Le([t,n],"logicalAnd"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i&&o}))},e.prototype.logicalOr=function(t,n){return Le([t,n],"logicalOr"),this.broadcastedBinaryOp(t,n,"bool",(function(i,o){return i||o}))},e.prototype.select=function(t,n,i){Le([t,n,i],"select");for(var o=this.readSync(t.dataId),a=this.readSync(n.dataId),s=this.readSync(i.dataId),u=Xn(n.shape,kr(n.dtype,i.dtype)),l=this.readSync(u.dataId),c=0,h=t.rank===0||t.rank>1||n.rank===1?1:bt(n.shape.slice(1)),f=0;f<o.length;f++)for(var m=0;m<h;m++)o[f]===1?l[c++]=a[f]:l[c++]=s[f];return u},e.prototype.where=function(t){Le([t],"where");var n=this.readSync(t.dataId);return jw(t.shape,n)},e.prototype.topk=function(t,n,i){return Le(t,"topk"),H3(this.readSync(t.dataId),t.shape,t.dtype,n)},e.prototype.min=function(t,n){Le(t,"min"),Di("min",n,t.rank);for(var i=Br(t.shape,n),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];w<m&&(m=w)}l[h]=m}return s},e.prototype.minimum=function(t,n){return Le([t,n],"minimum"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){return Math.min(i,o)}))},e.prototype.mod=function(t,n){return Le([t,n],"mod"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){var a=i%o;return i<0&&o<0||i>=0&&o>=0?a:(a+o)%o}))},e.prototype.max=function(t,n){Le(t,"max"),Di("max",n,t.rank);for(var i=Br(t.shape,n),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];w>m&&(m=w)}l[h]=m}return s},e.prototype.maximum=function(t,n){return Le([t,n],"maximum"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){return Math.max(i,o)}))},e.prototype.all=function(t,n){Le(t,"all"),Di("all",n,t.rank);for(var i=Br(t.shape,n),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];m=m&&w}l[h]=m}return s},e.prototype.any=function(t,n){Le(t,"any"),Di("any",n,t.rank);for(var i=Br(t.shape,n),o=i[0],a=i[1],s=Xn(o,t.dtype),u=bt(a),l=this.readSync(s.dataId),c=this.readSync(t.dataId),h=0;h<l.length;++h){for(var f=h*u,m=c[f],g=0;g<u;++g){var w=c[f+g];m=m||w}l[h]=m}return s},e.prototype.squaredDifference=function(t,n){return Le([t,n],"squaredDifference"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){var a=i-o;return a*a}))},e.prototype.ceil=function(t){Le(t,"ceil");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.ceil(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.floor=function(t){Le(t,"floor");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.floor(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.sign=function(t){Le(t,"x");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)n[o]<0?i[o]=-1:n[o]>0?i[o]=1:i[o]=0;return this.makeOutput(i,t.shape,"float32")},e.prototype.isNaN=function(t){Le(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Number.isNaN(n[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isInf=function(t){Le(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Math.abs(n[o])===1/0&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.isFinite=function(t){Le(t,"x");for(var n=this.readSync(t.dataId),i=new Uint8Array(n.length),o=0;o<n.length;++o)Number.isFinite(n[o])&&(i[o]=1);return this.makeOutput(i,t.shape,"bool")},e.prototype.round=function(t){Le(t,"round");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=Math.floor(n[o]);n[o]-a<.5?i[o]=Math.floor(n[o]):n[o]-a>.5?i[o]=Math.ceil(n[o]):i[o]=a%2==0?a:a+1}return this.makeOutput(i,t.shape,"float32")},e.prototype.exp=function(t){Le(t,"exp");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.exp(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.expm1=function(t){Le(t,"expm1");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=Math.expm1(n[o]);return this.makeOutput(i,t.shape,"float32")},e.prototype.log=function(t){Le(t,"log");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.log(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.log1p=function(t){Le(t,"log1p");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.log1p(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.sqrt=function(t){Le(t,"sqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.rsqrt=function(t){Le(t,"rsqrt");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o){var a=n[o];i[o]=1/Math.sqrt(a)}return this.makeOutput(i,t.shape,"float32")},e.prototype.reciprocal=function(t){Le(t,"reciprocal");for(var n=this.readSync(t.dataId),i=new Float32Array(n.length),o=0;o<n.length;++o)i[o]=1/n[o];return this.makeOutput(i,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){Le(t,"relu");for(var n=Xn(t.shape,t.dtype),i=this.readSync(n.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.max(0,o[a]);return n},e.prototype.relu6=function(t){Le(t,"relu");for(var n=Xn(t.shape,t.dtype),i=this.readSync(n.dataId),o=this.readSync(t.dataId),a=0;a<o.length;++a)i[a]=Math.min(Math.max(0,o[a]),6);return n},e.prototype.prelu=function(t,n){return Le([t,n],"prelu"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){return i<0?o*i:i}))},e.prototype.elu=function(t){Le(t,"elu");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=i[o];n[o]=a>=0?a:Math.exp(a)-1}return this.makeOutput(n,t.shape,"float32")},e.prototype.eluDer=function(t,n){Le([t,n],"eluDer");for(var i=new Float32Array(n.size),o=this.readSync(n.dataId),a=this.readSync(t.dataId),s=0;s<o.length;++s){var u=o[s];i[s]=u>=1?a[s]:a[s]*(u+1)}return this.makeOutput(i,n.shape,"float32")},e.prototype.selu=function(t){Le(t,"selu");for(var n=$w,i=Xw,o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>=0?i*u:n*(Math.exp(u)-1)}return this.makeOutput(o,t.shape,"float32")},e.prototype.clip=function(t,n,i){Le(t,"clip");for(var o=new Float32Array(t.size),a=this.readSync(t.dataId),s=0;s<a.length;++s){var u=a[s];o[s]=u>i?i:u<n?n:u}return this.makeOutput(o,t.shape,"float32")},e.prototype.abs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.abs(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<t.size;++o){var a=i[2*o],s=i[2*o+1];n[o]=Math.hypot(a,s)}return this.makeOutput(n,t.shape,"float32")},e.prototype.int=function(t){Le(t,"int");for(var n=new Int32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=i[o];return this.makeOutput(n,t.shape,"int32")},e.prototype.sigmoid=function(t){Le(t,"sigmoid");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=1/(1+Math.exp(-i[o]));return this.makeOutput(n,t.shape,"float32")},e.prototype.softplus=function(t){Le(t,"softplus");for(var n=Math.log(11920928955078125e-23)+2,i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a]>-n,u=o[a]<n,l=Math.exp(o[a]),c=void 0;c=u?l:s?o[a]:Math.log(1+l),i[a]=c}return this.makeOutput(i,t.shape,"float32")},e.prototype.sin=function(t){Le(t,"sin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.sin(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cos=function(t){Le(t,"cos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.cos(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tan=function(t){Le(t,"tan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.tan(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asin=function(t){Le(t,"asin");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.asin(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acos=function(t){Le(t,"acos");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.acos(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan=function(t){Le(t,"atan");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.atan(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atan2=function(t,n){return Le([t,n],"atan2"),this.broadcastedBinaryOp(t,n,t.dtype,(function(i,o){return Math.atan2(i,o)}))},e.prototype.sinh=function(t){Le(t,"sinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.sinh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.cosh=function(t){Le(t,"cosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.cosh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.tanh=function(t){Le(t,"tanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=VL(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.asinh=function(t){Le(t,"asinh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.asinh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.acosh=function(t){Le(t,"acosh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.acosh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.atanh=function(t){Le(t,"atanh");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o)n[o]=Math.atanh(i[o]);return this.makeOutput(n,t.shape,"float32")},e.prototype.erf=function(t){Le(t,"erf");for(var n=new Float32Array(t.size),i=this.readSync(t.dataId),o=0;o<i.length;++o){var a=Math.sign(i[o]),s=Math.abs(i[o]),u=1/(1+.3275911*s);n[o]=a*(1-((((1.061405429*u-1.453152027)*u+1.421413741)*u-.284496736)*u+.254829592)*u*Math.exp(-s*s))}return this.makeOutput(n,t.shape,"float32")},e.prototype.step=function(t,n){n===void 0&&(n=0),Le(t,"step");for(var i=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var s=o[a];isNaN(s)?i[a]=NaN:i[a]=s>0?1:n}return this.makeOutput(i,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var n=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.conv2d(n,i,o);return a&&(l=this.add(l,a)),s&&(l=Zy(this,l,s,u)),l},e.prototype.conv2d=function(t,n,i){Le([t,n],"conv2d");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.dataFormat==="channelsLast",f=Xt(i.outShape,t.dtype),m=t.strides[0],g=h?t.strides[1]:t.strides[2],w=h?t.strides[2]:1,v=h?1:t.strides[1],y=f.strides[0],x=h?f.strides[1]:f.strides[2],E=h?f.strides[2]:1,_=h?1:f.strides[1],k=this.readSync(t.dataId),C=this.readSync(n.dataId),R=f.values,I=0;I<i.batchSize;++I)for(var T=I*m,A=I*y,N=0;N<i.outHeight;++N)for(var O=A+N*x,V=N*i.strideHeight-c,F=0;F<o;F++){var B=V+F*s;if(!(B<0||B>=i.inHeight))for(var U=F*n.strides[0],P=T+B*g,L=0;L<i.outWidth;++L)for(var H=O+L*E,W=L*i.strideWidth-l,z=0;z<a;z++){var q=W+z*u;if(!(q<0||q>=i.inWidth))for(var re=P+q*w,de=U+z*n.strides[1],ye=0;ye<i.inChannels;++ye){for(var ne=k[re+ye*v],ie=0;ie<i.outChannels;++ie)R[H+ie*_]+=ne*C[de+ie];de+=i.outChannels}}}return f.toTensor()},e.prototype.conv3d=function(t,n,i){for(var o=i.filterDepth,a=i.filterHeight,s=i.filterWidth,u=i.dilationDepth,l=i.dilationHeight,c=i.dilationWidth,h=i.padInfo.front,f=i.padInfo.left,m=i.padInfo.top,g=Xt(i.outShape,t.dtype),w=this.readSync(t.dataId),v=this.readSync(n.dataId),y=g.values,x=0;x<i.batchSize;++x)for(var E=x*t.strides[0],_=x*g.strides[0],k=0;k<i.outDepth;++k)for(var C=_+k*g.strides[1],R=k*i.strideDepth-h,I=0;I<o;I++){var T=R+I*u;if(!(T<0||T>=i.inDepth))for(var A=I*n.strides[0],N=E+T*t.strides[1],O=0;O<i.outHeight;++O)for(var V=C+O*g.strides[2],F=O*i.strideHeight-m,B=0;B<a;B++){var U=F+B*l;if(!(U<0||U>=i.inHeight))for(var P=A+B*n.strides[1],L=N+U*t.strides[2],H=0;H<i.outWidth;++H)for(var W=V+H*i.outChannels,z=H*i.strideWidth-f,q=0;q<s;q++){var re=z+q*c;if(!(re<0||re>=i.inWidth))for(var de=P+q*n.strides[2],ye=L+re*i.inChannels,ne=de,ie=0;ie<i.inChannels;++ie){for(var fe=w[ye+ie],Ae=0;Ae<i.outChannels;++Ae)y[W+Ae]+=fe*v[ne+Ae];ne+=i.outChannels}}}}return g.toTensor()},e.prototype.conv2dDerInput=function(t,n,i){Le([t,n],"conv2dDerInput");for(var o=Xt(i.inShape,"float32"),a=o.values,s=this.readSync(t.dataId),u=this.readSync(n.dataId),l=n.strides,c=l[0],h=l[1],f=l[2],m=i.batchSize,g=i.filterHeight,w=i.filterWidth,v=i.inChannels,y=i.inHeight,x=i.inWidth,E=i.outChannels,_=i.outHeight,k=i.outWidth,C=i.strideHeight,R=i.strideWidth,I=i.dataFormat,T=g-1-i.padInfo.top,A=w-1-i.padInfo.left,N=I==="channelsLast",O=o.strides[0],V=N?o.strides[1]:o.strides[2],F=N?o.strides[2]:1,B=N?1:o.strides[1],U=t.strides[0],P=N?t.strides[1]:t.strides[2],L=N?t.strides[2]:1,H=N?1:t.strides[1],W=0;W<m;++W)for(var z=0;z<v;++z)for(var q=0;q<y;++q)for(var re=q-T,de=Math.max(0,Math.ceil(re/C)),ye=Math.min(_,(g+re)/C),ne=0;ne<x;++ne){for(var ie=ne-A,fe=Math.max(0,Math.ceil(ie/R)),Ae=Math.min(k,(w+ie)/R),De=0,Be=de;Be<ye;++Be)for(var lt=Be*C-re,Y=fe;Y<Ae;++Y)for(var ot=U*W+P*Be+L*Y,Je=c*(g-1-lt)+h*(w-1-(Y*R-ie))+f*z,Xe=0;Xe<E;++Xe)De+=s[ot+H*Xe]*u[Je+Xe];a[O*W+V*q+F*ne+B*z]=De}return o.toTensor()},e.prototype.conv3dDerInput=function(t,n,i){for(var o=Xt(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=s[3],f=this.readSync(t.dataId),m=t.strides,g=m[0],w=m[1],v=m[2],y=m[3],x=this.readSync(n.dataId),E=n.strides,_=E[0],k=E[1],C=E[2],R=E[3],I=i.batchSize,T=i.filterDepth,A=i.filterHeight,N=i.filterWidth,O=i.inChannels,V=i.inDepth,F=i.inHeight,B=i.inWidth,U=i.outChannels,P=i.outDepth,L=i.outHeight,H=i.outWidth,W=i.strideDepth,z=i.strideHeight,q=i.strideWidth,re=T-1-i.padInfo.front,de=A-1-i.padInfo.top,ye=N-1-i.padInfo.left,ne=0;ne<I;++ne)for(var ie=0;ie<O;++ie)for(var fe=0;fe<V;++fe)for(var Ae=fe-re,De=Math.max(0,Math.ceil(Ae/W)),Be=Math.min(P,(T+Ae)/W),lt=0;lt<F;++lt)for(var Y=lt-de,ot=Math.max(0,Math.ceil(Y/z)),Je=Math.min(L,(A+Y)/z),Xe=0;Xe<B;++Xe){for(var qe=Xe-ye,Tt=Math.max(0,Math.ceil(qe/q)),Qe=Math.min(H,(N+qe)/q),ft=0,Mt=De;Mt<Be;++Mt)for(var Ut=Mt*W-Ae,Z=ot;Z<Je;++Z)for(var j=Z*z-Y,me=Tt;me<Qe;++me)for(var Re=g*ne+w*Mt+v*Z+y*me,Pe=_*(T-1-Ut)+k*(A-1-j)+C*(N-1-(me*q-qe))+R*ie,ke=0;ke<U;++ke)ft+=f[Re+ke]*x[Pe+ke];a[u*ne+l*fe+c*lt+h*Xe+ie]=ft}return o.toTensor()},e.prototype.conv2dDerFilter=function(t,n,i){Le([t,n],"conv2dDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dataFormat==="channelsLast",c=Xt(i.filterShape,"float32"),h=i.padInfo.left,f=i.padInfo.top,m=this.bufferSync(t),g=this.bufferSync(n),w=0;w<s;++w)for(var v=Math.max(0,Math.ceil((f-w)/o)),y=Math.min(i.outHeight,(i.inHeight+f-w)/o),x=0;x<u;++x)for(var E=Math.max(0,Math.ceil((h-x)/a)),_=Math.min(i.outWidth,(i.inWidth+h-x)/a),k=0;k<i.inChannels;++k)for(var C=0;C<i.outChannels;++C){for(var R=0,I=0;I<i.batchSize;++I)for(var T=v;T<y;++T)for(var A=w+T*o-f,N=E;N<_;++N){var O=x+N*a-h;R+=l?m.get(I,A,O,k)*g.get(I,T,N,C):m.get(I,k,A,O)*g.get(I,C,T,N)}c.set(R,w,x,k,C)}return c.toTensor()},e.prototype.conv3dDerFilter=function(t,n,i){for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=Xt(i.filterShape,"float32"),f=h.values,m=h.strides,g=m[0],w=m[1],v=m[2],y=m[3],x=this.readSync(n.dataId),E=n.strides,_=E[0],k=E[1],C=E[2],R=E[3],I=this.readSync(t.dataId),T=t.strides,A=T[0],N=T[1],O=T[2],V=T[3],F=i.padInfo.front,B=i.padInfo.left,U=i.padInfo.top,P=0;P<u;++P)for(var L=Math.max(0,Math.ceil((F-P)/o)),H=Math.min(i.outDepth,(i.inDepth+F-P)/o),W=P*g,z=0;z<l;++z)for(var q=Math.max(0,Math.ceil((U-z)/a)),re=Math.min(i.outHeight,(i.inHeight+U-z)/a),de=z*w+W,ye=0;ye<c;++ye)for(var ne=Math.max(0,Math.ceil((B-ye)/s)),ie=Math.min(i.outWidth,(i.inWidth+B-ye)/s),fe=ye*v+de,Ae=0;Ae<i.inChannels;++Ae)for(var De=Ae*y+fe,Be=0;Be<i.outChannels;++Be){for(var lt=0,Y=0;Y<i.batchSize;++Y)for(var ot=Y*A,Je=Y*_,Xe=L;Xe<H;++Xe)for(var qe=(P+Xe*o-F)*N+ot,Tt=Xe*k+Je,Qe=q;Qe<re;++Qe)for(var ft=(z+Qe*a-U)*O+qe,Mt=Qe*C+Tt,Ut=ne;Ut<ie;++Ut){var Z=Ut*R+Mt;lt+=I[(ye+Ut*s-B)*V+ft+Ae]*x[Z+Be]}f[De+Be]=lt}return h.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var n=t.input,i=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,l=this.depthwiseConv2D(n,i,o);return a&&(l=this.add(l,a)),s&&(l=Zy(this,l,s,u)),l},e.prototype.depthwiseConv2D=function(t,n,i){Le([t,n],"depthwiseConv2D");for(var o=i.filterHeight,a=i.filterWidth,s=i.dilationHeight,u=i.dilationWidth,l=i.padInfo.left,c=i.padInfo.top,h=i.outChannels/i.inChannels,f=Xt(i.outShape,t.dtype),m=this.readSync(t.dataId),g=this.readSync(n.dataId),w=f.values,v=0;v<i.batchSize;++v)for(var y=v*t.strides[0],x=v*f.strides[0],E=0;E<i.outHeight;++E)for(var _=x+E*f.strides[1],k=E*i.strideHeight-l,C=0;C<o;++C){var R=k+C*s;if(!(R<0||R>=i.inHeight))for(var I=C*n.strides[0],T=y+R*t.strides[1],A=0;A<i.outWidth;++A)for(var N=_+A*f.strides[2],O=A*i.strideWidth-c,V=0;V<a;++V){var F=O+V*u;if(!(F<0||F>=i.inWidth))for(var B=I+V*n.strides[1],U=T+F*i.inChannels,P=N,L=B,H=0;H<i.inChannels;++H){for(var W=m[U+H],z=0;z<h;++z)w[P+z]+=W*g[L+z];P+=h,L+=h}}}return f.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,n,i){Le([t,n],"depthwiseConv2DDerInput");for(var o=Xt(i.inShape,"float32"),a=o.values,s=o.strides,u=s[0],l=s[1],c=s[2],h=this.readSync(t.dataId),f=t.strides,m=f[0],g=f[1],w=f[2],v=this.readSync(n.dataId),y=n.strides,x=y[0],E=y[1],_=y[2],k=i.batchSize,C=i.filterHeight,R=i.filterWidth,I=i.inChannels,T=i.inHeight,A=i.inWidth,N=i.outChannels,O=i.outHeight,V=i.outWidth,F=i.strideHeight,B=i.strideWidth,U=C-1-i.padInfo.top,P=R-1-i.padInfo.left,L=N/I,H=0;H<k;++H)for(var W=0;W<I;++W)for(var z=0;z<T;++z)for(var q=z-U,re=Math.max(0,Math.ceil(q/F)),de=Math.min(O,(C+q)/F),ye=0;ye<A;++ye){for(var ne=ye-P,ie=Math.max(0,Math.ceil(ne/B)),fe=Math.min(V,(R+ne)/B),Ae=0,De=re;De<de;++De)for(var Be=De*F-q,lt=ie;lt<fe;++lt)for(var Y=m*H+g*De+w*lt,ot=x*(C-1-Be)+E*(R-1-(lt*B-ne))+_*W,Je=0;Je<L;++Je)Ae+=h[Y+(W*L+Je)]*v[ot+Je];a[u*H+l*z+c*ye+W]=Ae}return o.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,n,i){Le([t,n],"depthwiseConv2DDerFilter");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=Xt(i.filterShape,"float32"),c=i.padInfo.left,h=i.padInfo.top,f=i.outChannels/i.inChannels,m=this.bufferSync(t),g=this.bufferSync(n),w=0;w<s;++w)for(var v=Math.max(0,Math.ceil((h-w)/o)),y=Math.min(i.outHeight,(i.inHeight+h-w)/o),x=0;x<u;++x)for(var E=Math.max(0,Math.ceil((c-x)/a)),_=Math.min(i.outWidth,(i.inWidth+c-x)/a),k=0;k<i.outChannels;++k){for(var C=Math.trunc(k/f),R=k%f,I=0,T=0;T<i.batchSize;++T)for(var A=v;A<y;++A)for(var N=w+A*o-h,O=E;O<_;++O){var V=x+O*a-c;I+=m.get(T,N,V,C)*g.get(T,A,O,k)}l.set(I,w,x,C,R)}return l.toTensor()},e.prototype.tile=function(t,n){return Le(t,"tile"),W3(this.bufferSync(t),n)},e.prototype.pad=function(t,n,i){Le(t,"pad");var o=n.map((function(f,m){return f[0]+t.shape[m]+f[1]})),a=n.map((function(f){return f[0]})),s=this.bufferSync(t),u=Xt(o,t.dtype);i!==0&&u.values.fill(i);for(var l=0;l<t.size;l++){var c=s.indexToLoc(l),h=c.map((function(f,m){return f+a[m]}));u.set.apply(u,[s.get.apply(s,c)].concat(h))}return u.toTensor()},e.prototype.gather=function(t,n,i){Le([t,n],"gather");var o=t.shape.slice(),a=this.readSync(n.dataId);o[i]=a.length;for(var s=Xt(o,t.dtype),u=this.bufferSync(t),l=0;l<s.size;++l){var c=s.indexToLoc(l),h=c.slice();h[i]=a[c[i]];var f=u.locToIndex(h);s.values[l]=u.values[f]}return s.toTensor()},e.prototype.batchToSpaceND=function(t,n,i){Le([t],"batchToSpaceND");var o=n.reduce((function(h,f){return h*f})),a=Rm(t.shape,n,o),s=Im(a.length,n.length),u=Dm(t.shape,n,o),l=b3(i,n.length),c=w3(u,i,n.length);return Mo(t.reshape(a),s).reshape(u).slice(l,c)},e.prototype.spaceToBatchND=function(t,n,i){Le([t],"spaceToBatchND");var o=n.reduce((function(f,m){return f*m})),a=[[0,0]];a.push.apply(a,i);for(var s=1+n.length;s<t.shape.length;++s)a.push([0,0]);var u=t.pad(a),l=Rm(u.shape,n,o,!1),c=Im(l.length,n.length,!1),h=Dm(u.shape,n,o,!1);return Mo(u.reshape(l),c).reshape(h)},e.prototype.maxPool=function(t,n){return Le(t,"maxPool"),yb(this.readSync(t.dataId),t.shape,t.dtype,t.strides,n,"max").toTensor()},e.prototype.maxPoolBackprop=function(t,n,i,o){Le([n,i],"maxPoolBackprop");for(var a=this.readSync(n.dataId),s=Xt(o.outShape,n.dtype,FM(a,n.shape,n.dtype,o).values),u=o.strideHeight,l=o.strideWidth,c=o.dilationHeight,h=o.dilationWidth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,g=m-1-o.padInfo.left,w=f-1-o.padInfo.top,v=Xt(n.shape,"float32"),y=this.bufferSync(t),x=0;x<o.batchSize;++x)for(var E=0;E<o.inChannels;++E)for(var _=0;_<o.inHeight;++_)for(var k=0;k<o.inWidth;++k){for(var C=_-w,R=k-g,I=0,T=0;T<f;T+=c){var A=(C+T)/u;if(!(A<0||A>=o.outHeight||Math.floor(A)!==A))for(var N=0;N<m;N+=h){var O=(R+N)/l;if(!(O<0||O>=o.outWidth||Math.floor(O)!==O)){var V=f*m-1-s.get(x,A,O,E)===T*m+N?1:0;V!==0&&(I+=y.get(x,A,O,E)*V)}}}v.set(I,x,_,k,E)}return v.toTensor()},e.prototype.avgPoolBackprop=function(t,n,i){Le([t,n],"avgPoolBackprop");for(var o=i.strideHeight,a=i.strideWidth,s=i.filterHeight,u=i.filterWidth,l=i.dilationHeight,c=i.dilationWidth,h=i.effectiveFilterHeight,f=i.effectiveFilterWidth,m=f-1-i.padInfo.left,g=h-1-i.padInfo.top,w=Xt(n.shape,"float32"),v=1/(s*u),y=this.bufferSync(t),x=0;x<i.batchSize;++x)for(var E=0;E<i.inChannels;++E)for(var _=0;_<i.inHeight;++_)for(var k=0;k<i.inWidth;++k){for(var C=_-g,R=k-m,I=0,T=0;T<h;T+=l){var A=(C+T)/o;if(!(A<0||A>=i.outHeight||Math.floor(A)!==A))for(var N=0;N<f;N+=c){var O=(R+N)/a;O<0||O>=i.outWidth||Math.floor(O)!==O||(I+=y.get(x,A,O,E))}}w.set(I*v,x,_,k,E)}return w.toTensor()},e.prototype.pool3d=function(t,n,i){Le(t,"pool3d");for(var o=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,m=n.effectiveFilterWidth,g=n.padInfo.front,w=n.padInfo.top,v=n.padInfo.left,y=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,x=this.readSync(t.dataId),E=Xt(n.outShape,t.dtype),_=E.values,k=n.outShape[1]*n.outShape[2]*n.outShape[3]*n.outShape[4],C=n.outShape[2]*n.outShape[3]*n.outShape[4],R=n.outShape[3]*n.outShape[4],I=n.outShape[4],T=0;T<n.batchSize;++T)for(var A=T*k,N=T*t.strides[0],O=0;O<n.inChannels;++O)for(var V=0;V<n.outDepth;++V){for(var F=V*o-g,B=F;B<0;)B+=u;for(var U=Math.min(n.inDepth,h+F),P=A+V*C,L=0;L<n.outHeight;++L){for(var H=L*a-w,W=H;W<0;)W+=l;for(var z=Math.min(n.inHeight,f+H),q=P+L*R,re=0;re<n.outWidth;++re){for(var de=re*s-v,ye=de;ye<0;)ye+=c;for(var ne=Math.min(n.inWidth,m+de),ie=q+re*I,fe=y,Ae=0,De=0,Be=B;Be<U;Be+=u){for(var lt=N+Be*t.strides[1],Y=W;Y<z;Y+=l){for(var ot=lt+Y*t.strides[2],Je=ye;Je<ne;Je+=c){var Xe=x[ot+Je*t.strides[3]+O];if(i==="max"&&Xe>fe?fe=Xe:i==="avg"&&(Ae+=Xe,De++),isNaN(fe))break}if(isNaN(fe))break}if(isNaN(fe))break}_[ie+O]=i==="avg"?Ae/De:fe}}}return E.toTensor()},e.prototype.avgPool3d=function(t,n){return Le(t,"avgPool3d"),this.pool3d(t,n,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,n,i){Le([t,n],"avgPool3dBackprop");for(var o=i.strideDepth,a=i.strideHeight,s=i.strideWidth,u=i.filterDepth,l=i.filterHeight,c=i.filterWidth,h=i.dilationDepth,f=i.dilationHeight,m=i.dilationWidth,g=i.effectiveFilterDepth,w=i.effectiveFilterHeight,v=i.effectiveFilterWidth,y=g-1-i.padInfo.front,x=v-1-i.padInfo.left,E=w-1-i.padInfo.top,_=Xt(n.shape,"float32"),k=1/(u*l*c),C=this.bufferSync(t),R=0;R<i.batchSize;++R)for(var I=0;I<i.inChannels;++I)for(var T=0;T<i.inDepth;++T)for(var A=0;A<i.inHeight;++A)for(var N=0;N<i.inWidth;++N){for(var O=T-y,V=A-E,F=N-x,B=0,U=0;U<g;U+=h){var P=(O+U)/o;if(!(P<0||P>=i.outDepth||Math.floor(P)!==P))for(var L=0;L<w;L+=f){var H=(V+L)/a;if(!(H<0||H>=i.outHeight||Math.floor(H)!==H))for(var W=0;W<v;W+=m){var z=(F+W)/s;z<0||z>=i.outWidth||Math.floor(z)!==z||(B+=C.get(R,P,H,z,I))}}}_.set(B*k,R,T,A,N,I)}return _.toTensor()},e.prototype.maxPool3d=function(t,n){return Le(t,"maxPool3d"),this.pool3d(t,n,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,n){for(var i=Xt(n.outShape,"int32"),o=n.strideDepth,a=n.strideHeight,s=n.strideWidth,u=n.dilationDepth,l=n.dilationHeight,c=n.dilationWidth,h=n.effectiveFilterDepth,f=n.effectiveFilterHeight,m=n.effectiveFilterWidth,g=n.padInfo.front,w=n.padInfo.top,v=n.padInfo.left,y=this.bufferSync(t),x=0;x<n.batchSize;++x)for(var E=0;E<n.inChannels;++E)for(var _=0;_<n.outDepth;++_){for(var k=_*o-g,C=k;C<0;)C+=u;for(var R=Math.min(n.inDepth,h+k),I=0;I<n.outHeight;++I){for(var T=I*a-w,A=T;A<0;)A+=l;for(var N=Math.min(n.inHeight,f+T),O=0;O<n.outWidth;++O){for(var V=O*s-v,F=V;F<0;)F+=c;for(var B=Math.min(n.inWidth,m+V),U=Number.NEGATIVE_INFINITY,P=-1,L=C;L<R;L+=u)for(var H=L-k,W=A;W<N;W+=l)for(var z=W-T,q=F;q<B;q+=c){var re=q-V,de=y.get(x,L,W,q,E);de>=U&&(U=de,P=H*f*m+z*f+re)}i.set(P,x,_,I,O,E)}}}return i.toTensor()},e.prototype.maxPool3dBackprop=function(t,n,i,o){Le([n,i],"maxPool3dBackprop");for(var a=this.maxPool3dPositions(n,o),s=o.strideDepth,u=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,h=o.dilationHeight,f=o.dilationWidth,m=o.effectiveFilterDepth,g=o.effectiveFilterHeight,w=o.effectiveFilterWidth,v=m-1-o.padInfo.front,y=w-1-o.padInfo.left,x=g-1-o.padInfo.top,E=Xt(n.shape,"float32"),_=this.bufferSync(a),k=this.bufferSync(t),C=0;C<o.batchSize;++C)for(var R=0;R<o.inChannels;++R)for(var I=0;I<o.inDepth;++I)for(var T=0;T<o.inHeight;++T)for(var A=0;A<o.inWidth;++A){for(var N=I-v,O=T-x,V=A-y,F=0,B=0;B<m;B+=c){var U=(N+B)/s;if(!(U<0||U>=o.outDepth||Math.floor(U)!==U))for(var P=0;P<g;P+=h){var L=(O+P)/u;if(!(L<0||L>=o.outHeight||Math.floor(L)!==L))for(var H=0;H<w;H+=f){var W=(V+H)/l;if(!(W<0||W>=o.outWidth||Math.floor(W)!==W)){var z=m*g*w-1-_.get(C,U,L,W,R)===B*g*w+P*w+H?1:0;z!==0&&(F+=k.get(C,U,L,W,R)*z)}}}}E.set(F,C,I,T,A,R)}return E.toTensor()},e.prototype.cast=function(t,n){return L3(t,n,this)},e.prototype.reshape=function(t,n){return gb(t,n)},e.prototype.avgPool=function(t,n){return Le(t,"avgPool"),Le(t,"maxPool"),yb(this.readSync(t.dataId),t.shape,t.dtype,t.strides,n,"avg").toTensor().toFloat()},e.prototype.resizeBilinear=function(t,n,i,o){Le(t,"resizeBilinear");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),f=new Float32Array(bt([s,n,i,c])),m=[o&&n>1?u-1:u,o&&i>1?l-1:l],g=[o&&n>1?n-1:n,o&&i>1?i-1:i],w=0,v=m[0]/g[0],y=m[1]/g[1],x=0;x<s;x++)for(var E=0;E<n;E++)for(var _=v*E,k=Math.floor(_),C=_-k,R=Math.min(u-1,Math.ceil(_)),I=x*t.strides[0]+k*t.strides[1],T=x*t.strides[0]+R*t.strides[1],A=0;A<i;A++)for(var N=y*A,O=Math.floor(N),V=N-O,F=Math.min(l-1,Math.ceil(N)),B=I+O*t.strides[2],U=T+O*t.strides[2],P=I+F*t.strides[2],L=T+F*t.strides[2],H=0;H<c;H++){var W=h[B+H],z=h[U+H],q=W+(h[P+H]-W)*V,re=q+(z+(h[L+H]-z)*V-q)*C;f[w++]=re}return Cr(f,[s,n,i,c])},e.prototype.resizeBilinearBackprop=function(t,n,i){Le([t,n],"resizeBilinearBackprop");for(var o=n.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],f=c[2],m=new Float32Array(a*s*u*l),g=[i&&h>1?s-1:s,i&&f>1?u-1:u],w=[i&&h>1?h-1:h,i&&f>1?f-1:f],v=g[0]/w[0],y=g[1]/w[1],x=this.readSync(t.dataId),E=0,_=0;_<a;_++)for(var k=_*n.strides[0],C=0;C<h;C++)for(var R=C*v,I=Math.floor(R),T=Math.min(Math.ceil(R),s-1),A=k+I*n.strides[1],N=k+T*n.strides[1],O=R-I,V=1-O,F=0;F<f;F++)for(var B=F*y,U=Math.floor(B),P=Math.min(Math.ceil(B),u-1),L=B-U,H=1-L,W=A+U*n.strides[2],z=A+P*n.strides[2],q=N+U*n.strides[2],re=N+P*n.strides[2],de=V*H,ye=V*L,ne=O*H,ie=O*L,fe=0;fe<l;fe++){var Ae=x[E++];m[W+fe]+=Ae*de,m[z+fe]+=Ae*ye,m[q+fe]+=Ae*ne,m[re+fe]+=Ae*ie}return ra(m,[a,u,s,l],n.dtype)},e.prototype.resizeNearestNeighbor=function(t,n,i,o){Le(t,"resizeNearestNeighbor");for(var a=t.shape,s=a[0],u=a[1],l=a[2],c=a[3],h=this.readSync(t.dataId),f=new Float32Array(s*n*i*c),m=[o&&n>1?u-1:u,o&&i>1?l-1:l],g=[o&&n>1?n-1:n,o&&i>1?i-1:i],w=m[0]/g[0],v=m[1]/g[1],y=0,x=0;x<s;x++)for(var E=x*t.strides[0],_=0;_<n;_++)for(var k=w*_,C=E+Math.min(u-1,o?Math.round(k):Math.floor(k))*t.strides[1],R=0;R<i;R++)for(var I=v*R,T=C+Math.min(l-1,o?Math.round(I):Math.floor(I))*t.strides[2],A=0;A<c;A++){var N=h[T+A];f[y++]=N}return Cr(f,[s,n,i,c],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,n,i){Le([t,n],"resizeNearestNeighborBackprop");for(var o=n.shape,a=o[0],s=o[1],u=o[2],l=o[3],c=t.shape,h=c[1],f=c[2],m=new Float32Array(a*s*u*l),g=this.readSync(t.dataId),w=[i&&h>1?s-1:s,i&&f>1?u-1:u],v=[i&&h>1?h-1:h,i&&f>1?f-1:f],y=w[0]/v[0],x=w[1]/v[1],E=1/y,_=1/x,k=2*Math.ceil(E)+2,C=2*Math.ceil(_)+2,R=0;R<a;R++)for(var I=R*n.strides[0],T=0;T<s;T++)for(var A=I+T*n.strides[1],N=Math.floor(T*E),O=Math.floor(N-k/2),V=0;V<u;V++)for(var F=A+V*n.strides[2],B=Math.floor(V*_),U=Math.floor(B-C/2),P=0;P<l;P++){for(var L=0,H=0;H<k;H++){var W=H+O;if(!(W<0||W>=h)){var z=I+W*t.strides[1],q=W*y;if(T===Math.min(s-1,i?Math.round(q):Math.floor(q)))for(var re=0;re<C;re++){var de=re+U;if(!(de<0||de>=f)){var ye=z+de*t.strides[2],ne=de*x;V===Math.min(u-1,i?Math.round(ne):Math.floor(ne))&&(L+=g[ye+P])}}}}m[F+P]=L}return ra(m,n.shape,n.dtype)},e.prototype.batchNormalization=function(t,n,i,o,a,s){Le([t,n,i,a,s],"batchNorm");for(var u=this.readSync(t.dataId),l=this.readSync(n.dataId),c=this.readSync(i.dataId),h=a?this.readSync(a.dataId):new Float32Array([1]),f=s?this.readSync(s.dataId):new Float32Array([0]),m=new Float32Array(u.length),g=f.length,w=h.length,v=c.length,y=l.length,x=0,E=0,_=0,k=0,C=0;C<u.length;++C)m[C]=f[x++]+(u[C]-l[E++])*h[_++]/Math.sqrt(c[k++]+o),x>=g&&(x=0),E>=y&&(E=0),_>=w&&(_=0),k>=v&&(k=0);return ra(m,t.shape)},e.prototype.localResponseNormalization4D=function(t,n,i,o,a){Le(t,"localResponseNormalization4D");var s=t.shape[3],u=s-1,l=this.readSync(t.dataId),c=t.size,h=new Float32Array(c);function f(v){for(var y=v%s,x=v-y+Math.max(0,y-n),E=v-y+Math.min(y+n,u),_=0;x<=E;x++){var k=l[x];_+=k*k}return _}for(var m=0;m<c;m++){var g=f(m),w=l[m]*Math.pow(i+o*g,-a);h[m]=w}return ra(h,t.shape)},e.prototype.LRNGrad=function(t,n,i,o,a,s,u){Le(t,"LRNGrad");for(var l=t.shape[3],c=this.readSync(t.dataId),h=this.readSync(n.dataId),f=this.readSync(i.dataId),m=new Float32Array(t.size),g=t.size,w=0;w<g;w++){for(var v=w%l,y=w-v+Math.max(0,v-o),x=w-v+Math.min(l,v+o+1),E=0,_=y;_<x;_++)E+=Math.pow(h[_],2);for(E=s*E+a,_=y;_<x;_++){var k=-2*s*u*h[_]*f[w]/E;w===_&&(k+=Math.pow(E,-u)),k*=c[w],m[_]+=k}}return ra(m,t.shape)},e.prototype.multinomial=function(t,n,i,o){Le(t,"multinomial");for(var a=n?t:ug(t),s=a.shape[0],u=a.shape[1],l=Xn([s,i],"int32"),c=this.readSync(l.dataId),h=this.readSync(a.dataId),f=0;f<s;++f){var m=f*u,g=new Float32Array(u-1);g[0]=h[m];for(var w=1;w<g.length;++w)g[w]=g[w-1]+h[m+w];for(var v=lg(o.toString()),y=f*i,x=0;x<i;++x){var E=v();c[y+x]=g.length;for(var _=0;_<g.length;_++)if(E<g[_]){c[y+x]=_;break}}}return l},e.prototype.oneHot=function(t,n,i,o){Le(t,"oneHot");var a=new Float32Array(t.size*n);a.fill(o);for(var s=this.readSync(t.dataId),u=0;u<t.size;++u)s[u]>=0&&s[u]<n&&(a[u*n+s[u]]=i);return Zu(a,[t.size,n],"int32")},e.prototype.nonMaxSuppression=function(t,n,i,o,a){return Le(t,"nonMaxSuppression"),Gw(this.readSync(t.dataId),this.readSync(n.dataId),i,o,a)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,n){for(var i=t.shape[0],o=t.shape[1],a=Xt(t.shape,"float32"),s=Xt(t.shape,"float32"),u=no(t).as2D(i,o),l=aa(t).as2D(i,o),c=0;c<i;c++)for(var h=u.slice([c,0],[1,o]),f=l.slice([c,0],[1,o]),m=Er(h,f),g=this.readSync(this.fftImpl(m,n).dataId),w=0;w<o;w++){var v=eE(g,w);a.values[c*o+w]=v.real,s.values[c*o+w]=v.imag}return Er(a.toTensor(),s.toTensor()).as2D(i,o)},e.prototype.fftImpl=function(t,n){var i=t.as1D(),o=i.size;if(this.isExponentOf2(o)){var a=this.fftRadix2(i,o,n).as2D(t.shape[0],t.shape[1]);return n&&(a=Er(no(a).div(Ct(o)),aa(a).div(Ct(o)))),a}var s=this.readSync(t.dataId),u=(function(l){for(var c=new Float32Array(l.length/2),h=new Float32Array(l.length/2),f=0;f<l.length;f+=2)c[f/2]=l[f],h[f/2]=l[f+1];return{real:c,imag:h}})(this.fourierTransformByMatmul(s,o,n));return Er(u.real,u.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return(t&t-1)==0},e.prototype.fftRadix2=function(t,n,i){if(n===1)return t;var o=this.readSync(t.dataId),a=n/2,s=(function(y){for(var x=Math.ceil(y.length/4),E=new Float32Array(x),_=new Float32Array(x),k=0;k<y.length;k+=4)E[Math.floor(k/4)]=y[k],_[Math.floor(k/4)]=y[k+1];return{real:E,imag:_}})(o),u=Er(s.real,s.imag).as1D(),l=(function(y){for(var x=Math.floor(y.length/4),E=new Float32Array(x),_=new Float32Array(x),k=2;k<y.length;k+=4)E[Math.floor(k/4)]=y[k],_[Math.floor(k/4)]=y[k+1];return{real:E,imag:_}})(o),c=Er(l.real,l.imag).as1D();u=this.fftRadix2(u,a,i),c=this.fftRadix2(c,a,i);var h=(function(y,x){for(var E=new Float32Array(y/2),_=new Float32Array(y/2),k=0;k<Math.ceil(y/2);k++){var C=(x?2:-2)*Math.PI*(k/y);E[k]=Math.cos(C),_[k]=Math.sin(C)}return{real:E,imag:_}})(n,i),f=Er(h.real,h.imag).mul(c),m=u.add(f),g=u.sub(f),w=no(m).concat(no(g)),v=aa(m).concat(aa(g));return Er(w,v).as1D()},e.prototype.fourierTransformByMatmul=function(t,n,i){for(var o=new Float32Array(2*n),a=0;a<n;a++){for(var s=0,u=0,l=0;l<n;l++){var c=q6(a*l,n,i),h=eE(t,l);s+=h.real*c.real-h.imag*c.imag,u+=h.real*c.imag+h.imag*c.real}i&&(s/=n,u/=n),j6(o,s,u,a)}return o},e.prototype.depthToSpace=function(t,n,i){K(i==="NHWC",(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+i})),K(n>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+n}));for(var o=t.shape[0],a=t.shape[1],s=t.shape[2],u=t.shape[3],l=a*n,c=s*n,h=u/(n*n),f=this.readSync(t.dataId),m=new Float32Array(o*l*c*h),g=0,w=0;w<o;++w)for(var v=0;v<l;++v)for(var y=Math.floor(v/n),x=v%n,E=0;E<c;++E)for(var _=Math.floor(E/n),k=(x*n+E%n)*h,C=0;C<h;++C){var R=C+k+u*(_+s*(y+a*w));m[g++]=f[R]}return ra(m,[o,l,c,h])},e.prototype.broadcastedBinaryOp=function(t,n,i,o){var a=on(t.shape,n.shape),s=Xt(a,i),u=this.readSync(t.dataId),l=this.readSync(n.dataId),c=js(t.shape,a),h=js(n.shape,a),f=s.values;if(c.length+h.length===0)for(var m=0;m<f.length;++m)f[m]=o(u[m%u.length],l[m%l.length]);else{var g=this.bufferSync(t),w=this.bufferSync(n),v=function(y){var x=s.indexToLoc(y),E=x.slice(-t.rank);c.forEach((function(R){return E[R]=0}));var _=g.locToIndex(E),k=x.slice(-n.rank);h.forEach((function(R){return k[R]=0}));var C=w.locToIndex(k);f[y]=o(u[_],l[C])};for(m=0;m<f.length;++m)v(m)}return s.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,n,i){var o=on(t.shape,n.shape),a=Xt(o,"float32"),s=Xt(o,"float32"),u=this.readSync(t.dataId),l=this.readSync(n.dataId),c=js(t.shape,o),h=js(n.shape,o),f=a.values,m=s.values;if(c.length+h.length===0)for(var g=0;g<f.length;g++){var w=g%u.length,v=g%l.length,y=i(u[2*w],u[2*w+1],l[2*v],l[2*v+1]);f[g]=y.real,m[g]=y.imag}else{var x=this.bufferSync(this.data.get(t.dataId).complexTensors.real),E=this.bufferSync(this.data.get(n.dataId).complexTensors.real),_=function(k){var C=a.indexToLoc(k),R=C.slice(-t.rank);c.forEach((function(O){return R[O]=0}));var I=x.locToIndex(R),T=C.slice(-n.rank);h.forEach((function(O){return T[O]=0}));var A=E.locToIndex(T),N=i(u[2*I],u[2*I+1],l[2*A],l[2*A+1]);f[k]=N.real,m[k]=N.imag};for(g=0;g<f.length;g++)_(g)}return this.complex(a.toTensor(),s.toTensor())},e.prototype.split=function(t,n,i){return z3(t,n,i)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,n,i,o,a,s){for(var u=t.shape,l=u[0],c=u[1],h=u[2],f=u[3],m=n.shape[0],g=o[0],w=o[1],v=Xt([m,g,w,f],"float32"),y=this.readSync(n.dataId),x=this.readSync(i.dataId),E=this.readSync(t.dataId),_=t.strides,k=v.strides,C=0;C<m;C++){var R=4*C,I=y[R],T=y[R+1],A=y[R+2],N=y[R+3],O=x[C];if(!(O>=l))for(var V=g>1?(A-I)*(c-1)/(g-1):0,F=w>1?(N-T)*(h-1)/(w-1):0,B=0;B<g;B++){var U=g>1?I*(c-1)+B*V:.5*(I+A)*(c-1);if(U<0||U>c-1)for(var P=0;P<w;P++)for(var L=0;L<f;L++){var H=L+P*k[2]+B*k[1]+C*k[0];v.values[H]=s}else if(a==="bilinear"){var W=Math.floor(U),z=Math.ceil(U),q=U-W;for(P=0;P<w;P++)if((Be=w>1?T*(h-1)+P*F:.5*(T+N)*(h-1))<0||Be>h-1)for(L=0;L<f;L++)H=L+P*k[2]+B*k[1]+C*k[0],v.values[H]=s;else{var re=Math.floor(Be),de=Math.ceil(Be),ye=Be-re;for(L=0;L<f;L++){var ne=E[H=L+re*_[2]+W*_[1]+O*_[0]],ie=E[H=L+de*_[2]+W*_[1]+O*_[0]],fe=E[H=L+re*_[2]+z*_[1]+O*_[0]],Ae=ne+(ie-ne)*ye,De=fe+(E[H=L+de*_[2]+z*_[1]+O*_[0]]-fe)*ye;H=L+P*k[2]+B*k[1]+C*k[0],v.values[H]=Ae+(De-Ae)*q}}}else for(P=0;P<w;++P){var Be;if((Be=w>1?T*(h-1)+P*F:.5*(T+N)*(h-1))<0||Be>h-1)for(L=0;L<f;L++)H=L+P*k[2]+B*k[1]+C*k[0],v.values[H]=s;else{var lt=Math.round(Be),Y=Math.round(U);for(L=0;L<f;L++){var ot=L+lt*_[2]+Y*_[1]+O*_[0],Je=L+P*k[2]+B*k[1]+C*k[0];v.values[Je]=E[ot]}}}}}return v.toTensor()},e.prototype.sparseToDense=function(t,n,i,o){var a=Pm(0,t,i),s=a.sliceRank,u=a.numUpdates,l=a.sliceSize,c=a.strides,h=a.outputSize;return this.scatter(t,n,i,h,l,u,s,c,o,!1)},e.prototype.gatherND=function(t,n){var i=n.shape,o=i[i.length-1],a=R3(t,n),s=a[0],u=a[1],l=a[2],c=a[3];if(u===0)return Cr([],s,t.dtype);for(var h=new td([u,l],t.dtype),f=this.readSync(n.dataId),m=this.readSync(t.dataId),g=0;g<u;g++){for(var w=[],v=0,y=0;y<o;y++){var x=f[g*o+y];v+=x*c[y],w.push(x)}if(v<0||v>=t.size/l)throw new Error("Invalid indices: "+w+" does not index into "+t.shape);for(var E=0;E<l;E++)h.values[g*l+E]=m[v*l+E]}return h.toTensor().reshape(s)},e.prototype.scatterND=function(t,n,i){var o=Pm(0,t,i),a=o.sliceRank,s=o.numUpdates,u=o.sliceSize,l=o.strides,c=o.outputSize,h=Ct(0);return this.scatter(t,n,i,c,u,s,a,l,h,!0)},e.prototype.fill=function(t,n,i){var o=Sm(i=i||kd(n),bt(t));return o.fill(n),le.makeTensor(o,t,i,this)},e.prototype.onesLike=function(t){if(t.dtype==="string")throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var n=Sm(t.dtype,bt(t.shape));return this.makeOutput(n,t.shape,t.dtype)},e.prototype.linspace=function(t,n,i){return B3(t,n,i)},e.prototype.scatter=function(t,n,i,o,a,s,u,l,c,h){var f=[o/a,a],m=this.readSync(t.dataId),g=this.readSync(n.dataId);if(o===0)return Cr([],i,n.dtype);var w=new td(f,n.dtype);w.values.fill(this.readSync(c.dataId)[0]);for(var v=0;v<s;v++){for(var y=[],x=0,E=0;E<u;E++){var _=m[v*u+E];y.push(_),x+=_*l[E]}if(x<0||x>=o/a)throw new Error("Invalid indices: "+y+" does not index into "+i);for(var k=0;k<a;k++)h?w.values[x*a+k]+=g[v*a+k]:w.values[x*a+k]=n.rank===0?g[0]:g[v*a+k]}return w.toTensor().reshape(i)},e})(F3);function OM(r,e){return{kernelName:r,backendName:"cpu",kernelFunc:function(t){var n=t.inputs,i=t.backend,o=n,a=o.a,s=o.b,u=i;Le([a,s],r);var l=u.data.get(a.dataId).values,c=u.data.get(s.dataId).values,h=e(a.shape,s.shape,l,c,a.dtype),f=h[0],m=h[1];return{dataId:u.write(f,m,a.dtype),shape:m,dtype:a.dtype}}}}function LM(r){return function(e,t,n,i,o){var a=on(e,t),s=a.length,u=Wi(a),l=Lc(o,bt(a)),c=e.length,h=t.length,f=Wi(e),m=Wi(t),g=js(e,a),w=js(t,a);if(g.length+w.length===0)for(var v=0;v<l.length;++v)l[v]=r(n[v%n.length],i[v%i.length]);else{var y=function(x){var E=s3(x,s,u),_=E.slice(-c);g.forEach((function(I){return _[I]=0}));var k=lb(_,c,f),C=E.slice(-h);w.forEach((function(I){return C[I]=0}));var R=lb(C,h,m);l[x]=r(n[k],i[R])};for(v=0;v<l.length;++v)y(v)}return[l,a]}}le.registerBackend("cpu",(function(){return new q9}),1);var $9=LM((function(r,e){return r/e})),X9=OM(og,$9),Y9={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,i=e.x,o=t,a=o.filterSize,s=o.strides,u=o.pad,l=o.includeBatchInIndex,c=n;Le(i,"MaxPoolWithArgmax");var h=c.data.get(i.dataId).values,f=rl(i.shape,a,s,[1,1],u),m=(function(x,E,_,k,C){var R=yb(x,0,_,Wi(E),C,"max"),I=FM(x,E,_,C,!0,k);return[R.values,I.values]})(h,i.shape,i.dtype,l,f),g=m[0],w=m[1],v=c.write(g,f.outShape,i.dtype),y=c.write(w,f.outShape,i.dtype);return[{dataId:v,shape:f.outShape,dtype:i.dtype},{dataId:y,shape:f.outShape,dtype:"int32"}]}},K9={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e,o=i.boxes,a=i.scores,s=n,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,f=t;Le(o,"NonMaxSuppressionWithScore");var m=Vw(f.data.get(o.dataId).values,f.data.get(a.dataId).values,u,l,c,h);return[m.selectedIndices,m.selectedScores]}},J9={kernelName:"Square",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t;Le(n,"square");for(var o=i.data.get(n.dataId).values,a=new Float32Array(o.length),s=0;s<o.length;++s){var u=o[s];a[s]=u*u}return{dataId:i.write(a,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}},Z9=LM((function(r,e){var t=r-e;return t*t}));function BM(r,e,t,n,i){for(var o=bt(e),a=e.length,s=Wi(e),u=Wi(i),l=Lc(t,bt(i)),c=0;c<o;++c){for(var h=s3(c,a,s),f=new Array(h.length),m=0;m<f.length;m++)f[m]=h[n[m]];l[lb(f,a,u)]=r[c]}return l}for(var Qy=0,xE=[K9,J9,OM(ag,Z9),X9,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,i=e.x,o=t.perm,a=n;Le(i,"transpose");for(var s=i.shape.length,u=new Array(s),l=0;l<u.length;l++)u[l]=i.shape[o[l]];var c=BM(a.data.get(i.dataId).values,i.shape,i.dtype,o,u);return{dataId:a.write(c,u,i.dtype),shape:u,dtype:i.dtype}}},Y9];Qy<xE.length;Qy++)e3(xE[Qy]);var Hl,Q9=function(r){this.variableNames=["A"];var e=Wr(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(`+n+".0, "+t+`.0);

        vec4 values = `+e.texture2D+`(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `},ez=function(r){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=Wr(),t=r[0],n=r[1];this.outputShape=r,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(`+n+".0, "+t+`.0);
            vec4 values = `+e.texture2D+`(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        `+e.output+` = result;
      }
    `},tz=function(r,e){this.variableNames=["A"];for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];this.outputShape=t,this.rank=t.length;var i=Fn(this.rank),o=(function(a){var s=a.length;if(s>6)throw Error("Transpose for rank "+s+" is not yet supported");for(var u=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],l=new Array(s),c=0;c<a.length;c++)l[a[c]]=u[c];return l.join()})(e);this.userCode=`
    void main() {
      `+i+` resRC = getOutputCoords();
      setOutput(getA(`+o+`));
    }
    `},nz=function(r,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var t=new Array(r.length),n=0;n<t.length;n++)t[n]=r[e[n]];if(this.outputShape=t,this.rank=t.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var i=Fn(this.rank),o=G3("rc",this.rank),a=new Array(this.rank);for(n=0;n<e.length;n++)a[e[n]]=o[n];var s="vec2("+a.slice(-2).join()+")",u="++"+o[this.rank-1]+" < "+t[this.rank-1],l="getChannel(getA("+a.join()+"), "+s+")";this.userCode=`
    void main() {
      `+i+` rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = `+l+`;
      if(`+u+`) {
        result[1] = `+l+`;
      }
      --`+o[this.rank-1]+`;
      if(++`+o[this.rank-2]+" < "+t[this.rank-2]+`) {
        result[2] = `+l+`;
        if(`+u+`) {
          result[3] = `+l+`;
        }
      }
      setOutput(result);
    }
    `};for(var e0=0,SE=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs,i=e.pixels,o=n.numChannels,a=typeof HTMLVideoElement<"u"&&i instanceof HTMLVideoElement,s=typeof HTMLImageElement<"u"&&i instanceof HTMLImageElement,u=a?[i.videoWidth,i.videoHeight]:[i.width,i.height],l=u[0],c=u[1],h=[c,l],f=[c,l,o];(s||a)&&(Hl==null&&(Hl=document.createElement("canvas").getContext("2d")),Hl.canvas.width=l,Hl.canvas.height=c,Hl.drawImage(i,0,0,l,c),i=Hl.canvas);var m=t.makeTensorInfo(h,"int32");t.texData.get(m.dataId).usage=Li.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(m.dataId),i);var g=Ne().getBool("WEBGL_PACK")?new ez(f):new Q9(f),w=t.runWebGLProgram(g,[m],"int32");return t.disposeData(m.dataId),w}},{kernelName:og,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e;return(function(i,o,a){var s=new qn(d8,i.shape,o.shape);return Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(s=new Qo(f8,i.shape,o.shape,!0)),a.runWebGLProgram(s,[i,o],"float32")})(n.a,n.b,t)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=r.attrs;Tm("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var i=e,o=i.boxes,a=i.scores,s=n,u=s.maxOutputSize,l=s.iouThreshold,c=s.scoreThreshold,h=s.softNmsSigma,f=t,m=Vw(f.readSync(o.dataId),f.readSync(a.dataId),u,l,c,h);return[m.selectedIndices,m.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e.x,i=t,o=new Kt(n.shape,"return x * x;");return i.runWebGLProgram(o,[n],n.dtype)}},{kernelName:ag,backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.backend,n=e,i=n.a,o=n.b,a=t,s=Ne().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Qo("return (a - b) * (a - b);",i.shape,o.shape):new qn("return (a - b) * (a - b);",i.shape,o.shape);return a.compileAndRun(s,[i,o])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(r){for(var e,t=r.inputs,n=r.attrs,i=r.backend,o=t.x,a=n.perm,s=i,u=o.shape.length,l=new Array(u),c=0;c<l.length;c++)l[c]=o.shape[a[c]];if(s.shouldExecuteOnCPU([o])){var h=BM(s.texData.get(o.dataId).values,o.shape,o.dtype,a,l);e=s.makeTensorInfo(l,o.dtype),s.texData.get(e.dataId).values=h}else e=(function(f,m,g){var w=Ne().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nz(f.shape,m):new tz(f.shape,m);return g.runWebGLProgram(w,[f],f.dtype)})(o,a,s);return e}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(r){var e=r.inputs,t=r.attrs,n=r.backend,i=e.x,o=t,a=o.filterSize,s=o.strides,u=o.pad,l=o.includeBatchInIndex,c=n;K(i.shape.length===4,(function(){return"Error in maxPool: input must be rank 4 but got rank "+i.shape.length+"."}));var h=[1,1];K(ri(s,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+h+"'"}));var f=rl(i.shape,a,s,h,u),m=(function(g,w,v,y){var x=new Yh(v,"max",!1),E=y.runWebGLProgram(x,[g],"float32");return x=new Yh(v,"max",!0,!0,w),[E,y.runWebGLProgram(x,[g],"float32")]})(i,l,f,c);return[m[0],m[1]]}}];e0<SE.length;e0++)e3(SE[e0]);for(var t0=0,EE=[{kernelName:_3,inputsToSave:["a","b"],gradFunc:function(r,e){var t=e[0],n=e[1],i=on(t.shape,n.shape);return{a:function(){var o=r,a=ar(t.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(t.shape)},b:function(){var o=r,a=ar(n.shape,i);return a.length>0&&(o=o.sum(a)),o.reshape(n.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(r,e){var t={};return e.forEach((function(n,i){t[i]=function(){return r.clone()}})),t}},{kernelName:x3,gradFunc:function(r,e,t){for(var n=t,i=n.inputShape,o=n.shape,a=Array.from(o),s=i.length-1;s>=0;s--)if(i[s]===o[s])a[s]=1;else if(i[s]!==1)throw new Error("broadcastTo(): ["+i+"] cannot be broadcast to ["+o+"].");var u=[];for(s=0;s<a.length;s++)a[s]>1&&u.push(s);return{x:function(){return r.sum(u,!0)}}}},{kernelName:og,inputsToSave:["a","b"],gradFunc:function(r,e){var t=e[0],n=e[1],i=on(t.shape,n.shape);return{a:function(){var o=eu(r,n.toFloat()),a=ar(t.shape,i);return a.length>0?Hs(o,a).reshape(t.shape):o},b:function(){var o=r.mul(t.toFloat()),a=ar(n.shape,i);a.length>0&&(o=Hs(o,a).reshape(n.shape));var s=hM(n);return Uw(eu(o,s.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(r,e,t){var n=t.varianceEpsilon,i=e[0],o=e[1],a=e[2],s=e[3],u=eM(i),l=s??Ct(1),c=ar(o.shape,u.shape),h=[];if(o.rank===1){for(var f=0;f<u.shape.length-1;++f)h.push(u.shape[f]);h.push(1)}var m=Lo(i,o),g=$n(r,l),w=T3(lo(a,Ct(n))),v=$n($n($n(w,w),w),Ct(-.5));return{x:function(){return o.rank===1?Ua($n($n(r,kc(w.as4D(1,1,1,o.shape[0]),h)),l),i.shape):Ua($n($n(r,w),l),i.shape)},mean:function(){var y=$n($n(w,Ct(-1)),g);return o.rank===1&&(y=Hs(y,c)),Ua(y,o.shape)},variance:function(){var y=$n($n(v,m),g);return o.rank===1&&(y=Hs(y,c)),Ua(y,o.shape)},scale:function(){var y=$n(m,w),x=$n(r,y);return o.rank===1&&(x=Hs(x,c)),Ua(x,o.shape)},offset:function(){var y=r;return o.rank===1&&(y=Hs(y,c)),Ua(y,o.shape)}}}},{kernelName:E3,gradFunc:function(r){return{x:function(){return r.toFloat()}}}},{kernelName:S3,inputsToSave:["indices"],gradFunc:function(r,e){var t=e[0];return{indices:function(){return Xn(t.shape,"float32")}}}},{kernelName:C3,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],i=t.paddings.map((function(o){return o[0]}));return{x:function(){return r.slice(i,n.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(r,e){var t=e[0];return{x:function(){return r.mul(t.toFloat().mul(2))}}}},{kernelName:ag,inputsToSave:["a","b"],gradFunc:function(r,e){var t=e[0],n=e[1],i=Ct(2);return{a:function(){return $n(r,$n(i,Lo(t,n)))},b:function(){return $n(r,$n(i,Lo(n,t)))}}}},{kernelName:k3,inputsToSave:["x"],gradFunc:function(r,e,t){var n=e[0],i=t.reps;return{x:function(){var o=hn(n);if(n.rank===1)for(var a=0;a<i[0];++a)o=o.add(r.slice([a*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(a=0;a<i[0];++a)for(var s=0;s<i[1];++s)o=o.add(r.slice([a*n.shape[0],s*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(a=0;a<i[0];++a)for(s=0;s<i[1];++s)for(var u=0;u<i[2];++u)o=o.add(r.slice([a*n.shape[0],s*n.shape[1],u*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else{if(n.rank!==4)throw new Error("Gradient for tile operation is not implemented for rank-"+n.rank+" tensors yet.");for(a=0;a<i[0];++a)for(s=0;s<i[1];++s)for(u=0;u<i[2];++u)for(var l=0;l<i[3];++l)o=o.add(r.slice([a*n.shape[0],s*n.shape[1],u*n.shape[2],l*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]))}return o}}}},{kernelName:"Transpose",gradFunc:function(r,e,t){var n=Lw(t.perm);return{x:function(){return Mo(r,n)}}}}];t0<EE.length;t0++)HL(EE[t0]);var rz=(function(){function r(){}return r.prototype.fetch=function(e,t){return fetch(e,t)},r.prototype.now=function(){return performance.now()},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Browser's encoder only supports utf-8, but got "+t);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return new TextDecoder(t).decode(e)},r})();Ne().get("IS_BROWSER")&&Ne().setPlatform("browser",new rz);var n0,iz=function(){return require("node-fetch")},oz=(function(){function r(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}return r.prototype.fetch=function(e,t){return Ne().global.fetch!=null?Ne().global.fetch(e,t):(n0==null&&(n0=iz()),n0(e,t))},r.prototype.now=function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6},r.prototype.encode=function(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error("Node built-in encoder only supports utf-8, but got "+t);return this.textEncoder.encode(e)},r.prototype.decode=function(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)},r})();Ne().get("IS_NODE")&&Ne().setPlatform("node",new oz);var bb={float32:4,int32:4,uint16:2,uint8:1,bool:1},zm=4;function UM(r,e){for(var t={},n=0,i=function(s){var u=s.name,l=s.dtype,c=s.shape,h=bt(c),f=void 0;if("quantization"in s){var m=s.quantization;if(m.dtype!=="uint8"&&m.dtype!=="uint16")throw new Error("Weight "+s.name+" has unknown quantization dtype "+m.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var g=bb[m.dtype],w=r.slice(n,n+h*g),v=m.dtype==="uint8"?new Uint8Array(w):new Uint16Array(w);if(l==="float32")f=Float32Array.from(v,(function(C){return C*m.scale+m.min}));else{if(l!=="int32")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=Int32Array.from(v,(function(C){return Math.round(C*m.scale+m.min)}))}n+=h*g}else if(l==="string"){var y=bt(s.shape);f=[];for(var x=0;x<y;x++){var E=new Uint32Array(r.slice(n,n+zm))[0];n+=zm;var _=new Uint8Array(r.slice(n,n+E));f.push(_),n+=E}}else{var k=bb[l];if(w=r.slice(n,n+h*k),l==="float32")f=new Float32Array(w);else if(l==="int32")f=new Int32Array(w);else{if(l!=="bool")throw new Error("Unsupported dtype in weight '"+u+"': "+l);f=new Uint8Array(w)}n+=h*k}t[u]=Cr(f,c,l)},o=0,a=e;o<a.length;o++)i(a[o]);return t}function az(r){if(r===null)throw new Error("Invalid input value: "+JSON.stringify(r));var e=0,t=[];r.forEach((function(o){if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+o.constructor.name)}));var n=new Uint8Array(e),i=0;return t.forEach((function(o){n.set(new Uint8Array(o.buffer),i),i+=o.byteLength})),n.buffer}var wb=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function kE(r){return wb?Buffer.byteLength(r):new Blob([r]).size}function s1(r){var e=0;r.forEach((function(i){e+=i.byteLength}));var t=new Uint8Array(e),n=0;return r.forEach((function(i){t.set(new Uint8Array(i),n),n+=i.byteLength})),t.buffer}function CE(r){for(r=r.trim();r.endsWith("/");)r=r.slice(0,r.length-1);var e=r.split("/");return e[e.length-1]}function Id(r){if(r.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:r.modelTopology==null?0:kE(JSON.stringify(r.modelTopology)),weightSpecsBytes:r.weightSpecs==null?0:kE(JSON.stringify(r.weightSpecs)),weightDataBytes:r.weightData==null?0:r.weightData.byteLength}}var Bi=(function(){function r(){this.saveRouters=[],this.loadRouters=[]}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerSaveRouter=function(e){r.getInstance().saveRouters.push(e)},r.registerLoadRouter=function(e){r.getInstance().loadRouters.push(e)},r.getSaveHandlers=function(e){return r.getHandlers(e,"save")},r.getLoadHandlers=function(e,t){return r.getHandlers(e,"load",t)},r.getHandlers=function(e,t,n){var i=[];return(t==="load"?r.getInstance().loadRouters:r.getInstance().saveRouters).forEach((function(o){var a=o(e,n);a!==null&&i.push(a)})),i},r})(),Cc="://",Xs=(function(){function r(){this.managers={}}return r.getInstance=function(){return r.instance==null&&(r.instance=new r),r.instance},r.registerManager=function(e,t){K(e!=null,(function(){return"scheme must not be undefined or null."})),e.endsWith(Cc)&&(e=e.slice(0,e.indexOf(Cc))),K(e.length>0,(function(){return"scheme must not be an empty string."}));var n=r.getInstance();K(n.managers[e]==null,(function(){return"A model store manager is already registered for scheme '"+e+"'."})),n.managers[e]=t},r.getManager=function(e){var t=this.getInstance().managers[e];if(t==null)throw new Error("Cannot find model manager for scheme '"+e+"'");return t},r.getSchemes=function(){return Object.keys(this.getInstance().managers)},r})();function Zp(r){if(r.indexOf(Cc)===-1)throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Xs.getSchemes().join(","));return{scheme:r.split(Cc)[0],path:r.split(Cc)[1]}}function TE(r,e,t){return t===void 0&&(t=!1),wt(this,void 0,void 0,(function(){var n,i,o,a,s,u,l,c,h;return _t(this,(function(f){switch(f.label){case 0:return K(r!==e,(function(){return"Old path and new path are the same: '"+r+"'"})),K((n=Bi.getLoadHandlers(r)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+r+"."})),K(n.length<2,(function(){return"Copying failed because more than one ("+n.length+") load handlers for source URL "+r+"."})),i=n[0],K((o=Bi.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),K(o.length<2,(function(){return"Copying failed because more than one ("+n.length+") save handlers for destination URL "+e+"."})),a=o[0],s=Zp(r).scheme,u=Zp(r).path,l=s===Zp(r).scheme,[4,i.load()];case 1:return c=f.sent(),t&&l?[4,Xs.getManager(s).removeModel(u)]:[3,3];case 2:f.sent(),f.label=3;case 3:return[4,a.save(c)];case 4:return h=f.sent(),!t||l?[3,6]:[4,Xs.getManager(s).removeModel(u)];case 5:f.sent(),f.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var Xu="models_store",qs="model_info_store";function zM(){if(!Ne().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var r=window||self,e=r.indexedDB||r.mozIndexedDB||r.webkitIndexedDB||r.msIndexedDB||r.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function _b(r){var e=r.result;e.createObjectStore(Xu,{keyPath:"modelPath"}),e.createObjectStore(qs,{keyPath:"modelPath"})}var Tc=(function(){function r(e){if(this.indexedDB=zM(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}return r.prototype.save=function(e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,e)]}))}))},r.prototype.load=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,this.databaseAction(this.modelPath)]}))}))},r.prototype.databaseAction=function(e,t){var n=this;return new Promise((function(i,o){var a=n.indexedDB.open("tensorflowjs",1);a.onupgradeneeded=function(){return _b(a)},a.onsuccess=function(){var s=a.result;if(t==null){var u=s.transaction(Xu,"readonly"),l=u.objectStore(Xu).get(n.modelPath);l.onsuccess=function(){if(l.result==null)return s.close(),o(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));i(l.result.modelArtifacts)},l.onerror=function(w){return s.close(),o(l.error)},u.oncomplete=function(){return s.close()}}else{var c,h=Id(t),f=s.transaction(qs,"readwrite"),m=f.objectStore(qs),g=m.put({modelPath:n.modelPath,modelArtifactsInfo:h});g.onsuccess=function(){var w=(c=s.transaction(Xu,"readwrite")).objectStore(Xu).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:h});w.onsuccess=function(){return i({modelArtifactsInfo:h})},w.onerror=function(v){var y=(m=f.objectStore(qs)).delete(n.modelPath);y.onsuccess=function(){return s.close(),o(w.error)},y.onerror=function(x){return s.close(),o(w.error)}}},g.onerror=function(w){return s.close(),o(g.error)},f.oncomplete=function(){c==null?s.close():c.oncomplete=function(){return s.close()}}}},a.onerror=function(s){return o(a.error)}}))},r.URL_SCHEME="indexeddb://",r})(),ME=function(r){return Ne().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Tc.URL_SCHEME)?(e=r.slice(Tc.URL_SCHEME.length),new Tc(e)):null;var e};Bi.registerSaveRouter(ME),Bi.registerLoadRouter(ME);var sz=(function(){function r(){this.indexedDB=zM()}return r.prototype.listModels=function(){return wt(this,void 0,void 0,(function(){var e=this;return _t(this,(function(t){return[2,new Promise((function(n,i){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return _b(o)},o.onsuccess=function(){var a=o.result,s=a.transaction(qs,"readonly"),u=s.objectStore(qs).getAll();u.onsuccess=function(){for(var l={},c=0,h=u.result;c<h.length;c++){var f=h[c];l[f.modelPath]=f.modelArtifactsInfo}n(l)},u.onerror=function(l){return a.close(),i(u.error)},s.oncomplete=function(){return a.close()}},o.onerror=function(a){return i(o.error)}}))]}))}))},r.prototype.removeModel=function(e){return wt(this,void 0,void 0,(function(){var t=this;return _t(this,(function(n){var i;return e=(i=e).startsWith(Tc.URL_SCHEME)?i.slice(Tc.URL_SCHEME.length):i,[2,new Promise((function(o,a){var s=t.indexedDB.open("tensorflowjs",1);s.onupgradeneeded=function(){return _b(s)},s.onsuccess=function(){var u,l=s.result,c=l.transaction(qs,"readwrite"),h=c.objectStore(qs),f=h.get(e);f.onsuccess=function(){if(f.result==null)return l.close(),a(new Error("Cannot find model with path '"+e+"' in IndexedDB."));var m=h.delete(e),g=function(){var w=(u=l.transaction(Xu,"readwrite")).objectStore(Xu).delete(e);w.onsuccess=function(){return o(f.result.modelArtifactsInfo)},w.onerror=function(v){return a(f.error)}};m.onsuccess=g,m.onerror=function(w){return g(),l.close(),a(f.error)}},f.onerror=function(m){return l.close(),a(f.error)},c.oncomplete=function(){u==null?l.close():u.oncomplete=function(){return l.close()}}},s.onerror=function(u){return a(s.error)}}))]}))}))},r})();if(Ne().getBool("IS_BROWSER"))try{Xs.registerManager(Tc.URL_SCHEME,new sz)}catch{}var Wa="/",fc="tensorflowjs_models",WM="info",uz="model_topology",lz="weight_specs",cz="weight_data",hz="model_metadata";function HM(r){return{info:[fc,r,WM].join(Wa),topology:[fc,r,uz].join(Wa),weightSpecs:[fc,r,lz].join(Wa),weightData:[fc,r,cz].join(Wa),modelMetadata:[fc,r,hz].join(Wa)}}function dz(r){var e=r.split(Wa);if(e.length<3)throw new Error("Invalid key format: "+r);return e.slice(1,e.length-1).join(Wa)}var Mc=(function(){function r(e){if(!Ne().getBool("IS_BROWSER")||typeof window>"u"||window.localStorage===void 0)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=HM(this.modelPath)}return r.prototype.save=function(e){return wt(this,void 0,void 0,(function(){var t,n,i;return _t(this,(function(o){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");t=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),i=Id(e);try{return this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,(function(a){if(wb)return Buffer.from(a).toString("base64");for(var s=new Uint8Array(a),u="",l=0,c=s.length;l<c;l++)u+=String.fromCharCode(s[l]);return btoa(u)})(e.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata})),[2,{modelArtifactsInfo:i}]}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+i.modelTopologyBytes+", weightSpecsBytes="+i.weightSpecsBytes+", weightDataBytes="+i.weightDataBytes+".")}return[2]}))}))},r.prototype.load=function(){return wt(this,void 0,void 0,(function(){var e,t,n,i,o,a,s;return _t(this,(function(u){if((e=JSON.parse(this.LS.getItem(this.keys.info)))==null)throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(t={},(n=JSON.parse(this.LS.getItem(this.keys.topology)))==null)throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(t.modelTopology=n,(i=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))==null)throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(t.weightSpecs=i,(o=this.LS.getItem(this.keys.modelMetadata))!=null&&(a=JSON.parse(o),t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,t.userDefinedMetadata=a.userDefinedMetadata),(s=this.LS.getItem(this.keys.weightData))==null)throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return t.weightData=(function(l){if(wb){var c=Buffer.from(l,"base64");return c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength)}for(var h=atob(l),f=new Uint8Array(h.length),m=0;m<h.length;++m)f.set([h.charCodeAt(m)],m);return f.buffer})(s),[2,t]}))}))},r.URL_SCHEME="localstorage://",r})(),AE=function(r){return Ne().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(Mc.URL_SCHEME)?(e=r.slice(Mc.URL_SCHEME.length),new Mc(e)):null;var e};Bi.registerSaveRouter(AE),Bi.registerLoadRouter(AE);var fz=(function(){function r(){K(Ne().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),K(typeof window>"u"||window.localStorage!==void 0,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return r.prototype.listModels=function(){return wt(this,void 0,void 0,(function(){var e,t,n,i,o,a;return _t(this,(function(s){for(e={},t=fc+Wa,n=Wa+WM,i=0;i<this.LS.length;++i)(o=this.LS.key(i)).startsWith(t)&&o.endsWith(n)&&(a=dz(o),e[a]=JSON.parse(this.LS.getItem(o)));return[2,e]}))}))},r.prototype.removeModel=function(e){return wt(this,void 0,void 0,(function(){var t,n;return _t(this,(function(i){var o;if(e=(o=e).startsWith(Mc.URL_SCHEME)?o.slice(Mc.URL_SCHEME.length):o,t=HM(e),this.LS.getItem(t.info)==null)throw new Error("Cannot find model at path '"+e+"'");return n=JSON.parse(this.LS.getItem(t.info)),this.LS.removeItem(t.info),this.LS.removeItem(t.topology),this.LS.removeItem(t.weightSpecs),this.LS.removeItem(t.weightData),[2,n]}))}))},r})();if(Ne().getBool("IS_BROWSER"))try{Xs.registerManager(Mc.URL_SCHEME,new fz)}catch{}var pz="model",mz=".json",gz=".weights.bin";function RE(r){return new Promise((function(e){return setTimeout(e)})).then(r)}var r0=(function(){function r(e){if(!Ne().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(r.URL_SCHEME)&&(e=e.slice(r.URL_SCHEME.length)),e!=null&&e.length!==0||(e=pz),this.modelTopologyFileName=e+mz,this.weightDataFileName=e+gz}return r.prototype.save=function(e){return wt(this,void 0,void 0,(function(){var t,n,i,o,a,s;return _t(this,(function(u){switch(u.label){case 0:if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(t=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"})),!(e.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:n},o=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),(a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,a.href=o,[4,RE((function(){return a.dispatchEvent(new MouseEvent("click"))}))];case 2:return u.sent(),e.weightData==null?[3,4]:((s=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=t,[4,RE((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:u.sent(),u.label=4;case 4:return[2,{modelArtifactsInfo:Id(e)}]}}))}))},r.URL_SCHEME="downloads://",r})(),vz=(function(){function r(e){if(e==null||e.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+e);this.files=e}return r.prototype.load=function(){return wt(this,void 0,void 0,(function(){var e,t,n=this;return _t(this,(function(i){return e=this.files[0],t=this.files.slice(1),[2,new Promise((function(o,a){var s=new FileReader;s.onload=function(u){var l=JSON.parse(u.target.result),c=l.modelTopology;if(c!=null){t.length===0&&o({modelTopology:c});var h=l.weightsManifest;if(h!=null){var f;try{f=n.checkManifestAndWeightFiles(h,t)}catch(v){return void a(v)}var m=[],g=[],w=[];h.forEach((function(v){v.paths.forEach((function(y){g.push(y),w.push(null)})),m.push.apply(m,v.weights)})),h.forEach((function(v){v.paths.forEach((function(y){var x=new FileReader;x.onload=function(E){var _=E.target.result,k=g.indexOf(y);w[k]=_,w.indexOf(null)===-1&&o({modelTopology:c,weightSpecs:m,weightData:s1(w),format:l.format,generatedBy:l.generatedBy,convertedBy:l.convertedBy,userDefinedMetadata:l.userDefinedMetadata})},x.onerror=function(E){return a("Failed to weights data from file of path '"+y+"'.")},x.readAsArrayBuffer(f[y])}))}))}else a(new Error("weightManifest field is missing from file "+e.name))}else a(new Error("modelTopology field is missing from file "+e.name))},s.onerror=function(u){return a("Failed to read model topology and weights manifest JSON from file '"+e.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},s.readAsText(e)}))]}))}))},r.prototype.checkManifestAndWeightFiles=function(e,t){for(var n=[],i=t.map((function(u){return CE(u.name)})),o={},a=0,s=e;a<s.length;a++)s[a].paths.forEach((function(u){var l=CE(u);if(n.indexOf(l)!==-1)throw new Error("Duplicate file basename found in weights manifest: '"+l+"'");if(n.push(l),i.indexOf(l)===-1)throw new Error("Weight file with basename '"+l+"' is not provided.");o[u]=t[i.indexOf(l)]}));if(n.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+t.length+").");return o},r})();function IE(r,e,t,n){(function(o){K(o!=null&&Array.isArray(o)&&o.length>0,(function(){return"promises must be a none empty array"}))})(r),(function(o,a){K(o>=0&&o<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+o})),K(a>=0&&a<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+a})),K(a>=o,(function(){return"startFraction must be no more than endFraction, but got startFraction "+o+" and endFraction "+a}))})(t=t??0,n=n??1);var i=0;return Promise.all(r.map((function(o){return o.then((function(a){var s=t+ ++i/r.length*(n-t);return e(s),a})),o})))}function GM(r,e){return wt(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,l,c;return _t(this,(function(h){switch(h.label){case 0:return e==null&&(e={}),t=e.fetchFunc==null?Ne().platform.fetch:e.fetchFunc,n=r.map((function(f){return t(f,e.requestInit,{isBinary:!0})})),i=0,o=.5,e.onProgress!=null?[3,2]:[4,Promise.all(n)];case 1:return a=h.sent(),[3,4];case 2:return[4,IE(n,e.onProgress,i,o)];case 3:a=h.sent(),h.label=4;case 4:return s=a.map((function(f){return f.arrayBuffer()})),u=.5,l=1,e.onProgress!=null?[3,6]:[4,Promise.all(s)];case 5:return c=h.sent(),[3,8];case 6:return[4,IE(s,e.onProgress,u,l)];case 7:c=h.sent(),h.label=8;case 8:return[2,c]}}))}))}function DE(r){var e=this;return function(t,n,i){return n===void 0&&(n=""),wt(e,void 0,void 0,(function(){var o,a,s,u,l,c,h,f,m,g;return _t(this,(function(w){switch(w.label){case 0:if(o=t.map((function(){return!1})),a={},s=i!=null?i.map((function(){return!1})):[],u=[],t.forEach((function(v,y){var x=0;v.weights.forEach((function(E){var _="quantization"in E?E.quantization.dtype:E.dtype,k=bb[_]*bt(E.shape),C=function(){o[y]=!0,a[y]==null&&(a[y]=[]),a[y].push({manifestEntry:E,groupOffset:x,sizeBytes:k})};i!=null?i.forEach((function(R,I){R===E.name&&(C(),s[I]=!0)})):C(),u.push(E.name),x+=k}))})),!s.every((function(v){return v})))throw l=i.filter((function(v,y){return!s[y]})),new Error("Could not find weights in manifest with names: "+l.join(", ")+`. 
Manifest JSON has weights with names: `+u.join(", ")+".");return c=o.reduce((function(v,y,x){return y&&v.push(x),v}),[]),h=[],c.forEach((function(v){t[v].paths.forEach((function(y){var x=n+(n.endsWith("/")?"":"/")+y;h.push(x)}))})),[4,r(h)];case 1:return f=w.sent(),m={},g=0,c.forEach((function(v){for(var y=t[v].paths.length,x=0,E=0;E<y;E++)x+=f[g+E].byteLength;for(var _=new ArrayBuffer(x),k=new Uint8Array(_),C=0,R=0;R<y;R++){var I=new Uint8Array(f[g+R]);k.set(I,C),C+=I.byteLength}a[v].forEach((function(T){var A=UM(_.slice(T.groupOffset,T.groupOffset+T.sizeBytes),[T.manifestEntry]);for(var N in A)m[N]=A[N]})),g+=y})),[2,m]}}))}))}}Bi.registerSaveRouter((function(r){return Ne().getBool("IS_BROWSER")&&!Array.isArray(r)&&r.startsWith(r0.URL_SCHEME)?(function(e){return e===void 0&&(e="model"),new r0(e)})(r.slice(r0.URL_SCHEME.length)):null}));var VM=(function(){function r(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.onProgress=t.onProgress,t.fetchFunc!=null?(K(typeof t.fetchFunc=="function",(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=t.fetchFunc):this.fetch=Ne().platform.fetch,K(e!=null&&e.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(e)&&K(e.length===2,(function(){return"URL paths for http must have a length of 2, (actual length is "+e.length+")."})),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{}}return r.prototype.save=function(e){return wt(this,void 0,void 0,(function(){var t,n,i,o;return _t(this,(function(a){switch(a.label){case 0:if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,userDefinedMetadata:e.userDefinedMetadata,weightsManifest:n},t.body.append("model.json",new Blob([JSON.stringify(i)],{type:"application/json"}),"model.json"),e.weightData!=null&&t.body.append("model.weights.bin",new Blob([e.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,t)];case 1:if((o=a.sent()).ok)return[2,{modelArtifactsInfo:Id(e),responses:[o]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+o.status+".")}}))}))},r.prototype.load=function(){return wt(this,void 0,void 0,(function(){var e,t,n,i,o,a,s,u,l,c,h,f;return _t(this,(function(m){switch(m.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(e=m.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+e.status+". Please verify this URL points to the model JSON of the model to load.");m.label=2;case 2:return m.trys.push([2,4,,5]),[4,e.json()];case 3:return t=m.sent(),[3,5];case 4:throw m.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(i=t.modelTopology,o=t.weightsManifest,a=t.generatedBy,s=t.convertedBy,u=t.format,l=t.userDefinedMetadata,i==null&&o==null)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return o==null?[3,7]:[4,this.loadWeights(o)];case 6:f=m.sent(),c=f[0],h=f[1],m.label=7;case 7:return[2,{modelTopology:i,weightSpecs:c,weightData:h,userDefinedMetadata:l,generatedBy:a,convertedBy:s,format:u}]}}))}))},r.prototype.loadWeights=function(e){return wt(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,l,c,h,f;return _t(this,(function(m){switch(m.label){case 0:for(t=Array.isArray(this.path)?this.path[1]:this.path,n=(function(g){var w=g.lastIndexOf("/"),v=g.lastIndexOf("?"),y=g.substring(0,w),x=v>w?g.substring(v):"";return[y+"/",x]})(t),i=n[0],o=n[1],a=this.weightPathPrefix||i,s=[],u=0,l=e;u<l.length;u++)c=l[u],s.push.apply(s,c.weights);return h=[],e.forEach((function(g){g.paths.forEach((function(w){h.push(a+w+o)}))})),[4,GM(h,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return f=m.sent(),[2,[s,s1(f)]]}}))}))},r.URL_SCHEME_REGEX=/^https?:\/\//,r})();function xb(r){return r.match(VM.URL_SCHEME_REGEX)!=null}var NE=function(r,e){return typeof fetch>"u"?null:(Array.isArray(r)?r.every((function(t){return xb(t)})):xb(r))?Sb(r,{onProgress:e}):null};function Sb(r,e){return new VM(r,e)}Bi.registerSaveRouter(NE),Bi.registerLoadRouter(NE);var i0=(function(){function r(e){this.modelArtifacts=e}return r.prototype.load=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(e){return[2,this.modelArtifacts]}))}))},r})(),yz=(function(){function r(e){this.saveHandler=e}return r.prototype.save=function(e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return[2,this.saveHandler(e)]}))}))},r})(),jM=Object.freeze({browserFiles:function(r){return new vz(r)},browserHTTPRequest:function(r,e){return Sb(r,e)},concatenateArrayBuffers:s1,decodeWeights:UM,encodeWeights:function(r,e){return wt(this,void 0,void 0,(function(){var t,n,i,o,a,s=this;return _t(this,(function(u){switch(u.label){case 0:for(t=[],n=[],i=Array.isArray(r)?r.map((function(l){return l.name})):Object.keys(r),o=function(l){var c=i[l],h=Array.isArray(r)?r[l].tensor:r[c];if(h.dtype!=="float32"&&h.dtype!=="int32"&&h.dtype!=="bool"&&h.dtype!=="string")throw new Error("Unsupported dtype in weight '"+c+"': "+h.dtype);var f={name:c,shape:h.shape,dtype:h.dtype};if(h.dtype==="string"){var m=new Promise((function(g){return wt(s,void 0,void 0,(function(){var w,v,y,x,E,_,k;return _t(this,(function(C){switch(C.label){case 0:return[4,h.bytes()];case 1:for(w=C.sent(),v=w.reduce((function(R,I){return R+I.length}),0)+zm*w.length,y=new Uint8Array(v),x=0,E=0;E<w.length;E++)_=w[E],k=new Uint8Array(new Uint32Array([_.length]).buffer),y.set(k,x),x+=zm,y.set(_,x),x+=_.length;return g(y),[2]}}))}))}));n.push(m)}else n.push(h.data());e!=null&&(f.group=e),t.push(f)},a=0;a<i.length;++a)o(a);return[4,Promise.all(n)];case 1:return[2,{data:az(u.sent()),specs:t}]}}))}))},fromMemory:function(r,e,t,n){return arguments.length===1?r.modelTopology!=null||r.weightSpecs!=null?new i0(r):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new i0({modelTopology:r})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new i0({modelTopology:r,weightSpecs:e,weightData:t,trainingConfig:n}))},getLoadHandlers:function(r,e){return Bi.getLoadHandlers(r,e)},getModelArtifactsInfoForJSON:Id,getSaveHandlers:function(r){return Bi.getSaveHandlers(r)},http:Sb,isHTTPScheme:xb,loadWeights:function(r,e,t,n){return e===void 0&&(e=""),wt(this,void 0,void 0,(function(){return _t(this,(function(i){return[2,DE((function(o){return GM(o,{requestInit:n})}))(r,e,t)]}))}))},registerLoadRouter:function(r){return Bi.registerLoadRouter(r)},registerSaveRouter:function(r){return Bi.registerSaveRouter(r)},weightsLoaderFactory:DE,withSaveHandler:function(r){return new yz(r)},copyModel:function(r,e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return[2,TE(r,e,!1)]}))}))},listModels:function(){return wt(this,void 0,void 0,(function(){var r,e,t,n,i,o,a;return _t(this,(function(s){switch(s.label){case 0:r=Xs.getSchemes(),e={},t=0,n=r,s.label=1;case 1:return t<n.length?(i=n[t],[4,Xs.getManager(i).listModels()]):[3,4];case 2:for(a in o=s.sent())e[i+Cc+a]=o[a];s.label=3;case 3:return t++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(r,e){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return[2,TE(r,e,!0)]}))}))},removeModel:function(r){return wt(this,void 0,void 0,(function(){var e;return _t(this,(function(t){return e=Zp(r),[2,Xs.getManager(e.scheme).removeModel(e.path)]}))}))}}),Gl;oe({confusionMatrix_:function(r,e,t){var n=X(r,"labels","confusionMatrix"),i=X(e,"predictions","confusionMatrix");K(t==null||t>0&&Number.isInteger(t),(function(){return"If provided, numClasses must be a positive integer, but got "+t})),K(n.rank===1,(function(){return"Expected the rank of labels to be 1, but got "+n.rank})),K(i.rank===1,(function(){return"Expected the rank of predictions to be 1, but got "+i.rank})),K(n.shape[0]===i.shape[0],(function(){return"Mismatch in the number of examples: "+n.shape[0]+" vs. "+i.shape[0]+". Labels and predictions should have the same number of elements."})),K(t>0&&Number.isInteger(t),(function(){return"numClasses is required to be a positive integer, but got "+t}));var o=Bm(n.asType("int32"),t),a=Bm(i.asType("int32"),t);return o.transpose().matMul(a).asType("int32")}});var bz=oe({fromPixels_:function(r,e){if(e===void 0&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(r==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var t=!1,n=!1,i=!1,o=!1,a=!1;if(r.data instanceof Uint8Array)t=!0;else if(typeof ImageData<"u"&&r instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement)i=!0;else if(typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement)o=!0;else{if(r.getContext==null)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+r.constructor.name);a=!0}if(i&&i&&r.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(QT("FromPixels",le.backendName)!=null)return le.runKernel("FromPixels",{pixels:r},{numChannels:e});var s,u,l=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],c=l[0],h=l[1];if(a?s=r.getContext("2d").getImageData(0,0,c,h).data:n||t?s=r.data:(o||i)&&(Gl==null&&(Gl=document.createElement("canvas").getContext("2d")),Gl.canvas.width=c,Gl.canvas.height=h,Gl.drawImage(r,0,0,c,h),s=Gl.getImageData(0,0,c,h).data),e===4)u=new Int32Array(s);else{var f=c*h;u=new Int32Array(f*e);for(var m=0;m<f;m++)for(var g=0;g<e;++g)u[m*e+g]=s[4*m+g]}return p3(u,[h,c,e],"int32")}}),qM=Object.freeze({toPixels:function(r,e){return wt(this,void 0,void 0,(function(){var t,n,i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,R,I;return _t(this,(function(T){switch(T.label){case 0:if(t=X(r,"img","toPixels"),r instanceof Nn||(t=t.toInt()),t.rank!==2&&t.rank!==3)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+t.rank+".");if(n=t.shape.slice(0,2),i=n[0],o=n[1],(a=t.rank===2?1:t.shape[2])>4||a===2)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+a);return[4,t.data()];case 1:return s=T.sent(),u=t.min(),l=t.max(),[4,Promise.all([u.data(),l.data()])];case 2:if(c=T.sent(),h=c[0],f=c[1],m=h[0],g=f[0],u.dispose(),l.dispose(),t.dtype==="float32"){if(m<0||g>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+m+" - "+g+"].")}else{if(t.dtype!=="int32")throw new Error("Unsupported type for toPixels: "+t.dtype+". Please use float32 or int32 tensors.");if(m<0||g>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+m+" - "+g+"].")}for(w=t.dtype==="float32"?255:1,v=new Uint8ClampedArray(o*i*4),y=0;y<i*o;++y)x=void 0,E=void 0,_=void 0,k=void 0,a===1?(x=s[y]*w,E=s[y]*w,_=s[y]*w,k=255):a===3?(x=s[3*y]*w,E=s[3*y+1]*w,_=s[3*y+2]*w,k=255):a===4&&(x=s[4*y]*w,E=s[4*y+1]*w,_=s[4*y+2]*w,k=s[4*y+3]*w),v[(C=4*y)+0]=Math.round(x),v[C+1]=Math.round(E),v[C+2]=Math.round(_),v[C+3]=Math.round(k);return e!=null&&(e.width=o,e.height=i,R=e.getContext("2d"),I=new ImageData(v,o,i),R.putImageData(I,0,0)),t!==r&&t.dispose(),[2,v]}}))}))},fromPixels:bz}),wz=(function(){function r(){}return r.prototype.getClassName=function(){return this.constructor.className},r.fromConfig=function(e,t){return new e(t)},r})(),_z=(function(){function r(){this.classNameMap={}}return r.getMap=function(){return r.instance==null&&(r.instance=new r),r.instance},r.register=function(e){r.getMap().classNameMap[e.className]=[e,e.fromConfig]},r})();function fl(r){K(r.className!=null,(function(){return"Class being registered does not have the static className property defined."})),K(typeof r.className=="string",(function(){return"className is required to be a string, but got type "+typeof r.className})),K(r.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),_z.register(r)}var pl=(function(r){function e(){return r!==null&&r.apply(this,arguments)||this}return Wo(e,r),e.prototype.minimize=function(t,n,i){n===void 0&&(n=!1);var o=this.computeGradients(t,i),a=o.value,s=o.grads;if(i!=null){var u=i.map((function(l){return{name:l.name,tensor:s[l.name]}}));this.applyGradients(u)}else this.applyGradients(s);return bi(s),n?a:(a.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return this.iterations_==null&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,n){return G6(t,n)},e.prototype.dispose=function(){this.iterations_!=null&&bi(this.iterations_)},e.prototype.saveIterations=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){return this.iterations_==null&&(this.iterations_=0),[2,{name:"iter",tensor:Ct(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(n){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return wt(this,void 0,void 0,(function(){var n;return _t(this,(function(i){switch(i.label){case 0:return n=this,[4,t[0].tensor.data()];case 1:return n.iterations_=i.sent()[0],[2,t.slice(1)]}}))}))},e})(wz);Object.defineProperty(pl,Symbol.hasInstance,{value:function(r){return r.minimize!=null&&r.computeGradients!=null&&r.applyGradients!=null}});var xz=(function(r){function e(t,n,i){i===void 0&&(i=null);var o=r.call(this)||this;return o.learningRate=t,o.rho=n,o.epsilon=i,o.accumulatedGrads=[],o.accumulatedUpdates=[],i==null&&(o.epsilon=le.backend.epsilon()),o}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accum_grad",variable:_n((function(){return hn(a).variable(!1)}))}),n.accumulatedUpdates[o]==null&&(n.accumulatedUpdates[o]={originalName:i+"/accum_var",variable:_n((function(){return hn(a).variable(!1)}))});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedGrads[o].variable,l=n.accumulatedUpdates[o].variable;_n((function(){var c=u.mul(n.rho).add(s.square().mul(1-n.rho)),h=l.add(n.epsilon).sqrt().div(u.add(n.epsilon).sqrt()).mul(s),f=l.mul(n.rho).add(h.square().mul(1-n.rho));u.assign(c),l.assign(f);var m=h.mul(-n.learningRate).add(a);a.assign(m)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedUpdates!=null&&(bi(this.accumulatedGrads.map((function(t){return t.variable}))),bi(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){var t;return _t(this,(function(n){switch(n.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){var n;return _t(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=t.length/2,this.accumulatedGrads=t.slice(0,n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.rho,n.epsilon)},e.className="Adadelta",e})(pl);fl(xz);var Sz=(function(r){function e(t,n){n===void 0&&(n=.1);var i=r.call(this)||this;return i.learningRate=t,i.initialAccumulatorValue=n,i.accumulatedGrads=[],i}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];n.accumulatedGrads[o]==null&&(n.accumulatedGrads[o]={originalName:i+"/accumulator",variable:_n((function(){return Qu(a.shape,n.initialAccumulatorValue).variable(!1)}))});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedGrads[o].variable;_n((function(){var l=u.add(s.square());u.assign(l);var c=s.div(l.add(le.backend.epsilon()).sqrt()).mul(-n.learningRate).add(a);a.assign(c)}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedGrads!=null&&bi(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulatedGrads=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,n){return new t(n.learningRate,n.initialAccumulatorValue)},e.className="Adagrad",e})(pl);fl(Sz);var Ez=(function(r){function e(t,n,i,o){o===void 0&&(o=null);var a=r.call(this)||this;return a.learningRate=t,a.beta1=n,a.beta2=i,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],_n((function(){a.accBeta1=Ct(n).variable(),a.accBeta2=Ct(i).variable()})),o==null&&(a.epsilon=le.backend.epsilon()),a}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);_n((function(){var o=Lo(1,n.accBeta1),a=Lo(1,n.accBeta2);i.forEach((function(s,u){var l=le.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:_n((function(){return hn(l).variable(!1)}))}),n.accumulatedSecondMoment[u]==null&&(n.accumulatedSecondMoment[u]={originalName:s+"/v",variable:_n((function(){return hn(l).variable(!1)}))});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=n.accumulatedFirstMoment[u].variable,f=n.accumulatedSecondMoment[u].variable,m=h.mul(n.beta1).add(c.mul(1-n.beta1)),g=f.mul(n.beta2).add(c.square().mul(1-n.beta2)),w=m.div(o),v=g.div(a);h.assign(m),f.assign(g);var y=w.div(v.sqrt().add(n.epsilon)).mul(-n.learningRate).add(l);l.assign(y)}})),n.accBeta1.assign(n.accBeta1.mul(n.beta1)),n.accBeta2.assign(n.accBeta2.mul(n.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&bi(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedSecondMoment!=null&&bi(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){var t;return _t(this,(function(n){switch(n.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){var n,i=this;return _t(this,(function(o){switch(o.label){case 0:return[4,this.extractIterations(t)];case 1:return t=o.sent(),_n((function(){i.accBeta1.assign(Nm(i.beta1,i.iterations_+1)),i.accBeta2.assign(Nm(i.beta2,i.iterations_+1))})),n=t.length/2,this.accumulatedFirstMoment=t.slice(0,n).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(a){return{originalName:a.name,variable:a.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon)},e.className="Adam",e})(pl);fl(Ez);var kz=(function(r){function e(t,n,i,o,a){o===void 0&&(o=null),a===void 0&&(a=0);var s=r.call(this)||this;return s.learningRate=t,s.beta1=n,s.beta2=i,s.epsilon=o,s.decay=a,s.accumulatedFirstMoment=[],s.accumulatedWeightedInfNorm=[],_n((function(){s.iteration=Ct(0).variable(),s.accBeta1=Ct(n).variable()})),o==null&&(s.epsilon=le.backend.epsilon()),s}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this,i=Array.isArray(t)?t.map((function(o){return o.name})):Object.keys(t);_n((function(){var o=Lo(1,n.accBeta1),a=eu(-n.learningRate,n.iteration.mul(n.decay).add(1));i.forEach((function(s,u){var l=le.registeredVariables[s];n.accumulatedFirstMoment[u]==null&&(n.accumulatedFirstMoment[u]={originalName:s+"/m",variable:hn(l).variable(!1)}),n.accumulatedWeightedInfNorm[u]==null&&(n.accumulatedWeightedInfNorm[u]={originalName:s+"/v",variable:hn(l).variable(!1)});var c=Array.isArray(t)?t[u].tensor:t[s];if(c!=null){var h=n.accumulatedFirstMoment[u].variable,f=n.accumulatedWeightedInfNorm[u].variable,m=h.mul(n.beta1).add(c.mul(1-n.beta1)),g=f.mul(n.beta2),w=c.abs(),v=g.maximum(w);h.assign(m),f.assign(v);var y=a.div(o).mul(m.div(v.add(n.epsilon))).add(l);l.assign(y)}})),n.iteration.assign(n.iteration.add(1)),n.accBeta1.assign(n.accBeta1.mul(n.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&bi(this.accumulatedFirstMoment.map((function(t){return t.variable}))),this.accumulatedWeightedInfNorm!=null&&bi(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(n){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,n){return new t(n.learningRate,n.beta1,n.beta2,n.epsilon,n.decay)},e.className="Adamax",e})(pl);fl(kz);var $M=(function(r){function e(t){var n=r.call(this)||this;return n.learningRate=t,n.setLearningRate(t),n}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=Array.isArray(t)?t[o].tensor:t[i];if(a!=null){var s=le.registeredVariables[i];_n((function(){var u=n.c.mul(a).add(s);s.assign(u)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,this.c!=null&&this.c.dispose(),this.c=NB(Ct(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:if((t=n.sent()).length!==0)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,n){return new t(n.learningRate)},e.className="SGD",e})(pl);fl($M);var Cz=(function(r){function e(t,n,i){i===void 0&&(i=!1);var o=r.call(this,t)||this;return o.learningRate=t,o.momentum=n,o.useNesterov=i,o.accumulations=[],o.m=Ct(o.momentum),o}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];n.accumulations[o]==null&&(n.accumulations[o]={originalName:i+"/momentum",variable:_n((function(){return hn(a).variable(!1)}))});var s=n.accumulations[o].variable,u=Array.isArray(t)?t[o].tensor:t[i];u!=null&&_n((function(){var l,c=n.m.mul(s).add(u);l=n.useNesterov?n.c.mul(u.add(c.mul(n.m))).add(a):n.c.mul(c).add(a),s.assign(c),a.assign(l)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),this.accumulations!=null&&bi(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){return _t(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(n){return{name:n.originalName,tensor:n.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){return _t(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),this.accumulations=t.map((function(i){return{originalName:i.name,variable:i.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,n){return new t(n.learningRate,n.momentum,n.useNesterov)},e.className="Momentum",e})($M);fl(Cz);var Tz=(function(r){function e(t,n,i,o,a){n===void 0&&(n=.9),i===void 0&&(i=0),o===void 0&&(o=null),a===void 0&&(a=!1);var s=r.call(this)||this;if(s.learningRate=t,s.decay=n,s.momentum=i,s.epsilon=o,s.accumulatedMeanSquares=[],s.accumulatedMoments=[],s.accumulatedMeanGrads=[],s.centered=a,o==null&&(s.epsilon=le.backend.epsilon()),t==null)throw new Error("learningRate for RMSPropOptimizer must be defined.");return s}return Wo(e,r),e.prototype.applyGradients=function(t){var n=this;(Array.isArray(t)?t.map((function(i){return i.name})):Object.keys(t)).forEach((function(i,o){var a=le.registeredVariables[i];n.accumulatedMeanSquares[o]==null&&(n.accumulatedMeanSquares[o]={originalName:i+"/rms",variable:_n((function(){return hn(a).variable(!1)}))}),n.accumulatedMoments[o]==null&&(n.accumulatedMoments[o]={originalName:i+"/momentum",variable:_n((function(){return hn(a).variable(!1)}))}),n.accumulatedMeanGrads[o]==null&&n.centered&&(n.accumulatedMeanGrads[o]={originalName:i+"/mg",variable:_n((function(){return hn(a).variable(!1)}))});var s=Array.isArray(t)?t[o].tensor:t[i];if(s!=null){var u=n.accumulatedMeanSquares[o].variable,l=n.accumulatedMoments[o].variable;_n((function(){var c=u.mul(n.decay).add(s.square().mul(1-n.decay));if(n.centered){var h=n.accumulatedMeanGrads[o].variable,f=h.mul(n.decay).add(s.mul(1-n.decay)),m=l.mul(n.momentum).add(s.mul(n.learningRate).div(c.sub(f.square().add(n.epsilon)).sqrt()));u.assign(c),h.assign(f),l.assign(m);var g=a.sub(m);a.assign(g)}else{var w=u.mul(n.decay).add(s.square().mul(1-n.decay));m=l.mul(n.momentum).add(s.mul(n.learningRate).div(w.add(n.epsilon).sqrt())),u.assign(w),l.assign(m),g=a.sub(m),a.assign(g)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){this.accumulatedMeanSquares!=null&&bi(this.accumulatedMeanSquares.map((function(t){return t.variable}))),this.accumulatedMeanGrads!=null&&this.centered&&bi(this.accumulatedMeanGrads.map((function(t){return t.variable}))),this.accumulatedMoments!=null&&bi(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return wt(this,void 0,void 0,(function(){var t;return _t(this,(function(n){switch(n.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[n.sent()].concat(t.map((function(i){return{name:i.originalName,tensor:i.variable}})))]}}))}))},e.prototype.setWeights=function(t){return wt(this,void 0,void 0,(function(){var n;return _t(this,(function(i){switch(i.label){case 0:return[4,this.extractIterations(t)];case 1:return t=i.sent(),n=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(o){return{originalName:o.name,variable:o.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,n){return new t(n.learningRate,n.decay,n.momentum,n.epsilon,n.centered)},e.className="RMSProp",e})(pl);fl(Tz);Nn.prototype.add=function(r){return lo(this,r)},Nn.prototype.broadcastTo=function(r){return oM(this,r)},Nn.prototype.div=function(r){return eu(this,r)},Nn.prototype.divNoNan=function(r){return uM(this,r)},Nn.prototype.squaredDifference=function(r){return dM(this,r)},Nn.prototype.tile=function(r){return kc(this,r)},Nn.prototype.oneHot=function(r,e,t){return e===void 0&&(e=1),t===void 0&&(t=0),Bm(this,r,e,t)},Nn.prototype.transpose=function(r){return Mo(this,r)},Nn.prototype.pad=function(r,e){return ns(this,r,e)},Nn.prototype.batchNorm=function(r,e,t,n,i){return Ad(this,r,e,t,n,i)},Ie=j9;var Ac=(function(){function r(e,t){if(!el(e)||!el(t))throw new Error("Dimensions.constructor - expected width and height to be valid numbers, instead have "+JSON.stringify({width:e,height:t}));this._width=e,this._height=t}return Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),r.prototype.reverse=function(){return new r(1/this.width,1/this.height)},r})(),yn=(function(){function r(e,t){this._x=e,this._y=t}return Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),r.prototype.add=function(e){return new r(this.x+e.x,this.y+e.y)},r.prototype.sub=function(e){return new r(this.x-e.x,this.y-e.y)},r.prototype.mul=function(e){return new r(this.x*e.x,this.y*e.y)},r.prototype.div=function(e){return new r(this.x/e.x,this.y/e.y)},r.prototype.abs=function(){return new r(Math.abs(this.x),Math.abs(this.y))},r.prototype.magnitude=function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))},r.prototype.floor=function(){return new r(Math.floor(this.x),Math.floor(this.y))},r})();function pg(r,e){return r instanceof Nn&&r.shape.length===e}function Mz(r){return pg(r,2)}function mg(r){return pg(r,3)}function Ys(r){return pg(r,4)}function Az(r){return r%1!==0}function PE(r){return r%2===0}function u1(r,e){e===void 0&&(e=2);var t=Math.pow(10,e);return Math.floor(r*t)/t}function FE(r){return r&&r.width&&r.height}function Rz(r,e){var t=r.width,n=r.height,i=e/Math.max(n,t);return new Ac(Math.round(t*i),Math.round(n*i))}function l1(r){return r.reduce(function(e,t){return e.add(t)},new yn(0,0)).div(new yn(r.length,r.length))}function rd(r,e,t){return Array(r).fill(0).map(function(n,i){return e+i*t})}function el(r){return!!r&&r!==1/0&&r!==-1/0&&!isNaN(r)||r===0}function OE(r){return el(r)&&0<=r&&r<=1}var pa=(function(){function r(e,t){t===void 0&&(t=!0);var n=e||{},i=[n.left,n.top,n.right,n.bottom].every(el),o=[n.x,n.y,n.width,n.height].every(el);if(!o&&!i)throw new Error("Box.constructor - expected box to be IBoundingBox | IRect, instead have "+JSON.stringify(n));var a=o?[n.x,n.y,n.width,n.height]:[n.left,n.top,n.right-n.left,n.bottom-n.top],s=a[0],u=a[1],l=a[2],c=a[3];r.assertIsValidBox({x:s,y:u,width:l,height:c},"Box.constructor",t),this._x=s,this._y=u,this._width=l,this._height=c}return r.isRect=function(e){return!!e&&[e.x,e.y,e.width,e.height].every(el)},r.assertIsValidBox=function(e,t,n){if(n===void 0&&(n=!1),!r.isRect(e))throw new Error(t+" - invalid box: "+JSON.stringify(e)+", expected object with properties x, y, width, height");if(!n&&(e.width<0||e.height<0))throw new Error(t+" - width ("+e.width+") and height ("+e.height+") must be positive numbers")},Object.defineProperty(r.prototype,"x",{get:function(){return this._x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this._y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"left",{get:function(){return this.x},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"top",{get:function(){return this.y},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"right",{get:function(){return this.x+this.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottom",{get:function(){return this.y+this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"area",{get:function(){return this.width*this.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topLeft",{get:function(){return new yn(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"topRight",{get:function(){return new yn(this.right,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomLeft",{get:function(){return new yn(this.left,this.bottom)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"bottomRight",{get:function(){return new yn(this.right,this.bottom)},enumerable:!0,configurable:!0}),r.prototype.round=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.round(a)}),t=e[0],n=e[1],i=e[2],o=e[3];return new r({x:t,y:n,width:i,height:o})},r.prototype.floor=function(){var e=[this.x,this.y,this.width,this.height].map(function(a){return Math.floor(a)}),t=e[0],n=e[1],i=e[2],o=e[3];return new r({x:t,y:n,width:i,height:o})},r.prototype.toSquare=function(){var e=this,t=e.x,n=e.y,i=e.width,o=e.height,a=Math.abs(i-o);return i<o&&(t-=a/2,i+=a),o<i&&(n-=a/2,o+=a),new r({x:t,y:n,width:i,height:o})},r.prototype.rescale=function(e){var t=FE(e)?e.width:e,n=FE(e)?e.height:e;return new r({x:this.x*t,y:this.y*n,width:this.width*t,height:this.height*n})},r.prototype.pad=function(e,t){var n=[this.x-e/2,this.y-t/2,this.width+e,this.height+t],i=n[0],o=n[1],a=n[2],s=n[3];return new r({x:i,y:o,width:a,height:s})},r.prototype.clipAtImageBorders=function(e,t){var n=this,i=n.x,o=n.y,a=n.right,s=n.bottom,u=Math.max(i,0),l=Math.max(o,0),c=a-u,h=s-l,f=Math.min(c,e-u),m=Math.min(h,t-l);return new r({x:u,y:l,width:f,height:m}).floor()},r.prototype.shift=function(e,t){var n=this,i=n.width,o=n.height,a=this.x+e,s=this.y+t;return new r({x:a,y:s,width:i,height:o})},r.prototype.padAtBorders=function(e,t){var n=this.width+1,i=this.height+1,o=1,a=1,s=n,u=i,l=this.left,c=this.top,h=this.right,f=this.bottom;return h>t&&(s=-h+t+n,h=t),f>e&&(u=-f+e+i,f=e),l<1&&(u=2-l,l=1),c<1&&(u=2-c,c=1),{dy:a,edy:u,dx:o,edx:s,y:c,ey:f,x:l,ex:h,w:n,h:i}},r.prototype.calibrate=function(e){return new r({left:this.left+e.left*this.width,top:this.top+e.top*this.height,right:this.right+e.right*this.width,bottom:this.bottom+e.bottom*this.height}).toSquare().round()},r})(),gg=(function(r){Yt(e,r);function e(t,n,i,o,a){return a===void 0&&(a=!1),r.call(this,{left:t,top:n,right:i,bottom:o},a)||this}return e})(pa),LE=(function(r){Yt(e,r);function e(t,n){var i=r.call(this,t)||this;return i._label=n,i}return e.assertIsValidLabeledBox=function(t,n){if(pa.assertIsValidBox(t,n),!el(t.label))throw new Error(n+" - expected property label ("+t.label+") to be a number")},Object.defineProperty(e.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),e})(pa),XM=(function(){function r(e,t,n,i,o){this._imageDims=new Ac(o.width,o.height),this._score=e,this._classScore=t,this._className=n,this._box=new pa(i).rescale(this._imageDims)}return Object.defineProperty(r.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"className",{get:function(){return this._className},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"box",{get:function(){return this._box},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageDims",{get:function(){return this._imageDims},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this.imageDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this.imageDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativeBox",{get:function(){return new pa(this._box).rescale(this.imageDims.reverse())},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new r(this.score,this.classScore,this.className,this.relativeBox,{width:e,height:t})},r})();(function(r){Yt(e,r);function e(t,n,i,o){var a=r.call(this,t,n)||this;return a._score=i,a._classScore=o,a}return e.assertIsValidPredictedBox=function(t,n){if(LE.assertIsValidLabeledBox(t,n),!OE(t.score)||!OE(t.classScore))throw new Error(n+" - expected properties score ("+t.score+") and ("+t.classScore+") to be a number between [0, 1]")},Object.defineProperty(e.prototype,"score",{get:function(){return this._score},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"classScore",{get:function(){return this._classScore},enumerable:!0,configurable:!0}),e})(LE);var c1=(function(r){Yt(e,r);function e(t,n,i,o,a){return a===void 0&&(a=!1),r.call(this,{x:t,y:n,width:i,height:o},a)||this}return e})(pa);function YM(){var r=window.fetch||function(){throw new Error("fetch - missing fetch implementation for browser environment")},e=function(){throw new Error("readFile - filesystem not available for browser environment")};return{Canvas:HTMLCanvasElement,CanvasRenderingContext2D,Image:HTMLImageElement,ImageData,Video:HTMLVideoElement,createCanvasElement:function(){return document.createElement("canvas")},createImageElement:function(){return document.createElement("img")},fetch:r,readFile:e}}function KM(r){var e="";if(!r)try{r=require("fs")}catch(n){e=n.toString()}var t=r?function(n){return new Promise(function(i,o){r.readFile(n,function(a,s){return a?o(a):i(s)})})}:function(){throw new Error("readFile - failed to require fs in nodejs environment with error: "+e)};return{readFile:t}}function JM(){var r=global.Canvas||global.HTMLCanvasElement,e=global.Image||global.HTMLImageElement,t=function(){if(r)return new r;throw new Error("createCanvasElement - missing Canvas implementation for nodejs environment")},n=function(){if(e)return new e;throw new Error("createImageElement - missing Image implementation for nodejs environment")},i=global.fetch||function(){throw new Error("fetch - missing fetch implementation for nodejs environment")},o=KM();return Fo({Canvas:r||(function(){function a(){}return a})(),CanvasRenderingContext2D:global.CanvasRenderingContext2D||(function(){function a(){}return a})(),Image:e||(function(){function a(){}return a})(),ImageData:global.ImageData||(function(){function a(){}return a})(),Video:global.HTMLVideoElement||(function(){function a(){}return a})(),createCanvasElement:t,createImageElement:n,fetch:i},o)}function ZM(){return typeof window=="object"&&typeof document<"u"&&typeof HTMLImageElement<"u"&&typeof HTMLCanvasElement<"u"&&typeof HTMLVideoElement<"u"&&typeof ImageData<"u"&&typeof CanvasRenderingContext2D<"u"}function QM(){return typeof global=="object"&&typeof require=="function"&&typeof module<"u"&&typeof process<"u"&&!!process.version}var ir;function Iz(){if(!ir)throw new Error("getEnv - environment is not defined, check isNodejs() and isBrowser()");return ir}function Eb(r){ir=r}function h1(){ZM()&&Eb(YM()),QM()&&Eb(JM())}function Dz(r){if(ir||h1(),!ir)throw new Error("monkeyPatch - environment is not defined, check isNodejs() and isBrowser()");var e=r.Canvas,t=e===void 0?ir.Canvas:e,n=r.Image,i=n===void 0?ir.Image:n;ir.Canvas=t,ir.Image=i,ir.createCanvasElement=r.createCanvasElement||(function(){return new t}),ir.createImageElement=r.createImageElement||(function(){return new i}),ir.ImageData=r.ImageData||ir.ImageData,ir.Video=r.Video||ir.Video,ir.fetch=r.fetch||ir.fetch,ir.readFile=r.readFile||ir.readFile}var qr={getEnv:Iz,setEnv:Eb,initialize:h1,createBrowserEnv:YM,createFileSystem:KM,createNodejsEnv:JM,monkeyPatch:Dz,isBrowser:ZM,isNodejs:QM};h1();function d1(r){return!qr.isNodejs()&&typeof r=="string"?document.getElementById(r):r}function ma(r){var e=qr.getEnv(),t=e.Canvas,n=e.CanvasRenderingContext2D;if(r instanceof n)return r;var i=d1(r);if(!(i instanceof t))throw new Error("resolveContext2d - expected canvas to be of instance of Canvas");var o=i.getContext("2d");if(!o)throw new Error("resolveContext2d - canvas 2d context is null");return o}var Ga;(function(r){r.TOP_LEFT="TOP_LEFT",r.TOP_RIGHT="TOP_RIGHT",r.BOTTOM_LEFT="BOTTOM_LEFT",r.BOTTOM_RIGHT="BOTTOM_RIGHT"})(Ga||(Ga={}));var f1=(function(){function r(e){e===void 0&&(e={});var t=e.anchorPosition,n=e.backgroundColor,i=e.fontColor,o=e.fontSize,a=e.fontStyle,s=e.padding;this.anchorPosition=t||Ga.TOP_LEFT,this.backgroundColor=n||"rgba(0, 0, 0, 0.5)",this.fontColor=i||"rgba(255, 255, 255, 1)",this.fontSize=o||14,this.fontStyle=a||"Georgia",this.padding=s||4}return r})(),p1=(function(){function r(e,t,n){n===void 0&&(n={}),this.text=typeof e=="string"?[e]:e instanceof r?e.text:e,this.anchor=t,this.options=new f1(n)}return r.prototype.measureWidth=function(e){var t=this.options.padding;return this.text.map(function(n){return e.measureText(n).width}).reduce(function(n,i){return n<i?i:n},0)+2*t},r.prototype.measureHeight=function(){var e=this.options,t=e.fontSize,n=e.padding;return this.text.length*t+2*n},r.prototype.getUpperLeft=function(e,t){var n=this.options.anchorPosition,i=n===Ga.BOTTOM_RIGHT||n===Ga.TOP_RIGHT,o=n===Ga.BOTTOM_LEFT||n===Ga.BOTTOM_RIGHT,a=this.measureWidth(e),s=this.measureHeight(),u=i?this.anchor.x-a:this.anchor.x,l=o?this.anchor.y-s:this.anchor.y;if(t){var c=t.width,h=t.height,f=Math.max(Math.min(u,c-a),0),m=Math.max(Math.min(l,h-s),0);return{x:f,y:m}}return{x:u,y:l}},r.prototype.draw=function(e){var t=d1(e),n=ma(t),i=this.options,o=i.backgroundColor,a=i.fontColor,s=i.fontSize,u=i.fontStyle,l=i.padding;n.font=s+"px "+u;var c=this.measureWidth(n),h=this.measureHeight();n.fillStyle=o;var f=this.getUpperLeft(n,t);n.fillRect(f.x,f.y,c,h),n.fillStyle=a,this.text.forEach(function(m,g){var w=l+f.x,v=l+f.y+(g+1)*s;n.fillText(m,w,v)})},r})(),eA=(function(){function r(e){e===void 0&&(e={});var t=e.boxColor,n=e.lineWidth,i=e.label,o=e.drawLabelOptions;this.boxColor=t||"rgba(0, 0, 255, 1)",this.lineWidth=n||2,this.label=i;var a={anchorPosition:Ga.BOTTOM_LEFT,backgroundColor:this.boxColor};this.drawLabelOptions=new f1(Object.assign({},a,o))}return r})(),tA=(function(){function r(e,t){t===void 0&&(t={}),this.box=new pa(e),this.options=new eA(t)}return r.prototype.draw=function(e){var t=ma(e),n=this.options,i=n.boxColor,o=n.lineWidth,a=this.box,s=a.x,u=a.y,l=a.width,c=a.height;t.strokeStyle=i,t.lineWidth=o,t.strokeRect(s,u,l,c);var h=this.options.label;h&&new p1([h],{x:s-o/2,y:u},this.options.drawLabelOptions).draw(e)},r})();const Nz=Object.freeze(Object.defineProperty({__proto__:null,get AnchorPosition(){return Ga},DrawBox:tA,DrawBoxOptions:eA,DrawTextField:p1,DrawTextFieldOptions:f1},Symbol.toStringTag,{value:"Module"}));function Bo(r,e,t,n){return t===void 0&&(t="same"),n===void 0&&(n=!1),_n(function(){var i=lo(dl(r,e.filters,[1,1],t),e.bias);return n?dg(i):i})}function is(r,e){Object.keys(r).forEach(function(t){e.some(function(n){return n.originalPath===t})||r[t].dispose()})}function vg(r,e){return function(t,n,i,o){var a=ra(r(t*n*i*i),[i,i,t,n]),s=zo(r(n));return e.push({paramPath:o+"/filters"},{paramPath:o+"/bias"}),{filters:a,bias:s}}}function m1(r,e){return function(t,n,i){var o=Zu(r(t*n),[t,n]),a=zo(r(n));return e.push({paramPath:i+"/weights"},{paramPath:i+"/bias"}),{weights:o,bias:a}}}var nA=(function(){function r(e,t,n){this.depthwise_filter=e,this.pointwise_filter=t,this.bias=n}return r})();function g1(r,e){return function(t,n,i){var o=ra(r(9*t),[3,3,t,1]),a=ra(r(t*n),[1,1,t,n]),s=zo(r(n));return e.push({paramPath:i+"/depthwise_filter"},{paramPath:i+"/pointwise_filter"},{paramPath:i+"/bias"}),new nA(o,a,s)}}function v1(r){return function(e){var t=r(e+"/depthwise_filter",4),n=r(e+"/pointwise_filter",4),i=r(e+"/bias",1);return new nA(t,n,i)}}function cu(r,e){return function(t,n,i){var o=r[t];if(!pg(o,n))throw new Error("expected weightMap["+t+"] to be a Tensor"+n+"D, instead have "+o);return e.push({originalPath:t,paramPath:i||t}),o}}function os(r){var e=r;function t(i){var o=e.slice(0,i);return e=e.slice(i),o}function n(){return e}return{extractWeights:t,getRemainingWeights:n}}function rA(r,e){var t=e+"-weights_manifest.json";if(!r)return{modelBaseUri:"",manifestUri:t};if(r==="/")return{modelBaseUri:"/",manifestUri:"/"+t};var n=r.startsWith("http://")?"http://":r.startsWith("https://")?"https://":"";r=r.replace(n,"");var i=r.split("/").filter(function(s){return s}),o=r.endsWith(".json")?i[i.length-1]:t,a=n+(r.endsWith(".json")?i.slice(0,i.length-1):i).join("/");return a=r.startsWith("/")?"/"+a:a,{modelBaseUri:a,manifestUri:a==="/"?"/"+o:a+"/"+o}}function iA(r){var e=qr.getEnv(),t=e.Image,n=e.Video;return r instanceof t&&r.complete||r instanceof n&&r.readyState>=3}function Pz(r){return new Promise(function(e,t){if(r instanceof qr.getEnv().Canvas||iA(r))return e();function n(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",n),o.currentTarget.removeEventListener("error",i),e(o))}function i(o){o.currentTarget&&(o.currentTarget.removeEventListener("load",n),o.currentTarget.removeEventListener("error",i),t(o))}r.addEventListener("load",n),r.addEventListener("error",i)})}function oA(r){var e=qr.getEnv(),t=e.Image,n=e.Video;return r instanceof t?new Ac(r.naturalWidth,r.naturalHeight):r instanceof n?new Ac(r.videoWidth,r.videoHeight):new Ac(r.width,r.height)}function yg(r){var e=r.width,t=r.height,n=qr.getEnv().createCanvasElement,i=n();return i.width=e,i.height=t,i}function y1(r,e){var t=qr.getEnv().ImageData;if(!(r instanceof t)&&!iA(r))throw new Error("createCanvasFromMedia - media has not finished loading yet");var n=oA(r),i=n.width,o=n.height,a=yg({width:i,height:o});return r instanceof t?ma(a).putImageData(r,0,0):ma(a).drawImage(r,0,0,i,o),a}function Fz(r,e){return It(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return t=qr.getEnv().fetch,[4,t(r,e)];case 1:if(n=i.sent(),!(n.status<400))throw new Error("failed to fetch: ("+n.status+") "+n.statusText+", from url: "+n.url);return[2,n]}})})}function Oz(r){return It(this,void 0,void 0,function(){return Dt(this,function(e){switch(e.label){case 0:return[4,Fz(r)];case 1:return[2,e.sent().json()]}})})}function Lz(r,e){return It(this,void 0,void 0,function(){var t,n,i,o,a,s;return Dt(this,function(u){switch(u.label){case 0:return t=qr.getEnv().createCanvasElement(),n=r.shape.slice(Ys(r)?1:0),i=n[0],o=n[1],a=n[2],s=_n(function(){return r.as3D(i,o,a).toInt()}),[4,qM.toPixels(s,t)];case 1:return u.sent(),s.dispose(),[2,t]}})})}function Bz(r,e,t){t===void 0&&(t=!1);var n=qr.getEnv(),i=n.Image,o=n.Canvas;if(!(r instanceof i||r instanceof o))throw new Error("imageToSquare - expected arg0 to be HTMLImageElement | HTMLCanvasElement");var a=oA(r),s=e/Math.max(a.height,a.width),u=s*a.width,l=s*a.height,c=yg({width:e,height:e}),h=r instanceof o?r:y1(r),f=Math.abs(u-l)/2,m=t&&u<l?f:0,g=t&&l<u?f:0;return ma(c).drawImage(h,m,g,u,l),c}function BE(r){var e=qr.getEnv(),t=e.Image,n=e.Canvas,i=e.Video;return r instanceof t||r instanceof n||r instanceof i}function Uz(r,e){return It(this,void 0,void 0,function(){var t,n,i,o;return Dt(this,function(a){switch(a.label){case 0:return t=rA(r,e),n=t.manifestUri,i=t.modelBaseUri,[4,Oz(n)];case 1:return o=a.sent(),[2,jM.loadWeights(o,i)]}})})}function zz(r,e){return e===void 0&&(e=!1),_n(function(){var t=r.shape.slice(1),n=t[0],i=t[1];if(n===i)return r;var o=Math.abs(n-i),a=Math.round(o*(e?.5:1)),s=n>i?2:1,u=function(m){var g=r.shape.slice();return g[s]=m,Qu(g,0)},l=u(a),c=o-l.shape[s],h=e&&c?u(c):null,f=[h,r,l].filter(function(m){return!!m}).map(function(m){return m.toFloat()});return uo(f,s)})}var Wm=(function(){function r(e,t){var n=this;if(t===void 0&&(t=!1),this._imageTensors=[],this._canvases=[],this._treatAsBatchInput=!1,this._inputDimensions=[],!Array.isArray(e))throw new Error("NetInput.constructor - expected inputs to be an Array of TResolvedNetInput or to be instanceof tf.Tensor4D, instead have "+e);this._treatAsBatchInput=t,this._batchSize=e.length,e.forEach(function(i,o){if(mg(i)){n._imageTensors[o]=i,n._inputDimensions[o]=i.shape;return}if(Ys(i)){var a=i.shape[0];if(a!==1)throw new Error("NetInput - tf.Tensor4D with batchSize "+a+" passed, but not supported in input array");n._imageTensors[o]=i,n._inputDimensions[o]=i.shape.slice(1);return}var s=i instanceof qr.getEnv().Canvas?i:y1(i);n._canvases[o]=s,n._inputDimensions[o]=[s.height,s.width,3]})}return Object.defineProperty(r.prototype,"imageTensors",{get:function(){return this._imageTensors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"canvases",{get:function(){return this._canvases},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isBatchInput",{get:function(){return this.batchSize>1||this._treatAsBatchInput},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"batchSize",{get:function(){return this._batchSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputDimensions",{get:function(){return this._inputDimensions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"reshapedInputDimensions",{get:function(){var e=this;return rd(this.batchSize,0,1).map(function(t,n){return e.getReshapedInputDimensions(n)})},enumerable:!0,configurable:!0}),r.prototype.getInput=function(e){return this.canvases[e]||this.imageTensors[e]},r.prototype.getInputDimensions=function(e){return this._inputDimensions[e]},r.prototype.getInputHeight=function(e){return this._inputDimensions[e][0]},r.prototype.getInputWidth=function(e){return this._inputDimensions[e][1]},r.prototype.getReshapedInputDimensions=function(e){if(typeof this.inputSize!="number")throw new Error("getReshapedInputDimensions - inputSize not set, toBatchTensor has not been called yet");var t=this.getInputWidth(e),n=this.getInputHeight(e);return Rz({width:t,height:n},this.inputSize)},r.prototype.toBatchTensor=function(e,t){var n=this;return t===void 0&&(t=!0),this._inputSize=e,_n(function(){var i=rd(n.batchSize,0,1).map(function(a){var s=n.getInput(a);if(s instanceof Nn){var u=Ys(s)?s:s.expandDims();return u=zz(u,t),(u.shape[1]!==e||u.shape[2]!==e)&&(u=PM.resizeBilinear(u,[e,e])),u.as3D(e,e,3)}if(s instanceof qr.getEnv().Canvas)return qM.fromPixels(Bz(s,e,t));throw new Error("toBatchTensor - at batchIdx "+a+", expected input to be instanceof tf.Tensor or instanceof HTMLCanvasElement, instead have "+s)}),o=Qs(i.map(function(a){return a.toFloat()})).as4D(n.batchSize,e,e,3);return o})},r})();function _r(r){return It(this,void 0,void 0,function(){var e,t,n;return Dt(this,function(i){switch(i.label){case 0:if(r instanceof Wm)return[2,r];if(e=Array.isArray(r)?r:[r],!e.length)throw new Error("toNetInput - empty array passed as input");return t=function(o){return Array.isArray(r)?" at input index "+o+":":""},n=e.map(d1),n.forEach(function(o,a){if(!BE(o)&&!mg(o)&&!Ys(o))throw typeof e[a]=="string"?new Error("toNetInput -"+t(a)+" string passed, but could not resolve HTMLElement for element id "+e[a]):new Error("toNetInput -"+t(a)+" expected media to be of type HTMLImageElement | HTMLVideoElement | HTMLCanvasElement | tf.Tensor3D, or to be an element id");if(Ys(o)){var s=o.shape[0];if(s!==1)throw new Error("toNetInput -"+t(a)+" tf.Tensor4D with batchSize "+s+" passed, but not supported in input array")}}),[4,Promise.all(n.map(function(o){return BE(o)&&Pz(o)}))];case 1:return i.sent(),[2,new Wm(n,Array.isArray(r))]}})})}var as=(function(){function r(e){this._name=e,this._params=void 0,this._paramMappings=[]}return Object.defineProperty(r.prototype,"params",{get:function(){return this._params},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"paramMappings",{get:function(){return this._paramMappings},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isLoaded",{get:function(){return!!this.params},enumerable:!0,configurable:!0}),r.prototype.getParamFromPath=function(e){var t=this.traversePropertyPath(e),n=t.obj,i=t.objProp;return n[i]},r.prototype.reassignParamFromPath=function(e,t){var n=this.traversePropertyPath(e),i=n.obj,o=n.objProp;i[o].dispose(),i[o]=t},r.prototype.getParamList=function(){var e=this;return this._paramMappings.map(function(t){var n=t.paramPath;return{path:n,tensor:e.getParamFromPath(n)}})},r.prototype.getTrainableParams=function(){return this.getParamList().filter(function(e){return e.tensor instanceof Bc})},r.prototype.getFrozenParams=function(){return this.getParamList().filter(function(e){return!(e.tensor instanceof Bc)})},r.prototype.variable=function(){var e=this;this.getFrozenParams().forEach(function(t){var n=t.path,i=t.tensor;e.reassignParamFromPath(n,i.variable())})},r.prototype.freeze=function(){var e=this;this.getTrainableParams().forEach(function(t){var n=t.path,i=t.tensor,o=Cr(i.dataSync());i.dispose(),e.reassignParamFromPath(n,o)})},r.prototype.dispose=function(e){e===void 0&&(e=!0),this.getParamList().forEach(function(t){if(e&&t.tensor.isDisposed)throw new Error("param tensor has already been disposed for path "+t.path);t.tensor.dispose()}),this._params=void 0},r.prototype.serializeParams=function(){return new Float32Array(this.getParamList().map(function(e){var t=e.tensor;return Array.from(t.dataSync())}).reduce(function(e,t){return e.concat(t)}))},r.prototype.load=function(e){return It(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return e instanceof Float32Array?(this.extractWeights(e),[2]):[4,this.loadFromUri(e)];case 1:return t.sent(),[2]}})})},r.prototype.loadFromUri=function(e){return It(this,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromUri - expected model uri");return[4,Uz(e,this.getDefaultModelName())];case 1:return t=n.sent(),this.loadFromWeightMap(t),[2]}})})},r.prototype.loadFromDisk=function(e){return It(this,void 0,void 0,function(){var t,n,i,o,a,s,u,l,c,h;return Dt(this,function(f){switch(f.label){case 0:if(e&&typeof e!="string")throw new Error(this._name+".loadFromDisk - expected model file path");return t=qr.getEnv().readFile,n=rA(e,this.getDefaultModelName()),i=n.manifestUri,o=n.modelBaseUri,a=function(m){return Promise.all(m.map(function(g){return t(g).then(function(w){return w.buffer})}))},s=jM.weightsLoaderFactory(a),c=(l=JSON).parse,[4,t(i)];case 1:return u=c.apply(l,[f.sent().toString()]),[4,s(u,o)];case 2:return h=f.sent(),this.loadFromWeightMap(h),[2]}})})},r.prototype.loadFromWeightMap=function(e){var t=this.extractParamsFromWeigthMap(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.extractWeights=function(e){var t=this.extractParams(e),n=t.paramMappings,i=t.params;this._paramMappings=n,this._params=i},r.prototype.traversePropertyPath=function(e){if(!this.params)throw new Error("traversePropertyPath - model has no loaded params");var t=e.split("/").reduce(function(o,a){if(!o.nextObj.hasOwnProperty(a))throw new Error("traversePropertyPath - object does not have property "+a+", for path "+e);return{obj:o.nextObj,objProp:a,nextObj:o.nextObj[a]}},{nextObj:this.params}),n=t.obj,i=t.objProp;if(!n||!i||!(n[i]instanceof Nn))throw new Error("traversePropertyPath - parameter is not a tensor, for path "+e);return{obj:n,objProp:i}},r})();function Wz(r,e,t){t===void 0&&(t=!0);var n=Math.max(0,Math.min(r.right,e.right)-Math.max(r.left,e.left)),i=Math.max(0,Math.min(r.bottom,e.bottom)-Math.max(r.top,e.top)),o=n*i;return t?o/(r.area+e.area-o):o/Math.min(r.area,e.area)}function id(r,e,t,n){n===void 0&&(n=!0);for(var i=e.map(function(s,u){return{score:s,boxIndex:u}}).sort(function(s,u){return s.score-u.score}).map(function(s){return s.boxIndex}),o=[],a=function(){var s=i.pop();o.push(s);for(var u=i,l=[],c=0;c<u.length;c++){var h=u[c],f=r[s],m=r[h];l.push(Wz(f,m,n))}i=i.filter(function(g,w){return l[w]<=t})};i.length>0;)a();return o}function Dd(r,e){return _n(function(){var t=e[0],n=e[1],i=e[2],o=Qu(py(r.shape.slice(0,3),[1]),t),a=Qu(py(r.shape.slice(0,3),[1]),n),s=Qu(py(r.shape.slice(0,3),[1]),i),u=uo([o,a,s],3);return Lo(r,u)})}function o0(r){return 1/(1+Math.exp(-r))}var yp=function(r){return typeof r=="number"};function Hz(r){if(!r)throw new Error("invalid config: "+r);if(typeof r.withSeparableConvs!="boolean")throw new Error("config.withSeparableConvs has to be a boolean, have: "+r.withSeparableConvs);if(!yp(r.iouThreshold)||r.iouThreshold<0||r.iouThreshold>1)throw new Error("config.iouThreshold has to be a number between [0, 1], have: "+r.iouThreshold);if(!Array.isArray(r.classes)||!r.classes.length||!r.classes.every(function(e){return typeof e=="string"}))throw new Error("config.classes has to be an array class names: string[], have: "+JSON.stringify(r.classes));if(!Array.isArray(r.anchors)||!r.anchors.length||!r.anchors.map(function(e){return e||{}}).every(function(e){return yp(e.x)&&yp(e.y)}))throw new Error("config.anchors has to be an array of { x: number, y: number }, have: "+JSON.stringify(r.anchors));if(r.meanRgb&&(!Array.isArray(r.meanRgb)||r.meanRgb.length!==3||!r.meanRgb.every(yp)))throw new Error("config.meanRgb has to be an array of shape [number, number, number], have: "+JSON.stringify(r.meanRgb))}function b1(r){return _n(function(){var e=$n(r,Ct(.10000000149011612));return lo(dg(Lo(r,e)),e)})}function Rs(r,e){return _n(function(){var t=ns(r,[[0,0],[1,1],[1,1],[0,0]]);return t=dl(t,e.conv.filters,[1,1],"valid"),t=Lo(t,e.bn.sub),t=$n(t,e.bn.truediv),t=lo(t,e.conv.bias),b1(t)})}function Is(r,e){return _n(function(){var t=ns(r,[[0,0],[1,1],[1,1],[0,0]]);return t=_M(t,e.depthwise_filter,e.pointwise_filter,[1,1],"valid"),t=lo(t,e.bias),b1(t)})}function Gz(r,e){var t=vg(r,e);function n(a,s){var u=zo(r(a)),l=zo(r(a));return e.push({paramPath:s+"/sub"},{paramPath:s+"/truediv"}),{sub:u,truediv:l}}function i(a,s,u){var l=t(a,s,3,u+"/conv"),c=n(s,u+"/bn");return{conv:l,bn:c}}var o=g1(r,e);return{extractConvParams:t,extractConvWithBatchNormParams:i,extractSeparableConvParams:o}}function Vz(r,e,t,n){var i=os(r),o=i.extractWeights,a=i.getRemainingWeights,s=[],u=Gz(o,s),l=u.extractConvParams,c=u.extractConvWithBatchNormParams,h=u.extractSeparableConvParams,f;if(e.withSeparableConvs){var m=n[0],g=n[1],w=n[2],v=n[3],y=n[4],x=n[5],E=n[6],_=n[7],k=n[8],C=e.isFirstLayerConv2d?l(m,g,3,"conv0"):h(m,g,"conv0"),R=h(g,w,"conv1"),I=h(w,v,"conv2"),T=h(v,y,"conv3"),A=h(y,x,"conv4"),N=h(x,E,"conv5"),O=_?h(E,_,"conv6"):void 0,V=k?h(_,k,"conv7"):void 0,F=l(k||_||E,5*t,1,"conv8");f={conv0:C,conv1:R,conv2:I,conv3:T,conv4:A,conv5:N,conv6:O,conv7:V,conv8:F}}else{var m=n[0],g=n[1],w=n[2],v=n[3],y=n[4],x=n[5],E=n[6],_=n[7],k=n[8],C=c(m,g,"conv0"),R=c(g,w,"conv1"),I=c(w,v,"conv2"),T=c(v,y,"conv3"),A=c(y,x,"conv4"),N=c(x,E,"conv5"),O=c(E,_,"conv6"),V=c(_,k,"conv7"),F=l(k,5*t,1,"conv8");f={conv0:C,conv1:R,conv2:I,conv3:T,conv4:A,conv5:N,conv6:O,conv7:V,conv8:F}}if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{params:f,paramMappings:s}}function jz(r,e){var t=cu(r,e);function n(s){var u=t(s+"/sub",1),l=t(s+"/truediv",1);return{sub:u,truediv:l}}function i(s){var u=t(s+"/filters",4),l=t(s+"/bias",1);return{filters:u,bias:l}}function o(s){var u=i(s+"/conv"),l=n(s+"/bn");return{conv:u,bn:l}}var a=v1(t);return{extractConvParams:i,extractConvWithBatchNormParams:o,extractSeparableConvParams:a}}function qz(r,e){var t=[],n=jz(r,t),i=n.extractConvParams,o=n.extractConvWithBatchNormParams,a=n.extractSeparableConvParams,s;if(e.withSeparableConvs){var u=e.filterSizes&&e.filterSizes.length||9;s={conv0:e.isFirstLayerConv2d?i("conv0"):a("conv0"),conv1:a("conv1"),conv2:a("conv2"),conv3:a("conv3"),conv4:a("conv4"),conv5:a("conv5"),conv6:u>7?a("conv6"):void 0,conv7:u>8?a("conv7"):void 0,conv8:i("conv8")}}else s={conv0:o("conv0"),conv1:o("conv1"),conv2:o("conv2"),conv3:o("conv3"),conv4:o("conv4"),conv5:o("conv5"),conv6:o("conv6"),conv7:o("conv7"),conv8:i("conv8")};return is(r,t),{params:s,paramMappings:t}}var UE;(function(r){r[r.XS=224]="XS",r[r.SM=320]="SM",r[r.MD=416]="MD",r[r.LG=608]="LG"})(UE||(UE={}));var w1=(function(){function r(e){var t=e===void 0?{}:e,n=t.inputSize,i=t.scoreThreshold;if(this._name="TinyYolov2Options",this._inputSize=n||416,this._scoreThreshold=i||.5,typeof this._inputSize!="number"||this._inputSize%32!==0)throw new Error(this._name+" - expected inputSize to be a number divisible by 32");if(typeof this._scoreThreshold!="number"||this._scoreThreshold<=0||this._scoreThreshold>=1)throw new Error(this._name+" - expected scoreThreshold to be a number between 0 and 1")}return Object.defineProperty(r.prototype,"inputSize",{get:function(){return this._inputSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThreshold",{get:function(){return this._scoreThreshold},enumerable:!0,configurable:!0}),r})(),aA=(function(r){Yt(e,r);function e(t){var n=r.call(this,"TinyYolov2")||this;return Hz(t),n._config=t,n}return Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"withClassScores",{get:function(){return this.config.withClassScores||this.config.classes.length>1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"boxEncodingSize",{get:function(){return 5+(this.withClassScores?this.config.classes.length:0)},enumerable:!0,configurable:!0}),e.prototype.runTinyYolov2=function(t,n){var i=Rs(t,n.conv0);return i=Ri(i,[2,2],[2,2],"same"),i=Rs(i,n.conv1),i=Ri(i,[2,2],[2,2],"same"),i=Rs(i,n.conv2),i=Ri(i,[2,2],[2,2],"same"),i=Rs(i,n.conv3),i=Ri(i,[2,2],[2,2],"same"),i=Rs(i,n.conv4),i=Ri(i,[2,2],[2,2],"same"),i=Rs(i,n.conv5),i=Ri(i,[2,2],[1,1],"same"),i=Rs(i,n.conv6),i=Rs(i,n.conv7),Bo(i,n.conv8,"valid",!1)},e.prototype.runMobilenet=function(t,n){var i=this.config.isFirstLayerConv2d?b1(Bo(t,n.conv0,"valid",!1)):Is(t,n.conv0);return i=Ri(i,[2,2],[2,2],"same"),i=Is(i,n.conv1),i=Ri(i,[2,2],[2,2],"same"),i=Is(i,n.conv2),i=Ri(i,[2,2],[2,2],"same"),i=Is(i,n.conv3),i=Ri(i,[2,2],[2,2],"same"),i=Is(i,n.conv4),i=Ri(i,[2,2],[2,2],"same"),i=Is(i,n.conv5),i=Ri(i,[2,2],[1,1],"same"),i=n.conv6?Is(i,n.conv6):i,i=n.conv7?Is(i,n.conv7):i,Bo(i,n.conv8,"valid",!1)},e.prototype.forwardInput=function(t,n){var i=this,o=this.params;if(!o)throw new Error("TinyYolov2 - load model before inference");return _n(function(){var a=t.toBatchTensor(n,!1).toFloat();return a=i.config.meanRgb?Dd(a,i.config.meanRgb):a,a=a.div(Ct(256)),i.config.withSeparableConvs?i.runMobilenet(a,o):i.runTinyYolov2(a,o)})},e.prototype.forward=function(t,n){return It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,_r(t)];case 1:return[4,i.apply(this,[o.sent(),n])];case 2:return[2,o.sent()]}})})},e.prototype.detect=function(t,n){return n===void 0&&(n={}),It(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,f,m,g,w,v,y,x=this;return Dt(this,function(E){switch(E.label){case 0:return i=new w1(n),o=i.inputSize,a=i.scoreThreshold,[4,_r(t)];case 1:return s=E.sent(),[4,this.forwardInput(s,o)];case 2:return u=E.sent(),l=_n(function(){return ig(u)[0].expandDims()}),c={width:s.getInputWidth(0),height:s.getInputHeight(0)},[4,this.extractBoxes(l,s.getReshapedInputDimensions(0),a)];case 3:return h=E.sent(),u.dispose(),l.dispose(),f=h.map(function(_){return _.box}),m=h.map(function(_){return _.score}),g=h.map(function(_){return _.classScore}),w=h.map(function(_){return x.config.classes[_.label]}),v=id(f.map(function(_){return _.rescale(o)}),m,this.config.iouThreshold,!0),y=v.map(function(_){return new XM(m[_],g[_],w[_],f[_],c)}),[2,y]}})})},e.prototype.getDefaultModelName=function(){return""},e.prototype.extractParamsFromWeigthMap=function(t){return qz(t,this.config)},e.prototype.extractParams=function(t){var n=this.config.filterSizes||e.DEFAULT_FILTER_SIZES,i=n?n.length:void 0;if(i!==7&&i!==8&&i!==9)throw new Error("TinyYolov2 - expected 7 | 8 | 9 convolutional filters, but found "+i+" filterSizes in config");return Vz(t,this.config,this.boxEncodingSize,n)},e.prototype.extractBoxes=function(t,n,i){return It(this,void 0,void 0,function(){var o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,R,I,T,A,N,O,V,F,B,U,P,L=this;return Dt(this,function(H){switch(H.label){case 0:return o=n.width,a=n.height,s=Math.max(o,a),u=s/o,l=s/a,c=t.shape[1],h=this.config.anchors.length,f=_n(function(){var W=t.reshape([c,c,h,L.boxEncodingSize]),z=W.slice([0,0,0,0],[c,c,h,4]),q=W.slice([0,0,0,4],[c,c,h,1]),re=L.withClassScores?ug(W.slice([0,0,0,5],[c,c,h,L.config.classes.length]),3):Ct(0);return[z,q,re]}),m=f[0],g=f[1],w=f[2],v=[],[4,g.array()];case 1:return y=H.sent(),[4,m.array()];case 2:x=H.sent(),E=0,H.label=3;case 3:if(!(E<c))return[3,12];_=0,H.label=4;case 4:if(!(_<c))return[3,11];k=0,H.label=5;case 5:return k<h?(C=o0(y[E][_][k][0]),!i||C>i?(R=(_+o0(x[E][_][k][0]))/c*u,I=(E+o0(x[E][_][k][1]))/c*l,T=Math.exp(x[E][_][k][2])*this.config.anchors[k].x/c*u,A=Math.exp(x[E][_][k][3])*this.config.anchors[k].y/c*l,N=R-T/2,O=I-A/2,V={row:E,col:_,anchor:k},this.withClassScores?[4,this.extractPredictedClass(w,V)]:[3,7]):[3,9]):[3,10];case 6:return P=H.sent(),[3,8];case 7:P={classScore:1,label:0},H.label=8;case 8:F=P,B=F.classScore,U=F.label,v.push(Fo({box:new gg(N,O,N+T,O+A),score:C,classScore:C*B,label:U},V)),H.label=9;case 9:return k++,[3,5];case 10:return _++,[3,4];case 11:return E++,[3,3];case 12:return m.dispose(),g.dispose(),w.dispose(),[2,v]}})})},e.prototype.extractPredictedClass=function(t,n){return It(this,void 0,void 0,function(){var i,o,a,s;return Dt(this,function(u){switch(u.label){case 0:return i=n.row,o=n.col,a=n.anchor,[4,t.array()];case 1:return s=u.sent(),[2,Array(this.config.classes.length).fill(0).map(function(l,c){return s[i][o][a][c]}).map(function(l,c){return{classScore:l,label:c}}).reduce(function(l,c){return l.classScore>c.classScore?l:c})]}})})},e.DEFAULT_FILTER_SIZES=[3,16,32,64,128,256,512,1024,1024],e})(as);function zs(r,e,t){if(t===void 0&&(t=!1),r.beginPath(),e.slice(1).forEach(function(o,a){var s=o.x,u=o.y,l=e[a];r.moveTo(l.x,l.y),r.lineTo(s,u)}),t){var n=e[e.length-1],i=e[0];if(!n||!i)return;r.moveTo(n.x,n.y),r.lineTo(i.x,i.y)}r.stroke()}var co=(function(r){Yt(e,r);function e(t,n,i){return r.call(this,t,t,"",n,i)||this}return e.prototype.forSize=function(t,n){var i=r.prototype.forSize.call(this,t,n),o=i.score,a=i.relativeBox,s=i.imageDims;return new e(o,a,s)},e})(XM);function Hm(r){return r.detection instanceof co}function _1(r,e){var t={detection:e};return Object.assign({},r,t)}function $z(r,e){var t=Array.isArray(e)?e:[e];t.forEach(function(n){var i=n instanceof co?n.score:Hm(n)?n.detection.score:void 0,o=n instanceof co?n.box:Hm(n)?n.detection.box:new pa(n),a=i?""+u1(i):void 0;new tA(o,{label:a}).draw(r)})}function Ui(r,e,t){return Rt(function(){var n=ST(r,e.depthwise_filter,e.pointwise_filter,t,"same");return n=wn(n,e.bias),n})}function a0(r,e,t){return t===void 0&&(t=!1),Rt(function(){var n=er(t?wn(Qa(r,e.conv0.filters,[2,2],"same"),e.conv0.bias):Ui(r,e.conv0,[2,2])),i=Ui(n,e.conv1,[1,1]),o=er(wn(n,i)),a=Ui(o,e.conv2,[1,1]);return er(wn(n,wn(i,a)))})}function bp(r,e,t,n){return t===void 0&&(t=!1),n===void 0&&(n=!0),Rt(function(){var i=er(t?wn(Qa(r,e.conv0.filters,n?[2,2]:[1,1],"same"),e.conv0.bias):Ui(r,e.conv0,n?[2,2]:[1,1])),o=Ui(i,e.conv1,[1,1]),a=er(wn(i,o)),s=Ui(a,e.conv2,[1,1]),u=er(wn(i,wn(o,s))),l=Ui(u,e.conv3,[1,1]);return er(wn(i,wn(o,wn(s,l))))})}function sA(r,e){var t=vg(r,e),n=g1(r,e);function i(a,s,u,l){l===void 0&&(l=!1);var c=l?t(a,s,3,u+"/conv0"):n(a,s,u+"/conv0"),h=n(s,s,u+"/conv1"),f=n(s,s,u+"/conv2");return{conv0:c,conv1:h,conv2:f}}function o(a,s,u,l){l===void 0&&(l=!1);var c=i(a,s,u,l),h=c.conv0,f=c.conv1,m=c.conv2,g=n(s,s,u+"/conv3");return{conv0:h,conv1:f,conv2:m,conv3:g}}return{extractDenseBlock3Params:i,extractDenseBlock4Params:o}}function Xz(r){var e=[],t=os(r),n=t.extractWeights,i=t.getRemainingWeights,o=sA(n,e).extractDenseBlock4Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2"),l=o(128,256,"dense3");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u,dense3:l}}}function uA(r){return function(e){var t=r(e+"/filters",4),n=r(e+"/bias",1);return{filters:t,bias:n}}}function lA(r,e){var t=cu(r,e),n=uA(t),i=v1(t);function o(s,u){u===void 0&&(u=!1);var l=u?n(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2");return{conv0:l,conv1:c,conv2:h}}function a(s,u){u===void 0&&(u=!1);var l=u?n(s+"/conv0"):i(s+"/conv0"),c=i(s+"/conv1"),h=i(s+"/conv2"),f=i(s+"/conv3");return{conv0:l,conv1:c,conv2:h,conv3:f}}return{extractDenseBlock3Params:o,extractDenseBlock4Params:a}}function Yz(r){var e=[],t=lA(r,e).extractDenseBlock4Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2"),dense3:t("dense3")};return is(r,e),{params:n,paramMappings:e}}var cA=(function(r){Yt(e,r);function e(){return r.call(this,"FaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceFeatureExtractor - load model before inference");return Rt(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Dd(i,o).div(dt(255)),s=bp(a,n.dense0,!0);return s=bp(s,n.dense1),s=bp(s,n.dense2),s=bp(s,n.dense3),s=Ed(s,[7,7],[2,2],"valid"),s})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_model"},e.prototype.extractParamsFromWeigthMap=function(t){return Yz(t)},e.prototype.extractParams=function(t){return Xz(t)},e})(as);function la(r,e){return Rt(function(){return wn(Iw(r,e.weights),e.bias)})}function Kz(r,e,t){var n=[],i=os(r),o=i.extractWeights,a=i.getRemainingWeights,s=m1(o,n),u=s(e,t,"fc");if(a().length!==0)throw new Error("weights remaing after extract: "+a().length);return{paramMappings:n,params:{fc:u}}}function Jz(r){var e=[],t=cu(r,e);function n(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:n("fc")};return is(r,e),{params:i,paramMappings:e}}function hA(r){var e={},t={};return Object.keys(r).forEach(function(n){var i=n.startsWith("fc")?t:e;i[n]=r[n]}),{featureExtractorMap:e,classifierMap:t}}var dA=(function(r){Yt(e,r);function e(t,n){var i=r.call(this,t)||this;return i._faceFeatureExtractor=n,i}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Rt(function(){var o=t instanceof Wm?n.faceFeatureExtractor.forwardInput(t):t;return la(o.as2D(o.shape[0],-1),i.fc)})},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,o=n.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return Kz(t,this.getClassifierChannelsIn(),this.getClassifierChannelsOut())},e.prototype.extractParamsFromWeigthMap=function(t){var n=hA(t),i=n.featureExtractorMap,o=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),Jz(o)},e.prototype.extractParams=function(t){var n=this.getClassifierChannelsIn(),i=this.getClassifierChannelsOut(),o=i*n+i,a=t.slice(0,t.length-o),s=t.slice(t.length-o);return this.faceFeatureExtractor.extractWeights(a),this.extractClassifierParams(s)},e})(as),zE=["neutral","happy","sad","angry","fearful","disgusted","surprised"],x1=(function(){function r(e){var t=this;if(e.length!==7)throw new Error("FaceExpressions.constructor - expected probabilities.length to be 7, have: "+e.length);zE.forEach(function(n,i){t[n]=e[i]})}return r.prototype.asSortedArray=function(){var e=this;return zE.map(function(t){return{expression:t,probability:e[t]}}).sort(function(t,n){return n.probability-t.probability})},r})(),Zz=(function(r){Yt(e,r);function e(t){return t===void 0&&(t=new cA),r.call(this,"FaceExpressionNet",t)||this}return e.prototype.forwardInput=function(t){var n=this;return Rt(function(){return su(n.runNet(t))})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictExpressions=function(t){return It(this,void 0,void 0,function(){var n,i,o,a,s=this;return Dt(this,function(u){switch(u.label){case 0:return[4,_r(t)];case 1:return n=u.sent(),[4,this.forwardInput(n)];case 2:return i=u.sent(),[4,Promise.all(Tr(i).map(function(l){return It(s,void 0,void 0,function(){var c;return Dt(this,function(h){switch(h.label){case 0:return[4,l.data()];case 1:return c=h.sent(),l.dispose(),[2,c]}})})}))];case 3:return o=u.sent(),i.dispose(),a=o.map(function(l){return new x1(l)}),[2,n.isBatchInput?a:a[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_expression_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e.prototype.getClassifierChannelsOut=function(){return 7},e})(dA);function Qz(r){return r.expressions instanceof x1}function fA(r,e){var t={expressions:e};return Object.assign({},r,t)}function eW(r,e,t,n){t===void 0&&(t=.1);var i=Array.isArray(e)?e:[e];i.forEach(function(o){var a=o instanceof x1?o:Qz(o)?o.expressions:void 0;if(!a)throw new Error("drawFaceExpressions - expected faceExpressions to be FaceExpressions | WithFaceExpressions<{}> or array thereof");var s=a.asSortedArray(),u=s.filter(function(h){return h.probability>t}),l=Hm(o)?o.detection.box.bottomLeft:n||new yn(0,0),c=new p1(u.map(function(h){return h.expression+" ("+u1(h.probability)+")"}),l);c.draw(r)})}function tW(r){var e=r.map(function(s){return s.x}),t=r.map(function(s){return s.y}),n=e.reduce(function(s,u){return u<s?u:s},1/0),i=t.reduce(function(s,u){return u<s?u:s},1/0),o=e.reduce(function(s,u){return s<u?u:s},0),a=t.reduce(function(s,u){return s<u?u:s},0);return new gg(n,i,o,a)}var nW=.5,rW=.43,iW=.45,od=(function(){function r(e,t,n){n===void 0&&(n=new yn(0,0));var i=t.width,o=t.height;this._imgDims=new Ac(i,o),this._shift=n,this._positions=e.map(function(a){return a.mul(new yn(i,o)).add(n)})}return Object.defineProperty(r.prototype,"shift",{get:function(){return new yn(this._shift.x,this._shift.y)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageWidth",{get:function(){return this._imgDims.width},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"imageHeight",{get:function(){return this._imgDims.height},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"positions",{get:function(){return this._positions},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"relativePositions",{get:function(){var e=this;return this._positions.map(function(t){return t.sub(e._shift).div(new yn(e.imageWidth,e.imageHeight))})},enumerable:!0,configurable:!0}),r.prototype.forSize=function(e,t){return new this.constructor(this.relativePositions,{width:e,height:t})},r.prototype.shiftBy=function(e,t){return new this.constructor(this.relativePositions,this._imgDims,new yn(e,t))},r.prototype.shiftByPoint=function(e){return this.shiftBy(e.x,e.y)},r.prototype.align=function(e,t){if(t===void 0&&(t={}),e){var n=e instanceof co?e.box.floor():new pa(e);return this.shiftBy(n.x,n.y).align(null,t)}var i=Object.assign({},{useDlibAlignment:!1,minBoxPadding:.2},t),o=i.useDlibAlignment,a=i.minBoxPadding;return o?this.alignDlib():this.alignMinBbox(a)},r.prototype.alignDlib=function(){var e=this.getRefPointsForAlignment(),t=e[0],n=e[1],i=e[2],o=function(h){return i.sub(h).magnitude()},a=(o(t)+o(n))/2,s=Math.floor(a/iW),u=l1(e),l=Math.floor(Math.max(0,u.x-nW*s)),c=Math.floor(Math.max(0,u.y-rW*s));return new c1(l,c,Math.min(s,this.imageWidth+l),Math.min(s,this.imageHeight+c))},r.prototype.alignMinBbox=function(e){var t=tW(this.positions);return t.pad(t.width*e,t.height*e)},r.prototype.getRefPointsForAlignment=function(){throw new Error("getRefPointsForAlignment not implemented by base class")},r})(),pA=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getJawOutline=function(){return this.positions.slice(0,17)},e.prototype.getLeftEyeBrow=function(){return this.positions.slice(17,22)},e.prototype.getRightEyeBrow=function(){return this.positions.slice(22,27)},e.prototype.getNose=function(){return this.positions.slice(27,36)},e.prototype.getLeftEye=function(){return this.positions.slice(36,42)},e.prototype.getRightEye=function(){return this.positions.slice(42,48)},e.prototype.getMouth=function(){return this.positions.slice(48,68)},e.prototype.getRefPointsForAlignment=function(){return[this.getLeftEye(),this.getRightEye(),this.getMouth()].map(l1)},e})(od);function mA(r){return Hm(r)&&r.landmarks instanceof od&&r.unshiftedLandmarks instanceof od&&r.alignedRect instanceof co}function S1(r,e){var t=r.detection.box,n=e.shiftBy(t.x,t.y),i=n.align(),o=r.detection.imageDims,a=new co(r.detection.score,i.rescale(o.reverse()),o),s={landmarks:n,unshiftedLandmarks:e,alignedRect:a};return Object.assign({},r,s)}var gA=(function(){function r(e){e===void 0&&(e={});var t=e.drawLines,n=t===void 0?!0:t,i=e.drawPoints,o=i===void 0?!0:i,a=e.lineWidth,s=e.lineColor,u=e.pointSize,l=e.pointColor;this.drawLines=n,this.drawPoints=o,this.lineWidth=a||1,this.pointSize=u||2,this.lineColor=s||"rgba(0, 255, 255, 1)",this.pointColor=l||"rgba(255, 0, 255, 1)"}return r})(),vA=(function(){function r(e,t){t===void 0&&(t={}),this.faceLandmarks=e,this.options=new gA(t)}return r.prototype.draw=function(e){var t=ma(e),n=this.options,i=n.drawLines,o=n.drawPoints,a=n.lineWidth,s=n.lineColor,u=n.pointSize,l=n.pointColor;if(i&&this.faceLandmarks instanceof pA&&(t.strokeStyle=s,t.lineWidth=a,zs(t,this.faceLandmarks.getJawOutline()),zs(t,this.faceLandmarks.getLeftEyeBrow()),zs(t,this.faceLandmarks.getRightEyeBrow()),zs(t,this.faceLandmarks.getNose()),zs(t,this.faceLandmarks.getLeftEye(),!0),zs(t,this.faceLandmarks.getRightEye(),!0),zs(t,this.faceLandmarks.getMouth(),!0)),o){t.strokeStyle=l,t.fillStyle=l;var c=function(h){t.beginPath(),t.arc(h.x,h.y,u,0,2*Math.PI),t.fill()};this.faceLandmarks.positions.forEach(c)}},r})();function oW(r,e){var t=Array.isArray(e)?e:[e];t.forEach(function(n){var i=n instanceof od?n:mA(n)?n.landmarks:void 0;if(!i)throw new Error("drawFaceLandmarks - expected faceExpressions to be FaceLandmarks | WithFaceLandmarks<WithFaceDetection<{}>> or array thereof");new vA(i).draw(r)})}const aW=Object.freeze(Object.defineProperty({__proto__:null,DrawFaceLandmarks:vA,DrawFaceLandmarksOptions:gA,drawContour:zs,drawDetections:$z,drawFaceExpressions:eW,drawFaceLandmarks:oW},Symbol.toStringTag,{value:"Module"}));function sW(r,e){var t=vg(r,e),n=g1(r,e);function i(a,s,u){var l=n(a,s,u+"/separable_conv0"),c=n(s,s,u+"/separable_conv1"),h=t(a,s,1,u+"/expansion_conv");return{separable_conv0:l,separable_conv1:c,expansion_conv:h}}function o(a,s){var u=n(a,a,s+"/separable_conv0"),l=n(a,a,s+"/separable_conv1"),c=n(a,a,s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:t,extractSeparableConvParams:n,extractReductionBlockParams:i,extractMainBlockParams:o}}function uW(r,e){var t=[],n=os(r),i=n.extractWeights,o=n.getRemainingWeights,a=sW(i,t),s=a.extractConvParams,u=a.extractSeparableConvParams,l=a.extractReductionBlockParams,c=a.extractMainBlockParams,h=s(3,32,3,"entry_flow/conv_in"),f=l(32,64,"entry_flow/reduction_block_0"),m=l(64,128,"entry_flow/reduction_block_1"),g={conv_in:h,reduction_block_0:f,reduction_block_1:m},w={};rd(e,0,1).forEach(function(E){w["main_block_"+E]=c(128,"middle_flow/main_block_"+E)});var v=l(128,256,"exit_flow/reduction_block"),y=u(256,512,"exit_flow/separable_conv"),x={reduction_block:v,separable_conv:y};if(o().length!==0)throw new Error("weights remaing after extract: "+o().length);return{paramMappings:t,params:{entry_flow:g,middle_flow:w,exit_flow:x}}}function lW(r,e){var t=cu(r,e),n=uA(t),i=v1(t);function o(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=n(s+"/expansion_conv");return{separable_conv0:u,separable_conv1:l,expansion_conv:c}}function a(s){var u=i(s+"/separable_conv0"),l=i(s+"/separable_conv1"),c=i(s+"/separable_conv2");return{separable_conv0:u,separable_conv1:l,separable_conv2:c}}return{extractConvParams:n,extractSeparableConvParams:i,extractReductionBlockParams:o,extractMainBlockParams:a}}function cW(r,e){var t=[],n=lW(r,t),i=n.extractConvParams,o=n.extractSeparableConvParams,a=n.extractReductionBlockParams,s=n.extractMainBlockParams,u=i("entry_flow/conv_in"),l=a("entry_flow/reduction_block_0"),c=a("entry_flow/reduction_block_1"),h={conv_in:u,reduction_block_0:l,reduction_block_1:c},f={};rd(e,0,1).forEach(function(v){f["main_block_"+v]=s("middle_flow/main_block_"+v)});var m=a("exit_flow/reduction_block"),g=o("exit_flow/separable_conv"),w={reduction_block:m,separable_conv:g};return is(r,t),{params:{entry_flow:h,middle_flow:f,exit_flow:w},paramMappings:t}}function yA(r,e,t){return wn(Qa(r,e.filters,t,"same"),e.bias)}function s0(r,e,t){t===void 0&&(t=!0);var n=t?er(r):r;return n=Ui(n,e.separable_conv0,[1,1]),n=Ui(er(n),e.separable_conv1,[1,1]),n=Fc(n,[3,3],[2,2],"same"),n=wn(n,yA(r,e.expansion_conv,[2,2])),n}function hW(r,e){var t=Ui(er(r),e.separable_conv0,[1,1]);return t=Ui(er(t),e.separable_conv1,[1,1]),t=Ui(er(t),e.separable_conv2,[1,1]),t=wn(t,r),t}var dW=(function(r){Yt(e,r);function e(t){var n=r.call(this,"TinyXception")||this;return n._numMainBlocks=t,n}return e.prototype.forwardInput=function(t){var n=this,i=this.params;if(!i)throw new Error("TinyXception - load model before inference");return Rt(function(){var o=t.toBatchTensor(112,!0),a=[122.782,117.001,104.298],s=Dd(o,a).div(dt(256)),u=er(yA(s,i.entry_flow.conv_in,[2,2]));return u=s0(u,i.entry_flow.reduction_block_0,!1),u=s0(u,i.entry_flow.reduction_block_1),rd(n._numMainBlocks,0,1).forEach(function(l){u=hW(u,i.middle_flow["main_block_"+l])}),u=s0(u,i.exit_flow.reduction_block),u=er(Ui(u,i.exit_flow.separable_conv,[1,1])),u})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"tiny_xception_model"},e.prototype.extractParamsFromWeigthMap=function(t){return cW(t,this._numMainBlocks)},e.prototype.extractParams=function(t){return uW(t,this._numMainBlocks)},e})(as);function fW(r){var e=[],t=os(r),n=t.extractWeights,i=t.getRemainingWeights,o=m1(n,e),a=o(512,1,"fc/age"),s=o(512,2,"fc/gender");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{fc:{age:a,gender:s}}}}function pW(r){var e=[],t=cu(r,e);function n(o){var a=t(o+"/weights",2),s=t(o+"/bias",1);return{weights:a,bias:s}}var i={fc:{age:n("fc/age"),gender:n("fc/gender")}};return is(r,e),{params:i,paramMappings:e}}var Gm;(function(r){r.FEMALE="female",r.MALE="male"})(Gm||(Gm={}));var mW=(function(r){Yt(e,r);function e(t){t===void 0&&(t=new dW(2));var n=r.call(this,"AgeGenderNet")||this;return n._faceFeatureExtractor=t,n}return Object.defineProperty(e.prototype,"faceFeatureExtractor",{get:function(){return this._faceFeatureExtractor},enumerable:!0,configurable:!0}),e.prototype.runNet=function(t){var n=this,i=this.params;if(!i)throw new Error(this._name+" - load model before inference");return Rt(function(){var o=t instanceof Wm?n.faceFeatureExtractor.forwardInput(t):t,a=Ed(o,[7,7],[2,2],"valid").as2D(o.shape[0],-1),s=la(a,i.fc.age).as1D(),u=la(a,i.fc.gender);return{age:s,gender:u}})},e.prototype.forwardInput=function(t){var n=this;return Rt(function(){var i=n.runNet(t),o=i.age,a=i.gender;return{age:o,gender:su(a)}})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.predictAgeAndGender=function(t){return It(this,void 0,void 0,function(){var n,i,o,a,s,u,l=this;return Dt(this,function(c){switch(c.label){case 0:return[4,_r(t)];case 1:return n=c.sent(),[4,this.forwardInput(n)];case 2:return i=c.sent(),o=Tr(i.age),a=Tr(i.gender),s=o.map(function(h,f){return{ageTensor:h,genderTensor:a[f]}}),[4,Promise.all(s.map(function(h){var f=h.ageTensor,m=h.genderTensor;return It(l,void 0,void 0,function(){var g,w,v,y,x;return Dt(this,function(E){switch(E.label){case 0:return[4,f.data()];case 1:return g=E.sent()[0],[4,m.data()];case 2:return w=E.sent()[0],v=w>.5,y=v?Gm.MALE:Gm.FEMALE,x=v?w:1-w,f.dispose(),m.dispose(),[2,{age:g,gender:y,genderProbability:x}]}})})}))];case 3:return u=c.sent(),i.age.dispose(),i.gender.dispose(),[2,n.isBatchInput?u:u[0]]}})})},e.prototype.getDefaultModelName=function(){return"age_gender_model"},e.prototype.dispose=function(t){t===void 0&&(t=!0),this.faceFeatureExtractor.dispose(t),r.prototype.dispose.call(this,t)},e.prototype.loadClassifierParams=function(t){var n=this.extractClassifierParams(t),i=n.params,o=n.paramMappings;this._params=i,this._paramMappings=o},e.prototype.extractClassifierParams=function(t){return fW(t)},e.prototype.extractParamsFromWeigthMap=function(t){var n=hA(t),i=n.featureExtractorMap,o=n.classifierMap;return this.faceFeatureExtractor.loadFromWeightMap(i),pW(o)},e.prototype.extractParams=function(t){var n=1539,i=t.slice(0,t.length-n),o=t.slice(t.length-n);return this.faceFeatureExtractor.extractWeights(i),this.extractClassifierParams(o)},e})(as),gW=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getRefPointsForAlignment=function(){var t=this.positions;return[t[0],t[1],l1([t[3],t[4]])]},e})(od),WE=(function(){function r(e,t){this._label=e,this._distance=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distance",{get:function(){return this._distance},enumerable:!0,configurable:!0}),r.prototype.toString=function(e){return e===void 0&&(e=!0),""+this.label+(e?" ("+u1(this.distance)+")":"")},r})(),u0=(function(){function r(e,t){if(typeof e!="string")throw new Error("LabeledFaceDescriptors - constructor expected label to be a string");if(!Array.isArray(t)||t.some(function(n){return!(n instanceof Float32Array)}))throw new Error("LabeledFaceDescriptors - constructor expected descriptors to be an array of Float32Array");this._label=e,this._descriptors=t}return Object.defineProperty(r.prototype,"label",{get:function(){return this._label},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"descriptors",{get:function(){return this._descriptors},enumerable:!0,configurable:!0}),r})();function E1(r,e){return It(this,void 0,void 0,function(){var t,n,i,o,a,s,u;return Dt(this,function(l){switch(l.label){case 0:return t=qr.getEnv().Canvas,n=r,r instanceof t?[3,5]:[4,_r(r)];case 1:if(i=l.sent(),i.batchSize>1)throw new Error("extractFaces - batchSize > 1 not supported");return o=i.getInput(0),o instanceof t?(a=o,[3,4]):[3,2];case 2:return[4,Lz(o)];case 3:a=l.sent(),l.label=4;case 4:n=a,l.label=5;case 5:return s=ma(n),u=e.map(function(c){return c instanceof co?c.forSize(n.width,n.height).box.floor():c}).map(function(c){return c.clipAtImageBorders(n.width,n.height)}),[2,u.map(function(c){var h=c.x,f=c.y,m=c.width,g=c.height,w=yg({width:m,height:g});return ma(w).putImageData(s.getImageData(h,f,m,g),0,0),w})]}})})}function k1(r,e){return It(this,void 0,void 0,function(){return Dt(this,function(t){if(!mg(r)&&!Ys(r))throw new Error("extractFaceTensors - expected image tensor to be 3D or 4D");if(Ys(r)&&r.shape[0]>1)throw new Error("extractFaceTensors - batchSize > 1 not supported");return[2,Rt(function(){var n=r.shape.slice(Ys(r)?1:0),i=n[0],o=n[1],a=n[2],s=e.map(function(l){return l instanceof co?l.forSize(o,i).box:l}).map(function(l){return l.clipAtImageBorders(o,i)}),u=s.map(function(l){var c=l.x,h=l.y,f=l.width,m=l.height;return CT(r.as3D(i,o,a),[h,c,0],[m,f,a])});return u})]})})}var bA=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.postProcess=function(t,n,i){var o=i.map(function(s){var u=s.width,l=s.height,c=n/Math.max(l,u);return{width:u*c,height:l*c}}),a=o.length;return Rt(function(){var s=function(f,m){return Oo([yc([68],f),yc([68],m)],1).as2D(1,136).as1D()},u=function(f,m){var g=o[f],w=g.width,v=g.height;return m(w,v)?Math.abs(w-v)/2:0},l=function(f){return u(f,function(m,g){return m<g})},c=function(f){return u(f,function(m,g){return g<m})},h=t.mul(yc([a,136],n)).sub(Oo(Array.from(Array(a),function(f,m){return s(l(m),c(m))}))).div(Oo(Array.from(Array(a),function(f,m){return s(o[m].width,o[m].height)})));return h})},e.prototype.forwardInput=function(t){var n=this;return Rt(function(){var i=n.runNet(t);return n.postProcess(i,t.inputSize,t.inputDimensions.map(function(o){var a=o[0],s=o[1];return{height:a,width:s}}))})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.detectLandmarks=function(t){return It(this,void 0,void 0,function(){var n,i,o,a=this;return Dt(this,function(s){switch(s.label){case 0:return[4,_r(t)];case 1:return n=s.sent(),i=Rt(function(){return Tr(a.forwardInput(n))}),[4,Promise.all(i.map(function(u,l){return It(a,void 0,void 0,function(){var c,h,f,m,g;return Dt(this,function(w){switch(w.label){case 0:return f=(h=Array).from,[4,u.data()];case 1:return c=f.apply(h,[w.sent()]),m=c.filter(function(v,y){return PE(y)}),g=c.filter(function(v,y){return!PE(y)}),[2,new pA(Array(68).fill(0).map(function(v,y){return new yn(m[y],g[y])}),{height:n.getInputHeight(l),width:n.getInputWidth(l)})]}})})}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,n.isBatchInput?o:o[0]]}})})},e.prototype.getClassifierChannelsOut=function(){return 136},e})(dA),wA=(function(r){Yt(e,r);function e(t){return t===void 0&&(t=new cA),r.call(this,"FaceLandmark68Net",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_model"},e.prototype.getClassifierChannelsIn=function(){return 256},e})(bA);function vW(r){var e=[],t=lA(r,e).extractDenseBlock3Params,n={dense0:t("dense0",!0),dense1:t("dense1"),dense2:t("dense2")};return is(r,e),{params:n,paramMappings:e}}function yW(r){var e=[],t=os(r),n=t.extractWeights,i=t.getRemainingWeights,o=sA(n,e).extractDenseBlock3Params,a=o(3,32,"dense0",!0),s=o(32,64,"dense1"),u=o(64,128,"dense2");if(i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{paramMappings:e,params:{dense0:a,dense1:s,dense2:u}}}var bW=(function(r){Yt(e,r);function e(){return r.call(this,"TinyFaceFeatureExtractor")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("TinyFaceFeatureExtractor - load model before inference");return Rt(function(){var i=t.toBatchTensor(112,!0),o=[122.782,117.001,104.298],a=Dd(i,o).div(dt(255)),s=a0(a,n.dense0,!0);return s=a0(s,n.dense1),s=a0(s,n.dense2),s=Ed(s,[14,14],[2,2],"valid"),s})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.getDefaultModelName=function(){return"face_feature_extractor_tiny_model"},e.prototype.extractParamsFromWeigthMap=function(t){return vW(t)},e.prototype.extractParams=function(t){return yW(t)},e})(as),wW=(function(r){Yt(e,r);function e(t){return t===void 0&&(t=new bW),r.call(this,"FaceLandmark68TinyNet",t)||this}return e.prototype.getDefaultModelName=function(){return"face_landmark_68_tiny_model"},e.prototype.getClassifierChannelsIn=function(){return 128},e})(bA);(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(wA);function _W(r,e){return wn(Ha(r,e.weights),e.biases)}function C1(r,e,t,n,i){i===void 0&&(i="same");var o=e.conv,a=o.filters,s=o.bias,u=Qa(r,a,t,i);return u=wn(u,s),u=_W(u,e.scale),n?er(u):u}function xW(r,e){return C1(r,e,[1,1],!0)}function _A(r,e){return C1(r,e,[1,1],!1)}function xA(r,e){return C1(r,e,[2,2],!0,"valid")}function SW(r,e){function t(s,u,l){var c=r(s),h=c.length/(u*l*l);if(Az(h))throw new Error("depth has to be an integer: "+h+", weights.length: "+c.length+", numFilters: "+u+", filterSize: "+l);return Rt(function(){return Zs(To(c,[u,h,l,l]),[2,3,1,0])})}function n(s,u,l,c){var h=t(s,u,l),f=fi(r(u));return e.push({paramPath:c+"/filters"},{paramPath:c+"/bias"}),{filters:h,bias:f}}function i(s,u){var l=fi(r(s)),c=fi(r(s));return e.push({paramPath:u+"/weights"},{paramPath:u+"/biases"}),{weights:l,biases:c}}function o(s,u,l,c){var h=n(s,u,l,c+"/conv"),f=i(u,c+"/scale");return{conv:h,scale:f}}function a(s,u,l,c,h){h===void 0&&(h=!1);var f=o((h?.5:1)*s,u,l,c+"/conv1"),m=o(s,u,l,c+"/conv2");return{conv1:f,conv2:m}}return{extractConvLayerParams:o,extractResidualLayerParams:a}}function EW(r){var e=os(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],o=SW(t,i),a=o.extractConvLayerParams,s=o.extractResidualLayerParams,u=a(4704,32,7,"conv32_down"),l=s(9216,32,3,"conv32_1"),c=s(9216,32,3,"conv32_2"),h=s(9216,32,3,"conv32_3"),f=s(36864,64,3,"conv64_down",!0),m=s(36864,64,3,"conv64_1"),g=s(36864,64,3,"conv64_2"),w=s(36864,64,3,"conv64_3"),v=s(147456,128,3,"conv128_down",!0),y=s(147456,128,3,"conv128_1"),x=s(147456,128,3,"conv128_2"),E=s(589824,256,3,"conv256_down",!0),_=s(589824,256,3,"conv256_1"),k=s(589824,256,3,"conv256_2"),C=s(589824,256,3,"conv256_down_out"),R=Rt(function(){return Zs(gd(t(256*128),[128,256]),[1,0])});if(i.push({paramPath:"fc"}),n().length!==0)throw new Error("weights remaing after extract: "+n().length);var I={conv32_down:u,conv32_1:l,conv32_2:c,conv32_3:h,conv64_down:f,conv64_1:m,conv64_2:g,conv64_3:w,conv128_down:v,conv128_1:y,conv128_2:x,conv256_down:E,conv256_1:_,conv256_2:k,conv256_down_out:C,fc:R};return{params:I,paramMappings:i}}function kW(r,e){var t=cu(r,e);function n(a){var s=t(a+"/scale/weights",1),u=t(a+"/scale/biases",1);return{weights:s,biases:u}}function i(a){var s=t(a+"/conv/filters",4),u=t(a+"/conv/bias",1),l=n(a);return{conv:{filters:s,bias:u},scale:l}}function o(a){return{conv1:i(a+"/conv1"),conv2:i(a+"/conv2")}}return{extractConvLayerParams:i,extractResidualLayerParams:o}}function CW(r){var e=[],t=kW(r,e),n=t.extractConvLayerParams,i=t.extractResidualLayerParams,o=n("conv32_down"),a=i("conv32_1"),s=i("conv32_2"),u=i("conv32_3"),l=i("conv64_down"),c=i("conv64_1"),h=i("conv64_2"),f=i("conv64_3"),m=i("conv128_down"),g=i("conv128_1"),w=i("conv128_2"),v=i("conv256_down"),y=i("conv256_1"),x=i("conv256_2"),E=i("conv256_down_out"),_=r.fc;if(e.push({originalPath:"fc",paramPath:"fc"}),!Mz(_))throw new Error("expected weightMap[fc] to be a Tensor2D, instead have "+_);var k={conv32_down:o,conv32_1:a,conv32_2:s,conv32_3:u,conv64_down:l,conv64_1:c,conv64_2:h,conv64_3:f,conv128_down:m,conv128_1:g,conv128_2:w,conv256_down:v,conv256_1:y,conv256_2:x,conv256_down_out:E,fc:_};return is(r,e),{params:k,paramMappings:e}}function Jo(r,e){var t=xW(r,e.conv1);return t=_A(t,e.conv2),t=wn(t,r),t=er(t),t}function wp(r,e){var t=xA(r,e.conv1);t=_A(t,e.conv2);var n=Ed(r,2,2,"valid"),i=Wn(n.shape),o=n.shape[3]!==t.shape[3],a=n.shape[1]!==t.shape[1]||n.shape[2]!==t.shape[2];if(a){var s=t.shape.slice();s[1]=1;var u=Wn(s);t=Vr([t,u],1);var l=t.shape.slice();l[2]=1;var c=Wn(l);t=Vr([t,c],2)}return n=o?Vr([n,i],3):n,t=wn(n,t),t=er(t),t}var TW=(function(r){Yt(e,r);function e(){return r.call(this,"FaceRecognitionNet")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("FaceRecognitionNet - load model before inference");return Rt(function(){var i=t.toBatchTensor(150,!0).toFloat(),o=[122.782,117.001,104.298],a=Dd(i,o).div(dt(256)),s=xA(a,n.conv32_down);s=Fc(s,3,2,"valid"),s=Jo(s,n.conv32_1),s=Jo(s,n.conv32_2),s=Jo(s,n.conv32_3),s=wp(s,n.conv64_down),s=Jo(s,n.conv64_1),s=Jo(s,n.conv64_2),s=Jo(s,n.conv64_3),s=wp(s,n.conv128_down),s=Jo(s,n.conv128_1),s=Jo(s,n.conv128_2),s=wp(s,n.conv256_down),s=Jo(s,n.conv256_1),s=Jo(s,n.conv256_2),s=wp(s,n.conv256_down_out);var u=s.mean([1,2]),l=Iw(u,n.fc);return l})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.computeFaceDescriptor=function(t){return It(this,void 0,void 0,function(){var n,i,o,a=this;return Dt(this,function(s){switch(s.label){case 0:return[4,_r(t)];case 1:return n=s.sent(),i=Rt(function(){return Tr(a.forwardInput(n))}),[4,Promise.all(i.map(function(u){return u.data()}))];case 2:return o=s.sent(),i.forEach(function(u){return u.dispose()}),[2,n.isBatchInput?o:o[0]]}})})},e.prototype.getDefaultModelName=function(){return"face_recognition_model"},e.prototype.extractParamsFromWeigthMap=function(t){return CW(t)},e.prototype.extractParams=function(t){return EW(t)},e})(as);function SA(r,e){var t={descriptor:e};return Object.assign({},r,t)}var EA=(function(){function r(e){var t=e===void 0?{}:e,n=t.minFaceSize,i=t.scaleFactor,o=t.maxNumScales,a=t.scoreThresholds,s=t.scaleSteps;if(this._name="MtcnnOptions",this._minFaceSize=n||20,this._scaleFactor=i||.709,this._maxNumScales=o||10,this._scoreThresholds=a||[.6,.7,.7],this._scaleSteps=s,typeof this._minFaceSize!="number"||this._minFaceSize<0)throw new Error(this._name+" - expected minFaceSize to be a number > 0");if(typeof this._scaleFactor!="number"||this._scaleFactor<=0||this._scaleFactor>=1)throw new Error(this._name+" - expected scaleFactor to be a number between 0 and 1");if(typeof this._maxNumScales!="number"||this._maxNumScales<0)throw new Error(this._name+" - expected maxNumScales to be a number > 0");if(!Array.isArray(this._scoreThresholds)||this._scoreThresholds.length!==3||this._scoreThresholds.some(function(u){return typeof u!="number"}))throw new Error(this._name+" - expected scoreThresholds to be an array of numbers of length 3");if(this._scaleSteps&&(!Array.isArray(this._scaleSteps)||this._scaleSteps.some(function(u){return typeof u!="number"})))throw new Error(this._name+" - expected scaleSteps to be an array of numbers")}return Object.defineProperty(r.prototype,"minFaceSize",{get:function(){return this._minFaceSize},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleFactor",{get:function(){return this._scaleFactor},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxNumScales",{get:function(){return this._maxNumScales},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scoreThresholds",{get:function(){return this._scoreThresholds},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"scaleSteps",{get:function(){return this._scaleSteps},enumerable:!0,configurable:!0}),r})();function MW(r,e){function t(u,l){var c=To(r(9*u),[3,3,u,1]),h=fi(r(u)),f=fi(r(u)),m=fi(r(u)),g=fi(r(u));return e.push({paramPath:l+"/filters"},{paramPath:l+"/batch_norm_scale"},{paramPath:l+"/batch_norm_offset"},{paramPath:l+"/batch_norm_mean"},{paramPath:l+"/batch_norm_variance"}),{filters:c,batch_norm_scale:h,batch_norm_offset:f,batch_norm_mean:m,batch_norm_variance:g}}function n(u,l,c,h,f){var m=To(r(u*l*c*c),[c,c,u,l]),g=fi(r(l));return e.push({paramPath:h+"/filters"},{paramPath:h+"/"+(f?"batch_norm_offset":"bias")}),{filters:m,bias:g}}function i(u,l,c,h){var f=n(u,l,c,h,!0),m=f.filters,g=f.bias;return{filters:m,batch_norm_offset:g}}function o(u,l,c){var h=t(u,c+"/depthwise_conv"),f=i(u,l,1,c+"/pointwise_conv");return{depthwise_conv:h,pointwise_conv:f}}function a(){var u=i(3,32,3,"mobilenetv1/conv_0"),l=o(32,64,"mobilenetv1/conv_1"),c=o(64,128,"mobilenetv1/conv_2"),h=o(128,128,"mobilenetv1/conv_3"),f=o(128,256,"mobilenetv1/conv_4"),m=o(256,256,"mobilenetv1/conv_5"),g=o(256,512,"mobilenetv1/conv_6"),w=o(512,512,"mobilenetv1/conv_7"),v=o(512,512,"mobilenetv1/conv_8"),y=o(512,512,"mobilenetv1/conv_9"),x=o(512,512,"mobilenetv1/conv_10"),E=o(512,512,"mobilenetv1/conv_11"),_=o(512,1024,"mobilenetv1/conv_12"),k=o(1024,1024,"mobilenetv1/conv_13");return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:m,conv_6:g,conv_7:w,conv_8:v,conv_9:y,conv_10:x,conv_11:E,conv_12:_,conv_13:k}}function s(){var u=i(1024,256,1,"prediction_layer/conv_0"),l=i(256,512,3,"prediction_layer/conv_1"),c=i(512,128,1,"prediction_layer/conv_2"),h=i(128,256,3,"prediction_layer/conv_3"),f=i(256,128,1,"prediction_layer/conv_4"),m=i(128,256,3,"prediction_layer/conv_5"),g=i(256,64,1,"prediction_layer/conv_6"),w=i(64,128,3,"prediction_layer/conv_7"),v=n(512,12,1,"prediction_layer/box_predictor_0/box_encoding_predictor"),y=n(512,9,1,"prediction_layer/box_predictor_0/class_predictor"),x=n(1024,24,1,"prediction_layer/box_predictor_1/box_encoding_predictor"),E=n(1024,18,1,"prediction_layer/box_predictor_1/class_predictor"),_=n(512,24,1,"prediction_layer/box_predictor_2/box_encoding_predictor"),k=n(512,18,1,"prediction_layer/box_predictor_2/class_predictor"),C=n(256,24,1,"prediction_layer/box_predictor_3/box_encoding_predictor"),R=n(256,18,1,"prediction_layer/box_predictor_3/class_predictor"),I=n(256,24,1,"prediction_layer/box_predictor_4/box_encoding_predictor"),T=n(256,18,1,"prediction_layer/box_predictor_4/class_predictor"),A=n(128,24,1,"prediction_layer/box_predictor_5/box_encoding_predictor"),N=n(128,18,1,"prediction_layer/box_predictor_5/class_predictor"),O={box_encoding_predictor:v,class_predictor:y},V={box_encoding_predictor:x,class_predictor:E},F={box_encoding_predictor:_,class_predictor:k},B={box_encoding_predictor:C,class_predictor:R},U={box_encoding_predictor:I,class_predictor:T},P={box_encoding_predictor:A,class_predictor:N};return{conv_0:u,conv_1:l,conv_2:c,conv_3:h,conv_4:f,conv_5:m,conv_6:g,conv_7:w,box_predictor_0:O,box_predictor_1:V,box_predictor_2:F,box_predictor_3:B,box_predictor_4:U,box_predictor_5:P}}return{extractMobilenetV1Params:a,extractPredictionLayerParams:s}}function AW(r){var e=[],t=os(r),n=t.extractWeights,i=t.getRemainingWeights,o=MW(n,e),a=o.extractMobilenetV1Params,s=o.extractPredictionLayerParams,u=a(),l=s(),c=ww(n(5118*4),[1,5118,4]),h={extra_dim:c};if(e.push({paramPath:"output_layer/extra_dim"}),i().length!==0)throw new Error("weights remaing after extract: "+i().length);return{params:{mobilenetv1:u,prediction_layer:l,output_layer:h},paramMappings:e}}function RW(r,e){var t=cu(r,e);function n(l,c,h){var f=t(l+"/Conv2d_"+c+"_pointwise/weights",4,h+"/filters"),m=t(l+"/Conv2d_"+c+"_pointwise/convolution_bn_offset",1,h+"/batch_norm_offset");return{filters:f,batch_norm_offset:m}}function i(l){var c="mobilenetv1/conv_"+l,h="MobilenetV1/Conv2d_"+l+"_depthwise",f=c+"/depthwise_conv",m=c+"/pointwise_conv",g=t(h+"/depthwise_weights",4,f+"/filters"),w=t(h+"/BatchNorm/gamma",1,f+"/batch_norm_scale"),v=t(h+"/BatchNorm/beta",1,f+"/batch_norm_offset"),y=t(h+"/BatchNorm/moving_mean",1,f+"/batch_norm_mean"),x=t(h+"/BatchNorm/moving_variance",1,f+"/batch_norm_variance");return{depthwise_conv:{filters:g,batch_norm_scale:w,batch_norm_offset:v,batch_norm_mean:y,batch_norm_variance:x},pointwise_conv:n("MobilenetV1",l,m)}}function o(){return{conv_0:n("MobilenetV1",0,"mobilenetv1/conv_0"),conv_1:i(1),conv_2:i(2),conv_3:i(3),conv_4:i(4),conv_5:i(5),conv_6:i(6),conv_7:i(7),conv_8:i(8),conv_9:i(9),conv_10:i(10),conv_11:i(11),conv_12:i(12),conv_13:i(13)}}function a(l,c){var h=t(l+"/weights",4,c+"/filters"),f=t(l+"/biases",1,c+"/bias");return{filters:h,bias:f}}function s(l){var c=a("Prediction/BoxPredictor_"+l+"/BoxEncodingPredictor","prediction_layer/box_predictor_"+l+"/box_encoding_predictor"),h=a("Prediction/BoxPredictor_"+l+"/ClassPredictor","prediction_layer/box_predictor_"+l+"/class_predictor");return{box_encoding_predictor:c,class_predictor:h}}function u(){return{conv_0:n("Prediction",0,"prediction_layer/conv_0"),conv_1:n("Prediction",1,"prediction_layer/conv_1"),conv_2:n("Prediction",2,"prediction_layer/conv_2"),conv_3:n("Prediction",3,"prediction_layer/conv_3"),conv_4:n("Prediction",4,"prediction_layer/conv_4"),conv_5:n("Prediction",5,"prediction_layer/conv_5"),conv_6:n("Prediction",6,"prediction_layer/conv_6"),conv_7:n("Prediction",7,"prediction_layer/conv_7"),box_predictor_0:s(0),box_predictor_1:s(1),box_predictor_2:s(2),box_predictor_3:s(3),box_predictor_4:s(4),box_predictor_5:s(5)}}return{extractMobilenetV1Params:o,extractPredictionLayerParams:u}}function IW(r){var e=[],t=RW(r,e),n=t.extractMobilenetV1Params,i=t.extractPredictionLayerParams,o=r["Output/extra_dim"];if(e.push({originalPath:"Output/extra_dim",paramPath:"output_layer/extra_dim"}),!mg(o))throw new Error("expected weightMap['Output/extra_dim'] to be a Tensor3D, instead have "+o);var a={mobilenetv1:n(),prediction_layer:i(),output_layer:{extra_dim:o}};return is(r,e),{params:a,paramMappings:e}}function ea(r,e,t){return Rt(function(){var n=Qa(r,e.filters,t,"same");return n=wn(n,e.batch_norm_offset),Aw(n,0,6)})}var DW=.0010000000474974513;function NW(r,e,t){return Rt(function(){var n=Rw(r,e.filters,t,"same");return n=bT(n,e.batch_norm_mean,e.batch_norm_variance,e.batch_norm_offset,e.batch_norm_scale,DW),Aw(n,0,6)})}function PW(r){return[2,4,6,12].some(function(e){return e===r})?[2,2]:[1,1]}function FW(r,e){return Rt(function(){var t=null,n=ea(r,e.conv_0,[2,2]),i=[e.conv_1,e.conv_2,e.conv_3,e.conv_4,e.conv_5,e.conv_6,e.conv_7,e.conv_8,e.conv_9,e.conv_10,e.conv_11,e.conv_12,e.conv_13];if(i.forEach(function(o,a){var s=a+1,u=PW(s);n=NW(n,o.depthwise_conv,u),n=ea(n,o.pointwise_conv,[1,1]),s===11&&(t=n)}),t===null)throw new Error("mobileNetV1 - output of conv layer 11 is null");return{out:n,conv11:t}})}function OW(r,e,t,n,i){var o=r.shape[0],a=Math.min(t,o),s=e.map(function(c,h){return{score:c,boxIndex:h}}).filter(function(c){return c.score>i}).sort(function(c,h){return h.score-c.score}),u=function(c){return c<=n?1:0},l=[];return s.forEach(function(c){if(!(l.length>=a)){for(var h=c.score,f=l.length-1;f>=0;--f){var m=LW(r,c.boxIndex,l[f]);if(m!==0&&(c.score*=u(m),c.score<=i))break}h===c.score&&l.push(c.boxIndex)}}),l}function LW(r,e,t){var n=r.arraySync(),i=Math.min(n[e][0],n[e][2]),o=Math.min(n[e][1],n[e][3]),a=Math.max(n[e][0],n[e][2]),s=Math.max(n[e][1],n[e][3]),u=Math.min(n[t][0],n[t][2]),l=Math.min(n[t][1],n[t][3]),c=Math.max(n[t][0],n[t][2]),h=Math.max(n[t][1],n[t][3]),f=(a-i)*(s-o),m=(c-u)*(h-l);if(f<=0||m<=0)return 0;var g=Math.max(i,u),w=Math.max(o,l),v=Math.min(a,c),y=Math.min(s,h),x=Math.max(v-g,0)*Math.max(y-w,0);return x/(f+m-x)}function BW(r){var e=Tr(Zs(r,[1,0])),t=[xi(e[2],e[0]),xi(e[3],e[1])],n=[wn(e[0],ta(t[0],dt(2))),wn(e[1],ta(t[1],dt(2)))];return{sizes:t,centers:n}}function UW(r,e){var t=BW(r),n=t.sizes,i=t.centers,o=Tr(Zs(e,[1,0])),a=ta(Ha(tb(ta(o[2],dt(5))),n[0]),dt(2)),s=wn(Ha(ta(o[0],dt(10)),n[0]),i[0]),u=ta(Ha(tb(ta(o[3],dt(5))),n[1]),dt(2)),l=wn(Ha(ta(o[1],dt(10)),n[1]),i[1]);return Zs(Oo([xi(s,a),xi(l,u),wn(s,a),wn(l,u)]),[1,0])}function zW(r,e,t){return Rt(function(){var n=r.shape[0],i=UW(Do(bc(t.extra_dim,[n,1,1]),[-1,4]),Do(r,[-1,4]));i=Do(i,[n,i.shape[0]/n,4]);var o=mT(fa(e,[0,0,1],[-1,-1,-1])),a=fa(o,[0,0,0],[-1,-1,1]);a=Do(a,[n,a.shape[1]]);var s=Tr(i),u=Tr(a);return{boxes:s,scores:u}})}function Vl(r,e){return Rt(function(){var t=r.shape[0],n=Do(Bo(r,e.box_encoding_predictor),[t,-1,1,4]),i=Do(Bo(r,e.class_predictor),[t,-1,3]);return{boxPredictionEncoding:n,classPrediction:i}})}function WW(r,e,t){return Rt(function(){var n=ea(r,t.conv_0,[1,1]),i=ea(n,t.conv_1,[2,2]),o=ea(i,t.conv_2,[1,1]),a=ea(o,t.conv_3,[2,2]),s=ea(a,t.conv_4,[1,1]),u=ea(s,t.conv_5,[2,2]),l=ea(u,t.conv_6,[1,1]),c=ea(l,t.conv_7,[2,2]),h=Vl(e,t.box_predictor_0),f=Vl(r,t.box_predictor_1),m=Vl(i,t.box_predictor_2),g=Vl(a,t.box_predictor_3),w=Vl(u,t.box_predictor_4),v=Vl(c,t.box_predictor_5),y=Vr([h.boxPredictionEncoding,f.boxPredictionEncoding,m.boxPredictionEncoding,g.boxPredictionEncoding,w.boxPredictionEncoding,v.boxPredictionEncoding],1),x=Vr([h.classPrediction,f.classPrediction,m.classPrediction,g.classPrediction,w.classPrediction,v.classPrediction],1);return{boxPredictions:y,classPredictions:x}})}var bg=(function(){function r(e){var t=e===void 0?{}:e,n=t.minConfidence,i=t.maxResults;if(this._name="SsdMobilenetv1Options",this._minConfidence=n||.5,this._maxResults=i||100,typeof this._minConfidence!="number"||this._minConfidence<=0||this._minConfidence>=1)throw new Error(this._name+" - expected minConfidence to be a number between 0 and 1");if(typeof this._maxResults!="number")throw new Error(this._name+" - expected maxResults to be a number")}return Object.defineProperty(r.prototype,"minConfidence",{get:function(){return this._minConfidence},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"maxResults",{get:function(){return this._maxResults},enumerable:!0,configurable:!0}),r})(),kA=(function(r){Yt(e,r);function e(){return r.call(this,"SsdMobilenetv1")||this}return e.prototype.forwardInput=function(t){var n=this.params;if(!n)throw new Error("SsdMobilenetv1 - load model before inference");return Rt(function(){var i=t.toBatchTensor(512,!1).toFloat(),o=xi(Ha(i,dt(.007843137718737125)),dt(1)),a=FW(o,n.mobilenetv1),s=WW(a.out,a.conv11,n.prediction_layer),u=s.boxPredictions,l=s.classPredictions;return zW(u,l,n.output_layer)})},e.prototype.forward=function(t){return It(this,void 0,void 0,function(){var n;return Dt(this,function(i){switch(i.label){case 0:return n=this.forwardInput,[4,_r(t)];case 1:return[2,n.apply(this,[i.sent()])]}})})},e.prototype.locateFaces=function(t,n){return n===void 0&&(n={}),It(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,R,I;return Dt(this,function(T){switch(T.label){case 0:return i=new bg(n),o=i.maxResults,a=i.minConfidence,[4,_r(t)];case 1:for(s=T.sent(),u=this.forwardInput(s),l=u.boxes,c=u.scores,h=l[0],f=c[0],m=1;m<l.length;m++)l[m].dispose(),c[m].dispose();return v=(w=Array).from,[4,f.data()];case 2:return g=v.apply(w,[T.sent()]),y=.5,x=OW(h,g,o,y,a),E=s.getReshapedInputDimensions(0),_=s.inputSize,k=_/E.width,C=_/E.height,R=h.arraySync(),I=x.map(function(A){var N=[Math.max(0,R[A][0]),Math.min(1,R[A][2])].map(function(P){return P*C}),O=N[0],V=N[1],F=[Math.max(0,R[A][1]),Math.min(1,R[A][3])].map(function(P){return P*k}),B=F[0],U=F[1];return new co(g[A],new c1(B,O,U-B,V-O),{height:s.getInputHeight(0),width:s.getInputWidth(0)})}),h.dispose(),f.dispose(),[2,I]}})})},e.prototype.getDefaultModelName=function(){return"ssd_mobilenetv1_model"},e.prototype.extractParamsFromWeigthMap=function(t){return IW(t)},e.prototype.extractParams=function(t){return AW(t)},e})(as);(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(kA);var CA=(function(r){Yt(e,r);function e(){var t=r!==null&&r.apply(this,arguments)||this;return t._name="TinyFaceDetectorOptions",t}return e})(w1),Nd=(function(){function r(){}return r.prototype.then=function(e){return It(this,void 0,void 0,function(){var t;return Dt(this,function(n){switch(n.label){case 0:return t=e,[4,this.run()];case 1:return[2,t.apply(void 0,[n.sent()])]}})})},r.prototype.run=function(){return It(this,void 0,void 0,function(){return Dt(this,function(e){throw new Error("ComposableTask - run is not implemented")})})},r})();function wg(r,e,t,n,i){return i===void 0&&(i=function(o){var a=o.alignedRect;return a}),It(this,void 0,void 0,function(){var o,a,s,u,l;return Dt(this,function(c){switch(c.label){case 0:return o=r.map(function(h){return mA(h)?i(h):h.detection}),s=n,s?[3,5]:e instanceof at?[4,k1(e,o)]:[3,2];case 1:return u=c.sent(),[3,4];case 2:return[4,E1(e,o)];case 3:u=c.sent(),c.label=4;case 4:s=u,c.label=5;case 5:return a=s,[4,t(a)];case 6:return l=c.sent(),a.forEach(function(h){return h instanceof at&&h.dispose()}),[2,l]}})})}function T1(r,e,t,n,i){return It(this,void 0,void 0,function(){var o=this;return Dt(this,function(a){return[2,wg([r],e,function(s){return It(o,void 0,void 0,function(){return Dt(this,function(u){return[2,t(s[0])]})})},n,i)]})})}function HW(r){return Rt(function(){return Oo(Tr(r,3).reverse(),3)})}var _p=2,Vm=12;function GW(r,e){var t=vg(r,e),n=m1(r,e);function i(l,c){var h=fi(r(l));return e.push({paramPath:c}),h}function o(l,c,h){h===void 0&&(h=!1);var f=t(l[0],l[1],3,c+"/conv1"),m=i(l[1],c+"/prelu1_alpha"),g=t(l[1],l[2],3,c+"/conv2"),w=i(l[2],c+"/prelu2_alpha"),v=t(l[2],l[3],h?2:3,c+"/conv3"),y=i(l[3],c+"/prelu3_alpha");return{conv1:f,prelu1_alpha:m,conv2:g,prelu2_alpha:w,conv3:v,prelu3_alpha:y}}function a(){var l=o([3,10,16,32],"pnet"),c=t(32,2,1,"pnet/conv4_1"),h=t(32,4,1,"pnet/conv4_2");return Fo({},l,{conv4_1:c,conv4_2:h})}function s(){var l=o([3,28,48,64],"rnet",!0),c=n(576,128,"rnet/fc1"),h=i(128,"rnet/prelu4_alpha"),f=n(128,2,"rnet/fc2_1"),m=n(128,4,"rnet/fc2_2");return Fo({},l,{fc1:c,prelu4_alpha:h,fc2_1:f,fc2_2:m})}function u(){var l=o([3,32,64,64],"onet"),c=t(64,128,2,"onet/conv4"),h=i(128,"onet/prelu4_alpha"),f=n(1152,256,"onet/fc1"),m=i(256,"onet/prelu5_alpha"),g=n(256,2,"onet/fc2_1"),w=n(256,4,"onet/fc2_2"),v=n(256,10,"onet/fc2_3");return Fo({},l,{conv4:c,prelu4_alpha:h,fc1:f,prelu5_alpha:m,fc2_1:g,fc2_2:w,fc2_3:v})}return{extractPNetParams:a,extractRNetParams:s,extractONetParams:u}}function VW(r){var e=os(r),t=e.extractWeights,n=e.getRemainingWeights,i=[],o=GW(t,i),a=o.extractPNetParams,s=o.extractRNetParams,u=o.extractONetParams,l=a(),c=s(),h=u();if(n().length!==0)throw new Error("weights remaing after extract: "+n().length);return{params:{pnet:l,rnet:c,onet:h},paramMappings:i}}function jW(r,e){var t=cu(r,e);function n(c){var h=t(c+"/weights",4,c+"/filters"),f=t(c+"/bias",1);return{filters:h,bias:f}}function i(c){var h=t(c+"/weights",2),f=t(c+"/bias",1);return{weights:h,bias:f}}function o(c){return t(c,1)}function a(c){var h=n(c+"/conv1"),f=o(c+"/prelu1_alpha"),m=n(c+"/conv2"),g=o(c+"/prelu2_alpha"),w=n(c+"/conv3"),v=o(c+"/prelu3_alpha");return{conv1:h,prelu1_alpha:f,conv2:m,prelu2_alpha:g,conv3:w,prelu3_alpha:v}}function s(){var c=a("pnet"),h=n("pnet/conv4_1"),f=n("pnet/conv4_2");return Fo({},c,{conv4_1:h,conv4_2:f})}function u(){var c=a("rnet"),h=i("rnet/fc1"),f=o("rnet/prelu4_alpha"),m=i("rnet/fc2_1"),g=i("rnet/fc2_2");return Fo({},c,{fc1:h,prelu4_alpha:f,fc2_1:m,fc2_2:g})}function l(){var c=a("onet"),h=n("onet/conv4"),f=o("onet/prelu4_alpha"),m=i("onet/fc1"),g=o("onet/prelu5_alpha"),w=i("onet/fc2_1"),v=i("onet/fc2_2"),y=i("onet/fc2_3");return Fo({},c,{conv4:h,prelu4_alpha:f,fc1:m,prelu5_alpha:g,fc2_1:w,fc2_2:v,fc2_3:y})}return{extractPNetParams:s,extractRNetParams:u,extractONetParams:l}}function qW(r){var e=[],t=jW(r,e),n=t.extractPNetParams,i=t.extractRNetParams,o=t.extractONetParams,a=n(),s=i(),u=o();return is(r,e),{params:{pnet:a,rnet:s,onet:u},paramMappings:e}}function kb(r,e){var t=e[0],n=e[1];return{height:Math.floor(t*r),width:Math.floor(n*r)}}function $W(r,e,t){for(var n=t[0],i=t[1],o=Vm/r,a=[],s=Math.min(n,i)*o,u=0;s>=12;)a.push(o*Math.pow(e,u)),s=s*e,u+=1;return a}var M1=(function(r){Yt(e,r);function e(t,n,i,o){return r.call(this,{left:t,top:n,right:i,bottom:o},!0)||this}return e})(pa);function TA(r){return Rt(function(){return Ha(xi(r,dt(127.5)),dt(.0078125))})}function Rc(r,e){return Rt(function(){return wn(er(r),Ha(e,bm(er(bm(r)))))})}function A1(r,e,t){return t===void 0&&(t=!1),Rt(function(){var n=Bo(r,e.conv1,"valid");return n=Rc(n,e.prelu1_alpha),n=Fc(n,t?[2,2]:[3,3],[2,2],"same"),n=Bo(n,e.conv2,"valid"),n=Rc(n,e.prelu2_alpha),n=t?n:Fc(n,[3,3],[2,2],"valid"),n=Bo(n,e.conv3,"valid"),n=Rc(n,e.prelu3_alpha),n})}function XW(r,e){return Rt(function(){var t=A1(r,e,!0),n=Bo(t,e.conv4_1,"valid"),i=eo(tg(n,3),3),o=su(xi(n,i),3),a=Bo(t,e.conv4_2,"valid");return{prob:o,regions:a}})}function YW(r,e){return Rt(function(){var t=kb(e,r.shape.slice(1)),n=t.height,i=t.width,o=VT.resizeBilinear(r,[n,i]),a=TA(o);return Zs(a,[0,2,1,3])})}function KW(r,e,t,n){for(var i=[],o=r.arraySync(),a=0;a<r.shape[0];a++)for(var s=0;s<r.shape[1];s++)o[a][s]>=n&&i.push(new yn(s,a));var u=i.map(function(l){var c=new gg(Math.round((l.y*_p+1)/t),Math.round((l.x*_p+1)/t),Math.round((l.y*_p+Vm)/t),Math.round((l.x*_p+Vm)/t)),h=o[l.y][l.x],f=e.arraySync(),m=new M1(f[l.y][l.x][0],f[l.y][l.x][1],f[l.y][l.x][2],f[l.y][l.x][3]);return{cell:c,score:h,region:m}});return u}function JW(r,e,t,n,i){i.stage1=[];var o=e.map(function(f){return Rt(function(){var m={scale:f},g=YW(r,f),w=Date.now(),v=XW(g,n),y=v.prob,x=v.regions;m.pnet=Date.now()-w;var E=Tr(Tr(y,3)[1])[0],_=Tr(x)[0];return{scoresTensor:E,regionsTensor:_,scale:f,statsForScale:m}})}),a=o.map(function(f){var m=f.scoresTensor,g=f.regionsTensor,w=f.scale,v=f.statsForScale,y=KW(m,g,w,t);if(m.dispose(),g.dispose(),!y.length)return i.stage1.push(v),[];var x=Date.now(),E=id(y.map(function(_){return _.cell}),y.map(function(_){return _.score}),.5);return v.nms=Date.now()-x,v.numBoxes=E.length,i.stage1.push(v),E.map(function(_){return y[_]})}),s=a.reduce(function(f,m){return f.concat(m)},[]),u=[],l=[];if(s.length>0){var c=Date.now(),h=id(s.map(function(f){return f.cell}),s.map(function(f){return f.score}),.7);i.stage1_nms=Date.now()-c,l=h.map(function(f){return s[f].score}),u=h.map(function(f){return s[f]}).map(function(f){var m=f.cell,g=f.region;return new gg(m.left+g.left*m.width,m.top+g.top*m.height,m.right+g.right*m.width,m.bottom+g.bottom*m.height).toSquare().round()})}return{boxes:u,scores:l}}function MA(r,e,t){var n=t.width,i=t.height;return It(this,void 0,void 0,function(){var o,a,s,u=this;return Dt(this,function(l){switch(l.label){case 0:return o=ma(r),[4,Promise.all(e.map(function(c){return It(u,void 0,void 0,function(){var h,f,m,g,w,v,y,x;return Dt(this,function(E){return h=c.padAtBorders(r.height,r.width),f=h.y,m=h.ey,g=h.x,w=h.ex,v=g-1,y=f-1,x=o.getImageData(v,y,w-v,m-y),[2,qr.isNodejs()?y1(x):createImageBitmap(x)]})})}))];case 1:return a=l.sent(),s=[],a.forEach(function(c){var h=yg({width:n,height:i}),f=ma(h);f.drawImage(c,0,0,n,i);for(var m=f.getImageData(0,0,n,i).data,g=[],w=0;w<m.length;w+=4)g.push(m[w+2]),g.push(m[w+1]),g.push(m[w]);s.push(g)}),[2,s.map(function(c){var h=Rt(function(){var f=Zs(To(c,[1,n,i,3]),[0,2,1,3]).toFloat();return TA(f)});return h})]}})})}function ZW(r,e){return Rt(function(){var t=A1(r,e),n=Do(t,[t.shape[0],e.fc1.weights.shape[0]]),i=la(n,e.fc1),o=Rc(i,e.prelu4_alpha),a=la(o,e.fc2_1),s=eo(tg(a,1),1),u=su(xi(a,s),1),l=la(o,e.fc2_2),c=Tr(u,1)[1];return{scores:c,regions:l}})}function QW(r,e,t,n,i){return It(this,void 0,void 0,function(){var o,a,s,u,l,c,h,f,m,g,w,v,y,x;return Dt(this,function(E){switch(E.label){case 0:return o=Date.now(),[4,MA(r,e,{width:24,height:24})];case 1:return a=E.sent(),i.stage2_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(_){var k=ZW(_,n);return _.dispose(),k}),i.stage2_rnet=Date.now()-o,u=s.length>1?Vr(s.map(function(_){return _.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[E.sent()]),u.dispose(),f=l.map(function(_,k){return{score:_,idx:k}}).filter(function(_){return _.score>t}).map(function(_){var k=_.idx;return k}),m=f.map(function(_){return e[_]}),g=f.map(function(_){return l[_]}),w=[],v=[],m.length>0&&(o=Date.now(),y=id(m,g,.7),i.stage2_nms=Date.now()-o,x=y.map(function(_){var k=s[f[_]].regions.arraySync();return new M1(k[0][0],k[0][1],k[0][2],k[0][3])}),v=y.map(function(_){return g[_]}),w=y.map(function(_,k){return m[_].calibrate(x[k])})),s.forEach(function(_){_.regions.dispose(),_.scores.dispose()}),[2,{boxes:w,scores:v}]}})})}function eH(r,e){return Rt(function(){var t=A1(r,e);t=Fc(t,[2,2],[2,2],"same"),t=Bo(t,e.conv4,"valid"),t=Rc(t,e.prelu4_alpha);var n=Do(t,[t.shape[0],e.fc1.weights.shape[0]]),i=la(n,e.fc1),o=Rc(i,e.prelu5_alpha),a=la(o,e.fc2_1),s=eo(tg(a,1),1),u=su(xi(a,s),1),l=la(o,e.fc2_2),c=la(o,e.fc2_3),h=Tr(u,1)[1];return{scores:h,regions:l,points:c}})}function tH(r,e,t,n,i){return It(this,void 0,void 0,function(){var o,a,s,u,l,c,h,f,m,g,w,v,y,x,E;return Dt(this,function(_){switch(_.label){case 0:return o=Date.now(),[4,MA(r,e,{width:48,height:48})];case 1:return a=_.sent(),i.stage3_extractImagePatches=Date.now()-o,o=Date.now(),s=a.map(function(k){var C=eH(k,n);return k.dispose(),C}),i.stage3_onet=Date.now()-o,u=s.length>1?Vr(s.map(function(k){return k.scores})):s[0].scores,h=(c=Array).from,[4,u.data()];case 2:return l=h.apply(c,[_.sent()]),u.dispose(),f=l.map(function(k,C){return{score:k,idx:C}}).filter(function(k){return k.score>t}).map(function(k){var C=k.idx;return C}),m=f.map(function(k){var C=s[k].regions.arraySync();return new M1(C[0][0],C[0][1],C[0][2],C[0][3])}),g=f.map(function(k,C){return e[k].calibrate(m[C])}),w=f.map(function(k){return l[k]}),v=[],y=[],x=[],g.length>0&&(o=Date.now(),E=id(g,w,.7,!1),i.stage3_nms=Date.now()-o,v=E.map(function(k){return g[k]}),y=E.map(function(k){return w[k]}),x=E.map(function(k,C){return Array(5).fill(0).map(function(R,I){var T=s[k].points.arraySync();return new yn(T[0][I]*(v[C].width+1)+v[C].left,T[0][I+5]*(v[C].height+1)+v[C].top)})})),s.forEach(function(k){k.regions.dispose(),k.scores.dispose(),k.points.dispose()}),[2,{boxes:v,scores:y,points:x}]}})})}var nH=(function(r){Yt(e,r);function e(){return r.call(this,"Mtcnn")||this}return e.prototype.forwardInput=function(t,n){return n===void 0&&(n={}),It(this,void 0,void 0,function(){var i,o,a,s,u,l,c,h,f,m,g,w,v,y,x,E,_,k,C,R,I;return Dt(this,function(T){switch(T.label){case 0:if(i=this.params,!i)throw new Error("Mtcnn - load model before inference");if(o=t.canvases[0],!o)throw new Error("Mtcnn - inputCanvas is not defined, note that passing tensors into Mtcnn.forwardInput is not supported yet.");return a={},s=Date.now(),u=Rt(function(){return HW(eo(IL.fromPixels(o)).toFloat())}),l=function(A){return u.dispose(),a.total=Date.now()-s,A},c=u.shape.slice(1),h=c[0],f=c[1],m=new EA(n),g=m.minFaceSize,w=m.scaleFactor,v=m.maxNumScales,y=m.scoreThresholds,x=m.scaleSteps,E=(x||$W(g,w,[h,f])).filter(function(A){var N=kb(A,[h,f]);return Math.min(N.width,N.height)>Vm}).slice(0,v),a.scales=E,a.pyramid=E.map(function(A){return kb(A,[h,f])}),_=Date.now(),[4,JW(u,E,y[0],i.pnet,a)];case 1:return k=T.sent(),a.total_stage1=Date.now()-_,k.boxes.length?(a.stage2_numInputBoxes=k.boxes.length,_=Date.now(),[4,QW(o,k.boxes,y[1],i.rnet,a)]):[2,l({results:[],stats:a})];case 2:return C=T.sent(),a.total_stage2=Date.now()-_,C.boxes.length?(a.stage3_numInputBoxes=C.boxes.length,_=Date.now(),[4,tH(o,C.boxes,y[2],i.onet,a)]):[2,l({results:[],stats:a})];case 3:return R=T.sent(),a.total_stage3=Date.now()-_,I=R.boxes.map(function(A,N){return S1(_1({},new co(R.scores[N],new c1(A.left/f,A.top/h,A.width/f,A.height/h),{height:h,width:f})),new gW(R.points[N].map(function(O){return O.sub(new yn(A.left,A.top)).div(new yn(A.width,A.height))}),{width:A.width,height:A.height}))}),[2,l({results:I,stats:a})]}})})},e.prototype.forward=function(t,n){return n===void 0&&(n={}),It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,_r(t)];case 1:return[4,i.apply(this,[o.sent(),n])];case 2:return[2,o.sent().results]}})})},e.prototype.forwardWithStats=function(t,n){return n===void 0&&(n={}),It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return i=this.forwardInput,[4,_r(t)];case 1:return[2,i.apply(this,[o.sent(),n])]}})})},e.prototype.getDefaultModelName=function(){return"mtcnn_model"},e.prototype.extractParamsFromWeigthMap=function(t){return qW(t)},e.prototype.extractParams=function(t){return VW(t)},e})(as),rH=.4,iH=[new yn(1.603231,2.094468),new yn(6.041143,7.080126),new yn(2.882459,3.518061),new yn(4.266906,5.178857),new yn(9.041765,10.66308)],oH=[117.001,114.697,97.404],aH=(function(r){Yt(e,r);function e(){var t=this,n={withSeparableConvs:!0,iouThreshold:rH,classes:["face"],anchors:iH,meanRgb:oH,isFirstLayerConv2d:!0,filterSizes:[3,16,32,64,128,256,512]};return t=r.call(this,n)||this,t}return Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,n)];case 1:return i=o.sent(),[2,i.map(function(a){return new co(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return"tiny_face_detector_model"},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e})(aA),sH=.4,uH=[new yn(.738768,.874946),new yn(2.42204,2.65704),new yn(4.30971,7.04493),new yn(10.246,4.59428),new yn(12.6868,11.8741)],lH=[new yn(1.603231,2.094468),new yn(6.041143,7.080126),new yn(2.882459,3.518061),new yn(4.266906,5.178857),new yn(9.041765,10.66308)],cH=[117.001,114.697,97.404],hH="tiny_yolov2_model",dH="tiny_yolov2_separable_conv_model",fH=(function(r){Yt(e,r);function e(t){t===void 0&&(t=!0);var n=this,i=Object.assign({},{withSeparableConvs:t,iouThreshold:sH,classes:["face"]},t?{anchors:lH,meanRgb:cH}:{anchors:uH,withClassScores:!0});return n=r.call(this,i)||this,n}return Object.defineProperty(e.prototype,"withSeparableConvs",{get:function(){return this.config.withSeparableConvs},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anchors",{get:function(){return this.config.anchors},enumerable:!0,configurable:!0}),e.prototype.locateFaces=function(t,n){return It(this,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.detect(t,n)];case 1:return i=o.sent(),[2,i.map(function(a){return new co(a.score,a.relativeBox,{width:a.imageWidth,height:a.imageHeight})})]}})})},e.prototype.getDefaultModelName=function(){return this.withSeparableConvs?dH:hH},e.prototype.extractParamsFromWeigthMap=function(t){return r.prototype.extractParamsFromWeigthMap.call(this,t)},e})(aA),gi={ssdMobilenetv1:new kA,tinyFaceDetector:new aH,tinyYolov2:new fH,mtcnn:new nH,faceLandmark68Net:new wA,faceLandmark68TinyNet:new wW,faceRecognitionNet:new TW,faceExpressionNet:new Zz,ageGenderNet:new mW};function AA(r,e){var t={age:e};return Object.assign({},r,t)}function RA(r,e,t){var n={gender:e,genderProbability:t};return Object.assign({},r,n)}var IA=(function(r){Yt(e,r);function e(t,n,i){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=i,o}return e})(Nd),R1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n,i=this;return Dt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,wg(t,this.input,function(a){return It(i,void 0,void 0,function(){return Dt(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return gi.faceExpressionNet.predictExpressions(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=o.sent(),[2,t.map(function(a,s){return fA(a,n[s])})]}})})},e.prototype.withAgeAndGender=function(){return new P1(this,this.input)},e})(IA),I1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,T1(t,this.input,function(o){return gi.faceExpressionNet.predictExpressions(o)},this.extractedFaces)]:[2];case 2:return n=i.sent(),[2,fA(t,n)]}})})},e.prototype.withAgeAndGender=function(){return new F1(this,this.input)},e})(IA),D1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new O1(this,this.input)},e.prototype.withFaceDescriptors=function(){return new B1(this,this.input)},e})(R1),N1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withAgeAndGender=function(){return new L1(this,this.input)},e.prototype.withFaceDescriptor=function(){return new U1(this,this.input)},e})(I1),DA=(function(r){Yt(e,r);function e(t,n,i){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o.extractedFaces=i,o}return e})(Nd),P1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n,i=this;return Dt(this,function(o){switch(o.label){case 0:return[4,this.parentTask];case 1:return t=o.sent(),[4,wg(t,this.input,function(a){return It(i,void 0,void 0,function(){return Dt(this,function(s){switch(s.label){case 0:return[4,Promise.all(a.map(function(u){return gi.ageGenderNet.predictAgeAndGender(u)}))];case 1:return[2,s.sent()]}})})},this.extractedFaces)];case 2:return n=o.sent(),[2,t.map(function(a,s){var u=n[s],l=u.age,c=u.gender,h=u.genderProbability;return AA(RA(a,c,h),l)})]}})})},e.prototype.withFaceExpressions=function(){return new R1(this,this.input)},e})(DA),F1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n,i,o,a;return Dt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?[4,T1(t,this.input,function(u){return gi.ageGenderNet.predictAgeAndGender(u)},this.extractedFaces)]:[2];case 2:return n=s.sent(),i=n.age,o=n.gender,a=n.genderProbability,[2,AA(RA(t,o,a),i)]}})})},e.prototype.withFaceExpressions=function(){return new I1(this,this.input)},e})(DA),O1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new D1(this,this.input)},e.prototype.withFaceDescriptors=function(){return new B1(this,this.input)},e})(P1),L1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.withFaceExpressions=function(){return new N1(this,this.input)},e.prototype.withFaceDescriptor=function(){return new U1(this,this.input)},e})(F1),NA=(function(r){Yt(e,r);function e(t,n){var i=r.call(this)||this;return i.parentTask=t,i.input=n,i}return e})(Nd),B1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),[4,wg(t,this.input,function(o){return Promise.all(o.map(function(a){return gi.faceRecognitionNet.computeFaceDescriptor(a)}))},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})];case 2:return n=i.sent(),[2,n.map(function(o,a){return SA(t[a],o)})]}})})},e.prototype.withFaceExpressions=function(){return new D1(this,this.input)},e.prototype.withAgeAndGender=function(){return new O1(this,this.input)},e})(NA),U1=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return[4,this.parentTask];case 1:return t=i.sent(),t?[4,T1(t,this.input,function(o){return gi.faceRecognitionNet.computeFaceDescriptor(o)},null,function(o){return o.landmarks.align(null,{useDlibAlignment:!0})})]:[2];case 2:return n=i.sent(),[2,SA(t,n)]}})})},e.prototype.withFaceExpressions=function(){return new N1(this,this.input)},e.prototype.withAgeAndGender=function(){return new L1(this,this.input)},e})(NA),PA=(function(r){Yt(e,r);function e(t,n,i){var o=r.call(this)||this;return o.parentTask=t,o.input=n,o.useTinyLandmarkNet=i,o}return Object.defineProperty(e.prototype,"landmarkNet",{get:function(){return this.useTinyLandmarkNet?gi.faceLandmark68TinyNet:gi.faceLandmark68Net},enumerable:!0,configurable:!0}),e})(Nd),pH=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n,i,o,a,s=this;return Dt(this,function(u){switch(u.label){case 0:return[4,this.parentTask];case 1:return t=u.sent(),n=t.map(function(l){return l.detection}),this.input instanceof at?[4,k1(this.input,n)]:[3,3];case 2:return o=u.sent(),[3,5];case 3:return[4,E1(this.input,n)];case 4:o=u.sent(),u.label=5;case 5:return i=o,[4,Promise.all(i.map(function(l){return s.landmarkNet.detectLandmarks(l)}))];case 6:return a=u.sent(),i.forEach(function(l){return l instanceof at&&l.dispose()}),[2,t.map(function(l,c){return S1(l,a[c])})]}})})},e.prototype.withFaceExpressions=function(){return new D1(this,this.input)},e.prototype.withAgeAndGender=function(){return new O1(this,this.input)},e.prototype.withFaceDescriptors=function(){return new B1(this,this.input)},e})(PA),mH=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n,i,o,a;return Dt(this,function(s){switch(s.label){case 0:return[4,this.parentTask];case 1:return t=s.sent(),t?(n=t.detection,this.input instanceof at?[4,k1(this.input,[n])]:[3,3]):[2];case 2:return o=s.sent(),[3,5];case 3:return[4,E1(this.input,[n])];case 4:o=s.sent(),s.label=5;case 5:return i=o,[4,this.landmarkNet.detectLandmarks(i[0])];case 6:return a=s.sent(),i.forEach(function(u){return u instanceof at&&u.dispose()}),[2,S1(t,a)]}})})},e.prototype.withFaceExpressions=function(){return new N1(this,this.input)},e.prototype.withAgeAndGender=function(){return new L1(this,this.input)},e.prototype.withFaceDescriptor=function(){return new U1(this,this.input)},e})(PA),FA=(function(r){Yt(e,r);function e(t,n){n===void 0&&(n=new bg);var i=r.call(this)||this;return i.input=t,i.options=n,i}return e})(Nd),gH=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n,i,o;return Dt(this,function(a){switch(a.label){case 0:return t=this,n=t.input,i=t.options,i instanceof EA?[4,gi.mtcnn.forward(n,i)]:[3,2];case 1:return[2,a.sent().map(function(s){return s.detection})];case 2:if(o=i instanceof CA?function(s){return gi.tinyFaceDetector.locateFaces(s,i)}:i instanceof bg?function(s){return gi.ssdMobilenetv1.locateFaces(s,i)}:i instanceof w1?function(s){return gi.tinyYolov2.locateFaces(s,i)}:null,!o)throw new Error("detectFaces - expected options to be instance of TinyFaceDetectorOptions | SsdMobilenetv1Options | MtcnnOptions | TinyYolov2Options");return[2,o(n)]}})})},e.prototype.runAndExtendWithFaceDetections=function(){var t=this;return new Promise(function(n){return It(t,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,n(i.map(function(a){return _1({},a)}))]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new pH(this.runAndExtendWithFaceDetections(),this.input,t)},e.prototype.withFaceExpressions=function(){return new R1(this.runAndExtendWithFaceDetections(),this.input)},e.prototype.withAgeAndGender=function(){return new P1(this.runAndExtendWithFaceDetections(),this.input)},e})(FA),vH=(function(r){Yt(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.run=function(){return It(this,void 0,void 0,function(){var t,n;return Dt(this,function(i){switch(i.label){case 0:return[4,new gH(this.input,this.options)];case 1:return t=i.sent(),n=t[0],t.forEach(function(o){o.score>n.score&&(n=o)}),[2,n]}})})},e.prototype.runAndExtendWithFaceDetection=function(){var t=this;return new Promise(function(n){return It(t,void 0,void 0,function(){var i;return Dt(this,function(o){switch(o.label){case 0:return[4,this.run()];case 1:return i=o.sent(),[2,n(i?_1({},i):void 0)]}})})})},e.prototype.withFaceLandmarks=function(t){return t===void 0&&(t=!1),new mH(this.runAndExtendWithFaceDetection(),this.input,t)},e.prototype.withFaceExpressions=function(){return new I1(this.runAndExtendWithFaceDetection(),this.input)},e.prototype.withAgeAndGender=function(){return new F1(this.runAndExtendWithFaceDetection(),this.input)},e})(FA);function yH(r,e){return e===void 0&&(e=new bg),new vH(r,e)}function bH(r,e){if(r.length!==e.length)throw new Error("euclideanDistance: arr1.length !== arr2.length");var t=Array.from(r),n=Array.from(e);return Math.sqrt(t.map(function(i,o){return i-n[o]}).reduce(function(i,o){return i+Math.pow(o,2)},0))}(function(){function r(e,t){t===void 0&&(t=.6),this._distanceThreshold=t;var n=Array.isArray(e)?e:[e];if(!n.length)throw new Error("FaceRecognizer.constructor - expected atleast one input");var i=1,o=function(){return"person "+i++};this._labeledDescriptors=n.map(function(a){if(a instanceof u0)return a;if(a instanceof Float32Array)return new u0(o(),[a]);if(a.descriptor&&a.descriptor instanceof Float32Array)return new u0(o(),[a.descriptor]);throw new Error("FaceRecognizer.constructor - expected inputs to be of type LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array | Array<LabeledFaceDescriptors | WithFaceDescriptor<any> | Float32Array>")})}return Object.defineProperty(r.prototype,"labeledDescriptors",{get:function(){return this._labeledDescriptors},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"distanceThreshold",{get:function(){return this._distanceThreshold},enumerable:!0,configurable:!0}),r.prototype.computeMeanDistance=function(e,t){return t.map(function(n){return bH(n,e)}).reduce(function(n,i){return n+i},0)/(t.length||1)},r.prototype.matchDescriptor=function(e){var t=this;return this.labeledDescriptors.map(function(n){var i=n.descriptors,o=n.label;return new WE(o,t.computeMeanDistance(e,i))}).reduce(function(n,i){return n.distance<i.distance?n:i})},r.prototype.findBestMatch=function(e){var t=this.matchDescriptor(e);return t.distance<this.distanceThreshold?t:new WE("unknown",t.distance)},r})();Fo({},Nz,aW);const Pd="180",wH=0,HE=1,_H=2,OA=1,xH=2,La=3,Ya=0,br=1,Oi=2,wi=0,Ic=1,GE=2,VE=3,jE=4,SH=5,Gu=100,EH=101,kH=102,CH=103,TH=104,MH=200,AH=201,RH=202,IH=203,Cb=204,Tb=205,DH=206,NH=207,PH=208,FH=209,OH=210,LH=211,BH=212,UH=213,zH=214,Mb=0,jm=1,Ab=2,Wc=3,Rb=4,Ib=5,Db=6,Nb=7,LA=0,WH=1,HH=2,qa=0,GH=1,VH=2,jH=3,qH=4,$H=5,XH=6,YH=7,BA=300,Hc=301,Gc=302,Pb=303,Fb=304,_g=306,Ob=1e3,Yu=1001,Lb=1002,Uo=1003,KH=1004,xp=1005,vi=1006,l0=1007,Ku=1008,$r=1009,UA=1010,zA=1011,ad=1012,z1=1013,nu=1014,Va=1015,Fd=1016,W1=1017,H1=1018,Vc=1020,WA=35902,HA=35899,GA=1021,VA=1022,No=1023,sd=1026,jc=1027,jA=1028,G1=1029,qA=1030,V1=1031,j1=1033,Qp=33776,em=33777,tm=33778,nm=33779,Bb=35840,Ub=35841,zb=35842,Wb=35843,Hb=36196,Gb=37492,Vb=37496,jb=37808,qb=37809,$b=37810,Xb=37811,Yb=37812,Kb=37813,Jb=37814,Zb=37815,Qb=37816,ew=37817,tw=37818,nw=37819,rw=37820,iw=37821,ow=36492,aw=36494,sw=36495,uw=36283,lw=36284,cw=36285,hw=36286,Od=3200,JH=3201,ZH=0,QH=1,sa="",Cn="srgb",ru="srgb-linear",qm="linear",Mn="srgb",jl=7680,qE=519,eG=512,tG=513,nG=514,$A=515,rG=516,iG=517,oG=518,aG=519,$E=35044,XE="300 es",ca=2e3,$m=2001;class ss{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let o=0,a=i.length;o<a;o++)i[o].call(this,e);e.target=null}}}const Fr=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let YE=1234567;const Kh=Math.PI/180,ud=180/Math.PI;function Zc(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Fr[r&255]+Fr[r>>8&255]+Fr[r>>16&255]+Fr[r>>24&255]+"-"+Fr[e&255]+Fr[e>>8&255]+"-"+Fr[e>>16&15|64]+Fr[e>>24&255]+"-"+Fr[t&63|128]+Fr[t>>8&255]+"-"+Fr[t>>16&255]+Fr[t>>24&255]+Fr[n&255]+Fr[n>>8&255]+Fr[n>>16&255]+Fr[n>>24&255]).toLowerCase()}function sn(r,e,t){return Math.max(e,Math.min(t,r))}function q1(r,e){return(r%e+e)%e}function sG(r,e,t,n,i){return n+(r-e)*(i-n)/(t-e)}function uG(r,e,t){return r!==e?(t-r)/(e-r):0}function Jh(r,e,t){return(1-t)*r+t*e}function lG(r,e,t,n){return Jh(r,e,1-Math.exp(-t*n))}function cG(r,e=1){return e-Math.abs(q1(r,e*2)-e)}function hG(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function dG(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function fG(r,e){return r+Math.floor(Math.random()*(e-r+1))}function pG(r,e){return r+Math.random()*(e-r)}function mG(r){return r*(.5-Math.random())}function gG(r){r!==void 0&&(YE=r);let e=YE+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function vG(r){return r*Kh}function yG(r){return r*ud}function bG(r){return(r&r-1)===0&&r!==0}function wG(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function _G(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function xG(r,e,t,n,i){const o=Math.cos,a=Math.sin,s=o(t/2),u=a(t/2),l=o((e+n)/2),c=a((e+n)/2),h=o((e-n)/2),f=a((e-n)/2),m=o((n-e)/2),g=a((n-e)/2);switch(i){case"XYX":r.set(s*c,u*h,u*f,s*l);break;case"YZY":r.set(u*f,s*c,u*h,s*l);break;case"ZXZ":r.set(u*h,u*f,s*c,s*l);break;case"XZX":r.set(s*c,u*g,u*m,s*l);break;case"YXY":r.set(u*m,s*c,u*g,s*l);break;case"ZYZ":r.set(u*g,u*m,s*c,s*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function pc(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function ei(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Ji={DEG2RAD:Kh,RAD2DEG:ud,generateUUID:Zc,clamp:sn,euclideanModulo:q1,mapLinear:sG,inverseLerp:uG,lerp:Jh,damp:lG,pingpong:cG,smoothstep:hG,smootherstep:dG,randInt:fG,randFloat:pG,randFloatSpread:mG,seededRandom:gG,degToRad:vG,radToDeg:yG,isPowerOfTwo:bG,ceilPowerOfTwo:wG,floorPowerOfTwo:_G,setQuaternionFromProperEuler:xG,normalize:ei,denormalize:pc};class Wt{constructor(e=0,t=0){Wt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=sn(this.x,e.x,t.x),this.y=sn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=sn(this.x,e,t),this.y=sn(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(sn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),o=this.x-e.x,a=this.y-e.y;return this.x=o*n-a*i+e.x,this.y=o*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Ld{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,o,a,s){let u=n[i+0],l=n[i+1],c=n[i+2],h=n[i+3];const f=o[a+0],m=o[a+1],g=o[a+2],w=o[a+3];if(s===0){e[t+0]=u,e[t+1]=l,e[t+2]=c,e[t+3]=h;return}if(s===1){e[t+0]=f,e[t+1]=m,e[t+2]=g,e[t+3]=w;return}if(h!==w||u!==f||l!==m||c!==g){let v=1-s;const y=u*f+l*m+c*g+h*w,x=y>=0?1:-1,E=1-y*y;if(E>Number.EPSILON){const k=Math.sqrt(E),C=Math.atan2(k,y*x);v=Math.sin(v*C)/k,s=Math.sin(s*C)/k}const _=s*x;if(u=u*v+f*_,l=l*v+m*_,c=c*v+g*_,h=h*v+w*_,v===1-s){const k=1/Math.sqrt(u*u+l*l+c*c+h*h);u*=k,l*=k,c*=k,h*=k}}e[t]=u,e[t+1]=l,e[t+2]=c,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,i,o,a){const s=n[i],u=n[i+1],l=n[i+2],c=n[i+3],h=o[a],f=o[a+1],m=o[a+2],g=o[a+3];return e[t]=s*g+c*h+u*m-l*f,e[t+1]=u*g+c*f+l*h-s*m,e[t+2]=l*g+c*m+s*f-u*h,e[t+3]=c*g-s*h-u*f-l*m,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,o=e._z,a=e._order,s=Math.cos,u=Math.sin,l=s(n/2),c=s(i/2),h=s(o/2),f=u(n/2),m=u(i/2),g=u(o/2);switch(a){case"XYZ":this._x=f*c*h+l*m*g,this._y=l*m*h-f*c*g,this._z=l*c*g+f*m*h,this._w=l*c*h-f*m*g;break;case"YXZ":this._x=f*c*h+l*m*g,this._y=l*m*h-f*c*g,this._z=l*c*g-f*m*h,this._w=l*c*h+f*m*g;break;case"ZXY":this._x=f*c*h-l*m*g,this._y=l*m*h+f*c*g,this._z=l*c*g+f*m*h,this._w=l*c*h-f*m*g;break;case"ZYX":this._x=f*c*h-l*m*g,this._y=l*m*h+f*c*g,this._z=l*c*g-f*m*h,this._w=l*c*h+f*m*g;break;case"YZX":this._x=f*c*h+l*m*g,this._y=l*m*h+f*c*g,this._z=l*c*g-f*m*h,this._w=l*c*h-f*m*g;break;case"XZY":this._x=f*c*h-l*m*g,this._y=l*m*h-f*c*g,this._z=l*c*g+f*m*h,this._w=l*c*h+f*m*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],o=t[8],a=t[1],s=t[5],u=t[9],l=t[2],c=t[6],h=t[10],f=n+s+h;if(f>0){const m=.5/Math.sqrt(f+1);this._w=.25/m,this._x=(c-u)*m,this._y=(o-l)*m,this._z=(a-i)*m}else if(n>s&&n>h){const m=2*Math.sqrt(1+n-s-h);this._w=(c-u)/m,this._x=.25*m,this._y=(i+a)/m,this._z=(o+l)/m}else if(s>h){const m=2*Math.sqrt(1+s-n-h);this._w=(o-l)/m,this._x=(i+a)/m,this._y=.25*m,this._z=(u+c)/m}else{const m=2*Math.sqrt(1+h-n-s);this._w=(a-i)/m,this._x=(o+l)/m,this._y=(u+c)/m,this._z=.25*m}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(sn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,o=e._z,a=e._w,s=t._x,u=t._y,l=t._z,c=t._w;return this._x=n*c+a*s+i*l-o*u,this._y=i*c+a*u+o*s-n*l,this._z=o*c+a*l+n*u-i*s,this._w=a*c-n*s-i*u-o*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,o=this._z,a=this._w;let s=a*e._w+n*e._x+i*e._y+o*e._z;if(s<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=a,this._x=n,this._y=i,this._z=o,this;const u=1-s*s;if(u<=Number.EPSILON){const m=1-t;return this._w=m*a+t*this._w,this._x=m*n+t*this._x,this._y=m*i+t*this._y,this._z=m*o+t*this._z,this.normalize(),this}const l=Math.sqrt(u),c=Math.atan2(l,s),h=Math.sin((1-t)*c)/l,f=Math.sin(t*c)/l;return this._w=a*h+this._w*f,this._x=n*h+this._x*f,this._y=i*h+this._y*f,this._z=o*h+this._z*f,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),o=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Te{constructor(e=0,t=0,n=0){Te.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(KE.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(KE.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*n+o[6]*i,this.y=o[1]*t+o[4]*n+o[7]*i,this.z=o[2]*t+o[5]*n+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=e.elements,a=1/(o[3]*t+o[7]*n+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*n+o[8]*i+o[12])*a,this.y=(o[1]*t+o[5]*n+o[9]*i+o[13])*a,this.z=(o[2]*t+o[6]*n+o[10]*i+o[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,o=e.x,a=e.y,s=e.z,u=e.w,l=2*(a*i-s*n),c=2*(s*t-o*i),h=2*(o*n-a*t);return this.x=t+u*l+a*h-s*c,this.y=n+u*c+s*l-o*h,this.z=i+u*h+o*c-a*l,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i,this.y=o[1]*t+o[5]*n+o[9]*i,this.z=o[2]*t+o[6]*n+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=sn(this.x,e.x,t.x),this.y=sn(this.y,e.y,t.y),this.z=sn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=sn(this.x,e,t),this.y=sn(this.y,e,t),this.z=sn(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(sn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,o=e.z,a=t.x,s=t.y,u=t.z;return this.x=i*u-o*s,this.y=o*a-n*u,this.z=n*s-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return c0.copy(this).projectOnVector(e),this.sub(c0)}reflect(e){return this.sub(c0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(sn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const c0=new Te,KE=new Ld;class Jt{constructor(e,t,n,i,o,a,s,u,l){Jt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,o,a,s,u,l)}set(e,t,n,i,o,a,s,u,l){const c=this.elements;return c[0]=e,c[1]=i,c[2]=s,c[3]=t,c[4]=o,c[5]=u,c[6]=n,c[7]=a,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,a=n[0],s=n[3],u=n[6],l=n[1],c=n[4],h=n[7],f=n[2],m=n[5],g=n[8],w=i[0],v=i[3],y=i[6],x=i[1],E=i[4],_=i[7],k=i[2],C=i[5],R=i[8];return o[0]=a*w+s*x+u*k,o[3]=a*v+s*E+u*C,o[6]=a*y+s*_+u*R,o[1]=l*w+c*x+h*k,o[4]=l*v+c*E+h*C,o[7]=l*y+c*_+h*R,o[2]=f*w+m*x+g*k,o[5]=f*v+m*E+g*C,o[8]=f*y+m*_+g*R,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8];return t*a*c-t*s*l-n*o*c+n*s*u+i*o*l-i*a*u}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=c*a-s*l,f=s*u-c*o,m=l*o-a*u,g=t*h+n*f+i*m;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const w=1/g;return e[0]=h*w,e[1]=(i*l-c*n)*w,e[2]=(s*n-i*a)*w,e[3]=f*w,e[4]=(c*t-i*u)*w,e[5]=(i*o-s*t)*w,e[6]=m*w,e[7]=(n*u-l*t)*w,e[8]=(a*t-n*o)*w,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,o,a,s){const u=Math.cos(o),l=Math.sin(o);return this.set(n*u,n*l,-n*(u*a+l*s)+a+e,-i*l,i*u,-i*(-l*a+u*s)+s+t,0,0,1),this}scale(e,t){return this.premultiply(h0.makeScale(e,t)),this}rotate(e){return this.premultiply(h0.makeRotation(-e)),this}translate(e,t){return this.premultiply(h0.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const h0=new Jt;function XA(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}function Xm(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function SG(){const r=Xm("canvas");return r.style.display="block",r}const JE={};function ld(r){r in JE||(JE[r]=!0,console.warn(r))}function EG(r,e,t){return new Promise(function(n,i){function o(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(o,t);break;default:n()}}setTimeout(o,t)})}const ZE=new Jt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),QE=new Jt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function kG(){const r={enabled:!0,workingColorSpace:ru,spaces:{},convert:function(i,o,a){return this.enabled===!1||o===a||!o||!a||(this.spaces[o].transfer===Mn&&(i.r=$a(i.r),i.g=$a(i.g),i.b=$a(i.b)),this.spaces[o].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[o].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===Mn&&(i.r=Dc(i.r),i.g=Dc(i.g),i.b=Dc(i.b))),i},workingToColorSpace:function(i,o){return this.convert(i,this.workingColorSpace,o)},colorSpaceToWorking:function(i,o){return this.convert(i,o,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===sa?qm:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,o=this.workingColorSpace){return i.fromArray(this.spaces[o].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,o,a){return i.copy(this.spaces[o].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,o){return ld("THREE.ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(i,o)},toWorkingColorSpace:function(i,o){return ld("THREE.ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(i,o)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[ru]:{primaries:e,whitePoint:n,transfer:qm,toXYZ:ZE,fromXYZ:QE,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Cn},outputColorSpaceConfig:{drawingBufferColorSpace:Cn}},[Cn]:{primaries:e,whitePoint:n,transfer:Mn,toXYZ:ZE,fromXYZ:QE,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Cn}}}),r}const gn=kG();function $a(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Dc(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let ql;class CG{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{ql===void 0&&(ql=Xm("canvas")),ql.width=e.width,ql.height=e.height;const i=ql.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=ql}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Xm("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),o=i.data;for(let a=0;a<o.length;a++)o[a]=$a(o[a]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor($a(t[n]/255)*255):t[n]=$a(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let TG=0;class $1{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:TG++}),this.uuid=Zc(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let a=0,s=i.length;a<s;a++)i[a].isDataTexture?o.push(d0(i[a].image)):o.push(d0(i[a]))}else o=d0(i);n.url=o}return t||(e.images[this.uuid]=n),n}}function d0(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?CG.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let MG=0;const f0=new Te;class jr extends ss{constructor(e=jr.DEFAULT_IMAGE,t=jr.DEFAULT_MAPPING,n=Yu,i=Yu,o=vi,a=Ku,s=No,u=$r,l=jr.DEFAULT_ANISOTROPY,c=sa){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:MG++}),this.uuid=Zc(),this.name="",this.source=new $1(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=o,this.minFilter=a,this.anisotropy=l,this.format=s,this.internalFormat=null,this.type=u,this.offset=new Wt(0,0),this.repeat=new Wt(1,1),this.center=new Wt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(f0).x}get height(){return this.source.getSize(f0).y}get depth(){return this.source.getSize(f0).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==BA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ob:e.x=e.x-Math.floor(e.x);break;case Yu:e.x=e.x<0?0:1;break;case Lb:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ob:e.y=e.y-Math.floor(e.y);break;case Yu:e.y=e.y<0?0:1;break;case Lb:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}jr.DEFAULT_IMAGE=null;jr.DEFAULT_MAPPING=BA;jr.DEFAULT_ANISOTROPY=1;class Hn{constructor(e=0,t=0,n=0,i=1){Hn.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,o=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*o,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*o,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*o,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*o,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,o;const u=e.elements,l=u[0],c=u[4],h=u[8],f=u[1],m=u[5],g=u[9],w=u[2],v=u[6],y=u[10];if(Math.abs(c-f)<.01&&Math.abs(h-w)<.01&&Math.abs(g-v)<.01){if(Math.abs(c+f)<.1&&Math.abs(h+w)<.1&&Math.abs(g+v)<.1&&Math.abs(l+m+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const E=(l+1)/2,_=(m+1)/2,k=(y+1)/2,C=(c+f)/4,R=(h+w)/4,I=(g+v)/4;return E>_&&E>k?E<.01?(n=0,i=.707106781,o=.707106781):(n=Math.sqrt(E),i=C/n,o=R/n):_>k?_<.01?(n=.707106781,i=0,o=.707106781):(i=Math.sqrt(_),n=C/i,o=I/i):k<.01?(n=.707106781,i=.707106781,o=0):(o=Math.sqrt(k),n=R/o,i=I/o),this.set(n,i,o,t),this}let x=Math.sqrt((v-g)*(v-g)+(h-w)*(h-w)+(f-c)*(f-c));return Math.abs(x)<.001&&(x=1),this.x=(v-g)/x,this.y=(h-w)/x,this.z=(f-c)/x,this.w=Math.acos((l+m+y-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=sn(this.x,e.x,t.x),this.y=sn(this.y,e.y,t.y),this.z=sn(this.z,e.z,t.z),this.w=sn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=sn(this.x,e,t),this.y=sn(this.y,e,t),this.z=sn(this.z,e,t),this.w=sn(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(sn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class AG extends ss{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:vi,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new Hn(0,0,e,t),this.scissorTest=!1,this.viewport=new Hn(0,0,e,t);const i={width:e,height:t,depth:n.depth},o=new jr(i);this.textures=[];const a=n.count;for(let s=0;s<a;s++)this.textures[s]=o.clone(),this.textures[s].isRenderTargetTexture=!0,this.textures[s].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:vi,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,o=this.textures.length;i<o;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isArrayTexture=this.textures[i].image.depth>1;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new $1(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class ii extends AG{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class YA extends jr{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Uo,this.minFilter=Uo,this.wrapR=Yu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class RG extends jr{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Uo,this.minFilter=Uo,this.wrapR=Yu,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Bd{constructor(e=new Te(1/0,1/0,1/0),t=new Te(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(So.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(So.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=So.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const o=n.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let a=0,s=o.count;a<s;a++)e.isMesh===!0?e.getVertexPosition(a,So):So.fromBufferAttribute(o,a),So.applyMatrix4(e.matrixWorld),this.expandByPoint(So);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Sp.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),Sp.copy(n.boundingBox)),Sp.applyMatrix4(e.matrixWorld),this.union(Sp)}const i=e.children;for(let o=0,a=i.length;o<a;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,So),So.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Wh),Ep.subVectors(this.max,Wh),$l.subVectors(e.a,Wh),Xl.subVectors(e.b,Wh),Yl.subVectors(e.c,Wh),Ds.subVectors(Xl,$l),Ns.subVectors(Yl,Xl),Mu.subVectors($l,Yl);let t=[0,-Ds.z,Ds.y,0,-Ns.z,Ns.y,0,-Mu.z,Mu.y,Ds.z,0,-Ds.x,Ns.z,0,-Ns.x,Mu.z,0,-Mu.x,-Ds.y,Ds.x,0,-Ns.y,Ns.x,0,-Mu.y,Mu.x,0];return!p0(t,$l,Xl,Yl,Ep)||(t=[1,0,0,0,1,0,0,0,1],!p0(t,$l,Xl,Yl,Ep))?!1:(kp.crossVectors(Ds,Ns),t=[kp.x,kp.y,kp.z],p0(t,$l,Xl,Yl,Ep))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,So).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(So).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Da[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Da[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Da[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Da[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Da[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Da[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Da[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Da[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Da),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Da=[new Te,new Te,new Te,new Te,new Te,new Te,new Te,new Te],So=new Te,Sp=new Bd,$l=new Te,Xl=new Te,Yl=new Te,Ds=new Te,Ns=new Te,Mu=new Te,Wh=new Te,Ep=new Te,kp=new Te,Au=new Te;function p0(r,e,t,n,i){for(let o=0,a=r.length-3;o<=a;o+=3){Au.fromArray(r,o);const s=i.x*Math.abs(Au.x)+i.y*Math.abs(Au.y)+i.z*Math.abs(Au.z),u=e.dot(Au),l=t.dot(Au),c=n.dot(Au);if(Math.max(-Math.max(u,l,c),Math.min(u,l,c))>s)return!1}return!0}const IG=new Bd,Hh=new Te,m0=new Te;class X1{constructor(e=new Te,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):IG.setFromPoints(e).getCenter(n);let i=0;for(let o=0,a=e.length;o<a;o++)i=Math.max(i,n.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Hh.subVectors(e,this.center);const t=Hh.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(Hh,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(m0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Hh.copy(e.center).add(m0)),this.expandByPoint(Hh.copy(e.center).sub(m0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const Na=new Te,g0=new Te,Cp=new Te,Ps=new Te,v0=new Te,Tp=new Te,y0=new Te;class DG{constructor(e=new Te,t=new Te(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Na)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Na.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Na.copy(this.origin).addScaledVector(this.direction,t),Na.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){g0.copy(e).add(t).multiplyScalar(.5),Cp.copy(t).sub(e).normalize(),Ps.copy(this.origin).sub(g0);const o=e.distanceTo(t)*.5,a=-this.direction.dot(Cp),s=Ps.dot(this.direction),u=-Ps.dot(Cp),l=Ps.lengthSq(),c=Math.abs(1-a*a);let h,f,m,g;if(c>0)if(h=a*u-s,f=a*s-u,g=o*c,h>=0)if(f>=-g)if(f<=g){const w=1/c;h*=w,f*=w,m=h*(h+a*f+2*s)+f*(a*h+f+2*u)+l}else f=o,h=Math.max(0,-(a*f+s)),m=-h*h+f*(f+2*u)+l;else f=-o,h=Math.max(0,-(a*f+s)),m=-h*h+f*(f+2*u)+l;else f<=-g?(h=Math.max(0,-(-a*o+s)),f=h>0?-o:Math.min(Math.max(-o,-u),o),m=-h*h+f*(f+2*u)+l):f<=g?(h=0,f=Math.min(Math.max(-o,-u),o),m=f*(f+2*u)+l):(h=Math.max(0,-(a*o+s)),f=h>0?o:Math.min(Math.max(-o,-u),o),m=-h*h+f*(f+2*u)+l);else f=a>0?-o:o,h=Math.max(0,-(a*f+s)),m=-h*h+f*(f+2*u)+l;return n&&n.copy(this.origin).addScaledVector(this.direction,h),i&&i.copy(g0).addScaledVector(Cp,f),m}intersectSphere(e,t){Na.subVectors(e.center,this.origin);const n=Na.dot(this.direction),i=Na.dot(Na)-n*n,o=e.radius*e.radius;if(i>o)return null;const a=Math.sqrt(o-i),s=n-a,u=n+a;return u<0?null:s<0?this.at(u,t):this.at(s,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,o,a,s,u;const l=1/this.direction.x,c=1/this.direction.y,h=1/this.direction.z,f=this.origin;return l>=0?(n=(e.min.x-f.x)*l,i=(e.max.x-f.x)*l):(n=(e.max.x-f.x)*l,i=(e.min.x-f.x)*l),c>=0?(o=(e.min.y-f.y)*c,a=(e.max.y-f.y)*c):(o=(e.max.y-f.y)*c,a=(e.min.y-f.y)*c),n>a||o>i||((o>n||isNaN(n))&&(n=o),(a<i||isNaN(i))&&(i=a),h>=0?(s=(e.min.z-f.z)*h,u=(e.max.z-f.z)*h):(s=(e.max.z-f.z)*h,u=(e.min.z-f.z)*h),n>u||s>i)||((s>n||n!==n)&&(n=s),(u<i||i!==i)&&(i=u),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,Na)!==null}intersectTriangle(e,t,n,i,o){v0.subVectors(t,e),Tp.subVectors(n,e),y0.crossVectors(v0,Tp);let a=this.direction.dot(y0),s;if(a>0){if(i)return null;s=1}else if(a<0)s=-1,a=-a;else return null;Ps.subVectors(this.origin,e);const u=s*this.direction.dot(Tp.crossVectors(Ps,Tp));if(u<0)return null;const l=s*this.direction.dot(v0.cross(Ps));if(l<0||u+l>a)return null;const c=-s*Ps.dot(y0);return c<0?null:this.at(c/a,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class sr{constructor(e,t,n,i,o,a,s,u,l,c,h,f,m,g,w,v){sr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,o,a,s,u,l,c,h,f,m,g,w,v)}set(e,t,n,i,o,a,s,u,l,c,h,f,m,g,w,v){const y=this.elements;return y[0]=e,y[4]=t,y[8]=n,y[12]=i,y[1]=o,y[5]=a,y[9]=s,y[13]=u,y[2]=l,y[6]=c,y[10]=h,y[14]=f,y[3]=m,y[7]=g,y[11]=w,y[15]=v,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new sr().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Kl.setFromMatrixColumn(e,0).length(),o=1/Kl.setFromMatrixColumn(e,1).length(),a=1/Kl.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*o,t[5]=n[5]*o,t[6]=n[6]*o,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,o=e.z,a=Math.cos(n),s=Math.sin(n),u=Math.cos(i),l=Math.sin(i),c=Math.cos(o),h=Math.sin(o);if(e.order==="XYZ"){const f=a*c,m=a*h,g=s*c,w=s*h;t[0]=u*c,t[4]=-u*h,t[8]=l,t[1]=m+g*l,t[5]=f-w*l,t[9]=-s*u,t[2]=w-f*l,t[6]=g+m*l,t[10]=a*u}else if(e.order==="YXZ"){const f=u*c,m=u*h,g=l*c,w=l*h;t[0]=f+w*s,t[4]=g*s-m,t[8]=a*l,t[1]=a*h,t[5]=a*c,t[9]=-s,t[2]=m*s-g,t[6]=w+f*s,t[10]=a*u}else if(e.order==="ZXY"){const f=u*c,m=u*h,g=l*c,w=l*h;t[0]=f-w*s,t[4]=-a*h,t[8]=g+m*s,t[1]=m+g*s,t[5]=a*c,t[9]=w-f*s,t[2]=-a*l,t[6]=s,t[10]=a*u}else if(e.order==="ZYX"){const f=a*c,m=a*h,g=s*c,w=s*h;t[0]=u*c,t[4]=g*l-m,t[8]=f*l+w,t[1]=u*h,t[5]=w*l+f,t[9]=m*l-g,t[2]=-l,t[6]=s*u,t[10]=a*u}else if(e.order==="YZX"){const f=a*u,m=a*l,g=s*u,w=s*l;t[0]=u*c,t[4]=w-f*h,t[8]=g*h+m,t[1]=h,t[5]=a*c,t[9]=-s*c,t[2]=-l*c,t[6]=m*h+g,t[10]=f-w*h}else if(e.order==="XZY"){const f=a*u,m=a*l,g=s*u,w=s*l;t[0]=u*c,t[4]=-h,t[8]=l*c,t[1]=f*h+w,t[5]=a*c,t[9]=m*h-g,t[2]=g*h-m,t[6]=s*c,t[10]=w*h+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(NG,e,PG)}lookAt(e,t,n){const i=this.elements;return Mi.subVectors(e,t),Mi.lengthSq()===0&&(Mi.z=1),Mi.normalize(),Fs.crossVectors(n,Mi),Fs.lengthSq()===0&&(Math.abs(n.z)===1?Mi.x+=1e-4:Mi.z+=1e-4,Mi.normalize(),Fs.crossVectors(n,Mi)),Fs.normalize(),Mp.crossVectors(Mi,Fs),i[0]=Fs.x,i[4]=Mp.x,i[8]=Mi.x,i[1]=Fs.y,i[5]=Mp.y,i[9]=Mi.y,i[2]=Fs.z,i[6]=Mp.z,i[10]=Mi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,o=this.elements,a=n[0],s=n[4],u=n[8],l=n[12],c=n[1],h=n[5],f=n[9],m=n[13],g=n[2],w=n[6],v=n[10],y=n[14],x=n[3],E=n[7],_=n[11],k=n[15],C=i[0],R=i[4],I=i[8],T=i[12],A=i[1],N=i[5],O=i[9],V=i[13],F=i[2],B=i[6],U=i[10],P=i[14],L=i[3],H=i[7],W=i[11],z=i[15];return o[0]=a*C+s*A+u*F+l*L,o[4]=a*R+s*N+u*B+l*H,o[8]=a*I+s*O+u*U+l*W,o[12]=a*T+s*V+u*P+l*z,o[1]=c*C+h*A+f*F+m*L,o[5]=c*R+h*N+f*B+m*H,o[9]=c*I+h*O+f*U+m*W,o[13]=c*T+h*V+f*P+m*z,o[2]=g*C+w*A+v*F+y*L,o[6]=g*R+w*N+v*B+y*H,o[10]=g*I+w*O+v*U+y*W,o[14]=g*T+w*V+v*P+y*z,o[3]=x*C+E*A+_*F+k*L,o[7]=x*R+E*N+_*B+k*H,o[11]=x*I+E*O+_*U+k*W,o[15]=x*T+E*V+_*P+k*z,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],o=e[12],a=e[1],s=e[5],u=e[9],l=e[13],c=e[2],h=e[6],f=e[10],m=e[14],g=e[3],w=e[7],v=e[11],y=e[15];return g*(+o*u*h-i*l*h-o*s*f+n*l*f+i*s*m-n*u*m)+w*(+t*u*m-t*l*f+o*a*f-i*a*m+i*l*c-o*u*c)+v*(+t*l*h-t*s*m-o*a*h+n*a*m+o*s*c-n*l*c)+y*(-i*s*c-t*u*h+t*s*f+i*a*h-n*a*f+n*u*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],l=e[7],c=e[8],h=e[9],f=e[10],m=e[11],g=e[12],w=e[13],v=e[14],y=e[15],x=h*v*l-w*f*l+w*u*m-s*v*m-h*u*y+s*f*y,E=g*f*l-c*v*l-g*u*m+a*v*m+c*u*y-a*f*y,_=c*w*l-g*h*l+g*s*m-a*w*m-c*s*y+a*h*y,k=g*h*u-c*w*u-g*s*f+a*w*f+c*s*v-a*h*v,C=t*x+n*E+i*_+o*k;if(C===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const R=1/C;return e[0]=x*R,e[1]=(w*f*o-h*v*o-w*i*m+n*v*m+h*i*y-n*f*y)*R,e[2]=(s*v*o-w*u*o+w*i*l-n*v*l-s*i*y+n*u*y)*R,e[3]=(h*u*o-s*f*o-h*i*l+n*f*l+s*i*m-n*u*m)*R,e[4]=E*R,e[5]=(c*v*o-g*f*o+g*i*m-t*v*m-c*i*y+t*f*y)*R,e[6]=(g*u*o-a*v*o-g*i*l+t*v*l+a*i*y-t*u*y)*R,e[7]=(a*f*o-c*u*o+c*i*l-t*f*l-a*i*m+t*u*m)*R,e[8]=_*R,e[9]=(g*h*o-c*w*o-g*n*m+t*w*m+c*n*y-t*h*y)*R,e[10]=(a*w*o-g*s*o+g*n*l-t*w*l-a*n*y+t*s*y)*R,e[11]=(c*s*o-a*h*o-c*n*l+t*h*l+a*n*m-t*s*m)*R,e[12]=k*R,e[13]=(c*w*i-g*h*i+g*n*f-t*w*f-c*n*v+t*h*v)*R,e[14]=(g*s*i-a*w*i-g*n*u+t*w*u+a*n*v-t*s*v)*R,e[15]=(a*h*i-c*s*i+c*n*u-t*h*u-a*n*f+t*s*f)*R,this}scale(e){const t=this.elements,n=e.x,i=e.y,o=e.z;return t[0]*=n,t[4]*=i,t[8]*=o,t[1]*=n,t[5]*=i,t[9]*=o,t[2]*=n,t[6]*=i,t[10]*=o,t[3]*=n,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),o=1-n,a=e.x,s=e.y,u=e.z,l=o*a,c=o*s;return this.set(l*a+n,l*s-i*u,l*u+i*s,0,l*s+i*u,c*s+n,c*u-i*a,0,l*u-i*s,c*u+i*a,o*u*u+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,o,a){return this.set(1,n,o,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,o=t._x,a=t._y,s=t._z,u=t._w,l=o+o,c=a+a,h=s+s,f=o*l,m=o*c,g=o*h,w=a*c,v=a*h,y=s*h,x=u*l,E=u*c,_=u*h,k=n.x,C=n.y,R=n.z;return i[0]=(1-(w+y))*k,i[1]=(m+_)*k,i[2]=(g-E)*k,i[3]=0,i[4]=(m-_)*C,i[5]=(1-(f+y))*C,i[6]=(v+x)*C,i[7]=0,i[8]=(g+E)*R,i[9]=(v-x)*R,i[10]=(1-(f+w))*R,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let o=Kl.set(i[0],i[1],i[2]).length();const a=Kl.set(i[4],i[5],i[6]).length(),s=Kl.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],Eo.copy(this);const l=1/o,c=1/a,h=1/s;return Eo.elements[0]*=l,Eo.elements[1]*=l,Eo.elements[2]*=l,Eo.elements[4]*=c,Eo.elements[5]*=c,Eo.elements[6]*=c,Eo.elements[8]*=h,Eo.elements[9]*=h,Eo.elements[10]*=h,t.setFromRotationMatrix(Eo),n.x=o,n.y=a,n.z=s,this}makePerspective(e,t,n,i,o,a,s=ca,u=!1){const l=this.elements,c=2*o/(t-e),h=2*o/(n-i),f=(t+e)/(t-e),m=(n+i)/(n-i);let g,w;if(u)g=o/(a-o),w=a*o/(a-o);else if(s===ca)g=-(a+o)/(a-o),w=-2*a*o/(a-o);else if(s===$m)g=-a/(a-o),w=-a*o/(a-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+s);return l[0]=c,l[4]=0,l[8]=f,l[12]=0,l[1]=0,l[5]=h,l[9]=m,l[13]=0,l[2]=0,l[6]=0,l[10]=g,l[14]=w,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(e,t,n,i,o,a,s=ca,u=!1){const l=this.elements,c=2/(t-e),h=2/(n-i),f=-(t+e)/(t-e),m=-(n+i)/(n-i);let g,w;if(u)g=1/(a-o),w=a/(a-o);else if(s===ca)g=-2/(a-o),w=-(a+o)/(a-o);else if(s===$m)g=-1/(a-o),w=-o/(a-o);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+s);return l[0]=c,l[4]=0,l[8]=0,l[12]=f,l[1]=0,l[5]=h,l[9]=0,l[13]=m,l[2]=0,l[6]=0,l[10]=g,l[14]=w,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Kl=new Te,Eo=new sr,NG=new Te(0,0,0),PG=new Te(1,1,1),Fs=new Te,Mp=new Te,Mi=new Te,ek=new sr,tk=new Ld;class Ka{constructor(e=0,t=0,n=0,i=Ka.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,o=i[0],a=i[4],s=i[8],u=i[1],l=i[5],c=i[9],h=i[2],f=i[6],m=i[10];switch(t){case"XYZ":this._y=Math.asin(sn(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,m),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,l),this._z=0);break;case"YXZ":this._x=Math.asin(-sn(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,m),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(sn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,m),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(u,o));break;case"ZYX":this._y=Math.asin(-sn(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,m),this._z=Math.atan2(u,o)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(sn(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(s,m));break;case"XZY":this._z=Math.asin(-sn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,l),this._y=Math.atan2(s,o)):(this._x=Math.atan2(-c,m),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return ek.makeRotationFromQuaternion(e),this.setFromRotationMatrix(ek,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return tk.setFromEuler(this),this.setFromQuaternion(tk,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Ka.DEFAULT_ORDER="XYZ";class KA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let FG=0;const nk=new Te,Jl=new Ld,Pa=new sr,Ap=new Te,Gh=new Te,OG=new Te,LG=new Ld,rk=new Te(1,0,0),ik=new Te(0,1,0),ok=new Te(0,0,1),ak={type:"added"},BG={type:"removed"},Zl={type:"childadded",child:null},b0={type:"childremoved",child:null};class Hi extends ss{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:FG++}),this.uuid=Zc(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hi.DEFAULT_UP.clone();const e=new Te,t=new Ka,n=new Ld,i=new Te(1,1,1);function o(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(o),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new sr},normalMatrix:{value:new Jt}}),this.matrix=new sr,this.matrixWorld=new sr,this.matrixAutoUpdate=Hi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new KA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Jl.setFromAxisAngle(e,t),this.quaternion.multiply(Jl),this}rotateOnWorldAxis(e,t){return Jl.setFromAxisAngle(e,t),this.quaternion.premultiply(Jl),this}rotateX(e){return this.rotateOnAxis(rk,e)}rotateY(e){return this.rotateOnAxis(ik,e)}rotateZ(e){return this.rotateOnAxis(ok,e)}translateOnAxis(e,t){return nk.copy(e).applyQuaternion(this.quaternion),this.position.add(nk.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(rk,e)}translateY(e){return this.translateOnAxis(ik,e)}translateZ(e){return this.translateOnAxis(ok,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Pa.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Ap.copy(e):Ap.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Gh.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Pa.lookAt(Gh,Ap,this.up):Pa.lookAt(Ap,Gh,this.up),this.quaternion.setFromRotationMatrix(Pa),i&&(Pa.extractRotation(i.matrixWorld),Jl.setFromRotationMatrix(Pa),this.quaternion.premultiply(Jl.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(ak),Zl.child=e,this.dispatchEvent(Zl),Zl.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(BG),b0.child=e,this.dispatchEvent(b0),b0.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Pa.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Pa.multiply(e.parent.matrixWorld)),e.applyMatrix4(Pa),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(ak),Zl.child=e,this.dispatchEvent(Zl),Zl.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gh,e,OG),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gh,LG,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let o=0,a=i.length;o<a;o++)i[o].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(s=>({...s,boundingBox:s.boundingBox?s.boundingBox.toJSON():void 0,boundingSphere:s.boundingSphere?s.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(s=>({...s})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function o(s,u){return s[u.uuid]===void 0&&(s[u.uuid]=u.toJSON(e)),u.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const s=this.geometry.parameters;if(s!==void 0&&s.shapes!==void 0){const u=s.shapes;if(Array.isArray(u))for(let l=0,c=u.length;l<c;l++){const h=u[l];o(e.shapes,h)}else o(e.shapes,u)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const s=[];for(let u=0,l=this.material.length;u<l;u++)s.push(o(e.materials,this.material[u]));i.material=s}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let s=0;s<this.children.length;s++)i.children.push(this.children[s].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let s=0;s<this.animations.length;s++){const u=this.animations[s];i.animations.push(o(e.animations,u))}}if(t){const s=a(e.geometries),u=a(e.materials),l=a(e.textures),c=a(e.images),h=a(e.shapes),f=a(e.skeletons),m=a(e.animations),g=a(e.nodes);s.length>0&&(n.geometries=s),u.length>0&&(n.materials=u),l.length>0&&(n.textures=l),c.length>0&&(n.images=c),h.length>0&&(n.shapes=h),f.length>0&&(n.skeletons=f),m.length>0&&(n.animations=m),g.length>0&&(n.nodes=g)}return n.object=i,n;function a(s){const u=[];for(const l in s){const c=s[l];delete c.metadata,u.push(c)}return u}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Hi.DEFAULT_UP=new Te(0,1,0);Hi.DEFAULT_MATRIX_AUTO_UPDATE=!0;Hi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ko=new Te,Fa=new Te,w0=new Te,Oa=new Te,Ql=new Te,ec=new Te,sk=new Te,_0=new Te,x0=new Te,S0=new Te,E0=new Hn,k0=new Hn,C0=new Hn;class Io{constructor(e=new Te,t=new Te,n=new Te){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),ko.subVectors(e,t),i.cross(ko);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,n,i,o){ko.subVectors(i,t),Fa.subVectors(n,t),w0.subVectors(e,t);const a=ko.dot(ko),s=ko.dot(Fa),u=ko.dot(w0),l=Fa.dot(Fa),c=Fa.dot(w0),h=a*l-s*s;if(h===0)return o.set(0,0,0),null;const f=1/h,m=(l*u-s*c)*f,g=(a*c-s*u)*f;return o.set(1-m-g,g,m)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,Oa)===null?!1:Oa.x>=0&&Oa.y>=0&&Oa.x+Oa.y<=1}static getInterpolation(e,t,n,i,o,a,s,u){return this.getBarycoord(e,t,n,i,Oa)===null?(u.x=0,u.y=0,"z"in u&&(u.z=0),"w"in u&&(u.w=0),null):(u.setScalar(0),u.addScaledVector(o,Oa.x),u.addScaledVector(a,Oa.y),u.addScaledVector(s,Oa.z),u)}static getInterpolatedAttribute(e,t,n,i,o,a){return E0.setScalar(0),k0.setScalar(0),C0.setScalar(0),E0.fromBufferAttribute(e,t),k0.fromBufferAttribute(e,n),C0.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(E0,o.x),a.addScaledVector(k0,o.y),a.addScaledVector(C0,o.z),a}static isFrontFacing(e,t,n,i){return ko.subVectors(n,t),Fa.subVectors(e,t),ko.cross(Fa).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return ko.subVectors(this.c,this.b),Fa.subVectors(this.a,this.b),ko.cross(Fa).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Io.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Io.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,o){return Io.getInterpolation(e,this.a,this.b,this.c,t,n,i,o)}containsPoint(e){return Io.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Io.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,o=this.c;let a,s;Ql.subVectors(i,n),ec.subVectors(o,n),_0.subVectors(e,n);const u=Ql.dot(_0),l=ec.dot(_0);if(u<=0&&l<=0)return t.copy(n);x0.subVectors(e,i);const c=Ql.dot(x0),h=ec.dot(x0);if(c>=0&&h<=c)return t.copy(i);const f=u*h-c*l;if(f<=0&&u>=0&&c<=0)return a=u/(u-c),t.copy(n).addScaledVector(Ql,a);S0.subVectors(e,o);const m=Ql.dot(S0),g=ec.dot(S0);if(g>=0&&m<=g)return t.copy(o);const w=m*l-u*g;if(w<=0&&l>=0&&g<=0)return s=l/(l-g),t.copy(n).addScaledVector(ec,s);const v=c*g-m*h;if(v<=0&&h-c>=0&&m-g>=0)return sk.subVectors(o,i),s=(h-c)/(h-c+(m-g)),t.copy(i).addScaledVector(sk,s);const y=1/(v+w+f);return a=w*y,s=f*y,t.copy(n).addScaledVector(Ql,a).addScaledVector(ec,s)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const JA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Os={h:0,s:0,l:0},Rp={h:0,s:0,l:0};function T0(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class Sn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Cn){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,gn.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=gn.workingColorSpace){return this.r=e,this.g=t,this.b=n,gn.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=gn.workingColorSpace){if(e=q1(e,1),t=sn(t,0,1),n=sn(n,0,1),t===0)this.r=this.g=this.b=n;else{const o=n<=.5?n*(1+t):n+t-n*t,a=2*n-o;this.r=T0(a,o,e+1/3),this.g=T0(a,o,e),this.b=T0(a,o,e-1/3)}return gn.colorSpaceToWorking(this,i),this}setStyle(e,t=Cn){function n(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const a=i[1],s=i[2];switch(a){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return n(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],a=o.length;if(a===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Cn){const n=JA[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=$a(e.r),this.g=$a(e.g),this.b=$a(e.b),this}copyLinearToSRGB(e){return this.r=Dc(e.r),this.g=Dc(e.g),this.b=Dc(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Cn){return gn.workingToColorSpace(Or.copy(this),e),Math.round(sn(Or.r*255,0,255))*65536+Math.round(sn(Or.g*255,0,255))*256+Math.round(sn(Or.b*255,0,255))}getHexString(e=Cn){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=gn.workingColorSpace){gn.workingToColorSpace(Or.copy(this),t);const n=Or.r,i=Or.g,o=Or.b,a=Math.max(n,i,o),s=Math.min(n,i,o);let u,l;const c=(s+a)/2;if(s===a)u=0,l=0;else{const h=a-s;switch(l=c<=.5?h/(a+s):h/(2-a-s),a){case n:u=(i-o)/h+(i<o?6:0);break;case i:u=(o-n)/h+2;break;case o:u=(n-i)/h+4;break}u/=6}return e.h=u,e.s=l,e.l=c,e}getRGB(e,t=gn.workingColorSpace){return gn.workingToColorSpace(Or.copy(this),t),e.r=Or.r,e.g=Or.g,e.b=Or.b,e}getStyle(e=Cn){gn.workingToColorSpace(Or.copy(this),e);const t=Or.r,n=Or.g,i=Or.b;return e!==Cn?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(Os),this.setHSL(Os.h+e,Os.s+t,Os.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Os),e.getHSL(Rp);const n=Jh(Os.h,Rp.h,t),i=Jh(Os.s,Rp.s,t),o=Jh(Os.l,Rp.l,t);return this.setHSL(n,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*n+o[6]*i,this.g=o[1]*t+o[4]*n+o[7]*i,this.b=o[2]*t+o[5]*n+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Or=new Sn;Sn.NAMES=JA;let UG=0;class Qc extends ss{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:UG++}),this.uuid=Zc(),this.name="",this.type="Material",this.blending=Ic,this.side=Ya,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Cb,this.blendDst=Tb,this.blendEquation=Gu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Sn(0,0,0),this.blendAlpha=0,this.depthFunc=Wc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qE,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jl,this.stencilZFail=jl,this.stencilZPass=jl,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==Ic&&(n.blending=this.blending),this.side!==Ya&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Cb&&(n.blendSrc=this.blendSrc),this.blendDst!==Tb&&(n.blendDst=this.blendDst),this.blendEquation!==Gu&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Wc&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==qE&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==jl&&(n.stencilFail=this.stencilFail),this.stencilZFail!==jl&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==jl&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(o){const a=[];for(const s in o){const u=o[s];delete u.metadata,a.push(u)}return a}if(t){const o=i(e.textures),a=i(e.images);o.length>0&&(n.textures=o),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let o=0;o!==i;++o)n[o]=t[o].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class ZA extends Qc{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Sn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Ka,this.combine=LA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Qn=new Te,Ip=new Wt;let zG=0;class oo{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:zG++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=$E,this.updateRanges=[],this.gpuType=Va,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Ip.fromBufferAttribute(this,t),Ip.applyMatrix3(e),this.setXY(t,Ip.x,Ip.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Qn.fromBufferAttribute(this,t),Qn.applyMatrix3(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Qn.fromBufferAttribute(this,t),Qn.applyMatrix4(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Qn.fromBufferAttribute(this,t),Qn.applyNormalMatrix(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Qn.fromBufferAttribute(this,t),Qn.transformDirection(e),this.setXYZ(t,Qn.x,Qn.y,Qn.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=pc(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=ei(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=pc(t,this.array)),t}setX(e,t){return this.normalized&&(t=ei(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=pc(t,this.array)),t}setY(e,t){return this.normalized&&(t=ei(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=pc(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ei(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=pc(t,this.array)),t}setW(e,t){return this.normalized&&(t=ei(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=ei(t,this.array),n=ei(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=ei(t,this.array),n=ei(n,this.array),i=ei(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,o){return e*=this.itemSize,this.normalized&&(t=ei(t,this.array),n=ei(n,this.array),i=ei(i,this.array),o=ei(o,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==$E&&(e.usage=this.usage),e}}class QA extends oo{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class eR extends oo{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class tl extends oo{constructor(e,t,n){super(new Float32Array(e),t,n)}}let WG=0;const Zi=new sr,M0=new Hi,tc=new Te,Ai=new Bd,Vh=new Bd,yr=new Te;class hu extends ss{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:WG++}),this.uuid=Zc(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(XA(e)?eR:QA)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const o=new Jt().getNormalMatrix(e);n.applyNormalMatrix(o),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Zi.makeRotationFromQuaternion(e),this.applyMatrix4(Zi),this}rotateX(e){return Zi.makeRotationX(e),this.applyMatrix4(Zi),this}rotateY(e){return Zi.makeRotationY(e),this.applyMatrix4(Zi),this}rotateZ(e){return Zi.makeRotationZ(e),this.applyMatrix4(Zi),this}translate(e,t,n){return Zi.makeTranslation(e,t,n),this.applyMatrix4(Zi),this}scale(e,t,n){return Zi.makeScale(e,t,n),this.applyMatrix4(Zi),this}lookAt(e){return M0.lookAt(e),M0.updateMatrix(),this.applyMatrix4(M0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(tc).negate(),this.translate(tc.x,tc.y,tc.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,o=e.length;i<o;i++){const a=e[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new tl(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const o=e[i];t.setXYZ(i,o.x,o.y,o.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Bd);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Te(-1/0,-1/0,-1/0),new Te(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const o=t[n];Ai.setFromBufferAttribute(o),this.morphTargetsRelative?(yr.addVectors(this.boundingBox.min,Ai.min),this.boundingBox.expandByPoint(yr),yr.addVectors(this.boundingBox.max,Ai.max),this.boundingBox.expandByPoint(yr)):(this.boundingBox.expandByPoint(Ai.min),this.boundingBox.expandByPoint(Ai.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new X1);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Te,1/0);return}if(e){const n=this.boundingSphere.center;if(Ai.setFromBufferAttribute(e),t)for(let o=0,a=t.length;o<a;o++){const s=t[o];Vh.setFromBufferAttribute(s),this.morphTargetsRelative?(yr.addVectors(Ai.min,Vh.min),Ai.expandByPoint(yr),yr.addVectors(Ai.max,Vh.max),Ai.expandByPoint(yr)):(Ai.expandByPoint(Vh.min),Ai.expandByPoint(Vh.max))}Ai.getCenter(n);let i=0;for(let o=0,a=e.count;o<a;o++)yr.fromBufferAttribute(e,o),i=Math.max(i,n.distanceToSquared(yr));if(t)for(let o=0,a=t.length;o<a;o++){const s=t[o],u=this.morphTargetsRelative;for(let l=0,c=s.count;l<c;l++)yr.fromBufferAttribute(s,l),u&&(tc.fromBufferAttribute(e,l),yr.add(tc)),i=Math.max(i,n.distanceToSquared(yr))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new oo(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),s=[],u=[];for(let I=0;I<n.count;I++)s[I]=new Te,u[I]=new Te;const l=new Te,c=new Te,h=new Te,f=new Wt,m=new Wt,g=new Wt,w=new Te,v=new Te;function y(I,T,A){l.fromBufferAttribute(n,I),c.fromBufferAttribute(n,T),h.fromBufferAttribute(n,A),f.fromBufferAttribute(o,I),m.fromBufferAttribute(o,T),g.fromBufferAttribute(o,A),c.sub(l),h.sub(l),m.sub(f),g.sub(f);const N=1/(m.x*g.y-g.x*m.y);isFinite(N)&&(w.copy(c).multiplyScalar(g.y).addScaledVector(h,-m.y).multiplyScalar(N),v.copy(h).multiplyScalar(m.x).addScaledVector(c,-g.x).multiplyScalar(N),s[I].add(w),s[T].add(w),s[A].add(w),u[I].add(v),u[T].add(v),u[A].add(v))}let x=this.groups;x.length===0&&(x=[{start:0,count:e.count}]);for(let I=0,T=x.length;I<T;++I){const A=x[I],N=A.start,O=A.count;for(let V=N,F=N+O;V<F;V+=3)y(e.getX(V+0),e.getX(V+1),e.getX(V+2))}const E=new Te,_=new Te,k=new Te,C=new Te;function R(I){k.fromBufferAttribute(i,I),C.copy(k);const T=s[I];E.copy(T),E.sub(k.multiplyScalar(k.dot(T))).normalize(),_.crossVectors(C,T);const N=_.dot(u[I])<0?-1:1;a.setXYZW(I,E.x,E.y,E.z,N)}for(let I=0,T=x.length;I<T;++I){const A=x[I],N=A.start,O=A.count;for(let V=N,F=N+O;V<F;V+=3)R(e.getX(V+0)),R(e.getX(V+1)),R(e.getX(V+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new oo(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,m=n.count;f<m;f++)n.setXYZ(f,0,0,0);const i=new Te,o=new Te,a=new Te,s=new Te,u=new Te,l=new Te,c=new Te,h=new Te;if(e)for(let f=0,m=e.count;f<m;f+=3){const g=e.getX(f+0),w=e.getX(f+1),v=e.getX(f+2);i.fromBufferAttribute(t,g),o.fromBufferAttribute(t,w),a.fromBufferAttribute(t,v),c.subVectors(a,o),h.subVectors(i,o),c.cross(h),s.fromBufferAttribute(n,g),u.fromBufferAttribute(n,w),l.fromBufferAttribute(n,v),s.add(c),u.add(c),l.add(c),n.setXYZ(g,s.x,s.y,s.z),n.setXYZ(w,u.x,u.y,u.z),n.setXYZ(v,l.x,l.y,l.z)}else for(let f=0,m=t.count;f<m;f+=3)i.fromBufferAttribute(t,f+0),o.fromBufferAttribute(t,f+1),a.fromBufferAttribute(t,f+2),c.subVectors(a,o),h.subVectors(i,o),c.cross(h),n.setXYZ(f+0,c.x,c.y,c.z),n.setXYZ(f+1,c.x,c.y,c.z),n.setXYZ(f+2,c.x,c.y,c.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)yr.fromBufferAttribute(e,t),yr.normalize(),e.setXYZ(t,yr.x,yr.y,yr.z)}toNonIndexed(){function e(s,u){const l=s.array,c=s.itemSize,h=s.normalized,f=new l.constructor(u.length*c);let m=0,g=0;for(let w=0,v=u.length;w<v;w++){s.isInterleavedBufferAttribute?m=u[w]*s.data.stride+s.offset:m=u[w]*c;for(let y=0;y<c;y++)f[g++]=l[m++]}return new oo(f,c,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new hu,n=this.index.array,i=this.attributes;for(const s in i){const u=i[s],l=e(u,n);t.setAttribute(s,l)}const o=this.morphAttributes;for(const s in o){const u=[],l=o[s];for(let c=0,h=l.length;c<h;c++){const f=l[c],m=e(f,n);u.push(m)}t.morphAttributes[s]=u}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let s=0,u=a.length;s<u;s++){const l=a[s];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const u=this.parameters;for(const l in u)u[l]!==void 0&&(e[l]=u[l]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const u in n){const l=n[u];e.data.attributes[u]=l.toJSON(e.data)}const i={};let o=!1;for(const u in this.morphAttributes){const l=this.morphAttributes[u],c=[];for(let h=0,f=l.length;h<f;h++){const m=l[h];c.push(m.toJSON(e.data))}c.length>0&&(i[u]=c,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const s=this.boundingSphere;return s!==null&&(e.data.boundingSphere=s.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const l in i){const c=i[l];this.setAttribute(l,c.clone(t))}const o=e.morphAttributes;for(const l in o){const c=[],h=o[l];for(let f=0,m=h.length;f<m;f++)c.push(h[f].clone(t));this.morphAttributes[l]=c}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let l=0,c=a.length;l<c;l++){const h=a[l];this.addGroup(h.start,h.count,h.materialIndex)}const s=e.boundingBox;s!==null&&(this.boundingBox=s.clone());const u=e.boundingSphere;return u!==null&&(this.boundingSphere=u.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const uk=new sr,Ru=new DG,Dp=new X1,lk=new Te,Np=new Te,Pp=new Te,Fp=new Te,A0=new Te,Op=new Te,ck=new Te,Lp=new Te;class Po extends Hi{constructor(e=new hu,t=new ZA){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,a=i.length;o<a;o++){const s=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[s]=o}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,o=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const s=this.morphTargetInfluences;if(o&&s){Op.set(0,0,0);for(let u=0,l=o.length;u<l;u++){const c=s[u],h=o[u];c!==0&&(A0.fromBufferAttribute(h,e),a?Op.addScaledVector(A0,c):Op.addScaledVector(A0.sub(t),c))}t.add(Op)}return t}raycast(e,t){const n=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Dp.copy(n.boundingSphere),Dp.applyMatrix4(o),Ru.copy(e.ray).recast(e.near),!(Dp.containsPoint(Ru.origin)===!1&&(Ru.intersectSphere(Dp,lk)===null||Ru.origin.distanceToSquared(lk)>(e.far-e.near)**2))&&(uk.copy(o).invert(),Ru.copy(e.ray).applyMatrix4(uk),!(n.boundingBox!==null&&Ru.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Ru)))}_computeIntersections(e,t,n){let i;const o=this.geometry,a=this.material,s=o.index,u=o.attributes.position,l=o.attributes.uv,c=o.attributes.uv1,h=o.attributes.normal,f=o.groups,m=o.drawRange;if(s!==null)if(Array.isArray(a))for(let g=0,w=f.length;g<w;g++){const v=f[g],y=a[v.materialIndex],x=Math.max(v.start,m.start),E=Math.min(s.count,Math.min(v.start+v.count,m.start+m.count));for(let _=x,k=E;_<k;_+=3){const C=s.getX(_),R=s.getX(_+1),I=s.getX(_+2);i=Bp(this,y,e,n,l,c,h,C,R,I),i&&(i.faceIndex=Math.floor(_/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),w=Math.min(s.count,m.start+m.count);for(let v=g,y=w;v<y;v+=3){const x=s.getX(v),E=s.getX(v+1),_=s.getX(v+2);i=Bp(this,a,e,n,l,c,h,x,E,_),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}else if(u!==void 0)if(Array.isArray(a))for(let g=0,w=f.length;g<w;g++){const v=f[g],y=a[v.materialIndex],x=Math.max(v.start,m.start),E=Math.min(u.count,Math.min(v.start+v.count,m.start+m.count));for(let _=x,k=E;_<k;_+=3){const C=_,R=_+1,I=_+2;i=Bp(this,y,e,n,l,c,h,C,R,I),i&&(i.faceIndex=Math.floor(_/3),i.face.materialIndex=v.materialIndex,t.push(i))}}else{const g=Math.max(0,m.start),w=Math.min(u.count,m.start+m.count);for(let v=g,y=w;v<y;v+=3){const x=v,E=v+1,_=v+2;i=Bp(this,a,e,n,l,c,h,x,E,_),i&&(i.faceIndex=Math.floor(v/3),t.push(i))}}}}function HG(r,e,t,n,i,o,a,s){let u;if(e.side===br?u=n.intersectTriangle(a,o,i,!0,s):u=n.intersectTriangle(i,o,a,e.side===Ya,s),u===null)return null;Lp.copy(s),Lp.applyMatrix4(r.matrixWorld);const l=t.ray.origin.distanceTo(Lp);return l<t.near||l>t.far?null:{distance:l,point:Lp.clone(),object:r}}function Bp(r,e,t,n,i,o,a,s,u,l){r.getVertexPosition(s,Np),r.getVertexPosition(u,Pp),r.getVertexPosition(l,Fp);const c=HG(r,e,t,n,Np,Pp,Fp,ck);if(c){const h=new Te;Io.getBarycoord(ck,Np,Pp,Fp,h),i&&(c.uv=Io.getInterpolatedAttribute(i,s,u,l,h,new Wt)),o&&(c.uv1=Io.getInterpolatedAttribute(o,s,u,l,h,new Wt)),a&&(c.normal=Io.getInterpolatedAttribute(a,s,u,l,h,new Te),c.normal.dot(n.direction)>0&&c.normal.multiplyScalar(-1));const f={a:s,b:u,c:l,normal:new Te,materialIndex:0};Io.getNormal(Np,Pp,Fp,f.normal),c.face=f,c.barycoord=h}return c}class Ud extends hu{constructor(e=1,t=1,n=1,i=1,o=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:o,depthSegments:a};const s=this;i=Math.floor(i),o=Math.floor(o),a=Math.floor(a);const u=[],l=[],c=[],h=[];let f=0,m=0;g("z","y","x",-1,-1,n,t,e,a,o,0),g("z","y","x",1,-1,n,t,-e,a,o,1),g("x","z","y",1,1,e,n,t,i,a,2),g("x","z","y",1,-1,e,n,-t,i,a,3),g("x","y","z",1,-1,e,t,n,i,o,4),g("x","y","z",-1,-1,e,t,-n,i,o,5),this.setIndex(u),this.setAttribute("position",new tl(l,3)),this.setAttribute("normal",new tl(c,3)),this.setAttribute("uv",new tl(h,2));function g(w,v,y,x,E,_,k,C,R,I,T){const A=_/R,N=k/I,O=_/2,V=k/2,F=C/2,B=R+1,U=I+1;let P=0,L=0;const H=new Te;for(let W=0;W<U;W++){const z=W*N-V;for(let q=0;q<B;q++){const re=q*A-O;H[w]=re*x,H[v]=z*E,H[y]=F,l.push(H.x,H.y,H.z),H[w]=0,H[v]=0,H[y]=C>0?1:-1,c.push(H.x,H.y,H.z),h.push(q/R),h.push(1-W/I),P+=1}}for(let W=0;W<I;W++)for(let z=0;z<R;z++){const q=f+z+B*W,re=f+z+B*(W+1),de=f+(z+1)+B*(W+1),ye=f+(z+1)+B*W;u.push(q,re,ye),u.push(re,de,ye),L+=6}s.addGroup(m,L,T),m+=L,f+=P}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Ud(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function qc(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function ti(r){const e={};for(let t=0;t<r.length;t++){const n=qc(r[t]);for(const i in n)e[i]=n[i]}return e}function GG(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function tR(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:gn.workingColorSpace}const VG={clone:qc,merge:ti};var jG=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,qG=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Xr extends Qc{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=jG,this.fragmentShader=qG,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=qc(e.uniforms),this.uniformsGroups=GG(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class nR extends Hi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new sr,this.projectionMatrix=new sr,this.projectionMatrixInverse=new sr,this.coordinateSystem=ca,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Ls=new Te,hk=new Wt,dk=new Wt;class to extends nR{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=ud*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Kh*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return ud*2*Math.atan(Math.tan(Kh*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Ls.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Ls.x,Ls.y).multiplyScalar(-e/Ls.z),Ls.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Ls.x,Ls.y).multiplyScalar(-e/Ls.z)}getViewSize(e,t){return this.getViewBounds(e,hk,dk),t.subVectors(dk,hk)}setViewOffset(e,t,n,i,o,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Kh*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,o=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const u=a.fullWidth,l=a.fullHeight;o+=a.offsetX*i/u,t-=a.offsetY*n/l,i*=a.width/u,n*=a.height/l}const s=this.filmOffset;s!==0&&(o+=e*s/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const nc=-90,rc=1;class $G extends Hi{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new to(nc,rc,e,t);i.layers=this.layers,this.add(i);const o=new to(nc,rc,e,t);o.layers=this.layers,this.add(o);const a=new to(nc,rc,e,t);a.layers=this.layers,this.add(a);const s=new to(nc,rc,e,t);s.layers=this.layers,this.add(s);const u=new to(nc,rc,e,t);u.layers=this.layers,this.add(u);const l=new to(nc,rc,e,t);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,o,a,s,u]=t;for(const l of t)this.remove(l);if(e===ca)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),s.up.set(0,1,0),s.lookAt(0,0,1),u.up.set(0,1,0),u.lookAt(0,0,-1);else if(e===$m)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),s.up.set(0,-1,0),s.lookAt(0,0,1),u.up.set(0,-1,0),u.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const l of t)this.add(l),l.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,a,s,u,l,c]=this.children,h=e.getRenderTarget(),f=e.getActiveCubeFace(),m=e.getActiveMipmapLevel(),g=e.xr.enabled;e.xr.enabled=!1;const w=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,o),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,s),e.setRenderTarget(n,3,i),e.render(t,u),e.setRenderTarget(n,4,i),e.render(t,l),n.texture.generateMipmaps=w,e.setRenderTarget(n,5,i),e.render(t,c),e.setRenderTarget(h,f,m),e.xr.enabled=g,n.texture.needsPMREMUpdate=!0}}class rR extends jr{constructor(e=[],t=Hc,n,i,o,a,s,u,l,c){super(e,t,n,i,o,a,s,u,l,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class XG extends ii{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new rR(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Ud(5,5,5),o=new Xr({name:"CubemapFromEquirect",uniforms:qc(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:br,blending:wi});o.uniforms.tEquirect.value=t;const a=new Po(i,o),s=t.minFilter;return t.minFilter===Ku&&(t.minFilter=vi),new $G(1,10,this).update(e,a),t.minFilter=s,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const o=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(o)}}class Up extends Hi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const YG={type:"move"};class R0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Up,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Up,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Te,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Te),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Up,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Te,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Te),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,o=null,a=null;const s=this._targetRay,u=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(l&&e.hand){a=!0;for(const w of e.hand.values()){const v=t.getJointPose(w,n),y=this._getHandJoint(l,w);v!==null&&(y.matrix.fromArray(v.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.matrixWorldNeedsUpdate=!0,y.jointRadius=v.radius),y.visible=v!==null}const c=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],f=c.position.distanceTo(h.position),m=.02,g=.005;l.inputState.pinching&&f>m+g?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&f<=m-g&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else u!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,n),o!==null&&(u.matrix.fromArray(o.transform.matrix),u.matrix.decompose(u.position,u.rotation,u.scale),u.matrixWorldNeedsUpdate=!0,o.linearVelocity?(u.hasLinearVelocity=!0,u.linearVelocity.copy(o.linearVelocity)):u.hasLinearVelocity=!1,o.angularVelocity?(u.hasAngularVelocity=!0,u.angularVelocity.copy(o.angularVelocity)):u.hasAngularVelocity=!1));s!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&o!==null&&(i=o),i!==null&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,i.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(i.linearVelocity)):s.hasLinearVelocity=!1,i.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(i.angularVelocity)):s.hasAngularVelocity=!1,this.dispatchEvent(YG)))}return s!==null&&(s.visible=i!==null),u!==null&&(u.visible=o!==null),l!==null&&(l.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new Up;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class dw extends Hi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Ka,this.environmentIntensity=1,this.environmentRotation=new Ka,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}const I0=new Te,KG=new Te,JG=new Jt;class Uu{constructor(e=new Te(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=I0.subVectors(n,t).cross(KG.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(I0),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(n,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||JG.getNormalMatrix(e),i=this.coplanarPoint(I0).applyMatrix4(e),o=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Iu=new X1,ZG=new Wt(.5,.5),zp=new Te;class iR{constructor(e=new Uu,t=new Uu,n=new Uu,i=new Uu,o=new Uu,a=new Uu){this.planes=[e,t,n,i,o,a]}set(e,t,n,i,o,a){const s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(n),s[3].copy(i),s[4].copy(o),s[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=ca,n=!1){const i=this.planes,o=e.elements,a=o[0],s=o[1],u=o[2],l=o[3],c=o[4],h=o[5],f=o[6],m=o[7],g=o[8],w=o[9],v=o[10],y=o[11],x=o[12],E=o[13],_=o[14],k=o[15];if(i[0].setComponents(l-a,m-c,y-g,k-x).normalize(),i[1].setComponents(l+a,m+c,y+g,k+x).normalize(),i[2].setComponents(l+s,m+h,y+w,k+E).normalize(),i[3].setComponents(l-s,m-h,y-w,k-E).normalize(),n)i[4].setComponents(u,f,v,_).normalize(),i[5].setComponents(l-u,m-f,y-v,k-_).normalize();else if(i[4].setComponents(l-u,m-f,y-v,k-_).normalize(),t===ca)i[5].setComponents(l+u,m+f,y+v,k+_).normalize();else if(t===$m)i[5].setComponents(u,f,v,_).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Iu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Iu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Iu)}intersectsSprite(e){Iu.center.set(0,0,0);const t=ZG.distanceTo(e.center);return Iu.radius=.7071067811865476+t,Iu.applyMatrix4(e.matrixWorld),this.intersectsSphere(Iu)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(zp.x=i.normal.x>0?e.max.x:e.min.x,zp.y=i.normal.y>0?e.max.y:e.min.y,zp.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(zp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class Y1 extends jr{constructor(e,t,n=nu,i,o,a,s=Uo,u=Uo,l,c=sd,h=1){if(c!==sd&&c!==jc)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:h};super(f,i,o,a,s,u,c,n,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new $1(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class oR extends jr{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class zd extends hu{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const o=e/2,a=t/2,s=Math.floor(n),u=Math.floor(i),l=s+1,c=u+1,h=e/s,f=t/u,m=[],g=[],w=[],v=[];for(let y=0;y<c;y++){const x=y*f-a;for(let E=0;E<l;E++){const _=E*h-o;g.push(_,-x,0),w.push(0,0,1),v.push(E/s),v.push(1-y/u)}}for(let y=0;y<u;y++)for(let x=0;x<s;x++){const E=x+l*y,_=x+l*(y+1),k=x+1+l*(y+1),C=x+1+l*y;m.push(E,_,C),m.push(_,k,C)}this.setIndex(m),this.setAttribute("position",new tl(g,3)),this.setAttribute("normal",new tl(w,3)),this.setAttribute("uv",new tl(v,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new zd(e.width,e.height,e.widthSegments,e.heightSegments)}}class QG extends Qc{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Od,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class eV extends Qc{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class K1 extends nR{constructor(e=-1,t=1,n=1,i=-1,o=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=o,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,o,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=o,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=n-e,a=n+e,s=i+t,u=i-t;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=l*this.view.offsetX,a=o+l*this.view.width,s-=c*this.view.offsetY,u=s-c*this.view.height}this.projectionMatrix.makeOrthographic(o,a,s,u,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class tV extends to{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class fn{constructor(e){this.value=e}clone(){return new fn(this.value.clone===void 0?this.value:this.value.clone())}}function fk(r,e,t,n){const i=nV(n);switch(t){case GA:return r*e;case jA:return r*e/i.components*i.byteLength;case G1:return r*e/i.components*i.byteLength;case qA:return r*e*2/i.components*i.byteLength;case V1:return r*e*2/i.components*i.byteLength;case VA:return r*e*3/i.components*i.byteLength;case No:return r*e*4/i.components*i.byteLength;case j1:return r*e*4/i.components*i.byteLength;case Qp:case em:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case tm:case nm:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case Ub:case Wb:return Math.max(r,16)*Math.max(e,8)/4;case Bb:case zb:return Math.max(r,8)*Math.max(e,8)/2;case Hb:case Gb:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Vb:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case jb:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case qb:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case $b:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case Xb:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case Yb:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case Kb:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case Jb:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case Zb:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case Qb:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case ew:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case tw:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case nw:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case rw:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case iw:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case ow:case aw:case sw:return Math.ceil(r/4)*Math.ceil(e/4)*16;case uw:case lw:return Math.ceil(r/4)*Math.ceil(e/4)*8;case cw:case hw:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function nV(r){switch(r){case $r:case UA:return{byteLength:1,components:1};case ad:case zA:case Fd:return{byteLength:2,components:1};case W1:case H1:return{byteLength:2,components:4};case nu:case z1:case Va:return{byteLength:4,components:1};case WA:case HA:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Pd}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Pd);function aR(){let r=null,e=!1,t=null,n=null;function i(o,a){t(o,a),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){r=o}}}function rV(r){const e=new WeakMap;function t(s,u){const l=s.array,c=s.usage,h=l.byteLength,f=r.createBuffer();r.bindBuffer(u,f),r.bufferData(u,l,c),s.onUploadCallback();let m;if(l instanceof Float32Array)m=r.FLOAT;else if(typeof Float16Array<"u"&&l instanceof Float16Array)m=r.HALF_FLOAT;else if(l instanceof Uint16Array)s.isFloat16BufferAttribute?m=r.HALF_FLOAT:m=r.UNSIGNED_SHORT;else if(l instanceof Int16Array)m=r.SHORT;else if(l instanceof Uint32Array)m=r.UNSIGNED_INT;else if(l instanceof Int32Array)m=r.INT;else if(l instanceof Int8Array)m=r.BYTE;else if(l instanceof Uint8Array)m=r.UNSIGNED_BYTE;else if(l instanceof Uint8ClampedArray)m=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+l);return{buffer:f,type:m,bytesPerElement:l.BYTES_PER_ELEMENT,version:s.version,size:h}}function n(s,u,l){const c=u.array,h=u.updateRanges;if(r.bindBuffer(l,s),h.length===0)r.bufferSubData(l,0,c);else{h.sort((m,g)=>m.start-g.start);let f=0;for(let m=1;m<h.length;m++){const g=h[f],w=h[m];w.start<=g.start+g.count+1?g.count=Math.max(g.count,w.start+w.count-g.start):(++f,h[f]=w)}h.length=f+1;for(let m=0,g=h.length;m<g;m++){const w=h[m];r.bufferSubData(l,w.start*c.BYTES_PER_ELEMENT,c,w.start,w.count)}u.clearUpdateRanges()}u.onUploadCallback()}function i(s){return s.isInterleavedBufferAttribute&&(s=s.data),e.get(s)}function o(s){s.isInterleavedBufferAttribute&&(s=s.data);const u=e.get(s);u&&(r.deleteBuffer(u.buffer),e.delete(s))}function a(s,u){if(s.isInterleavedBufferAttribute&&(s=s.data),s.isGLBufferAttribute){const c=e.get(s);(!c||c.version<s.version)&&e.set(s,{buffer:s.buffer,type:s.type,bytesPerElement:s.elementSize,version:s.version});return}const l=e.get(s);if(l===void 0)e.set(s,t(s,u));else if(l.version<s.version){if(l.size!==s.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(l.buffer,s,u),l.version=s.version}}return{get:i,remove:o,update:a}}var iV=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,oV=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,aV=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,sV=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,uV=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,lV=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,cV=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,hV=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,dV=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,fV=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,pV=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,mV=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,gV=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,vV=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,yV=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,bV=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,wV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,_V=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,xV=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,SV=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,EV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,kV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,CV=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,TV=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,MV=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,AV=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,RV=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,IV=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,DV=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,NV=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,PV="gl_FragColor = linearToOutputTexel( gl_FragColor );",FV=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,OV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,LV=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,BV=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,UV=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,zV=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,WV=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,HV=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,GV=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,VV=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,jV=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,qV=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,$V=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,XV=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,YV=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,KV=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,JV=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,ZV=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,QV=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,ej=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,tj=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,nj=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,rj=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,ij=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,oj=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,aj=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,sj=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,uj=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,lj=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,cj=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,hj=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,dj=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,fj=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,pj=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,mj=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,gj=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,vj=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,yj=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,bj=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,wj=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,_j=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,xj=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Sj=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Ej=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,kj=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Cj=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,Tj=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Mj=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Aj=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Rj=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Ij=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Dj=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Nj=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Pj=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Fj=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Oj=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,Lj=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,Bj=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,Uj=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		float depth = unpackRGBAToDepth( texture2D( depths, uv ) );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			return step( depth, compare );
		#else
			return step( compare, depth );
		#endif
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow( sampler2D shadow, vec2 uv, float compare ) {
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		#ifdef USE_REVERSED_DEPTH_BUFFER
			float hard_shadow = step( distribution.x, compare );
		#else
			float hard_shadow = step( compare, distribution.x );
		#endif
		if ( hard_shadow != 1.0 ) {
			float distance = compare - distribution.x;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,zj=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,Wj=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,Hj=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,Gj=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,Vj=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,jj=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,qj=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,$j=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,Xj=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,Yj=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,Kj=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,Jj=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,Zj=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,Qj=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,eq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,tq=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,nq=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const rq=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,iq=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,oq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,aq=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,sq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,uq=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,lq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,cq=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,hq=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,dq=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,fq=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,pq=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mq=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,gq=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,vq=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,yq=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,bq=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wq=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_q=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,xq=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Sq=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,Eq=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,kq=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Cq=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Tq=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Mq=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Aq=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Rq=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Iq=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,Dq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,Nq=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,Pq=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Fq=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Oq=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Qt={alphahash_fragment:iV,alphahash_pars_fragment:oV,alphamap_fragment:aV,alphamap_pars_fragment:sV,alphatest_fragment:uV,alphatest_pars_fragment:lV,aomap_fragment:cV,aomap_pars_fragment:hV,batching_pars_vertex:dV,batching_vertex:fV,begin_vertex:pV,beginnormal_vertex:mV,bsdfs:gV,iridescence_fragment:vV,bumpmap_pars_fragment:yV,clipping_planes_fragment:bV,clipping_planes_pars_fragment:wV,clipping_planes_pars_vertex:_V,clipping_planes_vertex:xV,color_fragment:SV,color_pars_fragment:EV,color_pars_vertex:kV,color_vertex:CV,common:TV,cube_uv_reflection_fragment:MV,defaultnormal_vertex:AV,displacementmap_pars_vertex:RV,displacementmap_vertex:IV,emissivemap_fragment:DV,emissivemap_pars_fragment:NV,colorspace_fragment:PV,colorspace_pars_fragment:FV,envmap_fragment:OV,envmap_common_pars_fragment:LV,envmap_pars_fragment:BV,envmap_pars_vertex:UV,envmap_physical_pars_fragment:KV,envmap_vertex:zV,fog_vertex:WV,fog_pars_vertex:HV,fog_fragment:GV,fog_pars_fragment:VV,gradientmap_pars_fragment:jV,lightmap_pars_fragment:qV,lights_lambert_fragment:$V,lights_lambert_pars_fragment:XV,lights_pars_begin:YV,lights_toon_fragment:JV,lights_toon_pars_fragment:ZV,lights_phong_fragment:QV,lights_phong_pars_fragment:ej,lights_physical_fragment:tj,lights_physical_pars_fragment:nj,lights_fragment_begin:rj,lights_fragment_maps:ij,lights_fragment_end:oj,logdepthbuf_fragment:aj,logdepthbuf_pars_fragment:sj,logdepthbuf_pars_vertex:uj,logdepthbuf_vertex:lj,map_fragment:cj,map_pars_fragment:hj,map_particle_fragment:dj,map_particle_pars_fragment:fj,metalnessmap_fragment:pj,metalnessmap_pars_fragment:mj,morphinstance_vertex:gj,morphcolor_vertex:vj,morphnormal_vertex:yj,morphtarget_pars_vertex:bj,morphtarget_vertex:wj,normal_fragment_begin:_j,normal_fragment_maps:xj,normal_pars_fragment:Sj,normal_pars_vertex:Ej,normal_vertex:kj,normalmap_pars_fragment:Cj,clearcoat_normal_fragment_begin:Tj,clearcoat_normal_fragment_maps:Mj,clearcoat_pars_fragment:Aj,iridescence_pars_fragment:Rj,opaque_fragment:Ij,packing:Dj,premultiplied_alpha_fragment:Nj,project_vertex:Pj,dithering_fragment:Fj,dithering_pars_fragment:Oj,roughnessmap_fragment:Lj,roughnessmap_pars_fragment:Bj,shadowmap_pars_fragment:Uj,shadowmap_pars_vertex:zj,shadowmap_vertex:Wj,shadowmask_pars_fragment:Hj,skinbase_vertex:Gj,skinning_pars_vertex:Vj,skinning_vertex:jj,skinnormal_vertex:qj,specularmap_fragment:$j,specularmap_pars_fragment:Xj,tonemapping_fragment:Yj,tonemapping_pars_fragment:Kj,transmission_fragment:Jj,transmission_pars_fragment:Zj,uv_pars_fragment:Qj,uv_pars_vertex:eq,uv_vertex:tq,worldpos_vertex:nq,background_vert:rq,background_frag:iq,backgroundCube_vert:oq,backgroundCube_frag:aq,cube_vert:sq,cube_frag:uq,depth_vert:lq,depth_frag:cq,distanceRGBA_vert:hq,distanceRGBA_frag:dq,equirect_vert:fq,equirect_frag:pq,linedashed_vert:mq,linedashed_frag:gq,meshbasic_vert:vq,meshbasic_frag:yq,meshlambert_vert:bq,meshlambert_frag:wq,meshmatcap_vert:_q,meshmatcap_frag:xq,meshnormal_vert:Sq,meshnormal_frag:Eq,meshphong_vert:kq,meshphong_frag:Cq,meshphysical_vert:Tq,meshphysical_frag:Mq,meshtoon_vert:Aq,meshtoon_frag:Rq,points_vert:Iq,points_frag:Dq,shadow_vert:Nq,shadow_frag:Pq,sprite_vert:Fq,sprite_frag:Oq},ut={common:{diffuse:{value:new Sn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Jt},alphaMap:{value:null},alphaMapTransform:{value:new Jt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Jt}},envmap:{envMap:{value:null},envMapRotation:{value:new Jt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Jt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Jt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Jt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Jt},normalScale:{value:new Wt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Jt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Jt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Jt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Jt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Sn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Sn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Jt},alphaTest:{value:0},uvTransform:{value:new Jt}},sprite:{diffuse:{value:new Sn(16777215)},opacity:{value:1},center:{value:new Wt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Jt},alphaMap:{value:null},alphaMapTransform:{value:new Jt},alphaTest:{value:0}}},ia={basic:{uniforms:ti([ut.common,ut.specularmap,ut.envmap,ut.aomap,ut.lightmap,ut.fog]),vertexShader:Qt.meshbasic_vert,fragmentShader:Qt.meshbasic_frag},lambert:{uniforms:ti([ut.common,ut.specularmap,ut.envmap,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)}}]),vertexShader:Qt.meshlambert_vert,fragmentShader:Qt.meshlambert_frag},phong:{uniforms:ti([ut.common,ut.specularmap,ut.envmap,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)},specular:{value:new Sn(1118481)},shininess:{value:30}}]),vertexShader:Qt.meshphong_vert,fragmentShader:Qt.meshphong_frag},standard:{uniforms:ti([ut.common,ut.envmap,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.roughnessmap,ut.metalnessmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag},toon:{uniforms:ti([ut.common,ut.aomap,ut.lightmap,ut.emissivemap,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.gradientmap,ut.fog,ut.lights,{emissive:{value:new Sn(0)}}]),vertexShader:Qt.meshtoon_vert,fragmentShader:Qt.meshtoon_frag},matcap:{uniforms:ti([ut.common,ut.bumpmap,ut.normalmap,ut.displacementmap,ut.fog,{matcap:{value:null}}]),vertexShader:Qt.meshmatcap_vert,fragmentShader:Qt.meshmatcap_frag},points:{uniforms:ti([ut.points,ut.fog]),vertexShader:Qt.points_vert,fragmentShader:Qt.points_frag},dashed:{uniforms:ti([ut.common,ut.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Qt.linedashed_vert,fragmentShader:Qt.linedashed_frag},depth:{uniforms:ti([ut.common,ut.displacementmap]),vertexShader:Qt.depth_vert,fragmentShader:Qt.depth_frag},normal:{uniforms:ti([ut.common,ut.bumpmap,ut.normalmap,ut.displacementmap,{opacity:{value:1}}]),vertexShader:Qt.meshnormal_vert,fragmentShader:Qt.meshnormal_frag},sprite:{uniforms:ti([ut.sprite,ut.fog]),vertexShader:Qt.sprite_vert,fragmentShader:Qt.sprite_frag},background:{uniforms:{uvTransform:{value:new Jt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Qt.background_vert,fragmentShader:Qt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Jt}},vertexShader:Qt.backgroundCube_vert,fragmentShader:Qt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Qt.cube_vert,fragmentShader:Qt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Qt.equirect_vert,fragmentShader:Qt.equirect_frag},distanceRGBA:{uniforms:ti([ut.common,ut.displacementmap,{referencePosition:{value:new Te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Qt.distanceRGBA_vert,fragmentShader:Qt.distanceRGBA_frag},shadow:{uniforms:ti([ut.lights,ut.fog,{color:{value:new Sn(0)},opacity:{value:1}}]),vertexShader:Qt.shadow_vert,fragmentShader:Qt.shadow_frag}};ia.physical={uniforms:ti([ia.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Jt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Jt},clearcoatNormalScale:{value:new Wt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Jt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Jt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Jt},sheen:{value:0},sheenColor:{value:new Sn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Jt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Jt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Jt},transmissionSamplerSize:{value:new Wt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Jt},attenuationDistance:{value:0},attenuationColor:{value:new Sn(0)},specularColor:{value:new Sn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Jt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Jt},anisotropyVector:{value:new Wt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Jt}}]),vertexShader:Qt.meshphysical_vert,fragmentShader:Qt.meshphysical_frag};const Wp={r:0,b:0,g:0},Du=new Ka,Lq=new sr;function Bq(r,e,t,n,i,o,a){const s=new Sn(0);let u=o===!0?0:1,l,c,h=null,f=0,m=null;function g(E){let _=E.isScene===!0?E.background:null;return _&&_.isTexture&&(_=(E.backgroundBlurriness>0?t:e).get(_)),_}function w(E){let _=!1;const k=g(E);k===null?y(s,u):k&&k.isColor&&(y(k,1),_=!0);const C=r.xr.getEnvironmentBlendMode();C==="additive"?n.buffers.color.setClear(0,0,0,1,a):C==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(r.autoClear||_)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function v(E,_){const k=g(_);k&&(k.isCubeTexture||k.mapping===_g)?(c===void 0&&(c=new Po(new Ud(1,1,1),new Xr({name:"BackgroundCubeMaterial",uniforms:qc(ia.backgroundCube.uniforms),vertexShader:ia.backgroundCube.vertexShader,fragmentShader:ia.backgroundCube.fragmentShader,side:br,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),c.geometry.deleteAttribute("normal"),c.geometry.deleteAttribute("uv"),c.onBeforeRender=function(C,R,I){this.matrixWorld.copyPosition(I.matrixWorld)},Object.defineProperty(c.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(c)),Du.copy(_.backgroundRotation),Du.x*=-1,Du.y*=-1,Du.z*=-1,k.isCubeTexture&&k.isRenderTargetTexture===!1&&(Du.y*=-1,Du.z*=-1),c.material.uniforms.envMap.value=k,c.material.uniforms.flipEnvMap.value=k.isCubeTexture&&k.isRenderTargetTexture===!1?-1:1,c.material.uniforms.backgroundBlurriness.value=_.backgroundBlurriness,c.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,c.material.uniforms.backgroundRotation.value.setFromMatrix4(Lq.makeRotationFromEuler(Du)),c.material.toneMapped=gn.getTransfer(k.colorSpace)!==Mn,(h!==k||f!==k.version||m!==r.toneMapping)&&(c.material.needsUpdate=!0,h=k,f=k.version,m=r.toneMapping),c.layers.enableAll(),E.unshift(c,c.geometry,c.material,0,0,null)):k&&k.isTexture&&(l===void 0&&(l=new Po(new zd(2,2),new Xr({name:"BackgroundMaterial",uniforms:qc(ia.background.uniforms),vertexShader:ia.background.vertexShader,fragmentShader:ia.background.fragmentShader,side:Ya,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(l)),l.material.uniforms.t2D.value=k,l.material.uniforms.backgroundIntensity.value=_.backgroundIntensity,l.material.toneMapped=gn.getTransfer(k.colorSpace)!==Mn,k.matrixAutoUpdate===!0&&k.updateMatrix(),l.material.uniforms.uvTransform.value.copy(k.matrix),(h!==k||f!==k.version||m!==r.toneMapping)&&(l.material.needsUpdate=!0,h=k,f=k.version,m=r.toneMapping),l.layers.enableAll(),E.unshift(l,l.geometry,l.material,0,0,null))}function y(E,_){E.getRGB(Wp,tR(r)),n.buffers.color.setClear(Wp.r,Wp.g,Wp.b,_,a)}function x(){c!==void 0&&(c.geometry.dispose(),c.material.dispose(),c=void 0),l!==void 0&&(l.geometry.dispose(),l.material.dispose(),l=void 0)}return{getClearColor:function(){return s},setClearColor:function(E,_=1){s.set(E),u=_,y(s,u)},getClearAlpha:function(){return u},setClearAlpha:function(E){u=E,y(s,u)},render:w,addToRenderList:v,dispose:x}}function Uq(r,e){const t=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=f(null);let o=i,a=!1;function s(A,N,O,V,F){let B=!1;const U=h(V,O,N);o!==U&&(o=U,l(o.object)),B=m(A,V,O,F),B&&g(A,V,O,F),F!==null&&e.update(F,r.ELEMENT_ARRAY_BUFFER),(B||a)&&(a=!1,_(A,N,O,V),F!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(F).buffer))}function u(){return r.createVertexArray()}function l(A){return r.bindVertexArray(A)}function c(A){return r.deleteVertexArray(A)}function h(A,N,O){const V=O.wireframe===!0;let F=n[A.id];F===void 0&&(F={},n[A.id]=F);let B=F[N.id];B===void 0&&(B={},F[N.id]=B);let U=B[V];return U===void 0&&(U=f(u()),B[V]=U),U}function f(A){const N=[],O=[],V=[];for(let F=0;F<t;F++)N[F]=0,O[F]=0,V[F]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:N,enabledAttributes:O,attributeDivisors:V,object:A,attributes:{},index:null}}function m(A,N,O,V){const F=o.attributes,B=N.attributes;let U=0;const P=O.getAttributes();for(const L in P)if(P[L].location>=0){const W=F[L];let z=B[L];if(z===void 0&&(L==="instanceMatrix"&&A.instanceMatrix&&(z=A.instanceMatrix),L==="instanceColor"&&A.instanceColor&&(z=A.instanceColor)),W===void 0||W.attribute!==z||z&&W.data!==z.data)return!0;U++}return o.attributesNum!==U||o.index!==V}function g(A,N,O,V){const F={},B=N.attributes;let U=0;const P=O.getAttributes();for(const L in P)if(P[L].location>=0){let W=B[L];W===void 0&&(L==="instanceMatrix"&&A.instanceMatrix&&(W=A.instanceMatrix),L==="instanceColor"&&A.instanceColor&&(W=A.instanceColor));const z={};z.attribute=W,W&&W.data&&(z.data=W.data),F[L]=z,U++}o.attributes=F,o.attributesNum=U,o.index=V}function w(){const A=o.newAttributes;for(let N=0,O=A.length;N<O;N++)A[N]=0}function v(A){y(A,0)}function y(A,N){const O=o.newAttributes,V=o.enabledAttributes,F=o.attributeDivisors;O[A]=1,V[A]===0&&(r.enableVertexAttribArray(A),V[A]=1),F[A]!==N&&(r.vertexAttribDivisor(A,N),F[A]=N)}function x(){const A=o.newAttributes,N=o.enabledAttributes;for(let O=0,V=N.length;O<V;O++)N[O]!==A[O]&&(r.disableVertexAttribArray(O),N[O]=0)}function E(A,N,O,V,F,B,U){U===!0?r.vertexAttribIPointer(A,N,O,F,B):r.vertexAttribPointer(A,N,O,V,F,B)}function _(A,N,O,V){w();const F=V.attributes,B=O.getAttributes(),U=N.defaultAttributeValues;for(const P in B){const L=B[P];if(L.location>=0){let H=F[P];if(H===void 0&&(P==="instanceMatrix"&&A.instanceMatrix&&(H=A.instanceMatrix),P==="instanceColor"&&A.instanceColor&&(H=A.instanceColor)),H!==void 0){const W=H.normalized,z=H.itemSize,q=e.get(H);if(q===void 0)continue;const re=q.buffer,de=q.type,ye=q.bytesPerElement,ne=de===r.INT||de===r.UNSIGNED_INT||H.gpuType===z1;if(H.isInterleavedBufferAttribute){const ie=H.data,fe=ie.stride,Ae=H.offset;if(ie.isInstancedInterleavedBuffer){for(let De=0;De<L.locationSize;De++)y(L.location+De,ie.meshPerAttribute);A.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=ie.meshPerAttribute*ie.count)}else for(let De=0;De<L.locationSize;De++)v(L.location+De);r.bindBuffer(r.ARRAY_BUFFER,re);for(let De=0;De<L.locationSize;De++)E(L.location+De,z/L.locationSize,de,W,fe*ye,(Ae+z/L.locationSize*De)*ye,ne)}else{if(H.isInstancedBufferAttribute){for(let ie=0;ie<L.locationSize;ie++)y(L.location+ie,H.meshPerAttribute);A.isInstancedMesh!==!0&&V._maxInstanceCount===void 0&&(V._maxInstanceCount=H.meshPerAttribute*H.count)}else for(let ie=0;ie<L.locationSize;ie++)v(L.location+ie);r.bindBuffer(r.ARRAY_BUFFER,re);for(let ie=0;ie<L.locationSize;ie++)E(L.location+ie,z/L.locationSize,de,W,z*ye,z/L.locationSize*ie*ye,ne)}}else if(U!==void 0){const W=U[P];if(W!==void 0)switch(W.length){case 2:r.vertexAttrib2fv(L.location,W);break;case 3:r.vertexAttrib3fv(L.location,W);break;case 4:r.vertexAttrib4fv(L.location,W);break;default:r.vertexAttrib1fv(L.location,W)}}}}x()}function k(){I();for(const A in n){const N=n[A];for(const O in N){const V=N[O];for(const F in V)c(V[F].object),delete V[F];delete N[O]}delete n[A]}}function C(A){if(n[A.id]===void 0)return;const N=n[A.id];for(const O in N){const V=N[O];for(const F in V)c(V[F].object),delete V[F];delete N[O]}delete n[A.id]}function R(A){for(const N in n){const O=n[N];if(O[A.id]===void 0)continue;const V=O[A.id];for(const F in V)c(V[F].object),delete V[F];delete O[A.id]}}function I(){T(),a=!0,o!==i&&(o=i,l(o.object))}function T(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:s,reset:I,resetDefaultState:T,dispose:k,releaseStatesOfGeometry:C,releaseStatesOfProgram:R,initAttributes:w,enableAttribute:v,disableUnusedAttributes:x}}function zq(r,e,t){let n;function i(l){n=l}function o(l,c){r.drawArrays(n,l,c),t.update(c,n,1)}function a(l,c,h){h!==0&&(r.drawArraysInstanced(n,l,c,h),t.update(c,n,h))}function s(l,c,h){if(h===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,l,0,c,0,h);let m=0;for(let g=0;g<h;g++)m+=c[g];t.update(m,n,1)}function u(l,c,h,f){if(h===0)return;const m=e.get("WEBGL_multi_draw");if(m===null)for(let g=0;g<l.length;g++)a(l[g],c[g],f[g]);else{m.multiDrawArraysInstancedWEBGL(n,l,0,c,0,f,0,h);let g=0;for(let w=0;w<h;w++)g+=c[w]*f[w];t.update(g,n,1)}}this.setMode=i,this.render=o,this.renderInstances=a,this.renderMultiDraw=s,this.renderMultiDrawInstances=u}function Wq(r,e,t,n){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const R=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(R.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(R){return!(R!==No&&n.convert(R)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function s(R){const I=R===Fd&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(R!==$r&&n.convert(R)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&R!==Va&&!I)}function u(R){if(R==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";R="mediump"}return R==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let l=t.precision!==void 0?t.precision:"highp";const c=u(l);c!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",c,"instead."),l=c);const h=t.logarithmicDepthBuffer===!0,f=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),m=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),g=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),w=r.getParameter(r.MAX_TEXTURE_SIZE),v=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),y=r.getParameter(r.MAX_VERTEX_ATTRIBS),x=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),E=r.getParameter(r.MAX_VARYING_VECTORS),_=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),k=g>0,C=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:u,textureFormatReadable:a,textureTypeReadable:s,precision:l,logarithmicDepthBuffer:h,reversedDepthBuffer:f,maxTextures:m,maxVertexTextures:g,maxTextureSize:w,maxCubemapSize:v,maxAttributes:y,maxVertexUniforms:x,maxVaryings:E,maxFragmentUniforms:_,vertexTextures:k,maxSamples:C}}function Hq(r){const e=this;let t=null,n=0,i=!1,o=!1;const a=new Uu,s=new Jt,u={value:null,needsUpdate:!1};this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(h,f){const m=h.length!==0||f||n!==0||i;return i=f,n=h.length,m},this.beginShadows=function(){o=!0,c(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(h,f){t=c(h,f,0)},this.setState=function(h,f,m){const g=h.clippingPlanes,w=h.clipIntersection,v=h.clipShadows,y=r.get(h);if(!i||g===null||g.length===0||o&&!v)o?c(null):l();else{const x=o?0:n,E=x*4;let _=y.clippingState||null;u.value=_,_=c(g,f,E,m);for(let k=0;k!==E;++k)_[k]=t[k];y.clippingState=_,this.numIntersection=w?this.numPlanes:0,this.numPlanes+=x}};function l(){u.value!==t&&(u.value=t,u.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function c(h,f,m,g){const w=h!==null?h.length:0;let v=null;if(w!==0){if(v=u.value,g!==!0||v===null){const y=m+w*4,x=f.matrixWorldInverse;s.getNormalMatrix(x),(v===null||v.length<y)&&(v=new Float32Array(y));for(let E=0,_=m;E!==w;++E,_+=4)a.copy(h[E]).applyMatrix4(x,s),a.normal.toArray(v,_),v[_+3]=a.constant}u.value=v,u.needsUpdate=!0}return e.numPlanes=w,e.numIntersection=0,v}}function Gq(r){let e=new WeakMap;function t(a,s){return s===Pb?a.mapping=Hc:s===Fb&&(a.mapping=Gc),a}function n(a){if(a&&a.isTexture){const s=a.mapping;if(s===Pb||s===Fb)if(e.has(a)){const u=e.get(a).texture;return t(u,a.mapping)}else{const u=a.image;if(u&&u.height>0){const l=new XG(u.height);return l.fromEquirectangularTexture(r,a),e.set(a,l),a.addEventListener("dispose",i),t(l.texture,a.mapping)}else return null}}return a}function i(a){const s=a.target;s.removeEventListener("dispose",i);const u=e.get(s);u!==void 0&&(e.delete(s),u.dispose())}function o(){e=new WeakMap}return{get:n,dispose:o}}const gc=4,pk=[.125,.215,.35,.446,.526,.582],Vu=20,D0=new K1,mk=new Sn;let N0=null,P0=0,F0=0,O0=!1;const zu=(1+Math.sqrt(5))/2,ic=1/zu,gk=[new Te(-zu,ic,0),new Te(zu,ic,0),new Te(-ic,0,zu),new Te(ic,0,zu),new Te(0,zu,-ic),new Te(0,zu,ic),new Te(-1,1,-1),new Te(1,1,-1),new Te(-1,1,1),new Te(1,1,1)],Vq=new Te;class vk{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100,o={}){const{size:a=256,position:s=Vq}=o;N0=this._renderer.getRenderTarget(),P0=this._renderer.getActiveCubeFace(),F0=this._renderer.getActiveMipmapLevel(),O0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const u=this._allocateTargets();return u.depthBuffer=!0,this._sceneToCubeUV(e,n,i,u,s),t>0&&this._blur(u,0,0,t),this._applyPMREM(u),this._cleanup(u),u}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wk(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bk(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(N0,P0,F0),this._renderer.xr.enabled=O0,e.scissorTest=!1,Hp(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Hc||e.mapping===Gc?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),N0=this._renderer.getRenderTarget(),P0=this._renderer.getActiveCubeFace(),F0=this._renderer.getActiveMipmapLevel(),O0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:vi,minFilter:vi,generateMipmaps:!1,type:Fd,format:No,colorSpace:ru,depthBuffer:!1},i=yk(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=yk(e,t,n);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=jq(o)),this._blurMaterial=qq(o,e,t)}return i}_compileMaterial(e){const t=new Po(this._lodPlanes[0],e);this._renderer.compile(t,D0)}_sceneToCubeUV(e,t,n,i,o){const u=new to(90,1,t,n),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],h=this._renderer,f=h.autoClear,m=h.toneMapping;h.getClearColor(mk),h.toneMapping=qa,h.autoClear=!1,h.state.buffers.depth.getReversed()&&(h.setRenderTarget(i),h.clearDepth(),h.setRenderTarget(null));const w=new ZA({name:"PMREM.Background",side:br,depthWrite:!1,depthTest:!1}),v=new Po(new Ud,w);let y=!1;const x=e.background;x?x.isColor&&(w.color.copy(x),e.background=null,y=!0):(w.color.copy(mk),y=!0);for(let E=0;E<6;E++){const _=E%3;_===0?(u.up.set(0,l[E],0),u.position.set(o.x,o.y,o.z),u.lookAt(o.x+c[E],o.y,o.z)):_===1?(u.up.set(0,0,l[E]),u.position.set(o.x,o.y,o.z),u.lookAt(o.x,o.y+c[E],o.z)):(u.up.set(0,l[E],0),u.position.set(o.x,o.y,o.z),u.lookAt(o.x,o.y,o.z+c[E]));const k=this._cubeSize;Hp(i,_*k,E>2?k:0,k,k),h.setRenderTarget(i),y&&h.render(v,u),h.render(e,u)}v.geometry.dispose(),v.material.dispose(),h.toneMapping=m,h.autoClear=f,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Hc||e.mapping===Gc;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=wk()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=bk());const o=i?this._cubemapMaterial:this._equirectMaterial,a=new Po(this._lodPlanes[0],o),s=o.uniforms;s.envMap.value=e;const u=this._cubeSize;Hp(t,0,0,3*u,2*u),n.setRenderTarget(t),n.render(a,D0)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let o=1;o<i;o++){const a=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),s=gk[(i-o-1)%gk.length];this._blur(e,o-1,o,a,s)}t.autoClear=n}_blur(e,t,n,i,o){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",o),this._halfBlur(a,e,n,n,i,"longitudinal",o)}_halfBlur(e,t,n,i,o,a,s){const u=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const c=3,h=new Po(this._lodPlanes[i],l),f=l.uniforms,m=this._sizeLods[n]-1,g=isFinite(o)?Math.PI/(2*m):2*Math.PI/(2*Vu-1),w=o/g,v=isFinite(o)?1+Math.floor(c*w):Vu;v>Vu&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${v} samples when the maximum is set to ${Vu}`);const y=[];let x=0;for(let R=0;R<Vu;++R){const I=R/w,T=Math.exp(-I*I/2);y.push(T),R===0?x+=T:R<v&&(x+=2*T)}for(let R=0;R<y.length;R++)y[R]=y[R]/x;f.envMap.value=e.texture,f.samples.value=v,f.weights.value=y,f.latitudinal.value=a==="latitudinal",s&&(f.poleAxis.value=s);const{_lodMax:E}=this;f.dTheta.value=g,f.mipInt.value=E-n;const _=this._sizeLods[i],k=3*_*(i>E-gc?i-E+gc:0),C=4*(this._cubeSize-_);Hp(t,k,C,3*_,2*_),u.setRenderTarget(t),u.render(h,D0)}}function jq(r){const e=[],t=[],n=[];let i=r;const o=r-gc+1+pk.length;for(let a=0;a<o;a++){const s=Math.pow(2,i);t.push(s);let u=1/s;a>r-gc?u=pk[a-r+gc-1]:a===0&&(u=0),n.push(u);const l=1/(s-2),c=-l,h=1+l,f=[c,c,h,c,h,h,c,c,h,h,c,h],m=6,g=6,w=3,v=2,y=1,x=new Float32Array(w*g*m),E=new Float32Array(v*g*m),_=new Float32Array(y*g*m);for(let C=0;C<m;C++){const R=C%3*2/3-1,I=C>2?0:-1,T=[R,I,0,R+2/3,I,0,R+2/3,I+1,0,R,I,0,R+2/3,I+1,0,R,I+1,0];x.set(T,w*g*C),E.set(f,v*g*C);const A=[C,C,C,C,C,C];_.set(A,y*g*C)}const k=new hu;k.setAttribute("position",new oo(x,w)),k.setAttribute("uv",new oo(E,v)),k.setAttribute("faceIndex",new oo(_,y)),e.push(k),i>gc&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function yk(r,e,t){const n=new ii(r,e,t);return n.texture.mapping=_g,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Hp(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function qq(r,e,t){const n=new Float32Array(Vu),i=new Te(0,1,0);return new Xr({name:"SphericalGaussianBlur",defines:{n:Vu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:J1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:wi,depthTest:!1,depthWrite:!1})}function bk(){return new Xr({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:J1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:wi,depthTest:!1,depthWrite:!1})}function wk(){return new Xr({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:J1(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:wi,depthTest:!1,depthWrite:!1})}function J1(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function $q(r){let e=new WeakMap,t=null;function n(s){if(s&&s.isTexture){const u=s.mapping,l=u===Pb||u===Fb,c=u===Hc||u===Gc;if(l||c){let h=e.get(s);const f=h!==void 0?h.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==f)return t===null&&(t=new vk(r)),h=l?t.fromEquirectangular(s,h):t.fromCubemap(s,h),h.texture.pmremVersion=s.pmremVersion,e.set(s,h),h.texture;if(h!==void 0)return h.texture;{const m=s.image;return l&&m&&m.height>0||c&&m&&i(m)?(t===null&&(t=new vk(r)),h=l?t.fromEquirectangular(s):t.fromCubemap(s),h.texture.pmremVersion=s.pmremVersion,e.set(s,h),s.addEventListener("dispose",o),h.texture):null}}}return s}function i(s){let u=0;const l=6;for(let c=0;c<l;c++)s[c]!==void 0&&u++;return u===l}function o(s){const u=s.target;u.removeEventListener("dispose",o);const l=e.get(u);l!==void 0&&(e.delete(u),l.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function Xq(r){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&ld("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function Yq(r,e,t,n){const i={},o=new WeakMap;function a(h){const f=h.target;f.index!==null&&e.remove(f.index);for(const g in f.attributes)e.remove(f.attributes[g]);f.removeEventListener("dispose",a),delete i[f.id];const m=o.get(f);m&&(e.remove(m),o.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function s(h,f){return i[f.id]===!0||(f.addEventListener("dispose",a),i[f.id]=!0,t.memory.geometries++),f}function u(h){const f=h.attributes;for(const m in f)e.update(f[m],r.ARRAY_BUFFER)}function l(h){const f=[],m=h.index,g=h.attributes.position;let w=0;if(m!==null){const x=m.array;w=m.version;for(let E=0,_=x.length;E<_;E+=3){const k=x[E+0],C=x[E+1],R=x[E+2];f.push(k,C,C,R,R,k)}}else if(g!==void 0){const x=g.array;w=g.version;for(let E=0,_=x.length/3-1;E<_;E+=3){const k=E+0,C=E+1,R=E+2;f.push(k,C,C,R,R,k)}}else return;const v=new(XA(f)?eR:QA)(f,1);v.version=w;const y=o.get(h);y&&e.remove(y),o.set(h,v)}function c(h){const f=o.get(h);if(f){const m=h.index;m!==null&&f.version<m.version&&l(h)}else l(h);return o.get(h)}return{get:s,update:u,getWireframeAttribute:c}}function Kq(r,e,t){let n;function i(f){n=f}let o,a;function s(f){o=f.type,a=f.bytesPerElement}function u(f,m){r.drawElements(n,m,o,f*a),t.update(m,n,1)}function l(f,m,g){g!==0&&(r.drawElementsInstanced(n,m,o,f*a,g),t.update(m,n,g))}function c(f,m,g){if(g===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,m,0,o,f,0,g);let v=0;for(let y=0;y<g;y++)v+=m[y];t.update(v,n,1)}function h(f,m,g,w){if(g===0)return;const v=e.get("WEBGL_multi_draw");if(v===null)for(let y=0;y<f.length;y++)l(f[y]/a,m[y],w[y]);else{v.multiDrawElementsInstancedWEBGL(n,m,0,o,f,0,w,0,g);let y=0;for(let x=0;x<g;x++)y+=m[x]*w[x];t.update(y,n,1)}}this.setMode=i,this.setIndex=s,this.render=u,this.renderInstances=l,this.renderMultiDraw=c,this.renderMultiDrawInstances=h}function Jq(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(o,a,s){switch(t.calls++,a){case r.TRIANGLES:t.triangles+=s*(o/3);break;case r.LINES:t.lines+=s*(o/2);break;case r.LINE_STRIP:t.lines+=s*(o-1);break;case r.LINE_LOOP:t.lines+=s*o;break;case r.POINTS:t.points+=s*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function Zq(r,e,t){const n=new WeakMap,i=new Hn;function o(a,s,u){const l=a.morphTargetInfluences,c=s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color,h=c!==void 0?c.length:0;let f=n.get(s);if(f===void 0||f.count!==h){let T=function(){R.dispose(),n.delete(s),s.removeEventListener("dispose",T)};f!==void 0&&f.texture.dispose();const m=s.morphAttributes.position!==void 0,g=s.morphAttributes.normal!==void 0,w=s.morphAttributes.color!==void 0,v=s.morphAttributes.position||[],y=s.morphAttributes.normal||[],x=s.morphAttributes.color||[];let E=0;m===!0&&(E=1),g===!0&&(E=2),w===!0&&(E=3);let _=s.attributes.position.count*E,k=1;_>e.maxTextureSize&&(k=Math.ceil(_/e.maxTextureSize),_=e.maxTextureSize);const C=new Float32Array(_*k*4*h),R=new YA(C,_,k,h);R.type=Va,R.needsUpdate=!0;const I=E*4;for(let A=0;A<h;A++){const N=v[A],O=y[A],V=x[A],F=_*k*4*A;for(let B=0;B<N.count;B++){const U=B*I;m===!0&&(i.fromBufferAttribute(N,B),C[F+U+0]=i.x,C[F+U+1]=i.y,C[F+U+2]=i.z,C[F+U+3]=0),g===!0&&(i.fromBufferAttribute(O,B),C[F+U+4]=i.x,C[F+U+5]=i.y,C[F+U+6]=i.z,C[F+U+7]=0),w===!0&&(i.fromBufferAttribute(V,B),C[F+U+8]=i.x,C[F+U+9]=i.y,C[F+U+10]=i.z,C[F+U+11]=V.itemSize===4?i.w:1)}}f={count:h,texture:R,size:new Wt(_,k)},n.set(s,f),s.addEventListener("dispose",T)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)u.getUniforms().setValue(r,"morphTexture",a.morphTexture,t);else{let m=0;for(let w=0;w<l.length;w++)m+=l[w];const g=s.morphTargetsRelative?1:1-m;u.getUniforms().setValue(r,"morphTargetBaseInfluence",g),u.getUniforms().setValue(r,"morphTargetInfluences",l)}u.getUniforms().setValue(r,"morphTargetsTexture",f.texture,t),u.getUniforms().setValue(r,"morphTargetsTextureSize",f.size)}return{update:o}}function Qq(r,e,t,n){let i=new WeakMap;function o(u){const l=n.render.frame,c=u.geometry,h=e.get(u,c);if(i.get(h)!==l&&(e.update(h),i.set(h,l)),u.isInstancedMesh&&(u.hasEventListener("dispose",s)===!1&&u.addEventListener("dispose",s),i.get(u)!==l&&(t.update(u.instanceMatrix,r.ARRAY_BUFFER),u.instanceColor!==null&&t.update(u.instanceColor,r.ARRAY_BUFFER),i.set(u,l))),u.isSkinnedMesh){const f=u.skeleton;i.get(f)!==l&&(f.update(),i.set(f,l))}return h}function a(){i=new WeakMap}function s(u){const l=u.target;l.removeEventListener("dispose",s),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:o,dispose:a}}const sR=new jr,_k=new Y1(1,1),uR=new YA,lR=new RG,cR=new rR,xk=[],Sk=[],Ek=new Float32Array(16),kk=new Float32Array(9),Ck=new Float32Array(4);function eh(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let o=xk[i];if(o===void 0&&(o=new Float32Array(i),xk[i]=o),e!==0){n.toArray(o,0);for(let a=1,s=0;a!==e;++a)s+=t,r[a].toArray(o,s)}return o}function cr(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function hr(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function xg(r,e){let t=Sk[e];t===void 0&&(t=new Int32Array(e),Sk[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function e$(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function t$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cr(t,e))return;r.uniform2fv(this.addr,e),hr(t,e)}}function n$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(cr(t,e))return;r.uniform3fv(this.addr,e),hr(t,e)}}function r$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cr(t,e))return;r.uniform4fv(this.addr,e),hr(t,e)}}function i$(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(cr(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),hr(t,e)}else{if(cr(t,n))return;Ck.set(n),r.uniformMatrix2fv(this.addr,!1,Ck),hr(t,n)}}function o$(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(cr(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),hr(t,e)}else{if(cr(t,n))return;kk.set(n),r.uniformMatrix3fv(this.addr,!1,kk),hr(t,n)}}function a$(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(cr(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),hr(t,e)}else{if(cr(t,n))return;Ek.set(n),r.uniformMatrix4fv(this.addr,!1,Ek),hr(t,n)}}function s$(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function u$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cr(t,e))return;r.uniform2iv(this.addr,e),hr(t,e)}}function l$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(cr(t,e))return;r.uniform3iv(this.addr,e),hr(t,e)}}function c$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cr(t,e))return;r.uniform4iv(this.addr,e),hr(t,e)}}function h$(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function d$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(cr(t,e))return;r.uniform2uiv(this.addr,e),hr(t,e)}}function f$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(cr(t,e))return;r.uniform3uiv(this.addr,e),hr(t,e)}}function p$(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(cr(t,e))return;r.uniform4uiv(this.addr,e),hr(t,e)}}function m$(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let o;this.type===r.SAMPLER_2D_SHADOW?(_k.compareFunction=$A,o=_k):o=sR,t.setTexture2D(e||o,i)}function g$(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||lR,i)}function v$(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||cR,i)}function y$(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||uR,i)}function b$(r){switch(r){case 5126:return e$;case 35664:return t$;case 35665:return n$;case 35666:return r$;case 35674:return i$;case 35675:return o$;case 35676:return a$;case 5124:case 35670:return s$;case 35667:case 35671:return u$;case 35668:case 35672:return l$;case 35669:case 35673:return c$;case 5125:return h$;case 36294:return d$;case 36295:return f$;case 36296:return p$;case 35678:case 36198:case 36298:case 36306:case 35682:return m$;case 35679:case 36299:case 36307:return g$;case 35680:case 36300:case 36308:case 36293:return v$;case 36289:case 36303:case 36311:case 36292:return y$}}function w$(r,e){r.uniform1fv(this.addr,e)}function _$(r,e){const t=eh(e,this.size,2);r.uniform2fv(this.addr,t)}function x$(r,e){const t=eh(e,this.size,3);r.uniform3fv(this.addr,t)}function S$(r,e){const t=eh(e,this.size,4);r.uniform4fv(this.addr,t)}function E$(r,e){const t=eh(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function k$(r,e){const t=eh(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function C$(r,e){const t=eh(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function T$(r,e){r.uniform1iv(this.addr,e)}function M$(r,e){r.uniform2iv(this.addr,e)}function A$(r,e){r.uniform3iv(this.addr,e)}function R$(r,e){r.uniform4iv(this.addr,e)}function I$(r,e){r.uniform1uiv(this.addr,e)}function D$(r,e){r.uniform2uiv(this.addr,e)}function N$(r,e){r.uniform3uiv(this.addr,e)}function P$(r,e){r.uniform4uiv(this.addr,e)}function F$(r,e,t){const n=this.cache,i=e.length,o=xg(t,i);cr(n,o)||(r.uniform1iv(this.addr,o),hr(n,o));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||sR,o[a])}function O$(r,e,t){const n=this.cache,i=e.length,o=xg(t,i);cr(n,o)||(r.uniform1iv(this.addr,o),hr(n,o));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||lR,o[a])}function L$(r,e,t){const n=this.cache,i=e.length,o=xg(t,i);cr(n,o)||(r.uniform1iv(this.addr,o),hr(n,o));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||cR,o[a])}function B$(r,e,t){const n=this.cache,i=e.length,o=xg(t,i);cr(n,o)||(r.uniform1iv(this.addr,o),hr(n,o));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||uR,o[a])}function U$(r){switch(r){case 5126:return w$;case 35664:return _$;case 35665:return x$;case 35666:return S$;case 35674:return E$;case 35675:return k$;case 35676:return C$;case 5124:case 35670:return T$;case 35667:case 35671:return M$;case 35668:case 35672:return A$;case 35669:case 35673:return R$;case 5125:return I$;case 36294:return D$;case 36295:return N$;case 36296:return P$;case 35678:case 36198:case 36298:case 36306:case 35682:return F$;case 35679:case 36299:case 36307:return O$;case 35680:case 36300:case 36308:case 36293:return L$;case 36289:case 36303:case 36311:case 36292:return B$}}class z${constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=b$(t.type)}}class W${constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=U$(t.type)}}class H${constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let o=0,a=i.length;o!==a;++o){const s=i[o];s.setValue(e,t[s.id],n)}}}const L0=/(\w+)(\])?(\[|\.)?/g;function Tk(r,e){r.seq.push(e),r.map[e.id]=e}function G$(r,e,t){const n=r.name,i=n.length;for(L0.lastIndex=0;;){const o=L0.exec(n),a=L0.lastIndex;let s=o[1];const u=o[2]==="]",l=o[3];if(u&&(s=s|0),l===void 0||l==="["&&a+2===i){Tk(t,l===void 0?new z$(s,r,e):new W$(s,r,e));break}else{let h=t.map[s];h===void 0&&(h=new H$(s),Tk(t,h)),t=h}}}class rm{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const o=e.getActiveUniform(t,i),a=e.getUniformLocation(t,o.name);G$(o,a,this)}}setValue(e,t,n,i){const o=this.map[t];o!==void 0&&o.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let o=0,a=t.length;o!==a;++o){const s=t[o],u=n[s.id];u.needsUpdate!==!1&&s.setValue(e,u.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,o=e.length;i!==o;++i){const a=e[i];a.id in t&&n.push(a)}return n}}function Mk(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const V$=37297;let j$=0;function q$(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let a=i;a<o;a++){const s=a+1;n.push(`${s===e?">":" "} ${s}: ${t[a]}`)}return n.join(`
`)}const Ak=new Jt;function $$(r){gn._getMatrix(Ak,gn.workingColorSpace,r);const e=`mat3( ${Ak.elements.map(t=>t.toFixed(4))} )`;switch(gn.getTransfer(r)){case qm:return[e,"LinearTransferOETF"];case Mn:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function Rk(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),o=(r.getShaderInfoLog(e)||"").trim();if(n&&o==="")return"";const a=/ERROR: 0:(\d+)/.exec(o);if(a){const s=parseInt(a[1]);return t.toUpperCase()+`

`+o+`

`+q$(r.getShaderSource(e),s)}else return o}function X$(r,e){const t=$$(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function Y$(r,e){let t;switch(e){case GH:t="Linear";break;case VH:t="Reinhard";break;case jH:t="Cineon";break;case qH:t="ACESFilmic";break;case XH:t="AgX";break;case YH:t="Neutral";break;case $H:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Gp=new Te;function K$(){gn.getLuminanceCoefficients(Gp);const r=Gp.x.toFixed(4),e=Gp.y.toFixed(4),t=Gp.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function J$(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(qh).join(`
`)}function Z$(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function Q$(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const o=r.getActiveAttrib(e,i),a=o.name;let s=1;o.type===r.FLOAT_MAT2&&(s=2),o.type===r.FLOAT_MAT3&&(s=3),o.type===r.FLOAT_MAT4&&(s=4),t[a]={type:o.type,location:r.getAttribLocation(e,a),locationSize:s}}return t}function qh(r){return r!==""}function Ik(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Dk(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const eX=/^[ \t]*#include +<([\w\d./]+)>/gm;function fw(r){return r.replace(eX,nX)}const tX=new Map;function nX(r,e){let t=Qt[e];if(t===void 0){const n=tX.get(e);if(n!==void 0)t=Qt[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return fw(t)}const rX=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Nk(r){return r.replace(rX,iX)}function iX(r,e,t,n){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function Pk(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function oX(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===OA?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===xH?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===La&&(e="SHADOWMAP_TYPE_VSM"),e}function aX(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case Hc:case Gc:e="ENVMAP_TYPE_CUBE";break;case _g:e="ENVMAP_TYPE_CUBE_UV";break}return e}function sX(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Gc:e="ENVMAP_MODE_REFRACTION";break}return e}function uX(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case LA:e="ENVMAP_BLENDING_MULTIPLY";break;case WH:e="ENVMAP_BLENDING_MIX";break;case HH:e="ENVMAP_BLENDING_ADD";break}return e}function lX(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function cX(r,e,t,n){const i=r.getContext(),o=t.defines;let a=t.vertexShader,s=t.fragmentShader;const u=oX(t),l=aX(t),c=sX(t),h=uX(t),f=lX(t),m=J$(t),g=Z$(o),w=i.createProgram();let v,y,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(v=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(qh).join(`
`),v.length>0&&(v+=`
`),y=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g].filter(qh).join(`
`),y.length>0&&(y+=`
`)):(v=[Pk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(qh).join(`
`),y=[Pk(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,g,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+c:"",t.envMap?"#define "+h:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+u:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==qa?"#define TONE_MAPPING":"",t.toneMapping!==qa?Qt.tonemapping_pars_fragment:"",t.toneMapping!==qa?Y$("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Qt.colorspace_pars_fragment,X$("linearToOutputTexel",t.outputColorSpace),K$(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(qh).join(`
`)),a=fw(a),a=Ik(a,t),a=Dk(a,t),s=fw(s),s=Ik(s,t),s=Dk(s,t),a=Nk(a),s=Nk(s),t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,v=[m,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+v,y=["#define varying in",t.glslVersion===XE?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===XE?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+y);const E=x+v+a,_=x+y+s,k=Mk(i,i.VERTEX_SHADER,E),C=Mk(i,i.FRAGMENT_SHADER,_);i.attachShader(w,k),i.attachShader(w,C),t.index0AttributeName!==void 0?i.bindAttribLocation(w,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(w,0,"position"),i.linkProgram(w);function R(N){if(r.debug.checkShaderErrors){const O=i.getProgramInfoLog(w)||"",V=i.getShaderInfoLog(k)||"",F=i.getShaderInfoLog(C)||"",B=O.trim(),U=V.trim(),P=F.trim();let L=!0,H=!0;if(i.getProgramParameter(w,i.LINK_STATUS)===!1)if(L=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,w,k,C);else{const W=Rk(i,k,"vertex"),z=Rk(i,C,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(w,i.VALIDATE_STATUS)+`

Material Name: `+N.name+`
Material Type: `+N.type+`

Program Info Log: `+B+`
`+W+`
`+z)}else B!==""?console.warn("THREE.WebGLProgram: Program Info Log:",B):(U===""||P==="")&&(H=!1);H&&(N.diagnostics={runnable:L,programLog:B,vertexShader:{log:U,prefix:v},fragmentShader:{log:P,prefix:y}})}i.deleteShader(k),i.deleteShader(C),I=new rm(i,w),T=Q$(i,w)}let I;this.getUniforms=function(){return I===void 0&&R(this),I};let T;this.getAttributes=function(){return T===void 0&&R(this),T};let A=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return A===!1&&(A=i.getProgramParameter(w,V$)),A},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(w),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=j$++,this.cacheKey=e,this.usedTimes=1,this.program=w,this.vertexShader=k,this.fragmentShader=C,this}let hX=0;class dX{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(o)===!1&&(a.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new fX(e),t.set(e,n)),n}}class fX{constructor(e){this.id=hX++,this.code=e,this.usedTimes=0}}function pX(r,e,t,n,i,o,a){const s=new KA,u=new dX,l=new Set,c=[],h=i.logarithmicDepthBuffer,f=i.vertexTextures;let m=i.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function w(T){return l.add(T),T===0?"uv":`uv${T}`}function v(T,A,N,O,V){const F=O.fog,B=V.geometry,U=T.isMeshStandardMaterial?O.environment:null,P=(T.isMeshStandardMaterial?t:e).get(T.envMap||U),L=P&&P.mapping===_g?P.image.height:null,H=g[T.type];T.precision!==null&&(m=i.getMaxPrecision(T.precision),m!==T.precision&&console.warn("THREE.WebGLProgram.getParameters:",T.precision,"not supported, using",m,"instead."));const W=B.morphAttributes.position||B.morphAttributes.normal||B.morphAttributes.color,z=W!==void 0?W.length:0;let q=0;B.morphAttributes.position!==void 0&&(q=1),B.morphAttributes.normal!==void 0&&(q=2),B.morphAttributes.color!==void 0&&(q=3);let re,de,ye,ne;if(H){const an=ia[H];re=an.vertexShader,de=an.fragmentShader}else re=T.vertexShader,de=T.fragmentShader,u.update(T),ye=u.getVertexShaderID(T),ne=u.getFragmentShaderID(T);const ie=r.getRenderTarget(),fe=r.state.buffers.depth.getReversed(),Ae=V.isInstancedMesh===!0,De=V.isBatchedMesh===!0,Be=!!T.map,lt=!!T.matcap,Y=!!P,ot=!!T.aoMap,Je=!!T.lightMap,Xe=!!T.bumpMap,qe=!!T.normalMap,Tt=!!T.displacementMap,Qe=!!T.emissiveMap,ft=!!T.metalnessMap,Mt=!!T.roughnessMap,Ut=T.anisotropy>0,Z=T.clearcoat>0,j=T.dispersion>0,me=T.iridescence>0,Re=T.sheen>0,Pe=T.transmission>0,ke=Ut&&!!T.anisotropyMap,Ue=Z&&!!T.clearcoatMap,_e=Z&&!!T.clearcoatNormalMap,rt=Z&&!!T.clearcoatRoughnessMap,Ze=me&&!!T.iridescenceMap,Oe=me&&!!T.iridescenceThicknessMap,$e=Re&&!!T.sheenColorMap,pt=Re&&!!T.sheenRoughnessMap,nt=!!T.specularMap,tt=!!T.specularColorMap,Nt=!!T.specularIntensityMap,se=Pe&&!!T.transmissionMap,He=Pe&&!!T.thicknessMap,Ve=!!T.gradientMap,it=!!T.alphaMap,We=T.alphaTest>0,Fe=!!T.alphaHash,gt=!!T.extensions;let Ht=qa;T.toneMapped&&(ie===null||ie.isXRRenderTarget===!0)&&(Ht=r.toneMapping);const bn={shaderID:H,shaderType:T.type,shaderName:T.name,vertexShader:re,fragmentShader:de,defines:T.defines,customVertexShaderID:ye,customFragmentShaderID:ne,isRawShaderMaterial:T.isRawShaderMaterial===!0,glslVersion:T.glslVersion,precision:m,batching:De,batchingColor:De&&V._colorsTexture!==null,instancing:Ae,instancingColor:Ae&&V.instanceColor!==null,instancingMorph:Ae&&V.morphTexture!==null,supportsVertexTextures:f,outputColorSpace:ie===null?r.outputColorSpace:ie.isXRRenderTarget===!0?ie.texture.colorSpace:ru,alphaToCoverage:!!T.alphaToCoverage,map:Be,matcap:lt,envMap:Y,envMapMode:Y&&P.mapping,envMapCubeUVHeight:L,aoMap:ot,lightMap:Je,bumpMap:Xe,normalMap:qe,displacementMap:f&&Tt,emissiveMap:Qe,normalMapObjectSpace:qe&&T.normalMapType===QH,normalMapTangentSpace:qe&&T.normalMapType===ZH,metalnessMap:ft,roughnessMap:Mt,anisotropy:Ut,anisotropyMap:ke,clearcoat:Z,clearcoatMap:Ue,clearcoatNormalMap:_e,clearcoatRoughnessMap:rt,dispersion:j,iridescence:me,iridescenceMap:Ze,iridescenceThicknessMap:Oe,sheen:Re,sheenColorMap:$e,sheenRoughnessMap:pt,specularMap:nt,specularColorMap:tt,specularIntensityMap:Nt,transmission:Pe,transmissionMap:se,thicknessMap:He,gradientMap:Ve,opaque:T.transparent===!1&&T.blending===Ic&&T.alphaToCoverage===!1,alphaMap:it,alphaTest:We,alphaHash:Fe,combine:T.combine,mapUv:Be&&w(T.map.channel),aoMapUv:ot&&w(T.aoMap.channel),lightMapUv:Je&&w(T.lightMap.channel),bumpMapUv:Xe&&w(T.bumpMap.channel),normalMapUv:qe&&w(T.normalMap.channel),displacementMapUv:Tt&&w(T.displacementMap.channel),emissiveMapUv:Qe&&w(T.emissiveMap.channel),metalnessMapUv:ft&&w(T.metalnessMap.channel),roughnessMapUv:Mt&&w(T.roughnessMap.channel),anisotropyMapUv:ke&&w(T.anisotropyMap.channel),clearcoatMapUv:Ue&&w(T.clearcoatMap.channel),clearcoatNormalMapUv:_e&&w(T.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:rt&&w(T.clearcoatRoughnessMap.channel),iridescenceMapUv:Ze&&w(T.iridescenceMap.channel),iridescenceThicknessMapUv:Oe&&w(T.iridescenceThicknessMap.channel),sheenColorMapUv:$e&&w(T.sheenColorMap.channel),sheenRoughnessMapUv:pt&&w(T.sheenRoughnessMap.channel),specularMapUv:nt&&w(T.specularMap.channel),specularColorMapUv:tt&&w(T.specularColorMap.channel),specularIntensityMapUv:Nt&&w(T.specularIntensityMap.channel),transmissionMapUv:se&&w(T.transmissionMap.channel),thicknessMapUv:He&&w(T.thicknessMap.channel),alphaMapUv:it&&w(T.alphaMap.channel),vertexTangents:!!B.attributes.tangent&&(qe||Ut),vertexColors:T.vertexColors,vertexAlphas:T.vertexColors===!0&&!!B.attributes.color&&B.attributes.color.itemSize===4,pointsUvs:V.isPoints===!0&&!!B.attributes.uv&&(Be||it),fog:!!F,useFog:T.fog===!0,fogExp2:!!F&&F.isFogExp2,flatShading:T.flatShading===!0&&T.wireframe===!1,sizeAttenuation:T.sizeAttenuation===!0,logarithmicDepthBuffer:h,reversedDepthBuffer:fe,skinning:V.isSkinnedMesh===!0,morphTargets:B.morphAttributes.position!==void 0,morphNormals:B.morphAttributes.normal!==void 0,morphColors:B.morphAttributes.color!==void 0,morphTargetsCount:z,morphTextureStride:q,numDirLights:A.directional.length,numPointLights:A.point.length,numSpotLights:A.spot.length,numSpotLightMaps:A.spotLightMap.length,numRectAreaLights:A.rectArea.length,numHemiLights:A.hemi.length,numDirLightShadows:A.directionalShadowMap.length,numPointLightShadows:A.pointShadowMap.length,numSpotLightShadows:A.spotShadowMap.length,numSpotLightShadowsWithMaps:A.numSpotLightShadowsWithMaps,numLightProbes:A.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:T.dithering,shadowMapEnabled:r.shadowMap.enabled&&N.length>0,shadowMapType:r.shadowMap.type,toneMapping:Ht,decodeVideoTexture:Be&&T.map.isVideoTexture===!0&&gn.getTransfer(T.map.colorSpace)===Mn,decodeVideoTextureEmissive:Qe&&T.emissiveMap.isVideoTexture===!0&&gn.getTransfer(T.emissiveMap.colorSpace)===Mn,premultipliedAlpha:T.premultipliedAlpha,doubleSided:T.side===Oi,flipSided:T.side===br,useDepthPacking:T.depthPacking>=0,depthPacking:T.depthPacking||0,index0AttributeName:T.index0AttributeName,extensionClipCullDistance:gt&&T.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(gt&&T.extensions.multiDraw===!0||De)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:T.customProgramCacheKey()};return bn.vertexUv1s=l.has(1),bn.vertexUv2s=l.has(2),bn.vertexUv3s=l.has(3),l.clear(),bn}function y(T){const A=[];if(T.shaderID?A.push(T.shaderID):(A.push(T.customVertexShaderID),A.push(T.customFragmentShaderID)),T.defines!==void 0)for(const N in T.defines)A.push(N),A.push(T.defines[N]);return T.isRawShaderMaterial===!1&&(x(A,T),E(A,T),A.push(r.outputColorSpace)),A.push(T.customProgramCacheKey),A.join()}function x(T,A){T.push(A.precision),T.push(A.outputColorSpace),T.push(A.envMapMode),T.push(A.envMapCubeUVHeight),T.push(A.mapUv),T.push(A.alphaMapUv),T.push(A.lightMapUv),T.push(A.aoMapUv),T.push(A.bumpMapUv),T.push(A.normalMapUv),T.push(A.displacementMapUv),T.push(A.emissiveMapUv),T.push(A.metalnessMapUv),T.push(A.roughnessMapUv),T.push(A.anisotropyMapUv),T.push(A.clearcoatMapUv),T.push(A.clearcoatNormalMapUv),T.push(A.clearcoatRoughnessMapUv),T.push(A.iridescenceMapUv),T.push(A.iridescenceThicknessMapUv),T.push(A.sheenColorMapUv),T.push(A.sheenRoughnessMapUv),T.push(A.specularMapUv),T.push(A.specularColorMapUv),T.push(A.specularIntensityMapUv),T.push(A.transmissionMapUv),T.push(A.thicknessMapUv),T.push(A.combine),T.push(A.fogExp2),T.push(A.sizeAttenuation),T.push(A.morphTargetsCount),T.push(A.morphAttributeCount),T.push(A.numDirLights),T.push(A.numPointLights),T.push(A.numSpotLights),T.push(A.numSpotLightMaps),T.push(A.numHemiLights),T.push(A.numRectAreaLights),T.push(A.numDirLightShadows),T.push(A.numPointLightShadows),T.push(A.numSpotLightShadows),T.push(A.numSpotLightShadowsWithMaps),T.push(A.numLightProbes),T.push(A.shadowMapType),T.push(A.toneMapping),T.push(A.numClippingPlanes),T.push(A.numClipIntersection),T.push(A.depthPacking)}function E(T,A){s.disableAll(),A.supportsVertexTextures&&s.enable(0),A.instancing&&s.enable(1),A.instancingColor&&s.enable(2),A.instancingMorph&&s.enable(3),A.matcap&&s.enable(4),A.envMap&&s.enable(5),A.normalMapObjectSpace&&s.enable(6),A.normalMapTangentSpace&&s.enable(7),A.clearcoat&&s.enable(8),A.iridescence&&s.enable(9),A.alphaTest&&s.enable(10),A.vertexColors&&s.enable(11),A.vertexAlphas&&s.enable(12),A.vertexUv1s&&s.enable(13),A.vertexUv2s&&s.enable(14),A.vertexUv3s&&s.enable(15),A.vertexTangents&&s.enable(16),A.anisotropy&&s.enable(17),A.alphaHash&&s.enable(18),A.batching&&s.enable(19),A.dispersion&&s.enable(20),A.batchingColor&&s.enable(21),A.gradientMap&&s.enable(22),T.push(s.mask),s.disableAll(),A.fog&&s.enable(0),A.useFog&&s.enable(1),A.flatShading&&s.enable(2),A.logarithmicDepthBuffer&&s.enable(3),A.reversedDepthBuffer&&s.enable(4),A.skinning&&s.enable(5),A.morphTargets&&s.enable(6),A.morphNormals&&s.enable(7),A.morphColors&&s.enable(8),A.premultipliedAlpha&&s.enable(9),A.shadowMapEnabled&&s.enable(10),A.doubleSided&&s.enable(11),A.flipSided&&s.enable(12),A.useDepthPacking&&s.enable(13),A.dithering&&s.enable(14),A.transmission&&s.enable(15),A.sheen&&s.enable(16),A.opaque&&s.enable(17),A.pointsUvs&&s.enable(18),A.decodeVideoTexture&&s.enable(19),A.decodeVideoTextureEmissive&&s.enable(20),A.alphaToCoverage&&s.enable(21),T.push(s.mask)}function _(T){const A=g[T.type];let N;if(A){const O=ia[A];N=VG.clone(O.uniforms)}else N=T.uniforms;return N}function k(T,A){let N;for(let O=0,V=c.length;O<V;O++){const F=c[O];if(F.cacheKey===A){N=F,++N.usedTimes;break}}return N===void 0&&(N=new cX(r,A,T,o),c.push(N)),N}function C(T){if(--T.usedTimes===0){const A=c.indexOf(T);c[A]=c[c.length-1],c.pop(),T.destroy()}}function R(T){u.remove(T)}function I(){u.dispose()}return{getParameters:v,getProgramCacheKey:y,getUniforms:_,acquireProgram:k,releaseProgram:C,releaseShaderCache:R,programs:c,dispose:I}}function mX(){let r=new WeakMap;function e(a){return r.has(a)}function t(a){let s=r.get(a);return s===void 0&&(s={},r.set(a,s)),s}function n(a){r.delete(a)}function i(a,s,u){r.get(a)[s]=u}function o(){r=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:o}}function gX(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function Fk(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function Ok(){const r=[];let e=0;const t=[],n=[],i=[];function o(){e=0,t.length=0,n.length=0,i.length=0}function a(h,f,m,g,w,v){let y=r[e];return y===void 0?(y={id:h.id,object:h,geometry:f,material:m,groupOrder:g,renderOrder:h.renderOrder,z:w,group:v},r[e]=y):(y.id=h.id,y.object=h,y.geometry=f,y.material=m,y.groupOrder=g,y.renderOrder=h.renderOrder,y.z=w,y.group=v),e++,y}function s(h,f,m,g,w,v){const y=a(h,f,m,g,w,v);m.transmission>0?n.push(y):m.transparent===!0?i.push(y):t.push(y)}function u(h,f,m,g,w,v){const y=a(h,f,m,g,w,v);m.transmission>0?n.unshift(y):m.transparent===!0?i.unshift(y):t.unshift(y)}function l(h,f){t.length>1&&t.sort(h||gX),n.length>1&&n.sort(f||Fk),i.length>1&&i.sort(f||Fk)}function c(){for(let h=e,f=r.length;h<f;h++){const m=r[h];if(m.id===null)break;m.id=null,m.object=null,m.geometry=null,m.material=null,m.group=null}}return{opaque:t,transmissive:n,transparent:i,init:o,push:s,unshift:u,finish:c,sort:l}}function vX(){let r=new WeakMap;function e(n,i){const o=r.get(n);let a;return o===void 0?(a=new Ok,r.set(n,[a])):i>=o.length?(a=new Ok,o.push(a)):a=o[i],a}function t(){r=new WeakMap}return{get:e,dispose:t}}function yX(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Te,color:new Sn};break;case"SpotLight":t={position:new Te,direction:new Te,color:new Sn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Te,color:new Sn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Te,skyColor:new Sn,groundColor:new Sn};break;case"RectAreaLight":t={color:new Sn,position:new Te,halfWidth:new Te,halfHeight:new Te};break}return r[e.id]=t,t}}}function bX(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Wt,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let wX=0;function _X(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function xX(r){const e=new yX,t=bX(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let l=0;l<9;l++)n.probe.push(new Te);const i=new Te,o=new sr,a=new sr;function s(l){let c=0,h=0,f=0;for(let T=0;T<9;T++)n.probe[T].set(0,0,0);let m=0,g=0,w=0,v=0,y=0,x=0,E=0,_=0,k=0,C=0,R=0;l.sort(_X);for(let T=0,A=l.length;T<A;T++){const N=l[T],O=N.color,V=N.intensity,F=N.distance,B=N.shadow&&N.shadow.map?N.shadow.map.texture:null;if(N.isAmbientLight)c+=O.r*V,h+=O.g*V,f+=O.b*V;else if(N.isLightProbe){for(let U=0;U<9;U++)n.probe[U].addScaledVector(N.sh.coefficients[U],V);R++}else if(N.isDirectionalLight){const U=e.get(N);if(U.color.copy(N.color).multiplyScalar(N.intensity),N.castShadow){const P=N.shadow,L=t.get(N);L.shadowIntensity=P.intensity,L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,n.directionalShadow[m]=L,n.directionalShadowMap[m]=B,n.directionalShadowMatrix[m]=N.shadow.matrix,x++}n.directional[m]=U,m++}else if(N.isSpotLight){const U=e.get(N);U.position.setFromMatrixPosition(N.matrixWorld),U.color.copy(O).multiplyScalar(V),U.distance=F,U.coneCos=Math.cos(N.angle),U.penumbraCos=Math.cos(N.angle*(1-N.penumbra)),U.decay=N.decay,n.spot[w]=U;const P=N.shadow;if(N.map&&(n.spotLightMap[k]=N.map,k++,P.updateMatrices(N),N.castShadow&&C++),n.spotLightMatrix[w]=P.matrix,N.castShadow){const L=t.get(N);L.shadowIntensity=P.intensity,L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,n.spotShadow[w]=L,n.spotShadowMap[w]=B,_++}w++}else if(N.isRectAreaLight){const U=e.get(N);U.color.copy(O).multiplyScalar(V),U.halfWidth.set(N.width*.5,0,0),U.halfHeight.set(0,N.height*.5,0),n.rectArea[v]=U,v++}else if(N.isPointLight){const U=e.get(N);if(U.color.copy(N.color).multiplyScalar(N.intensity),U.distance=N.distance,U.decay=N.decay,N.castShadow){const P=N.shadow,L=t.get(N);L.shadowIntensity=P.intensity,L.shadowBias=P.bias,L.shadowNormalBias=P.normalBias,L.shadowRadius=P.radius,L.shadowMapSize=P.mapSize,L.shadowCameraNear=P.camera.near,L.shadowCameraFar=P.camera.far,n.pointShadow[g]=L,n.pointShadowMap[g]=B,n.pointShadowMatrix[g]=N.shadow.matrix,E++}n.point[g]=U,g++}else if(N.isHemisphereLight){const U=e.get(N);U.skyColor.copy(N.color).multiplyScalar(V),U.groundColor.copy(N.groundColor).multiplyScalar(V),n.hemi[y]=U,y++}}v>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=ut.LTC_FLOAT_1,n.rectAreaLTC2=ut.LTC_FLOAT_2):(n.rectAreaLTC1=ut.LTC_HALF_1,n.rectAreaLTC2=ut.LTC_HALF_2)),n.ambient[0]=c,n.ambient[1]=h,n.ambient[2]=f;const I=n.hash;(I.directionalLength!==m||I.pointLength!==g||I.spotLength!==w||I.rectAreaLength!==v||I.hemiLength!==y||I.numDirectionalShadows!==x||I.numPointShadows!==E||I.numSpotShadows!==_||I.numSpotMaps!==k||I.numLightProbes!==R)&&(n.directional.length=m,n.spot.length=w,n.rectArea.length=v,n.point.length=g,n.hemi.length=y,n.directionalShadow.length=x,n.directionalShadowMap.length=x,n.pointShadow.length=E,n.pointShadowMap.length=E,n.spotShadow.length=_,n.spotShadowMap.length=_,n.directionalShadowMatrix.length=x,n.pointShadowMatrix.length=E,n.spotLightMatrix.length=_+k-C,n.spotLightMap.length=k,n.numSpotLightShadowsWithMaps=C,n.numLightProbes=R,I.directionalLength=m,I.pointLength=g,I.spotLength=w,I.rectAreaLength=v,I.hemiLength=y,I.numDirectionalShadows=x,I.numPointShadows=E,I.numSpotShadows=_,I.numSpotMaps=k,I.numLightProbes=R,n.version=wX++)}function u(l,c){let h=0,f=0,m=0,g=0,w=0;const v=c.matrixWorldInverse;for(let y=0,x=l.length;y<x;y++){const E=l[y];if(E.isDirectionalLight){const _=n.directional[h];_.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),_.direction.sub(i),_.direction.transformDirection(v),h++}else if(E.isSpotLight){const _=n.spot[m];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(v),_.direction.setFromMatrixPosition(E.matrixWorld),i.setFromMatrixPosition(E.target.matrixWorld),_.direction.sub(i),_.direction.transformDirection(v),m++}else if(E.isRectAreaLight){const _=n.rectArea[g];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(v),a.identity(),o.copy(E.matrixWorld),o.premultiply(v),a.extractRotation(o),_.halfWidth.set(E.width*.5,0,0),_.halfHeight.set(0,E.height*.5,0),_.halfWidth.applyMatrix4(a),_.halfHeight.applyMatrix4(a),g++}else if(E.isPointLight){const _=n.point[f];_.position.setFromMatrixPosition(E.matrixWorld),_.position.applyMatrix4(v),f++}else if(E.isHemisphereLight){const _=n.hemi[w];_.direction.setFromMatrixPosition(E.matrixWorld),_.direction.transformDirection(v),w++}}}return{setup:s,setupView:u,state:n}}function Lk(r){const e=new xX(r),t=[],n=[];function i(c){l.camera=c,t.length=0,n.length=0}function o(c){t.push(c)}function a(c){n.push(c)}function s(){e.setup(t)}function u(c){e.setupView(t,c)}const l={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:l,setupLights:s,setupLightsView:u,pushLight:o,pushShadow:a}}function SX(r){let e=new WeakMap;function t(i,o=0){const a=e.get(i);let s;return a===void 0?(s=new Lk(r),e.set(i,[s])):o>=a.length?(s=new Lk(r),a.push(s)):s=a[o],s}function n(){e=new WeakMap}return{get:t,dispose:n}}const EX=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,kX=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function CX(r,e,t){let n=new iR;const i=new Wt,o=new Wt,a=new Hn,s=new QG({depthPacking:JH}),u=new eV,l={},c=t.maxTextureSize,h={[Ya]:br,[br]:Ya,[Oi]:Oi},f=new Xr({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Wt},radius:{value:4}},vertexShader:EX,fragmentShader:kX}),m=f.clone();m.defines.HORIZONTAL_PASS=1;const g=new hu;g.setAttribute("position",new oo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const w=new Po(g,f),v=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=OA;let y=this.type;this.render=function(C,R,I){if(v.enabled===!1||v.autoUpdate===!1&&v.needsUpdate===!1||C.length===0)return;const T=r.getRenderTarget(),A=r.getActiveCubeFace(),N=r.getActiveMipmapLevel(),O=r.state;O.setBlending(wi),O.buffers.depth.getReversed()===!0?O.buffers.color.setClear(0,0,0,0):O.buffers.color.setClear(1,1,1,1),O.buffers.depth.setTest(!0),O.setScissorTest(!1);const V=y!==La&&this.type===La,F=y===La&&this.type!==La;for(let B=0,U=C.length;B<U;B++){const P=C[B],L=P.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",P,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;i.copy(L.mapSize);const H=L.getFrameExtents();if(i.multiply(H),o.copy(L.mapSize),(i.x>c||i.y>c)&&(i.x>c&&(o.x=Math.floor(c/H.x),i.x=o.x*H.x,L.mapSize.x=o.x),i.y>c&&(o.y=Math.floor(c/H.y),i.y=o.y*H.y,L.mapSize.y=o.y)),L.map===null||V===!0||F===!0){const z=this.type!==La?{minFilter:Uo,magFilter:Uo}:{};L.map!==null&&L.map.dispose(),L.map=new ii(i.x,i.y,z),L.map.texture.name=P.name+".shadowMap",L.camera.updateProjectionMatrix()}r.setRenderTarget(L.map),r.clear();const W=L.getViewportCount();for(let z=0;z<W;z++){const q=L.getViewport(z);a.set(o.x*q.x,o.y*q.y,o.x*q.z,o.y*q.w),O.viewport(a),L.updateMatrices(P,z),n=L.getFrustum(),_(R,I,L.camera,P,this.type)}L.isPointLightShadow!==!0&&this.type===La&&x(L,I),L.needsUpdate=!1}y=this.type,v.needsUpdate=!1,r.setRenderTarget(T,A,N)};function x(C,R){const I=e.update(w);f.defines.VSM_SAMPLES!==C.blurSamples&&(f.defines.VSM_SAMPLES=C.blurSamples,m.defines.VSM_SAMPLES=C.blurSamples,f.needsUpdate=!0,m.needsUpdate=!0),C.mapPass===null&&(C.mapPass=new ii(i.x,i.y)),f.uniforms.shadow_pass.value=C.map.texture,f.uniforms.resolution.value=C.mapSize,f.uniforms.radius.value=C.radius,r.setRenderTarget(C.mapPass),r.clear(),r.renderBufferDirect(R,null,I,f,w,null),m.uniforms.shadow_pass.value=C.mapPass.texture,m.uniforms.resolution.value=C.mapSize,m.uniforms.radius.value=C.radius,r.setRenderTarget(C.map),r.clear(),r.renderBufferDirect(R,null,I,m,w,null)}function E(C,R,I,T){let A=null;const N=I.isPointLight===!0?C.customDistanceMaterial:C.customDepthMaterial;if(N!==void 0)A=N;else if(A=I.isPointLight===!0?u:s,r.localClippingEnabled&&R.clipShadows===!0&&Array.isArray(R.clippingPlanes)&&R.clippingPlanes.length!==0||R.displacementMap&&R.displacementScale!==0||R.alphaMap&&R.alphaTest>0||R.map&&R.alphaTest>0||R.alphaToCoverage===!0){const O=A.uuid,V=R.uuid;let F=l[O];F===void 0&&(F={},l[O]=F);let B=F[V];B===void 0&&(B=A.clone(),F[V]=B,R.addEventListener("dispose",k)),A=B}if(A.visible=R.visible,A.wireframe=R.wireframe,T===La?A.side=R.shadowSide!==null?R.shadowSide:R.side:A.side=R.shadowSide!==null?R.shadowSide:h[R.side],A.alphaMap=R.alphaMap,A.alphaTest=R.alphaToCoverage===!0?.5:R.alphaTest,A.map=R.map,A.clipShadows=R.clipShadows,A.clippingPlanes=R.clippingPlanes,A.clipIntersection=R.clipIntersection,A.displacementMap=R.displacementMap,A.displacementScale=R.displacementScale,A.displacementBias=R.displacementBias,A.wireframeLinewidth=R.wireframeLinewidth,A.linewidth=R.linewidth,I.isPointLight===!0&&A.isMeshDistanceMaterial===!0){const O=r.properties.get(A);O.light=I}return A}function _(C,R,I,T,A){if(C.visible===!1)return;if(C.layers.test(R.layers)&&(C.isMesh||C.isLine||C.isPoints)&&(C.castShadow||C.receiveShadow&&A===La)&&(!C.frustumCulled||n.intersectsObject(C))){C.modelViewMatrix.multiplyMatrices(I.matrixWorldInverse,C.matrixWorld);const V=e.update(C),F=C.material;if(Array.isArray(F)){const B=V.groups;for(let U=0,P=B.length;U<P;U++){const L=B[U],H=F[L.materialIndex];if(H&&H.visible){const W=E(C,H,T,A);C.onBeforeShadow(r,C,R,I,V,W,L),r.renderBufferDirect(I,null,V,W,C,L),C.onAfterShadow(r,C,R,I,V,W,L)}}}else if(F.visible){const B=E(C,F,T,A);C.onBeforeShadow(r,C,R,I,V,B,null),r.renderBufferDirect(I,null,V,B,C,null),C.onAfterShadow(r,C,R,I,V,B,null)}}const O=C.children;for(let V=0,F=O.length;V<F;V++)_(O[V],R,I,T,A)}function k(C){C.target.removeEventListener("dispose",k);for(const I in l){const T=l[I],A=C.target.uuid;A in T&&(T[A].dispose(),delete T[A])}}}const TX={[Mb]:jm,[Ab]:Db,[Rb]:Nb,[Wc]:Ib,[jm]:Mb,[Db]:Ab,[Nb]:Rb,[Ib]:Wc};function MX(r,e){function t(){let se=!1;const He=new Hn;let Ve=null;const it=new Hn(0,0,0,0);return{setMask:function(We){Ve!==We&&!se&&(r.colorMask(We,We,We,We),Ve=We)},setLocked:function(We){se=We},setClear:function(We,Fe,gt,Ht,bn){bn===!0&&(We*=Ht,Fe*=Ht,gt*=Ht),He.set(We,Fe,gt,Ht),it.equals(He)===!1&&(r.clearColor(We,Fe,gt,Ht),it.copy(He))},reset:function(){se=!1,Ve=null,it.set(-1,0,0,0)}}}function n(){let se=!1,He=!1,Ve=null,it=null,We=null;return{setReversed:function(Fe){if(He!==Fe){const gt=e.get("EXT_clip_control");Fe?gt.clipControlEXT(gt.LOWER_LEFT_EXT,gt.ZERO_TO_ONE_EXT):gt.clipControlEXT(gt.LOWER_LEFT_EXT,gt.NEGATIVE_ONE_TO_ONE_EXT),He=Fe;const Ht=We;We=null,this.setClear(Ht)}},getReversed:function(){return He},setTest:function(Fe){Fe?ie(r.DEPTH_TEST):fe(r.DEPTH_TEST)},setMask:function(Fe){Ve!==Fe&&!se&&(r.depthMask(Fe),Ve=Fe)},setFunc:function(Fe){if(He&&(Fe=TX[Fe]),it!==Fe){switch(Fe){case Mb:r.depthFunc(r.NEVER);break;case jm:r.depthFunc(r.ALWAYS);break;case Ab:r.depthFunc(r.LESS);break;case Wc:r.depthFunc(r.LEQUAL);break;case Rb:r.depthFunc(r.EQUAL);break;case Ib:r.depthFunc(r.GEQUAL);break;case Db:r.depthFunc(r.GREATER);break;case Nb:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}it=Fe}},setLocked:function(Fe){se=Fe},setClear:function(Fe){We!==Fe&&(He&&(Fe=1-Fe),r.clearDepth(Fe),We=Fe)},reset:function(){se=!1,Ve=null,it=null,We=null,He=!1}}}function i(){let se=!1,He=null,Ve=null,it=null,We=null,Fe=null,gt=null,Ht=null,bn=null;return{setTest:function(an){se||(an?ie(r.STENCIL_TEST):fe(r.STENCIL_TEST))},setMask:function(an){He!==an&&!se&&(r.stencilMask(an),He=an)},setFunc:function(an,oi,fr){(Ve!==an||it!==oi||We!==fr)&&(r.stencilFunc(an,oi,fr),Ve=an,it=oi,We=fr)},setOp:function(an,oi,fr){(Fe!==an||gt!==oi||Ht!==fr)&&(r.stencilOp(an,oi,fr),Fe=an,gt=oi,Ht=fr)},setLocked:function(an){se=an},setClear:function(an){bn!==an&&(r.clearStencil(an),bn=an)},reset:function(){se=!1,He=null,Ve=null,it=null,We=null,Fe=null,gt=null,Ht=null,bn=null}}}const o=new t,a=new n,s=new i,u=new WeakMap,l=new WeakMap;let c={},h={},f=new WeakMap,m=[],g=null,w=!1,v=null,y=null,x=null,E=null,_=null,k=null,C=null,R=new Sn(0,0,0),I=0,T=!1,A=null,N=null,O=null,V=null,F=null;const B=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let U=!1,P=0;const L=r.getParameter(r.VERSION);L.indexOf("WebGL")!==-1?(P=parseFloat(/^WebGL (\d)/.exec(L)[1]),U=P>=1):L.indexOf("OpenGL ES")!==-1&&(P=parseFloat(/^OpenGL ES (\d)/.exec(L)[1]),U=P>=2);let H=null,W={};const z=r.getParameter(r.SCISSOR_BOX),q=r.getParameter(r.VIEWPORT),re=new Hn().fromArray(z),de=new Hn().fromArray(q);function ye(se,He,Ve,it){const We=new Uint8Array(4),Fe=r.createTexture();r.bindTexture(se,Fe),r.texParameteri(se,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(se,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let gt=0;gt<Ve;gt++)se===r.TEXTURE_3D||se===r.TEXTURE_2D_ARRAY?r.texImage3D(He,0,r.RGBA,1,1,it,0,r.RGBA,r.UNSIGNED_BYTE,We):r.texImage2D(He+gt,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,We);return Fe}const ne={};ne[r.TEXTURE_2D]=ye(r.TEXTURE_2D,r.TEXTURE_2D,1),ne[r.TEXTURE_CUBE_MAP]=ye(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),ne[r.TEXTURE_2D_ARRAY]=ye(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),ne[r.TEXTURE_3D]=ye(r.TEXTURE_3D,r.TEXTURE_3D,1,1),o.setClear(0,0,0,1),a.setClear(1),s.setClear(0),ie(r.DEPTH_TEST),a.setFunc(Wc),Xe(!1),qe(HE),ie(r.CULL_FACE),ot(wi);function ie(se){c[se]!==!0&&(r.enable(se),c[se]=!0)}function fe(se){c[se]!==!1&&(r.disable(se),c[se]=!1)}function Ae(se,He){return h[se]!==He?(r.bindFramebuffer(se,He),h[se]=He,se===r.DRAW_FRAMEBUFFER&&(h[r.FRAMEBUFFER]=He),se===r.FRAMEBUFFER&&(h[r.DRAW_FRAMEBUFFER]=He),!0):!1}function De(se,He){let Ve=m,it=!1;if(se){Ve=f.get(He),Ve===void 0&&(Ve=[],f.set(He,Ve));const We=se.textures;if(Ve.length!==We.length||Ve[0]!==r.COLOR_ATTACHMENT0){for(let Fe=0,gt=We.length;Fe<gt;Fe++)Ve[Fe]=r.COLOR_ATTACHMENT0+Fe;Ve.length=We.length,it=!0}}else Ve[0]!==r.BACK&&(Ve[0]=r.BACK,it=!0);it&&r.drawBuffers(Ve)}function Be(se){return g!==se?(r.useProgram(se),g=se,!0):!1}const lt={[Gu]:r.FUNC_ADD,[EH]:r.FUNC_SUBTRACT,[kH]:r.FUNC_REVERSE_SUBTRACT};lt[CH]=r.MIN,lt[TH]=r.MAX;const Y={[MH]:r.ZERO,[AH]:r.ONE,[RH]:r.SRC_COLOR,[Cb]:r.SRC_ALPHA,[OH]:r.SRC_ALPHA_SATURATE,[PH]:r.DST_COLOR,[DH]:r.DST_ALPHA,[IH]:r.ONE_MINUS_SRC_COLOR,[Tb]:r.ONE_MINUS_SRC_ALPHA,[FH]:r.ONE_MINUS_DST_COLOR,[NH]:r.ONE_MINUS_DST_ALPHA,[LH]:r.CONSTANT_COLOR,[BH]:r.ONE_MINUS_CONSTANT_COLOR,[UH]:r.CONSTANT_ALPHA,[zH]:r.ONE_MINUS_CONSTANT_ALPHA};function ot(se,He,Ve,it,We,Fe,gt,Ht,bn,an){if(se===wi){w===!0&&(fe(r.BLEND),w=!1);return}if(w===!1&&(ie(r.BLEND),w=!0),se!==SH){if(se!==v||an!==T){if((y!==Gu||_!==Gu)&&(r.blendEquation(r.FUNC_ADD),y=Gu,_=Gu),an)switch(se){case Ic:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case GE:r.blendFunc(r.ONE,r.ONE);break;case VE:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case jE:r.blendFuncSeparate(r.DST_COLOR,r.ONE_MINUS_SRC_ALPHA,r.ZERO,r.ONE);break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}else switch(se){case Ic:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case GE:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE,r.ONE,r.ONE);break;case VE:console.error("THREE.WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case jE:console.error("THREE.WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:console.error("THREE.WebGLState: Invalid blending: ",se);break}x=null,E=null,k=null,C=null,R.set(0,0,0),I=0,v=se,T=an}return}We=We||He,Fe=Fe||Ve,gt=gt||it,(He!==y||We!==_)&&(r.blendEquationSeparate(lt[He],lt[We]),y=He,_=We),(Ve!==x||it!==E||Fe!==k||gt!==C)&&(r.blendFuncSeparate(Y[Ve],Y[it],Y[Fe],Y[gt]),x=Ve,E=it,k=Fe,C=gt),(Ht.equals(R)===!1||bn!==I)&&(r.blendColor(Ht.r,Ht.g,Ht.b,bn),R.copy(Ht),I=bn),v=se,T=!1}function Je(se,He){se.side===Oi?fe(r.CULL_FACE):ie(r.CULL_FACE);let Ve=se.side===br;He&&(Ve=!Ve),Xe(Ve),se.blending===Ic&&se.transparent===!1?ot(wi):ot(se.blending,se.blendEquation,se.blendSrc,se.blendDst,se.blendEquationAlpha,se.blendSrcAlpha,se.blendDstAlpha,se.blendColor,se.blendAlpha,se.premultipliedAlpha),a.setFunc(se.depthFunc),a.setTest(se.depthTest),a.setMask(se.depthWrite),o.setMask(se.colorWrite);const it=se.stencilWrite;s.setTest(it),it&&(s.setMask(se.stencilWriteMask),s.setFunc(se.stencilFunc,se.stencilRef,se.stencilFuncMask),s.setOp(se.stencilFail,se.stencilZFail,se.stencilZPass)),Qe(se.polygonOffset,se.polygonOffsetFactor,se.polygonOffsetUnits),se.alphaToCoverage===!0?ie(r.SAMPLE_ALPHA_TO_COVERAGE):fe(r.SAMPLE_ALPHA_TO_COVERAGE)}function Xe(se){A!==se&&(se?r.frontFace(r.CW):r.frontFace(r.CCW),A=se)}function qe(se){se!==wH?(ie(r.CULL_FACE),se!==N&&(se===HE?r.cullFace(r.BACK):se===_H?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):fe(r.CULL_FACE),N=se}function Tt(se){se!==O&&(U&&r.lineWidth(se),O=se)}function Qe(se,He,Ve){se?(ie(r.POLYGON_OFFSET_FILL),(V!==He||F!==Ve)&&(r.polygonOffset(He,Ve),V=He,F=Ve)):fe(r.POLYGON_OFFSET_FILL)}function ft(se){se?ie(r.SCISSOR_TEST):fe(r.SCISSOR_TEST)}function Mt(se){se===void 0&&(se=r.TEXTURE0+B-1),H!==se&&(r.activeTexture(se),H=se)}function Ut(se,He,Ve){Ve===void 0&&(H===null?Ve=r.TEXTURE0+B-1:Ve=H);let it=W[Ve];it===void 0&&(it={type:void 0,texture:void 0},W[Ve]=it),(it.type!==se||it.texture!==He)&&(H!==Ve&&(r.activeTexture(Ve),H=Ve),r.bindTexture(se,He||ne[se]),it.type=se,it.texture=He)}function Z(){const se=W[H];se!==void 0&&se.type!==void 0&&(r.bindTexture(se.type,null),se.type=void 0,se.texture=void 0)}function j(){try{r.compressedTexImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function me(){try{r.compressedTexImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Re(){try{r.texSubImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Pe(){try{r.texSubImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function ke(){try{r.compressedTexSubImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ue(){try{r.compressedTexSubImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function _e(){try{r.texStorage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function rt(){try{r.texStorage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Ze(){try{r.texImage2D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function Oe(){try{r.texImage3D(...arguments)}catch(se){console.error("THREE.WebGLState:",se)}}function $e(se){re.equals(se)===!1&&(r.scissor(se.x,se.y,se.z,se.w),re.copy(se))}function pt(se){de.equals(se)===!1&&(r.viewport(se.x,se.y,se.z,se.w),de.copy(se))}function nt(se,He){let Ve=l.get(He);Ve===void 0&&(Ve=new WeakMap,l.set(He,Ve));let it=Ve.get(se);it===void 0&&(it=r.getUniformBlockIndex(He,se.name),Ve.set(se,it))}function tt(se,He){const it=l.get(He).get(se);u.get(He)!==it&&(r.uniformBlockBinding(He,it,se.__bindingPointIndex),u.set(He,it))}function Nt(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),a.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),c={},H=null,W={},h={},f=new WeakMap,m=[],g=null,w=!1,v=null,y=null,x=null,E=null,_=null,k=null,C=null,R=new Sn(0,0,0),I=0,T=!1,A=null,N=null,O=null,V=null,F=null,re.set(0,0,r.canvas.width,r.canvas.height),de.set(0,0,r.canvas.width,r.canvas.height),o.reset(),a.reset(),s.reset()}return{buffers:{color:o,depth:a,stencil:s},enable:ie,disable:fe,bindFramebuffer:Ae,drawBuffers:De,useProgram:Be,setBlending:ot,setMaterial:Je,setFlipSided:Xe,setCullFace:qe,setLineWidth:Tt,setPolygonOffset:Qe,setScissorTest:ft,activeTexture:Mt,bindTexture:Ut,unbindTexture:Z,compressedTexImage2D:j,compressedTexImage3D:me,texImage2D:Ze,texImage3D:Oe,updateUBOMapping:nt,uniformBlockBinding:tt,texStorage2D:_e,texStorage3D:rt,texSubImage2D:Re,texSubImage3D:Pe,compressedTexSubImage2D:ke,compressedTexSubImage3D:Ue,scissor:$e,viewport:pt,reset:Nt}}function AX(r,e,t,n,i,o,a){const s=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,u=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),l=new Wt,c=new WeakMap;let h;const f=new WeakMap;let m=!1;try{m=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function g(Z,j){return m?new OffscreenCanvas(Z,j):Xm("canvas")}function w(Z,j,me){let Re=1;const Pe=Ut(Z);if((Pe.width>me||Pe.height>me)&&(Re=me/Math.max(Pe.width,Pe.height)),Re<1)if(typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Z instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Z instanceof ImageBitmap||typeof VideoFrame<"u"&&Z instanceof VideoFrame){const ke=Math.floor(Re*Pe.width),Ue=Math.floor(Re*Pe.height);h===void 0&&(h=g(ke,Ue));const _e=j?g(ke,Ue):h;return _e.width=ke,_e.height=Ue,_e.getContext("2d").drawImage(Z,0,0,ke,Ue),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Pe.width+"x"+Pe.height+") to ("+ke+"x"+Ue+")."),_e}else return"data"in Z&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Pe.width+"x"+Pe.height+")."),Z;return Z}function v(Z){return Z.generateMipmaps}function y(Z){r.generateMipmap(Z)}function x(Z){return Z.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:Z.isWebGL3DRenderTarget?r.TEXTURE_3D:Z.isWebGLArrayRenderTarget||Z.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function E(Z,j,me,Re,Pe=!1){if(Z!==null){if(r[Z]!==void 0)return r[Z];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Z+"'")}let ke=j;if(j===r.RED&&(me===r.FLOAT&&(ke=r.R32F),me===r.HALF_FLOAT&&(ke=r.R16F),me===r.UNSIGNED_BYTE&&(ke=r.R8)),j===r.RED_INTEGER&&(me===r.UNSIGNED_BYTE&&(ke=r.R8UI),me===r.UNSIGNED_SHORT&&(ke=r.R16UI),me===r.UNSIGNED_INT&&(ke=r.R32UI),me===r.BYTE&&(ke=r.R8I),me===r.SHORT&&(ke=r.R16I),me===r.INT&&(ke=r.R32I)),j===r.RG&&(me===r.FLOAT&&(ke=r.RG32F),me===r.HALF_FLOAT&&(ke=r.RG16F),me===r.UNSIGNED_BYTE&&(ke=r.RG8)),j===r.RG_INTEGER&&(me===r.UNSIGNED_BYTE&&(ke=r.RG8UI),me===r.UNSIGNED_SHORT&&(ke=r.RG16UI),me===r.UNSIGNED_INT&&(ke=r.RG32UI),me===r.BYTE&&(ke=r.RG8I),me===r.SHORT&&(ke=r.RG16I),me===r.INT&&(ke=r.RG32I)),j===r.RGB_INTEGER&&(me===r.UNSIGNED_BYTE&&(ke=r.RGB8UI),me===r.UNSIGNED_SHORT&&(ke=r.RGB16UI),me===r.UNSIGNED_INT&&(ke=r.RGB32UI),me===r.BYTE&&(ke=r.RGB8I),me===r.SHORT&&(ke=r.RGB16I),me===r.INT&&(ke=r.RGB32I)),j===r.RGBA_INTEGER&&(me===r.UNSIGNED_BYTE&&(ke=r.RGBA8UI),me===r.UNSIGNED_SHORT&&(ke=r.RGBA16UI),me===r.UNSIGNED_INT&&(ke=r.RGBA32UI),me===r.BYTE&&(ke=r.RGBA8I),me===r.SHORT&&(ke=r.RGBA16I),me===r.INT&&(ke=r.RGBA32I)),j===r.RGB&&(me===r.UNSIGNED_INT_5_9_9_9_REV&&(ke=r.RGB9_E5),me===r.UNSIGNED_INT_10F_11F_11F_REV&&(ke=r.R11F_G11F_B10F)),j===r.RGBA){const Ue=Pe?qm:gn.getTransfer(Re);me===r.FLOAT&&(ke=r.RGBA32F),me===r.HALF_FLOAT&&(ke=r.RGBA16F),me===r.UNSIGNED_BYTE&&(ke=Ue===Mn?r.SRGB8_ALPHA8:r.RGBA8),me===r.UNSIGNED_SHORT_4_4_4_4&&(ke=r.RGBA4),me===r.UNSIGNED_SHORT_5_5_5_1&&(ke=r.RGB5_A1)}return(ke===r.R16F||ke===r.R32F||ke===r.RG16F||ke===r.RG32F||ke===r.RGBA16F||ke===r.RGBA32F)&&e.get("EXT_color_buffer_float"),ke}function _(Z,j){let me;return Z?j===null||j===nu||j===Vc?me=r.DEPTH24_STENCIL8:j===Va?me=r.DEPTH32F_STENCIL8:j===ad&&(me=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):j===null||j===nu||j===Vc?me=r.DEPTH_COMPONENT24:j===Va?me=r.DEPTH_COMPONENT32F:j===ad&&(me=r.DEPTH_COMPONENT16),me}function k(Z,j){return v(Z)===!0||Z.isFramebufferTexture&&Z.minFilter!==Uo&&Z.minFilter!==vi?Math.log2(Math.max(j.width,j.height))+1:Z.mipmaps!==void 0&&Z.mipmaps.length>0?Z.mipmaps.length:Z.isCompressedTexture&&Array.isArray(Z.image)?j.mipmaps.length:1}function C(Z){const j=Z.target;j.removeEventListener("dispose",C),I(j),j.isVideoTexture&&c.delete(j)}function R(Z){const j=Z.target;j.removeEventListener("dispose",R),A(j)}function I(Z){const j=n.get(Z);if(j.__webglInit===void 0)return;const me=Z.source,Re=f.get(me);if(Re){const Pe=Re[j.__cacheKey];Pe.usedTimes--,Pe.usedTimes===0&&T(Z),Object.keys(Re).length===0&&f.delete(me)}n.remove(Z)}function T(Z){const j=n.get(Z);r.deleteTexture(j.__webglTexture);const me=Z.source,Re=f.get(me);delete Re[j.__cacheKey],a.memory.textures--}function A(Z){const j=n.get(Z);if(Z.depthTexture&&(Z.depthTexture.dispose(),n.remove(Z.depthTexture)),Z.isWebGLCubeRenderTarget)for(let Re=0;Re<6;Re++){if(Array.isArray(j.__webglFramebuffer[Re]))for(let Pe=0;Pe<j.__webglFramebuffer[Re].length;Pe++)r.deleteFramebuffer(j.__webglFramebuffer[Re][Pe]);else r.deleteFramebuffer(j.__webglFramebuffer[Re]);j.__webglDepthbuffer&&r.deleteRenderbuffer(j.__webglDepthbuffer[Re])}else{if(Array.isArray(j.__webglFramebuffer))for(let Re=0;Re<j.__webglFramebuffer.length;Re++)r.deleteFramebuffer(j.__webglFramebuffer[Re]);else r.deleteFramebuffer(j.__webglFramebuffer);if(j.__webglDepthbuffer&&r.deleteRenderbuffer(j.__webglDepthbuffer),j.__webglMultisampledFramebuffer&&r.deleteFramebuffer(j.__webglMultisampledFramebuffer),j.__webglColorRenderbuffer)for(let Re=0;Re<j.__webglColorRenderbuffer.length;Re++)j.__webglColorRenderbuffer[Re]&&r.deleteRenderbuffer(j.__webglColorRenderbuffer[Re]);j.__webglDepthRenderbuffer&&r.deleteRenderbuffer(j.__webglDepthRenderbuffer)}const me=Z.textures;for(let Re=0,Pe=me.length;Re<Pe;Re++){const ke=n.get(me[Re]);ke.__webglTexture&&(r.deleteTexture(ke.__webglTexture),a.memory.textures--),n.remove(me[Re])}n.remove(Z)}let N=0;function O(){N=0}function V(){const Z=N;return Z>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Z+" texture units while this GPU supports only "+i.maxTextures),N+=1,Z}function F(Z){const j=[];return j.push(Z.wrapS),j.push(Z.wrapT),j.push(Z.wrapR||0),j.push(Z.magFilter),j.push(Z.minFilter),j.push(Z.anisotropy),j.push(Z.internalFormat),j.push(Z.format),j.push(Z.type),j.push(Z.generateMipmaps),j.push(Z.premultiplyAlpha),j.push(Z.flipY),j.push(Z.unpackAlignment),j.push(Z.colorSpace),j.join()}function B(Z,j){const me=n.get(Z);if(Z.isVideoTexture&&ft(Z),Z.isRenderTargetTexture===!1&&Z.isExternalTexture!==!0&&Z.version>0&&me.__version!==Z.version){const Re=Z.image;if(Re===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Re.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{ne(me,Z,j);return}}else Z.isExternalTexture&&(me.__webglTexture=Z.sourceTexture?Z.sourceTexture:null);t.bindTexture(r.TEXTURE_2D,me.__webglTexture,r.TEXTURE0+j)}function U(Z,j){const me=n.get(Z);if(Z.isRenderTargetTexture===!1&&Z.version>0&&me.__version!==Z.version){ne(me,Z,j);return}t.bindTexture(r.TEXTURE_2D_ARRAY,me.__webglTexture,r.TEXTURE0+j)}function P(Z,j){const me=n.get(Z);if(Z.isRenderTargetTexture===!1&&Z.version>0&&me.__version!==Z.version){ne(me,Z,j);return}t.bindTexture(r.TEXTURE_3D,me.__webglTexture,r.TEXTURE0+j)}function L(Z,j){const me=n.get(Z);if(Z.version>0&&me.__version!==Z.version){ie(me,Z,j);return}t.bindTexture(r.TEXTURE_CUBE_MAP,me.__webglTexture,r.TEXTURE0+j)}const H={[Ob]:r.REPEAT,[Yu]:r.CLAMP_TO_EDGE,[Lb]:r.MIRRORED_REPEAT},W={[Uo]:r.NEAREST,[KH]:r.NEAREST_MIPMAP_NEAREST,[xp]:r.NEAREST_MIPMAP_LINEAR,[vi]:r.LINEAR,[l0]:r.LINEAR_MIPMAP_NEAREST,[Ku]:r.LINEAR_MIPMAP_LINEAR},z={[eG]:r.NEVER,[aG]:r.ALWAYS,[tG]:r.LESS,[$A]:r.LEQUAL,[nG]:r.EQUAL,[oG]:r.GEQUAL,[rG]:r.GREATER,[iG]:r.NOTEQUAL};function q(Z,j){if(j.type===Va&&e.has("OES_texture_float_linear")===!1&&(j.magFilter===vi||j.magFilter===l0||j.magFilter===xp||j.magFilter===Ku||j.minFilter===vi||j.minFilter===l0||j.minFilter===xp||j.minFilter===Ku)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(Z,r.TEXTURE_WRAP_S,H[j.wrapS]),r.texParameteri(Z,r.TEXTURE_WRAP_T,H[j.wrapT]),(Z===r.TEXTURE_3D||Z===r.TEXTURE_2D_ARRAY)&&r.texParameteri(Z,r.TEXTURE_WRAP_R,H[j.wrapR]),r.texParameteri(Z,r.TEXTURE_MAG_FILTER,W[j.magFilter]),r.texParameteri(Z,r.TEXTURE_MIN_FILTER,W[j.minFilter]),j.compareFunction&&(r.texParameteri(Z,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(Z,r.TEXTURE_COMPARE_FUNC,z[j.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(j.magFilter===Uo||j.minFilter!==xp&&j.minFilter!==Ku||j.type===Va&&e.has("OES_texture_float_linear")===!1)return;if(j.anisotropy>1||n.get(j).__currentAnisotropy){const me=e.get("EXT_texture_filter_anisotropic");r.texParameterf(Z,me.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(j.anisotropy,i.getMaxAnisotropy())),n.get(j).__currentAnisotropy=j.anisotropy}}}function re(Z,j){let me=!1;Z.__webglInit===void 0&&(Z.__webglInit=!0,j.addEventListener("dispose",C));const Re=j.source;let Pe=f.get(Re);Pe===void 0&&(Pe={},f.set(Re,Pe));const ke=F(j);if(ke!==Z.__cacheKey){Pe[ke]===void 0&&(Pe[ke]={texture:r.createTexture(),usedTimes:0},a.memory.textures++,me=!0),Pe[ke].usedTimes++;const Ue=Pe[Z.__cacheKey];Ue!==void 0&&(Pe[Z.__cacheKey].usedTimes--,Ue.usedTimes===0&&T(j)),Z.__cacheKey=ke,Z.__webglTexture=Pe[ke].texture}return me}function de(Z,j,me){return Math.floor(Math.floor(Z/me)/j)}function ye(Z,j,me,Re){const ke=Z.updateRanges;if(ke.length===0)t.texSubImage2D(r.TEXTURE_2D,0,0,0,j.width,j.height,me,Re,j.data);else{ke.sort((Oe,$e)=>Oe.start-$e.start);let Ue=0;for(let Oe=1;Oe<ke.length;Oe++){const $e=ke[Ue],pt=ke[Oe],nt=$e.start+$e.count,tt=de(pt.start,j.width,4),Nt=de($e.start,j.width,4);pt.start<=nt+1&&tt===Nt&&de(pt.start+pt.count-1,j.width,4)===tt?$e.count=Math.max($e.count,pt.start+pt.count-$e.start):(++Ue,ke[Ue]=pt)}ke.length=Ue+1;const _e=r.getParameter(r.UNPACK_ROW_LENGTH),rt=r.getParameter(r.UNPACK_SKIP_PIXELS),Ze=r.getParameter(r.UNPACK_SKIP_ROWS);r.pixelStorei(r.UNPACK_ROW_LENGTH,j.width);for(let Oe=0,$e=ke.length;Oe<$e;Oe++){const pt=ke[Oe],nt=Math.floor(pt.start/4),tt=Math.ceil(pt.count/4),Nt=nt%j.width,se=Math.floor(nt/j.width),He=tt,Ve=1;r.pixelStorei(r.UNPACK_SKIP_PIXELS,Nt),r.pixelStorei(r.UNPACK_SKIP_ROWS,se),t.texSubImage2D(r.TEXTURE_2D,0,Nt,se,He,Ve,me,Re,j.data)}Z.clearUpdateRanges(),r.pixelStorei(r.UNPACK_ROW_LENGTH,_e),r.pixelStorei(r.UNPACK_SKIP_PIXELS,rt),r.pixelStorei(r.UNPACK_SKIP_ROWS,Ze)}}function ne(Z,j,me){let Re=r.TEXTURE_2D;(j.isDataArrayTexture||j.isCompressedArrayTexture)&&(Re=r.TEXTURE_2D_ARRAY),j.isData3DTexture&&(Re=r.TEXTURE_3D);const Pe=re(Z,j),ke=j.source;t.bindTexture(Re,Z.__webglTexture,r.TEXTURE0+me);const Ue=n.get(ke);if(ke.version!==Ue.__version||Pe===!0){t.activeTexture(r.TEXTURE0+me);const _e=gn.getPrimaries(gn.workingColorSpace),rt=j.colorSpace===sa?null:gn.getPrimaries(j.colorSpace),Ze=j.colorSpace===sa||_e===rt?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,j.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,j.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ze);let Oe=w(j.image,!1,i.maxTextureSize);Oe=Mt(j,Oe);const $e=o.convert(j.format,j.colorSpace),pt=o.convert(j.type);let nt=E(j.internalFormat,$e,pt,j.colorSpace,j.isVideoTexture);q(Re,j);let tt;const Nt=j.mipmaps,se=j.isVideoTexture!==!0,He=Ue.__version===void 0||Pe===!0,Ve=ke.dataReady,it=k(j,Oe);if(j.isDepthTexture)nt=_(j.format===jc,j.type),He&&(se?t.texStorage2D(r.TEXTURE_2D,1,nt,Oe.width,Oe.height):t.texImage2D(r.TEXTURE_2D,0,nt,Oe.width,Oe.height,0,$e,pt,null));else if(j.isDataTexture)if(Nt.length>0){se&&He&&t.texStorage2D(r.TEXTURE_2D,it,nt,Nt[0].width,Nt[0].height);for(let We=0,Fe=Nt.length;We<Fe;We++)tt=Nt[We],se?Ve&&t.texSubImage2D(r.TEXTURE_2D,We,0,0,tt.width,tt.height,$e,pt,tt.data):t.texImage2D(r.TEXTURE_2D,We,nt,tt.width,tt.height,0,$e,pt,tt.data);j.generateMipmaps=!1}else se?(He&&t.texStorage2D(r.TEXTURE_2D,it,nt,Oe.width,Oe.height),Ve&&ye(j,Oe,$e,pt)):t.texImage2D(r.TEXTURE_2D,0,nt,Oe.width,Oe.height,0,$e,pt,Oe.data);else if(j.isCompressedTexture)if(j.isCompressedArrayTexture){se&&He&&t.texStorage3D(r.TEXTURE_2D_ARRAY,it,nt,Nt[0].width,Nt[0].height,Oe.depth);for(let We=0,Fe=Nt.length;We<Fe;We++)if(tt=Nt[We],j.format!==No)if($e!==null)if(se){if(Ve)if(j.layerUpdates.size>0){const gt=fk(tt.width,tt.height,j.format,j.type);for(const Ht of j.layerUpdates){const bn=tt.data.subarray(Ht*gt/tt.data.BYTES_PER_ELEMENT,(Ht+1)*gt/tt.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,We,0,0,Ht,tt.width,tt.height,1,$e,bn)}j.clearLayerUpdates()}else t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,We,0,0,0,tt.width,tt.height,Oe.depth,$e,tt.data)}else t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,We,nt,tt.width,tt.height,Oe.depth,0,tt.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else se?Ve&&t.texSubImage3D(r.TEXTURE_2D_ARRAY,We,0,0,0,tt.width,tt.height,Oe.depth,$e,pt,tt.data):t.texImage3D(r.TEXTURE_2D_ARRAY,We,nt,tt.width,tt.height,Oe.depth,0,$e,pt,tt.data)}else{se&&He&&t.texStorage2D(r.TEXTURE_2D,it,nt,Nt[0].width,Nt[0].height);for(let We=0,Fe=Nt.length;We<Fe;We++)tt=Nt[We],j.format!==No?$e!==null?se?Ve&&t.compressedTexSubImage2D(r.TEXTURE_2D,We,0,0,tt.width,tt.height,$e,tt.data):t.compressedTexImage2D(r.TEXTURE_2D,We,nt,tt.width,tt.height,0,tt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):se?Ve&&t.texSubImage2D(r.TEXTURE_2D,We,0,0,tt.width,tt.height,$e,pt,tt.data):t.texImage2D(r.TEXTURE_2D,We,nt,tt.width,tt.height,0,$e,pt,tt.data)}else if(j.isDataArrayTexture)if(se){if(He&&t.texStorage3D(r.TEXTURE_2D_ARRAY,it,nt,Oe.width,Oe.height,Oe.depth),Ve)if(j.layerUpdates.size>0){const We=fk(Oe.width,Oe.height,j.format,j.type);for(const Fe of j.layerUpdates){const gt=Oe.data.subarray(Fe*We/Oe.data.BYTES_PER_ELEMENT,(Fe+1)*We/Oe.data.BYTES_PER_ELEMENT);t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,Fe,Oe.width,Oe.height,1,$e,pt,gt)}j.clearLayerUpdates()}else t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,Oe.width,Oe.height,Oe.depth,$e,pt,Oe.data)}else t.texImage3D(r.TEXTURE_2D_ARRAY,0,nt,Oe.width,Oe.height,Oe.depth,0,$e,pt,Oe.data);else if(j.isData3DTexture)se?(He&&t.texStorage3D(r.TEXTURE_3D,it,nt,Oe.width,Oe.height,Oe.depth),Ve&&t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,Oe.width,Oe.height,Oe.depth,$e,pt,Oe.data)):t.texImage3D(r.TEXTURE_3D,0,nt,Oe.width,Oe.height,Oe.depth,0,$e,pt,Oe.data);else if(j.isFramebufferTexture){if(He)if(se)t.texStorage2D(r.TEXTURE_2D,it,nt,Oe.width,Oe.height);else{let We=Oe.width,Fe=Oe.height;for(let gt=0;gt<it;gt++)t.texImage2D(r.TEXTURE_2D,gt,nt,We,Fe,0,$e,pt,null),We>>=1,Fe>>=1}}else if(Nt.length>0){if(se&&He){const We=Ut(Nt[0]);t.texStorage2D(r.TEXTURE_2D,it,nt,We.width,We.height)}for(let We=0,Fe=Nt.length;We<Fe;We++)tt=Nt[We],se?Ve&&t.texSubImage2D(r.TEXTURE_2D,We,0,0,$e,pt,tt):t.texImage2D(r.TEXTURE_2D,We,nt,$e,pt,tt);j.generateMipmaps=!1}else if(se){if(He){const We=Ut(Oe);t.texStorage2D(r.TEXTURE_2D,it,nt,We.width,We.height)}Ve&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,$e,pt,Oe)}else t.texImage2D(r.TEXTURE_2D,0,nt,$e,pt,Oe);v(j)&&y(Re),Ue.__version=ke.version,j.onUpdate&&j.onUpdate(j)}Z.__version=j.version}function ie(Z,j,me){if(j.image.length!==6)return;const Re=re(Z,j),Pe=j.source;t.bindTexture(r.TEXTURE_CUBE_MAP,Z.__webglTexture,r.TEXTURE0+me);const ke=n.get(Pe);if(Pe.version!==ke.__version||Re===!0){t.activeTexture(r.TEXTURE0+me);const Ue=gn.getPrimaries(gn.workingColorSpace),_e=j.colorSpace===sa?null:gn.getPrimaries(j.colorSpace),rt=j.colorSpace===sa||Ue===_e?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,j.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,j.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,j.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,rt);const Ze=j.isCompressedTexture||j.image[0].isCompressedTexture,Oe=j.image[0]&&j.image[0].isDataTexture,$e=[];for(let Fe=0;Fe<6;Fe++)!Ze&&!Oe?$e[Fe]=w(j.image[Fe],!0,i.maxCubemapSize):$e[Fe]=Oe?j.image[Fe].image:j.image[Fe],$e[Fe]=Mt(j,$e[Fe]);const pt=$e[0],nt=o.convert(j.format,j.colorSpace),tt=o.convert(j.type),Nt=E(j.internalFormat,nt,tt,j.colorSpace),se=j.isVideoTexture!==!0,He=ke.__version===void 0||Re===!0,Ve=Pe.dataReady;let it=k(j,pt);q(r.TEXTURE_CUBE_MAP,j);let We;if(Ze){se&&He&&t.texStorage2D(r.TEXTURE_CUBE_MAP,it,Nt,pt.width,pt.height);for(let Fe=0;Fe<6;Fe++){We=$e[Fe].mipmaps;for(let gt=0;gt<We.length;gt++){const Ht=We[gt];j.format!==No?nt!==null?se?Ve&&t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,0,0,Ht.width,Ht.height,nt,Ht.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,Nt,Ht.width,Ht.height,0,Ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):se?Ve&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,0,0,Ht.width,Ht.height,nt,tt,Ht.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt,Nt,Ht.width,Ht.height,0,nt,tt,Ht.data)}}}else{if(We=j.mipmaps,se&&He){We.length>0&&it++;const Fe=Ut($e[0]);t.texStorage2D(r.TEXTURE_CUBE_MAP,it,Nt,Fe.width,Fe.height)}for(let Fe=0;Fe<6;Fe++)if(Oe){se?Ve&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,0,0,$e[Fe].width,$e[Fe].height,nt,tt,$e[Fe].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,Nt,$e[Fe].width,$e[Fe].height,0,nt,tt,$e[Fe].data);for(let gt=0;gt<We.length;gt++){const bn=We[gt].image[Fe].image;se?Ve&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,0,0,bn.width,bn.height,nt,tt,bn.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,Nt,bn.width,bn.height,0,nt,tt,bn.data)}}else{se?Ve&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,0,0,nt,tt,$e[Fe]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,0,Nt,nt,tt,$e[Fe]);for(let gt=0;gt<We.length;gt++){const Ht=We[gt];se?Ve&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,0,0,nt,tt,Ht.image[Fe]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Fe,gt+1,Nt,nt,tt,Ht.image[Fe])}}}v(j)&&y(r.TEXTURE_CUBE_MAP),ke.__version=Pe.version,j.onUpdate&&j.onUpdate(j)}Z.__version=j.version}function fe(Z,j,me,Re,Pe,ke){const Ue=o.convert(me.format,me.colorSpace),_e=o.convert(me.type),rt=E(me.internalFormat,Ue,_e,me.colorSpace),Ze=n.get(j),Oe=n.get(me);if(Oe.__renderTarget=j,!Ze.__hasExternalTextures){const $e=Math.max(1,j.width>>ke),pt=Math.max(1,j.height>>ke);Pe===r.TEXTURE_3D||Pe===r.TEXTURE_2D_ARRAY?t.texImage3D(Pe,ke,rt,$e,pt,j.depth,0,Ue,_e,null):t.texImage2D(Pe,ke,rt,$e,pt,0,Ue,_e,null)}t.bindFramebuffer(r.FRAMEBUFFER,Z),Qe(j)?s.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Re,Pe,Oe.__webglTexture,0,Tt(j)):(Pe===r.TEXTURE_2D||Pe>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&Pe<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Re,Pe,Oe.__webglTexture,ke),t.bindFramebuffer(r.FRAMEBUFFER,null)}function Ae(Z,j,me){if(r.bindRenderbuffer(r.RENDERBUFFER,Z),j.depthBuffer){const Re=j.depthTexture,Pe=Re&&Re.isDepthTexture?Re.type:null,ke=_(j.stencilBuffer,Pe),Ue=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,_e=Tt(j);Qe(j)?s.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,_e,ke,j.width,j.height):me?r.renderbufferStorageMultisample(r.RENDERBUFFER,_e,ke,j.width,j.height):r.renderbufferStorage(r.RENDERBUFFER,ke,j.width,j.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,Ue,r.RENDERBUFFER,Z)}else{const Re=j.textures;for(let Pe=0;Pe<Re.length;Pe++){const ke=Re[Pe],Ue=o.convert(ke.format,ke.colorSpace),_e=o.convert(ke.type),rt=E(ke.internalFormat,Ue,_e,ke.colorSpace),Ze=Tt(j);me&&Qe(j)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,Ze,rt,j.width,j.height):Qe(j)?s.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,Ze,rt,j.width,j.height):r.renderbufferStorage(r.RENDERBUFFER,rt,j.width,j.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function De(Z,j){if(j&&j.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,Z),!(j.depthTexture&&j.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Re=n.get(j.depthTexture);Re.__renderTarget=j,(!Re.__webglTexture||j.depthTexture.image.width!==j.width||j.depthTexture.image.height!==j.height)&&(j.depthTexture.image.width=j.width,j.depthTexture.image.height=j.height,j.depthTexture.needsUpdate=!0),B(j.depthTexture,0);const Pe=Re.__webglTexture,ke=Tt(j);if(j.depthTexture.format===sd)Qe(j)?s.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Pe,0,ke):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,Pe,0);else if(j.depthTexture.format===jc)Qe(j)?s.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Pe,0,ke):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,Pe,0);else throw new Error("Unknown depthTexture format")}function Be(Z){const j=n.get(Z),me=Z.isWebGLCubeRenderTarget===!0;if(j.__boundDepthTexture!==Z.depthTexture){const Re=Z.depthTexture;if(j.__depthDisposeCallback&&j.__depthDisposeCallback(),Re){const Pe=()=>{delete j.__boundDepthTexture,delete j.__depthDisposeCallback,Re.removeEventListener("dispose",Pe)};Re.addEventListener("dispose",Pe),j.__depthDisposeCallback=Pe}j.__boundDepthTexture=Re}if(Z.depthTexture&&!j.__autoAllocateDepthBuffer){if(me)throw new Error("target.depthTexture not supported in Cube render targets");const Re=Z.texture.mipmaps;Re&&Re.length>0?De(j.__webglFramebuffer[0],Z):De(j.__webglFramebuffer,Z)}else if(me){j.__webglDepthbuffer=[];for(let Re=0;Re<6;Re++)if(t.bindFramebuffer(r.FRAMEBUFFER,j.__webglFramebuffer[Re]),j.__webglDepthbuffer[Re]===void 0)j.__webglDepthbuffer[Re]=r.createRenderbuffer(),Ae(j.__webglDepthbuffer[Re],Z,!1);else{const Pe=Z.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ke=j.__webglDepthbuffer[Re];r.bindRenderbuffer(r.RENDERBUFFER,ke),r.framebufferRenderbuffer(r.FRAMEBUFFER,Pe,r.RENDERBUFFER,ke)}}else{const Re=Z.texture.mipmaps;if(Re&&Re.length>0?t.bindFramebuffer(r.FRAMEBUFFER,j.__webglFramebuffer[0]):t.bindFramebuffer(r.FRAMEBUFFER,j.__webglFramebuffer),j.__webglDepthbuffer===void 0)j.__webglDepthbuffer=r.createRenderbuffer(),Ae(j.__webglDepthbuffer,Z,!1);else{const Pe=Z.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ke=j.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,ke),r.framebufferRenderbuffer(r.FRAMEBUFFER,Pe,r.RENDERBUFFER,ke)}}t.bindFramebuffer(r.FRAMEBUFFER,null)}function lt(Z,j,me){const Re=n.get(Z);j!==void 0&&fe(Re.__webglFramebuffer,Z,Z.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),me!==void 0&&Be(Z)}function Y(Z){const j=Z.texture,me=n.get(Z),Re=n.get(j);Z.addEventListener("dispose",R);const Pe=Z.textures,ke=Z.isWebGLCubeRenderTarget===!0,Ue=Pe.length>1;if(Ue||(Re.__webglTexture===void 0&&(Re.__webglTexture=r.createTexture()),Re.__version=j.version,a.memory.textures++),ke){me.__webglFramebuffer=[];for(let _e=0;_e<6;_e++)if(j.mipmaps&&j.mipmaps.length>0){me.__webglFramebuffer[_e]=[];for(let rt=0;rt<j.mipmaps.length;rt++)me.__webglFramebuffer[_e][rt]=r.createFramebuffer()}else me.__webglFramebuffer[_e]=r.createFramebuffer()}else{if(j.mipmaps&&j.mipmaps.length>0){me.__webglFramebuffer=[];for(let _e=0;_e<j.mipmaps.length;_e++)me.__webglFramebuffer[_e]=r.createFramebuffer()}else me.__webglFramebuffer=r.createFramebuffer();if(Ue)for(let _e=0,rt=Pe.length;_e<rt;_e++){const Ze=n.get(Pe[_e]);Ze.__webglTexture===void 0&&(Ze.__webglTexture=r.createTexture(),a.memory.textures++)}if(Z.samples>0&&Qe(Z)===!1){me.__webglMultisampledFramebuffer=r.createFramebuffer(),me.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,me.__webglMultisampledFramebuffer);for(let _e=0;_e<Pe.length;_e++){const rt=Pe[_e];me.__webglColorRenderbuffer[_e]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,me.__webglColorRenderbuffer[_e]);const Ze=o.convert(rt.format,rt.colorSpace),Oe=o.convert(rt.type),$e=E(rt.internalFormat,Ze,Oe,rt.colorSpace,Z.isXRRenderTarget===!0),pt=Tt(Z);r.renderbufferStorageMultisample(r.RENDERBUFFER,pt,$e,Z.width,Z.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+_e,r.RENDERBUFFER,me.__webglColorRenderbuffer[_e])}r.bindRenderbuffer(r.RENDERBUFFER,null),Z.depthBuffer&&(me.__webglDepthRenderbuffer=r.createRenderbuffer(),Ae(me.__webglDepthRenderbuffer,Z,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(ke){t.bindTexture(r.TEXTURE_CUBE_MAP,Re.__webglTexture),q(r.TEXTURE_CUBE_MAP,j);for(let _e=0;_e<6;_e++)if(j.mipmaps&&j.mipmaps.length>0)for(let rt=0;rt<j.mipmaps.length;rt++)fe(me.__webglFramebuffer[_e][rt],Z,j,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,rt);else fe(me.__webglFramebuffer[_e],Z,j,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+_e,0);v(j)&&y(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(Ue){for(let _e=0,rt=Pe.length;_e<rt;_e++){const Ze=Pe[_e],Oe=n.get(Ze);let $e=r.TEXTURE_2D;(Z.isWebGL3DRenderTarget||Z.isWebGLArrayRenderTarget)&&($e=Z.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture($e,Oe.__webglTexture),q($e,Ze),fe(me.__webglFramebuffer,Z,Ze,r.COLOR_ATTACHMENT0+_e,$e,0),v(Ze)&&y($e)}t.unbindTexture()}else{let _e=r.TEXTURE_2D;if((Z.isWebGL3DRenderTarget||Z.isWebGLArrayRenderTarget)&&(_e=Z.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(_e,Re.__webglTexture),q(_e,j),j.mipmaps&&j.mipmaps.length>0)for(let rt=0;rt<j.mipmaps.length;rt++)fe(me.__webglFramebuffer[rt],Z,j,r.COLOR_ATTACHMENT0,_e,rt);else fe(me.__webglFramebuffer,Z,j,r.COLOR_ATTACHMENT0,_e,0);v(j)&&y(_e),t.unbindTexture()}Z.depthBuffer&&Be(Z)}function ot(Z){const j=Z.textures;for(let me=0,Re=j.length;me<Re;me++){const Pe=j[me];if(v(Pe)){const ke=x(Z),Ue=n.get(Pe).__webglTexture;t.bindTexture(ke,Ue),y(ke),t.unbindTexture()}}}const Je=[],Xe=[];function qe(Z){if(Z.samples>0){if(Qe(Z)===!1){const j=Z.textures,me=Z.width,Re=Z.height;let Pe=r.COLOR_BUFFER_BIT;const ke=Z.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Ue=n.get(Z),_e=j.length>1;if(_e)for(let Ze=0;Ze<j.length;Ze++)t.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ze,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ze,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer);const rt=Z.texture.mipmaps;rt&&rt.length>0?t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ue.__webglFramebuffer[0]):t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ue.__webglFramebuffer);for(let Ze=0;Ze<j.length;Ze++){if(Z.resolveDepthBuffer&&(Z.depthBuffer&&(Pe|=r.DEPTH_BUFFER_BIT),Z.stencilBuffer&&Z.resolveStencilBuffer&&(Pe|=r.STENCIL_BUFFER_BIT)),_e){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,Ue.__webglColorRenderbuffer[Ze]);const Oe=n.get(j[Ze]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,Oe,0)}r.blitFramebuffer(0,0,me,Re,0,0,me,Re,Pe,r.NEAREST),u===!0&&(Je.length=0,Xe.length=0,Je.push(r.COLOR_ATTACHMENT0+Ze),Z.depthBuffer&&Z.resolveDepthBuffer===!1&&(Je.push(ke),Xe.push(ke),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,Xe)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,Je))}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),_e)for(let Ze=0;Ze<j.length;Ze++){t.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ze,r.RENDERBUFFER,Ue.__webglColorRenderbuffer[Ze]);const Oe=n.get(j[Ze]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,Ue.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+Ze,r.TEXTURE_2D,Oe,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,Ue.__webglMultisampledFramebuffer)}else if(Z.depthBuffer&&Z.resolveDepthBuffer===!1&&u){const j=Z.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[j])}}}function Tt(Z){return Math.min(i.maxSamples,Z.samples)}function Qe(Z){const j=n.get(Z);return Z.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&j.__useRenderToTexture!==!1}function ft(Z){const j=a.render.frame;c.get(Z)!==j&&(c.set(Z,j),Z.update())}function Mt(Z,j){const me=Z.colorSpace,Re=Z.format,Pe=Z.type;return Z.isCompressedTexture===!0||Z.isVideoTexture===!0||me!==ru&&me!==sa&&(gn.getTransfer(me)===Mn?(Re!==No||Pe!==$r)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",me)),j}function Ut(Z){return typeof HTMLImageElement<"u"&&Z instanceof HTMLImageElement?(l.width=Z.naturalWidth||Z.width,l.height=Z.naturalHeight||Z.height):typeof VideoFrame<"u"&&Z instanceof VideoFrame?(l.width=Z.displayWidth,l.height=Z.displayHeight):(l.width=Z.width,l.height=Z.height),l}this.allocateTextureUnit=V,this.resetTextureUnits=O,this.setTexture2D=B,this.setTexture2DArray=U,this.setTexture3D=P,this.setTextureCube=L,this.rebindTextures=lt,this.setupRenderTarget=Y,this.updateRenderTargetMipmap=ot,this.updateMultisampleRenderTarget=qe,this.setupDepthRenderbuffer=Be,this.setupFrameBufferTexture=fe,this.useMultisampledRTT=Qe}function RX(r,e){function t(n,i=sa){let o;const a=gn.getTransfer(i);if(n===$r)return r.UNSIGNED_BYTE;if(n===W1)return r.UNSIGNED_SHORT_4_4_4_4;if(n===H1)return r.UNSIGNED_SHORT_5_5_5_1;if(n===WA)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===HA)return r.UNSIGNED_INT_10F_11F_11F_REV;if(n===UA)return r.BYTE;if(n===zA)return r.SHORT;if(n===ad)return r.UNSIGNED_SHORT;if(n===z1)return r.INT;if(n===nu)return r.UNSIGNED_INT;if(n===Va)return r.FLOAT;if(n===Fd)return r.HALF_FLOAT;if(n===GA)return r.ALPHA;if(n===VA)return r.RGB;if(n===No)return r.RGBA;if(n===sd)return r.DEPTH_COMPONENT;if(n===jc)return r.DEPTH_STENCIL;if(n===jA)return r.RED;if(n===G1)return r.RED_INTEGER;if(n===qA)return r.RG;if(n===V1)return r.RG_INTEGER;if(n===j1)return r.RGBA_INTEGER;if(n===Qp||n===em||n===tm||n===nm)if(a===Mn)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(n===Qp)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===em)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===tm)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===nm)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(n===Qp)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===em)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===tm)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===nm)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===Bb||n===Ub||n===zb||n===Wb)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(n===Bb)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Ub)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===zb)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Wb)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===Hb||n===Gb||n===Vb)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(n===Hb||n===Gb)return a===Mn?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(n===Vb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===jb||n===qb||n===$b||n===Xb||n===Yb||n===Kb||n===Jb||n===Zb||n===Qb||n===ew||n===tw||n===nw||n===rw||n===iw)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(n===jb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===qb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===$b)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Xb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Yb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Kb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===Jb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===Zb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===Qb)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===ew)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===tw)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===nw)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===rw)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===iw)return a===Mn?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===ow||n===aw||n===sw)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(n===ow)return a===Mn?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===aw)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===sw)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===uw||n===lw||n===cw||n===hw)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(n===uw)return o.COMPRESSED_RED_RGTC1_EXT;if(n===lw)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===cw)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===hw)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Vc?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:t}}const IX=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,DX=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class NX{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new oR(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Xr({vertexShader:IX,fragmentShader:DX,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Po(new zd(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class PX extends ss{constructor(e,t){super();const n=this;let i=null,o=1,a=null,s="local-floor",u=1,l=null,c=null,h=null,f=null,m=null,g=null;const w=typeof XRWebGLBinding<"u",v=new NX,y={},x=t.getContextAttributes();let E=null,_=null;const k=[],C=[],R=new Wt;let I=null;const T=new to;T.viewport=new Hn;const A=new to;A.viewport=new Hn;const N=[T,A],O=new tV;let V=null,F=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(ne){let ie=k[ne];return ie===void 0&&(ie=new R0,k[ne]=ie),ie.getTargetRaySpace()},this.getControllerGrip=function(ne){let ie=k[ne];return ie===void 0&&(ie=new R0,k[ne]=ie),ie.getGripSpace()},this.getHand=function(ne){let ie=k[ne];return ie===void 0&&(ie=new R0,k[ne]=ie),ie.getHandSpace()};function B(ne){const ie=C.indexOf(ne.inputSource);if(ie===-1)return;const fe=k[ie];fe!==void 0&&(fe.update(ne.inputSource,ne.frame,l||a),fe.dispatchEvent({type:ne.type,data:ne.inputSource}))}function U(){i.removeEventListener("select",B),i.removeEventListener("selectstart",B),i.removeEventListener("selectend",B),i.removeEventListener("squeeze",B),i.removeEventListener("squeezestart",B),i.removeEventListener("squeezeend",B),i.removeEventListener("end",U),i.removeEventListener("inputsourceschange",P);for(let ne=0;ne<k.length;ne++){const ie=C[ne];ie!==null&&(C[ne]=null,k[ne].disconnect(ie))}V=null,F=null,v.reset();for(const ne in y)delete y[ne];e.setRenderTarget(E),m=null,f=null,h=null,i=null,_=null,ye.stop(),n.isPresenting=!1,e.setPixelRatio(I),e.setSize(R.width,R.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(ne){o=ne,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(ne){s=ne,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||a},this.setReferenceSpace=function(ne){l=ne},this.getBaseLayer=function(){return f!==null?f:m},this.getBinding=function(){return h===null&&w&&(h=new XRWebGLBinding(i,t)),h},this.getFrame=function(){return g},this.getSession=function(){return i},this.setSession=async function(ne){if(i=ne,i!==null){if(E=e.getRenderTarget(),i.addEventListener("select",B),i.addEventListener("selectstart",B),i.addEventListener("selectend",B),i.addEventListener("squeeze",B),i.addEventListener("squeezestart",B),i.addEventListener("squeezeend",B),i.addEventListener("end",U),i.addEventListener("inputsourceschange",P),x.xrCompatible!==!0&&await t.makeXRCompatible(),I=e.getPixelRatio(),e.getSize(R),w&&"createProjectionLayer"in XRWebGLBinding.prototype){let fe=null,Ae=null,De=null;x.depth&&(De=x.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,fe=x.stencil?jc:sd,Ae=x.stencil?Vc:nu);const Be={colorFormat:t.RGBA8,depthFormat:De,scaleFactor:o};h=this.getBinding(),f=h.createProjectionLayer(Be),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),_=new ii(f.textureWidth,f.textureHeight,{format:No,type:$r,depthTexture:new Y1(f.textureWidth,f.textureHeight,Ae,void 0,void 0,void 0,void 0,void 0,void 0,fe),stencilBuffer:x.stencil,colorSpace:e.outputColorSpace,samples:x.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const fe={antialias:x.antialias,alpha:!0,depth:x.depth,stencil:x.stencil,framebufferScaleFactor:o};m=new XRWebGLLayer(i,t,fe),i.updateRenderState({baseLayer:m}),e.setPixelRatio(1),e.setSize(m.framebufferWidth,m.framebufferHeight,!1),_=new ii(m.framebufferWidth,m.framebufferHeight,{format:No,type:$r,colorSpace:e.outputColorSpace,stencilBuffer:x.stencil,resolveDepthBuffer:m.ignoreDepthValues===!1,resolveStencilBuffer:m.ignoreDepthValues===!1})}_.isXRRenderTarget=!0,this.setFoveation(u),l=null,a=await i.requestReferenceSpace(s),ye.setContext(i),ye.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return v.getDepthTexture()};function P(ne){for(let ie=0;ie<ne.removed.length;ie++){const fe=ne.removed[ie],Ae=C.indexOf(fe);Ae>=0&&(C[Ae]=null,k[Ae].disconnect(fe))}for(let ie=0;ie<ne.added.length;ie++){const fe=ne.added[ie];let Ae=C.indexOf(fe);if(Ae===-1){for(let Be=0;Be<k.length;Be++)if(Be>=C.length){C.push(fe),Ae=Be;break}else if(C[Be]===null){C[Be]=fe,Ae=Be;break}if(Ae===-1)break}const De=k[Ae];De&&De.connect(fe)}}const L=new Te,H=new Te;function W(ne,ie,fe){L.setFromMatrixPosition(ie.matrixWorld),H.setFromMatrixPosition(fe.matrixWorld);const Ae=L.distanceTo(H),De=ie.projectionMatrix.elements,Be=fe.projectionMatrix.elements,lt=De[14]/(De[10]-1),Y=De[14]/(De[10]+1),ot=(De[9]+1)/De[5],Je=(De[9]-1)/De[5],Xe=(De[8]-1)/De[0],qe=(Be[8]+1)/Be[0],Tt=lt*Xe,Qe=lt*qe,ft=Ae/(-Xe+qe),Mt=ft*-Xe;if(ie.matrixWorld.decompose(ne.position,ne.quaternion,ne.scale),ne.translateX(Mt),ne.translateZ(ft),ne.matrixWorld.compose(ne.position,ne.quaternion,ne.scale),ne.matrixWorldInverse.copy(ne.matrixWorld).invert(),De[10]===-1)ne.projectionMatrix.copy(ie.projectionMatrix),ne.projectionMatrixInverse.copy(ie.projectionMatrixInverse);else{const Ut=lt+ft,Z=Y+ft,j=Tt-Mt,me=Qe+(Ae-Mt),Re=ot*Y/Z*Ut,Pe=Je*Y/Z*Ut;ne.projectionMatrix.makePerspective(j,me,Re,Pe,Ut,Z),ne.projectionMatrixInverse.copy(ne.projectionMatrix).invert()}}function z(ne,ie){ie===null?ne.matrixWorld.copy(ne.matrix):ne.matrixWorld.multiplyMatrices(ie.matrixWorld,ne.matrix),ne.matrixWorldInverse.copy(ne.matrixWorld).invert()}this.updateCamera=function(ne){if(i===null)return;let ie=ne.near,fe=ne.far;v.texture!==null&&(v.depthNear>0&&(ie=v.depthNear),v.depthFar>0&&(fe=v.depthFar)),O.near=A.near=T.near=ie,O.far=A.far=T.far=fe,(V!==O.near||F!==O.far)&&(i.updateRenderState({depthNear:O.near,depthFar:O.far}),V=O.near,F=O.far),O.layers.mask=ne.layers.mask|6,T.layers.mask=O.layers.mask&3,A.layers.mask=O.layers.mask&5;const Ae=ne.parent,De=O.cameras;z(O,Ae);for(let Be=0;Be<De.length;Be++)z(De[Be],Ae);De.length===2?W(O,T,A):O.projectionMatrix.copy(T.projectionMatrix),q(ne,O,Ae)};function q(ne,ie,fe){fe===null?ne.matrix.copy(ie.matrixWorld):(ne.matrix.copy(fe.matrixWorld),ne.matrix.invert(),ne.matrix.multiply(ie.matrixWorld)),ne.matrix.decompose(ne.position,ne.quaternion,ne.scale),ne.updateMatrixWorld(!0),ne.projectionMatrix.copy(ie.projectionMatrix),ne.projectionMatrixInverse.copy(ie.projectionMatrixInverse),ne.isPerspectiveCamera&&(ne.fov=ud*2*Math.atan(1/ne.projectionMatrix.elements[5]),ne.zoom=1)}this.getCamera=function(){return O},this.getFoveation=function(){if(!(f===null&&m===null))return u},this.setFoveation=function(ne){u=ne,f!==null&&(f.fixedFoveation=ne),m!==null&&m.fixedFoveation!==void 0&&(m.fixedFoveation=ne)},this.hasDepthSensing=function(){return v.texture!==null},this.getDepthSensingMesh=function(){return v.getMesh(O)},this.getCameraTexture=function(ne){return y[ne]};let re=null;function de(ne,ie){if(c=ie.getViewerPose(l||a),g=ie,c!==null){const fe=c.views;m!==null&&(e.setRenderTargetFramebuffer(_,m.framebuffer),e.setRenderTarget(_));let Ae=!1;fe.length!==O.cameras.length&&(O.cameras.length=0,Ae=!0);for(let Y=0;Y<fe.length;Y++){const ot=fe[Y];let Je=null;if(m!==null)Je=m.getViewport(ot);else{const qe=h.getViewSubImage(f,ot);Je=qe.viewport,Y===0&&(e.setRenderTargetTextures(_,qe.colorTexture,qe.depthStencilTexture),e.setRenderTarget(_))}let Xe=N[Y];Xe===void 0&&(Xe=new to,Xe.layers.enable(Y),Xe.viewport=new Hn,N[Y]=Xe),Xe.matrix.fromArray(ot.transform.matrix),Xe.matrix.decompose(Xe.position,Xe.quaternion,Xe.scale),Xe.projectionMatrix.fromArray(ot.projectionMatrix),Xe.projectionMatrixInverse.copy(Xe.projectionMatrix).invert(),Xe.viewport.set(Je.x,Je.y,Je.width,Je.height),Y===0&&(O.matrix.copy(Xe.matrix),O.matrix.decompose(O.position,O.quaternion,O.scale)),Ae===!0&&O.cameras.push(Xe)}const De=i.enabledFeatures;if(De&&De.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&w){h=n.getBinding();const Y=h.getDepthInformation(fe[0]);Y&&Y.isValid&&Y.texture&&v.init(Y,i.renderState)}if(De&&De.includes("camera-access")&&w){e.state.unbindTexture(),h=n.getBinding();for(let Y=0;Y<fe.length;Y++){const ot=fe[Y].camera;if(ot){let Je=y[ot];Je||(Je=new oR,y[ot]=Je);const Xe=h.getCameraImage(ot);Je.sourceTexture=Xe}}}}for(let fe=0;fe<k.length;fe++){const Ae=C[fe],De=k[fe];Ae!==null&&De!==void 0&&De.update(Ae,ie,l||a)}re&&re(ne,ie),ie.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:ie}),g=null}const ye=new aR;ye.setAnimationLoop(de),this.setAnimationLoop=function(ne){re=ne},this.dispose=function(){}}}const Nu=new Ka,FX=new sr;function OX(r,e){function t(v,y){v.matrixAutoUpdate===!0&&v.updateMatrix(),y.value.copy(v.matrix)}function n(v,y){y.color.getRGB(v.fogColor.value,tR(r)),y.isFog?(v.fogNear.value=y.near,v.fogFar.value=y.far):y.isFogExp2&&(v.fogDensity.value=y.density)}function i(v,y,x,E,_){y.isMeshBasicMaterial||y.isMeshLambertMaterial?o(v,y):y.isMeshToonMaterial?(o(v,y),h(v,y)):y.isMeshPhongMaterial?(o(v,y),c(v,y)):y.isMeshStandardMaterial?(o(v,y),f(v,y),y.isMeshPhysicalMaterial&&m(v,y,_)):y.isMeshMatcapMaterial?(o(v,y),g(v,y)):y.isMeshDepthMaterial?o(v,y):y.isMeshDistanceMaterial?(o(v,y),w(v,y)):y.isMeshNormalMaterial?o(v,y):y.isLineBasicMaterial?(a(v,y),y.isLineDashedMaterial&&s(v,y)):y.isPointsMaterial?u(v,y,x,E):y.isSpriteMaterial?l(v,y):y.isShadowMaterial?(v.color.value.copy(y.color),v.opacity.value=y.opacity):y.isShaderMaterial&&(y.uniformsNeedUpdate=!1)}function o(v,y){v.opacity.value=y.opacity,y.color&&v.diffuse.value.copy(y.color),y.emissive&&v.emissive.value.copy(y.emissive).multiplyScalar(y.emissiveIntensity),y.map&&(v.map.value=y.map,t(y.map,v.mapTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.bumpMap&&(v.bumpMap.value=y.bumpMap,t(y.bumpMap,v.bumpMapTransform),v.bumpScale.value=y.bumpScale,y.side===br&&(v.bumpScale.value*=-1)),y.normalMap&&(v.normalMap.value=y.normalMap,t(y.normalMap,v.normalMapTransform),v.normalScale.value.copy(y.normalScale),y.side===br&&v.normalScale.value.negate()),y.displacementMap&&(v.displacementMap.value=y.displacementMap,t(y.displacementMap,v.displacementMapTransform),v.displacementScale.value=y.displacementScale,v.displacementBias.value=y.displacementBias),y.emissiveMap&&(v.emissiveMap.value=y.emissiveMap,t(y.emissiveMap,v.emissiveMapTransform)),y.specularMap&&(v.specularMap.value=y.specularMap,t(y.specularMap,v.specularMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest);const x=e.get(y),E=x.envMap,_=x.envMapRotation;E&&(v.envMap.value=E,Nu.copy(_),Nu.x*=-1,Nu.y*=-1,Nu.z*=-1,E.isCubeTexture&&E.isRenderTargetTexture===!1&&(Nu.y*=-1,Nu.z*=-1),v.envMapRotation.value.setFromMatrix4(FX.makeRotationFromEuler(Nu)),v.flipEnvMap.value=E.isCubeTexture&&E.isRenderTargetTexture===!1?-1:1,v.reflectivity.value=y.reflectivity,v.ior.value=y.ior,v.refractionRatio.value=y.refractionRatio),y.lightMap&&(v.lightMap.value=y.lightMap,v.lightMapIntensity.value=y.lightMapIntensity,t(y.lightMap,v.lightMapTransform)),y.aoMap&&(v.aoMap.value=y.aoMap,v.aoMapIntensity.value=y.aoMapIntensity,t(y.aoMap,v.aoMapTransform))}function a(v,y){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,y.map&&(v.map.value=y.map,t(y.map,v.mapTransform))}function s(v,y){v.dashSize.value=y.dashSize,v.totalSize.value=y.dashSize+y.gapSize,v.scale.value=y.scale}function u(v,y,x,E){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,v.size.value=y.size*x,v.scale.value=E*.5,y.map&&(v.map.value=y.map,t(y.map,v.uvTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest)}function l(v,y){v.diffuse.value.copy(y.color),v.opacity.value=y.opacity,v.rotation.value=y.rotation,y.map&&(v.map.value=y.map,t(y.map,v.mapTransform)),y.alphaMap&&(v.alphaMap.value=y.alphaMap,t(y.alphaMap,v.alphaMapTransform)),y.alphaTest>0&&(v.alphaTest.value=y.alphaTest)}function c(v,y){v.specular.value.copy(y.specular),v.shininess.value=Math.max(y.shininess,1e-4)}function h(v,y){y.gradientMap&&(v.gradientMap.value=y.gradientMap)}function f(v,y){v.metalness.value=y.metalness,y.metalnessMap&&(v.metalnessMap.value=y.metalnessMap,t(y.metalnessMap,v.metalnessMapTransform)),v.roughness.value=y.roughness,y.roughnessMap&&(v.roughnessMap.value=y.roughnessMap,t(y.roughnessMap,v.roughnessMapTransform)),y.envMap&&(v.envMapIntensity.value=y.envMapIntensity)}function m(v,y,x){v.ior.value=y.ior,y.sheen>0&&(v.sheenColor.value.copy(y.sheenColor).multiplyScalar(y.sheen),v.sheenRoughness.value=y.sheenRoughness,y.sheenColorMap&&(v.sheenColorMap.value=y.sheenColorMap,t(y.sheenColorMap,v.sheenColorMapTransform)),y.sheenRoughnessMap&&(v.sheenRoughnessMap.value=y.sheenRoughnessMap,t(y.sheenRoughnessMap,v.sheenRoughnessMapTransform))),y.clearcoat>0&&(v.clearcoat.value=y.clearcoat,v.clearcoatRoughness.value=y.clearcoatRoughness,y.clearcoatMap&&(v.clearcoatMap.value=y.clearcoatMap,t(y.clearcoatMap,v.clearcoatMapTransform)),y.clearcoatRoughnessMap&&(v.clearcoatRoughnessMap.value=y.clearcoatRoughnessMap,t(y.clearcoatRoughnessMap,v.clearcoatRoughnessMapTransform)),y.clearcoatNormalMap&&(v.clearcoatNormalMap.value=y.clearcoatNormalMap,t(y.clearcoatNormalMap,v.clearcoatNormalMapTransform),v.clearcoatNormalScale.value.copy(y.clearcoatNormalScale),y.side===br&&v.clearcoatNormalScale.value.negate())),y.dispersion>0&&(v.dispersion.value=y.dispersion),y.iridescence>0&&(v.iridescence.value=y.iridescence,v.iridescenceIOR.value=y.iridescenceIOR,v.iridescenceThicknessMinimum.value=y.iridescenceThicknessRange[0],v.iridescenceThicknessMaximum.value=y.iridescenceThicknessRange[1],y.iridescenceMap&&(v.iridescenceMap.value=y.iridescenceMap,t(y.iridescenceMap,v.iridescenceMapTransform)),y.iridescenceThicknessMap&&(v.iridescenceThicknessMap.value=y.iridescenceThicknessMap,t(y.iridescenceThicknessMap,v.iridescenceThicknessMapTransform))),y.transmission>0&&(v.transmission.value=y.transmission,v.transmissionSamplerMap.value=x.texture,v.transmissionSamplerSize.value.set(x.width,x.height),y.transmissionMap&&(v.transmissionMap.value=y.transmissionMap,t(y.transmissionMap,v.transmissionMapTransform)),v.thickness.value=y.thickness,y.thicknessMap&&(v.thicknessMap.value=y.thicknessMap,t(y.thicknessMap,v.thicknessMapTransform)),v.attenuationDistance.value=y.attenuationDistance,v.attenuationColor.value.copy(y.attenuationColor)),y.anisotropy>0&&(v.anisotropyVector.value.set(y.anisotropy*Math.cos(y.anisotropyRotation),y.anisotropy*Math.sin(y.anisotropyRotation)),y.anisotropyMap&&(v.anisotropyMap.value=y.anisotropyMap,t(y.anisotropyMap,v.anisotropyMapTransform))),v.specularIntensity.value=y.specularIntensity,v.specularColor.value.copy(y.specularColor),y.specularColorMap&&(v.specularColorMap.value=y.specularColorMap,t(y.specularColorMap,v.specularColorMapTransform)),y.specularIntensityMap&&(v.specularIntensityMap.value=y.specularIntensityMap,t(y.specularIntensityMap,v.specularIntensityMapTransform))}function g(v,y){y.matcap&&(v.matcap.value=y.matcap)}function w(v,y){const x=e.get(y).light;v.referencePosition.value.setFromMatrixPosition(x.matrixWorld),v.nearDistance.value=x.shadow.camera.near,v.farDistance.value=x.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function LX(r,e,t,n){let i={},o={},a=[];const s=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function u(x,E){const _=E.program;n.uniformBlockBinding(x,_)}function l(x,E){let _=i[x.id];_===void 0&&(g(x),_=c(x),i[x.id]=_,x.addEventListener("dispose",v));const k=E.program;n.updateUBOMapping(x,k);const C=e.render.frame;o[x.id]!==C&&(f(x),o[x.id]=C)}function c(x){const E=h();x.__bindingPointIndex=E;const _=r.createBuffer(),k=x.__size,C=x.usage;return r.bindBuffer(r.UNIFORM_BUFFER,_),r.bufferData(r.UNIFORM_BUFFER,k,C),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,E,_),_}function h(){for(let x=0;x<s;x++)if(a.indexOf(x)===-1)return a.push(x),x;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(x){const E=i[x.id],_=x.uniforms,k=x.__cache;r.bindBuffer(r.UNIFORM_BUFFER,E);for(let C=0,R=_.length;C<R;C++){const I=Array.isArray(_[C])?_[C]:[_[C]];for(let T=0,A=I.length;T<A;T++){const N=I[T];if(m(N,C,T,k)===!0){const O=N.__offset,V=Array.isArray(N.value)?N.value:[N.value];let F=0;for(let B=0;B<V.length;B++){const U=V[B],P=w(U);typeof U=="number"||typeof U=="boolean"?(N.__data[0]=U,r.bufferSubData(r.UNIFORM_BUFFER,O+F,N.__data)):U.isMatrix3?(N.__data[0]=U.elements[0],N.__data[1]=U.elements[1],N.__data[2]=U.elements[2],N.__data[3]=0,N.__data[4]=U.elements[3],N.__data[5]=U.elements[4],N.__data[6]=U.elements[5],N.__data[7]=0,N.__data[8]=U.elements[6],N.__data[9]=U.elements[7],N.__data[10]=U.elements[8],N.__data[11]=0):(U.toArray(N.__data,F),F+=P.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,O,N.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function m(x,E,_,k){const C=x.value,R=E+"_"+_;if(k[R]===void 0)return typeof C=="number"||typeof C=="boolean"?k[R]=C:k[R]=C.clone(),!0;{const I=k[R];if(typeof C=="number"||typeof C=="boolean"){if(I!==C)return k[R]=C,!0}else if(I.equals(C)===!1)return I.copy(C),!0}return!1}function g(x){const E=x.uniforms;let _=0;const k=16;for(let R=0,I=E.length;R<I;R++){const T=Array.isArray(E[R])?E[R]:[E[R]];for(let A=0,N=T.length;A<N;A++){const O=T[A],V=Array.isArray(O.value)?O.value:[O.value];for(let F=0,B=V.length;F<B;F++){const U=V[F],P=w(U),L=_%k,H=L%P.boundary,W=L+H;_+=H,W!==0&&k-W<P.storage&&(_+=k-W),O.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),O.__offset=_,_+=P.storage}}}const C=_%k;return C>0&&(_+=k-C),x.__size=_,x.__cache={},this}function w(x){const E={boundary:0,storage:0};return typeof x=="number"||typeof x=="boolean"?(E.boundary=4,E.storage=4):x.isVector2?(E.boundary=8,E.storage=8):x.isVector3||x.isColor?(E.boundary=16,E.storage=12):x.isVector4?(E.boundary=16,E.storage=16):x.isMatrix3?(E.boundary=48,E.storage=48):x.isMatrix4?(E.boundary=64,E.storage=64):x.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",x),E}function v(x){const E=x.target;E.removeEventListener("dispose",v);const _=a.indexOf(E.__bindingPointIndex);a.splice(_,1),r.deleteBuffer(i[E.id]),delete i[E.id],delete o[E.id]}function y(){for(const x in i)r.deleteBuffer(i[x]);a=[],i={},o={}}return{bind:u,update:l,dispose:y}}class BX{constructor(e={}){const{canvas:t=SG(),context:n=null,depth:i=!0,stencil:o=!1,alpha:a=!1,antialias:s=!1,premultipliedAlpha:u=!0,preserveDrawingBuffer:l=!1,powerPreference:c="default",failIfMajorPerformanceCaveat:h=!1,reversedDepthBuffer:f=!1}=e;this.isWebGLRenderer=!0;let m;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");m=n.getContextAttributes().alpha}else m=a;const g=new Uint32Array(4),w=new Int32Array(4);let v=null,y=null;const x=[],E=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=qa,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const _=this;let k=!1;this._outputColorSpace=Cn;let C=0,R=0,I=null,T=-1,A=null;const N=new Hn,O=new Hn;let V=null;const F=new Sn(0);let B=0,U=t.width,P=t.height,L=1,H=null,W=null;const z=new Hn(0,0,U,P),q=new Hn(0,0,U,P);let re=!1;const de=new iR;let ye=!1,ne=!1;const ie=new sr,fe=new Te,Ae=new Hn,De={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Be=!1;function lt(){return I===null?L:1}let Y=n;function ot($,pe){return t.getContext($,pe)}try{const $={alpha:!0,depth:i,stencil:o,antialias:s,premultipliedAlpha:u,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:h};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Pd}`),t.addEventListener("webglcontextlost",Ve,!1),t.addEventListener("webglcontextrestored",it,!1),t.addEventListener("webglcontextcreationerror",We,!1),Y===null){const pe="webgl2";if(Y=ot(pe,$),Y===null)throw ot(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch($){throw console.error("THREE.WebGLRenderer: "+$.message),$}let Je,Xe,qe,Tt,Qe,ft,Mt,Ut,Z,j,me,Re,Pe,ke,Ue,_e,rt,Ze,Oe,$e,pt,nt,tt,Nt;function se(){Je=new Xq(Y),Je.init(),nt=new RX(Y,Je),Xe=new Wq(Y,Je,e,nt),qe=new MX(Y,Je),Xe.reversedDepthBuffer&&f&&qe.buffers.depth.setReversed(!0),Tt=new Jq(Y),Qe=new mX,ft=new AX(Y,Je,qe,Qe,Xe,nt,Tt),Mt=new Gq(_),Ut=new $q(_),Z=new rV(Y),tt=new Uq(Y,Z),j=new Yq(Y,Z,Tt,tt),me=new Qq(Y,j,Z,Tt),Oe=new Zq(Y,Xe,ft),_e=new Hq(Qe),Re=new pX(_,Mt,Ut,Je,Xe,tt,_e),Pe=new OX(_,Qe),ke=new vX,Ue=new SX(Je),Ze=new Bq(_,Mt,Ut,qe,me,m,u),rt=new CX(_,me,Xe),Nt=new LX(Y,Tt,Xe,qe),$e=new zq(Y,Je,Tt),pt=new Kq(Y,Je,Tt),Tt.programs=Re.programs,_.capabilities=Xe,_.extensions=Je,_.properties=Qe,_.renderLists=ke,_.shadowMap=rt,_.state=qe,_.info=Tt}se();const He=new PX(_,Y);this.xr=He,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const $=Je.get("WEBGL_lose_context");$&&$.loseContext()},this.forceContextRestore=function(){const $=Je.get("WEBGL_lose_context");$&&$.restoreContext()},this.getPixelRatio=function(){return L},this.setPixelRatio=function($){$!==void 0&&(L=$,this.setSize(U,P,!1))},this.getSize=function($){return $.set(U,P)},this.setSize=function($,pe,Ee=!0){if(He.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}U=$,P=pe,t.width=Math.floor($*L),t.height=Math.floor(pe*L),Ee===!0&&(t.style.width=$+"px",t.style.height=pe+"px"),this.setViewport(0,0,$,pe)},this.getDrawingBufferSize=function($){return $.set(U*L,P*L).floor()},this.setDrawingBufferSize=function($,pe,Ee){U=$,P=pe,L=Ee,t.width=Math.floor($*Ee),t.height=Math.floor(pe*Ee),this.setViewport(0,0,$,pe)},this.getCurrentViewport=function($){return $.copy(N)},this.getViewport=function($){return $.copy(z)},this.setViewport=function($,pe,Ee,Ce){$.isVector4?z.set($.x,$.y,$.z,$.w):z.set($,pe,Ee,Ce),qe.viewport(N.copy(z).multiplyScalar(L).round())},this.getScissor=function($){return $.copy(q)},this.setScissor=function($,pe,Ee,Ce){$.isVector4?q.set($.x,$.y,$.z,$.w):q.set($,pe,Ee,Ce),qe.scissor(O.copy(q).multiplyScalar(L).round())},this.getScissorTest=function(){return re},this.setScissorTest=function($){qe.setScissorTest(re=$)},this.setOpaqueSort=function($){H=$},this.setTransparentSort=function($){W=$},this.getClearColor=function($){return $.copy(Ze.getClearColor())},this.setClearColor=function(){Ze.setClearColor(...arguments)},this.getClearAlpha=function(){return Ze.getClearAlpha()},this.setClearAlpha=function(){Ze.setClearAlpha(...arguments)},this.clear=function($=!0,pe=!0,Ee=!0){let Ce=0;if($){let he=!1;if(I!==null){const Ye=I.texture.format;he=Ye===j1||Ye===V1||Ye===G1}if(he){const Ye=I.texture.type,st=Ye===$r||Ye===nu||Ye===ad||Ye===Vc||Ye===W1||Ye===H1,vt=Ze.getClearColor(),ct=Ze.getClearAlpha(),Bt=vt.r,zt=vt.g,At=vt.b;st?(g[0]=Bt,g[1]=zt,g[2]=At,g[3]=ct,Y.clearBufferuiv(Y.COLOR,0,g)):(w[0]=Bt,w[1]=zt,w[2]=At,w[3]=ct,Y.clearBufferiv(Y.COLOR,0,w))}else Ce|=Y.COLOR_BUFFER_BIT}pe&&(Ce|=Y.DEPTH_BUFFER_BIT),Ee&&(Ce|=Y.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Y.clear(Ce)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ve,!1),t.removeEventListener("webglcontextrestored",it,!1),t.removeEventListener("webglcontextcreationerror",We,!1),Ze.dispose(),ke.dispose(),Ue.dispose(),Qe.dispose(),Mt.dispose(),Ut.dispose(),me.dispose(),tt.dispose(),Nt.dispose(),Re.dispose(),He.dispose(),He.removeEventListener("sessionstart",fr),He.removeEventListener("sessionend",us),pr.stop()};function Ve($){$.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),k=!0}function it(){console.log("THREE.WebGLRenderer: Context Restored."),k=!1;const $=Tt.autoReset,pe=rt.enabled,Ee=rt.autoUpdate,Ce=rt.needsUpdate,he=rt.type;se(),Tt.autoReset=$,rt.enabled=pe,rt.autoUpdate=Ee,rt.needsUpdate=Ce,rt.type=he}function We($){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",$.statusMessage)}function Fe($){const pe=$.target;pe.removeEventListener("dispose",Fe),gt(pe)}function gt($){Ht($),Qe.remove($)}function Ht($){const pe=Qe.get($).programs;pe!==void 0&&(pe.forEach(function(Ee){Re.releaseProgram(Ee)}),$.isShaderMaterial&&Re.releaseShaderCache($))}this.renderBufferDirect=function($,pe,Ee,Ce,he,Ye){pe===null&&(pe=De);const st=he.isMesh&&he.matrixWorld.determinant()<0,vt=po($,pe,Ee,Ce,he);qe.setMaterial(Ce,st);let ct=Ee.index,Bt=1;if(Ce.wireframe===!0){if(ct=j.getWireframeAttribute(Ee),ct===void 0)return;Bt=2}const zt=Ee.drawRange,At=Ee.attributes.position;let jt=zt.start*Bt,xn=(zt.start+zt.count)*Bt;Ye!==null&&(jt=Math.max(jt,Ye.start*Bt),xn=Math.min(xn,(Ye.start+Ye.count)*Bt)),ct!==null?(jt=Math.max(jt,0),xn=Math.min(xn,ct.count)):At!=null&&(jt=Math.max(jt,0),xn=Math.min(xn,At.count));const ln=xn-jt;if(ln<0||ln===1/0)return;tt.setup(he,Ce,vt,Ee,ct);let Rn,kn=$e;if(ct!==null&&(Rn=Z.get(ct),kn=pt,kn.setIndex(Rn)),he.isMesh)Ce.wireframe===!0?(qe.setLineWidth(Ce.wireframeLinewidth*lt()),kn.setMode(Y.LINES)):kn.setMode(Y.TRIANGLES);else if(he.isLine){let Ft=Ce.linewidth;Ft===void 0&&(Ft=1),qe.setLineWidth(Ft*lt()),he.isLineSegments?kn.setMode(Y.LINES):he.isLineLoop?kn.setMode(Y.LINE_LOOP):kn.setMode(Y.LINE_STRIP)}else he.isPoints?kn.setMode(Y.POINTS):he.isSprite&&kn.setMode(Y.TRIANGLES);if(he.isBatchedMesh)if(he._multiDrawInstances!==null)ld("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),kn.renderMultiDrawInstances(he._multiDrawStarts,he._multiDrawCounts,he._multiDrawCount,he._multiDrawInstances);else if(Je.get("WEBGL_multi_draw"))kn.renderMultiDraw(he._multiDrawStarts,he._multiDrawCounts,he._multiDrawCount);else{const Ft=he._multiDrawStarts,Tn=he._multiDrawCounts,nn=he._multiDrawCount,tr=ct?Z.get(ct).bytesPerElement:1,mo=Qe.get(Ce).currentProgram.getUniforms();for(let Kr=0;Kr<nn;Kr++)mo.setValue(Y,"_gl_DrawID",Kr),kn.render(Ft[Kr]/tr,Tn[Kr])}else if(he.isInstancedMesh)kn.renderInstances(jt,ln,he.count);else if(Ee.isInstancedBufferGeometry){const Ft=Ee._maxInstanceCount!==void 0?Ee._maxInstanceCount:1/0,Tn=Math.min(Ee.instanceCount,Ft);kn.renderInstances(jt,ln,Tn)}else kn.render(jt,ln)};function bn($,pe,Ee){$.transparent===!0&&$.side===Oi&&$.forceSinglePass===!1?($.side=br,$.needsUpdate=!0,ls($,pe,Ee),$.side=Ya,$.needsUpdate=!0,ls($,pe,Ee),$.side=Oi):ls($,pe,Ee)}this.compile=function($,pe,Ee=null){Ee===null&&(Ee=$),y=Ue.get(Ee),y.init(pe),E.push(y),Ee.traverseVisible(function(he){he.isLight&&he.layers.test(pe.layers)&&(y.pushLight(he),he.castShadow&&y.pushShadow(he))}),$!==Ee&&$.traverseVisible(function(he){he.isLight&&he.layers.test(pe.layers)&&(y.pushLight(he),he.castShadow&&y.pushShadow(he))}),y.setupLights();const Ce=new Set;return $.traverse(function(he){if(!(he.isMesh||he.isPoints||he.isLine||he.isSprite))return;const Ye=he.material;if(Ye)if(Array.isArray(Ye))for(let st=0;st<Ye.length;st++){const vt=Ye[st];bn(vt,Ee,he),Ce.add(vt)}else bn(Ye,Ee,he),Ce.add(Ye)}),y=E.pop(),Ce},this.compileAsync=function($,pe,Ee=null){const Ce=this.compile($,pe,Ee);return new Promise(he=>{function Ye(){if(Ce.forEach(function(st){Qe.get(st).currentProgram.isReady()&&Ce.delete(st)}),Ce.size===0){he($);return}setTimeout(Ye,10)}Je.get("KHR_parallel_shader_compile")!==null?Ye():setTimeout(Ye,10)})};let an=null;function oi($){an&&an($)}function fr(){pr.stop()}function us(){pr.start()}const pr=new aR;pr.setAnimationLoop(oi),typeof self<"u"&&pr.setContext(self),this.setAnimationLoop=function($){an=$,He.setAnimationLoop($),$===null?pr.stop():pr.start()},He.addEventListener("sessionstart",fr),He.addEventListener("sessionend",us),this.render=function($,pe){if(pe!==void 0&&pe.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(k===!0)return;if($.matrixWorldAutoUpdate===!0&&$.updateMatrixWorld(),pe.parent===null&&pe.matrixWorldAutoUpdate===!0&&pe.updateMatrixWorld(),He.enabled===!0&&He.isPresenting===!0&&(He.cameraAutoUpdate===!0&&He.updateCamera(pe),pe=He.getCamera()),$.isScene===!0&&$.onBeforeRender(_,$,pe,I),y=Ue.get($,E.length),y.init(pe),E.push(y),ie.multiplyMatrices(pe.projectionMatrix,pe.matrixWorldInverse),de.setFromProjectionMatrix(ie,ca,pe.reversedDepth),ne=this.localClippingEnabled,ye=_e.init(this.clippingPlanes,ne),v=ke.get($,x.length),v.init(),x.push(v),He.enabled===!0&&He.isPresenting===!0){const Ye=_.xr.getDepthSensingMesh();Ye!==null&&Vo(Ye,pe,-1/0,_.sortObjects)}Vo($,pe,0,_.sortObjects),v.finish(),_.sortObjects===!0&&v.sort(H,W),Be=He.enabled===!1||He.isPresenting===!1||He.hasDepthSensing()===!1,Be&&Ze.addToRenderList(v,$),this.info.render.frame++,ye===!0&&_e.beginShadows();const Ee=y.state.shadowsArray;rt.render(Ee,$,pe),ye===!0&&_e.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ce=v.opaque,he=v.transmissive;if(y.setupLights(),pe.isArrayCamera){const Ye=pe.cameras;if(he.length>0)for(let st=0,vt=Ye.length;st<vt;st++){const ct=Ye[st];Gi(Ce,he,$,ct)}Be&&Ze.render($);for(let st=0,vt=Ye.length;st<vt;st++){const ct=Ye[st];jo(v,$,ct,ct.viewport)}}else he.length>0&&Gi(Ce,he,$,pe),Be&&Ze.render($),jo(v,$,pe);I!==null&&R===0&&(ft.updateMultisampleRenderTarget(I),ft.updateRenderTargetMipmap(I)),$.isScene===!0&&$.onAfterRender(_,$,pe),tt.resetDefaultState(),T=-1,A=null,E.pop(),E.length>0?(y=E[E.length-1],ye===!0&&_e.setGlobalState(_.clippingPlanes,y.state.camera)):y=null,x.pop(),x.length>0?v=x[x.length-1]:v=null};function Vo($,pe,Ee,Ce){if($.visible===!1)return;if($.layers.test(pe.layers)){if($.isGroup)Ee=$.renderOrder;else if($.isLOD)$.autoUpdate===!0&&$.update(pe);else if($.isLight)y.pushLight($),$.castShadow&&y.pushShadow($);else if($.isSprite){if(!$.frustumCulled||de.intersectsSprite($)){Ce&&Ae.setFromMatrixPosition($.matrixWorld).applyMatrix4(ie);const st=me.update($),vt=$.material;vt.visible&&v.push($,st,vt,Ee,Ae.z,null)}}else if(($.isMesh||$.isLine||$.isPoints)&&(!$.frustumCulled||de.intersectsObject($))){const st=me.update($),vt=$.material;if(Ce&&($.boundingSphere!==void 0?($.boundingSphere===null&&$.computeBoundingSphere(),Ae.copy($.boundingSphere.center)):(st.boundingSphere===null&&st.computeBoundingSphere(),Ae.copy(st.boundingSphere.center)),Ae.applyMatrix4($.matrixWorld).applyMatrix4(ie)),Array.isArray(vt)){const ct=st.groups;for(let Bt=0,zt=ct.length;Bt<zt;Bt++){const At=ct[Bt],jt=vt[At.materialIndex];jt&&jt.visible&&v.push($,st,jt,Ee,Ae.z,At)}}else vt.visible&&v.push($,st,vt,Ee,Ae.z,null)}}const Ye=$.children;for(let st=0,vt=Ye.length;st<vt;st++)Vo(Ye[st],pe,Ee,Ce)}function jo($,pe,Ee,Ce){const he=$.opaque,Ye=$.transmissive,st=$.transparent;y.setupLightsView(Ee),ye===!0&&_e.setGlobalState(_.clippingPlanes,Ee),Ce&&qe.viewport(N.copy(Ce)),he.length>0&&Vi(he,pe,Ee),Ye.length>0&&Vi(Ye,pe,Ee),st.length>0&&Vi(st,pe,Ee),qe.buffers.depth.setTest(!0),qe.buffers.depth.setMask(!0),qe.buffers.color.setMask(!0),qe.setPolygonOffset(!1)}function Gi($,pe,Ee,Ce){if((Ee.isScene===!0?Ee.overrideMaterial:null)!==null)return;y.state.transmissionRenderTarget[Ce.id]===void 0&&(y.state.transmissionRenderTarget[Ce.id]=new ii(1,1,{generateMipmaps:!0,type:Je.has("EXT_color_buffer_half_float")||Je.has("EXT_color_buffer_float")?Fd:$r,minFilter:Ku,samples:4,stencilBuffer:o,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:gn.workingColorSpace}));const Ye=y.state.transmissionRenderTarget[Ce.id],st=Ce.viewport||N;Ye.setSize(st.z*_.transmissionResolutionScale,st.w*_.transmissionResolutionScale);const vt=_.getRenderTarget(),ct=_.getActiveCubeFace(),Bt=_.getActiveMipmapLevel();_.setRenderTarget(Ye),_.getClearColor(F),B=_.getClearAlpha(),B<1&&_.setClearColor(16777215,.5),_.clear(),Be&&Ze.render(Ee);const zt=_.toneMapping;_.toneMapping=qa;const At=Ce.viewport;if(Ce.viewport!==void 0&&(Ce.viewport=void 0),y.setupLightsView(Ce),ye===!0&&_e.setGlobalState(_.clippingPlanes,Ce),Vi($,Ee,Ce),ft.updateMultisampleRenderTarget(Ye),ft.updateRenderTargetMipmap(Ye),Je.has("WEBGL_multisampled_render_to_texture")===!1){let jt=!1;for(let xn=0,ln=pe.length;xn<ln;xn++){const Rn=pe[xn],kn=Rn.object,Ft=Rn.geometry,Tn=Rn.material,nn=Rn.group;if(Tn.side===Oi&&kn.layers.test(Ce.layers)){const tr=Tn.side;Tn.side=br,Tn.needsUpdate=!0,fo(kn,Ee,Ce,Ft,Tn,nn),Tn.side=tr,Tn.needsUpdate=!0,jt=!0}}jt===!0&&(ft.updateMultisampleRenderTarget(Ye),ft.updateRenderTargetMipmap(Ye))}_.setRenderTarget(vt,ct,Bt),_.setClearColor(F,B),At!==void 0&&(Ce.viewport=At),_.toneMapping=zt}function Vi($,pe,Ee){const Ce=pe.isScene===!0?pe.overrideMaterial:null;for(let he=0,Ye=$.length;he<Ye;he++){const st=$[he],vt=st.object,ct=st.geometry,Bt=st.group;let zt=st.material;zt.allowOverride===!0&&Ce!==null&&(zt=Ce),vt.layers.test(Ee.layers)&&fo(vt,pe,Ee,ct,zt,Bt)}}function fo($,pe,Ee,Ce,he,Ye){$.onBeforeRender(_,pe,Ee,Ce,he,Ye),$.modelViewMatrix.multiplyMatrices(Ee.matrixWorldInverse,$.matrixWorld),$.normalMatrix.getNormalMatrix($.modelViewMatrix),he.onBeforeRender(_,pe,Ee,Ce,$,Ye),he.transparent===!0&&he.side===Oi&&he.forceSinglePass===!1?(he.side=br,he.needsUpdate=!0,_.renderBufferDirect(Ee,pe,Ce,he,$,Ye),he.side=Ya,he.needsUpdate=!0,_.renderBufferDirect(Ee,pe,Ce,he,$,Ye),he.side=Oi):_.renderBufferDirect(Ee,pe,Ce,he,$,Ye),$.onAfterRender(_,pe,Ee,Ce,he,Ye)}function ls($,pe,Ee){pe.isScene!==!0&&(pe=De);const Ce=Qe.get($),he=y.state.lights,Ye=y.state.shadowsArray,st=he.state.version,vt=Re.getParameters($,he.state,Ye,pe,Ee),ct=Re.getProgramCacheKey(vt);let Bt=Ce.programs;Ce.environment=$.isMeshStandardMaterial?pe.environment:null,Ce.fog=pe.fog,Ce.envMap=($.isMeshStandardMaterial?Ut:Mt).get($.envMap||Ce.environment),Ce.envMapRotation=Ce.environment!==null&&$.envMap===null?pe.environmentRotation:$.envMapRotation,Bt===void 0&&($.addEventListener("dispose",Fe),Bt=new Map,Ce.programs=Bt);let zt=Bt.get(ct);if(zt!==void 0){if(Ce.currentProgram===zt&&Ce.lightsStateVersion===st)return gl($,vt),zt}else vt.uniforms=Re.getUniforms($),$.onBeforeCompile(vt,_),zt=Re.acquireProgram(vt,ct),Bt.set(ct,zt),Ce.uniforms=vt.uniforms;const At=Ce.uniforms;return(!$.isShaderMaterial&&!$.isRawShaderMaterial||$.clipping===!0)&&(At.clippingPlanes=_e.uniform),gl($,vt),Ce.needsLights=cs($),Ce.lightsStateVersion=st,Ce.needsLights&&(At.ambientLightColor.value=he.state.ambient,At.lightProbe.value=he.state.probe,At.directionalLights.value=he.state.directional,At.directionalLightShadows.value=he.state.directionalShadow,At.spotLights.value=he.state.spot,At.spotLightShadows.value=he.state.spotShadow,At.rectAreaLights.value=he.state.rectArea,At.ltc_1.value=he.state.rectAreaLTC1,At.ltc_2.value=he.state.rectAreaLTC2,At.pointLights.value=he.state.point,At.pointLightShadows.value=he.state.pointShadow,At.hemisphereLights.value=he.state.hemi,At.directionalShadowMap.value=he.state.directionalShadowMap,At.directionalShadowMatrix.value=he.state.directionalShadowMatrix,At.spotShadowMap.value=he.state.spotShadowMap,At.spotLightMatrix.value=he.state.spotLightMatrix,At.spotLightMap.value=he.state.spotLightMap,At.pointShadowMap.value=he.state.pointShadowMap,At.pointShadowMatrix.value=he.state.pointShadowMatrix),Ce.currentProgram=zt,Ce.uniformsList=null,zt}function ml($){if($.uniformsList===null){const pe=$.currentProgram.getUniforms();$.uniformsList=rm.seqWithValue(pe.seq,$.uniforms)}return $.uniformsList}function gl($,pe){const Ee=Qe.get($);Ee.outputColorSpace=pe.outputColorSpace,Ee.batching=pe.batching,Ee.batchingColor=pe.batchingColor,Ee.instancing=pe.instancing,Ee.instancingColor=pe.instancingColor,Ee.instancingMorph=pe.instancingMorph,Ee.skinning=pe.skinning,Ee.morphTargets=pe.morphTargets,Ee.morphNormals=pe.morphNormals,Ee.morphColors=pe.morphColors,Ee.morphTargetsCount=pe.morphTargetsCount,Ee.numClippingPlanes=pe.numClippingPlanes,Ee.numIntersection=pe.numClipIntersection,Ee.vertexAlphas=pe.vertexAlphas,Ee.vertexTangents=pe.vertexTangents,Ee.toneMapping=pe.toneMapping}function po($,pe,Ee,Ce,he){pe.isScene!==!0&&(pe=De),ft.resetTextureUnits();const Ye=pe.fog,st=Ce.isMeshStandardMaterial?pe.environment:null,vt=I===null?_.outputColorSpace:I.isXRRenderTarget===!0?I.texture.colorSpace:ru,ct=(Ce.isMeshStandardMaterial?Ut:Mt).get(Ce.envMap||st),Bt=Ce.vertexColors===!0&&!!Ee.attributes.color&&Ee.attributes.color.itemSize===4,zt=!!Ee.attributes.tangent&&(!!Ce.normalMap||Ce.anisotropy>0),At=!!Ee.morphAttributes.position,jt=!!Ee.morphAttributes.normal,xn=!!Ee.morphAttributes.color;let ln=qa;Ce.toneMapped&&(I===null||I.isXRRenderTarget===!0)&&(ln=_.toneMapping);const Rn=Ee.morphAttributes.position||Ee.morphAttributes.normal||Ee.morphAttributes.color,kn=Rn!==void 0?Rn.length:0,Ft=Qe.get(Ce),Tn=y.state.lights;if(ye===!0&&(ne===!0||$!==A)){const Yn=$===A&&Ce.id===T;_e.setState(Ce,$,Yn)}let nn=!1;Ce.version===Ft.__version?(Ft.needsLights&&Ft.lightsStateVersion!==Tn.state.version||Ft.outputColorSpace!==vt||he.isBatchedMesh&&Ft.batching===!1||!he.isBatchedMesh&&Ft.batching===!0||he.isBatchedMesh&&Ft.batchingColor===!0&&he.colorTexture===null||he.isBatchedMesh&&Ft.batchingColor===!1&&he.colorTexture!==null||he.isInstancedMesh&&Ft.instancing===!1||!he.isInstancedMesh&&Ft.instancing===!0||he.isSkinnedMesh&&Ft.skinning===!1||!he.isSkinnedMesh&&Ft.skinning===!0||he.isInstancedMesh&&Ft.instancingColor===!0&&he.instanceColor===null||he.isInstancedMesh&&Ft.instancingColor===!1&&he.instanceColor!==null||he.isInstancedMesh&&Ft.instancingMorph===!0&&he.morphTexture===null||he.isInstancedMesh&&Ft.instancingMorph===!1&&he.morphTexture!==null||Ft.envMap!==ct||Ce.fog===!0&&Ft.fog!==Ye||Ft.numClippingPlanes!==void 0&&(Ft.numClippingPlanes!==_e.numPlanes||Ft.numIntersection!==_e.numIntersection)||Ft.vertexAlphas!==Bt||Ft.vertexTangents!==zt||Ft.morphTargets!==At||Ft.morphNormals!==jt||Ft.morphColors!==xn||Ft.toneMapping!==ln||Ft.morphTargetsCount!==kn)&&(nn=!0):(nn=!0,Ft.__version=Ce.version);let tr=Ft.currentProgram;nn===!0&&(tr=ls(Ce,pe,he));let mo=!1,Kr=!1,du=!1;const In=tr.getUniforms(),Jr=Ft.uniforms;if(qe.useProgram(tr.program)&&(mo=!0,Kr=!0,du=!0),Ce.id!==T&&(T=Ce.id,Kr=!0),mo||A!==$){qe.buffers.depth.getReversed()&&$.reversedDepth!==!0&&($._reversedDepth=!0,$.updateProjectionMatrix()),In.setValue(Y,"projectionMatrix",$.projectionMatrix),In.setValue(Y,"viewMatrix",$.matrixWorldInverse);const Rr=In.map.cameraPosition;Rr!==void 0&&Rr.setValue(Y,fe.setFromMatrixPosition($.matrixWorld)),Xe.logarithmicDepthBuffer&&In.setValue(Y,"logDepthBufFC",2/(Math.log($.far+1)/Math.LN2)),(Ce.isMeshPhongMaterial||Ce.isMeshToonMaterial||Ce.isMeshLambertMaterial||Ce.isMeshBasicMaterial||Ce.isMeshStandardMaterial||Ce.isShaderMaterial)&&In.setValue(Y,"isOrthographic",$.isOrthographicCamera===!0),A!==$&&(A=$,Kr=!0,du=!0)}if(he.isSkinnedMesh){In.setOptional(Y,he,"bindMatrix"),In.setOptional(Y,he,"bindMatrixInverse");const Yn=he.skeleton;Yn&&(Yn.boneTexture===null&&Yn.computeBoneTexture(),In.setValue(Y,"boneTexture",Yn.boneTexture,ft))}he.isBatchedMesh&&(In.setOptional(Y,he,"batchingTexture"),In.setValue(Y,"batchingTexture",he._matricesTexture,ft),In.setOptional(Y,he,"batchingIdTexture"),In.setValue(Y,"batchingIdTexture",he._indirectTexture,ft),In.setOptional(Y,he,"batchingColorTexture"),he._colorsTexture!==null&&In.setValue(Y,"batchingColorTexture",he._colorsTexture,ft));const Ar=Ee.morphAttributes;if((Ar.position!==void 0||Ar.normal!==void 0||Ar.color!==void 0)&&Oe.update(he,Ee,tr),(Kr||Ft.receiveShadow!==he.receiveShadow)&&(Ft.receiveShadow=he.receiveShadow,In.setValue(Y,"receiveShadow",he.receiveShadow)),Ce.isMeshGouraudMaterial&&Ce.envMap!==null&&(Jr.envMap.value=ct,Jr.flipEnvMap.value=ct.isCubeTexture&&ct.isRenderTargetTexture===!1?-1:1),Ce.isMeshStandardMaterial&&Ce.envMap===null&&pe.environment!==null&&(Jr.envMapIntensity.value=pe.environmentIntensity),Kr&&(In.setValue(Y,"toneMappingExposure",_.toneMappingExposure),Ft.needsLights&&vl(Jr,du),Ye&&Ce.fog===!0&&Pe.refreshFogUniforms(Jr,Ye),Pe.refreshMaterialUniforms(Jr,Ce,L,P,y.state.transmissionRenderTarget[$.id]),rm.upload(Y,ml(Ft),Jr,ft)),Ce.isShaderMaterial&&Ce.uniformsNeedUpdate===!0&&(rm.upload(Y,ml(Ft),Jr,ft),Ce.uniformsNeedUpdate=!1),Ce.isSpriteMaterial&&In.setValue(Y,"center",he.center),In.setValue(Y,"modelViewMatrix",he.modelViewMatrix),In.setValue(Y,"normalMatrix",he.normalMatrix),In.setValue(Y,"modelMatrix",he.matrixWorld),Ce.isShaderMaterial||Ce.isRawShaderMaterial){const Yn=Ce.uniformsGroups;for(let Rr=0,fu=Yn.length;Rr<fu;Rr++){const rn=Yn[Rr];Nt.update(rn,tr),Nt.bind(rn,tr)}}return tr}function vl($,pe){$.ambientLightColor.needsUpdate=pe,$.lightProbe.needsUpdate=pe,$.directionalLights.needsUpdate=pe,$.directionalLightShadows.needsUpdate=pe,$.pointLights.needsUpdate=pe,$.pointLightShadows.needsUpdate=pe,$.spotLights.needsUpdate=pe,$.spotLightShadows.needsUpdate=pe,$.rectAreaLights.needsUpdate=pe,$.hemisphereLights.needsUpdate=pe}function cs($){return $.isMeshLambertMaterial||$.isMeshToonMaterial||$.isMeshPhongMaterial||$.isMeshStandardMaterial||$.isShadowMaterial||$.isShaderMaterial&&$.lights===!0}this.getActiveCubeFace=function(){return C},this.getActiveMipmapLevel=function(){return R},this.getRenderTarget=function(){return I},this.setRenderTargetTextures=function($,pe,Ee){const Ce=Qe.get($);Ce.__autoAllocateDepthBuffer=$.resolveDepthBuffer===!1,Ce.__autoAllocateDepthBuffer===!1&&(Ce.__useRenderToTexture=!1),Qe.get($.texture).__webglTexture=pe,Qe.get($.depthTexture).__webglTexture=Ce.__autoAllocateDepthBuffer?void 0:Ee,Ce.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function($,pe){const Ee=Qe.get($);Ee.__webglFramebuffer=pe,Ee.__useDefaultFramebuffer=pe===void 0};const Sg=Y.createFramebuffer();this.setRenderTarget=function($,pe=0,Ee=0){I=$,C=pe,R=Ee;let Ce=!0,he=null,Ye=!1,st=!1;if($){const ct=Qe.get($);if(ct.__useDefaultFramebuffer!==void 0)qe.bindFramebuffer(Y.FRAMEBUFFER,null),Ce=!1;else if(ct.__webglFramebuffer===void 0)ft.setupRenderTarget($);else if(ct.__hasExternalTextures)ft.rebindTextures($,Qe.get($.texture).__webglTexture,Qe.get($.depthTexture).__webglTexture);else if($.depthBuffer){const At=$.depthTexture;if(ct.__boundDepthTexture!==At){if(At!==null&&Qe.has(At)&&($.width!==At.image.width||$.height!==At.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");ft.setupDepthRenderbuffer($)}}const Bt=$.texture;(Bt.isData3DTexture||Bt.isDataArrayTexture||Bt.isCompressedArrayTexture)&&(st=!0);const zt=Qe.get($).__webglFramebuffer;$.isWebGLCubeRenderTarget?(Array.isArray(zt[pe])?he=zt[pe][Ee]:he=zt[pe],Ye=!0):$.samples>0&&ft.useMultisampledRTT($)===!1?he=Qe.get($).__webglMultisampledFramebuffer:Array.isArray(zt)?he=zt[Ee]:he=zt,N.copy($.viewport),O.copy($.scissor),V=$.scissorTest}else N.copy(z).multiplyScalar(L).floor(),O.copy(q).multiplyScalar(L).floor(),V=re;if(Ee!==0&&(he=Sg),qe.bindFramebuffer(Y.FRAMEBUFFER,he)&&Ce&&qe.drawBuffers($,he),qe.viewport(N),qe.scissor(O),qe.setScissorTest(V),Ye){const ct=Qe.get($.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_CUBE_MAP_POSITIVE_X+pe,ct.__webglTexture,Ee)}else if(st){const ct=pe;for(let Bt=0;Bt<$.textures.length;Bt++){const zt=Qe.get($.textures[Bt]);Y.framebufferTextureLayer(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0+Bt,zt.__webglTexture,Ee,ct)}}else if($!==null&&Ee!==0){const ct=Qe.get($.texture);Y.framebufferTexture2D(Y.FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,ct.__webglTexture,Ee)}T=-1},this.readRenderTargetPixels=function($,pe,Ee,Ce,he,Ye,st,vt=0){if(!($&&$.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let ct=Qe.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&st!==void 0&&(ct=ct[st]),ct){qe.bindFramebuffer(Y.FRAMEBUFFER,ct);try{const Bt=$.textures[vt],zt=Bt.format,At=Bt.type;if(!Xe.textureFormatReadable(zt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Xe.textureTypeReadable(At)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}pe>=0&&pe<=$.width-Ce&&Ee>=0&&Ee<=$.height-he&&($.textures.length>1&&Y.readBuffer(Y.COLOR_ATTACHMENT0+vt),Y.readPixels(pe,Ee,Ce,he,nt.convert(zt),nt.convert(At),Ye))}finally{const Bt=I!==null?Qe.get(I).__webglFramebuffer:null;qe.bindFramebuffer(Y.FRAMEBUFFER,Bt)}}},this.readRenderTargetPixelsAsync=async function($,pe,Ee,Ce,he,Ye,st,vt=0){if(!($&&$.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let ct=Qe.get($).__webglFramebuffer;if($.isWebGLCubeRenderTarget&&st!==void 0&&(ct=ct[st]),ct)if(pe>=0&&pe<=$.width-Ce&&Ee>=0&&Ee<=$.height-he){qe.bindFramebuffer(Y.FRAMEBUFFER,ct);const Bt=$.textures[vt],zt=Bt.format,At=Bt.type;if(!Xe.textureFormatReadable(zt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Xe.textureTypeReadable(At))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const jt=Y.createBuffer();Y.bindBuffer(Y.PIXEL_PACK_BUFFER,jt),Y.bufferData(Y.PIXEL_PACK_BUFFER,Ye.byteLength,Y.STREAM_READ),$.textures.length>1&&Y.readBuffer(Y.COLOR_ATTACHMENT0+vt),Y.readPixels(pe,Ee,Ce,he,nt.convert(zt),nt.convert(At),0);const xn=I!==null?Qe.get(I).__webglFramebuffer:null;qe.bindFramebuffer(Y.FRAMEBUFFER,xn);const ln=Y.fenceSync(Y.SYNC_GPU_COMMANDS_COMPLETE,0);return Y.flush(),await EG(Y,ln,4),Y.bindBuffer(Y.PIXEL_PACK_BUFFER,jt),Y.getBufferSubData(Y.PIXEL_PACK_BUFFER,0,Ye),Y.deleteBuffer(jt),Y.deleteSync(ln),Ye}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function($,pe=null,Ee=0){const Ce=Math.pow(2,-Ee),he=Math.floor($.image.width*Ce),Ye=Math.floor($.image.height*Ce),st=pe!==null?pe.x:0,vt=pe!==null?pe.y:0;ft.setTexture2D($,0),Y.copyTexSubImage2D(Y.TEXTURE_2D,Ee,0,0,st,vt,he,Ye),qe.unbindTexture()};const Wd=Y.createFramebuffer(),Hd=Y.createFramebuffer();this.copyTextureToTexture=function($,pe,Ee=null,Ce=null,he=0,Ye=null){Ye===null&&(he!==0?(ld("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),Ye=he,he=0):Ye=0);let st,vt,ct,Bt,zt,At,jt,xn,ln;const Rn=$.isCompressedTexture?$.mipmaps[Ye]:$.image;if(Ee!==null)st=Ee.max.x-Ee.min.x,vt=Ee.max.y-Ee.min.y,ct=Ee.isBox3?Ee.max.z-Ee.min.z:1,Bt=Ee.min.x,zt=Ee.min.y,At=Ee.isBox3?Ee.min.z:0;else{const Ar=Math.pow(2,-he);st=Math.floor(Rn.width*Ar),vt=Math.floor(Rn.height*Ar),$.isDataArrayTexture?ct=Rn.depth:$.isData3DTexture?ct=Math.floor(Rn.depth*Ar):ct=1,Bt=0,zt=0,At=0}Ce!==null?(jt=Ce.x,xn=Ce.y,ln=Ce.z):(jt=0,xn=0,ln=0);const kn=nt.convert(pe.format),Ft=nt.convert(pe.type);let Tn;pe.isData3DTexture?(ft.setTexture3D(pe,0),Tn=Y.TEXTURE_3D):pe.isDataArrayTexture||pe.isCompressedArrayTexture?(ft.setTexture2DArray(pe,0),Tn=Y.TEXTURE_2D_ARRAY):(ft.setTexture2D(pe,0),Tn=Y.TEXTURE_2D),Y.pixelStorei(Y.UNPACK_FLIP_Y_WEBGL,pe.flipY),Y.pixelStorei(Y.UNPACK_PREMULTIPLY_ALPHA_WEBGL,pe.premultiplyAlpha),Y.pixelStorei(Y.UNPACK_ALIGNMENT,pe.unpackAlignment);const nn=Y.getParameter(Y.UNPACK_ROW_LENGTH),tr=Y.getParameter(Y.UNPACK_IMAGE_HEIGHT),mo=Y.getParameter(Y.UNPACK_SKIP_PIXELS),Kr=Y.getParameter(Y.UNPACK_SKIP_ROWS),du=Y.getParameter(Y.UNPACK_SKIP_IMAGES);Y.pixelStorei(Y.UNPACK_ROW_LENGTH,Rn.width),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,Rn.height),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,Bt),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,zt),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,At);const In=$.isDataArrayTexture||$.isData3DTexture,Jr=pe.isDataArrayTexture||pe.isData3DTexture;if($.isDepthTexture){const Ar=Qe.get($),Yn=Qe.get(pe),Rr=Qe.get(Ar.__renderTarget),fu=Qe.get(Yn.__renderTarget);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,Rr.__webglFramebuffer),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,fu.__webglFramebuffer);for(let rn=0;rn<ct;rn++)In&&(Y.framebufferTextureLayer(Y.READ_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Qe.get($).__webglTexture,he,At+rn),Y.framebufferTextureLayer(Y.DRAW_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Qe.get(pe).__webglTexture,Ye,ln+rn)),Y.blitFramebuffer(Bt,zt,st,vt,jt,xn,st,vt,Y.DEPTH_BUFFER_BIT,Y.NEAREST);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,null),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,null)}else if(he!==0||$.isRenderTargetTexture||Qe.has($)){const Ar=Qe.get($),Yn=Qe.get(pe);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,Wd),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,Hd);for(let Rr=0;Rr<ct;Rr++)In?Y.framebufferTextureLayer(Y.READ_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Ar.__webglTexture,he,At+Rr):Y.framebufferTexture2D(Y.READ_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,Ar.__webglTexture,he),Jr?Y.framebufferTextureLayer(Y.DRAW_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Yn.__webglTexture,Ye,ln+Rr):Y.framebufferTexture2D(Y.DRAW_FRAMEBUFFER,Y.COLOR_ATTACHMENT0,Y.TEXTURE_2D,Yn.__webglTexture,Ye),he!==0?Y.blitFramebuffer(Bt,zt,st,vt,jt,xn,st,vt,Y.COLOR_BUFFER_BIT,Y.NEAREST):Jr?Y.copyTexSubImage3D(Tn,Ye,jt,xn,ln+Rr,Bt,zt,st,vt):Y.copyTexSubImage2D(Tn,Ye,jt,xn,Bt,zt,st,vt);qe.bindFramebuffer(Y.READ_FRAMEBUFFER,null),qe.bindFramebuffer(Y.DRAW_FRAMEBUFFER,null)}else Jr?$.isDataTexture||$.isData3DTexture?Y.texSubImage3D(Tn,Ye,jt,xn,ln,st,vt,ct,kn,Ft,Rn.data):pe.isCompressedArrayTexture?Y.compressedTexSubImage3D(Tn,Ye,jt,xn,ln,st,vt,ct,kn,Rn.data):Y.texSubImage3D(Tn,Ye,jt,xn,ln,st,vt,ct,kn,Ft,Rn):$.isDataTexture?Y.texSubImage2D(Y.TEXTURE_2D,Ye,jt,xn,st,vt,kn,Ft,Rn.data):$.isCompressedTexture?Y.compressedTexSubImage2D(Y.TEXTURE_2D,Ye,jt,xn,Rn.width,Rn.height,kn,Rn.data):Y.texSubImage2D(Y.TEXTURE_2D,Ye,jt,xn,st,vt,kn,Ft,Rn);Y.pixelStorei(Y.UNPACK_ROW_LENGTH,nn),Y.pixelStorei(Y.UNPACK_IMAGE_HEIGHT,tr),Y.pixelStorei(Y.UNPACK_SKIP_PIXELS,mo),Y.pixelStorei(Y.UNPACK_SKIP_ROWS,Kr),Y.pixelStorei(Y.UNPACK_SKIP_IMAGES,du),Ye===0&&pe.generateMipmaps&&Y.generateMipmap(Tn),qe.unbindTexture()},this.initRenderTarget=function($){Qe.get($).__webglFramebuffer===void 0&&ft.setupRenderTarget($)},this.initTexture=function($){$.isCubeTexture?ft.setTextureCube($,0):$.isData3DTexture?ft.setTexture3D($,0):$.isDataArrayTexture||$.isCompressedArrayTexture?ft.setTexture2DArray($,0):ft.setTexture2D($,0),qe.unbindTexture()},this.resetState=function(){C=0,R=0,I=null,qe.reset(),tt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ca}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=gn._getDrawingBufferColorSpace(e),t.unpackColorSpace=gn._getUnpackColorSpace()}}var B0=1/1e3,UX=1e3,zX=class{constructor(){this.startTime=performance.now(),this.previousTime=0,this.currentTime=0,this._delta=0,this._elapsed=0,this._fixedDelta=1e3/60,this.timescale=1,this.useFixedDelta=!1,this._autoReset=!1}get autoReset(){return this._autoReset}set autoReset(r){typeof document<"u"&&document.hidden!==void 0&&(r?document.addEventListener("visibilitychange",this):document.removeEventListener("visibilitychange",this),this._autoReset=r)}get delta(){return this._delta*B0}get fixedDelta(){return this._fixedDelta*B0}set fixedDelta(r){this._fixedDelta=r*UX}get elapsed(){return this._elapsed*B0}update(r){this.useFixedDelta?this._delta=this.fixedDelta:(this.previousTime=this.currentTime,this.currentTime=(r!==void 0?r:performance.now())-this.startTime,this._delta=this.currentTime-this.previousTime),this._delta*=this.timescale,this._elapsed+=this._delta}reset(){this._delta=0,this._elapsed=0,this.currentTime=performance.now()-this.startTime}getDelta(){return this.delta}getElapsed(){return this.elapsed}handleEvent(r){document.hidden||(this.currentTime=performance.now()-this.startTime)}dispose(){this.autoReset=!1}},WX=(()=>{const r=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),e=new Float32Array([0,0,2,0,0,2]),t=new hu;return t.setAttribute("position",new oo(r,3)),t.setAttribute("uv",new oo(e,2)),t})(),Go=class pw{static get fullscreenGeometry(){return WX}constructor(e="Pass",t=new dw,n=new K1){this.name=e,this.renderer=null,this.scene=t,this.camera=n,this.screen=null,this.rtt=!0,this.needsSwap=!0,this.needsDepthTexture=!1,this.enabled=!0}get renderToScreen(){return!this.rtt}set renderToScreen(e){if(this.rtt===e){const t=this.fullscreenMaterial;t!==null&&(t.needsUpdate=!0),this.rtt=!e}}set mainScene(e){}set mainCamera(e){}setRenderer(e){this.renderer=e}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}get fullscreenMaterial(){return this.screen!==null?this.screen.material:null}set fullscreenMaterial(e){let t=this.screen;t!==null?t.material=e:(t=new Po(pw.fullscreenGeometry,e),t.frustumCulled=!1,this.scene===null&&(this.scene=new dw),this.scene.add(t),this.screen=t)}getFullscreenMaterial(){return this.fullscreenMaterial}setFullscreenMaterial(e){this.fullscreenMaterial=e}getDepthTexture(){return null}setDepthTexture(e,t=Od){}render(e,t,n,i,o){throw new Error("Render method not implemented!")}setSize(e,t){}initialize(e,t,n){}dispose(){for(const e of Object.keys(this)){const t=this[e];(t instanceof ii||t instanceof Qc||t instanceof jr||t instanceof pw)&&this[e].dispose()}this.fullscreenMaterial!==null&&this.fullscreenMaterial.dispose()}},HX=class extends Go{constructor(){super("ClearMaskPass",null,null),this.needsSwap=!1}render(r,e,t,n,i){const o=r.state.buffers.stencil;o.setLocked(!1),o.setTest(!1)}},GX=`#ifdef COLOR_WRITE
#include <common>
#include <dithering_pars_fragment>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#endif
#ifdef DEPTH_WRITE
#include <packing>
#ifdef GL_FRAGMENT_PRECISION_HIGH
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
return unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
return texture2D(depthBuffer,uv).r;
#endif
}
#endif
#ifdef USE_WEIGHTS
uniform vec4 channelWeights;
#endif
uniform float opacity;varying vec2 vUv;void main(){
#ifdef COLOR_WRITE
vec4 texel=texture2D(inputBuffer,vUv);
#ifdef USE_WEIGHTS
texel*=channelWeights;
#endif
gl_FragColor=opacity*texel;
#ifdef COLOR_SPACE_CONVERSION
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
#else
gl_FragColor=vec4(0.0);
#endif
#ifdef DEPTH_WRITE
gl_FragDepth=readDepth(vUv);
#endif
}`,hR="varying vec2 vUv;void main(){vUv=position.xy*0.5+0.5;gl_Position=vec4(position.xy,1.0,1.0);}",dR=class extends Xr{constructor(){super({name:"CopyMaterial",defines:{DEPTH_PACKING:"0",COLOR_WRITE:"1"},uniforms:{inputBuffer:new fn(null),depthBuffer:new fn(null),channelWeights:new fn(null),opacity:new fn(1)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:GX,vertexShader:hR}),this.depthFunc=jm}get inputBuffer(){return this.uniforms.inputBuffer.value}set inputBuffer(r){const e=r!==null;this.colorWrite!==e&&(e?this.defines.COLOR_WRITE=!0:delete this.defines.COLOR_WRITE,this.colorWrite=e,this.needsUpdate=!0),this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){const e=r!==null;this.depthWrite!==e&&(e?this.defines.DEPTH_WRITE=!0:delete this.defines.DEPTH_WRITE,this.depthTest=e,this.depthWrite=e,this.needsUpdate=!0),this.uniforms.depthBuffer.value=r}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}get channelWeights(){return this.uniforms.channelWeights.value}set channelWeights(r){r!==null?(this.defines.USE_WEIGHTS="1",this.uniforms.channelWeights.value=r):delete this.defines.USE_WEIGHTS,this.needsUpdate=!0}setInputBuffer(r){this.uniforms.inputBuffer.value=r}getOpacity(r){return this.uniforms.opacity.value}setOpacity(r){this.uniforms.opacity.value=r}},VX=class extends Go{constructor(r,e=!0){super("CopyPass"),this.fullscreenMaterial=new dR,this.needsSwap=!1,this.renderTarget=r,r===void 0&&(this.renderTarget=new ii(1,1,{minFilter:vi,magFilter:vi,stencilBuffer:!1,depthBuffer:!1}),this.renderTarget.texture.name="CopyPass.Target"),this.autoResize=e}get resize(){return this.autoResize}set resize(r){this.autoResize=r}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}setAutoResizeEnabled(r){this.autoResize=r}render(r,e,t,n,i){this.fullscreenMaterial.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){this.autoResize&&this.renderTarget.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTarget.texture.type=t,t!==$r?this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1":r!==null&&r.outputColorSpace===Cn&&(this.renderTarget.texture.colorSpace=Cn))}},Bk=new Sn,fR=class extends Go{constructor(r=!0,e=!0,t=!1){super("ClearPass",null,null),this.needsSwap=!1,this.color=r,this.depth=e,this.stencil=t,this.overrideClearColor=null,this.overrideClearAlpha=-1}setClearFlags(r,e,t){this.color=r,this.depth=e,this.stencil=t}getOverrideClearColor(){return this.overrideClearColor}setOverrideClearColor(r){this.overrideClearColor=r}getOverrideClearAlpha(){return this.overrideClearAlpha}setOverrideClearAlpha(r){this.overrideClearAlpha=r}render(r,e,t,n,i){const o=this.overrideClearColor,a=this.overrideClearAlpha,s=r.getClearAlpha(),u=o!==null,l=a>=0;u?(r.getClearColor(Bk),r.setClearColor(o,l?a:s)):l&&r.setClearAlpha(a),r.setRenderTarget(this.renderToScreen?null:e),r.clear(this.color,this.depth,this.stencil),u?r.setClearColor(Bk,s):l&&r.setClearAlpha(s)}},jX=class extends Go{constructor(r,e){super("MaskPass",r,e),this.needsSwap=!1,this.clearPass=new fR(!1,!1,!0),this.inverse=!1}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get inverted(){return this.inverse}set inverted(r){this.inverse=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getClearPass(){return this.clearPass}isInverted(){return this.inverted}setInverted(r){this.inverted=r}render(r,e,t,n,i){const o=r.getContext(),a=r.state.buffers,s=this.scene,u=this.camera,l=this.clearPass,c=this.inverted?0:1,h=1-c;a.color.setMask(!1),a.depth.setMask(!1),a.color.setLocked(!0),a.depth.setLocked(!0),a.stencil.setTest(!0),a.stencil.setOp(o.REPLACE,o.REPLACE,o.REPLACE),a.stencil.setFunc(o.ALWAYS,c,4294967295),a.stencil.setClear(h),a.stencil.setLocked(!0),this.clearPass.enabled&&(this.renderToScreen?l.render(r,null):(l.render(r,e),l.render(r,t))),this.renderToScreen?(r.setRenderTarget(null),r.render(s,u)):(r.setRenderTarget(e),r.render(s,u),r.setRenderTarget(t),r.render(s,u)),a.color.setLocked(!1),a.depth.setLocked(!1),a.stencil.setLocked(!1),a.stencil.setFunc(o.EQUAL,1,4294967295),a.stencil.setOp(o.KEEP,o.KEEP,o.KEEP),a.stencil.setLocked(!0)}},qX=class{constructor(r=null,{depthBuffer:e=!0,stencilBuffer:t=!1,multisampling:n=0,frameBufferType:i}={}){this.renderer=null,this.inputBuffer=this.createBuffer(e,t,i,n),this.outputBuffer=this.inputBuffer.clone(),this.copyPass=new VX,this.depthTexture=null,this.passes=[],this.timer=new zX,this.autoRenderToScreen=!0,this.setRenderer(r)}get multisampling(){return this.inputBuffer.samples||0}set multisampling(r){const e=this.inputBuffer,t=this.multisampling;t>0&&r>0?(this.inputBuffer.samples=r,this.outputBuffer.samples=r,this.inputBuffer.dispose(),this.outputBuffer.dispose()):t!==r&&(this.inputBuffer.dispose(),this.outputBuffer.dispose(),this.inputBuffer=this.createBuffer(e.depthBuffer,e.stencilBuffer,e.texture.type,r),this.inputBuffer.depthTexture=this.depthTexture,this.outputBuffer=this.inputBuffer.clone())}getTimer(){return this.timer}getRenderer(){return this.renderer}setRenderer(r){if(this.renderer=r,r!==null){const e=r.getSize(new Wt),t=r.getContext().getContextAttributes().alpha,n=this.inputBuffer.texture.type;n===$r&&r.outputColorSpace===Cn&&(this.inputBuffer.texture.colorSpace=Cn,this.outputBuffer.texture.colorSpace=Cn,this.inputBuffer.dispose(),this.outputBuffer.dispose()),r.autoClear=!1,this.setSize(e.width,e.height);for(const i of this.passes)i.initialize(r,t,n)}}replaceRenderer(r,e=!0){const t=this.renderer,n=t.domElement.parentNode;return this.setRenderer(r),e&&n!==null&&(n.removeChild(t.domElement),n.appendChild(r.domElement)),t}createDepthTexture(){const r=this.depthTexture=new Y1;return this.inputBuffer.depthTexture=r,this.inputBuffer.dispose(),this.inputBuffer.stencilBuffer?(r.format=jc,r.type=Vc):r.type=nu,r}deleteDepthTexture(){if(this.depthTexture!==null){this.depthTexture.dispose(),this.depthTexture=null,this.inputBuffer.depthTexture=null,this.inputBuffer.dispose();for(const r of this.passes)r.setDepthTexture(null)}}createBuffer(r,e,t,n){const i=this.renderer,o=i===null?new Wt:i.getDrawingBufferSize(new Wt),a={minFilter:vi,magFilter:vi,stencilBuffer:e,depthBuffer:r,type:t},s=new ii(o.width,o.height,a);return n>0&&(s.samples=n),t===$r&&i!==null&&i.outputColorSpace===Cn&&(s.texture.colorSpace=Cn),s.texture.name="EffectComposer.Buffer",s.texture.generateMipmaps=!1,s}setMainScene(r){for(const e of this.passes)e.mainScene=r}setMainCamera(r){for(const e of this.passes)e.mainCamera=r}addPass(r,e){const t=this.passes,n=this.renderer,i=n.getDrawingBufferSize(new Wt),o=n.getContext().getContextAttributes().alpha,a=this.inputBuffer.texture.type;if(r.setRenderer(n),r.setSize(i.width,i.height),r.initialize(n,o,a),this.autoRenderToScreen&&(t.length>0&&(t[t.length-1].renderToScreen=!1),r.renderToScreen&&(this.autoRenderToScreen=!1)),e!==void 0?t.splice(e,0,r):t.push(r),this.autoRenderToScreen&&(t[t.length-1].renderToScreen=!0),r.needsDepthTexture||this.depthTexture!==null)if(this.depthTexture===null){const s=this.createDepthTexture();for(r of t)r.setDepthTexture(s)}else r.setDepthTexture(this.depthTexture)}removePass(r){const e=this.passes,t=e.indexOf(r);if(t!==-1&&e.splice(t,1).length>0){if(this.depthTexture!==null){const o=(s,u)=>s||u.needsDepthTexture;e.reduce(o,!1)||(r.getDepthTexture()===this.depthTexture&&r.setDepthTexture(null),this.deleteDepthTexture())}this.autoRenderToScreen&&t===e.length&&(r.renderToScreen=!1,e.length>0&&(e[e.length-1].renderToScreen=!0))}}removeAllPasses(){const r=this.passes;this.deleteDepthTexture(),r.length>0&&(this.autoRenderToScreen&&(r[r.length-1].renderToScreen=!1),this.passes=[])}render(r){const e=this.renderer,t=this.copyPass;let n=this.inputBuffer,i=this.outputBuffer,o=!1,a,s,u;r===void 0&&(this.timer.update(),r=this.timer.getDelta());for(const l of this.passes)l.enabled&&(l.render(e,n,i,r,o),l.needsSwap&&(o&&(t.renderToScreen=l.renderToScreen,a=e.getContext(),s=e.state.buffers.stencil,s.setFunc(a.NOTEQUAL,1,4294967295),t.render(e,n,i,r,o),s.setFunc(a.EQUAL,1,4294967295)),u=n,n=i,i=u),l instanceof jX?o=!0:l instanceof HX&&(o=!1))}setSize(r,e,t){const n=this.renderer,i=n.getSize(new Wt);(r===void 0||e===void 0)&&(r=i.width,e=i.height),(i.width!==r||i.height!==e)&&n.setSize(r,e,t);const o=n.getDrawingBufferSize(new Wt);this.inputBuffer.setSize(o.width,o.height),this.outputBuffer.setSize(o.width,o.height);for(const a of this.passes)a.setSize(o.width,o.height)}reset(){this.dispose(),this.autoRenderToScreen=!0}dispose(){for(const r of this.passes)r.dispose();this.passes=[],this.inputBuffer!==null&&this.inputBuffer.dispose(),this.outputBuffer!==null&&this.outputBuffer.dispose(),this.deleteDepthTexture(),this.copyPass.dispose(),this.timer.dispose(),Go.fullscreenGeometry.dispose()}},Ks={NONE:0,DEPTH:1,CONVOLUTION:2},vn={FRAGMENT_HEAD:"FRAGMENT_HEAD",FRAGMENT_MAIN_UV:"FRAGMENT_MAIN_UV",FRAGMENT_MAIN_IMAGE:"FRAGMENT_MAIN_IMAGE",VERTEX_HEAD:"VERTEX_HEAD",VERTEX_MAIN_SUPPORT:"VERTEX_MAIN_SUPPORT"},$X=class{constructor(){this.shaderParts=new Map([[vn.FRAGMENT_HEAD,null],[vn.FRAGMENT_MAIN_UV,null],[vn.FRAGMENT_MAIN_IMAGE,null],[vn.VERTEX_HEAD,null],[vn.VERTEX_MAIN_SUPPORT,null]]),this.defines=new Map,this.uniforms=new Map,this.blendModes=new Map,this.extensions=new Set,this.attributes=Ks.NONE,this.varyings=new Set,this.uvTransformation=!1,this.readDepth=!1,this.colorSpace=ru}},U0=!1,Uk=class{constructor(r=null){this.originalMaterials=new Map,this.material=null,this.materials=null,this.materialsBackSide=null,this.materialsDoubleSide=null,this.materialsFlatShaded=null,this.materialsFlatShadedBackSide=null,this.materialsFlatShadedDoubleSide=null,this.setMaterial(r),this.meshCount=0,this.replaceMaterial=e=>{if(e.isMesh){let t;if(e.material.flatShading)switch(e.material.side){case Oi:t=this.materialsFlatShadedDoubleSide;break;case br:t=this.materialsFlatShadedBackSide;break;default:t=this.materialsFlatShaded;break}else switch(e.material.side){case Oi:t=this.materialsDoubleSide;break;case br:t=this.materialsBackSide;break;default:t=this.materials;break}this.originalMaterials.set(e,e.material),e.isSkinnedMesh?e.material=t[2]:e.isInstancedMesh?e.material=t[1]:e.material=t[0],++this.meshCount}}}cloneMaterial(r){if(!(r instanceof Xr))return r.clone();const e=r.uniforms,t=new Map;for(const i in e){const o=e[i].value;o.isRenderTargetTexture&&(e[i].value=null,t.set(i,o))}const n=r.clone();for(const i of t)e[i[0]].value=i[1],n.uniforms[i[0]].value=i[1];return n}setMaterial(r){if(this.disposeMaterials(),this.material=r,r!==null){const e=this.materials=[this.cloneMaterial(r),this.cloneMaterial(r),this.cloneMaterial(r)];for(const t of e)t.uniforms=Object.assign({},r.uniforms),t.side=Ya;e[2].skinning=!0,this.materialsBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=br,n}),this.materialsDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.side=Oi,n}),this.materialsFlatShaded=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n}),this.materialsFlatShadedBackSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=br,n}),this.materialsFlatShadedDoubleSide=e.map(t=>{const n=this.cloneMaterial(t);return n.uniforms=Object.assign({},r.uniforms),n.flatShading=!0,n.side=Oi,n})}}render(r,e,t){const n=r.shadowMap.enabled;if(r.shadowMap.enabled=!1,U0){const i=this.originalMaterials;this.meshCount=0,e.traverse(this.replaceMaterial),r.render(e,t);for(const o of i)o[0].material=o[1];this.meshCount!==i.size&&i.clear()}else{const i=e.overrideMaterial;e.overrideMaterial=this.material,r.render(e,t),e.overrideMaterial=i}r.shadowMap.enabled=n}disposeMaterials(){if(this.material!==null){const r=this.materials.concat(this.materialsBackSide).concat(this.materialsDoubleSide).concat(this.materialsFlatShaded).concat(this.materialsFlatShadedBackSide).concat(this.materialsFlatShadedDoubleSide);for(const e of r)e.dispose()}}dispose(){this.originalMaterials.clear(),this.disposeMaterials()}static get workaroundEnabled(){return U0}static set workaroundEnabled(r){U0=r}},Bs=-1,ha=class extends ss{constructor(r,e=Bs,t=Bs,n=1){super(),this.resizable=r,this.baseSize=new Wt(1,1),this.preferredSize=new Wt(e,t),this.target=this.preferredSize,this.s=n,this.effectiveSize=new Wt,this.addEventListener("change",()=>this.updateEffectiveSize()),this.updateEffectiveSize()}updateEffectiveSize(){const r=this.baseSize,e=this.preferredSize,t=this.effectiveSize,n=this.scale;e.width!==Bs?t.width=e.width:e.height!==Bs?t.width=Math.round(e.height*(r.width/Math.max(r.height,1))):t.width=Math.round(r.width*n),e.height!==Bs?t.height=e.height:e.width!==Bs?t.height=Math.round(e.width/Math.max(r.width/Math.max(r.height,1),1)):t.height=Math.round(r.height*n)}get width(){return this.effectiveSize.width}set width(r){this.preferredWidth=r}get height(){return this.effectiveSize.height}set height(r){this.preferredHeight=r}getWidth(){return this.width}getHeight(){return this.height}get scale(){return this.s}set scale(r){this.s!==r&&(this.s=r,this.preferredSize.setScalar(Bs),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getScale(){return this.scale}setScale(r){this.scale=r}get baseWidth(){return this.baseSize.width}set baseWidth(r){this.baseSize.width!==r&&(this.baseSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseWidth(){return this.baseWidth}setBaseWidth(r){this.baseWidth=r}get baseHeight(){return this.baseSize.height}set baseHeight(r){this.baseSize.height!==r&&(this.baseSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getBaseHeight(){return this.baseHeight}setBaseHeight(r){this.baseHeight=r}setBaseSize(r,e){(this.baseSize.width!==r||this.baseSize.height!==e)&&(this.baseSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}get preferredWidth(){return this.preferredSize.width}set preferredWidth(r){this.preferredSize.width!==r&&(this.preferredSize.width=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredWidth(){return this.preferredWidth}setPreferredWidth(r){this.preferredWidth=r}get preferredHeight(){return this.preferredSize.height}set preferredHeight(r){this.preferredSize.height!==r&&(this.preferredSize.height=r,this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}getPreferredHeight(){return this.preferredHeight}setPreferredHeight(r){this.preferredHeight=r}setPreferredSize(r,e){(this.preferredSize.width!==r||this.preferredSize.height!==e)&&(this.preferredSize.set(r,e),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height))}copy(r){this.s=r.scale,this.baseSize.set(r.baseWidth,r.baseHeight),this.preferredSize.set(r.preferredWidth,r.preferredHeight),this.dispatchEvent({type:"change"}),this.resizable.setSize(this.baseSize.width,this.baseSize.height)}static get AUTO_SIZE(){return Bs}},un={ADD:0,AVERAGE:2,COLOR:3,COLOR_BURN:4,COLOR_DODGE:5,DARKEN:6,DIFFERENCE:7,DIVIDE:8,DST:9,EXCLUSION:10,HARD_LIGHT:11,HARD_MIX:12,HUE:13,INVERT:14,INVERT_RGB:15,LIGHTEN:16,LINEAR_BURN:17,LINEAR_DODGE:18,LINEAR_LIGHT:19,LUMINOSITY:20,MULTIPLY:21,NEGATION:22,NORMAL:23,OVERLAY:24,PIN_LIGHT:25,REFLECT:26,SATURATION:27,SCREEN:28,SOFT_LIGHT:29,SRC:30,SUBTRACT:31,VIVID_LIGHT:32},XX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb,y.a),y.a*opacity);}",YX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb)*0.5,y.a),y.a*opacity);}",KX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.xy,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",JX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=mix(step(0.0,b)*(1.0-min(vec3(1.0),(1.0-a)/b)),vec3(1.0),step(1.0,a));return mix(x,vec4(z,y.a),y.a*opacity);}",ZX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb,b=y.rgb;vec3 z=step(0.0,a)*mix(min(vec3(1.0),a/max(1.0-b,1e-9)),vec3(1.0),step(1.0,b));return mix(x,vec4(z,y.a),y.a*opacity);}",QX="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb,y.rgb),y.a),y.a*opacity);}",eY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(abs(x.rgb-y.rgb),y.a),y.a*opacity);}",tY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb/max(y.rgb,1e-12),y.a),y.a*opacity);}",nY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4((x.rgb+y.rgb-2.0*x.rgb*y.rgb),y.a),y.a*opacity);}",rY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=min(x.rgb,1.0);vec3 b=min(y.rgb,1.0);vec3 z=mix(2.0*a*b,1.0-2.0*(1.0-a)*(1.0-b),step(0.5,b));return mix(x,vec4(z,y.a),y.a*opacity);}",iY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(step(1.0,x.rgb+y.rgb),y.a),y.a*opacity);}",oY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(yHSL.x,xHSL.yz));return mix(x,vec4(z,y.a),y.a*opacity);}",aY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-y.rgb,y.a),y.a*opacity);}",sY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(y.rgb*(1.0-x.rgb),y.a),y.a*opacity);}",uY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb,y.rgb),y.a),y.a*opacity);}",lY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",cY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(min(x.rgb+y.rgb,1.0),y.a),y.a*opacity);}",hY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(clamp(2.0*y.rgb+x.rgb-1.0,0.0,1.0),y.a),y.a*opacity);}",dY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.xy,yHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",fY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb*y.rgb,y.a),y.a*opacity);}",pY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(1.0-abs(1.0-x.rgb-y.rgb),y.a),y.a*opacity);}",mY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,y,y.a*opacity);}",gY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(2.0*y.rgb*x.rgb,1.0-2.0*(1.0-y.rgb)*(1.0-x.rgb),step(0.5,x.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",vY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 y2=2.0*y.rgb;vec3 z=mix(mix(y2,x.rgb,step(0.5*x.rgb,y.rgb)),max(y2-1.0,vec3(0.0)),step(x.rgb,y2-1.0));return mix(x,vec4(z,y.a),y.a*opacity);}",yY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(min(x.rgb*x.rgb/max(1.0-y.rgb,1e-12),1.0),y.rgb,step(1.0,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",bY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 xHSL=RGBToHSL(x.rgb);vec3 yHSL=RGBToHSL(y.rgb);vec3 z=HSLToRGB(vec3(xHSL.x,yHSL.y,xHSL.z));return mix(x,vec4(z,y.a),y.a*opacity);}",wY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(x.rgb+y.rgb-min(x.rgb*y.rgb,1.0),y.a),y.a*opacity);}",_Y="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 a=x.rgb;vec3 b=y.rgb;vec3 y2=2.0*b;vec3 w=step(0.5,b);vec3 c=a-(1.0-y2)*a*(1.0-a);vec3 d=mix(a+(y2-1.0)*(sqrt(a)-a),a+(y2-1.0)*a*((16.0*a-12.0)*a+3.0),w*(1.0-step(0.25,a)));vec3 z=mix(c,d,w);return mix(x,vec4(z,y.a),y.a*opacity);}",xY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return y;}",SY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){return mix(x,vec4(max(x.rgb+y.rgb-1.0,0.0),y.a),y.a*opacity);}",EY="vec4 blend(const in vec4 x,const in vec4 y,const in float opacity){vec3 z=mix(max(1.0-min((1.0-x.rgb)/(2.0*y.rgb),1.0),0.0),min(x.rgb/(2.0*(1.0-y.rgb)),1.0),step(0.5,y.rgb));return mix(x,vec4(z,y.a),y.a*opacity);}",kY=new Map([[un.ADD,XX],[un.AVERAGE,YX],[un.COLOR,KX],[un.COLOR_BURN,JX],[un.COLOR_DODGE,ZX],[un.DARKEN,QX],[un.DIFFERENCE,eY],[un.DIVIDE,tY],[un.DST,null],[un.EXCLUSION,nY],[un.HARD_LIGHT,rY],[un.HARD_MIX,iY],[un.HUE,oY],[un.INVERT,aY],[un.INVERT_RGB,sY],[un.LIGHTEN,uY],[un.LINEAR_BURN,lY],[un.LINEAR_DODGE,cY],[un.LINEAR_LIGHT,hY],[un.LUMINOSITY,dY],[un.MULTIPLY,fY],[un.NEGATION,pY],[un.NORMAL,mY],[un.OVERLAY,gY],[un.PIN_LIGHT,vY],[un.REFLECT,yY],[un.SATURATION,bY],[un.SCREEN,wY],[un.SOFT_LIGHT,_Y],[un.SRC,xY],[un.SUBTRACT,SY],[un.VIVID_LIGHT,EY]]),CY=class extends ss{constructor(r,e=1){super(),this._blendFunction=r,this.opacity=new fn(e)}getOpacity(){return this.opacity.value}setOpacity(r){this.opacity.value=r}get blendFunction(){return this._blendFunction}set blendFunction(r){this._blendFunction=r,this.dispatchEvent({type:"change"})}getBlendFunction(){return this.blendFunction}setBlendFunction(r){this.blendFunction=r}getShaderCode(){return kY.get(this.blendFunction)}},pR=class extends ss{constructor(r,e,{attributes:t=Ks.NONE,blendFunction:n=un.NORMAL,defines:i=new Map,uniforms:o=new Map,extensions:a=null,vertexShader:s=null}={}){super(),this.name=r,this.renderer=null,this.attributes=t,this.fragmentShader=e,this.vertexShader=s,this.defines=i,this.uniforms=o,this.extensions=a,this.blendMode=new CY(n),this.blendMode.addEventListener("change",u=>this.setChanged()),this._inputColorSpace=ru,this._outputColorSpace=sa}get inputColorSpace(){return this._inputColorSpace}set inputColorSpace(r){this._inputColorSpace=r,this.setChanged()}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(r){this._outputColorSpace=r,this.setChanged()}set mainScene(r){}set mainCamera(r){}getName(){return this.name}setRenderer(r){this.renderer=r}getDefines(){return this.defines}getUniforms(){return this.uniforms}getExtensions(){return this.extensions}getBlendMode(){return this.blendMode}getAttributes(){return this.attributes}setAttributes(r){this.attributes=r,this.setChanged()}getFragmentShader(){return this.fragmentShader}setFragmentShader(r){this.fragmentShader=r,this.setChanged()}getVertexShader(){return this.vertexShader}setVertexShader(r){this.vertexShader=r,this.setChanged()}setChanged(){this.dispatchEvent({type:"change"})}setDepthTexture(r,e=Od){}update(r,e,t){}setSize(r,e){}initialize(r,e,t){}dispose(){for(const r of Object.keys(this)){const e=this[r];(e instanceof ii||e instanceof Qc||e instanceof jr||e instanceof Go)&&this[r].dispose()}}},Z1={MEDIUM:2,LARGE:3},TY=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec4 sum=texture2D(inputBuffer,vUv0);sum+=texture2D(inputBuffer,vUv1);sum+=texture2D(inputBuffer,vUv2);sum+=texture2D(inputBuffer,vUv3);gl_FragColor=sum*0.25;
#include <colorspace_fragment>
}`,MY="uniform vec4 texelSize;uniform float kernel;uniform float scale;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;void main(){vec2 uv=position.xy*0.5+0.5;vec2 dUv=(texelSize.xy*vec2(kernel)+texelSize.zw)*scale;vUv0=vec2(uv.x-dUv.x,uv.y+dUv.y);vUv1=vec2(uv.x+dUv.x,uv.y+dUv.y);vUv2=vec2(uv.x+dUv.x,uv.y-dUv.y);vUv3=vec2(uv.x-dUv.x,uv.y-dUv.y);gl_Position=vec4(position.xy,1.0,1.0);}",AY=[new Float32Array([0,0]),new Float32Array([0,1,1]),new Float32Array([0,1,1,2]),new Float32Array([0,1,2,2,3]),new Float32Array([0,1,2,3,4,4,5]),new Float32Array([0,1,2,3,4,5,7,8,9,10])],RY=class extends Xr{constructor(r=new Hn){super({name:"KawaseBlurMaterial",uniforms:{inputBuffer:new fn(null),texelSize:new fn(new Hn),scale:new fn(1),kernel:new fn(0)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:TY,vertexShader:MY}),this.setTexelSize(r.x,r.y),this.kernelSize=Z1.MEDIUM}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.inputBuffer=r}get kernelSequence(){return AY[this.kernelSize]}get scale(){return this.uniforms.scale.value}set scale(r){this.uniforms.scale.value=r}getScale(){return this.uniforms.scale.value}setScale(r){this.uniforms.scale.value=r}getKernel(){return null}get kernel(){return this.uniforms.kernel.value}set kernel(r){this.uniforms.kernel.value=r}setKernel(r){this.kernel=r}setTexelSize(r,e){this.uniforms.texelSize.value.set(r,e,r*.5,e*.5)}setSize(r,e){const t=1/r,n=1/e;this.uniforms.texelSize.value.set(t,n,t*.5,n*.5)}},IY=class extends Go{constructor({kernelSize:r=Z1.MEDIUM,resolutionScale:e=.5,width:t=ha.AUTO_SIZE,height:n=ha.AUTO_SIZE,resolutionX:i=t,resolutionY:o=n}={}){super("KawaseBlurPass"),this.renderTargetA=new ii(1,1,{depthBuffer:!1}),this.renderTargetA.texture.name="Blur.Target.A",this.renderTargetB=this.renderTargetA.clone(),this.renderTargetB.texture.name="Blur.Target.B";const a=this.resolution=new ha(this,i,o,e);a.addEventListener("change",s=>this.setSize(a.baseWidth,a.baseHeight)),this._blurMaterial=new RY,this._blurMaterial.kernelSize=r,this.copyMaterial=new dR}getResolution(){return this.resolution}get blurMaterial(){return this._blurMaterial}set blurMaterial(r){this._blurMaterial=r}get dithering(){return this.copyMaterial.dithering}set dithering(r){this.copyMaterial.dithering=r}get kernelSize(){return this.blurMaterial.kernelSize}set kernelSize(r){this.blurMaterial.kernelSize=r}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get scale(){return this.blurMaterial.scale}set scale(r){this.blurMaterial.scale=r}getScale(){return this.blurMaterial.scale}setScale(r){this.blurMaterial.scale=r}getKernelSize(){return this.kernelSize}setKernelSize(r){this.kernelSize=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}render(r,e,t,n,i){const o=this.scene,a=this.camera,s=this.renderTargetA,u=this.renderTargetB,l=this.blurMaterial,c=l.kernelSequence;let h=e;this.fullscreenMaterial=l;for(let f=0,m=c.length;f<m;++f){const g=(f&1)===0?s:u;l.kernel=c[f],l.inputBuffer=h.texture,r.setRenderTarget(g),r.render(o,a),h=g}this.fullscreenMaterial=this.copyMaterial,this.copyMaterial.inputBuffer=h.texture,r.setRenderTarget(this.renderToScreen?null:t),r.render(o,a)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e);const n=t.width,i=t.height;this.renderTargetA.setSize(n,i),this.renderTargetB.setSize(n,i),this.blurMaterial.setSize(r,e)}initialize(r,e,t){t!==void 0&&(this.renderTargetA.texture.type=t,this.renderTargetB.texture.type=t,t!==$r?(this.blurMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.copyMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1"):r!==null&&r.outputColorSpace===Cn&&(this.renderTargetA.texture.colorSpace=Cn,this.renderTargetB.texture.colorSpace=Cn))}static get AUTO_SIZE(){return ha.AUTO_SIZE}},DY=`#include <common>
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#ifdef RANGE
uniform vec2 range;
#elif defined(THRESHOLD)
uniform float threshold;uniform float smoothing;
#endif
varying vec2 vUv;void main(){vec4 texel=texture2D(inputBuffer,vUv);float l=luminance(texel.rgb);float mask=1.0;
#ifdef RANGE
float low=step(range.x,l);float high=step(l,range.y);mask=low*high;
#elif defined(THRESHOLD)
mask=smoothstep(threshold,threshold+smoothing,l);
#endif
#ifdef COLOR
gl_FragColor=texel*mask;
#else
gl_FragColor=vec4(l*mask);
#endif
}`,NY=class extends Xr{constructor(r=!1,e=null){super({name:"LuminanceMaterial",defines:{THREE_REVISION:Pd.replace(/\D+/g,"")},uniforms:{inputBuffer:new fn(null),threshold:new fn(0),smoothing:new fn(1),range:new fn(null)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:DY,vertexShader:hR}),this.colorOutput=r,this.luminanceRange=e}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get threshold(){return this.uniforms.threshold.value}set threshold(r){this.smoothing>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.threshold.value=r}getThreshold(){return this.threshold}setThreshold(r){this.threshold=r}get smoothing(){return this.uniforms.smoothing.value}set smoothing(r){this.threshold>0||r>0?this.defines.THRESHOLD="1":delete this.defines.THRESHOLD,this.uniforms.smoothing.value=r}getSmoothingFactor(){return this.smoothing}setSmoothingFactor(r){this.smoothing=r}get useThreshold(){return this.threshold>0||this.smoothing>0}set useThreshold(r){}get colorOutput(){return this.defines.COLOR!==void 0}set colorOutput(r){r?this.defines.COLOR="1":delete this.defines.COLOR,this.needsUpdate=!0}isColorOutputEnabled(r){return this.colorOutput}setColorOutputEnabled(r){this.colorOutput=r}get useRange(){return this.luminanceRange!==null}set useRange(r){this.luminanceRange=null}get luminanceRange(){return this.uniforms.range.value}set luminanceRange(r){r!==null?this.defines.RANGE="1":delete this.defines.RANGE,this.uniforms.range.value=r,this.needsUpdate=!0}getLuminanceRange(){return this.luminanceRange}setLuminanceRange(r){this.luminanceRange=r}},PY=class extends Go{constructor({renderTarget:r,luminanceRange:e,colorOutput:t,resolutionScale:n=1,width:i=ha.AUTO_SIZE,height:o=ha.AUTO_SIZE,resolutionX:a=i,resolutionY:s=o}={}){super("LuminancePass"),this.fullscreenMaterial=new NY(t,e),this.needsSwap=!1,this.renderTarget=r,this.renderTarget===void 0&&(this.renderTarget=new ii(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="LuminancePass.Target");const u=this.resolution=new ha(this,a,s,n);u.addEventListener("change",l=>this.setSize(u.baseWidth,u.baseHeight))}get texture(){return this.renderTarget.texture}getTexture(){return this.renderTarget.texture}getResolution(){return this.resolution}render(r,e,t,n,i){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,r.setRenderTarget(this.renderToScreen?null:this.renderTarget),r.render(this.scene,this.camera)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height)}initialize(r,e,t){t!==void 0&&t!==$r&&(this.renderTarget.texture.type=t,this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}},FY=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#define WEIGHT_INNER 0.125
#define WEIGHT_OUTER 0.0555555
varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;float clampToBorder(const in vec2 uv){return float(uv.s>=0.0&&uv.s<=1.0&&uv.t>=0.0&&uv.t<=1.0);}void main(){vec4 c=vec4(0.0);vec4 w=WEIGHT_INNER*vec4(clampToBorder(vUv00),clampToBorder(vUv01),clampToBorder(vUv02),clampToBorder(vUv03));c+=w.x*texture2D(inputBuffer,vUv00);c+=w.y*texture2D(inputBuffer,vUv01);c+=w.z*texture2D(inputBuffer,vUv02);c+=w.w*texture2D(inputBuffer,vUv03);w=WEIGHT_OUTER*vec4(clampToBorder(vUv04),clampToBorder(vUv05),clampToBorder(vUv06),clampToBorder(vUv07));c+=w.x*texture2D(inputBuffer,vUv04);c+=w.y*texture2D(inputBuffer,vUv05);c+=w.z*texture2D(inputBuffer,vUv06);c+=w.w*texture2D(inputBuffer,vUv07);w=WEIGHT_OUTER*vec4(clampToBorder(vUv08),clampToBorder(vUv09),clampToBorder(vUv10),clampToBorder(vUv11));c+=w.x*texture2D(inputBuffer,vUv08);c+=w.y*texture2D(inputBuffer,vUv09);c+=w.z*texture2D(inputBuffer,vUv10);c+=w.w*texture2D(inputBuffer,vUv11);c+=WEIGHT_OUTER*texture2D(inputBuffer,vUv);gl_FragColor=c;
#include <colorspace_fragment>
}`,OY="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv00;varying vec2 vUv01;varying vec2 vUv02;varying vec2 vUv03;varying vec2 vUv04;varying vec2 vUv05;varying vec2 vUv06;varying vec2 vUv07;varying vec2 vUv08;varying vec2 vUv09;varying vec2 vUv10;varying vec2 vUv11;void main(){vUv=position.xy*0.5+0.5;vUv00=vUv+texelSize*vec2(-1.0,1.0);vUv01=vUv+texelSize*vec2(1.0,1.0);vUv02=vUv+texelSize*vec2(-1.0,-1.0);vUv03=vUv+texelSize*vec2(1.0,-1.0);vUv04=vUv+texelSize*vec2(-2.0,2.0);vUv05=vUv+texelSize*vec2(0.0,2.0);vUv06=vUv+texelSize*vec2(2.0,2.0);vUv07=vUv+texelSize*vec2(-2.0,0.0);vUv08=vUv+texelSize*vec2(2.0,0.0);vUv09=vUv+texelSize*vec2(-2.0,-2.0);vUv10=vUv+texelSize*vec2(0.0,-2.0);vUv11=vUv+texelSize*vec2(2.0,-2.0);gl_Position=vec4(position.xy,1.0,1.0);}",LY=class extends Xr{constructor(){super({name:"DownsamplingMaterial",uniforms:{inputBuffer:new fn(null),texelSize:new fn(new Wt)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:FY,vertexShader:OY})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},BY=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;uniform mediump sampler2D supportBuffer;
#else
uniform lowp sampler2D inputBuffer;uniform lowp sampler2D supportBuffer;
#endif
uniform float radius;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vec4 c=vec4(0.0);c+=texture2D(inputBuffer,vUv0)*0.0625;c+=texture2D(inputBuffer,vUv1)*0.125;c+=texture2D(inputBuffer,vUv2)*0.0625;c+=texture2D(inputBuffer,vUv3)*0.125;c+=texture2D(inputBuffer,vUv)*0.25;c+=texture2D(inputBuffer,vUv4)*0.125;c+=texture2D(inputBuffer,vUv5)*0.0625;c+=texture2D(inputBuffer,vUv6)*0.125;c+=texture2D(inputBuffer,vUv7)*0.0625;vec4 baseColor=texture2D(supportBuffer,vUv);gl_FragColor=mix(baseColor,c,radius);
#include <colorspace_fragment>
}`,UY="uniform vec2 texelSize;varying vec2 vUv;varying vec2 vUv0;varying vec2 vUv1;varying vec2 vUv2;varying vec2 vUv3;varying vec2 vUv4;varying vec2 vUv5;varying vec2 vUv6;varying vec2 vUv7;void main(){vUv=position.xy*0.5+0.5;vUv0=vUv+texelSize*vec2(-1.0,1.0);vUv1=vUv+texelSize*vec2(0.0,1.0);vUv2=vUv+texelSize*vec2(1.0,1.0);vUv3=vUv+texelSize*vec2(-1.0,0.0);vUv4=vUv+texelSize*vec2(1.0,0.0);vUv5=vUv+texelSize*vec2(-1.0,-1.0);vUv6=vUv+texelSize*vec2(0.0,-1.0);vUv7=vUv+texelSize*vec2(1.0,-1.0);gl_Position=vec4(position.xy,1.0,1.0);}",zY=class extends Xr{constructor(){super({name:"UpsamplingMaterial",uniforms:{inputBuffer:new fn(null),supportBuffer:new fn(null),texelSize:new fn(new Wt),radius:new fn(.85)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,fragmentShader:BY,vertexShader:UY})}set inputBuffer(r){this.uniforms.inputBuffer.value=r}set supportBuffer(r){this.uniforms.supportBuffer.value=r}get radius(){return this.uniforms.radius.value}set radius(r){this.uniforms.radius.value=r}setSize(r,e){this.uniforms.texelSize.value.set(1/r,1/e)}},WY=class extends Go{constructor(){super("MipmapBlurPass"),this.needsSwap=!1,this.renderTarget=new ii(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Upsampling.Mipmap0",this.downsamplingMipmaps=[],this.upsamplingMipmaps=[],this.downsamplingMaterial=new LY,this.upsamplingMaterial=new zY,this.resolution=new Wt}get texture(){return this.renderTarget.texture}get levels(){return this.downsamplingMipmaps.length}set levels(r){if(this.levels!==r){const e=this.renderTarget;this.dispose(),this.downsamplingMipmaps=[],this.upsamplingMipmaps=[];for(let t=0;t<r;++t){const n=e.clone();n.texture.name="Downsampling.Mipmap"+t,this.downsamplingMipmaps.push(n)}this.upsamplingMipmaps.push(e);for(let t=1,n=r-1;t<n;++t){const i=e.clone();i.texture.name="Upsampling.Mipmap"+t,this.upsamplingMipmaps.push(i)}this.setSize(this.resolution.x,this.resolution.y)}}get radius(){return this.upsamplingMaterial.radius}set radius(r){this.upsamplingMaterial.radius=r}render(r,e,t,n,i){const{scene:o,camera:a}=this,{downsamplingMaterial:s,upsamplingMaterial:u}=this,{downsamplingMipmaps:l,upsamplingMipmaps:c}=this;let h=e;this.fullscreenMaterial=s;for(let f=0,m=l.length;f<m;++f){const g=l[f];s.setSize(h.width,h.height),s.inputBuffer=h.texture,r.setRenderTarget(g),r.render(o,a),h=g}this.fullscreenMaterial=u;for(let f=c.length-1;f>=0;--f){const m=c[f];u.setSize(h.width,h.height),u.inputBuffer=h.texture,u.supportBuffer=l[f].texture,r.setRenderTarget(m),r.render(o,a),h=m}}setSize(r,e){const t=this.resolution;t.set(r,e);let n=t.width,i=t.height;for(let o=0,a=this.downsamplingMipmaps.length;o<a;++o)n=Math.round(n*.5),i=Math.round(i*.5),this.downsamplingMipmaps[o].setSize(n,i),o<this.upsamplingMipmaps.length&&this.upsamplingMipmaps[o].setSize(n,i)}initialize(r,e,t){if(t!==void 0){const n=this.downsamplingMipmaps.concat(this.upsamplingMipmaps);for(const i of n)i.texture.type=t;if(t!==$r)this.downsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1",this.upsamplingMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1";else if(r!==null&&r.outputColorSpace===Cn)for(const i of n)i.texture.colorSpace=Cn}}dispose(){super.dispose();for(const r of this.downsamplingMipmaps.concat(this.upsamplingMipmaps))r.dispose()}},HY=`#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D map;
#else
uniform lowp sampler2D map;
#endif
uniform float intensity;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec4 texel=texture2D(map,uv);outputColor=vec4(texel.rgb*intensity,max(inputColor.a,texel.a));}`,GY=class extends pR{constructor({blendFunction:r=un.SCREEN,luminanceThreshold:e=1,luminanceSmoothing:t=.03,mipmapBlur:n=!0,intensity:i=1,radius:o=.85,levels:a=8,kernelSize:s=Z1.LARGE,resolutionScale:u=.5,width:l=ha.AUTO_SIZE,height:c=ha.AUTO_SIZE,resolutionX:h=l,resolutionY:f=c}={}){super("BloomEffect",HY,{blendFunction:r,uniforms:new Map([["map",new fn(null)],["intensity",new fn(i)]])}),this.renderTarget=new ii(1,1,{depthBuffer:!1}),this.renderTarget.texture.name="Bloom.Target",this.blurPass=new IY({kernelSize:s}),this.luminancePass=new PY({colorOutput:!0}),this.luminanceMaterial.threshold=e,this.luminanceMaterial.smoothing=t,this.mipmapBlurPass=new WY,this.mipmapBlurPass.enabled=n,this.mipmapBlurPass.radius=o,this.mipmapBlurPass.levels=a,this.uniforms.get("map").value=n?this.mipmapBlurPass.texture:this.renderTarget.texture;const m=this.resolution=new ha(this,h,f,u);m.addEventListener("change",g=>this.setSize(m.baseWidth,m.baseHeight))}get texture(){return this.mipmapBlurPass.enabled?this.mipmapBlurPass.texture:this.renderTarget.texture}getTexture(){return this.texture}getResolution(){return this.resolution}getBlurPass(){return this.blurPass}getLuminancePass(){return this.luminancePass}get luminanceMaterial(){return this.luminancePass.fullscreenMaterial}getLuminanceMaterial(){return this.luminancePass.fullscreenMaterial}get width(){return this.resolution.width}set width(r){this.resolution.preferredWidth=r}get height(){return this.resolution.height}set height(r){this.resolution.preferredHeight=r}get dithering(){return this.blurPass.dithering}set dithering(r){this.blurPass.dithering=r}get kernelSize(){return this.blurPass.kernelSize}set kernelSize(r){this.blurPass.kernelSize=r}get distinction(){return console.warn(this.name,"distinction was removed"),1}set distinction(r){console.warn(this.name,"distinction was removed")}get intensity(){return this.uniforms.get("intensity").value}set intensity(r){this.uniforms.get("intensity").value=r}getIntensity(){return this.intensity}setIntensity(r){this.intensity=r}getResolutionScale(){return this.resolution.scale}setResolutionScale(r){this.resolution.scale=r}update(r,e,t){const n=this.renderTarget,i=this.luminancePass;i.enabled?(i.render(r,e),this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,i.renderTarget):this.blurPass.render(r,i.renderTarget,n)):this.mipmapBlurPass.enabled?this.mipmapBlurPass.render(r,e):this.blurPass.render(r,e,n)}setSize(r,e){const t=this.resolution;t.setBaseSize(r,e),this.renderTarget.setSize(t.width,t.height),this.blurPass.resolution.copy(t),this.luminancePass.setSize(r,e),this.mipmapBlurPass.setSize(r,e)}initialize(r,e,t){this.blurPass.initialize(r,e,t),this.luminancePass.initialize(r,e,t),this.mipmapBlurPass.initialize(r,e,t),t!==void 0&&(this.renderTarget.texture.type=t,r!==null&&r.outputColorSpace===Cn&&(this.renderTarget.texture.colorSpace=Cn))}},VY=`#ifdef RADIAL_MODULATION
uniform float modulationOffset;
#endif
varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainImage(const in vec4 inputColor,const in vec2 uv,out vec4 outputColor){vec2 ra=inputColor.ra;vec2 ba=inputColor.ba;
#ifdef RADIAL_MODULATION
const vec2 center=vec2(0.5);float d=distance(uv,center)*2.0;d=max(d-modulationOffset,0.0);if(vActive>0.0&&d>0.0){ra=texture2D(inputBuffer,mix(uv,vUvR,d)).ra;ba=texture2D(inputBuffer,mix(uv,vUvB,d)).ba;}
#else
if(vActive>0.0){ra=texture2D(inputBuffer,vUvR).ra;ba=texture2D(inputBuffer,vUvB).ba;}
#endif
outputColor=vec4(ra.x,inputColor.g,ba.x,max(max(ra.y,ba.y),inputColor.a));}`,jY="uniform vec2 offset;varying float vActive;varying vec2 vUvR;varying vec2 vUvB;void mainSupport(const in vec2 uv){vec2 shift=offset*vec2(1.0,aspect);vActive=(shift.x!=0.0||shift.y!=0.0)?1.0:0.0;vUvR=uv+shift;vUvB=uv-shift;}",qY=class extends pR{constructor({offset:r=new Wt(.001,5e-4),radialModulation:e=!1,modulationOffset:t=.15}={}){super("ChromaticAberrationEffect",VY,{vertexShader:jY,attributes:Ks.CONVOLUTION,uniforms:new Map([["offset",new fn(r)],["modulationOffset",new fn(t)]])}),this.radialModulation=e}get offset(){return this.uniforms.get("offset").value}set offset(r){this.uniforms.get("offset").value=r}get radialModulation(){return this.defines.has("RADIAL_MODULATION")}set radialModulation(r){r?this.defines.set("RADIAL_MODULATION","1"):this.defines.delete("RADIAL_MODULATION"),this.setChanged()}get modulationOffset(){return this.uniforms.get("modulationOffset").value}set modulationOffset(r){this.uniforms.get("modulationOffset").value=r}getOffset(){return this.offset}setOffset(r){this.offset=r}},$Y=class extends Go{constructor(r,e,t=null){super("RenderPass",r,e),this.needsSwap=!1,this.clearPass=new fR,this.overrideMaterialManager=t===null?null:new Uk(t),this.ignoreBackground=!1,this.skipShadowMapUpdate=!1,this.selection=null}set mainScene(r){this.scene=r}set mainCamera(r){this.camera=r}get renderToScreen(){return super.renderToScreen}set renderToScreen(r){super.renderToScreen=r,this.clearPass.renderToScreen=r}get overrideMaterial(){const r=this.overrideMaterialManager;return r!==null?r.material:null}set overrideMaterial(r){const e=this.overrideMaterialManager;r!==null?e!==null?e.setMaterial(r):this.overrideMaterialManager=new Uk(r):e!==null&&(e.dispose(),this.overrideMaterialManager=null)}getOverrideMaterial(){return this.overrideMaterial}setOverrideMaterial(r){this.overrideMaterial=r}get clear(){return this.clearPass.enabled}set clear(r){this.clearPass.enabled=r}getSelection(){return this.selection}setSelection(r){this.selection=r}isBackgroundDisabled(){return this.ignoreBackground}setBackgroundDisabled(r){this.ignoreBackground=r}isShadowMapDisabled(){return this.skipShadowMapUpdate}setShadowMapDisabled(r){this.skipShadowMapUpdate=r}getClearPass(){return this.clearPass}render(r,e,t,n,i){const o=this.scene,a=this.camera,s=this.selection,u=a.layers.mask,l=o.background,c=r.shadowMap.autoUpdate,h=this.renderToScreen?null:e;s!==null&&a.layers.set(s.getLayer()),this.skipShadowMapUpdate&&(r.shadowMap.autoUpdate=!1),(this.ignoreBackground||this.clearPass.overrideClearColor!==null)&&(o.background=null),this.clearPass.enabled&&this.clearPass.render(r,e),r.setRenderTarget(h),this.overrideMaterialManager!==null?this.overrideMaterialManager.render(r,o,a):r.render(o,a),a.layers.mask=u,o.background=l,r.shadowMap.autoUpdate=c}},XY=`#include <common>
#include <packing>
#include <dithering_pars_fragment>
#define packFloatToRGBA(v) packDepthToRGBA(v)
#define unpackRGBAToFloat(v) unpackRGBAToDepth(v)
#ifdef FRAMEBUFFER_PRECISION_HIGH
uniform mediump sampler2D inputBuffer;
#else
uniform lowp sampler2D inputBuffer;
#endif
#if DEPTH_PACKING == 3201
uniform lowp sampler2D depthBuffer;
#elif defined(GL_FRAGMENT_PRECISION_HIGH)
uniform highp sampler2D depthBuffer;
#else
uniform mediump sampler2D depthBuffer;
#endif
uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;vec4 sRGBToLinear(const in vec4 value){return vec4(mix(pow(value.rgb*0.9478672986+vec3(0.0521327014),vec3(2.4)),value.rgb*0.0773993808,vec3(lessThanEqual(value.rgb,vec3(0.04045)))),value.a);}float readDepth(const in vec2 uv){
#if DEPTH_PACKING == 3201
float depth=unpackRGBAToDepth(texture2D(depthBuffer,uv));
#else
float depth=texture2D(depthBuffer,uv).r;
#endif
#if defined(USE_LOGARITHMIC_DEPTH_BUFFER) || defined(LOG_DEPTH)
float d=pow(2.0,depth*log2(cameraFar+1.0))-1.0;float a=cameraFar/(cameraFar-cameraNear);float b=cameraFar*cameraNear/(cameraNear-cameraFar);depth=a+b/d;
#elif defined(USE_REVERSED_DEPTH_BUFFER)
depth=1.0-depth;
#endif
return depth;}float getViewZ(const in float depth){
#ifdef PERSPECTIVE_CAMERA
return perspectiveDepthToViewZ(depth,cameraNear,cameraFar);
#else
return orthographicDepthToViewZ(depth,cameraNear,cameraFar);
#endif
}vec3 RGBToHCV(const in vec3 RGB){vec4 P=mix(vec4(RGB.bg,-1.0,2.0/3.0),vec4(RGB.gb,0.0,-1.0/3.0),step(RGB.b,RGB.g));vec4 Q=mix(vec4(P.xyw,RGB.r),vec4(RGB.r,P.yzx),step(P.x,RGB.r));float C=Q.x-min(Q.w,Q.y);float H=abs((Q.w-Q.y)/(6.0*C+EPSILON)+Q.z);return vec3(H,C,Q.x);}vec3 RGBToHSL(const in vec3 RGB){vec3 HCV=RGBToHCV(RGB);float L=HCV.z-HCV.y*0.5;float S=HCV.y/(1.0-abs(L*2.0-1.0)+EPSILON);return vec3(HCV.x,S,L);}vec3 HueToRGB(const in float H){float R=abs(H*6.0-3.0)-1.0;float G=2.0-abs(H*6.0-2.0);float B=2.0-abs(H*6.0-4.0);return clamp(vec3(R,G,B),0.0,1.0);}vec3 HSLToRGB(const in vec3 HSL){vec3 RGB=HueToRGB(HSL.x);float C=(1.0-abs(2.0*HSL.z-1.0))*HSL.y;return(RGB-0.5)*C+HSL.z;}FRAGMENT_HEAD void main(){FRAGMENT_MAIN_UV vec4 color0=texture2D(inputBuffer,UV);vec4 color1=vec4(0.0);FRAGMENT_MAIN_IMAGE color0.a=clamp(color0.a,0.0,1.0);gl_FragColor=color0;
#ifdef ENCODE_OUTPUT
#include <colorspace_fragment>
#endif
#include <dithering_fragment>
}`,YY="uniform vec2 resolution;uniform vec2 texelSize;uniform float cameraNear;uniform float cameraFar;uniform float aspect;uniform float time;varying vec2 vUv;VERTEX_HEAD void main(){vUv=position.xy*0.5+0.5;VERTEX_MAIN_SUPPORT gl_Position=vec4(position.xy,1.0,1.0);}",KY=class extends Xr{constructor(r,e,t,n,i=!1){super({name:"EffectMaterial",defines:{THREE_REVISION:Pd.replace(/\D+/g,""),DEPTH_PACKING:"0",ENCODE_OUTPUT:"1"},uniforms:{inputBuffer:new fn(null),depthBuffer:new fn(null),resolution:new fn(new Wt),texelSize:new fn(new Wt),cameraNear:new fn(.3),cameraFar:new fn(1e3),aspect:new fn(1),time:new fn(0)},blending:wi,toneMapped:!1,depthWrite:!1,depthTest:!1,dithering:i}),r&&this.setShaderParts(r),e&&this.setDefines(e),t&&this.setUniforms(t),this.copyCameraSettings(n)}set inputBuffer(r){this.uniforms.inputBuffer.value=r}setInputBuffer(r){this.uniforms.inputBuffer.value=r}get depthBuffer(){return this.uniforms.depthBuffer.value}set depthBuffer(r){this.uniforms.depthBuffer.value=r}get depthPacking(){return Number(this.defines.DEPTH_PACKING)}set depthPacking(r){this.defines.DEPTH_PACKING=r.toFixed(0),this.needsUpdate=!0}setDepthBuffer(r,e=Od){this.depthBuffer=r,this.depthPacking=e}setShaderData(r){this.setShaderParts(r.shaderParts),this.setDefines(r.defines),this.setUniforms(r.uniforms),this.setExtensions(r.extensions)}setShaderParts(r){return this.fragmentShader=XY.replace(vn.FRAGMENT_HEAD,r.get(vn.FRAGMENT_HEAD)||"").replace(vn.FRAGMENT_MAIN_UV,r.get(vn.FRAGMENT_MAIN_UV)||"").replace(vn.FRAGMENT_MAIN_IMAGE,r.get(vn.FRAGMENT_MAIN_IMAGE)||""),this.vertexShader=YY.replace(vn.VERTEX_HEAD,r.get(vn.VERTEX_HEAD)||"").replace(vn.VERTEX_MAIN_SUPPORT,r.get(vn.VERTEX_MAIN_SUPPORT)||""),this.needsUpdate=!0,this}setDefines(r){for(const e of r.entries())this.defines[e[0]]=e[1];return this.needsUpdate=!0,this}setUniforms(r){for(const e of r.entries())this.uniforms[e[0]]=e[1];return this}setExtensions(r){this.extensions={};for(const e of r)this.extensions[e]=!0;return this}get encodeOutput(){return this.defines.ENCODE_OUTPUT!==void 0}set encodeOutput(r){this.encodeOutput!==r&&(r?this.defines.ENCODE_OUTPUT="1":delete this.defines.ENCODE_OUTPUT,this.needsUpdate=!0)}isOutputEncodingEnabled(r){return this.encodeOutput}setOutputEncodingEnabled(r){this.encodeOutput=r}get time(){return this.uniforms.time.value}set time(r){this.uniforms.time.value=r}setDeltaTime(r){this.uniforms.time.value+=r}adoptCameraSettings(r){this.copyCameraSettings(r)}copyCameraSettings(r){r&&(this.uniforms.cameraNear.value=r.near,this.uniforms.cameraFar.value=r.far,r instanceof to?this.defines.PERSPECTIVE_CAMERA="1":delete this.defines.PERSPECTIVE_CAMERA,this.needsUpdate=!0)}setSize(r,e){const t=this.uniforms;t.resolution.value.set(r,e),t.texelSize.value.set(1/r,1/e),t.aspect.value=r/e}static get Section(){return vn}};function zk(r,e,t){for(const n of e){const i="$1"+r+n.charAt(0).toUpperCase()+n.slice(1),o=new RegExp("([^\\.])(\\b"+n+"\\b)","g");for(const a of t.entries())a[1]!==null&&t.set(a[0],a[1].replace(o,i))}}function JY(r,e,t){let n=e.getFragmentShader(),i=e.getVertexShader();const o=n!==void 0&&/mainImage/.test(n),a=n!==void 0&&/mainUv/.test(n);if(t.attributes|=e.getAttributes(),n===void 0)throw new Error(`Missing fragment shader (${e.name})`);if(a&&(t.attributes&Ks.CONVOLUTION)!==0)throw new Error(`Effects that transform UVs are incompatible with convolution effects (${e.name})`);if(!o&&!a)throw new Error(`Could not find mainImage or mainUv function (${e.name})`);{const s=/\w+\s+(\w+)\([\w\s,]*\)\s*{/g,u=t.shaderParts;let l=u.get(vn.FRAGMENT_HEAD)||"",c=u.get(vn.FRAGMENT_MAIN_UV)||"",h=u.get(vn.FRAGMENT_MAIN_IMAGE)||"",f=u.get(vn.VERTEX_HEAD)||"",m=u.get(vn.VERTEX_MAIN_SUPPORT)||"";const g=new Set,w=new Set;if(a&&(c+=`	${r}MainUv(UV);
`,t.uvTransformation=!0),i!==null&&/mainSupport/.test(i)){const x=/mainSupport *\([\w\s]*?uv\s*?\)/.test(i);m+=`	${r}MainSupport(`,m+=x?`vUv);
`:`);
`;for(const E of i.matchAll(/(?:varying\s+\w+\s+([\S\s]*?);)/g))for(const _ of E[1].split(/\s*,\s*/))t.varyings.add(_),g.add(_),w.add(_);for(const E of i.matchAll(s))w.add(E[1])}for(const x of n.matchAll(s))w.add(x[1]);for(const x of e.defines.keys())w.add(x.replace(/\([\w\s,]*\)/g,""));for(const x of e.uniforms.keys())w.add(x);w.delete("while"),w.delete("for"),w.delete("if"),e.uniforms.forEach((x,E)=>t.uniforms.set(r+E.charAt(0).toUpperCase()+E.slice(1),x)),e.defines.forEach((x,E)=>t.defines.set(r+E.charAt(0).toUpperCase()+E.slice(1),x));const v=new Map([["fragment",n],["vertex",i]]);zk(r,w,t.defines),zk(r,w,v),n=v.get("fragment"),i=v.get("vertex");const y=e.blendMode;if(t.blendModes.set(y.blendFunction,y),o){e.inputColorSpace!==null&&e.inputColorSpace!==t.colorSpace&&(h+=e.inputColorSpace===Cn?`color0 = sRGBTransferOETF(color0);
	`:`color0 = sRGBToLinear(color0);
	`),e.outputColorSpace!==sa?t.colorSpace=e.outputColorSpace:e.inputColorSpace!==null&&(t.colorSpace=e.inputColorSpace);const x=/MainImage *\([\w\s,]*?depth[\w\s,]*?\)/;h+=`${r}MainImage(color0, UV, `,(t.attributes&Ks.DEPTH)!==0&&x.test(n)&&(h+="depth, ",t.readDepth=!0),h+=`color1);
	`;const E=r+"BlendOpacity";t.uniforms.set(E,y.opacity),h+=`color0 = blend${y.blendFunction}(color0, color1, ${E});

	`,l+=`uniform float ${E};

`}if(l+=n+`
`,i!==null&&(f+=i+`
`),u.set(vn.FRAGMENT_HEAD,l),u.set(vn.FRAGMENT_MAIN_UV,c),u.set(vn.FRAGMENT_MAIN_IMAGE,h),u.set(vn.VERTEX_HEAD,f),u.set(vn.VERTEX_MAIN_SUPPORT,m),e.extensions!==null)for(const x of e.extensions)t.extensions.add(x)}}var ZY=class extends Go{constructor(r,...e){super("EffectPass"),this.fullscreenMaterial=new KY(null,null,null,r),this.listener=t=>this.handleEvent(t),this.effects=[],this.setEffects(e),this.skipRendering=!1,this.minTime=1,this.maxTime=Number.POSITIVE_INFINITY,this.timeScale=1}set mainScene(r){for(const e of this.effects)e.mainScene=r}set mainCamera(r){this.fullscreenMaterial.copyCameraSettings(r);for(const e of this.effects)e.mainCamera=r}get encodeOutput(){return this.fullscreenMaterial.encodeOutput}set encodeOutput(r){this.fullscreenMaterial.encodeOutput=r}get dithering(){return this.fullscreenMaterial.dithering}set dithering(r){const e=this.fullscreenMaterial;e.dithering=r,e.needsUpdate=!0}setEffects(r){for(const e of this.effects)e.removeEventListener("change",this.listener);this.effects=r.sort((e,t)=>t.attributes-e.attributes);for(const e of this.effects)e.addEventListener("change",this.listener)}updateMaterial(){const r=new $X;let e=0;for(const a of this.effects)if(a.blendMode.blendFunction===un.DST)r.attributes|=a.getAttributes()&Ks.DEPTH;else{if((r.attributes&a.getAttributes()&Ks.CONVOLUTION)!==0)throw new Error(`Convolution effects cannot be merged (${a.name})`);JY("e"+e++,a,r)}let t=r.shaderParts.get(vn.FRAGMENT_HEAD),n=r.shaderParts.get(vn.FRAGMENT_MAIN_IMAGE),i=r.shaderParts.get(vn.FRAGMENT_MAIN_UV);const o=/\bblend\b/g;for(const a of r.blendModes.values())t+=a.getShaderCode().replace(o,`blend${a.blendFunction}`)+`
`;(r.attributes&Ks.DEPTH)!==0?(r.readDepth&&(n=`float depth = readDepth(UV);

	`+n),this.needsDepthTexture=this.getDepthTexture()===null):this.needsDepthTexture=!1,r.colorSpace===Cn&&(n+=`color0 = sRGBToLinear(color0);
	`),r.uvTransformation?(i=`vec2 transformedUv = vUv;
`+i,r.defines.set("UV","transformedUv")):r.defines.set("UV","vUv"),r.shaderParts.set(vn.FRAGMENT_HEAD,t),r.shaderParts.set(vn.FRAGMENT_MAIN_IMAGE,n),r.shaderParts.set(vn.FRAGMENT_MAIN_UV,i);for(const[a,s]of r.shaderParts)s!==null&&r.shaderParts.set(a,s.trim().replace(/^#/,`
#`));this.skipRendering=e===0,this.needsSwap=!this.skipRendering,this.fullscreenMaterial.setShaderData(r)}recompile(){this.updateMaterial()}getDepthTexture(){return this.fullscreenMaterial.depthBuffer}setDepthTexture(r,e=Od){this.fullscreenMaterial.depthBuffer=r,this.fullscreenMaterial.depthPacking=e;for(const t of this.effects)t.setDepthTexture(r,e)}render(r,e,t,n,i){for(const o of this.effects)o.update(r,e,n);if(!this.skipRendering||this.renderToScreen){const o=this.fullscreenMaterial;o.inputBuffer=e.texture,o.time+=n*this.timeScale,r.setRenderTarget(this.renderToScreen?null:t),r.render(this.scene,this.camera)}}setSize(r,e){this.fullscreenMaterial.setSize(r,e);for(const t of this.effects)t.setSize(r,e)}initialize(r,e,t){this.renderer=r;for(const n of this.effects)n.initialize(r,e,t);this.updateMaterial(),t!==void 0&&t!==$r&&(this.fullscreenMaterial.defines.FRAMEBUFFER_PRECISION_HIGH="1")}dispose(){super.dispose();for(const r of this.effects)r.removeEventListener("change",this.listener),r.dispose()}handleEvent(r){switch(r.type){case"change":this.recompile();break}}};const QY=`
varying vec2 vUv;
void main(){
  vUv = uv;
  gl_Position = vec4(position.xy, 0.0, 1.0);
}
`,eK=`
precision highp float;
uniform vec3 iResolution;
uniform float iTime;
uniform vec2 uSkew;
uniform float uTilt;
uniform float uYaw;
uniform float uLineThickness;
uniform vec3 uLinesColor;
uniform vec3 uScanColor;
uniform float uGridScale;
uniform float uLineStyle;
uniform float uLineJitter;
uniform float uScanOpacity;
uniform float uScanDirection;
uniform float uNoise;
uniform float uBloomOpacity;
uniform float uScanGlow;
uniform float uScanSoftness;
uniform float uPhaseTaper;
uniform float uScanDuration;
uniform float uScanDelay;
varying vec2 vUv;

uniform float uScanStarts[8];
uniform float uScanCount;

const int MAX_SCANS = 8;

float smoother01(float a, float b, float x){
  float t = clamp((x - a) / max(1e-5, (b - a)), 0.0, 1.0);
  return t * t * t * (t * (t * 6.0 - 15.0) + 10.0);
}

void mainImage(out vec4 fragColor, in vec2 fragCoord)
{
    vec2 p = (2.0 * fragCoord - iResolution.xy) / iResolution.y;

    vec3 ro = vec3(0.0);
    vec3 rd = normalize(vec3(p, 2.0));

    float cR = cos(uTilt), sR = sin(uTilt);
    rd.xy = mat2(cR, -sR, sR, cR) * rd.xy;

    float cY = cos(uYaw), sY = sin(uYaw);
    rd.xz = mat2(cY, -sY, sY, cY) * rd.xz;

    vec2 skew = clamp(uSkew, vec2(-0.7), vec2(0.7));
    rd.xy += skew * rd.z;

    vec3 color = vec3(0.0);
  float minT = 1e20;
  float gridScale = max(1e-5, uGridScale);
    float fadeStrength = 2.0;
    vec2 gridUV = vec2(0.0);

  float hitIsY = 1.0;
    for (int i = 0; i < 4; i++)
    {
        float isY = float(i < 2);
        float pos = mix(-0.2, 0.2, float(i)) * isY + mix(-0.5, 0.5, float(i - 2)) * (1.0 - isY);
        float num = pos - (isY * ro.y + (1.0 - isY) * ro.x);
        float den = isY * rd.y + (1.0 - isY) * rd.x;
        float t = num / den;
        vec3 h = ro + rd * t;

        float depthBoost = smoothstep(0.0, 3.0, h.z);
        h.xy += skew * 0.15 * depthBoost;

    bool use = t > 0.0 && t < minT;
    gridUV = use ? mix(h.zy, h.xz, isY) / gridScale : gridUV;
    minT = use ? t : minT;
    hitIsY = use ? isY : hitIsY;
    }

    vec3 hit = ro + rd * minT;
    float dist = length(hit - ro);

  float jitterAmt = clamp(uLineJitter, 0.0, 1.0);
  if (jitterAmt > 0.0) {
    vec2 j = vec2(
      sin(gridUV.y * 2.7 + iTime * 1.8),
      cos(gridUV.x * 2.3 - iTime * 1.6)
    ) * (0.15 * jitterAmt);
    gridUV += j;
  }
  float fx = fract(gridUV.x);
  float fy = fract(gridUV.y);
  float ax = min(fx, 1.0 - fx);
  float ay = min(fy, 1.0 - fy);
  float wx = fwidth(gridUV.x);
  float wy = fwidth(gridUV.y);
  float halfPx = max(0.0, uLineThickness) * 0.5;

  float tx = halfPx * wx;
  float ty = halfPx * wy;

  float aax = wx;
  float aay = wy;

  float lineX = 1.0 - smoothstep(tx, tx + aax, ax);
  float lineY = 1.0 - smoothstep(ty, ty + aay, ay);
  if (uLineStyle > 0.5) {
    float dashRepeat = 4.0;
    float dashDuty = 0.5;
    float vy = fract(gridUV.y * dashRepeat);
    float vx = fract(gridUV.x * dashRepeat);
    float dashMaskY = step(vy, dashDuty);
    float dashMaskX = step(vx, dashDuty);
    if (uLineStyle < 1.5) {
      lineX *= dashMaskY;
      lineY *= dashMaskX;
    } else {
      float dotRepeat = 6.0;
      float dotWidth = 0.18;
      float cy = abs(fract(gridUV.y * dotRepeat) - 0.5);
      float cx = abs(fract(gridUV.x * dotRepeat) - 0.5);
      float dotMaskY = 1.0 - smoothstep(dotWidth, dotWidth + fwidth(gridUV.y * dotRepeat), cy);
      float dotMaskX = 1.0 - smoothstep(dotWidth, dotWidth + fwidth(gridUV.x * dotRepeat), cx);
      lineX *= dotMaskY;
      lineY *= dotMaskX;
    }
  }
  float primaryMask = max(lineX, lineY);

  vec2 gridUV2 = (hitIsY > 0.5 ? hit.xz : hit.zy) / gridScale;
  if (jitterAmt > 0.0) {
    vec2 j2 = vec2(
      cos(gridUV2.y * 2.1 - iTime * 1.4),
      sin(gridUV2.x * 2.5 + iTime * 1.7)
    ) * (0.15 * jitterAmt);
    gridUV2 += j2;
  }
  float fx2 = fract(gridUV2.x);
  float fy2 = fract(gridUV2.y);
  float ax2 = min(fx2, 1.0 - fx2);
  float ay2 = min(fy2, 1.0 - fy2);
  float wx2 = fwidth(gridUV2.x);
  float wy2 = fwidth(gridUV2.y);
  float tx2 = halfPx * wx2;
  float ty2 = halfPx * wy2;
  float aax2 = wx2;
  float aay2 = wy2;
  float lineX2 = 1.0 - smoothstep(tx2, tx2 + aax2, ax2);
  float lineY2 = 1.0 - smoothstep(ty2, ty2 + aay2, ay2);
  if (uLineStyle > 0.5) {
    float dashRepeat2 = 4.0;
    float dashDuty2 = 0.5;
    float vy2m = fract(gridUV2.y * dashRepeat2);
    float vx2m = fract(gridUV2.x * dashRepeat2);
    float dashMaskY2 = step(vy2m, dashDuty2);
    float dashMaskX2 = step(vx2m, dashDuty2);
    if (uLineStyle < 1.5) {
      lineX2 *= dashMaskY2;
      lineY2 *= dashMaskX2;
    } else {
      float dotRepeat2 = 6.0;
      float dotWidth2 = 0.18;
      float cy2 = abs(fract(gridUV2.y * dotRepeat2) - 0.5);
      float cx2 = abs(fract(gridUV2.x * dotRepeat2) - 0.5);
      float dotMaskY2 = 1.0 - smoothstep(dotWidth2, dotWidth2 + fwidth(gridUV2.y * dotRepeat2), cy2);
      float dotMaskX2 = 1.0 - smoothstep(dotWidth2, dotWidth2 + fwidth(gridUV2.x * dotRepeat2), cx2);
      lineX2 *= dotMaskY2;
      lineY2 *= dotMaskX2;
    }
  }
    float altMask = max(lineX2, lineY2);

    float edgeDistX = min(abs(hit.x - (-0.5)), abs(hit.x - 0.5));
    float edgeDistY = min(abs(hit.y - (-0.2)), abs(hit.y - 0.2));
    float edgeDist = mix(edgeDistY, edgeDistX, hitIsY);
    float edgeGate = 1.0 - smoothstep(gridScale * 0.5, gridScale * 2.0, edgeDist);
    altMask *= edgeGate;

  float lineMask = max(primaryMask, altMask);

    float fade = exp(-dist * fadeStrength);

    float dur = max(0.05, uScanDuration);
    float del = max(0.0, uScanDelay);
    float scanZMax = 2.0;
    float widthScale = max(0.1, uScanGlow);
    float sigma = max(0.001, 0.18 * widthScale * uScanSoftness);
    float sigmaA = sigma * 2.0;

    float combinedPulse = 0.0;
    float combinedAura = 0.0;

    float cycle = dur + del;
    float tCycle = mod(iTime, cycle);
    float scanPhase = clamp((tCycle - del) / dur, 0.0, 1.0);
    float phase = scanPhase;
    if (uScanDirection > 0.5 && uScanDirection < 1.5) {
      phase = 1.0 - phase;
    } else if (uScanDirection > 1.5) {
      float t2 = mod(max(0.0, iTime - del), 2.0 * dur);
      phase = (t2 < dur) ? (t2 / dur) : (1.0 - (t2 - dur) / dur);
    }
    float scanZ = phase * scanZMax;
    float dz = abs(hit.z - scanZ);
    float lineBand = exp(-0.5 * (dz * dz) / (sigma * sigma));
    float taper = clamp(uPhaseTaper, 0.0, 0.49);
    float headW = taper;
    float tailW = taper;
    float headFade = smoother01(0.0, headW, phase);
    float tailFade = 1.0 - smoother01(1.0 - tailW, 1.0, phase);
    float phaseWindow = headFade * tailFade;
    float pulseBase = lineBand * phaseWindow;
    combinedPulse += pulseBase * clamp(uScanOpacity, 0.0, 1.0);
    float auraBand = exp(-0.5 * (dz * dz) / (sigmaA * sigmaA));
    combinedAura += (auraBand * 0.25) * phaseWindow * clamp(uScanOpacity, 0.0, 1.0);

    for (int i = 0; i < MAX_SCANS; i++) {
      if (float(i) >= uScanCount) break;
      float tActiveI = iTime - uScanStarts[i];
      float phaseI = clamp(tActiveI / dur, 0.0, 1.0);
      if (uScanDirection > 0.5 && uScanDirection < 1.5) {
        phaseI = 1.0 - phaseI;
      } else if (uScanDirection > 1.5) {
        phaseI = (phaseI < 0.5) ? (phaseI * 2.0) : (1.0 - (phaseI - 0.5) * 2.0);
      }
      float scanZI = phaseI * scanZMax;
      float dzI = abs(hit.z - scanZI);
      float lineBandI = exp(-0.5 * (dzI * dzI) / (sigma * sigma));
      float headFadeI = smoother01(0.0, headW, phaseI);
      float tailFadeI = 1.0 - smoother01(1.0 - tailW, 1.0, phaseI);
      float phaseWindowI = headFadeI * tailFadeI;
      combinedPulse += lineBandI * phaseWindowI * clamp(uScanOpacity, 0.0, 1.0);
      float auraBandI = exp(-0.5 * (dzI * dzI) / (sigmaA * sigmaA));
      combinedAura += (auraBandI * 0.25) * phaseWindowI * clamp(uScanOpacity, 0.0, 1.0);
    }

  float lineVis = lineMask;
  vec3 gridCol = uLinesColor * lineVis * fade;
  vec3 scanCol = uScanColor * combinedPulse;
  vec3 scanAura = uScanColor * combinedAura;

    color = gridCol + scanCol + scanAura;

  float n = fract(sin(dot(gl_FragCoord.xy + vec2(iTime * 123.4), vec2(12.9898,78.233))) * 43758.5453123);
  color += (n - 0.5) * uNoise;
  color = clamp(color, 0.0, 1.0);
  float alpha = clamp(max(lineVis, combinedPulse), 0.0, 1.0);
  float gx = 1.0 - smoothstep(tx * 2.0, tx * 2.0 + aax * 2.0, ax);
  float gy = 1.0 - smoothstep(ty * 2.0, ty * 2.0 + aay * 2.0, ay);
  float halo = max(gx, gy) * fade;
  alpha = max(alpha, halo * clamp(uBloomOpacity, 0.0, 1.0));
  fragColor = vec4(color, alpha);
}

void main(){
  vec4 c;
  mainImage(c, vUv * iResolution.xy);
  gl_FragColor = c;
}
`,tK=({enableWebcam:r=!1,showPreview:e=!1,modelsPath:t="https://cdn.jsdelivr.net/gh/justadudewhohacks/face-api.js@0.22.2/weights",sensitivity:n=.55,lineThickness:i=1,linesColor:o="#392e4e",scanColor:a="#FF9FFC",scanOpacity:s=.4,gridScale:u=.1,lineStyle:l="solid",lineJitter:c=.1,scanDirection:h="pingpong",enablePost:f=!0,bloomIntensity:m=0,bloomThreshold:g=0,bloomSmoothing:w=0,chromaticAberration:v=.002,noiseIntensity:y=.01,scanGlow:x=.5,scanSoftness:E=2,scanPhaseTaper:_=.9,scanDuration:k=2,scanDelay:C=2,enableGyro:R=!1,scanOnClick:I=!1,snapBackDelay:T=250,className:A,style:N,children:O})=>{const V=Ke.useRef(null),F=Ke.useRef(null),B=Ke.useRef(null),U=Ke.useRef(null),P=Ke.useRef(null),L=Ke.useRef(null),H=Ke.useRef(null),W=Ke.useRef(null),[z,q]=Ke.useState(!1),[re,de]=Ke.useState(!1),ye=Ke.useRef(new Wt(0,0)),ne=Ke.useRef(0),ie=Ke.useRef(0),fe=Ke.useRef(new Wt(0,0)),Ae=Ke.useRef(new Wt(0,0)),De=Ke.useRef(0),Be=Ke.useRef(0),lt=Ke.useRef(0),Y=Ke.useRef(0),ot=8,Je=Ke.useRef([]),Xe=Ue=>{const _e=Je.current.slice();if(_e.length>=ot&&_e.shift(),_e.push(Ue),Je.current=_e,U.current){const rt=U.current.uniforms,Ze=new Array(ot).fill(0);for(let Oe=0;Oe<_e.length&&Oe<ot;Oe++)Ze[Oe]=_e[Oe];rt.uScanStarts.value=Ze,rt.uScanCount.value=_e.length}},qe=Ke.useRef([]),Tt=Ke.useRef([]),Qe=Ke.useRef([]),ft=Ke.useRef([]),Mt=Ji.clamp(n,0,1),Ut=Ji.lerp(.06,.2,Mt),Z=Ji.lerp(.12,.3,Mt),j=Ji.lerp(.1,.28,Mt),me=Ji.lerp(.25,.45,Mt),Re=Ji.lerp(.45,.12,Mt),Pe=1/0,ke=Ji.lerp(1.2,1.6,Mt);return Ke.useEffect(()=>{const Ue=V.current;if(!Ue)return;let _e=null;const rt=pt=>{if(re)return;_e&&(clearTimeout(_e),_e=null);const nt=Ue.getBoundingClientRect(),tt=(pt.clientX-nt.left)/nt.width*2-1,Nt=-((pt.clientY-nt.top)/nt.height*2-1);ye.current.set(tt,Nt)},Ze=async()=>{const pt=performance.now()/1e3;if(I&&Xe(pt),R&&typeof window<"u"&&window.DeviceOrientationEvent&&DeviceOrientationEvent.requestPermission)try{await DeviceOrientationEvent.requestPermission()}catch{}},Oe=()=>{_e&&(clearTimeout(_e),_e=null)},$e=()=>{re||(_e&&clearTimeout(_e),_e=window.setTimeout(()=>{ye.current.set(0,0),ne.current=0,ie.current=0},Math.max(0,T||0)))};return Ue.addEventListener("mousemove",rt),Ue.addEventListener("mouseenter",Oe),I&&Ue.addEventListener("click",Ze),Ue.addEventListener("mouseleave",$e),()=>{Ue.removeEventListener("mousemove",rt),Ue.removeEventListener("mouseenter",Oe),Ue.removeEventListener("mouseleave",$e),I&&Ue.removeEventListener("click",Ze),_e&&clearTimeout(_e)}},[re,T,I,R]),Ke.useEffect(()=>{const Ue=V.current;if(!Ue)return;const _e=new BX({antialias:!0,alpha:!0});B.current=_e,_e.setPixelRatio(Math.min(window.devicePixelRatio||1,2)),_e.setSize(Ue.clientWidth,Ue.clientHeight),_e.outputColorSpace=Cn,_e.toneMapping=qa,_e.autoClear=!1,_e.setClearColor(0,0),Ue.appendChild(_e.domElement);const rt={iResolution:{value:new Te(Ue.clientWidth,Ue.clientHeight,_e.getPixelRatio())},iTime:{value:0},uSkew:{value:new Wt(0,0)},uTilt:{value:0},uYaw:{value:0},uLineThickness:{value:i},uLinesColor:{value:Vp(o)},uScanColor:{value:Vp(a)},uGridScale:{value:u},uLineStyle:{value:l==="dashed"?1:l==="dotted"?2:0},uLineJitter:{value:Math.max(0,Math.min(1,c||0))},uScanOpacity:{value:s},uNoise:{value:y},uBloomOpacity:{value:m},uScanGlow:{value:x},uScanSoftness:{value:E},uPhaseTaper:{value:_},uScanDuration:{value:k},uScanDelay:{value:C},uScanDirection:{value:h==="backward"?1:h==="pingpong"?2:0},uScanStarts:{value:new Array(ot).fill(0)},uScanCount:{value:0}},Ze=new Xr({uniforms:rt,vertexShader:QY,fragmentShader:eK,transparent:!0,depthWrite:!1,depthTest:!1});U.current=Ze;const Oe=new dw,$e=new K1(-1,1,1,-1,0,1),pt=new Po(new zd(2,2),Ze);Oe.add(pt);let nt=null;if(f){nt=new qX(_e),P.current=nt;const He=new $Y(Oe,$e);nt.addPass(He);const Ve=new GY({intensity:1,luminanceThreshold:g,luminanceSmoothing:w});Ve.blendMode.opacity.value=Math.max(0,m),L.current=Ve;const it=new qY({offset:new Wt(v,v),radialModulation:!0,modulationOffset:0});H.current=it;const We=new ZY($e,Ve,it);We.renderToScreen=!0,nt.addPass(We)}const tt=()=>{_e.setSize(Ue.clientWidth,Ue.clientHeight),Ze.uniforms.iResolution.value.set(Ue.clientWidth,Ue.clientHeight,_e.getPixelRatio()),P.current&&P.current.setSize(Ue.clientWidth,Ue.clientHeight)};window.addEventListener("resize",tt);let Nt=performance.now();const se=()=>{const He=performance.now(),Ve=Math.max(0,Math.min(.1,(He-Nt)/1e3));Nt=He,fe.current.copy(nK(fe.current,ye.current,Ae.current,Re,Pe,Ve));const it=Wk(De.current,ne.current,{v:Be.current},Re,Pe,Ve);De.current=it.value,Be.current=it.v;const We=Wk(lt.current,ie.current,{v:Y.current},Re,Pe,Ve);lt.current=We.value,Y.current=We.v;const Fe=new Wt(fe.current.x*Ut,-fe.current.y*ke*Ut);Ze.uniforms.uSkew.value.set(Fe.x,Fe.y),Ze.uniforms.uTilt.value=De.current*Z,Ze.uniforms.uYaw.value=Ji.clamp(lt.current*j,-.6,.6),Ze.uniforms.iTime.value=He/1e3,_e.clear(!0,!0,!0),P.current?P.current.render(Ve):_e.render(Oe,$e),W.current=requestAnimationFrame(se)};return W.current=requestAnimationFrame(se),()=>{W.current&&cancelAnimationFrame(W.current),window.removeEventListener("resize",tt),Ze.dispose(),pt.geometry.dispose(),P.current&&(P.current.dispose(),P.current=null),_e.dispose(),Ue.removeChild(_e.domElement)}},[n,i,o,a,s,u,l,c,h,f]),Ke.useEffect(()=>{const Ue=U.current;if(Ue){const _e=Ue.uniforms;_e.uLineThickness.value=i,_e.uLinesColor.value.copy(Vp(o)),_e.uScanColor.value.copy(Vp(a)),_e.uGridScale.value=u,_e.uLineStyle.value=l==="dashed"?1:l==="dotted"?2:0,_e.uLineJitter.value=Math.max(0,Math.min(1,c||0)),_e.uBloomOpacity.value=Math.max(0,m),_e.uNoise.value=Math.max(0,y),_e.uScanGlow.value=x,_e.uScanOpacity.value=Math.max(0,Math.min(1,s)),_e.uScanDirection.value=h==="backward"?1:h==="pingpong"?2:0,_e.uScanSoftness.value=E,_e.uPhaseTaper.value=_,_e.uScanDuration.value=Math.max(.05,k),_e.uScanDelay.value=Math.max(0,C)}L.current&&(L.current.blendMode.opacity.value=Math.max(0,m),L.current.luminanceMaterial.threshold=g,L.current.luminanceMaterial.smoothing=w),H.current&&H.current.offset.set(v,v)},[i,o,a,u,l,c,m,g,w,v,y,x,s,h,E,_,k,C]),Ke.useEffect(()=>{if(!R)return;const Ue=_e=>{if(re)return;const rt=_e.gamma??0,Ze=_e.beta??0,Oe=Ji.clamp(rt/45,-1,1),$e=Ji.clamp(-Ze/30,-1,1);ye.current.set(Oe,$e),ne.current=Ji.degToRad(rt)*.4};return window.addEventListener("deviceorientation",Ue),()=>{window.removeEventListener("deviceorientation",Ue)}},[R,re]),Ke.useEffect(()=>{let Ue=!1;return(async()=>{try{await Promise.all([gi.tinyFaceDetector.loadFromUri(t),gi.faceLandmark68TinyNet.loadFromUri(t)]),Ue||q(!0)}catch{Ue||q(!1)}})(),()=>{Ue=!0}},[t]),Ke.useEffect(()=>{let Ue=!1,_e=0;return(async()=>{if(!r||!z)return;const Ze=F.current;if(!Ze)return;try{const pt=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:1280},height:{ideal:720}},audio:!1});Ze.srcObject=pt,await Ze.play()}catch{return}const Oe=new CA({inputSize:320,scoreThreshold:.5}),$e=async pt=>{if(!Ue){if(pt-_e>=33){_e=pt;try{const nt=await yH(Ze,Oe).withFaceLandmarks(!0);if(nt&&nt.detection){const Nt=nt.detection.box,se=Ze.videoWidth||1,He=Ze.videoHeight||1,Ve=Nt.x+Nt.width*.5,it=Nt.y+Nt.height*.5,We=Ve/se*2-1,Fe=it/He*2-1;jp(qe.current,We,5),jp(Tt.current,Fe,5);const gt=qp(qe.current),Ht=qp(Tt.current),bn=new Wt(Math.tanh(gt),Math.tanh(Ht)),an=Math.min(1,Math.hypot(Nt.width/se,Nt.height/He)),oi=1+me*(an-.25);ye.current.copy(bn.multiplyScalar(oi));const fr=nt.landmarks.getLeftEye(),us=nt.landmarks.getRightEye(),pr=Hk(fr),Vo=Hk(us),jo=Math.atan2(Vo.y-pr.y,Vo.x-pr.x);jp(Qe.current,jo,5),ne.current=qp(Qe.current);const Gi=nt.landmarks.getNose(),Vi=Gi[Gi.length-1]||Gi[Math.floor(Gi.length/2)],fo=nt.landmarks.getJawOutline(),ls=fo[3]||fo[2],ml=fo[13]||fo[14],gl=Gk(Vi,ls),po=Gk(Vi,ml),vl=Math.hypot(Vo.x-pr.x,Vo.y-pr.y)+1e-6;let cs=Ji.clamp((po-gl)/(vl*1.6),-1,1);cs=Math.tanh(cs),jp(ft.current,cs,5),ie.current=qp(ft.current),de(!0)}else de(!1)}catch{de(!1)}}"requestVideoFrameCallback"in HTMLVideoElement.prototype?Ze.requestVideoFrameCallback(()=>$e(performance.now())):requestAnimationFrame($e)}};requestAnimationFrame($e)})(),()=>{Ue=!0;const Ze=F.current;if(Ze){const Oe=Ze.srcObject;Oe&&Oe.getTracks().forEach($e=>$e.stop()),Ze.pause(),Ze.srcObject=null}}},[r,z,me]),Q.jsxs("div",{ref:V,className:`gridscan${A?` ${A}`:""}`,style:N,children:[O&&Q.jsx("div",{className:"gridscan__content",children:O}),e&&Q.jsxs("div",{className:"gridscan__preview",children:[Q.jsx("video",{ref:F,muted:!0,playsInline:!0,autoPlay:!0,className:"gridscan__video"}),Q.jsx("div",{className:"gridscan__badge",children:r?z?re?"Face: tracking":"Face: searching":"Loading models":"Webcam disabled"})]})]})};function Vp(r){return new Sn(r).convertSRGBToLinear()}function nK(r,e,t,n,i,o){const a=r.clone();n=Math.max(1e-4,n);const s=2/n,u=s*o,l=1/(1+u+.48*u*u+.235*u*u*u),c=r.clone().sub(e),h=e.clone(),f=i*n;c.length()>f&&c.setLength(f),e=r.clone().sub(c);const m=t.clone().addScaledVector(c,s).multiplyScalar(o);t.sub(m.clone().multiplyScalar(s)),t.multiplyScalar(l),a.copy(e.clone().add(c.add(m).multiplyScalar(l)));const g=h.clone().sub(r),w=a.clone().sub(h);return g.dot(w)>0&&(a.copy(h),t.set(0,0)),a}function Wk(r,e,t,n,i,o){n=Math.max(1e-4,n);const a=2/n,s=a*o,u=1/(1+s+.48*s*s+.235*s*s*s);let l=r-e;const c=e,h=i*n;l=Math.sign(l)*Math.min(Math.abs(l),h),e=r-l;const f=(t.v+a*l)*o;t.v=(t.v-a*f)*u;let m=e+(l+f)*u;const g=c-r,w=m-c;return g*w>0&&(m=c,t.v=0),{value:m,v:t.v}}function jp(r,e,t){r.push(e),r.length>t&&r.shift()}function qp(r){if(r.length===0)return 0;const e=[...r].sort((n,i)=>n-i),t=Math.floor(e.length/2);return e.length%2?e[t]:(e[t-1]+e[t])*.5}function Hk(r){let e=0,t=0;const n=r.length||1;for(const i of r)e+=i.x,t+=i.y;return{x:e/n,y:t/n}}function Gk(r,e){return Math.hypot(r.x-e.x,r.y-e.y)}const rK=({name:r})=>Q.jsx(zi.Fragment,{children:Q.jsx("section",{id:"home",className:"large-header",children:Q.jsx("div",{className:"overlay",children:Q.jsxs(tK,{sensitivity:.55,lineThickness:1,linesColor:"#392e4e",gridScale:.1,scanColor:"#FF9FFC",scanOpacity:.4,enablePost:!0,bloomIntensity:.6,chromaticAberration:.002,noiseIntensity:.01,children:[Q.jsxs("div",{className:"main-title",children:[Q.jsx("p",{children:Q.jsx("i",{children:"Hi, My Name is"})}),Q.jsx("div",{style:{display:"inline-block"},children:Q.jsx("h1",{className:"typewriter",children:r})}),Q.jsx("br",{}),Q.jsx("br",{})]}),Q.jsx("p",{className:"arrow-container",children:Q.jsx("i",{className:"arrow down"})})]})})})}),iK="modulepreload",oK=function(r){return"/"+r},Vk={},aK=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){let u=function(l){return Promise.all(l.map(c=>Promise.resolve(c).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),s=a?.nonce||a?.getAttribute("nonce");i=u(t.map(l=>{if(l=oK(l),l in Vk)return;Vk[l]=!0;const c=l.endsWith(".css"),h=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=c?"stylesheet":iK,c||(f.as="script"),f.crossOrigin="",f.href=l,s&&f.setAttribute("nonce",s),document.head.appendChild(f),c)return new Promise((m,g)=>{f.addEventListener("load",m),f.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function o(a){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=a,window.dispatchEvent(s),!s.defaultPrevented)throw a}return i.then(a=>{for(const s of a||[])s.status==="rejected"&&o(s.reason);return e().catch(o)})};var $p={exports:{}},Us={},Xp={exports:{}},Qi={},Yp={exports:{}},jk;function mR(){return jk||(jk=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=c;var t="none",n="contents",i=/^(input|select|textarea|button|object|iframe)$/;function o(h,f){return f.getPropertyValue("overflow")!=="visible"||h.scrollWidth<=0&&h.scrollHeight<=0}function a(h){var f=h.offsetWidth<=0&&h.offsetHeight<=0;if(f&&!h.innerHTML)return!0;try{var m=window.getComputedStyle(h),g=m.getPropertyValue("display");return f?g!==n&&o(h,m):g===t}catch{return console.warn("Failed to inspect element style"),!1}}function s(h){for(var f=h,m=h.getRootNode&&h.getRootNode();f&&f!==document.body;){if(m&&f===m&&(f=m.host.parentNode),a(f))return!1;f=f.parentNode}return!0}function u(h,f){var m=h.nodeName.toLowerCase(),g=i.test(m)&&!h.disabled||m==="a"&&h.href||f;return g&&s(h)}function l(h){var f=h.getAttribute("tabindex");f===null&&(f=void 0);var m=isNaN(f);return(m||f>=0)&&u(h,!m)}function c(h){var f=[].slice.call(h.querySelectorAll("*"),0).reduce(function(m,g){return m.concat(g.shadowRoot?c(g.shadowRoot):[g])},[]);return f.filter(l)}r.exports=e.default})(Yp,Yp.exports)),Yp.exports}var qk;function sK(){if(qk)return Qi;qk=1,Object.defineProperty(Qi,"__esModule",{value:!0}),Qi.resetState=a,Qi.log=s,Qi.handleBlur=u,Qi.handleFocus=l,Qi.markForFocusLater=c,Qi.returnFocus=h,Qi.popWithoutFocus=f,Qi.setupScopedFocus=m,Qi.teardownScopedFocus=g;var r=mR(),e=t(r);function t(w){return w&&w.__esModule?w:{default:w}}var n=[],i=null,o=!1;function a(){n=[]}function s(){}function u(){o=!0}function l(){if(o){if(o=!1,!i)return;setTimeout(function(){if(!i.contains(document.activeElement)){var w=(0,e.default)(i)[0]||i;w.focus()}},0)}}function c(){n.push(document.activeElement)}function h(){var w=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1,v=null;try{n.length!==0&&(v=n.pop(),v.focus({preventScroll:w}));return}catch{console.warn(["You tried to return focus to",v,"but it is not in the DOM anymore"].join(" "))}}function f(){n.length>0&&n.pop()}function m(w){i=w,window.addEventListener?(window.addEventListener("blur",u,!1),document.addEventListener("focus",l,!0)):(window.attachEvent("onBlur",u),document.attachEvent("onFocus",l))}function g(){i=null,window.addEventListener?(window.removeEventListener("blur",u),document.removeEventListener("focus",l)):(window.detachEvent("onBlur",u),document.detachEvent("onFocus",l))}return Qi}var Kp={exports:{}},$k;function uK(){return $k||($k=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var t=mR(),n=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function o(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document;return s.activeElement.shadowRoot?o(s.activeElement.shadowRoot):s.activeElement}function a(s,u){var l=(0,n.default)(s);if(!l.length){u.preventDefault();return}var c=void 0,h=u.shiftKey,f=l[0],m=l[l.length-1],g=o();if(s===g){if(!h)return;c=m}if(m===g&&!h&&(c=f),f===g&&h&&(c=m),c){u.preventDefault(),c.focus();return}var w=/(\bChrome\b|\bSafari\b)\//.exec(navigator.userAgent),v=w!=null&&w[1]!="Chrome"&&/\biPod\b|\biPad\b/g.exec(navigator.userAgent)==null;if(v){var y=l.indexOf(g);if(y>-1&&(y+=h?-1:1),c=l[y],typeof c>"u"){u.preventDefault(),c=h?m:f,c.focus();return}u.preventDefault(),c.focus()}}r.exports=e.default})(Kp,Kp.exports)),Kp.exports}var Co={},Zo={},z0={exports:{}};var Xk;function lK(){return Xk||(Xk=1,(function(r){(function(){var e=!!(typeof window<"u"&&window.document&&window.document.createElement),t={canUseDOM:e,canUseWorkers:typeof Worker<"u",canUseEventListeners:e&&!!(window.addEventListener||window.attachEvent),canUseViewport:e&&!!window.screen};r.exports?r.exports=t:window.ExecutionEnvironment=t})()})(z0)),z0.exports}var Yk;function Q1(){if(Yk)return Zo;Yk=1,Object.defineProperty(Zo,"__esModule",{value:!0}),Zo.canUseDOM=Zo.SafeNodeList=Zo.SafeHTMLCollection=void 0;var r=lK(),e=t(r);function t(o){return o&&o.__esModule?o:{default:o}}var n=e.default,i=n.canUseDOM?window.HTMLElement:{};return Zo.SafeHTMLCollection=n.canUseDOM?window.HTMLCollection:{},Zo.SafeNodeList=n.canUseDOM?window.NodeList:{},Zo.canUseDOM=n.canUseDOM,Zo.default=i,Zo}var Kk;function gR(){if(Kk)return Co;Kk=1,Object.defineProperty(Co,"__esModule",{value:!0}),Co.resetState=o,Co.log=a,Co.assertNodeList=s,Co.setElement=u,Co.validateElement=l,Co.hide=c,Co.show=h,Co.documentNotReadyOrSSRTesting=f;var r=wC(),e=n(r),t=Q1();function n(m){return m&&m.__esModule?m:{default:m}}var i=null;function o(){i&&(i.removeAttribute?i.removeAttribute("aria-hidden"):i.length!=null?i.forEach(function(m){return m.removeAttribute("aria-hidden")}):document.querySelectorAll(i).forEach(function(m){return m.removeAttribute("aria-hidden")})),i=null}function a(){}function s(m,g){if(!m||!m.length)throw new Error("react-modal: No elements were found for selector "+g+".")}function u(m){var g=m;if(typeof g=="string"&&t.canUseDOM){var w=document.querySelectorAll(g);s(w,g),g=w}return i=g||i,i}function l(m){var g=m||i;return g?Array.isArray(g)||g instanceof HTMLCollection||g instanceof NodeList?g:[g]:((0,e.default)(!1,["react-modal: App element is not defined.","Please use `Modal.setAppElement(el)` or set `appElement={el}`.","This is needed so screen readers don't see main content","when modal is opened. It is not recommended, but you can opt-out","by setting `ariaHideApp={false}`."].join(" ")),[])}function c(m){var g=!0,w=!1,v=void 0;try{for(var y=l(m)[Symbol.iterator](),x;!(g=(x=y.next()).done);g=!0){var E=x.value;E.setAttribute("aria-hidden","true")}}catch(_){w=!0,v=_}finally{try{!g&&y.return&&y.return()}finally{if(w)throw v}}}function h(m){var g=!0,w=!1,v=void 0;try{for(var y=l(m)[Symbol.iterator](),x;!(g=(x=y.next()).done);g=!0){var E=x.value;E.removeAttribute("aria-hidden")}}catch(_){w=!0,v=_}finally{try{!g&&y.return&&y.return()}finally{if(w)throw v}}}function f(){i=null}return Co}var Pu={},Jk;function cK(){if(Jk)return Pu;Jk=1,Object.defineProperty(Pu,"__esModule",{value:!0}),Pu.resetState=n,Pu.log=i;var r={},e={};function t(l,c){l.classList.remove(c)}function n(){var l=document.getElementsByTagName("html")[0];for(var c in r)t(l,r[c]);var h=document.body;for(var f in e)t(h,e[f]);r={},e={}}function i(){}var o=function(c,h){return c[h]||(c[h]=0),c[h]+=1,h},a=function(c,h){return c[h]&&(c[h]-=1),h},s=function(c,h,f){f.forEach(function(m){o(h,m),c.add(m)})},u=function(c,h,f){f.forEach(function(m){a(h,m),h[m]===0&&c.remove(m)})};return Pu.add=function(c,h){return s(c.classList,c.nodeName.toLowerCase()=="html"?r:e,h.split(" "))},Pu.remove=function(c,h){return u(c.classList,c.nodeName.toLowerCase()=="html"?r:e,h.split(" "))},Pu}var oc={},Zk;function vR(){if(Zk)return oc;Zk=1,Object.defineProperty(oc,"__esModule",{value:!0}),oc.log=n,oc.resetState=i;function r(o,a){if(!(o instanceof a))throw new TypeError("Cannot call a class as a function")}var e=function o(){var a=this;r(this,o),this.register=function(s){a.openInstances.indexOf(s)===-1&&(a.openInstances.push(s),a.emit("register"))},this.deregister=function(s){var u=a.openInstances.indexOf(s);u!==-1&&(a.openInstances.splice(u,1),a.emit("deregister"))},this.subscribe=function(s){a.subscribers.push(s)},this.emit=function(s){a.subscribers.forEach(function(u){return u(s,a.openInstances.slice())})},this.openInstances=[],this.subscribers=[]},t=new e;function n(){console.log("portalOpenInstances ----------"),console.log(t.openInstances.length),t.openInstances.forEach(function(o){return console.log(o)}),console.log("end portalOpenInstances ----------")}function i(){t=new e}return oc.default=t,oc}var jh={},Qk;function hK(){if(Qk)return jh;Qk=1,Object.defineProperty(jh,"__esModule",{value:!0}),jh.resetState=a,jh.log=s;var r=vR(),e=t(r);function t(c){return c&&c.__esModule?c:{default:c}}var n=void 0,i=void 0,o=[];function a(){for(var c=[n,i],h=0;h<c.length;h++){var f=c[h];f&&f.parentNode&&f.parentNode.removeChild(f)}n=i=null,o=[]}function s(){console.log("bodyTrap ----------"),console.log(o.length);for(var c=[n,i],h=0;h<c.length;h++){var f=c[h],m=f||{};console.log(m.nodeName,m.className,m.id)}console.log("edn bodyTrap ----------")}function u(){o.length!==0&&o[o.length-1].focusContent()}function l(c,h){!n&&!i&&(n=document.createElement("div"),n.setAttribute("data-react-modal-body-trap",""),n.style.position="absolute",n.style.opacity="0",n.setAttribute("tabindex","0"),n.addEventListener("focus",u),i=n.cloneNode(),i.addEventListener("focus",u)),o=h,o.length>0?(document.body.firstChild!==n&&document.body.insertBefore(n,document.body.firstChild),document.body.lastChild!==i&&document.body.appendChild(i)):(n.parentElement&&n.parentElement.removeChild(n),i.parentElement&&i.parentElement.removeChild(i))}return e.default.subscribe(l),jh}var eC;function dK(){return eC||(eC=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});var t=Object.assign||function(F){for(var B=1;B<arguments.length;B++){var U=arguments[B];for(var P in U)Object.prototype.hasOwnProperty.call(U,P)&&(F[P]=U[P])}return F},n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(F){return typeof F}:function(F){return F&&typeof Symbol=="function"&&F.constructor===Symbol&&F!==Symbol.prototype?"symbol":typeof F},i=(function(){function F(B,U){for(var P=0;P<U.length;P++){var L=U[P];L.enumerable=L.enumerable||!1,L.configurable=!0,"value"in L&&(L.writable=!0),Object.defineProperty(B,L.key,L)}}return function(B,U,P){return U&&F(B.prototype,U),P&&F(B,P),B}})(),o=$c(),a=Km(),s=k(a),u=sK(),l=_(u),c=uK(),h=k(c),f=gR(),m=_(f),g=cK(),w=_(g),v=Q1(),y=k(v),x=vR(),E=k(x);hK();function _(F){if(F&&F.__esModule)return F;var B={};if(F!=null)for(var U in F)Object.prototype.hasOwnProperty.call(F,U)&&(B[U]=F[U]);return B.default=F,B}function k(F){return F&&F.__esModule?F:{default:F}}function C(F,B){if(!(F instanceof B))throw new TypeError("Cannot call a class as a function")}function R(F,B){if(!F)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return B&&(typeof B=="object"||typeof B=="function")?B:F}function I(F,B){if(typeof B!="function"&&B!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof B);F.prototype=Object.create(B&&B.prototype,{constructor:{value:F,enumerable:!1,writable:!0,configurable:!0}}),B&&(Object.setPrototypeOf?Object.setPrototypeOf(F,B):F.__proto__=B)}var T={overlay:"ReactModal__Overlay",content:"ReactModal__Content"},A=function(B){return B.code==="Tab"||B.keyCode===9},N=function(B){return B.code==="Escape"||B.keyCode===27},O=0,V=(function(F){I(B,F);function B(U){C(this,B);var P=R(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,U));return P.setOverlayRef=function(L){P.overlay=L,P.props.overlayRef&&P.props.overlayRef(L)},P.setContentRef=function(L){P.content=L,P.props.contentRef&&P.props.contentRef(L)},P.afterClose=function(){var L=P.props,H=L.appElement,W=L.ariaHideApp,z=L.htmlOpenClassName,q=L.bodyOpenClassName,re=L.parentSelector,de=re&&re().ownerDocument||document;q&&w.remove(de.body,q),z&&w.remove(de.getElementsByTagName("html")[0],z),W&&O>0&&(O-=1,O===0&&m.show(H)),P.props.shouldFocusAfterRender&&(P.props.shouldReturnFocusAfterClose?(l.returnFocus(P.props.preventScroll),l.teardownScopedFocus()):l.popWithoutFocus()),P.props.onAfterClose&&P.props.onAfterClose(),E.default.deregister(P)},P.open=function(){P.beforeOpen(),P.state.afterOpen&&P.state.beforeClose?(clearTimeout(P.closeTimer),P.setState({beforeClose:!1})):(P.props.shouldFocusAfterRender&&(l.setupScopedFocus(P.node),l.markForFocusLater()),P.setState({isOpen:!0},function(){P.openAnimationFrame=requestAnimationFrame(function(){P.setState({afterOpen:!0}),P.props.isOpen&&P.props.onAfterOpen&&P.props.onAfterOpen({overlayEl:P.overlay,contentEl:P.content})})}))},P.close=function(){P.props.closeTimeoutMS>0?P.closeWithTimeout():P.closeWithoutTimeout()},P.focusContent=function(){return P.content&&!P.contentHasFocus()&&P.content.focus({preventScroll:!0})},P.closeWithTimeout=function(){var L=Date.now()+P.props.closeTimeoutMS;P.setState({beforeClose:!0,closesAt:L},function(){P.closeTimer=setTimeout(P.closeWithoutTimeout,P.state.closesAt-Date.now())})},P.closeWithoutTimeout=function(){P.setState({beforeClose:!1,isOpen:!1,afterOpen:!1,closesAt:null},P.afterClose)},P.handleKeyDown=function(L){A(L)&&(0,h.default)(P.content,L),P.props.shouldCloseOnEsc&&N(L)&&(L.stopPropagation(),P.requestClose(L))},P.handleOverlayOnClick=function(L){P.shouldClose===null&&(P.shouldClose=!0),P.shouldClose&&P.props.shouldCloseOnOverlayClick&&(P.ownerHandlesClose()?P.requestClose(L):P.focusContent()),P.shouldClose=null},P.handleContentOnMouseUp=function(){P.shouldClose=!1},P.handleOverlayOnMouseDown=function(L){!P.props.shouldCloseOnOverlayClick&&L.target==P.overlay&&L.preventDefault()},P.handleContentOnClick=function(){P.shouldClose=!1},P.handleContentOnMouseDown=function(){P.shouldClose=!1},P.requestClose=function(L){return P.ownerHandlesClose()&&P.props.onRequestClose(L)},P.ownerHandlesClose=function(){return P.props.onRequestClose},P.shouldBeClosed=function(){return!P.state.isOpen&&!P.state.beforeClose},P.contentHasFocus=function(){return document.activeElement===P.content||P.content.contains(document.activeElement)},P.buildClassName=function(L,H){var W=(typeof H>"u"?"undefined":n(H))==="object"?H:{base:T[L],afterOpen:T[L]+"--after-open",beforeClose:T[L]+"--before-close"},z=W.base;return P.state.afterOpen&&(z=z+" "+W.afterOpen),P.state.beforeClose&&(z=z+" "+W.beforeClose),typeof H=="string"&&H?z+" "+H:z},P.attributesFromObject=function(L,H){return Object.keys(H).reduce(function(W,z){return W[L+"-"+z]=H[z],W},{})},P.state={afterOpen:!1,beforeClose:!1},P.shouldClose=null,P.moveFromContentToOverlay=null,P}return i(B,[{key:"componentDidMount",value:function(){this.props.isOpen&&this.open()}},{key:"componentDidUpdate",value:function(P,L){this.props.isOpen&&!P.isOpen?this.open():!this.props.isOpen&&P.isOpen&&this.close(),this.props.shouldFocusAfterRender&&this.state.isOpen&&!L.isOpen&&this.focusContent()}},{key:"componentWillUnmount",value:function(){this.state.isOpen&&this.afterClose(),clearTimeout(this.closeTimer),cancelAnimationFrame(this.openAnimationFrame)}},{key:"beforeOpen",value:function(){var P=this.props,L=P.appElement,H=P.ariaHideApp,W=P.htmlOpenClassName,z=P.bodyOpenClassName,q=P.parentSelector,re=q&&q().ownerDocument||document;z&&w.add(re.body,z),W&&w.add(re.getElementsByTagName("html")[0],W),H&&(O+=1,m.hide(L)),E.default.register(this)}},{key:"render",value:function(){var P=this.props,L=P.id,H=P.className,W=P.overlayClassName,z=P.defaultStyles,q=P.children,re=H?{}:z.content,de=W?{}:z.overlay;if(this.shouldBeClosed())return null;var ye={ref:this.setOverlayRef,className:this.buildClassName("overlay",W),style:t({},de,this.props.style.overlay),onClick:this.handleOverlayOnClick,onMouseDown:this.handleOverlayOnMouseDown},ne=t({id:L,ref:this.setContentRef,style:t({},re,this.props.style.content),className:this.buildClassName("content",H),tabIndex:"-1",onKeyDown:this.handleKeyDown,onMouseDown:this.handleContentOnMouseDown,onMouseUp:this.handleContentOnMouseUp,onClick:this.handleContentOnClick,role:this.props.role,"aria-label":this.props.contentLabel},this.attributesFromObject("aria",t({modal:!0},this.props.aria)),this.attributesFromObject("data",this.props.data||{}),{"data-testid":this.props.testId}),ie=this.props.contentElement(ne,q);return this.props.overlayElement(ye,ie)}}]),B})(o.Component);V.defaultProps={style:{overlay:{},content:{}},defaultStyles:{}},V.propTypes={isOpen:s.default.bool.isRequired,defaultStyles:s.default.shape({content:s.default.object,overlay:s.default.object}),style:s.default.shape({content:s.default.object,overlay:s.default.object}),className:s.default.oneOfType([s.default.string,s.default.object]),overlayClassName:s.default.oneOfType([s.default.string,s.default.object]),parentSelector:s.default.func,bodyOpenClassName:s.default.string,htmlOpenClassName:s.default.string,ariaHideApp:s.default.bool,appElement:s.default.oneOfType([s.default.instanceOf(y.default),s.default.instanceOf(v.SafeHTMLCollection),s.default.instanceOf(v.SafeNodeList),s.default.arrayOf(s.default.instanceOf(y.default))]),onAfterOpen:s.default.func,onAfterClose:s.default.func,onRequestClose:s.default.func,closeTimeoutMS:s.default.number,shouldFocusAfterRender:s.default.bool,shouldCloseOnOverlayClick:s.default.bool,shouldReturnFocusAfterClose:s.default.bool,preventScroll:s.default.bool,role:s.default.string,contentLabel:s.default.string,aria:s.default.object,data:s.default.object,children:s.default.node,shouldCloseOnEsc:s.default.bool,overlayRef:s.default.func,contentRef:s.default.func,id:s.default.string,overlayElement:s.default.func,contentElement:s.default.func,testId:s.default.string},e.default=V,r.exports=e.default})(Xp,Xp.exports)),Xp.exports}const fK=tI(sD);var tC;function pK(){if(tC)return Us;tC=1,Object.defineProperty(Us,"__esModule",{value:!0}),Us.bodyOpenClassName=Us.portalClassName=void 0;var r=Object.assign||function(N){for(var O=1;O<arguments.length;O++){var V=arguments[O];for(var F in V)Object.prototype.hasOwnProperty.call(V,F)&&(N[F]=V[F])}return N},e=(function(){function N(O,V){for(var F=0;F<V.length;F++){var B=V[F];B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(O,B.key,B)}}return function(O,V,F){return V&&N(O.prototype,V),F&&N(O,F),O}})(),t=$c(),n=v(t),i=oC(),o=v(i),a=Km(),s=v(a),u=dK(),l=v(u),c=gR(),h=w(c),f=Q1(),m=v(f),g=fK;function w(N){if(N&&N.__esModule)return N;var O={};if(N!=null)for(var V in N)Object.prototype.hasOwnProperty.call(N,V)&&(O[V]=N[V]);return O.default=N,O}function v(N){return N&&N.__esModule?N:{default:N}}function y(N,O){if(!(N instanceof O))throw new TypeError("Cannot call a class as a function")}function x(N,O){if(!N)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O&&(typeof O=="object"||typeof O=="function")?O:N}function E(N,O){if(typeof O!="function"&&O!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof O);N.prototype=Object.create(O&&O.prototype,{constructor:{value:N,enumerable:!1,writable:!0,configurable:!0}}),O&&(Object.setPrototypeOf?Object.setPrototypeOf(N,O):N.__proto__=O)}var _=Us.portalClassName="ReactModalPortal",k=Us.bodyOpenClassName="ReactModal__Body--open",C=f.canUseDOM&&o.default.createPortal!==void 0,R=function(O){return document.createElement(O)},I=function(){return C?o.default.createPortal:o.default.unstable_renderSubtreeIntoContainer};function T(N){return N()}var A=(function(N){E(O,N);function O(){var V,F,B,U;y(this,O);for(var P=arguments.length,L=Array(P),H=0;H<P;H++)L[H]=arguments[H];return U=(F=(B=x(this,(V=O.__proto__||Object.getPrototypeOf(O)).call.apply(V,[this].concat(L))),B),B.removePortal=function(){!C&&o.default.unmountComponentAtNode(B.node);var W=T(B.props.parentSelector);W&&W.contains(B.node)?W.removeChild(B.node):console.warn('React-Modal: "parentSelector" prop did not returned any DOM element. Make sure that the parent element is unmounted to avoid any memory leaks.')},B.portalRef=function(W){B.portal=W},B.renderPortal=function(W){var z=I(),q=z(B,n.default.createElement(l.default,r({defaultStyles:O.defaultStyles},W)),B.node);B.portalRef(q)},F),x(B,U)}return e(O,[{key:"componentDidMount",value:function(){if(f.canUseDOM){C||(this.node=R("div")),this.node.className=this.props.portalClassName;var F=T(this.props.parentSelector);F.appendChild(this.node),!C&&this.renderPortal(this.props)}}},{key:"getSnapshotBeforeUpdate",value:function(F){var B=T(F.parentSelector),U=T(this.props.parentSelector);return{prevParent:B,nextParent:U}}},{key:"componentDidUpdate",value:function(F,B,U){if(f.canUseDOM){var P=this.props,L=P.isOpen,H=P.portalClassName;F.portalClassName!==H&&(this.node.className=H);var W=U.prevParent,z=U.nextParent;z!==W&&(W.removeChild(this.node),z.appendChild(this.node)),!(!F.isOpen&&!L)&&!C&&this.renderPortal(this.props)}}},{key:"componentWillUnmount",value:function(){if(!(!f.canUseDOM||!this.node||!this.portal)){var F=this.portal.state,B=Date.now(),U=F.isOpen&&this.props.closeTimeoutMS&&(F.closesAt||B+this.props.closeTimeoutMS);U?(F.beforeClose||this.portal.closeWithTimeout(),setTimeout(this.removePortal,U-B)):this.removePortal()}}},{key:"render",value:function(){if(!f.canUseDOM||!C)return null;!this.node&&C&&(this.node=R("div"));var F=I();return F(n.default.createElement(l.default,r({ref:this.portalRef,defaultStyles:O.defaultStyles},this.props)),this.node)}}],[{key:"setAppElement",value:function(F){h.setElement(F)}}]),O})(t.Component);return A.propTypes={isOpen:s.default.bool.isRequired,style:s.default.shape({content:s.default.object,overlay:s.default.object}),portalClassName:s.default.string,bodyOpenClassName:s.default.string,htmlOpenClassName:s.default.string,className:s.default.oneOfType([s.default.string,s.default.shape({base:s.default.string.isRequired,afterOpen:s.default.string.isRequired,beforeClose:s.default.string.isRequired})]),overlayClassName:s.default.oneOfType([s.default.string,s.default.shape({base:s.default.string.isRequired,afterOpen:s.default.string.isRequired,beforeClose:s.default.string.isRequired})]),appElement:s.default.oneOfType([s.default.instanceOf(m.default),s.default.instanceOf(f.SafeHTMLCollection),s.default.instanceOf(f.SafeNodeList),s.default.arrayOf(s.default.instanceOf(m.default))]),onAfterOpen:s.default.func,onRequestClose:s.default.func,closeTimeoutMS:s.default.number,ariaHideApp:s.default.bool,shouldFocusAfterRender:s.default.bool,shouldCloseOnOverlayClick:s.default.bool,shouldReturnFocusAfterClose:s.default.bool,preventScroll:s.default.bool,parentSelector:s.default.func,aria:s.default.object,data:s.default.object,role:s.default.string,contentLabel:s.default.string,shouldCloseOnEsc:s.default.bool,overlayRef:s.default.func,contentRef:s.default.func,id:s.default.string,overlayElement:s.default.func,contentElement:s.default.func},A.defaultProps={isOpen:!1,portalClassName:_,bodyOpenClassName:k,role:"dialog",ariaHideApp:!0,closeTimeoutMS:0,shouldFocusAfterRender:!0,shouldCloseOnEsc:!0,shouldCloseOnOverlayClick:!0,shouldReturnFocusAfterClose:!0,preventScroll:!1,parentSelector:function(){return document.body},overlayElement:function(O,V){return n.default.createElement("div",O,V)},contentElement:function(O,V){return n.default.createElement("div",O,V)}},A.defaultStyles={overlay:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.75)"},content:{position:"absolute",top:"40px",left:"40px",right:"40px",bottom:"40px",border:"1px solid #ccc",background:"#fff",overflow:"auto",WebkitOverflowScrolling:"touch",borderRadius:"4px",outline:"none",padding:"20px"}},(0,g.polyfill)(A),Us.default=A,Us}var nC;function mK(){return nC||(nC=1,(function(r,e){Object.defineProperty(e,"__esModule",{value:!0});var t=pK(),n=i(t);function i(o){return o&&o.__esModule?o:{default:o}}e.default=n.default,r.exports=e.default})($p,$p.exports)),$p.exports}var gK=mK();const vK=iu(gK);function yK(r){const[e,t]=Ke.useState(r);return r!==e&&(!r||!e||r.length!==e.length||r.some((n,i)=>n!==e[i]))?(t(r),r):e}function bK(r,[e,t]){const[n,i]=r;return n!==void 0&&i!==void 0&&e!==void 0&&t!==void 0&&e>n&&e-n<=20&&t<i?[n,t]:n!==e||i!==t?[e,t]:r}function wK(r,e){let t=r?.clientWidth;if(t!==void 0&&e&&e.length>0){const n=[...e.filter(i=>i>0)].sort((i,o)=>o-i);n.push(Math.floor(n[n.length-1]/2)),t=n.find((i,o)=>i<=t||o===n.length-1)}return t}function e_(r,e,t){const[[n],i]=Ke.useReducer(bK,[t]),o=yK(e),a=Ke.useRef(void 0);return{containerRef:Ke.useCallback(u=>{a.current?.disconnect(),a.current=void 0;const l=()=>i([wK(u,o),window.innerWidth-document.documentElement.clientWidth]);l(),u&&typeof ResizeObserver<"u"&&(a.current=new ResizeObserver(l),a.current.observe(u)),typeof r=="function"?r(u):r&&(r.current=u)},[r,o]),containerWidth:n}}function _K(...r){return[...r].filter(Boolean).join(" ")}function yR(r){return["react-photo-album",r].filter(Boolean).join("--")}function xK(r){return`--${yR(r)}`}function io({width:r,height:e}){return r/e}const SK=Object.freeze([1200,600,300,0]);function $s(r,e){return typeof r=="function"?r(e):r}function bR(r,e){return e!==void 0?$s(r,e):void 0}function EK(r,e){const t=SK.findIndex(n=>n<=e);return $s(r[Math.max(t,0)],e)}function cd(r,e,t,n=0){if(e===void 0)return;const i=bR(r,e);return Math.round(Math.max(i===void 0?EK(t,e):i,n))}function t_(r,{spacing:e,padding:t,componentsProps:n,render:i}){return{spacing:cd(e,r,[20,15,10,5]),padding:cd(t,r,[0,0,0,0]),componentsProps:$s(n,r)||{},render:$s(i,r)}}function hd(r,e=0){const t=10**e;return Math.round((r+Number.EPSILON)*t)/t}function kK(r,e,t,n,i,o,a){let s,u;const l=h=>{const f=o*(i-1)+2*a*i;return`calc((${h.match(/^\s*calc\((.*)\)\s*$/)?.[1]??h} - ${f}px) / ${hd((n-f)/t,5)})`},c=r.srcSet;return c&&c.length>0&&(s=c.concat(c.some(({width:h})=>h===r.width)?[]:[{src:r.src,width:r.width,height:r.height}]).sort((h,f)=>h.width-f.width).map(h=>`${h.src} ${h.width}w`).join(", ")),e?.size?u=(e.sizes||[]).map(({viewport:h,size:f})=>`${h} ${l(f)}`).concat(l(e.size)).join(", "):u=`${Math.ceil(t/n*100)}vw`,{srcSet:s,sizes:u}}function CK({as:r,render:e,context:t,classes:n=[],variables:i={},style:o,className:a,children:s,...u},l){const c=_K(...(Array.isArray(n)?n:[n]).filter(g=>typeof g=="string").map(yR),a),f={style:{...Object.fromEntries(Object.entries(i).map(([g,w])=>[xK(g.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()),typeof w=="number"?hd(w,5):w])),...o},className:c,children:s,...u};if(e){const g=e({ref:l,...f},t);if(g)return g}const m=r||"div";return Q.jsx(m,{ref:l,...f})}const Ym=Ke.forwardRef(CK);function TK({photo:r,index:e,width:t,height:n,onClick:i,render:{wrapper:o,link:a,button:s,image:u,extras:l}={},componentsProps:{link:c,button:h,wrapper:f,image:m}={}},g){const{href:w}=r,v={photo:r,index:e,width:hd(t,3),height:hd(n,3)};let y;return w?y={...c,as:"a",render:a,classes:["photo","link"],href:w,onClick:i}:i?y={...h,as:"button",type:"button",render:s,classes:["photo","button"],onClick:i}:y={...f,render:o,classes:"photo"},Q.jsxs(Ym,{ref:g,variables:{photoWidth:v.width,photoHeight:v.height},context:v,...y,children:[Q.jsx(Ym,{as:"img",classes:"image",render:u,context:v,...m}),l?.({},v)]})}const MK=Ke.forwardRef(TK);function AK({layout:r,sizes:e,model:t,skeleton:n,onClick:i,render:{container:o,track:a,photo:s,...u}={},componentsProps:{container:l,track:c,link:h,button:f,wrapper:m,image:g}={}},w){const{spacing:v,padding:y,containerWidth:x,tracks:E,variables:_,horizontal:k}=t||{};return Q.jsxs(Ym,{role:"group","aria-label":"Photo album",...l,variables:{spacing:v,padding:y,containerWidth:x,..._},classes:["",r],render:o,ref:w,children:[v!==void 0&&y!==void 0&&x!==void 0&&E?.map(({photos:C,variables:R},I)=>{const T=C.length,A=k?T:E.length;return Ke.createElement(Ym,{...c,key:I,render:a,classes:"track",variables:{trackSize:T,...R}},C.map(N=>{const{photo:O,index:V,width:F}=N,{key:B,src:U,alt:P,title:L,label:H}=O,W=i?q=>{i({event:q,photo:O,index:V})}:void 0;if(s){const q=s({onClick:W},N);if(q)return q}const z=q=>H?{"aria-label":H,...q}:q;return Q.jsx(MK,{onClick:W,render:u,componentsProps:{image:{loading:"lazy",decoding:"async",src:U,alt:P,title:L,...kK(O,e,F,x,A,v,y),...$s(g,N)},link:z($s(h,N)),button:z($s(f,N)),wrapper:$s(m,N)},...N},B??U)}))}),x===void 0&&n]})}const n_=Ke.forwardRef(AK);function RK(r,{photos:e,targetRowHeight:t,rowConstraints:n,...i}){const{spacing:o,padding:a,componentsProps:s,render:u}=t_(r,i),{singleRowMaxHeight:l,minPhotos:c,maxPhotos:h}=bR(n,r)||{};if(l!==void 0&&o!==void 0&&a!==void 0){const f=Math.floor(e.reduce((m,{width:g,height:w})=>m+g/w*l-2*a,a*e.length*2+o*(e.length-1)));f>0&&(s.container={...s.container},s.container.style={maxWidth:f,...s.container.style})}return{...i,targetRowHeight:cd(t,r,[f=>f/5,f=>f/4,f=>f/3,f=>f/2]),render:u,spacing:o,padding:a,minPhotos:c,maxPhotos:h,componentsProps:s}}function IK(r){return(e,t)=>r(t)-r(e)}function DK(r){let e=0;const t=[],n=(c,h)=>r(t[c],t[h])<0,i=(c,h)=>{const f=t[c];t[c]=t[h],t[h]=f},o=c=>{let h=c,f=Math.floor(h/2);for(;h>1&&n(f,h);)i(f,h),h=f,f=Math.floor(h/2)},a=c=>{let h=c,f=h*2;for(;f<=e&&(f<e&&n(f,f+1)&&(f+=1),!!n(h,f));)i(h,f),h=f,f=h*2};return{push:c=>{e+=1,t[e]=c,o(e)},pop:()=>{if(e===0)return;i(1,e),e-=1;const c=t.pop();return a(1),c},size:()=>e}}function NK(r,e,t){const n=new Map,i=new Set,o=new Map;o.set(e,0);const a=DK(IK(s=>s[1]));for(a.push([e,0]);a.size()>0;){const[s,u]=a.pop();if(!i.has(s)){const l=r(s);i.add(s),l.forEach((c,h)=>{const f=u+c,m=n.get(h),g=o.get(h);(g===void 0||g>f&&(g/f>1.005||m!==void 0&&m<s))&&(o.set(h,f),a.push([h,f]),n.set(h,s))})}}return o.has(t)?n:void 0}function PK(r,e){if(!r)return;const t=[];for(let n=e;n!==void 0;n=r.get(n))t.push(n);return t.reverse()}function FK(r,e,t){return PK(NK(r,e,t),t)}function OK(r,e,t,n){return hd(e/t/Math.min(...r.map(i=>io(i))))+(n||0)+2}function wR(r,e,t,n){return(e-(r.length-1)*t-2*n*r.length)/r.reduce((i,o)=>i+io(o),0)}function LK(r,e,t,n,i,o,a){const s=r.slice(e,t),u=wR(s,n,i,o);return u>0?(u-a)**2*s.length:void 0}function BK(r,e,t,n,i,o,a,s){return u=>{const l=new Map;l.set(u,0);const c=a||1,h=Math.min(o,s||1/0);for(let f=u+c;f<r.length+1&&!(f-u>h);f+=1){const m=LK(r,u,f,n,e,t,i);if(m===void 0)break;l.set(f,m)}return l}}function UK(r,e,t,n,i,o,a){const s=OK(r,n,i,o),u=BK(r,e,t,n,i,s,o,a),l=FK(u,0,r.length);if(!l)return;const c=[];for(let h=1;h<l.length;h+=1){const f=r.map((g,w)=>({photo:g,index:w})).slice(l[h-1],l[h]),m=wR(f.map(({photo:g})=>g),n,e,t);c.push({photos:f.map(({photo:g,index:w})=>({photo:g,index:w,width:m*io(g),height:m}))})}return{spacing:e,padding:t,containerWidth:n,tracks:c,horizontal:!0}}function zK({photos:r,breakpoints:e,defaultContainerWidth:t,...n},i){const{containerRef:o,containerWidth:a}=e_(i,e,t),{spacing:s,padding:u,targetRowHeight:l,minPhotos:c,maxPhotos:h,...f}=RK(a,{photos:r,...n}),m=Ke.useMemo(()=>a!==void 0&&s!==void 0&&u!==void 0&&l!==void 0?UK(r,s,u,a,l,c,h):void 0,[r,s,u,a,l,c,h]);return Q.jsx(n_,{layout:"rows",ref:o,model:m,...f})}const WK=Ke.forwardRef(zK);function HK(r,{columns:e,...t}){return{...t,...t_(r,t),columns:cd(e,r,[5,4,3,2],1)}}function GK(r,e,t,n){const i=new Map,o=new Set;o.add(t);for(let a=0;a<e;a+=1){const s=[...o.keys()];o.clear(),s.forEach(u=>{const l=a>0?i.get(u)[a][1]:0;r(u).forEach(([c,h])=>{let f=i.get(c);f||(f=[],i.set(c,f));const m=l+h,g=f[a+1];(!g||g[1]>m&&(g[1]/m>1.0001||u<g[0]))&&(f[a+1]=[u,m]),a<e-1&&c!==n&&o.add(c)})})}return i}function VK(r,e,t){const n=[t];for(let i=t,o=e;o>0;o-=1)[i]=r.get(i)[o],n.push(i);return n.reverse()}function jK(r,e,t,n){return VK(GK(r,e,t,n),e,n)}function qK(r,e,t,n,i){return o=>{const a=[],s=i*1.5;let u=n/io(r[o])+2*t;for(let l=o+1;l<r.length+1&&(a.push([l,(i-u)**2]),!(u>s||l===r.length));l+=1)u+=n/io(r[l])+e+2*t;return a}}function rC(r,e,t,n,i,o,a){const s=[],u=a.reduce((l,c)=>l+c,0);for(let l=0;l<r.length-1;l+=1){const c=e.map((m,g)=>({photo:m,index:g})).slice(r[l],r[l+1]),h=a.reduce((m,g,w)=>m+(o[l]-o[w])*g,0),f=(i-(r.length-2)*t-2*(r.length-1)*n-h)*a[l]/u;s.push({photos:c.map(({photo:m,index:g})=>({photo:m,index:g,width:f,height:f/io(m)})),variables:{adjustedGaps:h,columnRatio:a[l]}})}return{tracks:s,variables:{totalRatio:u}}}function $K(r,e,t,n,i,o){const a=[],s=[];if(r.length<=o){const h=r.length>0?r.reduce((f,m)=>f+io(m),0)/r.length:1;for(let f=0;f<o;f+=1)a[f]=2*t,s[f]=f<r.length?io(r[f]):h;return rC(Array.from({length:o+1},(f,m)=>Math.min(m,r.length)),r,e,t,n,a,s)}const u=(r.reduce((h,f)=>h+i/io(f),0)+e*(r.length-o)+2*t*r.length)/o,l=qK(r,e,t,i,u),c=jK(l,o,0,r.length);for(let h=0;h<c.length-1;h+=1){const f=r.slice(c[h],c[h+1]);a[h]=e*(f.length-1)+2*t*f.length,s[h]=1/f.reduce((m,g)=>m+1/io(g),0)}return rC(c,r,e,t,n,a,s)}function _R(r,e,t,n,i){const o=(n-e*(i-1)-2*t*i)/i,{tracks:a,variables:s}=$K(r,e,t,n,o,i);return a.some(u=>u.photos.some(({width:l,height:c})=>l<0||c<0))?i>1?_R(r,e,t,n,i-1):void 0:{tracks:a,spacing:e,padding:t,containerWidth:n,variables:{columns:i,...s}}}function XK({photos:r,breakpoints:e,defaultContainerWidth:t,...n},i){const{containerRef:o,containerWidth:a}=e_(i,e,t),{spacing:s,padding:u,columns:l,...c}=HK(a,{photos:r,...n}),h=Ke.useMemo(()=>a!==void 0&&s!==void 0&&u!==void 0&&l!==void 0?_R(r,s,u,a,l):void 0,[r,s,u,a,l]);return Q.jsx(n_,{layout:"columns",ref:o,model:h,...c})}const YK=Ke.forwardRef(XK);function KK(r,{columns:e,...t}){return{...t,...t_(r,t),columns:cd(e,r,[5,4,3,2],1)}}function xR(r,e,t,n,i){const o=(n-e*(i-1)-2*t*i)/i;if(o<=0)return i>1?xR(r,e,t,n,i-1):void 0;const a=[];for(let u=0;u<i;u+=1)a[u]=0;const s=r.reduce((u,l,c)=>{const h=a.reduce((f,m,g)=>m<a[f]-1?g:f,0);return a[h]=a[h]+o/io(l)+e+2*t,u[h].push({photo:l,index:c}),u},Array.from({length:i},()=>[]));return{spacing:e,padding:t,containerWidth:n,variables:{columns:i},tracks:s.map(u=>({photos:u.map(({photo:l,index:c})=>({photo:l,index:c,width:o,height:o/io(l)}))}))}}function JK({photos:r,breakpoints:e,defaultContainerWidth:t,...n},i){const{containerRef:o,containerWidth:a}=e_(i,e,t),{spacing:s,padding:u,columns:l,...c}=KK(a,{photos:r,...n}),h=Ke.useMemo(()=>a!==void 0&&s!==void 0&&u!==void 0&&l!==void 0?xR(r,s,u,a,l):void 0,[r,s,u,a,l]);return Q.jsx(n_,{layout:"masonry",ref:o,model:h,...c})}const ZK=Ke.forwardRef(JK);function QK({layout:r,...e},t){return r==="rows"?Q.jsx(WK,{ref:t,...e}):r==="columns"?Q.jsx(YK,{ref:t,...e}):r==="masonry"?Q.jsx(ZK,{ref:t,...e}):null}const eJ=Ke.forwardRef(QK),tJ=JSON.parse(`[{"link":"https://www.goodreads.com/book/show/38820046-21-lessons-for-the-21st-century","title":"21 Lessons for the 21st Century","title_without_series":"21 Lessons for the 21st Century","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SX98_.jpg","description":"<b>In<i> Sapiens, </i>he explored our past. In <i>Homo Deus, </i>he looked to our future<i>. </i>Now, one of the most innovative thinkers on the planet turns to the present to make sense of today's most pressing issues.</b><br /><br />How do computers and robots change the meaning of being human? How do we deal with the epidemic of fake news? Are nations and religions still relevant? What should we teach our children?<br /><br />Yuval Noah Harari's <i>21 Lessons for the 21st Century</i> is a probing and visionary investigation into today's most urgent issues as we move into the uncharted territory of the future. As technology advances faster than our understanding of it, hacking becomes a tactic of war, and the world feels more polarized than ever, Harari addresses the challenge of navigating life in the face of constant and disorienting change and raises the important questions we need to ask ourselves in order to survive.<br /><br />In twenty-one accessible chapters that are both provocative and profound, Harari builds on the ideas explored in his previous books, untangling political, technological, social, and existential issues and offering advice on how to prepare for a very different future from the world we now live in: How can we retain freedom of choice when Big Data is watching us? What will the future workforce look like, and how should we ready ourselves for it? How should we deal with the threat of terrorism? Why is liberal democracy in crisis?<br /><br />Harari's unique ability to make sense of where we have come from and where we are going has captured the imaginations of millions of readers. Here he invites us to consider values, meaning, and personal engagement in a world full of noise and uncertainty. When we are deluged with irrelevant information, clarity is power. Presenting complex contemporary challenges clearly and accessibly, <i>21 Lessons for the 21st Century</i> is essential reading.","num_pages":372,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.29,"ratings_count":1790118,"text_reviews_count":100100}},"average_rating":4.15,"ratings_count":176316,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13707738-boomerang","title":"Boomerang: Travels in the New Third World","title_without_series":"Boomerang: Travels in the New Third World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX98_.jpg","description":"The tsunami of cheap credit that rolled across the planet between 2002 and 2008 was more than a simple financial phenomenon: it was temptation, offering entire societies the chance to reveal aspects of their characters they could not normally afford to indulge.<br /><br /><br />Icelanders wanted to stop fishing and become investment bankers. The Greeks wanted to turn their country into a pinata stuffed with cash and allow as many citizens as possible to take a whack at it. The Germans wanted to be even more German; the Irish wanted to stop being Irish.<br /><br /><br />Michael Lewis's investigation of bubbles beyond our shores is so brilliantly, sadly hilarious that it leads the American reader to a comfortable complacency: oh, those foolish foreigners. But when he turns a merciless eye on California and Washington, DC, we see that the narrative is a trap baited with humor, and we understand the reckoning that awaits the greatest and greediest of debtor nations.","num_pages":218,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":3.9,"ratings_count":47319,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/34890015-factfulness","title":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","title_without_series":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SX98_.jpg","description":"<b><i>Factfulness:</i> The stress-reducing habit of only carrying opinions for which you have strong supporting facts.</b><br /><br />When asked simple questions about global trends<i>what percentage of the worlds population live in poverty; why the worlds population is increasing; how many girls finish school</i>we systematically get the answers wrong. So wrong that a chimpanzee choosing answers at random will consistently outguess teachers, journalists, Nobel laureates, and investment bankers.<br /><br />In <i>Factfulness</i>, Professor of International Health and global TED phenomenon Hans Rosling, together with his two long-time collaborators, Anna and Ola, offers <b>a radical new explanation of why this happens</b>. They reveal <b>the ten instincts that distort our perspective</b>from our tendency to divide the world into two camps (usually some version of <i>us</i> and <i>them</i>) to the way we consume media (where fear rules) to how we perceive progress (believing that most things are getting worse).<br /><br />Our problem is that we dont know what we dont know, and even our guesses are informed by unconscious and predictable biases.<br /><br /><b>It turns out that the world, for all its imperfections, is in a much better state than we might think.</b> That doesnt mean there arent real concerns. But when we worry about everything all the time instead of embracing a worldview based on facts, we can lose our ability to focus on the things that threaten us most.<br /><br />Inspiring and revelatory, filled with lively anecdotes and moving stories, <b><i>Factfulness </i>is an urgent and essential book that will change the way you see the world and empower you to respond to the crises and opportunities of the future. </b>","num_pages":342,"authors":{"author":{"id":2790706,"name":"Hans Rosling","role":"","image_url":"https://images.gr-assets.com/authors/1486521286p5/2790706.jpg","small_image_url":"https://images.gr-assets.com/authors/1486521286p2/2790706.jpg","link":"https://www.goodreads.com/author/show/2790706.Hans_Rosling","average_rating":4.35,"ratings_count":203926,"text_reviews_count":16211}},"average_rating":4.36,"ratings_count":200548,"publication_day":3,"publication_month":4,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/23281872-how-not-to-be-wrong","title":"How Not to Be Wrong: The Power of Mathematical Thinking","title_without_series":"How Not to Be Wrong: The Power of Mathematical Thinking","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SX98_.jpg","description":"Witty, compelling, and just plain fun to read . . .\\" Evelyn Lamb, Scientific American<br /><br />The Freakonomics of matha math-world superstar unveils the hidden beauty and logic of the world and puts its power in our hands<br /><br />The math we learn in school can seem like a dull set of rules, laid down by the ancients and not to be questioned. In How Not to Be Wrong , Jordan Ellenberg shows us how terribly limiting this view is: Math isnt confined to abstract incidents that never occur in real life, but rather touches everything we dothe whole world is shot through with it.<br /><br />Math allows us to see the hidden structures underneath the messy and chaotic surface of our world. Its a science of not being wrong, hammered out by centuries of hard work and argument. Armed with the tools of mathematics, we can see through to the true meaning of information we take for granted: How early should you get to the airport? What does public opinion really represent? Why do tall parents have shorter children? Who really won Florida in 2000? And how likely are you, really, to develop cancer?<br /><br />How Not to Be Wrong presents the surprising revelations behind all of these questions and many more, using the mathematicians method of analyzing life and exposing the hard-won insights of the academic community to the laymanminus the jargon. Ellenberg chases mathematical threads through a vast range of time and space, from the everyday to the cosmic, encountering, among other things, baseball, Reaganomics, daring lottery schemes, Voltaire, the replicability crisis in psychology, Italian Renaissance painting, artificial languages, the development of non-Euclidean geometry, the coming obesity apocalypse, Antonin Scalias views on crime and punishment, the psychology of slime molds, what Facebook can and cant figure out about you, and the existence of God.<br /><br />Ellenberg pulls from history as well as from the latest theoretical developments to provide those not trained in math with the knowledge they need. Math, as Ellenberg says, is an atomic-powered prosthesis that you attach to your common sense, vastly multiplying its reach and strength. With the tools of mathematics in hand, you can understand the world in a deeper, more meaningful way. How Not to Be Wrong will show you how.","num_pages":457,"authors":{"author":{"id":359894,"name":"Jordan Ellenberg","role":"","image_url":"https://images.gr-assets.com/authors/1622052352p5/359894.jpg","small_image_url":"https://images.gr-assets.com/authors/1622052352p2/359894.jpg","link":"https://www.goodreads.com/author/show/359894.Jordan_Ellenberg","average_rating":3.93,"ratings_count":23459,"text_reviews_count":2197}},"average_rating":3.95,"ratings_count":21240,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/220493539-moral-ambition","title":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","title_without_series":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>THE ANTIDOTE TO APATHY FROM THE INTERNATIONALLY BESTSELLING AUTHOR RUTGER BREGMAN</b><br /><b>\\n  <br />\\n</b><b>'The Dutch historian who is making waves' Dan Snow, <i>History Hits</i></b><br /><br /><b>A forty-year, full-time career consists of around 80,000 hours, or 10,000 workdays, or 2,000 work weeks. How you spend that time is the most important moral decision of your life. </b><br /><br />In <i>Moral Ambition</i>, internationally-bestselling author Rutger Bregman shows us it is possible to be both successful and idealistic by placing a drive for meaning and change at the centre of our lives. Looking at the impact of several heroes of history, he what qualities do these social pioneers have in common? What made them so persuasive, influential and effective that they could not be ignored? How can we develop those qualities, too? <br /><br />Rutger argues that anyone can dedicate their abilities  and their time  to finding the best solutions to the world's biggest problems. The most influential people aren't two or five or ten times as influential; but a hundred, a thousand, or a million times. This book will show you how to be one of those people. It might not make your life easier, but it will make it more satisfying and consequential and, perhaps, you too could become one of history's heroes.<br /><br /><b>PRAISE FOR RUTGER </b><br /><b>'An almost indecently readable style' Jonathan Freedland</b><br /><b>'One of the best young writers we have' Owen Jones</b><br /><b>'21st-century readers are short on prophets, especially the optimistic kind, and will give this one a cheerful hearing' <i>Economist </i></b>","num_pages":"","authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.22,"ratings_count":137733,"text_reviews_count":14039}},"average_rating":3.74,"ratings_count":9876,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17662487-nudge","title":"Nudge: Improving Decisions About Health, Wealth, and Happiness","title_without_series":"Nudge: Improving Decisions About Health, Wealth, and Happiness","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SX98_.jpg","description":"For fans of Malcolm Gladwells Blink and Nobel Prize winner Daniel Kahnemans Thinking Fast and Slow, a revelatory new look at how we make decisions<br /><br />A New York Times bestseller<br />An Economist Best Book of the Year<br />A Financial Times Best Book of the Year<br /><br />Nudge is about choiceshow we make them and how we can make better ones. Drawing on decades of research in the fields of behavioral science and economics, authors Richard H. Thaler and Cass R. Sunstein offer a new perspective on preventing the countless mistakes we makeill-advised personal investments, consumption of unhealthy foods, neglect of our natural resourcesand show us how sensible choice architecture can successfully nudge people toward the best decisions. In the tradition of The Tipping Point and Freakonomics, Nudge is straightforward, informative, and entertaininga must-read for anyone interested in our individual and collective well-being.","num_pages":324,"authors":{"author":{"id":65483,"name":"Richard H. Thaler","role":"","image_url":"https://images.gr-assets.com/authors/1438885744p5/65483.jpg","small_image_url":"https://images.gr-assets.com/authors/1438885744p2/65483.jpg","link":"https://www.goodreads.com/author/show/65483.Richard_H_Thaler","average_rating":3.9,"ratings_count":118306,"text_reviews_count":6852}},"average_rating":3.84,"ratings_count":94207,"publication_day":24,"publication_month":2,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/25135194-prisoners-of-geography","title":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics (Politics of Place, #1)","title_without_series":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SX98_.jpg","description":"<i>Geography shapes not only our history, but where we're headed...</i><br /><br />All leaders are constrained by geography. Their choices are limited by mountains, rivers, seas and concrete. Yes, to follow world events you need to understand people, ideas and movements - but if you don't know geography, you'll never have the full picture.<br /><br />If you've ever wondered why Putin is so obsessed with Crimea, why the USA was destined to become a global superpower, or why China's power base continues to expand ever outwards, the answers are all here.<br /><br /><b>In ten chapters and ten maps, <i>Prisoners of Geography</i> looks at the past, present and future to offer an essential insight into one of the major factors that determines world history.<br /><br />It's time to put the 'geo' back into geopolitics.<br /><br />Ten maps; ten chapters:<br /><br />Russia * China * United States of America * Latin America * the Middle East * Africa * India and Pakistan * Europe * Japan and Korea * the Arctic</b>","num_pages":256,"authors":{"author":{"id":713466,"name":"Tim  Marshall","role":"","image_url":"https://images.gr-assets.com/authors/1489696759p5/713466.jpg","small_image_url":"https://images.gr-assets.com/authors/1489696759p2/713466.jpg","link":"https://www.goodreads.com/author/show/713466.Tim_Marshall","average_rating":4.14,"ratings_count":163367,"text_reviews_count":13540}},"average_rating":4.19,"ratings_count":115061,"publication_day":9,"publication_month":7,"publication_year":2015},{"link":"https://www.goodreads.com/book/show/18295861-the-first-fifteen-lives-of-harry-august","title":"The First Fifteen Lives of Harry August","title_without_series":"The First Fifteen Lives of Harry August","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SX98_.jpg","description":"Some stories cannot be told in just one lifetime. Harry August is on his deathbed. Again. No matter what he does or the decisions he makes, when death comes, Harry always returns to where he began, a child with all the knowledge of a life he has already lived a dozen times before. Nothing ever changes. Until now. As Harry nears the end of his eleventh life, a little girl appears at his bedside. \\"I nearly missed you, Doctor August,\\" she says. \\"I need to send a message.\\" This is the story of what Harry does next, and what he did before, and how he tries to save a past he cannot change and a future he cannot allow.","num_pages":416,"authors":{"author":{"id":7210024,"name":"Claire North","role":"","image_url":"https://images.gr-assets.com/authors/1440105009p5/7210024.jpg","small_image_url":"https://images.gr-assets.com/authors/1440105009p2/7210024.jpg","link":"https://www.goodreads.com/author/show/7210024.Claire_North","average_rating":3.91,"ratings_count":172667,"text_reviews_count":23086}},"average_rating":4.03,"ratings_count":98578,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18007564-the-martian","title":"The Martian","title_without_series":"The Martian","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1413706054l/18007564._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1413706054l/18007564._SX98_.jpg","description":"Six days ago, astronaut Mark Watney became one of the first people to walk on Mars. <br /><br />Now, hes sure hell be the first person to die there.<br /><br />After a dust storm nearly kills him and forces his crew to evacuate while thinking him dead, Mark finds himself stranded and completely alone with no way to even signal Earth that hes aliveand even if he could get word out, his supplies would be gone long before a rescue could arrive. <br /><br />Chances are, though, he wont have time to starve to death. The damaged machinery, unforgiving environment, or plain-old human error are much more likely to kill him first. <br /><br />But Mark isnt ready to give up yet. Drawing on his ingenuity, his engineering skills  and a relentless, dogged refusal to quit  he steadfastly confronts one seemingly insurmountable obstacle after the next. Will his resourcefulness be enough to overcome the impossible odds against him?<br /><br />","num_pages":384,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.34,"ratings_count":2739668,"text_reviews_count":277652}},"average_rating":4.42,"ratings_count":1272719,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/29807115-the-selfish-gene","title":"The Selfish Gene","title_without_series":"The Selfish Gene","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SX98_.jpg","description":"The million copy international bestseller, critically acclaimed and translated into over 25 languages. <br />As influential today as when it was first published, The Selfish Gene has become a classic exposition of evolutionary thought. Professor Dawkins articulates a gene's eye view of evolution - a view giving centre stage to these persistent units of information, and in which organisms can be seen as vehicles for their replication. This imaginative, powerful, and stylistically brilliant work not only brought the insights of Neo-Darwinism to a wide audience, but galvanized the biology community, generating much debate and stimulating whole new areas of research. Forty years later, its insights remain as relevant today as on the day it was published. <br />This 40th anniversary edition includes a new epilogue from the author discussing the continuing relevance of these ideas in evolutionary biology today, as well as the original prefaces and foreword, and extracts from early reviews. <br />Oxford Landmark Science books are 'must-read' classics of modern science writing which have crystallized big ideas, and shaped the way we think.<br />","num_pages":464,"authors":{"author":{"id":1194,"name":"Richard Dawkins","role":"","image_url":"https://images.gr-assets.com/authors/1377030297p5/1194.jpg","small_image_url":"https://images.gr-assets.com/authors/1377030297p2/1194.jpg","link":"https://www.goodreads.com/author/show/1194.Richard_Dawkins","average_rating":4.03,"ratings_count":757961,"text_reviews_count":30157}},"average_rating":4.16,"ratings_count":191695,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/599660.The_Undercover_Economist","title":"The Undercover Economist","title_without_series":"The Undercover Economist","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SX98_.jpg","description":"Who makes most money from the demand for cappuccinos early in the morning at Waterloo Station? Why is it impossible to get a foot on the property ladder? How does the Mafia make money from laundries when street gangs pushing drugs dont? Who really benefits from immigration? How can China, in just fifty years, go from the worlds worst famine to one of the greatest economic revolutions of all time, lifting a million people out of poverty a month?<br /><br />Looking at familiar situations in unfamiliar ways, THE UNDERCOVER ECONOMIST is a fresh explanation of the fundamental principles of the modern economy, illuminated by examples from the streets of London to the booming skyscrapers of Shanghai to the sleepy canals of Bruges. Leaving behind textbook jargon and equations, Tim Harford will reveal the games of signals and negotiations, contests of strength and battles of wit that drive not only the economy at large but the everyday choices we make.","num_pages":278,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60509,"text_reviews_count":4325}},"average_rating":3.81,"ratings_count":29400,"publication_day":"","publication_month":"","publication_year":2007},{"link":"https://www.goodreads.com/book/show/25516595-thinking-fast-and-slow","title":"Thinking, Fast and Slow","title_without_series":"Thinking, Fast and Slow","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SX98_.jpg","description":"<b>In the highly anticipated <i>Thinking, Fast and Slow</i>, Kahneman takes us on a groundbreaking tour of the mind and explains the two systems that drive the way we think.</b><br /><br />System 1 is fast, intuitive, and emotional; System 2 is slower, more deliberative, and more logical. Kahneman exposes the extraordinary capabilities  and also the faults and biases  of fast thinking, and reveals the pervasive influence of intuitive impressions on our thoughts and behavior. <br /><br />The impact of loss aversion and overconfidence on corporate strategies, the difficulties of predicting what will make us happy in the future, the challenges of properly framing risks at work and at home, the profound effect of cognitive biases on everything from playing the stock market to planning the next vacation  each of these can be understood only by knowing how the two systems work together to shape our judgments and decisions.<br /><br />Engaging the reader in a lively conversation about how we think, Kahneman reveals where we can and cannot trust our intuitions and how we can tap into the benefits of slow thinking. He offers practical and enlightening insights into how choices are made in both our business and our personal lives  and how we can use different techniques to guard against the mental glitches that often get us into trouble. <br /><br /><i>Thinking, Fast and Slow</i> will transform the way you think about thinking.","num_pages":504,"authors":{"author":{"id":72401,"name":"Daniel Kahneman","role":"","image_url":"https://images.gr-assets.com/authors/1615917414p5/72401.jpg","small_image_url":"https://images.gr-assets.com/authors/1615917414p2/72401.jpg","link":"https://www.goodreads.com/author/show/72401.Daniel_Kahneman","average_rating":4.15,"ratings_count":603963,"text_reviews_count":21224}},"average_rating":4.17,"ratings_count":581208,"publication_day":"","publication_month":"","publication_year":2012},{"link":"https://www.goodreads.com/book/show/40876575-utopia-for-realists","title":"Utopia for Realists: How We Can Build the Ideal World","title_without_series":"Utopia for Realists: How We Can Build the Ideal World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX98_.jpg","description":"<b>Universal basic income. A 15-hour workweek. Open borders. Does it sound too good to be true? One of Europe's leading young thinkers shows how we can build an ideal world today.</b> <br /><br />After working all day at jobs we often dislike, we buy things we don't need. Rutger Bregman, a Dutch historian, reminds us it needn't be this wayand in some places it isn't. Rutger Bregman's TED Talk about universal basic income seemed impossibly radical when he delivered it in 2014. A quarter of a million views later, the subject of that video is being seriously considered by leading economists and government leaders the world over. It's just one of the many utopian ideas that Bregman proves is possible today. <br /><br /><i>Utopia for Realists</i> is one of those rare books that takes you by surprise and challenges what you think can happen. From a Canadian city that once completely eradicated poverty, to Richard Nixon's near implementation of a basic income for millions of Americans, Bregman takes us on a journey through history, and beyond the traditional left-right divides, as he champions ideas whose time have come. <br /><br />Every progressive milestone of civilizationfrom the end of slavery to the beginning of democracywas once considered a utopian fantasy. Bregman's book, both challenging and bracing, demonstrates that new utopian ideas, like the elimination of poverty and the creation of the fifteen-hour workweek, can become a reality in our lifetime. Being unrealistic and unreasonable can in fact make the impossible inevitable, and it is the only way to build the ideal world.","num_pages":262,"authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.22,"ratings_count":137733,"text_reviews_count":14039}},"average_rating":4.21,"ratings_count":42631,"publication_day":14,"publication_month":3,"publication_year":2017}]`),nJ=JSON.parse(`[{"link":"https://www.goodreads.com/book/show/35167718-what-do-you-care-what-other-people-think","title":"\\"What Do You Care What Other People Think?\\": Further Adventures of a Curious Character","title_without_series":"\\"What Do You Care What Other People Think?\\": Further Adventures of a Curious Character","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1516068365l/35167718._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1516068365l/35167718._SX98_.jpg","description":"One of the greatest physicists of the twentieth century, Richard Feynman possessed an unquenchable thirst for adventure and an unparalleled ability to tell the stories of his life. \\"What Do You Care What Other People Think?\\" is Feynman's last literary legacy, prepared with his friend and fellow drummer, Ralph Leighton.<br />Among the book's many tales we meet Feynman's first wife, Arlene, who taught him of love's irreducible mystery as she lay dying in a hospital bed while he worked nearby on the atomic bomb at Los Alamos. We are also given a fascinating narrative of the investigation of the space shuttle Challenger's explosion in 1986, and we relive the moment when Feynman revealed the disaster's cause by an elegant experiment: dropping a ring of rubber into a glass of cold water and pulling it out, misshapen.","num_pages":288,"authors":{"author":{"id":1429989,"name":"Richard P. Feynman","role":"","image_url":"https://images.gr-assets.com/authors/1498916887p5/1429989.jpg","small_image_url":"https://images.gr-assets.com/authors/1498916887p2/1429989.jpg","link":"https://www.goodreads.com/author/show/1429989.Richard_P_Feynman","average_rating":4.26,"ratings_count":364448,"text_reviews_count":15567}},"average_rating":4.19,"ratings_count":30597,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/30257963-12-rules-for-life","title":"12 Rules for Life: An Antidote to Chaos","title_without_series":"12 Rules for Life: An Antidote to Chaos","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1512705866l/30257963._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1512705866l/30257963._SX98_.jpg","description":"<b>What does everyone in the modern world need to know? Renowned psychologist Jordan B. Peterson's answer to this most difficult of questions uniquely combines the hard-won truths of ancient tradition with the stunning revelations of cutting-edge scientific research.</b><br /><br />Humorous, surprising, and informative, Dr. Peterson tells us why skateboarding boys and girls must be left alone, what terrible fate awaits those who criticize too easily, and why you should always pet a cat when you meet one on the street.<br /><br />What does the nervous system of the lowly lobster have to tell us about standing up straight (with our shoulders back) and about success in life? Why did ancient Egyptians worship the capacity to pay careful attention as the highest of gods? What dreadful paths do people tread when they become resentful, arrogant, and vengeful? Dr. Peterson journeys broadly, discussing discipline, freedom, adventure, and responsibility, distilling the world's wisdom into 12 practical and profound rules for life. <i>12 Rules for Life</i> shatters the modern commonplaces of science, faith, and human nature while transforming and ennobling the mind and spirit of its listeners.","num_pages":409,"authors":{"author":{"id":282885,"name":"Jordan B. Peterson","role":"","image_url":"https://images.gr-assets.com/authors/1651741136p5/282885.jpg","small_image_url":"https://images.gr-assets.com/authors/1651741136p2/282885.jpg","link":"https://www.goodreads.com/author/show/282885.Jordan_B_Peterson","average_rating":3.93,"ratings_count":314319,"text_reviews_count":23306}},"average_rating":3.91,"ratings_count":264728,"publication_day":23,"publication_month":1,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/38820046-21-lessons-for-the-21st-century","title":"21 Lessons for the 21st Century","title_without_series":"21 Lessons for the 21st Century","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564577305l/38820046._SX98_.jpg","description":"<b>In<i> Sapiens, </i>he explored our past. In <i>Homo Deus, </i>he looked to our future<i>. </i>Now, one of the most innovative thinkers on the planet turns to the present to make sense of today's most pressing issues.</b><br /><br />How do computers and robots change the meaning of being human? How do we deal with the epidemic of fake news? Are nations and religions still relevant? What should we teach our children?<br /><br />Yuval Noah Harari's <i>21 Lessons for the 21st Century</i> is a probing and visionary investigation into today's most urgent issues as we move into the uncharted territory of the future. As technology advances faster than our understanding of it, hacking becomes a tactic of war, and the world feels more polarized than ever, Harari addresses the challenge of navigating life in the face of constant and disorienting change and raises the important questions we need to ask ourselves in order to survive.<br /><br />In twenty-one accessible chapters that are both provocative and profound, Harari builds on the ideas explored in his previous books, untangling political, technological, social, and existential issues and offering advice on how to prepare for a very different future from the world we now live in: How can we retain freedom of choice when Big Data is watching us? What will the future workforce look like, and how should we ready ourselves for it? How should we deal with the threat of terrorism? Why is liberal democracy in crisis?<br /><br />Harari's unique ability to make sense of where we have come from and where we are going has captured the imaginations of millions of readers. Here he invites us to consider values, meaning, and personal engagement in a world full of noise and uncertainty. When we are deluged with irrelevant information, clarity is power. Presenting complex contemporary challenges clearly and accessibly, <i>21 Lessons for the 21st Century</i> is essential reading.","num_pages":372,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.29,"ratings_count":1790118,"text_reviews_count":100100}},"average_rating":4.15,"ratings_count":176316,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55361205-a-promised-land","title":"A Promised Land","title_without_series":"A Promised Land","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1600357110l/55361205._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1600357110l/55361205._SX98_.jpg","description":"A riveting, deeply personal account of history in the making, from the president who inspired us to believe in the power of democracy. <br /><br />In the stirring, highly anticipated first volume of his presidential memoirs, Barack Obama tells the story of his improbable odyssey from young man searching for his identity to leader of the free world, describing in strikingly personal detail both his political education and the landmark moments of the first term of his historic presidencya time of dramatic transformation and turmoil.<br /><br />Obama takes readers on a compelling journey from his earliest political aspirations to the pivotal Iowa caucus victory that demonstrated the power of grassroots activism to the watershed night of November 4, 2008, when he was elected 44th president of the United States, becoming the first African American to hold the nations highest office.<br /><br />Reflecting on the presidency, he offers a unique and thoughtful exploration of both the awesome reach and the limits of presidential power, as well as singular insights into the dynamics of U.S. partisan politics and international diplomacy. Obama brings readers inside the Oval Office and the White House Situation Room, and to Moscow, Cairo, Beijing, and points beyond. We are privy to his thoughts as he assembles his cabinet, wrestles with a global financial crisis, takes the measure of Vladimir Putin, overcomes seemingly insurmountable odds to secure passage of the Affordable Care Act, clashes with generals about U.S. strategy in Afghanistan, tackles Wall Street reform, responds to the devastating Deepwater Horizon blowout, and authorizes Operation Neptunes Spear, which leads to the death of Osama bin Laden.<br /><br />A Promised Land is extraordinarily intimate and introspectivethe story of one mans bet with history, the faith of a community organizer tested on the world stage. Obama is candid about the balancing act of running for office as a Black American, bearing the expectations of a generation buoyed by messages of hope and change, and meeting the moral challenges of high-stakes decision-making. He is frank about the forces that opposed him at home and abroad, open about how living in the White House affected his wife and daughters, and unafraid to reveal self-doubt and disappointment. Yet he never wavers from his belief that inside the great, ongoing American experiment, progress is always possible.<br /><br />This beautifully written and powerful book captures Barack Obamas conviction that democracy is not a gift from on high but something founded on empathy and common understanding and built together, day by day.","num_pages":768,"authors":{"author":{"id":6356,"name":"Barack Obama","role":"","image_url":"https://images.gr-assets.com/authors/1602177326p5/6356.jpg","small_image_url":"https://images.gr-assets.com/authors/1602177326p2/6356.jpg","link":"https://www.goodreads.com/author/show/6356.Barack_Obama","average_rating":4.07,"ratings_count":701321,"text_reviews_count":39543}},"average_rating":4.32,"ratings_count":271957,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/28092883-a-short-history-of-nearly-everything","title":"A Short History of Nearly Everything","title_without_series":"A Short History of Nearly Everything","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1470437934l/28092883._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1470437934l/28092883._SX98_.jpg","description":"<b>The ultimate eye-opening journey through time and space, A Short History of Nearly Everything is the biggest-selling popular science book of the 21st century and has sold over 2 million copies.</b><br /><br />Bill Bryson describes himself as a reluctant traveller, but even when he stays safely at home he can't contain his curiosity about the world around him.<i> A Short History of Nearly Everything </i>is his quest to understand everything that has happened from the Big Bang to the rise of civilization - how we got from there, being nothing at all, to here, being us. Bill Bryson's challenge is to take subjects that normally bore the pants off most of us, like geology, chemistry and particle physics, and see if there isn't some way to render them comprehensible to people who have never thought they could be interested in science.<br /><br />The ultimate eye-opening journey through time and space, A Short History of Nearly Everything is the biggest-selling popular science book of the 21st century, and reveals the world in a way most of us have never seen it before.","num_pages":668,"authors":{"author":{"id":7,"name":"Bill Bryson","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/7.Bill_Bryson","average_rating":4.05,"ratings_count":1819165,"text_reviews_count":111717}},"average_rating":4.22,"ratings_count":419534,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/128029.A_Thousand_Splendid_Suns","title":"A Thousand Splendid Suns","title_without_series":"A Thousand Splendid Suns","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655336738l/128029._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655336738l/128029._SX98_.jpg","description":"Mariam is only fifteen when she is sent to Kabul to marry the troubled and bitter Rasheed, who is thirty years her senior. Nearly two decades later, in a climate of growing unrest, tragedy strikes fifteen-year-old Laila, who must leave her home and join Mariam's unhappy household. Laila and Mariam are to find consolation in each other, their friendship to grow as deep as the bond between sisters, as strong as the ties between mother and daughter. <br /><br />With the passing of time comes Taliban rule over Afghanistan, the streets of Kabul loud with the sound of gunfire and bombs, life a desperate struggle against starvation, brutality and fear, the women's endurance tested beyond their worst imaginings. Yet love can move people to act in unexpected ways, lead them to overcome the most daunting obstacles with a startling heroism. In the end it is love that triumphs over death and destruction. <br /><br /><i>A Thousand Splendid Suns</i> is a portrait of a wounded country and a story of family and friendship, of an unforgiving time, an unlikely bond, and an indestructible love.","num_pages":372,"authors":{"author":{"id":569,"name":"Khaled Hosseini","role":"","image_url":"https://images.gr-assets.com/authors/1359753468p5/569.jpg","small_image_url":"https://images.gr-assets.com/authors/1359753468p2/569.jpg","link":"https://www.goodreads.com/author/show/569.Khaled_Hosseini","average_rating":4.36,"ratings_count":5718107,"text_reviews_count":249620}},"average_rating":4.45,"ratings_count":1719552,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25666050-algorithms-to-live-by","title":"Algorithms to Live By: The Computer Science of Human Decisions","title_without_series":"Algorithms to Live By: The Computer Science of Human Decisions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1454296875l/25666050._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1454296875l/25666050._SX98_.jpg","description":"<b>A fascinating exploration of how insights from computer algorithms can be applied to our everyday lives, helping to solve common decision-making problems and illuminate the workings of the human mind</b><br /><br />All our lives are constrained by limited space and time, limits that give rise to a particular set of problems. What should we do, or leave undone, in a day or a lifetime? How much messiness should we accept? What balance of new activities and familiar favorites is the most fulfilling? These may seem like uniquely human quandaries, but they are not: computers, too, face the same constraints, so computer scientists have been grappling with their version of such issues for decades. And the solutions they've found have much to teach us.<br /><br />In a dazzlingly interdisciplinary work, acclaimed author Brian Christian and cognitive scientist Tom Griffiths show how the algorithms used by computers can also untangle very human questions. They explain how to have better hunches and when to leave things to chance, how to deal with overwhelming choices and how best to connect with others. From finding a spouse to finding a parking spot, from organizing one's inbox to understanding the workings of memory, <i>Algorithms to Live By</i> transforms the wisdom of computer science into strategies for human living.","num_pages":"","authors":{"author":{"id":4199891,"name":"Brian  Christian","role":"","image_url":"https://images.gr-assets.com/authors/1737681489p5/4199891.jpg","small_image_url":"https://images.gr-assets.com/authors/1737681489p2/4199891.jpg","link":"https://www.goodreads.com/author/show/4199891.Brian_Christian","average_rating":4.13,"ratings_count":44435,"text_reviews_count":4204}},"average_rating":4.12,"ratings_count":34711,"publication_day":19,"publication_month":4,"publication_year":2016},{"link":"https://www.goodreads.com/book/show/13030110-all-you-zombies","title":"All You Zombies","title_without_series":"All You Zombies","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338513108l/13030110._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338513108l/13030110._SX98_.jpg","description":"First published in The Magazine of Fantasy and Science Fiction - March, 1959 - the story involves a number of paradoxes caused by time travel. It further develops themes explored by the author in a previous work, \\"By His Bootstraps\\", published some 18 years earlier.","num_pages":13,"authors":{"author":{"id":205,"name":"Robert A. Heinlein","role":"","image_url":"https://images.gr-assets.com/authors/1192826560p5/205.jpg","small_image_url":"https://images.gr-assets.com/authors/1192826560p2/205.jpg","link":"https://www.goodreads.com/author/show/205.Robert_A_Heinlein","average_rating":3.94,"ratings_count":1319864,"text_reviews_count":50866}},"average_rating":4.07,"ratings_count":7286,"publication_day":"","publication_month":3,"publication_year":1959},{"link":"https://www.goodreads.com/book/show/22466476-antifragile-systems-and-teams","title":"Antifragile Systems and Teams","title_without_series":"Antifragile Systems and Teams","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1436603358l/22466476._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1436603358l/22466476._SX98_.jpg","description":"How Can DevOps Make You Antifragile?<br /><br />All complex computer systems eventually break, despite all of the heavy-handed, bureaucratic change-management processes we throw at them. But some systems are clearly more fragile than others, depending on how well they cope with stress. In this O'Reilly report, Dave Zwieback explains how the DevOps methodology can help make your system \\"antifragile.\\"<br /><br />Systems are fragile when organizations are unprepared to handle changing conditions. As generalists adept at several roles, DevOps practitioners adjust more easily to the fast pace of change. Rather than attempt to constrain volatility, DevOps embraces disorder, randomness, and impermanence to make systems even better.<br /><br />This concise report covers: Why Etsy, Netflix, and other antifragile companies constantly introduce volatility to test and upgrade their systemsHow DevOps removes the schism between developers and operations, enlisting developers to deploy as well as buildUsing continual experimentation and minor failures to make critical adjustments--and discover breakthroughsHow an overreliance on measurement and automation can make systems fragileWhy sharing increases trust, collaboration, and tribal knowledgeDownload this free report and learn how the DevOps philosophy of Culture, Automation, Measurement, and Sharing makes use of changing conditions and even embarrassing mistakes to help improve your system--and your organization.<br /><br />Dave Zwieback has been managing large-scale, mission-critical infrastructure and teams for 17 years.","num_pages":"","authors":{"author":{"id":7080009,"name":"Dave Zwieback","role":"","image_url":"https://images.gr-assets.com/authors/1755285050p5/7080009.jpg","small_image_url":"https://images.gr-assets.com/authors/1755285050p2/7080009.jpg","link":"https://www.goodreads.com/author/show/7080009.Dave_Zwieback","average_rating":3.71,"ratings_count":317,"text_reviews_count":37}},"average_rating":3.5,"ratings_count":60,"publication_day":1,"publication_month":4,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/13530973-antifragile","title":"Antifragile: Things That Gain from Disorder","title_without_series":"Antifragile: Things That Gain from Disorder","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1352422827l/13530973._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1352422827l/13530973._SX98_.jpg","description":"From the bestselling author of The Black Swan and one of the foremost philosophers of our time, Nassim Nicholas Taleb, a book on how some systems actually benefit from disorder.<br /><br />In The Black Swan Taleb outlined a problem; in <i>Antifragile</i> he offers a definitive solution: how to gain from disorder and chaos while being protected from fragilities and adverse events. For what he calls the \\"antifragile\\" is one step beyond robust, as it benefits from adversity, uncertainty and stressors, just as human bones get stronger when subjected to stress and tension.<br /><br />Taleb stands uncertainty on its head, making it desirable, and proposing that things be built in an antifragile manner. Extremely ambitious and multidisciplinary, <i>Antifragile</i> provides a blueprint for how to behaveand thrivein a world we don't understand and which is too uncertain for us to even try to understand. He who is not antifragile will perish. Why is the city state better than the nation state, why is debt bad for you, and why is almost everything modern bound to fail? The book covers innovation, health, biology, medicine, life decisions, politics, foreign policy, urban planning, war, personal finance, and economic systems. Throughout, the voice and recipes of the ancient wisdom from Phoenician, Roman, Greek, and Medieval sources are heard loud and clear.","num_pages":426,"authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":306327,"text_reviews_count":21059}},"average_rating":4.1,"ratings_count":57200,"publication_day":27,"publication_month":11,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/37707396-artemis","title":"Artemis","title_without_series":"Artemis","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1514317976l/37707396._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1514317976l/37707396._SX98_.jpg","description":"Jazz Bashara is a criminal.<br /> <br />Well, sort of. Life on Artemis, the first and only city on the moon, is tough if you're not a rich tourist or an eccentric billionaire. So smuggling in the occasional harmless bit of contraband barely counts, right? Not when you've got debts to pay and your job as a porter barely covers the rent.<br /> <br />Everything changes when Jazz sees the chance to commit the perfect crime, with a reward too lucrative to turn down. But pulling off the impossible is just the start of her problems, as she learns that she's stepped square into a conspiracy for control of Artemis itselfand that now, her only chance at survival lies in a gambit even riskier than the first.","num_pages":255,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.34,"ratings_count":2739668,"text_reviews_count":277652}},"average_rating":3.69,"ratings_count":320784,"publication_day":14,"publication_month":11,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/40121378-atomic-habits","title":"Atomic Habits: An Easy & Proven Way to Build Good Habits & Break Bad Ones","title_without_series":"Atomic Habits: An Easy & Proven Way to Build Good Habits & Break Bad Ones","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655988385l/40121378._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1655988385l/40121378._SX98_.jpg","description":"No matter your goals, <i>Atomic Habits</i> offers a proven framework for improvingevery day. James Clear, one of the world's leading experts on habit formation, reveals practical strategies that will teach you exactly how to form good habits, break bad ones, and master the tiny behaviors that lead to remarkable results.<br /><br />If you're having trouble changing your habits, the problem isn't you. The problem is your system. Bad habits repeat themselves again and again not because you don't want to change, but because you have the wrong system for change. You do not rise to the level of your goals. You fall to the level of your systems. Here, you'll get a proven system that can take you to new heights.<br /><br />Clear is known for his ability to distill complex topics into simple behaviors that can be easily applied to daily life and work. Here, he draws on the most proven ideas from biology, psychology, and neuroscience to create an easy-to-understand guide for making good habits inevitable and bad habits impossible. Along the way, readers will be inspired and entertained with true stories from Olympic gold medalists, award-winning artists, business leaders, life-saving physicians, and star comedians who have used the science of small habits to master their craft and vault to the top of their field.<br /><br />Learn how to:<br />-Make time for new habits (even when life gets crazy);<br />-Overcome a lack of motivation and willpower;<br />- Design your environment to make success easier;<br />- Get back on track when you fall off course;<br />...and much more.<br /><br /><i>Atomic Habits</i> will reshape the way you think about progress and success, and give you the tools and strategies you need to transform your habits--whether you are a team looking to win a championship, an organization hoping to redefine an industry, or simply an individual who wishes to quit smoking, lose weight, reduce stress, or achieve any other goal.","num_pages":"","authors":{"author":{"id":7327369,"name":"James Clear","role":"","image_url":"https://images.gr-assets.com/authors/1393075384p5/7327369.jpg","small_image_url":"https://images.gr-assets.com/authors/1393075384p2/7327369.jpg","link":"https://www.goodreads.com/author/show/7327369.James_Clear","average_rating":4.32,"ratings_count":1278260,"text_reviews_count":76911}},"average_rating":4.32,"ratings_count":1260604,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/37976541-bad-blood","title":"Bad Blood: Secrets and Lies in a Silicon Valley Startup","title_without_series":"Bad Blood: Secrets and Lies in a Silicon Valley Startup","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523311515l/37976541._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523311515l/37976541._SX98_.jpg","description":"<b>The full inside story of the breathtaking rise and shocking collapse of a multibillion-dollar startup, by the prize-winning journalist who first broke the story and pursued it to the end in the face of pressure and threats from the CEO and her lawyers.</b> <br /><br />In 2014, Theranos founder and CEO Elizabeth Holmes was widely seen as the female Steve Jobs: a brilliant Stanford dropout whose startup \\"unicorn\\" promised to revolutionize the medical industry with a machine that would make blood tests significantly faster and easier. Backed by investors such as Larry Ellison and Tim Draper, Theranos sold shares in a fundraising round that valued the company at $9 billion, putting Holmes's worth at an estimated $4.7 billion. There was just one problem: The technology didn't work. <br /><br />For years, Holmes had been misleading investors, FDA officials, and her own employees. When Carreyrou, working at <i>The Wall Street Journal,</i> got a tip from a former Theranos employee and started asking questions, both Carreyrou and the <i>Journal</i> were threatened with lawsuits. Undaunted, the newspaper ran the first of dozens of Theranos articles in late 2015. By early 2017, the company's value was zero and Holmes faced potential legal action from the government and her investors. <br /><br />Here is the riveting story of the biggest corporate fraud since Enron, a disturbing cautionary tale set amid the bold promises and gold-rush frenzy of Silicon Valley.","num_pages":339,"authors":{"author":{"id":17575761,"name":"John Carreyrou","role":"","image_url":"https://images.gr-assets.com/authors/1637505627p5/17575761.jpg","small_image_url":"https://images.gr-assets.com/authors/1637505627p2/17575761.jpg","link":"https://www.goodreads.com/author/show/17575761.John_Carreyrou","average_rating":4.4,"ratings_count":280435,"text_reviews_count":23720}},"average_rating":4.4,"ratings_count":280257,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/38746485-becoming","title":"Becoming","title_without_series":"Becoming","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1528206996l/38746485._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1528206996l/38746485._SX98_.jpg","description":"In a life filled with meaning and accomplishment, Michelle Obama has emerged as one of the most iconic and compelling women of our era. As First Lady of the United States of Americathe first African American to serve in that roleshe helped create the most welcoming and inclusive White House in history, while also establishing herself as a powerful advocate for women and girls in the U.S. and around the world, dramatically changing the ways that families pursue healthier and more active lives, and standing with her husband as he led America through some of its most harrowing moments. Along the way, she showed us a few dance moves, crushed Carpool Karaoke, and raised two down-to-earth daughters under an unforgiving media glare. <br /> <br />In her memoir, a work of deep reflection and mesmerizing storytelling, Michelle Obama invites readers into her world, chronicling the experiences that have shaped herfrom her childhood on the South Side of Chicago to her years as an executive balancing the demands of motherhood and work, to her time spent at the worlds most famous address. With unerring honesty and lively wit, she describes her triumphs and her disappointments, both public and private, telling her full story as she has lived itin her own words and on her own terms. Warm, wise, and revelatory, Becoming is the deeply personal reckoning of a woman of soul and substance who has steadily defied expectationsand whose story inspires us to do the same.","num_pages":448,"authors":{"author":{"id":2338628,"name":"Michelle Obama","role":"","image_url":"https://images.gr-assets.com/authors/1658411922p5/2338628.jpg","small_image_url":"https://images.gr-assets.com/authors/1658411922p2/2338628.jpg","link":"https://www.goodreads.com/author/show/2338628.Michelle_Obama","average_rating":4.42,"ratings_count":1290881,"text_reviews_count":81742}},"average_rating":4.44,"ratings_count":1185428,"publication_day":13,"publication_month":11,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/31170723-behave","title":"Behave: The Biology of Humans at Our Best and Worst","title_without_series":"Behave: The Biology of Humans at Our Best and Worst","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517732866l/31170723._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517732866l/31170723._SX98_.jpg","description":"<b>Why do we do the things we do?</b><br /><br />More than a decade in the making, this game-changing book is Robert Sapolsky's genre-shattering attempt to answer that question as fully as perhaps only he could, looking at it from every angle. Sapolsky's storytelling concept is delightful but it also has a powerful intrinsic logic: he starts by looking at the factors that bear on a person's reaction in the precise moment a behavior occurs, and then hops back in time from there, in stages, ultimately ending up at the deep history of our species and its evolutionary legacy.<br /><br />And so the first category of explanation is the neurobiological one. A behavior occurswhether an example of humans at our best, worst, or somewhere in between. What went on in a person's brain a second before the behavior happened? Then Sapolsky pulls out to a slightly larger field of vision, a little earlier in time: What sight, sound, or smell caused the nervous system to produce that behavior? And then, what hormones acted hours to days earlier to change how responsive that individual is to the stimuli that triggered the nervous system? By now he has increased our field of vision so that we are thinking about neurobiology and the sensory world of our environment and endocrinology in trying to explain what happened.<br /><br />Sapolsky keeps going: How was that behavior influenced by structural changes in the nervous system over the preceding months, by that person's adolescence, childhood, fetal life, and then back to his or her genetic makeup? Finally, he expands the view to encompass factors larger than one individual. How did culture shape that individual's group, what ecological factors millennia old formed that culture? And on and on, back to evolutionary factors millions of years old.<br /><br />The result is one of the most dazzling tours d'horizon of the science of human behavior ever attempted, a majestic synthesis that harvests cutting-edge research across a range of disciplines to provide a subtle and nuanced perspective on why we ultimately do the things we do ... for good and for ill. Sapolsky builds on this understanding to wrestle with some of our deepest and thorniest questions relating to tribalism and xenophobia, hierarchy and competition, morality and free will, and war and peace. Wise, humane, often very funny, <i>Behave</i> is a towering achievement, powerfully humanizing, and downright heroic in its own right.","num_pages":790,"authors":{"author":{"id":187,"name":"Robert M. Sapolsky","role":"","image_url":"https://images.gr-assets.com/authors/1234040721p5/187.jpg","small_image_url":"https://images.gr-assets.com/authors/1234040721p2/187.jpg","link":"https://www.goodreads.com/author/show/187.Robert_M_Sapolsky","average_rating":4.29,"ratings_count":72794,"text_reviews_count":7715}},"average_rating":4.38,"ratings_count":31199,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/873537.Blink","title":"Blink: The Power of Thinking Without Thinking","title_without_series":"Blink: The Power of Thinking Without Thinking","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>'Mesmerizing' <i>Time</i></b><br /><br />An art expert instantly spots a fake. A cop decides whether to shoot. A psychologist accurately predicts a couple's future in minutes. This book is about those moments when we 'know' something without knowing why. It shows that honing your instincts could change the way you think about thinking forever. <br /><br />'Trust my snap judgement, buy this book: you'll be delighted' David Brooks, <i>The New York Times</i><br /><br />'Fiendishly clever' <i>Evening Standard</i><br /><br />'Provocative, fascinating, radical' Fergal Byrne, <i>Financial Times</i>","num_pages":277,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3144403,"text_reviews_count":130486}},"average_rating":3.96,"ratings_count":619929,"publication_day":"","publication_month":"","publication_year":2006},{"link":"https://www.goodreads.com/book/show/13707738-boomerang","title":"Boomerang: Travels in the New Third World","title_without_series":"Boomerang: Travels in the New Third World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1345046879l/13707738._SX98_.jpg","description":"The tsunami of cheap credit that rolled across the planet between 2002 and 2008 was more than a simple financial phenomenon: it was temptation, offering entire societies the chance to reveal aspects of their characters they could not normally afford to indulge.<br /><br /><br />Icelanders wanted to stop fishing and become investment bankers. The Greeks wanted to turn their country into a pinata stuffed with cash and allow as many citizens as possible to take a whack at it. The Germans wanted to be even more German; the Irish wanted to stop being Irish.<br /><br /><br />Michael Lewis's investigation of bubbles beyond our shores is so brilliantly, sadly hilarious that it leads the American reader to a comfortable complacency: oh, those foolish foreigners. But when he turns a merciless eye on California and Washington, DC, we see that the narrative is a trap baited with humor, and we understand the reckoning that awaits the greatest and greediest of debtor nations.","num_pages":218,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":3.9,"ratings_count":47319,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/29780253-born-a-crime","title":"Born a Crime: Stories From a South African Childhood","title_without_series":"Born a Crime: Stories From a South African Childhood","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473867911l/29780253._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473867911l/29780253._SX98_.jpg","description":"The memoir of one mans coming-of-age, set during the twilight of apartheid and the tumultuous days of freedom that followed.<br /> <br />Trevor Noahs unlikely path from apartheid South Africa to the desk of The Daily Show began with a criminal act: his birth. Trevor was born to a white Swiss father and a black Xhosa mother at a time when such a union was punishable by five years in prison. Living proof of his parents indiscretion, Trevor was kept mostly indoors for the earliest years of his life, bound by the extreme and often absurd measures his mother took to hide him from a government that could, at any moment, steal him away. Finally liberated by the end of South Africas tyrannical white rule, Trevor and his mother set forth on a grand adventure, living openly and freely and embracing the opportunities won by a centuries-long struggle.<br /> <br /><i>Born a Crime</i> is the story of a mischievous young boy who grows into a restless young man as he struggles to find himself in a world where he was never supposed to exist. It is also the story of that young mans relationship with his fearless, rebellious, and fervently religious motherhis teammate, a woman determined to save her son from the cycle of poverty, violence, and abuse that would ultimately threaten her own life.","num_pages":289,"authors":{"author":{"id":15149526,"name":"Trevor Noah","role":"","image_url":"https://images.gr-assets.com/authors/1555600819p5/15149526.jpg","small_image_url":"https://images.gr-assets.com/authors/1555600819p2/15149526.jpg","link":"https://www.goodreads.com/author/show/15149526.Trevor_Noah","average_rating":4.48,"ratings_count":814395,"text_reviews_count":65367}},"average_rating":4.49,"ratings_count":797536,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6289283-born-to-run","title":"Born to Run: A Hidden Tribe, Superathletes, and the Greatest Race the World Has Never Seen","title_without_series":"Born to Run: A Hidden Tribe, Superathletes, and the Greatest Race the World Has Never Seen","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631519495l/6289283._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631519495l/6289283._SX98_.jpg","description":"Full of incredible characters, amazing athletic achievements, cutting-edge science, and, most of all, pure inspiration, <i>Born to Run</i> is an epic adventure that began with one simple question: Why does my foot hurt? In search of an answer, Christopher McDougall sets off to find a tribe of the worlds greatest distance runners and learn their secrets, and in the process shows us that everything we thought we knew about running is wrong.<br /><br />Isolated by the most savage terrain in North America, the reclusive Tarahumara Indians of Mexicos deadly Copper Canyons are custodians of a lost art. For centuries they have practiced techniques that allow them to run hundreds of miles without rest and chase down anything from a deer to an Olympic marathoner while enjoying every mile of it. Their superhuman talent is matched by uncanny health and serenity, leaving the Tarahumara immune to the diseases and strife that plague modern existence. With the help of Caballo Blanco, a mysterious loner who lives among the tribe, the author was able not only to uncover the secrets of the Tarahumara but also to find his own inner ultra-athlete, as he trained for the challenge of a lifetime: a fifty-mile race through the heart of Tarahumara country pitting the tribe against an odd band of Americans, including a star ultramarathoner, a beautiful young surfer, and a barefoot wonder.<br /><br />With a sharp wit and wild exuberance, McDougall takes us from the high-tech science labs at Harvard to the sun-baked valleys and freezing peaks across North America, where ever-growing numbers of ultrarunners are pushing their bodies to the limit, and, finally, to the climactic race in the Copper Canyons. <i>Born to Run</i> is that rare book that will not only engage your mind but inspire your body when you realize that the secret to happiness is right at your feet, and that you, indeed all of us, were born to run.","num_pages":287,"authors":{"author":{"id":133538,"name":"Christopher McDougall","role":"","image_url":"https://images.gr-assets.com/authors/1294361251p5/133538.jpg","small_image_url":"https://images.gr-assets.com/authors/1294361251p2/133538.jpg","link":"https://www.goodreads.com/author/show/133538.Christopher_McDougall","average_rating":4.28,"ratings_count":261537,"text_reviews_count":21693}},"average_rating":4.3,"ratings_count":232453,"publication_day":5,"publication_month":5,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/40277241-brief-answers-to-the-big-questions","title":"Brief Answers to the Big Questions","title_without_series":"Brief Answers to the Big Questions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1536862019l/40277241._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1536862019l/40277241._SX98_.jpg","description":"Stephen Hawking was recognized as one of the greatest minds of our time and a figure of inspiration after defying his ALS diagnosis at age twenty-one. He is known for both his breakthroughs in theoretical physics as well as his ability to make complex concepts accessible for all, and was beloved for his mischievous sense of humor. At the time of his death, Hawking was working on a final project: a book compiling his answers to the \\"big\\" questions that he was so often posed--questions that ranged beyond his academic field. <br /><br />Within these pages, he provides his personal views on our biggest challenges as a human race, and where we, as a planet, are heading next. Each section will be introduced by a leading thinker offering his or her own insight into Professor Hawking's contribution to our understanding.","num_pages":256,"authors":{"author":{"id":1401,"name":"Stephen W. Hawking","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1401.Stephen_W_Hawking","average_rating":4.19,"ratings_count":854122,"text_reviews_count":34174}},"average_rating":4.26,"ratings_count":86545,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/59616977-building-a-second-brain","title":"Building a Second Brain: A Proven Method to Organize Your Digital Life and Unlock Your Creative Potential","title_without_series":"Building a Second Brain: A Proven Method to Organize Your Digital Life and Unlock Your Creative Potential","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1652891488l/59616977._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1652891488l/59616977._SX98_.jpg","description":"&gt;For the first time in history, we have instantaneous access to the worlds knowledge. There has never been a better time to learn, to contribute, and to improve ourselves. Yet, rather than feeling empowered, we are often left feeling overwhelmed by this constant influx of information. The very knowledge that was supposed to set us free has instead led to the paralyzing stress of believing well never know or remember enough.<br /> <br />Now, this eye-opening and accessible guide shows how you can easily create your own personal system for knowledge management, otherwise known as a Second Brain. As a trusted and organized digital repository of your most valued ideas, notes, and creative work synced across all your devices and platforms, a Second Brain gives you the confidence to tackle your most important projects and ambitious goals. <br /> <br />Discover the full potential of your ideas and translate what you know into more powerful, more meaningful improvements in your work and life by <i>Building a Second Brain</i>.","num_pages":"","authors":{"author":{"id":17177938,"name":"Tiago Forte","role":"","image_url":"https://images.gr-assets.com/authors/1579580196p5/17177938.jpg","small_image_url":"https://images.gr-assets.com/authors/1579580196p2/17177938.jpg","link":"https://www.goodreads.com/author/show/17177938.Tiago_Forte","average_rating":4.04,"ratings_count":24961,"text_reviews_count":2472}},"average_rating":4.04,"ratings_count":21297,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/48889983-calling-bullshit","title":"Calling Bullshit: The Art of Skepticism in a Data-Driven World","title_without_series":"Calling Bullshit: The Art of Skepticism in a Data-Driven World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1592246867l/48889983._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1592246867l/48889983._SX98_.jpg","description":"<b>Bullshit isn't what it used to be.</b> <b>Now, two science professors give us the tools to dismantle misinformation and think clearly in a world of fake news and bad data.</b><br /><br />It's increasingly difficult to know what's true. Misinformation, disinformation, and fake news abound. Our media environment has become hyperpartisan. Science is conducted by press release. Startup culture elevates bullshit to high art. We are fairly well equipped to spot the sort of old-school bullshit that is based in fancy rhetoric and weasel words, but most of us don't feel qualified to challenge the avalanche of new-school bullshit presented in the language of math, science, or statistics. In <i>Calling Bullshit, </i> Professors Carl Bergstrom and Jevin West give us a set of powerful tools to cut through the most intimidating data.<br /><br />You don't need a lot of technical expertise to call out problems with data. Are the numbers or results too good or too dramatic to be true? Is the claim comparing like with like? Is it confirming your personal bias? Drawing on a deep well of expertise in statistics and computational biology, Bergstrom and West exuberantly unpack examples of selection bias and muddled data visualization, distinguish between correlation and causation, and examine the susceptibility of science to modern bullshit.<br /><br />We have always needed people who call bullshit when necessary, whether within a circle of friends, a community of scholars, or the citizenry of a nation. Now that bullshit has evolved, we need to relearn the art of skepticism.","num_pages":"","authors":{"author":{"id":5387403,"name":"Carl T. Bergstrom","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/5387403.Carl_T_Bergstrom","average_rating":4.11,"ratings_count":5308,"text_reviews_count":676}},"average_rating":4.11,"ratings_count":5234,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/31868165-captivate","title":"Captivate: The Science of Succeeding with People","title_without_series":"Captivate: The Science of Succeeding with People","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1489777793l/31868165._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1489777793l/31868165._SX98_.jpg","description":"Do you feel awkward at networking events? Do you wonder what your date really thinks of you? Do you wish you could decode people? You need to learn the science of people.<br /> <br />As a human behavior hacker, Vanessa Van Edwards created a research lab to study the hidden forces that drive us. And shes cracked the code. In Captivate, she shares shortcuts, systems, and secrets for taking charge of your interactions at work, at home, and in any social situation. These arent the people skills you learned in school. This is the first comprehensive, science backed, real life manual on how to captivate anyoneand a completely new approach to building connections.<br /> <br />Just like knowing the formulas to use in a chemistry lab, or the right programming language to build an app, Captivate provides simple ways to solve people problems. Youll learn, for example<br /> <br /> How to work a room: Every party, networking event, and social situation has a predictable map. Discover the sweet spot for making the most connections.<br /> How to read faces: Its easier than you think to speed-read facial expressions and use them to predict peoples emotions.<br /> How to talk to anyone: Every conversation can be memorableonce you learn how certain words generate the pleasure hormone dopamine in listeners.<br /><br />When you understand the laws of human behavior, your influence, impact, and income will increase significantly. Whats more, you will improve your interpersonal intelligence, make a killer first impression, and build rapport quickly and authentically in any situationnegotiations, interviews, parties, and pitches. Youll never interact the same way again.","num_pages":"","authors":{"author":{"id":6947464,"name":"Vanessa Van Edwards","role":"","image_url":"https://images.gr-assets.com/authors/1467470633p5/6947464.jpg","small_image_url":"https://images.gr-assets.com/authors/1467470633p2/6947464.jpg","link":"https://www.goodreads.com/author/show/6947464.Vanessa_Van_Edwards","average_rating":4.14,"ratings_count":11956,"text_reviews_count":1141}},"average_rating":4.11,"ratings_count":8346,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60321447-chip-war","title":"Chip War: The Fight for the World's Most Critical Technology","title_without_series":"Chip War: The Fight for the World's Most Critical Technology","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1662566820l/60321447._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1662566820l/60321447._SX98_.jpg","description":"An epic account of the decades-long battle to control what has emerged as the world's most critical resourcemicrochip technologywith the United States and China increasingly in conflict.<br /><br />You may be surprised to learn that microchips are the new oilthe scarce resource on which the modern world depends. Today, military, economic, and geopolitical power are built on a foundation of computer chips. Virtually <em>everything</em> from missiles to microwaves, smartphones to the stock market  runs on chips. Until recently, America designed and built the fastest chips and maintained its lead as the #1 superpower. Now, America's edge isslipping, undermined by competitors in Taiwan, Korea,Europe, and, above all, China. Today, as <i>Chip War</i> reveals, China, which spends more money each year importing chips than it spends importing oil,is pouring billions into a chip-building initiative to catch up to the US. At stake is America's military superiority and economic prosperity.<br /><br />Economic historian Chris Miller explains how the semiconductor came to play a critical role in modern life and how the U.S. become dominant in chip design and manufacturing and applied this technology to military systems. America's victory in the Cold War and its global military dominance stems from its ability to harness computing power more effectively than any other power. But here, too, China is catching up, with its chip-building ambitions and military modernization going hand in hand.America has let key components of the chip-building process slip out of its grasp, contributing not only to a worldwide chip shortage but also a new Cold War with a superpower adversary that is desperate to bridge the gap.<br /><br />Illuminating, timely, and fascinating, <i>Chip War</i> shows that, to make sense of the current state of politics, economics, and technology, we must first understand the vital role played by chips.","num_pages":431,"authors":{"author":{"id":10070,"name":"Chris   Miller","role":"","image_url":"https://images.gr-assets.com/authors/1675147491p5/10070.jpg","small_image_url":"https://images.gr-assets.com/authors/1675147491p2/10070.jpg","link":"https://www.goodreads.com/author/show/10070.Chris_Miller","average_rating":4.38,"ratings_count":41504,"text_reviews_count":3762}},"average_rating":4.41,"ratings_count":39818,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/61420096-choosing-to-run","title":"Choosing to Run: A Memoir","title_without_series":"Choosing to Run: A Memoir","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673265751l/61420096._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673265751l/61420096._SX98_.jpg","description":"Featuring both the story of an historic, unforgettable win and insight into the life of an indelible champion, Choosing to Run is a truly inspirational memoir from Boston Marathon winner and Olympian Des Linden, sharing her personal story and what motivates her to keep showing up.<br /><br />When Des woke up on April 16, 2018, the morning of the Boston Marathon, it was 39 degrees and raining, with high, gusty winds. The weather didnt bother her. In fact, she thought it might be a blessing. She was far from peak formrecovering from illness and questioning her running futureand didnt expect much of herself that day.<br /><br />But as she ticked off mile after mile in the brutal conditions, passing familiar landmarks on the course she knew by heart, something shifted. Opportunity unexpectedly presented itself. Des tapped into her inner strength and remembered all of the reasons she loved to race.<br /><br />Coming off Heartbreak Hill at Mile 22, Des took the lead and never relinquished it, becoming the 2018 Boston Marathon champion and the first American woman to win the race in thirty-three years.<br /><br />Her career has always been defined by tenacity and an independent spirit, stretching back to her first competitive race in San Diego, when she beat better-outfitted, more experienced kids. Des was a two-time All-American at Arizona State University, and as her collegiate years wound down, she decided she wasnt done with the sport. Des gambled on herself and moved to Michigan to give professional running a try. As she rose through the elite ranks, she became increasingly determined to do things her way in an industry often bound by the status quo.<br /><br />In her first book, readers will learn the story behind that the way Des trains, the way she thinks, her relationships with other great runners of her generation, and how much she values her family and friends. Theyll read about her deep connection to the most famous marathon in the world, her two very different Olympic experiences, and how she defined new goals and set a world record at the 50-kilometer distance.<br /><br />Most of all, theyll learn what makes her get up and run every day.","num_pages":"","authors":{"author":{"id":22522131,"name":"Des Linden","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/22522131.Des_Linden","average_rating":4.25,"ratings_count":12293,"text_reviews_count":1259}},"average_rating":4.25,"ratings_count":12293,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/75665850-clear-thinking","title":"Clear Thinking: Turning Ordinary Moments into Extraordinary Results","title_without_series":"Clear Thinking: Turning Ordinary Moments into Extraordinary Results","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350454l/75665850._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350454l/75665850._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":7871969,"name":"Shane Parrish","role":"","image_url":"https://images.gr-assets.com/authors/1686056002p5/7871969.jpg","small_image_url":"https://images.gr-assets.com/authors/1686056002p2/7871969.jpg","link":"https://www.goodreads.com/author/show/7871969.Shane_Parrish","average_rating":4.12,"ratings_count":22352,"text_reviews_count":1831}},"average_rating":4.17,"ratings_count":9624,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/41022133-colorless-tsukuru-tazaki-and-his-years-of-pilgrimage","title":"Colorless Tsukuru Tazaki and His Years of Pilgrimage","title_without_series":"Colorless Tsukuru Tazaki and His Years of Pilgrimage","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1533141634l/41022133._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1533141634l/41022133._SX98_.jpg","description":"<b>INSTANT #1 <i>NEW YORK TIMES</i> BESTSELLER  One of the most revered voices in literature today gives us a story of love, friendship, and heartbreak for the ages.<br /><br />Mesmerizing, immersive, hallucinogenic.<i>Entertainment Weekly</i></b><br /><br /><i>Colorless Tsukuru Tazaki and His Years of Pilgrimage</i> is the remarkable story of a young man haunted by a great loss; of dreams and nightmares that have unintended consequences for the world around us; and of a journey into the past that is necessary to mend the present.<br /><br /><b>ONE OF THE BEST BOOKS OF THE YEAR: The New York Times Book Review, The Washington Post, Financial Times, St. Louis Post-Dispatch, Slate, Mother Jones, The Daily Beast, BookPage</b>","num_pages":308,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4190455,"text_reviews_count":359110}},"average_rating":3.87,"ratings_count":201570,"publication_day":12,"publication_month":8,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/6751.Consider_the_Lobster_and_Other_Essays","title":"Consider the Lobster and Other Essays","title_without_series":"Consider the Lobster and Other Essays","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"Do lobsters feel pain? Did Franz Kafka have a funny bone? What is John Updike's deal, anyway? And what happens when adult video starlets meet their fans in person? David Foster Wallace answers these questions and more in essays that are also enthralling narrative adventures. Whether covering the three-ring circus of a vicious presidential race, plunging into the wars between dictionary writers, or confronting the World's Largest Lobster Cooker at the annual Maine Lobster Festival, Wallace projects a quality of thought that is uniquely his and a voice as powerful and distinct as any in American letters.<br /><br />Contains: \\"Big Red Son,\\" \\"Certainly the End of Something or Other, One Would Sort of Have to Think,\\" \\"Some Remarks on Kafka's Funniness from Which Probably Not Enough Has Been Removed,\\" \\"Authority and American Usage,\\" \\"The View from Mrs. Thompson's,\\" \\"How Tracy Austin Broke My Heart,\\" \\"Up, Simba,\\" \\"Consider the Lobster,\\" \\"Joseph Frank's Dostoevsky\\" and \\"Host.\\"","num_pages":343,"authors":{"author":{"id":4339,"name":"David Foster Wallace","role":"","image_url":"https://images.gr-assets.com/authors/1615507112p5/4339.jpg","small_image_url":"https://images.gr-assets.com/authors/1615507112p2/4339.jpg","link":"https://www.goodreads.com/author/show/4339.David_Foster_Wallace","average_rating":4.11,"ratings_count":406932,"text_reviews_count":41287}},"average_rating":4.18,"ratings_count":53834,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55757377-covered-calls-for-beginners","title":"Covered Calls for Beginners: A Risk-Free Way to Collect \\"Rental Income\\" Every Single Month on Stocks You Already Own (Options Trading for Beginners Book 1)","title_without_series":"Covered Calls for Beginners: A Risk-Free Way to Collect \\"Rental Income\\" Every Single Month on Stocks You Already Own","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"","num_pages":"","authors":{"author":{"id":20400935,"name":"Freeman Publications","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/20400935.Freeman_Publications","average_rating":4.2,"ratings_count":2625,"text_reviews_count":236}},"average_rating":4.24,"ratings_count":333,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25451264-death-s-end","title":"Death's End (Remembrance of Earths Past, #3)","title_without_series":"Death's End","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1430330507l/25451264._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1430330507l/25451264._SX98_.jpg","description":"With The Three-Body Problem, English-speaking readers got their first chance to experience the multiple-award-winning and bestselling Three-Body Trilogy by China's most beloved science fiction author, Cixin Liu. Three-Body was released to great acclaim including coverage in The New York Times and The Wall Street Journal. It was also named a finalist for the Nebula Award, making it the first translated novel to be nominated for a major SF award since Italo Calvino's Invisible Cities in 1976.<br /><br />Now this epic trilogy concludes with Death's End. Half a century after the Doomsday Battle, the uneasy balance of Dark Forest Deterrence keeps the Trisolaran invaders at bay. Earth enjoys unprecedented prosperity due to the infusion of Trisolaran knowledge. With human science advancing daily and the Trisolarans adopting Earth culture, it seems that the two civilizations will soon be able to co-exist peacefully as equals without the terrible threat of mutually assured annihilation. But the peace has also made humanity complacent.<br /><br />Cheng Xin, an aerospace engineer from the early 21st century, awakens from hibernation in this new age. She brings with her knowledge of a long-forgotten program dating from the beginning of the Trisolar Crisis, and her very presence may upset the delicate balance between two worlds. Will humanity reach for the stars or die in its cradle?","num_pages":604,"authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":932269,"text_reviews_count":88046}},"average_rating":4.41,"ratings_count":168546,"publication_day":20,"publication_month":9,"publication_year":2016},{"link":"https://www.goodreads.com/book/show/6617037-debt","title":"Debt: The First 5,000 Years","title_without_series":"Debt: The First 5,000 Years","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1728517587l/6617037._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1728517587l/6617037._SX98_.jpg","description":"<b>Before there was money, there was debt</b>.<br /><br />Every economics textbook says the same thing: Money was invented to replace onerous and complicated barter systemsto relieve ancient people from having to haul their goods to market. The problem with this version of history? Theres not a shred of evidence to support it.<br /><br />Here anthropologist David Graeber presents a stunning reversal of conventional wisdom. He shows that for more than 5,000 years, since the beginnings of the first agrarian empires, humans have used elaborate credit systems to buy and sell goodsthat is, long before the invention of coins or cash. It is in this era, Graeber argues, that we also first encounter a society divided into debtors and creditors. <br /><br />Graeber shows that arguments about debt and debt forgiveness have been at the center of political debates from Italy to China, as well as sparking innumerable insurrections. He also brilliantly demonstrates that the language of the ancient works of law and religion(words like guilt, sin, and redemption) derive in large part from ancient debates about debt, and shape even our most basic ideas of right and wrong. We are still fighting these battles today without knowing it.<br /><br /><i>Debt: The First 5,000 Years </i>is a fascinating chronicle of this little known historyas well as how it has defined human history, and what it means for the credit crisis of the present day and the future of our economy.","num_pages":534,"authors":{"author":{"id":29101,"name":"David Graeber","role":"","image_url":"https://images.gr-assets.com/authors/1479657149p5/29101.jpg","small_image_url":"https://images.gr-assets.com/authors/1479657149p2/29101.jpg","link":"https://www.goodreads.com/author/show/29101.David_Graeber","average_rating":4.11,"ratings_count":103992,"text_reviews_count":13975}},"average_rating":4.21,"ratings_count":26569,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50927537-deceiving-the-sky","title":"Deceiving the Sky: Inside Communist China's Drive for Global Supremacy","title_without_series":"Deceiving the Sky: Inside Communist China's Drive for Global Supremacy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"The United States' approach to China since the Communist regime in Beijing began the period of reform and opening in the 1980s was based on a promise that trade and engagement with China would result in a peaceful, democratic state.<br /><br />Forty years later the hope of producing a benign People's Republic of China utterly failed. The Communist Party of China deceived the West into believing that the its system and the Party-ruled People's Liberation Army were peaceful and posed no threat. In fact, these misguided policies produced the emergence of a 21st Century Evil Empire even more dangerous than a Cold War version in the Soviet Union.<br /><br />Successive American presidential administrations were fooled by ill-advised pro-China policymakers, intelligence analysts and business leaders who facilitated the rise not of a peaceful China but a threatening and expansionist nuclear-armed communist dictatorship not focused on a single overriding strategic objective: Weakening and destroying the United States of America.<br /><br />Defeating the United States is the first step for China's current rulers in achieving global supremacy under a new world order based an ideology of Communism with Chinese characteristics.<br /><br />The process included technology theft of American companies that took place on a massive scale through cyber theft and unfair trade practices. The losses directly supported in the largest and most significant buildup of the Chinese military that now directly threatens American and allied interests around the world. The military threat is only half the danger as China aggressively pursues regional and international control using a variety of non-military forces, including economic, cyber and space warfare and large-scale influence operations.<br /><br /><i>Deceiving the Sky: Inside Communist China's Drive for Global Supremacy</i> details the failure to understand the nature and activities of the dangers posed by China and what the United States can do in taking needed steps to counter the threats.","num_pages":"","authors":{"author":{"id":86575,"name":"Bill Gertz","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/86575.Bill_Gertz","average_rating":3.61,"ratings_count":741,"text_reviews_count":94}},"average_rating":3.96,"ratings_count":225,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25744928-deep-work","title":"Deep Work: Rules for Focused Success in a Distracted World","title_without_series":"Deep Work: Rules for Focused Success in a Distracted World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1447957962l/25744928._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1447957962l/25744928._SX98_.jpg","description":"<b>One of the most valuable skills in our economy is becoming increasingly rare. If you master this skill, you'll achieve extraordinary results.</b><br /><br />Deep work is the ability to focus without distraction on a cognitively demanding task. It's a skill that allows you to quickly master complicated information and produce better results in less time. Deep work will make you better at what you do and provide the sense of true fulfillment that comes from craftsmanship. In short, deep work is like a super power in our increasingly competitive twenty-first century economy. And yet, most people have lost the ability to go deep-spending their days instead in a frantic blur of e-mail and social media, not even realizing there's a better way.<br /><br />In <i>Deep Work</i>, author and professor Cal Newport flips the narrative on impact in a connected age. Instead of arguing distraction is bad, he instead celebrates the power of its opposite. Dividing this book into two parts, he first makes the case that in almost any profession, cultivating a deep work ethic will produce massive benefits. He then presents a rigorous training regimen, presented as a series of four \\"rules,\\" for transforming your mind and habits to support this skill.<br /><br />A mix of cultural criticism and actionable advice, <i>Deep Work</i> takes the reader on a journey through memorable stories-from Carl Jung building a stone tower in the woods to focus his mind, to a social media pioneer buying a round-trip business class ticket to Tokyo to write a book free from distraction in the air-and no-nonsense advice, such as the claim that most serious professionals should quit social media and that you should practice being bored. <i>Deep Work</i> is an indispensable guide to anyone seeking focused success in a distracted world.","num_pages":296,"authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":378174,"text_reviews_count":34170}},"average_rating":4.16,"ratings_count":186729,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/11125.Digital_Fortress","title":"Digital Fortress","title_without_series":"Digital Fortress","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360095966l/11125._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360095966l/11125._SX98_.jpg","description":"<i>This an alternate cover for</i> <a href=\\"https://www.goodreads.com/book/show/44775909.9780552151696\\" title=\\"9780552151696\\" rel=\\"nofollow noopener\\">9780552151696</a> <br /><br />When the NSA's invincible code-breaking machine encounters a mysterious code it cannot break, the agency calls its head cryptographer, Susan Fletcher, a brilliant and beautiful mathematician. What she uncovers sends shock waves through the corridors of power. The NSA is being held hostage...not by guns or bombs, but by a code so ingeniously complex that if released it would cripple U.S. intelligence.<br /><br />Caught in an accelerating tempest of secrecy and lies, Susan Fletcher battles to save the agency she believes in. Betrayed on all sides, she finds herself fighting not only for her country but for her life, and in the end, for the life of the man she loves.<br /><br />From the underground hallways of power to the skyscrapers of Tokyo to the towering cathedrals of Spain, a desperate race unfolds. It is a battle for survival--a crucial bid to destroy a creation of inconceivable genius...an impregnable code-writing formula that threatens to obliterate the post-cold war balance of power. Forever.","num_pages":510,"authors":{"author":{"id":630,"name":"Dan    Brown","role":"","image_url":"https://images.gr-assets.com/authors/1751545491p5/630.jpg","small_image_url":"https://images.gr-assets.com/authors/1751545491p2/630.jpg","link":"https://www.goodreads.com/author/show/630.Dan_Brown","average_rating":3.9,"ratings_count":9038797,"text_reviews_count":231172}},"average_rating":3.7,"ratings_count":663083,"publication_day":"","publication_month":"","publication_year":2004},{"link":"https://www.goodreads.com/book/show/40672036-digital-minimalism","title":"Digital Minimalism: Choosing a Focused Life in a Noisy World","title_without_series":"Digital Minimalism: Choosing a Focused Life in a Noisy World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1549433350l/40672036._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1549433350l/40672036._SX98_.jpg","description":"Minimalism is the art of knowing how much is just enough. Digital minimalism applies this idea to our personal technology. It's the key to living a focused life in an increasingly noisy world.<br /><br />In this timely and enlightening book, the bestselling author of Deep Work introduces a philosophy for technology use that has already improved countless lives.<br /><br />Digital minimalists are all around us. They're the calm, happy people who can hold long conversations without furtive glances at their phones. They can get lost in a good book, a woodworking project, or a leisurely morning run. They can have fun with friends and family without the obsessive urge to document the experience. They stay informed about the news of the day, but don't feel overwhelmed by it. They don't experience \\"fear of missing out\\" because they already know which activities provide them meaning and satisfaction.<br /><br />Now, Newport gives us a name for this quiet movement, and makes a persuasive case for its urgency in our tech-saturated world. Common sense tips, like turning off notifications, or occasional rituals like observing a digital sabbath, don't go far enough in helping us take back control of our technological lives, and attempts to unplug completely are complicated by the demands of family, friends and work. What we need instead is a thoughtful method to decide what tools to use, for what purposes, and under what conditions.<br /><br />Drawing on a diverse array of real-life examples, from Amish farmers to harried parents to Silicon Valley programmers, Newport identifies the common practices of digital minimalists and the ideas that underpin them. He shows how digital minimalists are rethinking their relationship to social media, rediscovering the pleasures of the offline world, and reconnecting with their inner selves through regular periods of solitude. He then shares strategies for integrating these practices into your life, starting with a thirty-day \\"digital declutter\\" process that has already helped thousands feel less overwhelmed and more in control.<br /><br />Technology is intrinsically neither good nor bad. The key is using it to support your goals and values, rather than letting it use you. This book shows the way.","num_pages":302,"authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":378174,"text_reviews_count":34170}},"average_rating":4.05,"ratings_count":94356,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55723020-dopamine-nation","title":"Dopamine Nation: Finding Balance in the Age of Indulgence","title_without_series":"Dopamine Nation: Finding Balance in the Age of Indulgence","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629679336l/55723020._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629679336l/55723020._SX98_.jpg","description":"This book is about pleasure. It's also about pain. Most important, it's about how to find the delicate balance between the two, and why now more than ever finding balance is essential. We're living in a time of unprecedented access to high-reward, high-dopamine stimuli: drugs, food, news, gambling, shopping, gaming, texting, sexting, Facebooking, Instagramming, YouTubing, tweeting... The increased numbers, variety, and potency is staggering. The smartphone is the modern-day hypodermic needle, delivering digital dopamine 24/7 for a wired generation. As such we've all become vulnerable to compulsive overconsumption.<br /><br />In <i>Dopamine Nation</i>, Dr. Anna Lembke, psychiatrist and author, explores the exciting new scientific discoveries that explain why the relentless pursuit of pleasure leads to pain...and what to do about it. Condensing complex neuroscience into easy-to-understand metaphors, Lembke illustrates how finding contentment and connectedness means keeping dopamine in check. The lived experiences of her patients are the gripping fabric of her narrative. Their riveting stories of suffering and redemption give us all hope for managing our consumption and transforming our lives. In essence, <i>Dopamine Nation </i>shows that the secret to finding balance is combining the science of desire with the wisdom of recovery.<br /><br /><b>\\"Brilliant... riveting, scary, cogent, and cleverly argued.\\"--Beth Macy, author of <i>Dopesick</i></b><br /><br /><br />INSTANT NEW YORK TIMES and LOS ANGELES TIMES BESTSELLER<br />Brilliant riveting, scary, cogent, and cleverly argued.Beth Macy, author of Dopesick<br />As heard on Fresh Air","num_pages":304,"authors":{"author":{"id":15190376,"name":"Anna Lembke","role":"","image_url":"https://images.gr-assets.com/authors/1642883127p5/15190376.jpg","small_image_url":"https://images.gr-assets.com/authors/1642883127p2/15190376.jpg","link":"https://www.goodreads.com/author/show/15190376.Anna_Lembke","average_rating":3.89,"ratings_count":82623,"text_reviews_count":7126}},"average_rating":3.89,"ratings_count":81100,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/122765395-elon-musk","title":"Elon Musk","title_without_series":"Elon Musk","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1692288251l/122765395._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1692288251l/122765395._SX98_.jpg","description":"<b>From the author of <i>Steve Jobs</i> and other bestselling biographies, this is the astonishingly intimate story of the most fascinating and controversial innovator of our eraa rule-breaking visionary who helped to lead the world into the era of electric vehicles, private space exploration, and artificial intelligence. Oh, and took over Twitter.</b><br /><br />When Elon Musk was a kid in South Africa, he was regularly beaten by bullies. One day a group pushed him down some concrete steps and kicked him until his face was a swollen ball of flesh. He was in the hospital for a week. But the physical scars were minor compared to the emotional ones inflicted by his father, an engineer, rogue, and charismatic fantasist.<br /><br />His fathers impact on his psyche would linger. He developed into a tough yet vulnerable man-child, prone to abrupt Jekyll-and-Hyde mood swings, with an exceedingly high tolerance for risk, a craving for drama, an epic sense of mission, and a maniacal intensity that was callous and at times destructive.<br /><br />At the beginning of 2022after a year marked by SpaceX launching thirty-one rockets into orbit, Tesla selling a million cars, and him becoming the richest man on earthMusk spoke ruefully about his compulsion to stir up dramas. I need to shift my mindset away from being in crisis mode, which it has been for about fourteen years now, or arguably most of my life, he said.<br /><br />It was a wistful comment, not a New Years resolution. Even as he said it, he was secretly buying up shares of Twitter, the worlds ultimate playground. Over the years, whenever he was in a dark place, his mind went back to being bullied on the playground. Now he had the chance to own the playground.<br /><br />For two years, Isaacson shadowed Musk, attended his meetings, walked his factories with him, and spent hours interviewing him, his family, friends, coworkers, and adversaries. The result is the revealing inside story, filled with amazing tales of triumphs and turmoil, that addresses the are the demons that drive Musk also what it takes to drive innovation and progress?","num_pages":688,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2011167,"text_reviews_count":54288}},"average_rating":4.33,"ratings_count":74312,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60690050-engineering-in-plain-sight","title":"Engineering in Plain Sight: An Illustrated Field Guide to the Constructed Environment","title_without_series":"Engineering in Plain Sight: An Illustrated Field Guide to the Constructed Environment","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1648243628l/60690050._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1648243628l/60690050._SX98_.jpg","description":"Engineering in Plain Sight is a beautifully illustrated field guide to the infrastructure around us.<br /><br />Engineering in Plain Sight extends the field guide genre from natural phenomena to human-made structures, making them approachable and understandable to non-engineers. It transforms readers' perspectives of the built environment, converting the act of looking at infrastructure from a mundane inevitability into an everyday diversion and joy. <br /><br />Each section of this accessible, informative book features colorful illustrations revealing the fascinating details of how the human-made world works. An ideal road trip companion, this book offers a fresh perspective on the parts of the environment that often blend into the background. Readers will learn to identify characteristics of the electrical grid, roadways, railways, bridges, tunnels, waterways, and more. Engineering in Plain Sight inspires curiosity, interest, and engagement in how the infrastructure around us is designed and constructed.","num_pages":251,"authors":{"author":{"id":22319964,"name":"Grady Hillhouse","role":"","image_url":"https://images.gr-assets.com/authors/1649089101p5/22319964.jpg","small_image_url":"https://images.gr-assets.com/authors/1649089101p2/22319964.jpg","link":"https://www.goodreads.com/author/show/22319964.Grady_Hillhouse","average_rating":4.21,"ratings_count":784,"text_reviews_count":94}},"average_rating":4.21,"ratings_count":784,"publication_day":1,"publication_month":11,"publication_year":2022},{"link":"https://www.goodreads.com/book/show/43319933-every-tool-s-a-hammer","title":"Every Tool's a Hammer: Life Is What You Make It","title_without_series":"Every Tool's a Hammer: Life Is What You Make It","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1555856209l/43319933._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1555856209l/43319933._SX98_.jpg","description":"<b>In this <i>New York Times</i> bestselling imperative how-to for creativity (Nick Offerman), Adam Savage</b><b>star of Discovery Channels <i>Mythbusters</i>shares his golden rules of creativity, from finding inspiration to following through and successfully making your idea a reality.</b><br /><br /><i>Every Tool</i><i>s a Hammer </i>is a chronicle of my life as a maker. Its an exploration of making, but its also a permission slip of sorts from me to you. Permission to grab hold of the things youre interested in, that fascinate you, and to dive deeper into them to see where they lead you.<br /> <br />Through stories from forty-plus years of making and molding, building and breaking, along with the lessons I learned along the way, this book is meant to be a toolbox of problem solving, complete with a shops worth of notes on the tools, techniques, and materials that I use most often. Things like: <b>In Every Tool There Is a Hammer</b>dont wait until everything is perfect to begin a project, and if you dont have the exact right tool for a task, just use whatevers handy; <b>Increase Your Loose Tolerance</b>making is messy and filled with screwups, but thats okay, as creativity is a path with twists and turns and not a straight line to be found; <b>Use More Cooling Fluid</b>it prolongs the life of blades and bits, and it prevents tool failure, but beyond that its a reminder to slow down and reduce the friction in your work and relationships; <b>Screw Before You Glue</b>mechanical fasteners allow you to change and modify a project while glue is forever but sometimes you just need the right glue, so I dig into which ones will do the job with the least harm and best effects.<br /> <br />This toolbox also includes lessons from many other incredible makers and creators, including: Jamie Hyneman, Nick Offerman, Pixar director Andrew Stanton, Oscar-winner Guillermo del Toro, artist Tom Sachs, and chef Traci Des Jardins. And if everything goes well, we will hopefully save you a few mistakes (and maybe fingers) as well as help you turn your curiosities into creations.<br /> <br />I hope this book serves as creative rocket fuel (Ed Helms) to build, make, invent, explore, andmost of allenjoy the thrills of being a creator.","num_pages":320,"authors":{"author":{"id":3352714,"name":"Adam Savage","role":"","image_url":"https://images.gr-assets.com/authors/1412809454p5/3352714.jpg","small_image_url":"https://images.gr-assets.com/authors/1412809454p2/3352714.jpg","link":"https://www.goodreads.com/author/show/3352714.Adam_Savage","average_rating":4.16,"ratings_count":11464,"text_reviews_count":1201}},"average_rating":4.18,"ratings_count":10699,"publication_day":7,"publication_month":5,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/43808723-everything-is-f-cked","title":"Everything Is F*cked: A Book About Hope","title_without_series":"Everything Is F*cked: A Book About Hope","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550685003l/43808723._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550685003l/43808723._SX98_.jpg","description":"<b>From the author of the international mega-bestseller The Subtle Art of Not Giving A F*ck comes a counterintuitive guide to the problems of hope. </b><br /><br />We live in an interesting time. Materially, everything is the best its ever beenwe are freer, healthier and wealthier than any people in human history. Yet, somehow everything seems to be irreparably and horribly f*ckedthe planet is warming, governments are failing, economies are collapsing, and everyone is perpetually offended on Twitter. At this moment in history, when we have access to technology, education and communication our ancestors couldnt even dream of, so many of us come back to an overriding feeling of hopelessness.<br /><br />Whats going on? If anyone can put a name to our current malaise and help fix it, its Mark Manson. In 2016, Manson published <i>The Subtle Art of Not Giving A F*ck</i>, a book that brilliantly gave shape to the ever-present, low-level hum of anxiety that permeates modern living. He showed us that technology had made it too easy to care about the wrong things, that our culture had convinced us that the world owed us something when it didntand worst of all, that our modern and maddening urge to always find happiness only served to make us unhappier. Instead, the subtle art of that title turned out to be a bold challenge: to choose your struggle; to narrow and focus and find the pain you want to sustain. The result was a book that became an international phenomenon, selling millions of copies worldwide while becoming the #1 bestseller in 13 different countries.<br /><br />Now, in <i>Everthing Is F*cked</i>, Manson turns his gaze from the inevitable flaws within each individual self to the endless calamities taking place in the world around us. Drawing from the pool of psychological research on these topics, as well as the timeless wisdom of philosophers such as Plato, Nietzsche, and Tom Waits, he dissects religion and politics and the uncomfortable ways they have come to resemble one another. He looks at our relationships with money, entertainment and the internet, and how too much of a good thing can psychologically eat us alive. He openly defies our definitions of faith, happiness, freedomand even of hope itself.<br /><br />With his usual mix of erudition and where-the-f*ck-did-that-come-from humor, Manson takes us by the collar and challenges us to be more honest with ourselves and connected with the world in ways we probably havent considered before. Its another counterintuitive romp through the pain in our hearts and the stress of our soul. One of the great modern writers has produced another book that will set the agenda for years to come.","num_pages":288,"authors":{"author":{"id":8529755,"name":"Mark Manson","role":"","image_url":"https://images.gr-assets.com/authors/1410365708p5/8529755.jpg","small_image_url":"https://images.gr-assets.com/authors/1410365708p2/8529755.jpg","link":"https://www.goodreads.com/author/show/8529755.Mark_Manson","average_rating":3.88,"ratings_count":1579298,"text_reviews_count":90533}},"average_rating":3.67,"ratings_count":96618,"publication_day":14,"publication_month":5,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/34890015-factfulness","title":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","title_without_series":"Factfulness: Ten Reasons We're Wrong About the World  and Why Things Are Better Than You Think","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1544963815l/34890015._SX98_.jpg","description":"<b><i>Factfulness:</i> The stress-reducing habit of only carrying opinions for which you have strong supporting facts.</b><br /><br />When asked simple questions about global trends<i>what percentage of the worlds population live in poverty; why the worlds population is increasing; how many girls finish school</i>we systematically get the answers wrong. So wrong that a chimpanzee choosing answers at random will consistently outguess teachers, journalists, Nobel laureates, and investment bankers.<br /><br />In <i>Factfulness</i>, Professor of International Health and global TED phenomenon Hans Rosling, together with his two long-time collaborators, Anna and Ola, offers <b>a radical new explanation of why this happens</b>. They reveal <b>the ten instincts that distort our perspective</b>from our tendency to divide the world into two camps (usually some version of <i>us</i> and <i>them</i>) to the way we consume media (where fear rules) to how we perceive progress (believing that most things are getting worse).<br /><br />Our problem is that we dont know what we dont know, and even our guesses are informed by unconscious and predictable biases.<br /><br /><b>It turns out that the world, for all its imperfections, is in a much better state than we might think.</b> That doesnt mean there arent real concerns. But when we worry about everything all the time instead of embracing a worldview based on facts, we can lose our ability to focus on the things that threaten us most.<br /><br />Inspiring and revelatory, filled with lively anecdotes and moving stories, <b><i>Factfulness </i>is an urgent and essential book that will change the way you see the world and empower you to respond to the crises and opportunities of the future. </b>","num_pages":342,"authors":{"author":{"id":2790706,"name":"Hans Rosling","role":"","image_url":"https://images.gr-assets.com/authors/1486521286p5/2790706.jpg","small_image_url":"https://images.gr-assets.com/authors/1486521286p2/2790706.jpg","link":"https://www.goodreads.com/author/show/2790706.Hans_Rosling","average_rating":4.35,"ratings_count":203926,"text_reviews_count":16211}},"average_rating":4.36,"ratings_count":200548,"publication_day":3,"publication_month":4,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/33358206-fifty-inventions-that-shaped-the-modern-economy","title":"Fifty Inventions That Shaped the Modern Economy","title_without_series":"Fifty Inventions That Shaped the Modern Economy","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1491703991l/33358206._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1491703991l/33358206._SX98_.jpg","description":"<b>A lively history seen through the fifty inventions that shaped it most profoundly, by the bestselling author of <i>The Undercover Economist</i> and <i>Messy.</i></b><br /> <br />Who thought up paper money? What was the secret element that made the Gutenberg printing press possible? And what is the connection between <i>The Da Vinci Code</i> and the collapse of Lehman Brothers? <br /><br /><i>Fifty Inventions That Shaped the Modern Economy</i> paints an epic picture of change in an intimate way by telling the stories of the tools, people, and ideas that had far-reaching consequences for all of us. From the plough to artificial intelligence, from Gillettes disposable razor to IKEAs Billy bookcase, bestselling author and <i>Financial Times</i> columnist Tim Harford recounts each inventions own curious, surprising, and memorable story. <br /><br />Invention by invention, Harford reflects on how we got here and where we might go next. He lays bare often unexpected connections: how the bar code undermined family corner stores, and why the gramophone widened inequality. In the process, he introduces characters who developed some of these inventions, profited from them, and were ruined by them, as he traces the principles that helped explain their transformative effects. The result is a wise and witty book of history, economics, and biography.","num_pages":336,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60509,"text_reviews_count":4325}},"average_rating":4.06,"ratings_count":4193,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/24724602-flash-boys","title":"Flash Boys: A Wall Street Revolt","title_without_series":"Flash Boys: A Wall Street Revolt","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1426093936l/24724602._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1426093936l/24724602._SX98_.jpg","description":"<strong>#1 <em>New York Times</em> Bestseller  With a new Afterword</strong><br /><br />In Michael Lewis's game-changing bestseller, a small group of Wall Street iconoclasts realize that the U.S. stock market has been rigged for the benefit of insiders. They band togethersome of them walking away from seven-figure salariesto investigate, expose, and reform the insidious new ways that Wall Street generates profits. If you have any contact with the market, even a retirement account, this story is happening to you.","num_pages":304,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":4.14,"ratings_count":90123,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/177058906-fluke","title":"Fluke: Chance, Chaos, and Why Everything We Do Matters","title_without_series":"Fluke: Chance, Chaos, and Why Everything We Do Matters","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"","num_pages":"","authors":{"author":{"id":15732035,"name":"Brian Klaas","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/15732035.Brian_Klaas","average_rating":4.12,"ratings_count":7806,"text_reviews_count":967}},"average_rating":4.07,"ratings_count":3760,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/38315.Fooled_by_Randomness","title":"Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets","title_without_series":"Fooled by Randomness: The Hidden Role of Chance in Life and in the Markets","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b><i>Fooled by Randomness </i>is a standalone book in Nassim Nicholas Talebs landmark Incerto series, an investigation of opacity, luck, uncertainty, probability, human error, risk, and decision-making in a world we dont understand. The other books in the series are <i>The Black Swan, Antifragile,</i>and <i>The Bed of Procrustes</i>.</b>","num_pages":"","authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":306327,"text_reviews_count":21059}},"average_rating":4.08,"ratings_count":70939,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54785515-four-thousand-weeks","title":"Four Thousand Weeks: Time Management for Mortals","title_without_series":"Four Thousand Weeks: Time Management for Mortals","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627425434l/54785515._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627425434l/54785515._SX98_.jpg","description":"<b>The average human lifespan is absurdly, insultingly brief. Assuming you live to be eighty, you have just over four thousand weeks.</b> <br /><br />Nobody needs to be told there isnt enough time. Were obsessed with our lengthening to-do lists, overfilled inboxes, work-life balance, and ceaseless battle against distraction; were deluged with advice on becoming more productive and efficient and life hacks to optimize our days. But such techniques often end up making things worse. The sense of anxious hurry grows more intense, and still the most meaningful parts of life seem to lie just beyond the horizon. Still, we rarely make the connection between our daily struggles with time and the ultimate time management problem: the challenge of how best to use our four thousand weeks. <br /><br />Drawing on the insights of both ancient and contemporary philosophers, psychologists, and spiritual teachers, Oliver Burkeman delivers an entertaining, humorous, practical, and ultimately profound guide to time and time management. Rejecting the futile modern obsession with getting everything done, <i>Four Thousand Weeks </i>introduces readers to tools for constructing a meaningful life by embracing finitude, showing that many of the unhelpful ways weve come to think about time arent inescapable, unchanging truths, but choices weve made as individuals and as a societyand that we could do things differently.","num_pages":245,"authors":{"author":{"id":4384050,"name":"Oliver Burkeman","role":"","image_url":"https://images.gr-assets.com/authors/1394595901p5/4384050.jpg","small_image_url":"https://images.gr-assets.com/authors/1394595901p2/4384050.jpg","link":"https://www.goodreads.com/author/show/4384050.Oliver_Burkeman","average_rating":4.17,"ratings_count":156846,"text_reviews_count":15877}},"average_rating":4.18,"ratings_count":123331,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1022022.Freakonomics","title":"Freakonomics: A Rogue Economist Explores the Hidden Side of Everything","title_without_series":"Freakonomics: A Rogue Economist Explores the Hidden Side of Everything","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356025048l/1022022._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356025048l/1022022._SX98_.jpg","description":"Which is more dangerous, a gun or a swimming pool? What do schoolteachers and sumo wrestlers have in common? Why do drug dealers still live with their moms? How much do parents really matter? What kind of impact did Roe v. Wade have on violent crime? Freakonomics will literally redefine the way we view the modern world.<br /><br />These may not sound like typical questions for an economist to ask. But Steven D. Levitt is not a typical economist. He is a much heralded scholar who studies the stuff and riddles of everyday life -- from cheating and crime to sports and child rearing -- and whose conclusions regularly turn the conventional wisdom on its head. He usually begins with a mountain of data and a simple, unasked question. Some of these questions concern life-and-death issues; others have an admittedly freakish quality. Thus the new field of study contained in this book: freakonomics.<br /><br />Through forceful storytelling and wry insight, Levitt and co-author Stephen J. Dubner show that economics is, at root, the study of incentives -- how people get what they want, or need, especially when other people want or need the same thing. In Freakonomics, they set out to explore the hidden side of ... well, everything. The inner workings of a crack gang. The truth about real-estate agents. The myths of campaign finance. The telltale marks of a cheating schoolteacher. The secrets of the Ku Klux Klan.<br /><br />What unites all these stories is a belief that the modern world, despite a surfeit of obfuscation, complication, and downright deceit, is not impenetrable, is not unknowable, and -- if the right questions are asked -- is even more intriguing than we think. All it takes is a new way of looking. Steven Levitt, through devilishly clever and clear-eyed thinking, shows how to see through all the clutter.<br /><br />Freakonomics establishes this unconventional premise: If morality represents how we would like the world to work, then economics represents how it actually does work. It is true that readers of this book will be armed with enough riddles and stories to last a thousand cocktail parties. But Freakonomics can provide more than that. It will literally redefine the way we view the modern world.","num_pages":315,"authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1101273,"text_reviews_count":30692}},"average_rating":4.01,"ratings_count":893735,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13259270-free-will","title":"Free Will","title_without_series":"Free Will","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1532072045l/13259270._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1532072045l/13259270._SX98_.jpg","description":"Belief in free will touches nearly everything that human beings value. It is difficult to think about law, politics, religion, public policy, intimate relationships, moralityas well as feelings of remorse or personal achievementwithout first imagining that every person is the true source of his or her thoughts and actions. And yet the facts tell us that free will is an illusion.<br /><br />In this enlightening book, Sam Harris argues that this truth about the human mind does not undermine morality or diminish the importance of social and political freedom, but it can and should change the way we think about some of the most important questions in life.","num_pages":96,"authors":{"author":{"id":16593,"name":"Sam Harris","role":"","image_url":"https://images.gr-assets.com/authors/1274184541p5/16593.jpg","small_image_url":"https://images.gr-assets.com/authors/1274184541p2/16593.jpg","link":"https://www.goodreads.com/author/show/16593.Sam_Harris","average_rating":3.92,"ratings_count":237001,"text_reviews_count":15409}},"average_rating":3.86,"ratings_count":37831,"publication_day":6,"publication_month":3,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/16158498-give-and-take","title":"Give and Take: A Revolutionary Approach to Success","title_without_series":"Give and Take: A Revolutionary Approach to Success","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356136579l/16158498._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1356136579l/16158498._SX98_.jpg","description":"<i>Give and Take</i> highlights what effective networking, collaboration, influence, negotiation, and leadership skills have in common.<br /><br />For generations, we have focused on the individual drivers of success: passion, hard work, talent, and luck. But today, success is increasingly dependent on how we interact with others. It turns out that at work, most people operate as either takers, matchers, or givers. Whereas takers strive to get as much as possible from others and matchers aim to trade evenly, givers are the rare breed of people who contribute to others without expecting anything in return. <br /><br />Using his own pioneering research as Wharton's youngest tenured professor, Grant shows that these styles have a surprising impact on success. Although some givers get exploited and burn out, the rest achieve extraordinary results across a wide range of industries. Combining cutting-edge evidence with captivating stories, this landmark book shows how one of America's best networkers developed his connections, why the creative genius behind one of the most popular shows in television history toiled for years in anonymity, how a basketball executive responsible for multiple draft busts transformed his franchise into a winner, and how we could have anticipated Enron's demise four years before the company collapsed - without ever looking at a single number. <br /><br />Praised by bestselling authors such as Dan Pink, Tony Hsieh, Dan Ariely, Susan Cain, Dan Gilbert, Gretchen Rubin, Bob Sutton, David Allen, Robert Cialdini, and Seth Godin-as well as senior leaders from Google, McKinsey, Merck, Estee Lauder, Nike, and NASA - <i>Give and Take</i> highlights what effective networking, collaboration, influence, negotiation, and leadership skills have in common. This landmark book opens up an approach to success that has the power to transform not just individuals and groups, but entire organizations and communities.","num_pages":"","authors":{"author":{"id":6583155,"name":"Adam M. Grant","role":"","image_url":"https://images.gr-assets.com/authors/1638361005p5/6583155.jpg","small_image_url":"https://images.gr-assets.com/authors/1638361005p2/6583155.jpg","link":"https://www.goodreads.com/author/show/6583155.Adam_M_Grant","average_rating":4.04,"ratings_count":343807,"text_reviews_count":23452}},"average_rating":4.07,"ratings_count":39661,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/149105520-going-infinite","title":"Going Infinite: The Rise and Fall of a New Tycoon","title_without_series":"Going Infinite: The Rise and Fall of a New Tycoon","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684247487l/149105520._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684247487l/149105520._SX98_.jpg","description":"From the #1 best-selling author of <em>The Big Short</em> and <em>Flash Boys</em>, the story of FTXs spectacular collapse and the enigmatic founder at its center.<br /><br />When Michael Lewis first met him, Sam Bankman-Fried was the worlds youngest billionaire and cryptos Gatsby. CEOs, celebrities, and leaders of small countries all vied for his time and cash after he catapulted, practically overnight, onto the <em>Forbes</em> billionaire list. Who was this rumpled guy in cargo shorts and limp white socks, whose eyes twitched across Zoom meetings as he played video games on the side?<br /><br />In <em>Going Infinite</em> Lewis sets out to answer this question, taking readers into the mind of Bankman-Fried, whose rise and fall offers an education in high-frequency trading, cryptocurrencies, philanthropy, bankruptcy, and the justice system. Both psychological portrait and financial roller-coaster ride, <em>Going Infinite</em> is Michael Lewis at the top of his game, tracing the mind-bending trajectory of a character who never liked the rules and was allowed to live by his ownuntil it all came undone.","num_pages":272,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":3.83,"ratings_count":35104,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43726517-hello-world","title":"Hello World: Being Human in the Age of Algorithms","title_without_series":"Hello World: Being Human in the Age of Algorithms","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"Shortlisted for the 2018 Baillie Gifford Prize and the 2018 Royal Society Investment Science Book Prize<br /><br />\\"A beautifully accessible guide.One of the best books yet written on data and algorithms.\\"  Times (UK) When it comes to artificial intelligence, we either hear of a paradise on earth or of our imminent extinction. Its time we stand face-to-digital-face with the true powers and limitations of the algorithms that already automate important decisions in healthcare, transportation, crime, and commerce. Hello World is indispensable preparation for the moral quandaries of a world run by code, and with the unfailingly entertaining Hannah Fry as our guide, well be discussing these issues long after the last page is turned.","num_pages":256,"authors":{"author":{"id":8365972,"name":"Hannah Fry","role":"","image_url":"https://images.gr-assets.com/authors/1448012148p5/8365972.jpg","small_image_url":"https://images.gr-assets.com/authors/1448012148p2/8365972.jpg","link":"https://www.goodreads.com/author/show/8365972.Hannah_Fry","average_rating":4.02,"ratings_count":17746,"text_reviews_count":1891}},"average_rating":4.11,"ratings_count":11711,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/157095669-hidden-potential","title":"Hidden Potential: The Science of Achieving Greater Things","title_without_series":"Hidden Potential: The Science of Achieving Greater Things","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1689111352l/157095669._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1689111352l/157095669._SX98_.jpg","description":"<b>#1 New York Times bestseller<br /><br />\\"This brilliant book will shatter your assumptions about what it takes to improve and succeed. I wish I could go back in time and gift it to my younger self. It would've helped me find a more joyful path to progress.\\"<br />-Serena Williams, 23-time Grand Slam singles tennis champion<br /><br />The #1 New York Times bestselling author of Think Again illuminates how we can elevate ourselves and others to unexpected heights.</b><br /><br />We live in a world thats obsessed with talent. We celebrate gifted students in school, natural athletes in sports, and child prodigies in music. But admiring people who start out with innate advantages leads us to overlook the distances we ourselves can travel. We can all improve at improving. And when opportunity doesnt knock, there are ways to build a door.<br /><br />Hidden Potential offers a new framework for raising aspirations and exceeding expectations. Adam Grant weaves together groundbreaking evidence, surprising insights, and vivid storytelling that takes us from the classroom to the boardroom, the playground to the Olympics, and underground to outer space. He shows that progress depends less on how hard you work than how well you learn. Growth is not about the genius you possess  its about the character you develop. Grant explores how to build the character skills and motivational structures to realize our own potential, and how to design systems that create opportunities for those who have been underrated and overlooked.<br /><br />This book reveals how anyone can rise to achieve greater things. The true measure of your potential is not the height of the peak youve reached, but how far youve climbed to get there.","num_pages":304,"authors":{"author":{"id":6583155,"name":"Adam M. Grant","role":"","image_url":"https://images.gr-assets.com/authors/1638361005p5/6583155.jpg","small_image_url":"https://images.gr-assets.com/authors/1638361005p2/6583155.jpg","link":"https://www.goodreads.com/author/show/6583155.Adam_M_Grant","average_rating":4.04,"ratings_count":343807,"text_reviews_count":23452}},"average_rating":4.1,"ratings_count":45325,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/42950805-homo-deus","title":"Homo Deus: A Brief History of Tomorrow","title_without_series":"Homo Deus: A Brief History of Tomorrow","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1543157430l/42950805._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1543157430l/42950805._SX98_.jpg","description":"<i>Librarian's Note: Alternate-cover edition for ISBN <a href=\\"https://www.goodreads.com/book/show/30965703-homo-deus\\" rel=\\"nofollow noopener\\">1784703931 / 9781784703936</a></i><br /><br />From the author of the number one bestseller <i>Sapiens</i>.<br /><br /><i>Sapiens </i> showed us where we came from. <i>Homo Deus</i> shows us where we're going. War is obsolete. You are more likely to commit suicide than be killed in conflict. Famine is disappearing. You are at more risk of obesity than starvation. Death is just a technical problem. Equality is out - but immortality is in.<br /><br />What does our future hold? Yuval Noah Harari, author of the bestselling phenomenon <i>Sapiens</i> envisions a not-too-distant world in which we face a new set of challenges.<br /><br /><i>Homo Deus</i> explores the projects, dreams and nightmares that will shape the twenty-first century - from overcoming death to creating artificial life. It asks the fundamental questions: Where do we go from here? And how will we protect this fragile world from our own destructive powers?","num_pages":513,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.29,"ratings_count":1790118,"text_reviews_count":100100}},"average_rating":4.19,"ratings_count":285298,"publication_day":"","publication_month":"","publication_year":2017},{"link":"https://www.goodreads.com/book/show/22668729-hooked","title":"Hooked: How to Build Habit-Forming Products","title_without_series":"Hooked: How to Build Habit-Forming Products","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1407112405l/22668729._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1407112405l/22668729._SX98_.jpg","description":"<b>How do successful companies create products people cant put down?</b><br /><br />Why do some products capture widespread attention while others flop? What makes us engage with certain products out of sheer habit? Is there a pattern underlying how technologies hook us?<br />Nir Eyal answers these questions (and many more) by explaining the Hook Modela four-step process embedded into the products of many successful companies to subtly encourage customer behavior. Through consecutive hook cycles, these products reach their ultimate goal of bringing users back again and again without depending on costly advertising or aggressive messaging.<br /><br /><br /><i>Hooked</i> is based on Eyals years of research, consulting, and practical experience. He wrote the book he wished had been available to him as a start-up foundernot abstract theory, but a how-to guide for building better products. <i>Hooked</i> is written for product managers, designers, marketers, start-up founders, and anyone who seeks to understand how products influence our behavior.<br /><br /><br />Eyal provides readers with:<br /><br /><br /> Practical insights to create user habits that stick.<br /> Actionable steps for building products people love.<br /><br /> Fascinating examples from the iPhone to Twitter, Pinterest to the Bible App, and many other habit-forming products.","num_pages":256,"authors":{"author":{"id":7284116,"name":"Nir   Eyal","role":"","image_url":"https://images.gr-assets.com/authors/1555434805p5/7284116.jpg","small_image_url":"https://images.gr-assets.com/authors/1555434805p2/7284116.jpg","link":"https://www.goodreads.com/author/show/7284116.Nir_Eyal","average_rating":3.99,"ratings_count":73750,"text_reviews_count":5097}},"average_rating":4.12,"ratings_count":49752,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26245868-how-google-works","title":"How Google Works","title_without_series":"How Google Works","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1481060659l/26245868._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1481060659l/26245868._SX98_.jpg","description":"Both Eric Schmidt and Jonathan Rosenberg came to Google as seasoned Silicon Valley business executives, but over the course of a decade they came to see the wisdom in Coach John Wooden's observation that 'it's what you learn after you know it all that counts'. As they helped grow Google from a young start-up to a global icon, they relearned everything they knew about management. <i>How Google Works</i> is the sum of those experiences distilled into a fun, easy-to-read primer on corporate culture, strategy, talent, decision-making, communication, innovation, and dealing with disruption.<br /><br />The authors explain how the confluence of three seismic changes - the internet, mobile, and cloud computing - has shifted the balance of power from companies to consumers. The companies that will thrive in this ever-changing landscape will be the ones that create superior products and attract a new breed of multifaceted employees whom the authors dub 'smart creatives'. The management maxims ('Consensus requires dissension', 'Exile knaves but fight for divas', 'Think 10X, not 10%') are illustrated with previously unreported anecdotes from Google's corporate history.<br /><br />'Back in 2010, Eric and I created an internal class for Google managers,' says Rosenberg. 'The class slides all read 'Google confidential' until an employee suggested we uphold the spirit of openness and share them with the world. This book codifies the recipe for our secret sauce: how Google innovates and how it empowers employees to succeed.'","num_pages":"","authors":{"author":{"id":3887089,"name":"Eric Schmidt","role":"","image_url":"https://images.gr-assets.com/authors/1456105735p5/3887089.jpg","small_image_url":"https://images.gr-assets.com/authors/1456105735p2/3887089.jpg","link":"https://www.goodreads.com/author/show/3887089.Eric_Schmidt","average_rating":3.93,"ratings_count":56063,"text_reviews_count":4024}},"average_rating":4.05,"ratings_count":29486,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/7963278-how-i-killed-pluto-and-why-it-had-it-coming","title":"How I Killed Pluto and Why It Had It Coming","title_without_series":"How I Killed Pluto and Why It Had It Coming","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320532443l/7963278._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320532443l/7963278._SX98_.jpg","description":"The solar system most of us grew up with included nine planets, with Mercury closest to the sun and Pluto at the outer edge. Then, in 2005, astronomer Mike Brown made the discovery of a lifetime: a tenth planet, Eris, slightly bigger than Pluto. But instead of adding one more planet to our solar system, Browns find ignited a firestorm of controversy that culminated in the demotion of Pluto from real planet to the newly coined category of dwarf planet. Suddenly Brown was receiving hate mail from schoolchildren and being bombarded by TV reportersall because of the discovery he had spent years searching for and a lifetime dreaming about.<br /><br />A heartfelt and personal journey filled with both humor and drama, <i>How I Killed Pluto and Why It Had It Coming</i> is the book for anyone, young or old, who has ever imagined exploring the universeand who among us hasnt?","num_pages":267,"authors":{"author":{"id":234214,"name":"Mike    Brown","role":"","image_url":"https://images.gr-assets.com/authors/1291870808p5/234214.jpg","small_image_url":"https://images.gr-assets.com/authors/1291870808p2/234214.jpg","link":"https://www.goodreads.com/author/show/234214.Mike_Brown","average_rating":4.05,"ratings_count":10231,"text_reviews_count":1459}},"average_rating":4.06,"ratings_count":9868,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23281872-how-not-to-be-wrong","title":"How Not to Be Wrong: The Power of Mathematical Thinking","title_without_series":"How Not to Be Wrong: The Power of Mathematical Thinking","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432987179l/23281872._SX98_.jpg","description":"Witty, compelling, and just plain fun to read . . .\\" Evelyn Lamb, Scientific American<br /><br />The Freakonomics of matha math-world superstar unveils the hidden beauty and logic of the world and puts its power in our hands<br /><br />The math we learn in school can seem like a dull set of rules, laid down by the ancients and not to be questioned. In How Not to Be Wrong , Jordan Ellenberg shows us how terribly limiting this view is: Math isnt confined to abstract incidents that never occur in real life, but rather touches everything we dothe whole world is shot through with it.<br /><br />Math allows us to see the hidden structures underneath the messy and chaotic surface of our world. Its a science of not being wrong, hammered out by centuries of hard work and argument. Armed with the tools of mathematics, we can see through to the true meaning of information we take for granted: How early should you get to the airport? What does public opinion really represent? Why do tall parents have shorter children? Who really won Florida in 2000? And how likely are you, really, to develop cancer?<br /><br />How Not to Be Wrong presents the surprising revelations behind all of these questions and many more, using the mathematicians method of analyzing life and exposing the hard-won insights of the academic community to the laymanminus the jargon. Ellenberg chases mathematical threads through a vast range of time and space, from the everyday to the cosmic, encountering, among other things, baseball, Reaganomics, daring lottery schemes, Voltaire, the replicability crisis in psychology, Italian Renaissance painting, artificial languages, the development of non-Euclidean geometry, the coming obesity apocalypse, Antonin Scalias views on crime and punishment, the psychology of slime molds, what Facebook can and cant figure out about you, and the existence of God.<br /><br />Ellenberg pulls from history as well as from the latest theoretical developments to provide those not trained in math with the knowledge they need. Math, as Ellenberg says, is an atomic-powered prosthesis that you attach to your common sense, vastly multiplying its reach and strength. With the tools of mathematics in hand, you can understand the world in a deeper, more meaningful way. How Not to Be Wrong will show you how.","num_pages":457,"authors":{"author":{"id":359894,"name":"Jordan Ellenberg","role":"","image_url":"https://images.gr-assets.com/authors/1622052352p5/359894.jpg","small_image_url":"https://images.gr-assets.com/authors/1622052352p2/359894.jpg","link":"https://www.goodreads.com/author/show/359894.Jordan_Ellenberg","average_rating":3.93,"ratings_count":23459,"text_reviews_count":2197}},"average_rating":3.95,"ratings_count":21240,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43852758-how-to","title":"How To: Absurd Scientific Advice for Common Real-World Problems","title_without_series":"How To: Absurd Scientific Advice for Common Real-World Problems","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550145086l/43852758._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550145086l/43852758._SX98_.jpg","description":"<b>The world's most entertaining and useless self-help guide, from the brilliant mind behind the wildly popular webcomic xkcd and the #1 <i>New York Times</i> bestsellers <i>What If?</i> and <i>Thing Explainer</i></b><br /><br />For any task you might want to do, there's a right way, a wrong way, and a way so monumentally complex, excessive, and inadvisable that no one would ever try it. <i>How To</i> is a guide to the third kind of approach. It's full of highly impractical advice for everything from landing a plane to digging a hole.<br /><br />Bestselling author and cartoonist Randall Munroe explains how to predict the weather by analyzing the pixels of your Facebook photos. He teaches you how to tell if you're a baby boomer or a 90's kid by measuring the radioactivity of your teeth. He offers tips for taking a selfie with a telescope, crossing a river by boiling it, and powering your house by destroying the fabric of space-time. And if you want to get rid of the book once you're done with it, he walks you through your options for proper disposal, including dissolving it in the ocean, converting it to a vapor, using tectonic plates to subduct it into the Earth's mantle, or launching it into the Sun.<br /><br />By exploring the most complicated ways to do simple tasks, Munroe doesn't just make things difficult for himself and his readers. As he did so brilliantly in <i>What If?</i>, Munroe invites us to explore the most absurd reaches of the possible. Full of clever infographics and amusing illustrations, <i>How To</i> is a delightfully mind-bending way to better understand the science and technology underlying the things we do every day.","num_pages":308,"authors":{"author":{"id":3089156,"name":"Randall Munroe","role":"","image_url":"https://images.gr-assets.com/authors/1406058780p5/3089156.jpg","small_image_url":"https://images.gr-assets.com/authors/1406058780p2/3089156.jpg","link":"https://www.goodreads.com/author/show/3089156.Randall_Munroe","average_rating":4.16,"ratings_count":254381,"text_reviews_count":17616}},"average_rating":4.17,"ratings_count":22751,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/56587388-how-the-world-really-works","title":"How the World Really Works: A Scientist's Guide to Our Past, Present and Future","title_without_series":"How the World Really Works: A Scientist's Guide to Our Past, Present and Future","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641444915l/56587388._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641444915l/56587388._SX98_.jpg","description":"* THE NEW YORK TIMES BESTSELLER *<br /><br />'Another masterpiece from one of my favorite authors . . . If you want a brief but thorough education in numeric thinking about many of the fundamental forces that shape human life, this is the book to read. It's a tour de force' BILL GATES<br />__________<br /><br />We have never had so much information at our fingertips and yet most of us don't know how the world really works. This book explains seven of the most fundamental realities governing our survival and prosperity. From energy and food production, through our material world and its globalization, to risks, our environment and its future, How the World Really Works offers a much-needed reality check - because before we can tackle problems effectively, we must understand the facts.<br /><br />In this ambitious and thought-provoking book we see, for example, that globalization isn't inevitable and that our societies have been steadily increasing their dependence on fossil fuels, making their complete and rapid elimination unlikely. Drawing on the latest science and tackling sources of misinformation head on - from Yuval Noah Harari to Noam Chomsky - ultimately Smil answers the most profound question of our age: are we irrevocably doomed or is a brighter utopia ahead?<br />__________<br /><br />'Very informative and eye-opening in many ways' HA-JOON CHANG, author of 23 Things They Don't Tell You About Capitalism<br /><br />'If you are anxious about the future, and infuriated that we aren't doing enough about it, please read this book' PAUL COLLIER, author of The Future of Capitalism","num_pages":326,"authors":{"author":{"id":5003,"name":"Vaclav Smil","role":"","image_url":"https://images.gr-assets.com/authors/1619861469p5/5003.jpg","small_image_url":"https://images.gr-assets.com/authors/1619861469p2/5003.jpg","link":"https://www.goodreads.com/author/show/5003.Vaclav_Smil","average_rating":3.9,"ratings_count":38923,"text_reviews_count":3991}},"average_rating":3.95,"ratings_count":13756,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/35959613-how-to-american","title":"How to American: An Immigrant's Guide to Disappointing Your Parents","title_without_series":"How to American: An Immigrant's Guide to Disappointing Your Parents","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517784874l/35959613._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1517784874l/35959613._SX98_.jpg","description":"<b>Standup comic, actor and fan favorite from the popular HBO series <i>Silicon Valley</i> shares his memoir of growing up as a Chinese immigrant in California and making it in Hollywood.<br /><br /></b>Jimmy O. Yang is about to have his moment. You've likely seen the standup comic and actor starring as a series regular, the fan favorite character Jian Yang in Mike Judge's Emmy-nominated HBO comedy <i>Silicon Valley</i>. Or you may have caught his first dramatic turn in director Peter Berg's acclaimed film <i>Patriot's Day</i>. Next up is a major role opposite Melissa McCarthy in the comedy <i>Life of the Party</i>. Beyond his burgeoning career in Hollywood, Yang's star status is only a small piece of his story. His family emigrated from Hong Kong to Los Angeles when he was 13. Can you think of a worse time for a young adolescent who didn't speak English to be thrown into the Los Angeles School District with its notorious income gap, mean girls, and children of Hollywood elite? <br /><br />In his first book, <i>How to American</i>, Yang shares his storiesalways hilarious, often resonantof learning our customs, assimilating into our culture, and figuring out how to date high school girls who were six inches taller than him, all while enduring the constant pressure from his sometimes overbearing parents to go to medical school and become a doctor. In his book, we see firsthand what Yang's experienced as an immigrant and the things he did and didn't do to progress into a star on the rise. <i>How to American</i> features chapters on a wide range of topics, from \\"How to Thuglife\\" (what Yang learned about America by watching BET RapCity, three hours of rap music videos a day) to \\"How to Hollywood\\" (making the best of the limited roles given to him, to eventually playing the boyfriend to a white girl in the upcoming Melissa McCarthy star vehicle <i>Life of The Party</i>, the Holy Grail of Asian actors).<b>\\n  <br />\\n</b>","num_pages":240,"authors":{"author":{"id":17086472,"name":"Jimmy O. Yang","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/17086472.Jimmy_O_Yang","average_rating":4.03,"ratings_count":7847,"text_reviews_count":901}},"average_rating":4.03,"ratings_count":7845,"publication_day":13,"publication_month":3,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/52275335-how-to-avoid-a-climate-disaster","title":"How to Avoid a Climate Disaster: The Solutions We Have and the Breakthroughs We Need","title_without_series":"How to Avoid a Climate Disaster: The Solutions We Have and the Breakthroughs We Need","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1609355352l/52275335._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1609355352l/52275335._SX98_.jpg","description":"Neste livro urgente e ricamente detalhado, Bill Gates prope um plano abrangente, prtico e acessvel para zerar a emisso de gases de efeito estufa e evitar uma catstrofe climtica.<br /><br />Bill Gates passou uma dcada investigando as causas e os efeitos da mudana climtica. Com a ajuda de especialistas nas reas de fsica, qumica, biologia, engenharia, cincia poltica e finanas, ele se concentrou no que deve ser feito para impedir uma catstrofe ambiental. Neste livro, o fundador da Microsoft no explica apenas por que precisamos zerar as emisses lquidas de gases de efeito estufa, mas tambm detalha como podemos atingir esse objetivo e superar os desafios que temos pela frente. <br />A partir de sua experincia em inovao e de tirar ideias do papel, Gates descreve como a tecnologia j vem ajudando a reduzir as emisses, onde e como ela pode funcionar de forma mais eficaz, em quais setores precisamos de novidades e quem so os pesquisadores por trs delas. Finalmente, ele apresenta um plano prtico para zerar as emisses, que inclui desde as polticas pblicas at as atitudes que ns, cidados, podemos tomar a fim de monitorar o trabalho do governo, de nossos empregadores e de ns mesmos. <br />Como o autor demonstra, zerar as emisses no ser fcil, mas, seguindo os conselhos deste livro,  uma meta que est plenamente a nosso alcance.","num_pages":272,"authors":{"author":{"id":23470,"name":"Bill  Gates","role":"","image_url":"https://images.gr-assets.com/authors/1736827769p5/23470.jpg","small_image_url":"https://images.gr-assets.com/authors/1736827769p2/23470.jpg","link":"https://www.goodreads.com/author/show/23470.Bill_Gates","average_rating":4.07,"ratings_count":83175,"text_reviews_count":7610}},"average_rating":4.12,"ratings_count":50741,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55655032-how-to-change","title":"How to Change: The Science of Getting from Where You Are to Where You Want to Be","title_without_series":"How to Change: The Science of Getting from Where You Are to Where You Want to Be","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1605572905l/55655032._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1605572905l/55655032._SX98_.jpg","description":"<b><b><i>Wall Street Journal</i> bestseller</b> </b><br /><br /><b>\\"A welcome revelation.\\" --<i>The Financial Times</i></b><br /><br /><b>Award-winning Wharton Professor and Choiceology podcast host Katy Milkman has devoted her career to the study of behavior change. In this ground-breaking book, Milkman reveals a proven path that can take you from where you are to where you want to be, with a foreword from psychologist Angela Duckworth, the best-selling author of <i>Grit</i>.</b><br /><br />Change comes most readily when you understand what's standing between you and success and tailor your solution to that roadblock. If you want to work out more but find exercise difficult and boring, downloading a goal-setting app probably won't help. But what if, instead, you transformed your workouts so they became a source of pleasure instead of a chore? Turning an uphill battle into a downhill one is the key to success.<br /><br />Drawing on Milkman's original research and the work of her world-renowned scientific collaborators, <i>How to Change</i> shares strategic methods for identifying and overcoming common barriers to change, such as impulsivity, procrastination, and forgetfulness. Through case studies and engaging stories, you'll learn:<br /><br /><b>-</b> Why timing can be everything when it comes to making a change<br /> <b>-</b> How to turn temptation and inertia into assets <br /> <b>-</b> That giving advice, even if it's about something you're struggling with, can help you achieve more<br /><br />Whether you're a manager, coach, or teacher aiming to help others change for the better or are struggling to kick-start change yourself, <i>How to Change</i> offers an invaluable, science-based blueprint for achieving your goals, once and for all.","num_pages":"","authors":{"author":{"id":20805683,"name":"Katy Milkman","role":"","image_url":"https://images.gr-assets.com/authors/1699799627p5/20805683.jpg","small_image_url":"https://images.gr-assets.com/authors/1699799627p2/20805683.jpg","link":"https://www.goodreads.com/author/show/20805683.Katy_Milkman","average_rating":3.84,"ratings_count":7176,"text_reviews_count":706}},"average_rating":3.84,"ratings_count":7174,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54564213-how-to-make-the-world-add-up","title":"How to Make the World Add Up: Ten Rules for Thinking Differently About Numbers","title_without_series":"How to Make the World Add Up: Ten Rules for Thinking Differently About Numbers","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594979690l/54564213._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594979690l/54564213._SX98_.jpg","description":"When was the last time you read a grand statement, accompanied by a large number, and wondered whether it could really be true? Statistics are vital in helping us tell stories - we see them in the papers, on social media, and we hear them used in everyday conversation - and yet we doubt them more than ever.<br /><br />But numbers - in the right hands - have the power to change the world for the better. Contrary to popular belief, good statistics are not a trick, although they are a kind of magic. Good statistics are not smoke and mirrors; in fact, they help us see more clearly. Good statistics are like a telescope for an astronomer, a microscope for a bacteriologist, or an X-ray for a radiologist. If we are willing to let them, good statistics help us see things about the world around us and about ourselves - both large and small - that we would not be able to see in any other way.<br /><br />In How to Make the World Add Up, Tim Harford draws on his experience as both an economist and presenter of the BBC's radio show 'More or Less'. He takes us deep into the world of disinformation and obfuscation, bad research and misplaced motivation to find those priceless jewels of data and analysis that make communicating with numbers worthwhile. Harford's characters range from the art forger who conned the Nazis to the stripper who fell in love with the most powerful congressman in Washington, to famous data detectives such as John Maynard Keynes, Daniel Kahneman and Florence Nightingale. He reveals how we can evaluate the claims that surround us with confidence, curiosity and a healthy level of scepticism.<br /><br />Using ten simple rules for understanding numbers - plus one golden rule - this extraordinarily insightful book shows how if we keep our wits about us, thinking carefully about the way numbers are sourced and presented, we can look around us and see with crystal clarity how the world adds up.","num_pages":352,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60509,"text_reviews_count":4325}},"average_rating":4.12,"ratings_count":8189,"publication_day":17,"publication_month":9,"publication_year":2020},{"link":"https://www.goodreads.com/book/show/54304221-how-to-not-die-alone","title":"How to Not Die Alone: The Surprising Science That Will Help You Find Love","title_without_series":"How to Not Die Alone: The Surprising Science That Will Help You Find Love","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1607457004l/54304221._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1607457004l/54304221._SX98_.jpg","description":"J alguma vez olhou  sua volta e deu por si a Por que razo j toda a gente encontrou o amor, menos eu? O seu caso no  o nico. Os bons relacionamentos no aparecem do nada nas nossas vidas; so o culminar de uma srie de decises, incluindo com quem se deve ou no namorar, quando se deve terminar uma ligao que no est a resultar e quando se deve investir a srio numa determinada pessoa.<br /><br />Com base em anos de pesquisa, a cientista comportamental Logan Ury vai tornar-se a sua preciosa ajuda. Em Como No Acabar Sozinho, ir <br /><br />Porque hesita nos namoros (e como quebrar esse padro);<br />O que importa numa relao de longo prazo (e o que no);<br />Como conhecer mais pessoas (enquanto faz coisas de que gosta);<br />Como voltar a sair com algum (sem que tal parea uma entrevista de trabalho);<br />A razo pela qual a fasca  um mito (mas como, ainda assim, encontrar o amor).","num_pages":"","authors":{"author":{"id":20455205,"name":"Logan Ury","role":"","image_url":"https://images.gr-assets.com/authors/1603676701p5/20455205.jpg","small_image_url":"https://images.gr-assets.com/authors/1603676701p2/20455205.jpg","link":"https://www.goodreads.com/author/show/20455205.Logan_Ury","average_rating":3.97,"ratings_count":19030,"text_reviews_count":2100}},"average_rating":3.97,"ratings_count":19006,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/53406646-humankind","title":"Humankind: A Hopeful History","title_without_series":"Humankind: A Hopeful History","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"It's a belief that unites the left and right, psychologists and philosophers, writers and historians. It drives the headlines that surround us and the laws that touch our lives. From Machiavelli to Hobbes, Freud to Dawkins, the roots of this belief have sunk deep into Western thought. Human beings, we're taught, are by nature selfish and governed by self-interest.<br /><br />Humankind makes a new argument: that it is realistic, as well as revolutionary, to assume that people are good. The instinct to cooperate rather than compete, trust rather than distrust, has an evolutionary basis going right back to the beginning of Homo sapiens. By thinking the worst of others, we bring out the worst in our politics and economics too.<br /><br />In this major book, internationally bestselling author Rutger Bregman takes some of the world's most famous studies and events and reframes them, providing a new perspective on the last 200,000 years of human history. From the real-life Lord of the Flies to the Blitz, a Siberian fox farm to an infamous New York murder, Stanley Milgram's Yale shock machine to the Stanford prison experiment, Bregman shows how believing in human kindness and altruism can be a new way to think  and act as the foundation for achieving true change in our society.<br /><br />It is time for a new view of human nature.","num_pages":496,"authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.22,"ratings_count":137733,"text_reviews_count":14039}},"average_rating":4.32,"ratings_count":78725,"publication_day":19,"publication_month":3,"publication_year":2020},{"link":"https://www.goodreads.com/book/show/39074550-humble-pi","title":"Humble Pi: A Comedy of Maths Errors","title_without_series":"Humble Pi: A Comedy of Maths Errors","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>An international bestseller </b><br /><br />The book-length answer to anyone who ever put their hand up in math class and asked, \\"When am I ever going to use this in the real world?\\"<br /><br />\\"Fun, informative, and relentlessly entertaining, <i>Humble Pi</i> is a charming and very readable guide to some of humanity's all-time greatest miscalculations--that also gives you permission to feel a little better about some of your own mistakes.\\" --Ryan North, author of <i>How to Invent Everything</i><br /><br />Our whole world is built on math, from the code running a website to the equations enabling the design of skyscrapers and bridges. Most of the time this math works quietly behind the scenes . . . until it doesn't. All sorts of seemingly innocuous mathematical mistakes can have significant consequences.<br /><br />Math is easy to ignore until a misplaced decimal point upends the stock market, a unit conversion error causes a plane to crash, or someone divides by zero and stalls a battleship in the middle of the ocean.<br /><br />Exploring and explaining a litany of glitches, near misses, and mathematical mishaps involving the internet, big data, elections, street signs, lotteries, the Roman Empire, and an Olympic team, Matt Parker uncovers the bizarre ways math trips us up, and what this reveals about its essential place in our world. Getting it wrong has never been more fun.","num_pages":314,"authors":{"author":{"id":17598525,"name":"Matt    Parker","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/17598525.Matt_Parker","average_rating":4.1,"ratings_count":26506,"text_reviews_count":2834}},"average_rating":4.1,"ratings_count":21927,"publication_day":7,"publication_month":3,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/63249703-it-s-ok-to-be-angry-about-capitalism","title":"It's OK to Be Angry About Capitalism","title_without_series":"It's OK to Be Angry About Capitalism","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1669081225l/63249703._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1669081225l/63249703._SX98_.jpg","description":"A progressive takedown of the uber-capitalist status quo that has enriched millionaires and billionaires at the expense of the working class, and a blueprint for what transformational change would actually look like<br /><br />Its OK to be angry about capitalism. Reflecting on our turbulent times, Senator Bernie Sanders takes on the billionaire class and speaks blunt truths about our countrys failure to address the destructive nature of a system that is fueled by uncontrolled greed and rigidly committed to prioritizing corporate profits over the needs of ordinary Americans.<br /><br />Sanders argues that unfettered capitalism is to blame for an unprecedented level of income and wealth inequality, is undermining our democracy, and is destroying our planet. How can we accept an economic order that allows three billionaires to control more wealth than the bottom half of our society? How can we accept a political system that allows the super rich to buy elections and politicians? How can we accept an energy system that rewards the fossil fuel corporations causing the climate crisis? Sanders believes that, in the face of these overwhelming challenges, the American people must ask tough questions about the systems that have failed us and demand fundamental economic and political change. This is where the path forward begins.<br /><br />Its OK to Be Angry About Capitalism presents a vision that extends beyond the promises of past campaigns to reveal what would be possible if the political revolution took place, if we would finally recognize that economic rights are human rights, and if we would work to create a society that provides a decent standard of living for all. This isnt some utopian fantasy; this is democracy as we should know it.","num_pages":"","authors":{"author":{"id":102824,"name":"Bernie Sanders","role":"","image_url":"https://images.gr-assets.com/authors/1300822269p5/102824.jpg","small_image_url":"https://images.gr-assets.com/authors/1300822269p2/102824.jpg","link":"https://www.goodreads.com/author/show/102824.Bernie_Sanders","average_rating":4.12,"ratings_count":25724,"text_reviews_count":3713}},"average_rating":4.1,"ratings_count":7212,"publication_day":21,"publication_month":2,"publication_year":2023},{"link":"https://www.goodreads.com/book/show/2294277.Just_for_Fun","title":"Just for Fun: The Story of an Accidental Revolutionary","title_without_series":"Just for Fun: The Story of an Accidental Revolutionary","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328006418l/2294277._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328006418l/2294277._SX98_.jpg","description":"Most 31-year olds can't boast of being the instigator of a revolution. But then again, the world's leading promoter of open source software and creator of the operating system Linux does humbly call himself an accidental revolutionary--accidental being the operative word here. <i>Just for Fun</i> is the quirky story of how Linus Torvalds went from being a penniless, introverted code writer in Helsinki in the early 1990s to being the unwitting (and rather less than penniless) leader of a radical shift in computer programming by the end of the decade.<p> OK, perhaps \\"story\\" in the traditional sense of the term is stretching it a bit. This whole book is more like a series of e-mails, an exercise in textual communication for someone more used to code language than conversation: choppy sentences packed into short paragraphs, and sometimes just one-liners. The pace is fast, but the quippy tone can get somewhat tiring, though it definitely suits the portrayal of a computer-dominated life. And like an e-mail conversation, the tense often changes, the topics jump back and forth, and the narrators occasionally change, mostly alternating between the Linux man himself and <i>Red Herring</i> executive editor David Diamond, who convinced the difficult-to-pin-down Torvalds to write his story (or at least allow Diamond to poke, prod, and pull it out of him, all the while giving his own impressions and interpretations). But Torvald's tale contains enough informative and entertaining tidbits--on growing up in dark, strangely silent but communication-gadget-obsessed Finland (which boasts more cell phones per capita than anywhere else), on what makes passionate code writers tick, on making the transition from unknown computer geek to world-famous computer geek, on the convergence of technology and ideology, on his work for Transmeta and involvement (or lack thereof) with all the players worth mentioning in Silicon Valley - to keep more than just computer programmers engrossed in his story. For the latter, of course, <i>Just for Fun</i> will be required reading.</p><p> If you pick up this book as a geek's guide to the meaning of life (which, believe it or not, Torvalds does ramble on about at the beginning and the end), then you're in for a bit of a shallow take on the whole thing. But if you're interested in the idea of technological development as a global team sport, and how a nerdy Finnish transplant to California got the whole game going in the first place, check out Linus's story... just for fun, of course. --<i>S. Ketchum</i></p>","num_pages":249,"authors":{"author":{"id":44935662,"name":"Torvalds. Linus & David Diamond","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/44935662.Torvalds_Linus_David_Diamond","average_rating":3.96,"ratings_count":23,"text_reviews_count":1}},"average_rating":3.96,"ratings_count":4762,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/4929.Kafka_on_the_Shore","title":"Kafka on the Shore","title_without_series":"Kafka on the Shore","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1429638085l/4929._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1429638085l/4929._SX98_.jpg","description":"<i>Kafka on the Shore</i>, a tour de force of metaphysical reality, is powered by two remarkable characters: a teenage boy, Kafka Tamura, who runs away from home either to escape a gruesome oedipal prophecy or to search for his long-missing mother and sister; and an aging simpleton called Nakata, who never recovered from a wartime affliction and now is drawn toward Kafka for reasons that, like the most basic activities of daily life, he cannot fathom. Their odyssey, as mysterious to them as it is to us, is enriched throughout by vivid accomplices and mesmerizing events. Cats and people carry on conversations, a ghostlike pimp employs a Hegel-quoting prostitute, a forest harbors soldiers apparently unaged since World War II, and rainstorms of fish (and worse) fall from the sky. There is a brutal murder, with the identity of both victim and perpetrator a riddleyet this, along with everything else, is eventually answered, just as the entwined destinies of Kafka and Nakata are gradually revealed, with one escaping his fate entirely and the other given a fresh start on his own.","num_pages":467,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4190455,"text_reviews_count":359110}},"average_rating":4.12,"ratings_count":543067,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/34684622-leonardo-da-vinci","title":"Leonardo da Vinci","title_without_series":"Leonardo da Vinci","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523543570l/34684622._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1523543570l/34684622._SX98_.jpg","description":"Based on thousands of pages from Leonardo's astonishing notebooks and new discoveries about his life and work, Walter Isaacson weaves a narrative that connects his art to his science. He shows how Leonardo's genius was based on skills we can improve in ourselves, such as passionate curiosity, careful observation, and an imagination so playful that it flirted with fantasy. He produced the two most famous paintings in history, The Last Supper and the Mona Lisa. But in his own mind, he was just as much a man of science and technology. With a passion that sometimes became obsessive, he pursued innovative studies of anatomy, fossils, birds, the heart, flying machines, botany, geology, and weaponry. His ability to stand at the crossroads of the humanities and the sciences, made iconic by his drawing of Vitruvian Man, made him history's most creative genius","num_pages":600,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2011167,"text_reviews_count":54288}},"average_rating":4.18,"ratings_count":127175,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/7865083-liar-s-poker","title":"Liar's Poker","title_without_series":"Liar's Poker","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<strong>The time was the 1980s. The place was Wall Street. The game was called Liars Poker.</strong> <br /><br />Michael Lewis was fresh out of Princeton and the London School of Economics when he landed a job at Salomon Brothers, one of Wall Streets premier investment firms. During the next three years, Lewis rose from callow trainee to bond salesman, raking in millions for the firm and cashing in on a modern-day gold rush. <em>Liars Poker</em> is the culmination of those heady, frenzied yearsa behind-the-scenes look at a unique and turbulent time in American business. From the frat-boy camaraderie of the forty-first-floor trading room to the killer instinct that made ambitious young men gamble everything on a high-stakes game of bluffing and deception, here is Michael Lewiss knowing and hilarious insiders account of an unprecedented era of greed, gluttony, and outrageous fortune. .","num_pages":310,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":4.15,"ratings_count":111131,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/75623469-love-triangle","title":"Love Triangle: The Life-changing Magic of Trigonometry","title_without_series":"Love Triangle: The Life-changing Magic of Trigonometry","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1714209877l/75623469._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1714209877l/75623469._SX98_.jpg","description":"","num_pages":337,"authors":{"author":{"id":17598525,"name":"Matt    Parker","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/17598525.Matt_Parker","average_rating":4.1,"ratings_count":26506,"text_reviews_count":2834}},"average_rating":3.94,"ratings_count":1241,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18770267-make-it-stick","title":"Make It Stick: The Science of Successful Learning","title_without_series":"Make It Stick: The Science of Successful Learning","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631768711l/18770267._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631768711l/18770267._SX98_.jpg","description":"To most of us, learning something the hard way implies wasted time and effort. Good teaching, we believe, should be creatively tailored to the different learning styles of students and should use strategies that make learning easier. <em>Make It Stick</em> turns fashionable ideas like these on their head. Drawing on recent discoveries in cognitive psychology and other disciplines, the authors offer concrete techniques for becoming more productive learners.<br /><br />Memory plays a central role in our ability to carry out complex cognitive tasks, such as applying knowledge to problems never before encountered and drawing inferences from facts already known. New insights into how memory is encoded, consolidated, and later retrieved have led to a better understanding of how we learn. Grappling with the impediments that make learning challenging leads both to more complex mastery and better retention of what was learned.<br /><br />Many common study habits and practice routines turn out to be counterproductive. Underlining and highlighting, rereading, cramming, and single-minded repetition of new skills create the illusion of mastery, but gains fade quickly. More complex and durable learning come from self-testing, introducing certain difficulties in practice, waiting to re-study new material until a little forgetting has set in, and interleaving the practice of one skill or topic with another. Speaking most urgently to students, teachers, trainers, and athletes, <em>Make It Stick</em> will appeal to all those interested in the challenge of lifelong learning and self-improvement.","num_pages":313,"authors":{"author":{"id":47555,"name":"Peter C. Brown","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/47555.Peter_C_Brown","average_rating":4.14,"ratings_count":22797,"text_reviews_count":2374}},"average_rating":4.15,"ratings_count":22331,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/4069.Man_s_Search_for_Meaning","title":"Man's Search for Meaning","title_without_series":"Man's Search for Meaning","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1535419394l/4069._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1535419394l/4069._SX98_.jpg","description":"Psychiatrist Viktor Frankl's memoir has riveted generations of readers with its descriptions of life in Nazi death camps and its lessons for spiritual survival. Based on his own experience and the stories of his patients, Frankl argues that we cannot avoid suffering but we can choose how to cope with it, find meaning in it, and move forward with renewed purpose. At the heart of his theory, known as logotherapy, is a conviction that the primary human drive is not pleasure but the pursuit of what we find meaningful. <i>Man's Search for Meaning</i> has become one of the most influential books in America; it continues to inspire us all to find significance in the very act of living.","num_pages":165,"authors":{"author":{"id":2782,"name":"Viktor E. Frankl","role":"","image_url":"https://images.gr-assets.com/authors/1542894524p5/2782.jpg","small_image_url":"https://images.gr-assets.com/authors/1542894524p2/2782.jpg","link":"https://www.goodreads.com/author/show/2782.Viktor_E_Frankl","average_rating":4.37,"ratings_count":891896,"text_reviews_count":50577}},"average_rating":4.37,"ratings_count":863192,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/8410925-mao-s-great-famine","title":"Mao's Great Famine: The History of China's Most Devastating Catastrophe, 1958-62","title_without_series":"Mao's Great Famine: The History of China's Most Devastating Catastrophe, 1958-62","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1467992412l/8410925._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1467992412l/8410925._SX98_.jpg","description":"Between 1958 and 1962, 45 million Chinese people were worked, starved or beaten to death. Mao Zedong threw his country into a frenzy with the Great Leap Forward, an attempt to catch up with and overtake the Western world in less than fifteen years. It lead to one of the greatest catastrophes the world has ever known. Dikotter's extraordinary research within Chinese archives brings together for the first time what happened in the corridors of power with the everyday experiences of ordinary people, giving voice to the dead and disenfranchised. This groundbreaking account definitively recasts the history of the People's Republic of China.","num_pages":448,"authors":{"author":{"id":628437,"name":"Frank Diktter","role":"","image_url":"https://images.gr-assets.com/authors/1357655982p5/628437.jpg","small_image_url":"https://images.gr-assets.com/authors/1357655982p2/628437.jpg","link":"https://www.goodreads.com/author/show/628437.Frank_Dik_tter","average_rating":3.99,"ratings_count":13876,"text_reviews_count":1661}},"average_rating":4.07,"ratings_count":5127,"publication_day":6,"publication_month":9,"publication_year":2010},{"link":"https://www.goodreads.com/book/show/37570546-maybe-you-should-talk-to-someone","title":"Maybe You Should Talk to Someone: A Therapist, Her Therapist, and Our Lives Revealed","title_without_series":"Maybe You Should Talk to Someone: A Therapist, Her Therapist, and Our Lives Revealed","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1547189796l/37570546._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1547189796l/37570546._SX98_.jpg","description":"<b>From a psychotherapist, and national advice columnist comes a thought-provoking new book that takes us behind the scenes of a therapist's world -- where her patients are looking for answers (and so is she).</b><br /><br /> One day, Lori Gottlieb is a therapist who helps patients in her Los Angeles practice. The next, a crisis causes her world to come crashing down. Enter Wendell, the quirky but seasoned therapist in whose office she suddenly lands. With his balding head, cardigan, and khakis, he seems to have come straight from Therapist Central Casting. Yet he will turn out to be anything but.<br /><br /> As Gottlieb explores the inner chambers of her patients' lives -- a self-absorbed Hollywood producer, a young newlywed diagnosed with a terminal illness, a senior citizen threatening to end her life on her birthday if nothing gets better, and a twenty-something who can't stop hooking up with the wrong guys -- she finds that the questions they are struggling with are the very ones she is now bringing to Wendell.<br /><br /> With startling wisdom and humor, Gottlieb invites us into her world as both clinician and patient, examining the truths and fictions we tell ourselves and others as we teeter on the tightrope between love and desire, meaning and mortality, guilt and redemption, terror and courage, hope and change.<br /><br /><i>Maybe You Should Talk to Someone </i>is revolutionary in its candor, offering a deeply personal yet universal tour of our hearts and minds and providing the rarest of gifts: a boldly revealing portrait of what it means to be human, and a disarmingly funny and illuminating account of our own mysterious lives and our power to transform them.","num_pages":415,"authors":{"author":{"id":201386,"name":"Lori Gottlieb","role":"","image_url":"https://images.gr-assets.com/authors/1547068605p5/201386.jpg","small_image_url":"https://images.gr-assets.com/authors/1547068605p2/201386.jpg","link":"https://www.goodreads.com/author/show/201386.Lori_Gottlieb","average_rating":4.34,"ratings_count":414331,"text_reviews_count":37006}},"average_rating":4.37,"ratings_count":399463,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/205363955-meditations-for-mortals","title":"Meditations for Mortals: Four Weeks to Embrace Your Limitations and Make Time for What Counts","title_without_series":"Meditations for Mortals: Four Weeks to Embrace Your Limitations and Make Time for What Counts","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b><i>Meditations for Mortals</i> takes us on a liberating journey towards a more meaningful life  one that begins not with fantasies of the ideal existence, but with the reality in which we actually find ourselves.</b><br /><br />Addressing the fundamental questions about how to live, it offers a powerful new way to take action on what counts: a guiding philosophy of life Oliver Burkeman calls imperfectionism. How can we embrace our non-negotiable limitations? Or make good decisions when theres always too much to do? What if purposeful productivity were often about letting things happen, not making them happen?<br /><br />Reflecting on ideas drawn from philosophy, religion, literature, psychology, and self-help, Burkeman explores practical tools and shifts in perspective. The result is a bracing challenge to much familiar advice, and a profound yet entertaining crash course in living more fully.<br /><br /><b>To be read either as a four-week retreat of the mind or devoured in one or two sittings, <i>Meditations for Mortals</i> will be a source of solace and inspiration, and an aid to a saner, freer, and more enchantment-filled life. In anxiety-inducing times, it is rich in truths we have never needed more.</b>","num_pages":208,"authors":{"author":{"id":4384050,"name":"Oliver Burkeman","role":"","image_url":"https://images.gr-assets.com/authors/1394595901p5/4384050.jpg","small_image_url":"https://images.gr-assets.com/authors/1394595901p2/4384050.jpg","link":"https://www.goodreads.com/author/show/4384050.Oliver_Burkeman","average_rating":4.17,"ratings_count":156846,"text_reviews_count":15877}},"average_rating":4.27,"ratings_count":14641,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26530355-misbehaving","title":"Misbehaving: The Making of Behavioral Economics","title_without_series":"Misbehaving: The Making of Behavioral Economics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459531022l/26530355._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459531022l/26530355._SX98_.jpg","description":"Nobel laureate Richard H. Thaler has spent his career studying the radical notion that the central agents in the economy are humanspredictable, error-prone individuals. <em>Misbehaving</em> is his arresting, frequently hilarious account of the struggle to bring an academic discipline back down to earthand change the way we think about economics, ourselves, and our world.<br /><br />Traditional economics assumes rational actors. Early in his research, Thaler realized these Spock-like automatons were nothing like real people. Whether buying a clock radio, selling basketball tickets, or applying for a mortgage, we all succumb to biases and make decisions that deviate from the standards of rationality assumed by economists. In other words, we misbehave. More importantly, our misbehavior has serious consequences. Dismissed at first by economists as an amusing sideshow, the study of human miscalculations and their effects on markets now drives efforts to make better decisions in our lives, our businesses, and our governments.<br /><br />Coupling recent discoveries in human psychology with a practical understanding of incentives and market behavior, Thaler enlightens readers about how to make smarter decisions in an increasingly mystifying world. He reveals how behavioral economic analysis opens up new ways to look at everything from household finance to assigning faculty offices in a new building, to TV game shows, the NFL draft, and businesses like Uber.<br /><br />Laced with antic stories of Thalers spirited battles with the bastions of traditional economic thinking, <em>Misbehaving</em> is a singular look into profound human foibles. When economics meets psychology, the implications for individuals, managers, and policy makers are both profound and entertaining.","num_pages":358,"authors":{"author":{"id":65483,"name":"Richard H. Thaler","role":"","image_url":"https://images.gr-assets.com/authors/1438885744p5/65483.jpg","small_image_url":"https://images.gr-assets.com/authors/1438885744p2/65483.jpg","link":"https://www.goodreads.com/author/show/65483.Richard_H_Thaler","average_rating":3.9,"ratings_count":118306,"text_reviews_count":6852}},"average_rating":4.16,"ratings_count":23478,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50358103-money","title":"Money: The True Story of a Made-Up Thing","title_without_series":"Money: The True Story of a Made-Up Thing","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1585192145l/50358103._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1585192145l/50358103._SX98_.jpg","description":"Money only works because we all agree to believe in it. In <i>Money</i>, Jacob Goldstein shows how money is a useful fiction that has shaped societies for thousands of years, from the rise of coins in ancient Greece to the first stock market in Amsterdam to the emergence of shadow banking in the 21st century.<br />At the heart of the story are the fringe thinkers and world leaders who reimagined money. Kublai Khan, the Mongol emperor, created paper money backed by nothing, centuries before it appeared in the west. John Law, a professional gambler and convicted murderer, brought modern money to France (and destroyed the country's economy). The cypherpunks, a group of radical libertarian computer programmers, paved the way for bitcoin.<br />One thing they all realized: what counts as money (and what doesn't) is the result of choices we make, and those choices have a profound effect on who gets more stuff and who gets less, who gets to take risks when times are good, and who gets screwed when things go bad.<br />Lively, accessible, and full of interesting details (like the 43-pound copper coins that 17th-century Swedes carried strapped to their backs), <i>Money</i> is the story of the choices that gave us money as we know it today.<b>\\n  <br />\\n</b><br /><b>The co-host of the popular NPR podcast <i>Planet Money </i>provides a well-researched, entertaining, somewhat irreverent look at how money is a made-up thing that has evolved over time to suit humanity's changing needs.</b><b>\\n  <br />\\n</b>","num_pages":272,"authors":{"author":{"id":1000751,"name":"Jacob Goldstein","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1000751.Jacob_Goldstein","average_rating":4.19,"ratings_count":6475,"text_reviews_count":787}},"average_rating":4.19,"ratings_count":6475,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1301.Moneyball","title":"Moneyball","title_without_series":"Moneyball","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"Billy Beane, general manager of MLB's Oakland A's and protagonist of Michael Lewis's <i>Moneyball</i>, had a problem: how to win in the Major Leagues with a budget that's smaller than that of nearly every other team. Conventional wisdom long held that big name, highly athletic hitters and young pitchers with rocket arms were the ticket to success. But Beane and his staff, buoyed by massive amounts of carefully interpreted statistical data, believed that wins could be had by more affordable methods such as hitters with high on-base percentage and pitchers who get lots of ground outs. Given this information and a tight budget, Beane defied tradition and his own scouting department to build winning teams of young affordable players and inexpensive castoff veterans. <p> Lewis was in the room with the A's top management as they spent the summer of 2002 adding and subtracting players and he provides outstanding play-by-play. In the June player draft, Beane acquired nearly every prospect he coveted (few of whom were coveted by other teams) and at the July trading deadline he engaged in a tense battle of nerves to acquire a lefty reliever. Besides being one of the most insider accounts ever written about baseball, <i>Moneyball</i> is populated with fascinating characters. We meet Jeremy Brown, an overweight college catcher who most teams project to be a 15th round draft pick (Beane takes him in the first). Sidearm pitcher Chad Bradford is plucked from the White Sox triple-A club to be a key set-up man and catcher Scott Hatteberg is rebuilt as a first baseman. But the most interesting character is Beane himself. A speedy athletic can't-miss prospect who somehow missed, Beane reinvents himself as a front-office guru, relying on players completely unlike, say, Billy Beane. Lewis, one of the top nonfiction writers of his era (<i>Liar's Poker</i>, <i>The New New Thing</i>), offers highly accessible explanations of baseball stats and his roadmap of Beane's economic approach makes <i>Moneyball</i> an appealing reading experience for business people and sports fans alike. <i>--John Moe</i></p>","num_pages":317,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":4.27,"ratings_count":143648,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6346975-moonwalking-with-einstein","title":"Moonwalking with Einstein: The Art and Science of Remembering Everything","title_without_series":"Moonwalking with Einstein: The Art and Science of Remembering Everything","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630575238l/6346975._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630575238l/6346975._SX98_.jpg","description":"<b>The blockbuster phenomenon that charts an amazing journey of the mind while revolutionizing our concept of memory</b><br /><br />An instant bestseller that is poised to become a classic, <i>Moonwalking with Einstein</i> recounts Joshua Foer's yearlong quest to improve his memory under the tutelage of top \\"mental athletes.\\" He draws on cutting-edge research, a surprising cultural history of remembering, and venerable tricks of the mentalist's trade to transform our understanding of human memory. From the United States Memory Championship to deep within the author's own mind, this is an electrifying work of journalism that reminds us that, in every way that matters, we are the sum of our memories.","num_pages":307,"authors":{"author":{"id":2867569,"name":"Joshua Foer","role":"","image_url":"https://images.gr-assets.com/authors/1322436441p5/2867569.jpg","small_image_url":"https://images.gr-assets.com/authors/1322436441p2/2867569.jpg","link":"https://www.goodreads.com/author/show/2867569.Joshua_Foer","average_rating":3.91,"ratings_count":102272,"text_reviews_count":8088}},"average_rating":3.88,"ratings_count":93870,"publication_day":3,"publication_month":3,"publication_year":2011},{"link":"https://www.goodreads.com/book/show/220493539-moral-ambition","title":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","title_without_series":"Moral Ambition: Stop Wasting Your Talent and Start Making a Difference","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>THE ANTIDOTE TO APATHY FROM THE INTERNATIONALLY BESTSELLING AUTHOR RUTGER BREGMAN</b><br /><b>\\n  <br />\\n</b><b>'The Dutch historian who is making waves' Dan Snow, <i>History Hits</i></b><br /><br /><b>A forty-year, full-time career consists of around 80,000 hours, or 10,000 workdays, or 2,000 work weeks. How you spend that time is the most important moral decision of your life. </b><br /><br />In <i>Moral Ambition</i>, internationally-bestselling author Rutger Bregman shows us it is possible to be both successful and idealistic by placing a drive for meaning and change at the centre of our lives. Looking at the impact of several heroes of history, he what qualities do these social pioneers have in common? What made them so persuasive, influential and effective that they could not be ignored? How can we develop those qualities, too? <br /><br />Rutger argues that anyone can dedicate their abilities  and their time  to finding the best solutions to the world's biggest problems. The most influential people aren't two or five or ten times as influential; but a hundred, a thousand, or a million times. This book will show you how to be one of those people. It might not make your life easier, but it will make it more satisfying and consequential and, perhaps, you too could become one of history's heroes.<br /><br /><b>PRAISE FOR RUTGER </b><br /><b>'An almost indecently readable style' Jonathan Freedland</b><br /><b>'One of the best young writers we have' Owen Jones</b><br /><b>'21st-century readers are short on prophets, especially the optimistic kind, and will give this one a cheerful hearing' <i>Economist </i></b>","num_pages":"","authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.22,"ratings_count":137733,"text_reviews_count":14039}},"average_rating":3.74,"ratings_count":9876,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17986418-naked-statistics","title":"Naked Statistics: Stripping the Dread from the Data","title_without_series":"Naked Statistics: Stripping the Dread from the Data","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395613778l/17986418._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395613778l/17986418._SX98_.jpg","description":"Once considered tedious, the field of statistics is rapidly evolving into a discipline Hal Varian, chief economist at Google, has actually called sexy. From batting averages and political polls to game shows and medical research, the real-world application of statistics continues to grow by leaps and bounds. How can we catch schools that cheat on standardized tests? How does Netflix know which movies youll like? What is causing the rising incidence of autism? As best-selling author Charles Wheelan shows us in <em>Naked Statistics</em>, the right data and a few well-chosen statistical tools can help us answer these questions and more.<br />For those who slept through Stats 101, this book is a lifesaver. Wheelan strips away the arcane and technical details and focuses on the underlying intuition that drives statistical analysis. He clarifies key concepts such as inference, correlation, and regression analysis, reveals how biased or careless parties can manipulate or misrepresent data, and shows us how brilliant and creative researchers are exploiting the valuable data from natural experiments to tackle thorny questions.<br /><br /><br />And in Wheelans trademark style, theres not a dull page in sight. Youll encounter clever Schlitz Beer marketers leveraging basic probability, an International Sausage Festival illuminating the tenets of the central limit theorem, and a head-scratching choice from the famous game show <em>Lets Make a Deal</em>and youll come away with insights each time. With the wit, accessibility, and sheer fun that turned <em>Naked Economics</em> into a bestseller, Wheelan defies the odds yet again by bringing another essential, formerly unglamorous discipline to life.","num_pages":304,"authors":{"author":{"id":18704,"name":"Charles Wheelan","role":"","image_url":"https://images.gr-assets.com/authors/1456860234p5/18704.jpg","small_image_url":"https://images.gr-assets.com/authors/1456860234p2/18704.jpg","link":"https://www.goodreads.com/author/show/18704.Charles_Wheelan","average_rating":4.02,"ratings_count":42604,"text_reviews_count":3902}},"average_rating":3.96,"ratings_count":15074,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/3949642-nepal---culture-smart","title":"Nepal - Culture Smart!: The Essential Guide to Customs & Culture (16)","title_without_series":"Nepal - Culture Smart!: The Essential Guide to Customs & Culture","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320559416l/3949642._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320559416l/3949642._SX98_.jpg","description":"Culture Smart! provides essential information on attitudes, beliefs and behavior in different countries, ensuring that you arrive at your destination aware of basic manners, common courtesies, and sensitive issues. These concise guides tell you what to expect, how to behave, and how to establish a rapport with your hosts. This inside knowledge will enable you to steer clear of embarrassing gaffes and mistakes, feel confident in unfamiliar situations, and develop trust, friendships, and successful business relationships.<br /><br />Culture Smart! offers illuminating insights into the culture and society of a particular country. It will help you to turn your visit-whether on business or for pleasure-into a memorable and enriching experience. Contents include:<br /><br />* customs, values, and traditions<br />* historical, religious, and political background<br />* life at home<br />* leisure, social, and cultural life<br />* eating and drinking<br />* do's, don'ts, and taboos<br />* business practices<br />* communication, spoken and unspoken<br /><br />\\"Culture Smart has come to the rescue of hapless travellers.\\" <i>Sunday Times Travel<br /><br /></i>\\"... the perfect introduction to the weird, wonderful and downright odd quirks and customs of various countries.\\" <i>Global Travel<br /><br /></i>\\"...full of fascinating-as well as common-sense-tips to help you avoid embarrassing faux pas.\\" <i>Observer<br /><br /></i>\\"...as useful as they are entertaining.\\" <i>Easyjet Magazine<br /><br /></i>\\"...offer glimpses into the psyche of a faraway world.\\" <i>New York Times</i>","num_pages":"","authors":{"author":{"id":1684350,"name":"Tessa Feller","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1684350.Tessa_Feller","average_rating":3.96,"ratings_count":198,"text_reviews_count":13}},"average_rating":3.97,"ratings_count":175,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/36258318-netherlands---culture-smart","title":"Netherlands - Culture Smart!: The Essential Guide to Customs & Culture","title_without_series":"Netherlands - Culture Smart!: The Essential Guide to Customs & Culture","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1527525724l/36258318._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1527525724l/36258318._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":1104428,"name":"Sheryl Buckland","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/1104428.Sheryl_Buckland","average_rating":4.04,"ratings_count":135,"text_reviews_count":8}},"average_rating":3.99,"ratings_count":76,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50772888-no-filter","title":"No Filter: The Inside Story of Instagram","title_without_series":"No Filter: The Inside Story of Instagram","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>Award-winning reporter Sarah Frier reveals an inside, never-before-told, behind-the-scenes look at how Instagram defied the odds to become one of the most culturally defining apps of the decade. </b><br /><br />Since its creation in 2010, Instagrams fun and simple interface has captured our collective imagination, swiftly becoming a way of life. In <i>No Filter: The Inside Story of Instagram</i>, technology reporter Sarah Frier explains how Instagrams founders married art and technology to overcome skeptics and to hook the public on visual storytelling. At first, Instagram initially attracted artisans, but then the platform exploded in popularity among the masses, creating an entire industry of digital influencers thats now worth tens of billions of dollars.<br /><br />Eighteen months after Instagrams launch and explosive growth, the founders made the gut-wrenching decision to sell the company to Facebook. For most companies, that would be the end of the story; but for Instagram, it was only the beginning. Instagram borrowed some lessons from Facebook and rejected others, until eventually its success stirred tension with Facebooks CEO Mark Zuckerberg, just as Facebook became embroiled in a string of public crises. Frier unearths the details that led to the cofoundersKevin Systrom and Mike Kriegerdeparture, bringing to light dramatic moments unknown to the public until now.<br /><br />At its heart, <i>No Filter</i> draws on unprecedented exclusive accessfrom the founders of Instagram, as well as employees, executives, and competitors; hedge fund billionaire Ray Dalio; Anna Wintour of <i>Vogue</i>; Kris Jenner of the Kardashian-Jenner empire; and a plethora of influencers, from fashionistas with millions of followers to owners of famous dogs worldwideto show how Instagram has fundamentally changed the way we communicate, shop, eat, and travel. The book brings readers inside users strategies to craft their personal image and fame, explaining how the companys product decisions have affected the structure of our society. From teenagers to the pope, <i>No Filter </i>tells the captivating story of how Instagram not only created a new industry but also changed our lives.","num_pages":"","authors":{"author":{"id":19284946,"name":"Sarah Frier","role":"","image_url":"https://images.gr-assets.com/authors/1566424706p5/19284946.jpg","small_image_url":"https://images.gr-assets.com/authors/1566424706p2/19284946.jpg","link":"https://www.goodreads.com/author/show/19284946.Sarah_Frier","average_rating":4.11,"ratings_count":10844,"text_reviews_count":1229}},"average_rating":4.11,"ratings_count":10847,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18213403-no-place-to-hide","title":"No Place to Hide: Edward Snowden, the NSA, and the U.S. Surveillance State","title_without_series":"No Place to Hide: Edward Snowden, the NSA, and the U.S. Surveillance State","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383352779l/18213403._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383352779l/18213403._SX98_.jpg","description":"<b>By Glenn Greenwald, star of <i>Citizenfour</i>, the Academy Award-winning documentary on Edward Snowden</b><br /><br />In May 2013, Glenn Greenwald set out for Hong Kong to meet an anonymous source who claimed to have astonishing evidence of pervasive government spying and insisted on communicating only through heavily encrypted channels. That source turned out to be the twenty-nine-year-old NSA contractor Edward Snowden, and his revelations about the agency's widespread, systemic overreach proved to be some of the most explosive and consequential news in recent history, triggering a fierce debate over national security and information privacy.<br /><br />Now Greenwald fits all the pieces together, recounting his high-intensity eleven-day trip to Hong Kong, examining the broader implications of the surveillance detailed in his reporting for <i>The Guardian</i>, and revealing fresh information on the NSA's unprecedented abuse of power with documents from the Snowden archive. Fearless and incisive, <i>No Place to Hide</i> has already sparked outrage around the globe and been hailed by voices across the political spectrum as an essential contribution to our understanding of the U.S. surveillance state.","num_pages":260,"authors":{"author":{"id":205996,"name":"Glenn Greenwald","role":"","image_url":"https://images.gr-assets.com/authors/1371508181p5/205996.jpg","small_image_url":"https://images.gr-assets.com/authors/1371508181p2/205996.jpg","link":"https://www.goodreads.com/author/show/205996.Glenn_Greenwald","average_rating":4.06,"ratings_count":17980,"text_reviews_count":1710}},"average_rating":4.07,"ratings_count":15036,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/49099937-no-rules-rules","title":"No Rules Rules: Netflix and the Culture of Reinvention","title_without_series":"No Rules Rules: Netflix and the Culture of Reinvention","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1595815356l/49099937._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1595815356l/49099937._SX98_.jpg","description":"<b>Shortlisted for the 2020 Financial Times &amp; McKinsey Business Book of the Year </b><br /><br /><b>\\n  <b>Netflix cofounder Reed Hastings reveals for the first time the unorthodox culture behind one of the world's most innovative, imaginative, and successful companies</b>\\n</b><br /><br />There has never before been a company like Netflix. It has led nothing short of a revolution in the entertainment industries, generating billions of dollars in annual revenue while capturing the imaginations of hundreds of millions of people in over 190 countries. But to reach these great heights, Netflix, which launched in 1998 as an online DVD rental service, has had to reinvent itself over and over again. This type of unprecedented flexibility would have been impossible without the counterintuitive and radical management principles that cofounder Reed Hastings established from the very beginning. Hastings rejected the conventional wisdom under which other companies operate and defied tradition to instead build a culture focused on freedom and responsibility, one that has allowed Netflix to adapt and innovate as the needs of its members and the world have simultaneously transformed.<br /><br />Hastings set new standards, valuing people over process, emphasizing innovation over efficiency, and giving employees context, not controls. At Netflix, there are no vacation or expense policies. At Netflix, adequate performance gets a generous severance, and hard work is irrel-evant. At Netflix, you don't try to please your boss, you give candid feedback instead. At Netflix, employees don't need approval, and the company pays top of market. When Hastings and his team first devised these unorthodox principles, the implications were unknown and untested. But in just a short period, their methods led to unparalleled speed and boldness, as Netflix quickly became one of the most loved brands in the world.<br /><br />Here for the first time, Hastings and Erin Meyer, bestselling author of <i>The Culture Map </i>and one of the world's most influential business thinkers, dive deep into the controversial ideologies at the heart of the Netflix psyche, which have generated results that are the envy of the business world. Drawing on hundreds of interviews with current and past Netflix employees from around the globe and never-before-told stories of trial and error from Hastings's own career, <i>No Rules Rules </i>is the fascinating and untold account of the philosophy behind one of the world's most innovative, imaginative, and successful companies.","num_pages":"","authors":{"author":{"id":19792006,"name":"Reed Hastings","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/19792006.Reed_Hastings","average_rating":4.27,"ratings_count":32534,"text_reviews_count":2774}},"average_rating":4.27,"ratings_count":32542,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17161156-norwegian-wood","title":"Norwegian Wood","title_without_series":"Norwegian Wood","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1493851993l/17161156._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1493851993l/17161156._SX98_.jpg","description":"The haunting, enigmatic love story that turned Murakami into a literary superstar in Japan, and is his bestselling title throughout the world <br /><br />When he hears her favourite Beatles song, Toru Watanabe recalls his first love Naoko, the girlfriend of his best friend Kizuki. Immediately he is transported back almost twenty years to his student days in Tokyo, adrift in a world of uneasy friendships, casual sex, passion, loss and desire - to a time when an impetuous young woman called Midori marches into his life and he has to choose between the future and the past.","num_pages":389,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4190455,"text_reviews_count":359110}},"average_rating":3.99,"ratings_count":720492,"publication_day":4,"publication_month":7,"publication_year":2003},{"link":"https://www.goodreads.com/book/show/17662487-nudge","title":"Nudge: Improving Decisions About Health, Wealth, and Happiness","title_without_series":"Nudge: Improving Decisions About Health, Wealth, and Happiness","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1363727799l/17662487._SX98_.jpg","description":"For fans of Malcolm Gladwells Blink and Nobel Prize winner Daniel Kahnemans Thinking Fast and Slow, a revelatory new look at how we make decisions<br /><br />A New York Times bestseller<br />An Economist Best Book of the Year<br />A Financial Times Best Book of the Year<br /><br />Nudge is about choiceshow we make them and how we can make better ones. Drawing on decades of research in the fields of behavioral science and economics, authors Richard H. Thaler and Cass R. Sunstein offer a new perspective on preventing the countless mistakes we makeill-advised personal investments, consumption of unhealthy foods, neglect of our natural resourcesand show us how sensible choice architecture can successfully nudge people toward the best decisions. In the tradition of The Tipping Point and Freakonomics, Nudge is straightforward, informative, and entertaininga must-read for anyone interested in our individual and collective well-being.","num_pages":324,"authors":{"author":{"id":65483,"name":"Richard H. Thaler","role":"","image_url":"https://images.gr-assets.com/authors/1438885744p5/65483.jpg","small_image_url":"https://images.gr-assets.com/authors/1438885744p2/65483.jpg","link":"https://www.goodreads.com/author/show/65483.Richard_H_Thaler","average_rating":3.9,"ratings_count":118306,"text_reviews_count":6852}},"average_rating":3.84,"ratings_count":94207,"publication_day":24,"publication_month":2,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/50705179-numbers-don-t-lie","title":"Numbers Don't Lie: 71 Things You Need to Know About the World","title_without_series":"Numbers Don't Lie: 71 Things You Need to Know About the World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1666542864l/50705179._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1666542864l/50705179._SX98_.jpg","description":"<b>Is flying dangerous? How much do the world's cows weigh? And what makes people happy?</b><br /><br />From earth's nations and inhabitants, through the fuels and foods that energize them, to the transportation and inventions of our modern world - and how all of this affects the planet itself - in <i>Numbers Don't Lie</i>, Professor Vaclav Smil takes us on a fact-finding adventure, using surprising statistics and illuminating graphs to challenge lazy thinking.<br /><br />Packed with 'well-I-never-knew-that' information and with fascinating and unusual examples throughout, we see how it is too soon to judge shale gas, that vaccination yields the best return on investment, and why electric cars aren't as great as we think (yet). There's a wonderful mix of science, history and wit, all in bite-sized chapters on a broad range of topics.<br /><br /><b>Should you trust unemployment figures? Is China's rise unstoppable? And what's worse for the environment: your car or mobile phone?</b><br /><br />Unclouded by pessimism or optimism and unafraid of big questions, Smil explains why calls for the Anthropocene era may be premature but why the Paris Agreement does not go far enough. These issues are not straightforward and progress takes longer than you think, but with Smil as our authoritative and entertaining guide we get a healthy shot of realism.<br /><br />Urgent and essential, <i>Numbers Don't Lie</i> is a powerful rallying cry for interrogating what you take to be true in these significant times. Smil is on a mission to make facts matter, because after all, numbers may not lie, but which truth do they convey?","num_pages":384,"authors":{"author":{"id":5003,"name":"Vaclav Smil","role":"","image_url":"https://images.gr-assets.com/authors/1619861469p5/5003.jpg","small_image_url":"https://images.gr-assets.com/authors/1619861469p2/5003.jpg","link":"https://www.goodreads.com/author/show/5003.Vaclav_Smil","average_rating":3.9,"ratings_count":38923,"text_reviews_count":3991}},"average_rating":3.83,"ratings_count":10309,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/35890182-on-confidence","title":"On Confidence","title_without_series":"On Confidence","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"","num_pages":"","authors":{"author":{"id":6509498,"name":"The School of Life","role":"","image_url":"https://images.gr-assets.com/authors/1479529978p5/6509498.jpg","small_image_url":"https://images.gr-assets.com/authors/1479529978p2/6509498.jpg","link":"https://www.goodreads.com/author/show/6509498.The_School_of_Life","average_rating":3.99,"ratings_count":46175,"text_reviews_count":5501}},"average_rating":3.92,"ratings_count":3403,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/3228917-outliers","title":"Outliers: The Story of Success","title_without_series":"Outliers: The Story of Success","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1344266315l/3228917._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1344266315l/3228917._SX98_.jpg","description":"In this stunning book, Malcolm Gladwell takes us on an intellectual journey through the world of \\"outliers\\"the best and the brightest, the most famous and the most successful. He asks the question: what makes high-achievers different?<br /><br />His answer is that we pay too much attention to what successful people are like, and too little attention to where they are from: that is, their culture, their family, their generation, and the idiosyncratic experiences of their upbringing. Along the way he explains the secrets of software billionaires, what it takes to be a great soccer player, why Asians are good at math, and what made the Beatles the greatest rock band.","num_pages":309,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3144403,"text_reviews_count":130486}},"average_rating":4.19,"ratings_count":859686,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/46223297-permanent-record","title":"Permanent Record","title_without_series":"Permanent Record","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564666396l/46223297._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1564666396l/46223297._SX98_.jpg","description":"Edward Snowden, the man who risked everything to expose the US governments system of mass surveillance, reveals for the first time the story of his life, including how he helped to build that system and what motivated him to try to bring it down.<br /><br />In 2013, twenty-nine-year-old Edward Snowden shocked the world when he broke with the American intelligence establishment and revealed that the United States government was secretly pursuing the means to collect every single phone call, text message, and email. The result would be an unprecedented system of mass surveillance with the ability to pry into the private lives of every person on earth. Six years later, Snowden reveals for the very first time how he helped to build this system and why he was moved to expose it.<br /><br />Spanning the bucolic Beltway suburbs of his childhood and the clandestine CIA and NSA postings of his adulthood, <i>Permanent Record</i> is the extraordinary account of a bright young man who grew up onlinea man who became a spy, a whistleblower, and, in exile, the Internets conscience. Written with wit, grace, passion, and an unflinching candor, <i>Permanent Record</i> is a crucial memoir of our digital age and destined to be a classic.","num_pages":339,"authors":{"author":{"id":7140597,"name":"Edward Snowden","role":"","image_url":"https://images.gr-assets.com/authors/1425078029p5/7140597.jpg","small_image_url":"https://images.gr-assets.com/authors/1425078029p2/7140597.jpg","link":"https://www.goodreads.com/author/show/7140597.Edward_Snowden","average_rating":4.29,"ratings_count":57911,"text_reviews_count":5315}},"average_rating":4.3,"ratings_count":57564,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25135194-prisoners-of-geography","title":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics (Politics of Place, #1)","title_without_series":"Prisoners of Geography: Ten Maps That Tell You Everything You Need to Know About Global Politics","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1432827094l/25135194._SX98_.jpg","description":"<i>Geography shapes not only our history, but where we're headed...</i><br /><br />All leaders are constrained by geography. Their choices are limited by mountains, rivers, seas and concrete. Yes, to follow world events you need to understand people, ideas and movements - but if you don't know geography, you'll never have the full picture.<br /><br />If you've ever wondered why Putin is so obsessed with Crimea, why the USA was destined to become a global superpower, or why China's power base continues to expand ever outwards, the answers are all here.<br /><br /><b>In ten chapters and ten maps, <i>Prisoners of Geography</i> looks at the past, present and future to offer an essential insight into one of the major factors that determines world history.<br /><br />It's time to put the 'geo' back into geopolitics.<br /><br />Ten maps; ten chapters:<br /><br />Russia * China * United States of America * Latin America * the Middle East * Africa * India and Pakistan * Europe * Japan and Korea * the Arctic</b>","num_pages":256,"authors":{"author":{"id":713466,"name":"Tim  Marshall","role":"","image_url":"https://images.gr-assets.com/authors/1489696759p5/713466.jpg","small_image_url":"https://images.gr-assets.com/authors/1489696759p2/713466.jpg","link":"https://www.goodreads.com/author/show/713466.Tim_Marshall","average_rating":4.14,"ratings_count":163367,"text_reviews_count":13540}},"average_rating":4.19,"ratings_count":115061,"publication_day":9,"publication_month":7,"publication_year":2015},{"link":"https://www.goodreads.com/book/show/54493401-project-hail-mary","title":"Project Hail Mary","title_without_series":"Project Hail Mary","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1764703833l/54493401._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1764703833l/54493401._SX98_.jpg","description":"<b>A LONE ASTRONAUT. <br />AN IMPOSSIBLE MISSION. <br />AN ALLY HE NEVER IMAGINED.</b><br /><br /><b> RYLAND GRACE</b> is the sole survivor on a desperate, last-chance missionand if he fails, humanity and Earth itself will perish.<br /><br />Except that right now, he doesnt know that. He cant even remember his own name, let alone the nature of his assignment or how to complete it.<br /><br />All he knows is that hes been asleep for a very, very long time. And hes just been awakened to find himself millions of miles from home, with nothing but two corpses for company.<br /><br />His crewmates dead, his memories fuzzily returning, Ryland realizes that an impossible task now confronts him. Hurtling through space on this tiny ship, its up to him to puzzle out an impossible scientific mysteryand conquer an extinction-level threat to our species.<br /><br />And with the clock ticking down and the nearest human being light-years away, hes got to do it all alone.<br /><br />Or does he?<br /><br />An irresistible interstellar adventure as only Andy Weir could imagine it, <i>Project Hail Mary</i> is a tale of discovery, speculation, and survival to rival <i>The Martian</i>while taking us to places it never dreamed of going.","num_pages":476,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.34,"ratings_count":2739668,"text_reviews_count":277652}},"average_rating":4.5,"ratings_count":1043225,"publication_day":4,"publication_month":5,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/8520610-quiet","title":"Quiet: The Power of Introverts in a World That Can't Stop Talking","title_without_series":"Quiet: The Power of Introverts in a World That Can't Stop Talking","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328562861l/8520610._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328562861l/8520610._SX98_.jpg","description":"<b>The book that started the Quiet Revolution<br /></b><br />At least one-third of the people we know are introverts. They are the ones who prefer listening to speaking; who innovate and create but dislike self-promotion; who favor working on their own over working in teams. It is to introvertsRosa Parks, Chopin, Dr. Seuss, Steve Wozniakthat we owe many of the great contributions to society.<br /><br />In <i>Quiet, </i>Susan Cain argues that we dramatically undervalue introverts and shows how much we lose in doing so. She charts the rise of the Extrovert Ideal throughout the twentieth century and explores how deeply it has come to permeate our culture. She also introduces us to successful introvertsfrom a witty, high-octane public speaker who recharges in solitude after his talks, to a record-breaking salesman who quietly taps into the power of questions. Passionately argued, superbly researched, and filled with indelible stories of real people, <i>Quiet </i>has the power to permanently change how we see introverts and, equally important, how they see themselves.<br /><br />Now with Extra Libris material, including a readers guide and bonus content.","num_pages":333,"authors":{"author":{"id":4101935,"name":"Susan Cain","role":"","image_url":"https://images.gr-assets.com/authors/1644435084p5/4101935.jpg","small_image_url":"https://images.gr-assets.com/authors/1644435084p2/4101935.jpg","link":"https://www.goodreads.com/author/show/4101935.Susan_Cain","average_rating":4.07,"ratings_count":507187,"text_reviews_count":35666}},"average_rating":4.08,"ratings_count":472298,"publication_day":24,"publication_month":1,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/63018232-random-acts-of-medicine","title":"Random Acts of Medicine: The Hidden Forces That Sway Doctors, Impact Patients, and Shape Our Health","title_without_series":"Random Acts of Medicine: The Hidden Forces That Sway Doctors, Impact Patients, and Shape Our Health","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684815163l/63018232._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1684815163l/63018232._SX98_.jpg","description":"Does timing, circumstance, or luck impact your health care? This groundbreaking book reveals the hidden side of medicine and how unexpectedbut predictableevents can profoundly affect our health.  Is there ever a good time to have a heart attack? Why do kids born in the summer get diagnosed more often with A.D.H.D.? How are marathons harmful for your health, even when you're not running?<br /><br />\\"Fantastically entertaining and deeply thought-provoking.\\" Emily Oster, New York Times bestselling author of The Family Firm, Cribsheet, and Expecting Better<br /><br />\\"Smart, entertaining, and full of surprises.\\" Steven D. Levitt, #1 New York Times bestselling co-author of Freakonomics<br /><br />As a University of Chicagotrained economist and Harvard medical school professor and doctor, Anupam Jena is uniquely equipped to answer these questions. And as a critical care doctor at Massachusetts General who researches health care policy, Christopher Worsham confronts their impact on the hospitals sickest patients. In this singular work of science and medicine, Jena and Worsham show us how medicine really works, and its effect on all of us.<br /><br />Relying on ingeniously devised natural experimentsrandom events that unknowingly turn us into experimental subjectsJena and Worsham do more than offer readers colorful stories. They help us see the way our health is shaped by forces invisible to the untrained eye. Is there ever a good time to have a heart attack? Do you choose the veteran doctor or the rookie? Do you really need the surgery your doctor recommends? These questions are rife with significance; their impact can be life changing. Addressing them in a style thats both animated and enlightening, Random Acts of Medicine empowers you to see past the white coat and find out what really makes medicine workand how it could work better.","num_pages":"","authors":{"author":{"id":4269933,"name":"Anupam B. Jena","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/4269933.Anupam_B_Jena","average_rating":3.69,"ratings_count":1716,"text_reviews_count":249}},"average_rating":3.69,"ratings_count":1716,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/44000528-range","title":"Range: Why Generalists Triumph in a Specialized World","title_without_series":"Range: Why Generalists Triumph in a Specialized World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550048363l/44000528._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1550048363l/44000528._SX98_.jpg","description":"What's the most effective path to success in any domain? It's not what you think.<br /><br />Plenty of experts argue that anyone who wants to develop a skill, play an instrument, or lead their field should start early, focus intensely, and rack up as many hours of deliberate practice as possible. If you dabble or delay, you'll never catch up to the people who got a head start. But if you take a closer look at the world's top performers, from professional athletes to Nobel laureates, you'll find that early specialisation is the exception, not the rule. <br /><br />David Epstein, author of the <i>New York Times</i> bestseller <i>The Sports Gene</i>, studied the world's most successful athletes, artists, musicians, inventors, forecasters and scientists. He discovered that in most fields--especially those that are complex and unpredictable--generalists, not specialists, are primed to excel. Generalists often find their path late, and they juggle many interests rather than focusing on one. They're also more creative, more agile, and able to make connections their more specialized peers can't spy from deep in their hyperfocused trenches. As experts silo themselves further while computers master more of the skills once reserved for highly focused humans, people who think broadly and embrace diverse experiences and perspectives will increasingly thrive. <br /><br />Our obsession with getting a head start is understandable; early specialization feels efficient. But Epstein marshals an enormous body of scientific research to argue that we should all actively cultivate inefficiency. Failing a test is the best way to learn. Frequent quitters end up with the most fulfilling careers. The most impactful inventors cross domains rather than deepening their knowledge in a single area. Provocative, rigorous, and engrossing, <i>Range</i> explains how to maintain the benefits of breadth, diverse experience, interdisciplinary thinking, and delayed concentration in a world that increasingly incentivizes, even demands, hyperspecialization.","num_pages":339,"authors":{"author":{"id":7164089,"name":"David   Epstein","role":"","image_url":"https://images.gr-assets.com/authors/1545945759p5/7164089.jpg","small_image_url":"https://images.gr-assets.com/authors/1545945759p2/7164089.jpg","link":"https://www.goodreads.com/author/show/7164089.David_Epstein","average_rating":4.14,"ratings_count":95508,"text_reviews_count":8727}},"average_rating":4.13,"ratings_count":78610,"publication_day":28,"publication_month":5,"publication_year":2019},{"link":"https://www.goodreads.com/book/show/9969571-ready-player-one","title":"Ready Player One (Ready Player One, #1)","title_without_series":"Ready Player One","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1500930947l/9969571._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1500930947l/9969571._SX98_.jpg","description":"<i>Librarian's note: An alternate cover edition can be found <a href=\\"https://www.goodreads.com/book/show/54733514.here\\" title=\\"here\\" rel=\\"nofollow noopener\\">here</a></i><br /><br /><b>IN THE YEAR 2044, reality is an ugly place.</b> The only time teenage Wade Watts really feels alive is when he's jacked into the virtual utopia known as the OASIS. Wade's devoted his life to studying the puzzles hidden within this world's digital confines, puzzles that are based on their creator's obsession with the pop culture of decades past and that promise massive power and fortune to whoever can unlock them. <br /><br />But when Wade stumbles upon the first clue, he finds himself beset by players willing to kill to take this ultimate prize. The race is on, and if Wade's going to survive, he'll have to winand confront the real world he's always been so desperate to escape.","num_pages":480,"authors":{"author":{"id":31712,"name":"Ernest Cline","role":"","image_url":"https://images.gr-assets.com/authors/1310753539p5/31712.jpg","small_image_url":"https://images.gr-assets.com/authors/1310753539p2/31712.jpg","link":"https://www.goodreads.com/author/show/31712.Ernest_Cline","average_rating":4.08,"ratings_count":1606184,"text_reviews_count":146003}},"average_rating":4.23,"ratings_count":1289752,"publication_day":16,"publication_month":8,"publication_year":2011},{"link":"https://www.goodreads.com/book/show/216857785-revenge-of-the-tipping-point","title":"Revenge of the Tipping Point: Overstories, Superspreaders, and the Rise of Social Engineering","title_without_series":"Revenge of the Tipping Point: Overstories, Superspreaders, and the Rise of Social Engineering","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1721984170l/216857785._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1721984170l/216857785._SX98_.jpg","description":"Twenty-five years after the publication of his groundbreaking first book, Malcolm Gladwell returns with a brand-new volume that reframes the lessons of The Tipping Point in a startling and revealing light.<br /><br />Why is MiamiMiami? What does the heartbreaking fate of the cheetah tell us about the way we raise our children? Why do Ivy League schools care so much about sports? What is the Magic Third, and what does it mean for racial harmony? In this provocative new work, Malcolm Gladwell returns for the first time in twenty-five years to the subject of social epidemics and tipping points, this time with the aim of explaining the dark side of contagious phenomena.<br /> <br />Through a series of riveting stories, Gladwell traces the rise of a new and troubling form of social engineering. He takes us to the streets of Los Angeles to meet the worlds most successful bank robbers, rediscovers a forgotten television show from the 1970s that changed the world, visits the site of a historic experiment on a tiny cul-de-sac in northern California, and offers an alternate history of two of the biggest epidemics of our day: COVID and the opioid crisis. Revenge of the Tipping Point is Gladwells most personal book yet. With his characteristic mix of storytelling and social science, he offers a guide to making sense of the contagions of modern world. Its time we took tipping points seriously.","num_pages":352,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3144403,"text_reviews_count":130486}},"average_rating":4.02,"ratings_count":55195,"publication_day":1,"publication_month":10,"publication_year":2024},{"link":"https://www.goodreads.com/book/show/10144145-rich-dad-poor-dad","title":"Rich Dad Poor Dad: What the Rich Teach Their Kids About Money That the Poor and Middle Class Do Not!","title_without_series":"Rich Dad Poor Dad: What the Rich Teach Their Kids About Money That the Poor and Middle Class Do Not!","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328736124l/10144145._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1328736124l/10144145._SY160_.jpg","description":"<br /><i>Rich Dad Poor Dad</i>, the #1 Personal Finance book of all time, tells the story of <b>Robert Kiyosaki</b> and his two dadshis real father and the father of his best friend, his rich dadand the ways in which both men shaped his thoughts about money and investing. The book explodes the myth that you need to earn a high income to be rich and explains the difference between working for money and having your money work for you.","num_pages":275,"authors":{"author":{"id":600,"name":"Robert T. Kiyosaki","role":"","image_url":"https://images.gr-assets.com/authors/1236463010p5/600.jpg","small_image_url":"https://images.gr-assets.com/authors/1236463010p2/600.jpg","link":"https://www.goodreads.com/author/show/600.Robert_T_Kiyosaki","average_rating":4.09,"ratings_count":911185,"text_reviews_count":35695}},"average_rating":4.1,"ratings_count":715214,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/58284094-run-like-a-pro-even-if-you-re-slow","title":"Run Like a Pro (Even If You're Slow): Elite Tools and Tips for Runners at Every Level","title_without_series":"Run Like a Pro (Even If You're Slow): Elite Tools and Tips for Runners at Every Level","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1639201586l/58284094._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1639201586l/58284094._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":99585,"name":"Matt Fitzgerald","role":"","image_url":"https://images.gr-assets.com/authors/1631573197p5/99585.jpg","small_image_url":"https://images.gr-assets.com/authors/1631573197p2/99585.jpg","link":"https://www.goodreads.com/author/show/99585.Matt_Fitzgerald","average_rating":3.98,"ratings_count":36383,"text_reviews_count":2989}},"average_rating":4.06,"ratings_count":1250,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/124941268-same-as-ever","title":"Same as Ever: A Guide to What Never Changes","title_without_series":"Same as Ever: A Guide to What Never Changes","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350462l/124941268._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1685350462l/124941268._SX98_.jpg","description":"From Morgan Housel, bestselling author of The Psychology of Money , stories about what people have always done, and will always do<br /><br />Everyone wants to see the future. Few are good at it. From business to economics, politics to social trends, were just not very good at predicting what happens next.<br /><br />According to Morgan Housel, this is because we focus too much on what we think will change and not enough on what we know will stay the same.<br /><br />If you traveled in time to 500 years ago or 500 years from now, you would be astounded at how much technology and medicine has changed. The geopolitical order would make no sense to you. The language and dialect may be completely foreign. But youd notice people falling for greed and fear just like they do in our current world.<br /><br />Youd see people persuaded by risk, jealousy, and tribal affiliations in ways that are familiar to you.<br /><br />Youd see overconfidence and short-sightedness that reminds you of people's behavior today.<br /><br />Youd find people seeking the secret to a happy life and trying to find certainty when none exists in ways that are so relatable. <br /><br />When transported to an unfamiliar world, youd spend a few minutes watching people behave and say, Ah. Ive seen this before. Same as ever.<br /><br />History is filled with surprises no one could have seen coming. But if we learn to see what doesnt change, we can be more confident in our choices, no matter what the future brings.","num_pages":"","authors":{"author":{"id":7499284,"name":"Morgan Housel","role":"","image_url":"https://images.gr-assets.com/authors/1669719604p5/7499284.jpg","small_image_url":"https://images.gr-assets.com/authors/1669719604p2/7499284.jpg","link":"https://www.goodreads.com/author/show/7499284.Morgan_Housel","average_rating":4.28,"ratings_count":338821,"text_reviews_count":22445}},"average_rating":4.16,"ratings_count":22581,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23346740-sapiens","title":"Sapiens: A Brief History of Humankind","title_without_series":"Sapiens: A Brief History of Humankind","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1427068429l/23346740._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1427068429l/23346740._SX98_.jpg","description":"100,000 years ago, at least six human species inhabited the earth. Today there is just one. Us. <i>Homo sapiens</i>.<br /><br />How did our species succeed in the battle for dominance? Why did our foraging ancestors come together to create cities and kingdoms? How did we come to believe in gods, nations and human rights; to trust money, books and laws; and to be enslaved by bureaucracy, timetables and consumerism? And what will our world be like in the millennia to come?<br /><br />In <i>Sapiens, </i>Dr Yuval Noah Harari spans the whole of human history, from the very first humans to walk the earth to the radical  and sometimes devastating  breakthroughs of the Cognitive, Agricultural and Scientific Revolutions. Drawing on insights from biology, anthropology, palaeontology and economics, he explores how the currents of history have shaped our human societies, the animals and plants around us, and even our personalities. Have we become happier as history has unfolded? Can we ever free our behaviour from the heritage of our ancestors? And what, if anything, can we do to influence the course of the centuries to come?<br /><br />Bold, wide-ranging and provocative, <i>Sapiens </i>challenges everything we thought we knew about being human: our thoughts, our actions, our power ... and our future.","num_pages":498,"authors":{"author":{"id":395812,"name":"Yuval Noah Harari","role":"","image_url":"https://images.gr-assets.com/authors/1747080116p5/395812.jpg","small_image_url":"https://images.gr-assets.com/authors/1747080116p2/395812.jpg","link":"https://www.goodreads.com/author/show/395812.Yuval_Noah_Harari","average_rating":4.29,"ratings_count":1790118,"text_reviews_count":100100}},"average_rating":4.34,"ratings_count":1242924,"publication_day":4,"publication_month":9,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/19288230-scrum","title":"Scrum: The Art of Doing Twice the Work in Half the Time","title_without_series":"Scrum: The Art of Doing Twice the Work in Half the Time","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1393221649l/19288230._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1393221649l/19288230._SX98_.jpg","description":"In the future, historians may look back on human progress and draw a sharp line designating before Scrum and after Scrum. Scrum is that ground-breaking. It already drives most of the worlds top technology companies. And now its starting to spread to every domain where leaders wrestle with complex projects.<br /> <br />If youve ever been startled by how fast the world is changing, Scrum is one of the reasons why. Productivity gains of as much as 1200% have been recorded, and theres no more lucid  or compelling  explainer of Scrum and its bright promise than Jeff Sutherland, the man who put together the first Scrum team more than twenty years ago.<br /> <br />The thorny problem Jeff began tackling back then boils down to this: people are spectacularly bad at doing things with agility and efficiency. Best laid plans go up in smoke. Teams often work at cross purposes to each other. And when the pressure rises, unhappiness soars. Drawing on his experience as a West Point-educated fighter pilot, biometrics expert, early innovator of ATM technology, and V.P. of engineering or CTO at eleven different technology companies, Jeff began challenging those dysfunctional realities, looking for solutions that would have global impact.<br /> <br />In this book youll journey to Scrums front lines where Jeffs system of deep accountability, team interaction, and constant iterative improvement is, among other feats, bringing the FBI into the 21st century, perfecting the design of an affordable 140 mile per hour/100 mile per gallon car, helping NPR report fast-moving action in the Middle East, changing the way pharmacists interact with patients, reducing poverty in the Third World, and even helping people plan their weddings and accomplish weekend chores. <br /> <br />Woven with insights from martial arts, judicial decision making, advanced aerial combat, robotics, and many other disciplines, Scrum is consistently riveting. But the most important reason to read this book is that it may just help you achieve what others consider unachievable  whether it be inventing a trailblazing technology, devising a new system of education, pioneering a way to feed the hungry, or, closer to home, a building a foundation for your family to thrive and prosper.","num_pages":237,"authors":{"author":{"id":2290725,"name":"Jeff Sutherland","role":"","image_url":"https://images.gr-assets.com/authors/1508058646p5/2290725.jpg","small_image_url":"https://images.gr-assets.com/authors/1508058646p2/2290725.jpg","link":"https://www.goodreads.com/author/show/2290725.Jeff_Sutherland","average_rating":4.13,"ratings_count":25474,"text_reviews_count":2186}},"average_rating":4.14,"ratings_count":23521,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/22826126-seveneves","title":"Seveneves","title_without_series":"Seveneves","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1422566422l/22826126._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1422566422l/22826126._SX98_.jpg","description":"What would happen if the world were ending?<br /><br />A catastrophic event renders the earth a ticking time bomb. In a feverish race against the inevitable, nations around the globe band together to devise an ambitious plan to ensure the survival of humanity far beyond our atmosphere, in outer space.<br /><br />But the complexities and unpredictability of human nature coupled with unforeseen challenges and dangers threaten the intrepid pioneers, until only a handful of survivors remain...<br /><br />Five thousand years later, their progeny -- seven distinct races now three billion strong -- embark on yet another audacious journey into the unknown ... to an alien world utterly transformed by cataclysm and time: Earth.","num_pages":867,"authors":{"author":{"id":545,"name":"Neal Stephenson","role":"","image_url":"https://images.gr-assets.com/authors/1430920344p5/545.jpg","small_image_url":"https://images.gr-assets.com/authors/1430920344p2/545.jpg","link":"https://www.goodreads.com/author/show/545.Neal_Stephenson","average_rating":4.03,"ratings_count":1026808,"text_reviews_count":67463}},"average_rating":4,"ratings_count":124403,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/27220736-shoe-dog","title":"Shoe Dog: A Memoir by the Creator of Nike","title_without_series":"Shoe Dog: A Memoir by the Creator of Nike","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1457284880l/27220736._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1457284880l/27220736._SX98_.jpg","description":"In this candid and riveting memoir, for the first time ever, Nike founder and CEO Phil Knight shares the inside story of the companys early days as an intrepid start-up and its evolution into one of the worlds most iconic, game-changing, and profitable brands.<br /><br />In 1962, fresh out of business school, Phil Knight borrowed $50 from his father and created a company with a simple mission: import high-quality, low-cost athletic shoes from Japan. Selling the shoes from the trunk of his lime green Plymouth Valiant, Knight grossed $8,000 his first year. Today, Nikes annual sales top $30 billion. In an age of startups, Nike is the <i>ne plus ultra</i> of all startups, and the swoosh has become a revolutionary, globe-spanning icon, one of the most ubiquitous and recognizable symbols in the world today.<br /><br />But Knight, the man behind the swoosh, has always remained a mystery. Now, for the first time, in a memoir that is candid, humble, gutsy, and wry, he tells his story, beginning with his crossroads moment. At 24, after backpacking around the world, he decided to take the unconventional path, to start his own businessa business that would be dynamic, <i>different.</i><br /><br />Knight details the many risks and daunting setbacks that stood between him and his dreamalong with his early triumphs. Above all, he recalls the formative relationships with his first partners and employees, a ragtag group of misfits and seekers who became a tight-knit band of brothers. Together, harnessing the transcendent power of a shared mission, and a deep belief in the spirit of sport, they built a brand that changed everything.","num_pages":400,"authors":{"author":{"id":3319233,"name":"Phil Knight","role":"","image_url":"https://images.gr-assets.com/authors/1541244521p5/3319233.jpg","small_image_url":"https://images.gr-assets.com/authors/1541244521p2/3319233.jpg","link":"https://www.goodreads.com/author/show/3319233.Phil_Knight","average_rating":4.45,"ratings_count":369235,"text_reviews_count":21827}},"average_rating":4.46,"ratings_count":363117,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/36064445-skin-in-the-game","title":"Skin in the Game: The Hidden Asymmetries in Daily Life","title_without_series":"Skin in the Game: The Hidden Asymmetries in Daily Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1510319798l/36064445._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1510319798l/36064445._SX98_.jpg","description":"From the <i>New York Times</i> bestselling author of <i>The Black Swan,</i> a bold new work that challenges many of our long-held beliefs about risk and reward, politics and religion, finance and personal responsibility<br /><br /> In his most provocative and practical book yet, one of the foremost thinkers of our time redefines what it means to understand the world, succeed in a profession, contribute to a fair and just society, detect nonsense, and influence others. Citing examples ranging from Hammurabi to Seneca, Antaeus the Giant to Donald Trump, Nassim Nicholas Taleb shows how the willingness to accept ones own risks is an essential attribute of heroes, saints, and flourishing people in all walks of life.<br /><br /> As always both accessible and iconoclastic, Taleb challenges long-held beliefs about the values of those who spearhead military interventions, make financial investments, and propagate religious faiths. Among his insights:<br /><br /> <b> <i>For social justice,focus on symmetry and risk sharing. </i></b>You cannot make profits and transfer the risks to others, as bankers and large corporations do. You cannot get rich without owning your own risk and paying for your own losses. Forcing skin in the game corrects this asymmetry better than thousands of laws and regulations.<br /> <b> <i>Ethical rules arent universal</i>.</b> Youre part of a group larger than you, but its still smaller than humanity in general.<br /> <b> <i>Minorities, not majorities, run the world. </i></b>The world is not run by consensus but by stubborn minorities imposing their tastes and ethics on others.<br /> <b> <i>You can be an intellectual yet still be an idiot</i>.</b> Educated philistines have been wrong on everything from Stalinism to Iraq to low-carb diets.<br /> <b> <i>Beware of complicated solutions (that someone was paid to find)</i>.</b> A simple barbell can build muscle better than expensive new machines.<br /> <b> <i>True religion is commitment, not just faith</i>.</b> How much you believe in something is manifested only by what youre willing to risk for it.<br /><br />The phrase skin in the game is one we have often heard but rarely stopped to truly dissect. It is the backbone of risk management, but its also an astonishingly rich worldview that, as Taleb shows in this book, applies to all aspects of our lives. As Taleb says, The symmetry of skin in the game is a simple rule thats necessary for fairness and justice, and the ultimate BS-buster, and Never trust anyone who doesnt have skin in the game. Without it, fools and crooks will benefit, and their mistakes will never come back to haunt them.","num_pages":272,"authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":306327,"text_reviews_count":21059}},"average_rating":3.91,"ratings_count":31387,"publication_day":1,"publication_month":6,"publication_year":2018},{"link":"https://www.goodreads.com/book/show/197773418-slow-productivity","title":"Slow Productivity: The Lost Art of Accomplishment Without Burnout","title_without_series":"Slow Productivity: The Lost Art of Accomplishment Without Burnout","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>Do fewer things. Work at a natural pace. Obsess over quality.</b><br /><br />From the <i>New York Times</i> bestselling author of <i>Digital Minimalism</i> and <i>Deep Work,</i> a groundbreaking philosophy for pursuing meaningful accomplishment while avoiding overload.<br /><br />Our current definition of productivity is broken. It pushes us to treat busyness as a proxy for useful effort, leading to impossibly lengthy task lists and ceaseless meetings. Were overwhelmed by all we have to do and on the edge of burnout, left to decide between giving into soul-sapping hustle culture or rejecting ambition altogether. But are these really our only choices?<br /><br />Long before the arrival of pinging inboxes and clogged schedules, historys most creative and impactful philosophers, scientists, artists, and writers mastered the art of producing valuable work with staying power. In this timely and provocative book, Cal Newport harnesses the wisdom of these traditional knowledge workers to radically transform our modern jobs. Drawing from deep research on the habits and mindsets of a varied cast of storied thinkersfrom Galileo and Isaac Newton, to Jane Austen and Georgia OKeefeNewport lays out the key principles of slow productivity, a more sustainable alternative to the aimless overwhelm that defines our current moment. Combining cultural criticism with systematic pragmatism, Newport deconstructs the absurdities inherent in standard notions of productivity, and then provides step-by-step advice for workers to replace them with a slower, more humane alternative.<br /><br />From the aggressive rethinking of workload management, to introducing seasonal variation, to shifting your performance toward long-term quality, Slow Productivity provides a roadmap for escaping overload and arriving instead at a more timeless approach to pursuing meaningful accomplishment. The world of work is due for a new revolution. Slow productivity is exactly what we need.","num_pages":244,"authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":378174,"text_reviews_count":34170}},"average_rating":3.67,"ratings_count":23223,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/20910174-smartcuts","title":"Smartcuts: How Hackers, Innovators, and Icons Accelerate Success","title_without_series":"Smartcuts: How Hackers, Innovators, and Icons Accelerate Success","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1405868185l/20910174._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1405868185l/20910174._SX98_.jpg","description":"","num_pages":"","authors":{"author":{"id":7567448,"name":"Shane Snow","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/7567448.Shane_Snow","average_rating":3.86,"ratings_count":7595,"text_reviews_count":568}},"average_rating":3.88,"ratings_count":6563,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25733966-smarter-faster-better","title":"Smarter Faster Better: The Secrets of Being Productive in Life and Business","title_without_series":"Smarter Faster Better: The Secrets of Being Productive in Life and Business","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1453057544l/25733966._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1453057544l/25733966._SX98_.jpg","description":"A new book that explores the science of productivity, and why, in todays world, managing <i>how</i> you thinkrather than <i>what</i> you thinkcan transform your life.","num_pages":"","authors":{"author":{"id":5201530,"name":"Charles Duhigg","role":"","image_url":"https://images.gr-assets.com/authors/1349273209p5/5201530.jpg","small_image_url":"https://images.gr-assets.com/authors/1349273209p2/5201530.jpg","link":"https://www.goodreads.com/author/show/5201530.Charles_Duhigg","average_rating":4.11,"ratings_count":630242,"text_reviews_count":30260}},"average_rating":3.9,"ratings_count":35721,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13525945-so-good-they-can-t-ignore-you","title":"So Good They Can't Ignore You: Why Skills Trump Passion in the Quest for Work You Love","title_without_series":"So Good They Can't Ignore You: Why Skills Trump Passion in the Quest for Work You Love","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360564614l/13525945._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1360564614l/13525945._SX98_.jpg","description":"In this eye-opening account, Cal Newport debunks the long-held belief that \\"follow your passion\\" is good advice. <br /><br />Not only is the clich flawedpreexisting passions are rare and have little to do with how most people end up loving their workbut it can also be dangerous, leading to anxiety and chronic job hopping.<br /><br />After making his case against passion, Newport sets out on a quest to discover the reality of how people end up loving what they do. Spending time with organic farmers, venture capitalists, screenwriters, freelance computer programmers, and others who admitted to deriving great satisfaction from their work, Newport uncovers the strategies they used and the pitfalls they avoided in developing their compelling careers.<br /><br />Matching your job to a preexisting passion does not matter, he reveals. Passion comes after you put in the hard work to become excellent at something valuable, not before. In other words, what you do for a living is much less important than how you do it.<br /><br />With a title taken from the comedian Steve Martin, who once said his advice for aspiring entertainers was to \\"be so good they can't ignore you,\\" Cal Newport's clearly written manifesto is mandatory reading for anyone fretting about what to do with their life, or frustrated by their current job situation and eager to find a fresh new way to take control of their livelihood. He provides an evidence-based blueprint for creating work you love.<br /><br /><i>So Good They Can't Ignore You</i> will change the way we think about our careers, happiness, and the crafting of a remarkable life.","num_pages":"","authors":{"author":{"id":147891,"name":"Cal Newport","role":"","image_url":"https://images.gr-assets.com/authors/1644908751p5/147891.jpg","small_image_url":"https://images.gr-assets.com/authors/1644908751p2/147891.jpg","link":"https://www.goodreads.com/author/show/147891.Cal_Newport","average_rating":4.08,"ratings_count":378174,"text_reviews_count":34170}},"average_rating":4.07,"ratings_count":49918,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/62296528-spare","title":"Spare","title_without_series":"Spare","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673458354l/62296528._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1673458354l/62296528._SX98_.jpg","description":"It was one of the most searing images of the twentieth century: two young boys, two princes, walking behind their mothers coffin as the world watched in sorrowand horror. As Princess Diana was laid to rest, billions wondered what Prince William and Prince Harry must be thinking and feelingand how their lives would play out from that point on.<br /><br />For Harry, this is that story at last.<br /><br />Before losing his mother, twelve-year-old Prince Harry was known as the carefree one, the happy-go-lucky Spare to the more serious Heir. Grief changed everything. He struggled at school, struggled with anger, with lonelinessand, because he blamed the press for his mothers death, he struggled to accept life in the spotlight.<br /><br />At twenty-one, he joined the British Army. The discipline gave him structure, and two combat tours made him a hero at home. But he soon felt more lost than ever, suffering from post-traumatic stress and prone to crippling panic attacks. Above all, he couldnt find true love. <br /><br />Then he met Meghan. The world was swept away by the couples cinematic romance and rejoiced in their fairy-tale wedding. But from the beginning, Harry and Meghan were preyed upon by the press, subjected to waves of abuse, racism, and lies. Watching his wife suffer, their safety and mental health at risk, Harry saw no other way to prevent the tragedy of history repeating itself but to flee his mother country. Over the centuries, leaving the Royal Family was an act few had dared. The last to try, in fact, had been his mother. . . .<br /><br />For the first time, Prince Harry tells his own story, chronicling his journey with raw, unflinching honesty. A landmark publication, <i>Spare</i> is full of insight, revelation, self-examination, and hard-won wisdom about the eternal power of love over grief.","num_pages":410,"authors":{"author":{"id":7848512,"name":"Prince Harry","role":"","image_url":"https://images.gr-assets.com/authors/1669544936p5/7848512.jpg","small_image_url":"https://images.gr-assets.com/authors/1669544936p2/7848512.jpg","link":"https://www.goodreads.com/author/show/7848512.Prince_Harry","average_rating":3.83,"ratings_count":425251,"text_reviews_count":44344}},"average_rating":3.83,"ratings_count":425184,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/36510202-start-nl-dutch-for-beginners","title":"Start.nl Dutch for Beginners","title_without_series":"Start.nl Dutch for Beginners","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"nan","num_pages":144,"authors":{"author":{"id":19703128,"name":"Katja Verbruggen","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/19703128.Katja_Verbruggen","average_rating":3.65,"ratings_count":17,"text_reviews_count":2}},"average_rating":3.12,"ratings_count":8,"publication_day":"","publication_month":"","publication_year":2017},{"link":"https://www.goodreads.com/book/show/44573628-super-pumped","title":"Super Pumped: The Battle for Uber","title_without_series":"Super Pumped: The Battle for Uber","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1553648438l/44573628._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1553648438l/44573628._SX98_.jpg","description":"","num_pages":408,"authors":{"author":{"id":18993769,"name":"Mike Isaac","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/18993769.Mike_Isaac","average_rating":4.14,"ratings_count":14040,"text_reviews_count":1078}},"average_rating":4.14,"ratings_count":14034,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6402364-superfreakonomics","title":"SuperFreakonomics: Global Cooling, Patriotic Prostitutes And Why Suicide Bombers Should Buy Life Insurance","title_without_series":"SuperFreakonomics: Global Cooling, Patriotic Prostitutes And Why Suicide Bombers Should Buy Life Insurance","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1308117804l/6402364._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1308117804l/6402364._SX98_.jpg","description":"The New York Times best-selling Freakonomics was a worldwide sensation, selling over four million copies in thirty-five languages and changing the way we look at the world. Now, Steven D. Levitt and Stephen J. Dubner return with SuperFreakonomics, and fans and newcomers alike will find that the freakquel is even bolder, funnier, and more surprising than the first.<br /><br />Four years in the making, SuperFreakonomics asks not only the tough questions, but the unexpected ones: What's more dangerous, driving drunk or walking drunk? Why is chemotherapy prescribed so often if it's so ineffective? Can a sex change boost your salary?<br /><br />SuperFreakonomics challenges the way we think all over again, exploring the hidden side of everything with such questions as:<br /><br />How is a street prostitute like a department-store Santa?<br />Why are doctors so bad at washing their hands?<br />How much good do car seats do?<br />What's the best way to catch a terrorist?<br />Did TV cause a rise in crime?<br />What do hurricanes, heart attacks, and highway deaths have in common?<br />Are people hard-wired for altruism or selfishness?<br />Can eating kangaroo save the planet?<br />Which adds more value: a pimp or a Realtor?<br /><br />Levitt and Dubner mix smart thinking and great storytelling like no one else, whether investigating a solution to global warming or explaining why the price of oral sex has fallen so drastically. By examining how people respond to incentives, they show the world for what it really is  good, bad, ugly, and, in the final analysis, super freaky.<br /><br />Freakonomics has been imitated many times over  but only now, with SuperFreakonomics, has it met its match.","num_pages":270,"authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1101273,"text_reviews_count":30692}},"average_rating":4,"ratings_count":134160,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60631342-system-design-interview-an-insider-s-guide","title":"System Design Interview  An Insider's Guide: Volume 2","title_without_series":"System Design Interview  An Insider's Guide: Volume 2","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"System Design Interview - An Insider's Guide (Volume 2)<br /><br />This book can be seen as a sequel to the book: System Design Interview - An Insiders Guide. It covers a different set of system design interview questions and solutions. Although reading Volume 1 is helpful, it is not required. This book should be accessible to readers who have a basic understanding of distributed systems.<br /><br />This volume provides a reliable strategy and knowledge base for approaching a broad range of system design questions that you may encounter. It will help you feel confident during this important interview. This book provides a step-by-step framework for how to tackle a system design question. It also includes many real-world examples to illustrate a systematic approach, with detailed and well-explained steps you can follow.<br /><br />Whats inside?<br />- An insiders take on what interviewers really look for and why.<br />- A 4-step framework for solving any system design interview question.<br />- 13 real system design interview questions with detailed solutions.<br />- 300+ diagrams to visually explain how different systems work.<br /><br />Table of Contents<br />Chapter 1: Proximity Service<br />Chapter 2: Nearby Friends<br />Chapter 3: Google Maps<br />Chapter 4: Distributed Message Queue<br />Chapter 5: Metrics Monitoring<br />Chapter 6: Ad Click Event Aggregation<br />Chapter 7: Hotel Reservation<br />Chapter 8: Distributed Email Service<br />Chapter 9: S3-like Object Storage<br />Chapter 10: Real-time Gaming Leaderboard<br />Chapter 11: Payment System<br />Chapter 12: Digital Wallet<br />Chapter 13: Stock Exchange","num_pages":424,"authors":{"author":{"id":20411209,"name":"Alex Xu","role":"","image_url":"https://images.gr-assets.com/authors/1688294611p5/20411209.jpg","small_image_url":"https://images.gr-assets.com/authors/1688294611p2/20411209.jpg","link":"https://www.goodreads.com/author/show/20411209.Alex_Xu","average_rating":4.3,"ratings_count":3991,"text_reviews_count":373}},"average_rating":4.43,"ratings_count":609,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54109255-system-design-interview-an-insider-s-guide","title":"System Design Interview  An insider's guide","title_without_series":"System Design Interview  An insider's guide","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"The system design interview is considered to be the most complex and most difficult technical job interview by many. This book provides a step-by-step framework on how to tackle a system design question. It includes many real-world examples to illustrate the systematic approach with detailed steps that you can follow.<br /><br />Whats inside?<br />- An insiders take on what interviewers really look for and why.<br />- A 4-step framework for solving any system design interview question.<br />- 15 real system design interview questions with detailed solutions.<br />- 188 diagrams to visually explain how different systems work.<br /><br />Table Of Contents<br />Chapter 1: Scale From Zero To Millions Of Users<br />Chapter 2: Back-of-the-envelope Estimation<br />Chapter 3: A Framework For System Design Interviews<br />Chapter 4: Design A Rate Limiter<br />Chapter 5: Design Consistent Hashing<br />Chapter 6: Design A Key-value Store<br />Chapter 7: Design A Unique Id Generator In Distributed Systems<br />Chapter 8: Design A Url Shortener<br />Chapter 9: Design A Web Crawler<br />Chapter 10: Design A Notification System<br />Chapter 11: Design A News Feed System<br />Chapter 12: Design A Chat System<br />Chapter 13: Design A Search Autocomplete System<br />Chapter 14: Design Youtube<br />Chapter 15: Design Google Drive<br />Chapter 16: The Learning Continues","num_pages":324,"authors":{"author":{"id":20411209,"name":"Alex Xu","role":"","image_url":"https://images.gr-assets.com/authors/1688294611p5/20411209.jpg","small_image_url":"https://images.gr-assets.com/authors/1688294611p2/20411209.jpg","link":"https://www.goodreads.com/author/show/20411209.Alex_Xu","average_rating":4.3,"ratings_count":3991,"text_reviews_count":373}},"average_rating":4.26,"ratings_count":3229,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43848929-talking-to-strangers","title":"Talking to Strangers: What We Should Know About the People We Don't Know","title_without_series":"Talking to Strangers: What We Should Know About the People We Don't Know","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>Malcolm Gladwell, host of the podcast Revisionist History and author of the #1 New York Times bestseller <i>Outliers</i>, offers a powerful examination of our interactions with strangers -- and why they often go wrong.</b><br /><br />How did Fidel Castro fool the CIA for a generation? Why did Neville Chamberlain think he could trust Adolf Hitler? Why are campus sexual assaults on the rise? Do television sitcoms teach us something about the way we relate to each other that isn't true?<br /><br />While tackling these questions, Malcolm Gladwell was not solely writing a book for the page. He was also producing for the ear. In the audiobook version of Talking to Strangers, you'll hear the voices of people he interviewed--scientists, criminologists, military psychologists. Court transcripts are brought to life with re-enactments. You actually hear the contentious arrest of Sandra Bland by the side of the road in Texas. As Gladwell revisits the deceptions of Bernie Madoff, the trial of Amanda Knox, and the suicide of Sylvia Plath, you hear directly from many of the players in these real-life tragedies. There's even a theme song - Janelle Monae's \\"Hell You Talmbout.\\"<br /><br />Something is very wrong, Gladwell argues, with the tools and strategies we use to make sense of people we don't know. And because we don't know how to talk to strangers, we are inviting conflict and misunderstanding in ways that have a profound effect on our lives and our world.","num_pages":388,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3144403,"text_reviews_count":130486}},"average_rating":4,"ratings_count":334688,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/44428950-that-will-never-work","title":"That Will Never Work: The Birth of Netflix and the Amazing Life of an Idea","title_without_series":"That Will Never Work: The Birth of Netflix and the Amazing Life of an Idea","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1565067558l/44428950._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1565067558l/44428950._SX98_.jpg","description":"<b>In the tradition of SHOE DOG, comes the incredible story of how Netflix went from concept to company - all told by co-founder Marc Randolph</b><br />Silicon Valley lore has it that Netflix was born out of a frustration with video stores' late fees, and while that is a convenient, charming story it is far from the truth. In reality, the idea was just one of many more and far worse proposals, like personalized baseball bats and a shampoo delivery service, that Marc Randolph would pitch to his business partner, Reed Hastings, on their commute to work each morning. From this ever-shifting pool of potential ventures the pair, with Hastings as the primary investor and Randolph as the CEO, took a risk and founded Netflix. Not until years later, when a billion dollar company emerged out of a business model that - after countless disasters and flirtations with bankruptcy - seemed destined for failure would the risk pay off and become one of the mostly incredible and unlikely success stories of our time.Now with over 125 million subscribers the triumph of Netflix feels inevitable, but at a time when brick and mortar video rental stores were king and DVD technology had yet to take off, its success was far from guaranteed. From having to pitch his own mother on being an early investor, to a motel business conference room that served as a first office, to helping develop Netflix's now-famous company culture, Marc Randolph's improbable journey exemplifies how anyone with grit, gut instincts and determination can transform the world we live in. Telling his story in energetic, compelling prose, Marc chronicles the personal and professional labors that went into the creation of the unicorn company that has disrupted the very foundations of the entertainment industry.<br /><br />From having to pitch his own mother on being an early investor, to a motel business conference room that he decided would be their first office, to helping develop Netflix's now-famous company culture, Marc Randolph's improbable journey exemplifies how anyone with grit, gut instincts and determination can transform the world we live in.","num_pages":336,"authors":{"author":{"id":18965880,"name":"Marc Randolph","role":"","image_url":"https://images.gr-assets.com/authors/1557353143p5/18965880.jpg","small_image_url":"https://images.gr-assets.com/authors/1557353143p2/18965880.jpg","link":"https://www.goodreads.com/author/show/18965880.Marc_Randolph","average_rating":4.22,"ratings_count":16938,"text_reviews_count":1356}},"average_rating":4.22,"ratings_count":16918,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/984017.The_48_Laws_of_Power","title":"The 48 Laws of Power","title_without_series":"The 48 Laws of Power","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1529072201l/984017._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1529072201l/984017._SX98_.jpg","description":"Amoral, cunning, ruthless, and instructive, this piercing work distills three thousand years of the history of power in to forty-eight well explicated laws. As attention-grabbing in its design as it is in its content, this bold volume outlines the laws of power in their unvarnished essence, synthesizing the philosophies of Machiavelli, Sun-tzu, Carl von Clausewitz, and other great thinkers. <br /><br />Some laws teach the need for prudence (\\"Law 1: Never Outshine the Master\\"), the virtue of stealth (\\"Law 3: Conceal Your Intentions\\"), and many demand the total absence of mercy (\\"Law 15: Crush Your Enemy Totally\\"), but like it or not, all have applications in real life. <br /><br />Illustrated through the tactics of Queen Elizabeth I, Henry Kissinger, P. T. Barnum, and other famous figures who have wielded--or been victimized by--power, these laws will fascinate any reader interested in gaining, observing, or defending against ultimate control.","num_pages":452,"authors":{"author":{"id":865,"name":"Robert Greene","role":"","image_url":"https://images.gr-assets.com/authors/1298212921p5/865.jpg","small_image_url":"https://images.gr-assets.com/authors/1298212921p2/865.jpg","link":"https://www.goodreads.com/author/show/865.Robert_Greene","average_rating":4.12,"ratings_count":389665,"text_reviews_count":23317}},"average_rating":4.09,"ratings_count":221017,"publication_day":"","publication_month":"","publication_year":2000},{"link":"https://www.goodreads.com/book/show/36072.The_7_Habits_of_Highly_Effective_People","title":"The 7 Habits of Highly Effective People: Powerful Lessons in Personal Change","title_without_series":"The 7 Habits of Highly Effective People: Powerful Lessons in Personal Change","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1421842784l/36072._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1421842784l/36072._SX98_.jpg","description":"7 zakonet e njerzve t suksesshm","num_pages":372,"authors":{"author":{"id":1538,"name":"Stephen R. Covey","role":"","image_url":"https://images.gr-assets.com/authors/1321654785p5/1538.jpg","small_image_url":"https://images.gr-assets.com/authors/1321654785p2/1538.jpg","link":"https://www.goodreads.com/author/show/1538.Stephen_R_Covey","average_rating":4.14,"ratings_count":1014759,"text_reviews_count":25313}},"average_rating":4.16,"ratings_count":815186,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/57007683-the-apollo-murders","title":"The Apollo Murders (Apollo Murders, #1)","title_without_series":"The Apollo Murders","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629112133l/57007683._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1629112133l/57007683._SX98_.jpg","description":"<b>An exceptional debut thriller and exciting journey into the dark heart of the Cold War and the space race from<i>New York Times</i></b><b>bestselling author and astronaut Chris Hadfield (Andy Weir, author of <i>The Martian </i>and <i>Project Hail Mary</i>).<br /></b><br /><i>1973: a final, top-secret mission to the Moon. Three astronauts in a tiny spaceship, a quarter million miles from home. A quarter million miles from help.</i><br /><br />NASA is about to launch Apollo 18. While the mission has been billed as a scientific one, flight controller Kazimieras \\"Kaz\\" Zemeckis knows there is a darker objective. Intelligence has discovered a secret Soviet space station spying on America, and Apollo 18 may be the only chance to stop it.<br /><br />But even as Kaz races to keep the NASA crew one step ahead of their Russian rivals, a deadly accident reveals that not everyone involved is quite who they were thought to be. With political stakes stretched to the breaking point, the White House and the Kremlin can only watch as their astronauts collide on the lunar surface, far beyond the reach of law or rescue.<br /><br />Full of the fascinating technical detail that fans of<i>The Martian</i>loved, and reminiscent of the thrilling claustrophobia, twists, and tension of<i>The Hunt for Red October</i>,<i>The Apollo Murders</i>is a high-stakes thriller unlike any other. Chris Hadfield captures the fierce G-forces of launch, the frozen loneliness of space, and the fear of holding on to the outside of a spacecraft orbiting the Earth at 17,000 miles per hour as only someone who has experienced all of these things in real life can.<br /><br />Strap in and count down for the ride of a lifetime.","num_pages":"","authors":{"author":{"id":1136925,"name":"Chris Hadfield","role":"","image_url":"https://images.gr-assets.com/authors/1372880368p5/1136925.jpg","small_image_url":"https://images.gr-assets.com/authors/1372880368p2/1136925.jpg","link":"https://www.goodreads.com/author/show/1136925.Chris_Hadfield","average_rating":4.12,"ratings_count":92732,"text_reviews_count":9006}},"average_rating":3.92,"ratings_count":18963,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/9402297-the-bed-of-procrustes","title":"The Bed of Procrustes: Philosophical and Practical Aphorisms","title_without_series":"The Bed of Procrustes: Philosophical and Practical Aphorisms","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1665067245l/9402297._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1665067245l/9402297._SX98_.jpg","description":"The Bed of Procrustes takes its title from Greek mythology: the story of a man who made his visitors fit his bed to perfection by either stretching them or cutting their limbs. It represents Nassim Nicholas Taleb's view of modern civilization's hubristic side effects-modifying humans to satisfy technology, blaming reality for not fitting economic models, inventing diseases to sell drugs, defining intelligence as what can be tested in a classroom, and convincing people that employment is not slavery.<br /><br />Playful and irreverent, these aphorisms will surprise you by exposing self-delusions you have been living with but never recognized.<br /><br />With a rare combination of pointed wit and potent wisdom, Taleb plows through human illusions, contrasting the classical values of courage, elegance, and erudition against the modern diseases of nerdiness, philistinism, and phoniness.<br /><br /><br /> \\"The most prophetic voice of all.\\" -GQ<br /><br />\\"The hottest thinker in the world.\\" -Bryan Appleyard, The Sunday Times (London)<br /><br />\\"Idiosyncratically brilliant.\\" -Niall Ferguson, Los Angeles Times","num_pages":"","authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":306327,"text_reviews_count":21059}},"average_rating":3.78,"ratings_count":10854,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/2962025-the-black-swan","title":"The Black Swan: The Impact of the Highly Improbable","title_without_series":"The Black Swan: The Impact of the Highly Improbable","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1659249464l/2962025._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1659249464l/2962025._SX98_.jpg","description":"<p><i>In Black Swan: The Impact of The Highly Improbable</i>, the author projects randomness and uncertainty as a single idea. He puts forth a theory that promotes the idea and value of a society that stands robust in the face of negative events, and manipulates the positive ones to its advantage.According to Taleb, a Black Swan event is a rare event that has large magnitude and powerful consequences owing to its unpredictability. Such an event is initially a surprise to its observer, but is rationalized by him/her in retrospect. World War I, the rise of the Internet, and the 9/11 attacks on the World Trade Center are cited as examples of Black Swan events. Taleb introduces a fictional character called Yevgenia Nikolayevna Krasnova to elucidate his theory. Krasnova is a neuroscientist, who is interested in philosophy. She writes a book called A Story Of Recursion. A small publishing firm picks up the book and publishes it in its unedited form. In an unexpected turn of events, the book goes on to become an international bestseller, catapulting the author and the publishing firm to fame. This event is described as a Black Swan Event.The book is divided into four parts. Part 1 and the first section of Part 2 deal with psychology. The author then moves on to the subjects of science and business in the later part of Part 2 and the whole of Part 3. Part 4 provides strategies to enjoy life amidst all the uncertainties in the world. The book was first released in 2007 and went on to become extremely successful. It was listed by The Sunday Times as one of the 12 most influential books post World War II. It stayed on The New York Times bestseller list for 36 weeks. It was published in 32 languages, and sold almost 3 million copies as of February 2011.</p>","num_pages":480,"authors":{"author":{"id":21559,"name":"Nassim Nicholas Taleb","role":"","image_url":"https://images.gr-assets.com/authors/1206025993p5/21559.jpg","small_image_url":"https://images.gr-assets.com/authors/1206025993p2/21559.jpg","link":"https://www.goodreads.com/author/show/21559.Nassim_Nicholas_Taleb","average_rating":4.01,"ratings_count":306327,"text_reviews_count":21059}},"average_rating":3.96,"ratings_count":121132,"publication_day":"","publication_month":"","publication_year":2010},{"link":"https://www.goodreads.com/book/show/18693771-the-body-keeps-the-score","title":"The Body Keeps the Score: Brain, Mind, and Body in the Healing of Trauma","title_without_series":"The Body Keeps the Score: Brain, Mind, and Body in the Healing of Trauma","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594559067l/18693771._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1594559067l/18693771._SX98_.jpg","description":"<b>A pioneering researcher transforms our understanding of trauma and offers a bold new paradigm for healing.</b> <br /><br />Trauma is a fact of life. Veterans and their families deal with the painful aftermath of combat; one in five Americans has been molested; one in four grew up with alcoholics; one in three couples have engaged in physical violence. Dr. Bessel van der Kolk, one of the world's foremost experts on trauma, has spent over three decades working with survivors. In <i>The Body Keeps the Score</i>, he uses recent scientific advances to show how trauma literally reshapes both body and brain, compromising sufferers' capacities for pleasure, engagement, self-control, and trust. He explores innovative treatmentsfrom neurofeedback and meditation to sports, drama, and yogathat offer new paths to recovery by activating the brain's natural neuroplasticity. Based on Dr. van der Kolk's own research and that of other leading specialists, <i>The Body Keeps the Score</i> exposes the tremendous power of our relationships both to hurt and to healand offers new hope for reclaiming lives.","num_pages":464,"authors":{"author":{"id":21280926,"name":"Bessel van der Kolk","role":"","image_url":"https://images.gr-assets.com/authors/1617660077p5/21280926.jpg","small_image_url":"https://images.gr-assets.com/authors/1617660077p2/21280926.jpg","link":"https://www.goodreads.com/author/show/21280926.Bessel_van_der_Kolk","average_rating":4.35,"ratings_count":276028,"text_reviews_count":21774}},"average_rating":4.35,"ratings_count":272255,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/56668328-the-bomber-mafia","title":"The Bomber Mafia: A Dream, a Temptation, and the Longest Night of the Second World War","title_without_series":"The Bomber Mafia: A Dream, a Temptation, and the Longest Night of the Second World War","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1616422126l/56668328._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1616422126l/56668328._SX98_.jpg","description":"<b>An exploration of how technology and best intentions collide in the heat of war<br /><br />A<i>New York Times Book Review </i>Editors Choice</b><br /><br />In <i>The Bomber Mafia</i><i>,</i> Malcolm Gladwell weaves together the stories of a Dutch genius and his homemade computer, a band of brothers in central Alabama, a British psychopath, and pyromaniacal chemists at Harvard to examine one of the greatest moral challenges in modern American history.<br /><br />Most military thinkers in the years leading up to World War II saw the airplane as an afterthought. But a small band of idealistic strategists, the Bomber Mafia, asked: What if precision bombing could cripple the enemy <i>and</i> make war far less lethal? <br /><br />In contrast, the bombing of Tokyo on the deadliest night of the war was the brainchild of General Curtis LeMay, whose brutal pragmatism and scorched-earth tactics in Japan cost thousands of civilian lives, but may have spared even more by averting a planned US invasion. In <i>The Bomber Mafia, </i>Gladwell asks, Was it worth it?<br /><br />Things might have gone differently had LeMays predecessor, General Haywood Hansell, remained in charge. Hansell believed in precision bombing, but when he and Curtis LeMay squared off for a leadership handover in the jungles of Guam, LeMay emerged victorious, leading to the darkest night of World War II. <i>The Bomber Mafia </i>is a riveting tale of persistence, innovation, and the incalculable wages of war.","num_pages":"","authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3144403,"text_reviews_count":130486}},"average_rating":4.02,"ratings_count":63352,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/19063.The_Book_Thief","title":"The Book Thief","title_without_series":"The Book Thief","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1522157426l/19063._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1522157426l/19063._SX98_.jpg","description":"<i>Librarian's note: An alternate cover edition can be found <a href=\\"https://www.goodreads.com/book/show/41048862.here\\" title=\\"here\\" rel=\\"nofollow noopener\\">here</a></i><br /><br />It is 1939. Nazi Germany. The country is holding its breath. Death has never been busier, and will be busier still.<br /><br />By her brother's graveside, Liesel's life is changed when she picks up a single object, partially hidden in the snow. It is The Gravedigger's Handbook, left behind there by accident, and it is her first act of book thievery. So begins a love affair with books and words, as Liesel, with the help of her accordian-playing foster father, learns to read. Soon she is stealing books from Nazi book-burnings, the mayor's wife's library, wherever there are books to be found.<br /><br />But these are dangerous times. When Liesel's foster family hides a Jew in their basement, Liesel's world is both opened up, and closed down.<br /><br />In superbly crafted writing that burns with intensity, award-winning author Markus Zusak has given us one of the most enduring stories of our time.<br /><br />(Note: this title was not published as YA fiction)","num_pages":592,"authors":{"author":{"id":11466,"name":"Markus Zusak","role":"","image_url":"https://images.gr-assets.com/authors/1537240528p5/11466.jpg","small_image_url":"https://images.gr-assets.com/authors/1537240528p2/11466.jpg","link":"https://www.goodreads.com/author/show/11466.Markus_Zusak","average_rating":4.36,"ratings_count":3092517,"text_reviews_count":186178}},"average_rating":4.39,"ratings_count":2852730,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/6667514-the-checklist-manifesto","title":"The Checklist Manifesto: How to Get Things Right","title_without_series":"The Checklist Manifesto: How to Get Things Right","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1647403235l/6667514._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1647403235l/6667514._SX98_.jpg","description":"<b>The <em>New York Times</em> bestselling author of <em>Better</em> and <em>Complications</em> reveals the surprising power of the ordinary checklist</b><br /><br />We live in a world of great and increasing complexity, where even the most expert professionals struggle to master the tasks they face. Longer training, ever more advanced technologiesneither seems to prevent grievous errors. But in a hopeful turn, acclaimed surgeon and writer Atul Gawande finds a remedy in the humblest and simplest of techniques: the checklist. First introduced decades ago by the U.S. Air Force, checklists have enabled pilots to fly aircraft of mind-boggling sophistication. Now innovative checklists are being adopted in hospitals around the world, helping doctors and nurses respond to everything from flu epidemics to avalanches. Even in the immensely complex world of surgery, a simple ninety-second variant has cut the rate of fatalities by more than a third.<br /><br />In riveting stories, Gawande takes us from Austria, where an emergency checklist saved a drowning victim who had spent half an hour underwater, to Michigan, where a cleanliness checklist in intensive care units virtually eliminated a type of deadly hospital infection. He explains how checklists actually work to prompt striking and immediate improvements. And he follows the checklist revolution into fields well beyond medicine, from disaster response to investment banking, skyscraper construction, and businesses of all kinds.<br /><br />An intellectual adventure in which lives are lost and saved and one simple idea makes a tremendous difference, <em>The Checklist Manifesto</em> is essential reading for anyone working to get things right.","num_pages":208,"authors":{"author":{"id":3078,"name":"Atul Gawande","role":"","image_url":"https://images.gr-assets.com/authors/1560377007p5/3078.jpg","small_image_url":"https://images.gr-assets.com/authors/1560377007p2/3078.jpg","link":"https://www.goodreads.com/author/show/3078.Atul_Gawande","average_rating":4.35,"ratings_count":381839,"text_reviews_count":36550}},"average_rating":4.04,"ratings_count":74946,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/54968118-the-code-breaker","title":"The Code Breaker: Jennifer Doudna, Gene Editing, and the Future of the Human Race","title_without_series":"The Code Breaker: Jennifer Doudna, Gene Editing, and the Future of the Human Race","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610894755l/54968118._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610894755l/54968118._SX98_.jpg","description":"When Jennifer Doudna was in sixth grade, she came home one day to find that her dad had left a paperback titled <i>The Double Helix</i> on her bed. As she sped through the pages, she became enthralled by the intense drama behind the competition to discover the code of life. Even though her high school counselor told her girls didnt become scientists, she decided she would.<br /><br />Driven by a passion to understand how nature works and to turn discoveries into inventions, she would help to make what the books author, James Watson, told her was the most important biological advance since his co-discovery of the structure of DNA. She and her collaborators turned <b></b>a curiosity of nature into an invention that will transform the human race: an easy-to-use tool that can edit DNA. Known as CRISPR, it opened a brave new world of medical miracles and moral questions.<br /> <br />The development of CRISPR and the race to create vaccines for coronavirus will hasten our transition to the next great innovation revolution. The past half-century has been a digital age, based on the microchip, computer, and internet. Now we are entering a life-science revolution. Children who study digital coding will be joined by those who study genetic code.<br /> <br />Should we use our new evolution-hacking powers to make us less susceptible to viruses? What a wonderful boon that would be! And what about preventing depression? HmmmShould we allow parents, if they can afford it, to enhance the height or muscles or IQ of their kids?<br /> <br />After helping to discover CRISPR, Doudna became a leader in wrestling with these moral issues and, with her collaborator Emmanuelle Charpentier, won the Nobel Prize in 2020.","num_pages":536,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2011167,"text_reviews_count":54288}},"average_rating":4.28,"ratings_count":40765,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55825273-the-comfort-book","title":"The Comfort Book","title_without_series":"The Comfort Book","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641142132l/55825273._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1641142132l/55825273._SX98_.jpg","description":"<b>The new uplifting book from Matt Haig, the <i>New York Times</i> bestselling author of <i>The Midnight Library</i>, for anyone in search of hope, looking for a path to a more meaningful life, or in need of a little encouragement.</b><br /><br /><i>It is a strange paradox, that many of the clearest, most comforting life lessons are learnt while we are at our lowest. But then we never think about food more than when we are hungry and we never think about life rafts more than when we are thrown overboard.</i><br /><br /><i>The Comfort Book</i> is Haigs life raft: its a collection of notes, lists, and stories written over a span of several years that originally served as gentle reminders to Haigs future self that things are not always as dark as they may seem. Incorporating a diverse array of sources from across the world, history, science, and his own experiences, Haig offers warmth and reassurance, reminding us to slow down and appreciate the beauty and unpredictability of existence.","num_pages":"","authors":{"author":{"id":76360,"name":"Matt Haig","role":"","image_url":"https://images.gr-assets.com/authors/1708503977p5/76360.jpg","small_image_url":"https://images.gr-assets.com/authors/1708503977p2/76360.jpg","link":"https://www.goodreads.com/author/show/76360.Matt_Haig","average_rating":3.95,"ratings_count":3273786,"text_reviews_count":338697}},"average_rating":4.06,"ratings_count":72597,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/43306206-the-courage-to-be-disliked","title":"The Courage to Be Disliked: How to Free Yourself, Change Your Life and Achieve Real Happiness","title_without_series":"The Courage to Be Disliked: How to Free Yourself, Change Your Life and Achieve Real Happiness","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"The Japanese phenomenon that teaches us the simple yet profound lessons required to liberate our real selves and find lasting happiness.<br /><br /><i>The Courage to Be Disliked</i> shows you how to unlock the power within yourself to become your best and truest self, change your future and find lasting happiness. Using the theories of Alfred Adler, one of the three giants of 19th-century psychology alongside Freud and Jung, the authors explain how we are all free to determine our own future free of the shackles of past experiences, doubts and the expectations of others. Its a philosophy thats profoundly liberating, allowing us to develop the courage to change, and to ignore the limitations that we and those around us can place on ourselves.<br /><br />The result is a book that is both highly accessible and profound in its importance. Millions have already read and benefited from its wisdom. Now that The Courage to Be Disliked has been published for the first time in English, so can you.","num_pages":"","authors":{"author":{"id":14541046,"name":"Ichiro Kishimi","role":"","image_url":"https://images.gr-assets.com/authors/1745447796p5/14541046.jpg","small_image_url":"https://images.gr-assets.com/authors/1745447796p2/14541046.jpg","link":"https://www.goodreads.com/author/show/14541046.Ichiro_Kishimi","average_rating":3.93,"ratings_count":144497,"text_reviews_count":15786}},"average_rating":3.92,"ratings_count":133107,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/22085568-the-culture-map","title":"The Culture Map: Breaking Through the Invisible Boundaries of Global Business","title_without_series":"The Culture Map: Breaking Through the Invisible Boundaries of Global Business","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1488319495l/22085568._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1488319495l/22085568._SX98_.jpg","description":"Cuando te das cuenta de que, antes de hacer una crtica, los estadounidenses se hartan a halagos mientras que los alemanes no se andan con rodeos; o que los asiticos muestran reverencia por la jerarqua, mientras que para los suecos cualquiera puede ser jefe, caes en que nos regimos por un contexto cultural que es imprescindible entender antes de pensar en relacionarse con alguien de otro pas.<br /><br />La comunicacin entre culturas es el gran reto de la economa global, y disponer de las claves necesarias para facilitar la comprensin puede ser la diferencia entre el xito y el fracaso.<br /><br />La experta reconocida Erin Meyer desgrana los 8 puntos diferenciales de nuestros rasgos culturales y nos facilita las herramientas para afrontar de manera eficaz los retos comunicativos ms comunes en el mundo de las relaciones internacionales. El mapa cultural se ha convertido en la obra de referencia para cualquier lector que quiera desenvolverse de la forma ms consciente y cmoda en este terreno sutil, y a veces traicionero, en el que se espera que personas de orgenes distintos trabajen juntas en armona.","num_pages":"","authors":{"author":{"id":7178109,"name":"Erin Meyer","role":"","image_url":"https://images.gr-assets.com/authors/1463868125p5/7178109.jpg","small_image_url":"https://images.gr-assets.com/authors/1463868125p2/7178109.jpg","link":"https://www.goodreads.com/author/show/7178109.Erin_Meyer","average_rating":4.29,"ratings_count":61783,"text_reviews_count":5559}},"average_rating":4.33,"ratings_count":29376,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/23168817-the-dark-forest","title":"The Dark Forest (Remembrance of Earths Past, #2)","title_without_series":"The Dark Forest","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1412064931l/23168817._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1412064931l/23168817._SX98_.jpg","description":"<i>For the Polish paperback, see: <a href=\\"https://www.goodreads.com/book/show/35432446.ISBN13__9788380620506\\" title=\\"ISBN13: 9788380620506\\" rel=\\"nofollow noopener\\">ISBN13: 9788380620506</a>.</i><br /><br />Drugi tom trylogii <i>Wspomnienie o przeszoci Ziemi</i>, najwikszego w ostatnich latach wydarzenia w wiatowej fantastyce naukowej, porwnywalnego z klasycznymi cyklami <i>Fundacja</i> i <i>Diuna</i>. Chiski bestseller, ktry zyska ogromny rozgos w USA  w 2015 roku tom pierwszy, <i>Problem trzech cia</i>, otrzyma nagrod Hugo dla najlepszej powieci.<br /><br />Wyobra sobie wszechwiat jako las peen nieznanych drapienikw. eby przetrwa, trzeba pozosta niezauwaonym  kada cywilizacja, ktra si ujawni, zginie.<br /><br />Ziemia wanie si ujawnia. Drapiecy nadcigaj.<br /><br />Mieszkacy Ziemi nie mog otrzsn si z szoku po odkryciu, e za czterysta lat czeka ich inwazja kosmitw. Ruch na rzecz Ziemskiej Trisolaris zosta pokonany, ale obcy dziki sofonom maj dostp do wszystkich gromadzonych przez ludzi informacji. Tylko to, co si dzieje w ludzkich umysach, pozostaje przed nimi ukryte. Staje si to bodcem dla stworzenia programu Wpatrujcych si w cian, opracowania tajnych strategii, niemoliwych do rozszyfrowania zarwno dla Trisolarian, jak i dla Ziemian.","num_pages":"","authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":932269,"text_reviews_count":88046}},"average_rating":4.4,"ratings_count":215659,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/45731395-the-deficit-myth","title":"The Deficit Myth: Modern Monetary Theory and the Birth of the People's Economy","title_without_series":"The Deficit Myth: Modern Monetary Theory and the Birth of the People's Economy","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1571698158l/45731395._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1571698158l/45731395._SX98_.jpg","description":"<b>A <i>New York Times</i> Bestseller</b> <b><b><br /></b>The leading thinker and most visible public advocate of modern monetary theory -- the freshest and most important idea about economics in decades -- delivers a radically different, bold, new understanding for how to build a just and prosperous society.</b><br /><br />Stephanie Kelton's brilliant exploration of modern monetary theory (MMT) dramatically changes our understanding of how we can best deal with crucial issues ranging from poverty and inequality to creating jobs, expanding health care coverage, climate change, and building resilient infrastructure. Any ambitious proposal, however, inevitably runs into the buzz saw of how to find the money to pay for it, rooted in myths about deficits that are hobbling us as a country.<br /><br /><br />Kelton busts through the myths that prevent us from taking action: that the federal government should budget like a household, that deficits will harm the next generation, crowd out private investment, and undermine long-term growth, and that entitlements are propelling us toward a grave fiscal crisis.<br /><br /><br />MMT, as Kelton shows, shifts the terrain from narrow budgetary questions to one of broader economic and social benefits. With its important new ways of understanding money, taxes, and the critical role of deficit spending, MMT redefines how to responsibly use our resources so that we can maximize our potential as a society. MMT gives us the power to imagine a new politics and a new economy and move from a narrative of scarcity to one of opportunity.","num_pages":327,"authors":{"author":{"id":18314573,"name":"Stephanie Kelton","role":"","image_url":"https://images.gr-assets.com/authors/1589912118p5/18314573.jpg","small_image_url":"https://images.gr-assets.com/authors/1589912118p2/18314573.jpg","link":"https://www.goodreads.com/author/show/18314573.Stephanie_Kelton","average_rating":4.03,"ratings_count":9918,"text_reviews_count":1517}},"average_rating":4.03,"ratings_count":9784,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26083308-the-devops-handbook","title":"The DevOps Handbook: How to Create World-Class Agility, Reliability, and Security in Technology Organizations","title_without_series":"The DevOps Handbook: How to Create World-Class Agility, Reliability, and Security in Technology Organizations","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473461230l/26083308._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473461230l/26083308._SX98_.jpg","description":"Increase profitability, elevate work culture, and exceed productivity goals through DevOps practices.<br /><br />More than ever, the effective management of technology is critical for business competitiveness. For decades, technology leaders have struggled to balance agility, reliability, and security. The consequences of failure have never been greater whether it's the healthcare.gov debacle, cardholder data breaches, or missing the boat with Big Data in the cloud.<br /><br />And yet, high performers using DevOps principles, such as Google, Amazon, Facebook, Etsy, and Netflix, are routinely and reliably deploying code into production hundreds, or even thousands, of times per day.<br /><br />Following in the footsteps of The Phoenix Project, The DevOps Handbook shows leaders how to replicate these incredible outcomes, by showing how to integrate Product Management, Development, QA, IT Operations, and Information Security to elevate your company and win in the marketplace.\\"<br /><br /><i>Table of contents</i><br /><br />Preface<br />Spreading the Aha! Moment<br />Introduction<br /><br />PART I: THE THREE WAYS<br />1. Agile, continuous delivery and the three ways<br />2. The First Way: The Principles of Flow<br />3. The Second Way: The Principle of Feedback<br />4. The Third Way: The Principles of Continual Learning<br /><br />PART II: WHERE TO START<br />5. Selecting which value stream to start with<br />6. Understanding the work in our value stream<br />7. How to design our organization and architecture<br />8. How to get great outcomes by integrating operations into the daily work for development<br /><br />PART III: THE FIRST WAY: THE TECHNICAL PRACTICES OF FLOW<br />9. Create the foundations of our deployment pipeline<br />10. Enable fast and reliable automated testing<br />11. Enable and practice continuous integration<br />12. Automate and enable low-risk releases<br />13. Architect for low-risk releases<br /><br />PART IV: THE SECOND WAY: THE TECHNICAL PRACTICES OF FEEDBACK<br />14*. Create telemetry to enable seeing abd solving problems<br />15. Analyze telemetry to better anticipate problems<br />16. Enable feedbackso development and operation can safely deploy code<br />17. Integrate hypothesis-driven development and A/B testing into our daily work<br />18. Create review and coordination processes to increase quality of our current work<br /><br />PART V: THE THRID WAY: THE TECHNICAL PRACTICES OF CONTINUAL LEARNING<br />19. Enable and inject learning into daily work<br />20. Convert local discoveries into global improvements<br />21. Reserve time to create organizational learning<br />22. Information security as everyones job, every day<br />23. Protecting the deployment pipeline<br /><br />PART VI: CONCLUSION<br />A call to action<br />Conclusion to the DevOps Handbook<br /><br />APPENDICES<br />1. The convergence of Devops<br />2. The theory of constraints and core chronic conflicts<br />3. Tabular form of downward spiral<br />4. The dangers of handoffs and queues<br />5. Myths of industrial safety<br />6. The Toyota Andon Cord<br />7. COTS Software<br />8. Post-mortem meetings<br />9. The Simian Army<br />10. Transparent uptime<br /><br />Additional Resources<br />Endnotes","num_pages":442,"authors":{"author":{"id":328437,"name":"Gene Kim","role":"","image_url":"https://images.gr-assets.com/authors/1361113444p5/328437.jpg","small_image_url":"https://images.gr-assets.com/authors/1361113444p2/328437.jpg","link":"https://www.goodreads.com/author/show/328437.Gene_Kim","average_rating":4.21,"ratings_count":75935,"text_reviews_count":6131}},"average_rating":4.29,"ratings_count":5850,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17563539-the-egg","title":"The Egg","title_without_series":"The Egg","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431492647l/17563539._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431492647l/17563539._SX98_.jpg","description":"<b>A short story about the universe and your place in it.</b><br /><br /><i>\\"You were on your way home when you died. It was a car accident. Nothing particularly remarkable, but fatal nonetheless. You left behind a wife and two children. It was a painless death. ... And thats when you met me.\\"</i><br /><br /><i>The Egg</i> is a short story written by Andy Weir, his most popular, and follows a nameless 48-year-old man who discovers the \\"meaning of life\\" after he dies. The story is about<i> \\"you\\"</i> (in the second person), and God, who is <i>\\"me\\"</i> (in the first person). God says that you have been reincarnated many times before, and that you are soon to be reincarnated once more, leading to quite a few existential questions.<br /><br /><b>\\n  <a href=\\"https://www.goodreads.com/author/show/6540057.Andy_Weir\\" title=\\"Andy Weir\\" rel=\\"nofollow noopener\\">Andy Weir</a>\\n</b> (1972-) built a career as a software engineer until the success of his first published novel, <i><a href=\\"https://www.goodreads.com/book/show/18007564.The_Martian__2011_\\" title=\\"The Martian (2011)\\" rel=\\"nofollow noopener\\">The Martian (2011)</a>,</i> allowed him to live out his dream of writing fulltime. He is a lifelong space nerd and a devoted hobbyist of subjects such as relativistic physics, orbital mechanics, and the history of manned spaceflight. He also mixes a mean cocktail.","num_pages":3,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.34,"ratings_count":2739668,"text_reviews_count":277652}},"average_rating":4.21,"ratings_count":37467,"publication_day":15,"publication_month":8,"publication_year":2009},{"link":"https://www.goodreads.com/book/show/28820444-the-elephant-in-the-brain","title":"The Elephant in the Brain: Hidden Motives in Everyday Life","title_without_series":"The Elephant in the Brain: Hidden Motives in Everyday Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513355864l/28820444._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513355864l/28820444._SX98_.jpg","description":"Human beings are primates, and primates are political animals. Our brains, therefore, are designed not just to hunt and gather, but also to help us get ahead socially, often via deception and self-deception. But while we may be self-interested schemers, we benefit by pretending otherwise. The less we know about our own ugly motives, the better - and thus we don't like to talk or even think about the extent of our selfishness. This is \\"the elephant in the brain.\\" Such an introspective taboo makes it hard for us to think clearly about our nature and the explanations for our behavior. The aim of this book, then, is to confront our hidden motives directly - to track down the darker, unexamined corners of our psyches and blast them with floodlights. Then, once everything is clearly visible, we can work to better understand ourselves: Why do we laugh? Why are artists sexy? Why do we brag about travel? Why do we prefer to speak rather than listen?<br /><br />Our unconscious motives drive more than just our private behavior; they also infect our venerated social institutions such as Art, School, Charity, Medicine, Politics, and Religion. In fact, these institutions are in many ways designed to accommodate our hidden motives, to serve covert agendas alongside their \\"official\\" ones. The existence of big hidden motives can upend the usual political debates, leading one to question the legitimacy of these social institutions, and of standard policies designed to favor or discourage them. You won't see yourself - or the world - the same after confronting the elephant in the brain.","num_pages":408,"authors":{"author":{"id":14932232,"name":"Kevin Simler","role":"","image_url":"https://images.gr-assets.com/authors/1631175835p5/14932232.jpg","small_image_url":"https://images.gr-assets.com/authors/1631175835p2/14932232.jpg","link":"https://www.goodreads.com/author/show/14932232.Kevin_Simler","average_rating":3.96,"ratings_count":8382,"text_reviews_count":815}},"average_rating":3.96,"ratings_count":8374,"publication_day":"","publication_month":12,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/17660462-the-everything-store","title":"The Everything Store: Jeff Bezos and the Age of Amazon","title_without_series":"The Everything Store: Jeff Bezos and the Age of Amazon","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631792766l/17660462._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1631792766l/17660462._SX98_.jpg","description":"<b>The definitive story of Amazon.com, one of the most successful companies in the world, and of its driven, brilliant founder, Jeff Bezos.</b><br /><br />Amazon.com started off delivering books through the mail. But its visionary founder, Jeff Bezos, wasn't content with being a bookseller. He wanted Amazon to become the everything store, offering limitless selection and seductive convenience at disruptively low prices. To do so, he developed a corporate culture of relentless ambition and secrecy that's never been cracked. Until now. Brad Stone enjoyed unprecedented access to current and former Amazon employees and Bezos family members, giving readers the first in-depth, fly-on-the-wall account of life at Amazon. Compared to tech's other elite innovators--Jobs, Gates, Zuckerberg--Bezos is a private man. But he stands out for his restless pursuit of new markets, leading Amazon into risky new ventures like the Kindle and cloud computing, and transforming retail in the same way Henry Ford revolutionized manufacturing.<br /><br /><i>The Everything Store</i> will be the revealing, definitive biography of the company that placed one of the first and largest bets on the Internet and forever changed the way we shop and read.","num_pages":384,"authors":{"author":{"id":219908,"name":"Brad Stone","role":"","image_url":"https://images.gr-assets.com/authors/1483551689p5/219908.jpg","small_image_url":"https://images.gr-assets.com/authors/1483551689p2/219908.jpg","link":"https://www.goodreads.com/author/show/219908.Brad_Stone","average_rating":4.12,"ratings_count":91032,"text_reviews_count":4607}},"average_rating":4.14,"ratings_count":77161,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/46266188-the-fifth-risk","title":"The Fifth Risk: Undoing Democracy","title_without_series":"The Fifth Risk: Undoing Democracy","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1562687004l/46266188._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1562687004l/46266188._SX98_.jpg","description":"The morning after Trump was elected president, the people who ran the US Department of Energy waited to brief the administrations transition team on the agency it would soon be running. Nobody appeared. Across all departments the stories were the same: Trump appointees were few and far between; those who did show up were shockingly uninformed about the functions of their new workplace.<br /><br /><br />Michael Lewiss brilliant narrative of the Trump administrations botched presidential transition takes us into the engine rooms of a government under attack by its leaders through willful ignorance and greed. The government manages a vast array of critical services that keep us safe and underpin our lives, from ensuring the safety of our food and medications and predicting extreme weather events to tracking and locating black- market uranium before the terrorists do. <em>The Fifth Risk</em> masterfully and vividly unspools the consequences of what happens when the people given control over our government have no idea how it works.","num_pages":255,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":4.1,"ratings_count":47843,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/16158493-the-first-20-hours","title":"The First 20 Hours: How to Learn Anything...Fast","title_without_series":"The First 20 Hours: How to Learn Anything...Fast","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1364771935l/16158493._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1364771935l/16158493._SX98_.jpg","description":"Cun sch ny l cuc tm kim ca c nhn ti nhm kim tra tnh ngh thut v khoa hc ca vic hc k nng nhanh chng - lm cch no  hc bt c k nng no nhanh nht c th. Mc ch ca cun sch ny l gip bn hc c nhng k nng mi trong khong thi gian k lc. Theo kinh nghim ca ti, mt khong 20 gi thc hnh  ph v ro cn tht v  i t mc hon ton khng bit g v vic bn ang c gng lm ti mc c th lm vic  tt mt cch ng ngc nhin. Cun sch ny l cch tip cn mang tnh h thng i vi vn  hc k nng mi nhanh nht c th. Phng php mang tnh ph qut. Vn  khng phi l bn mun hc ngoi ng, vit tiu thuyt, v chn dung, khi nghip hay li my bay. Nu bn u t t nht 20 ting  hc nhng iu c bn ca mt k nng, bn s ngc nhin vi mc  thnh tho m bn c th t c. Bt k k nng bn mun hc l g, cun sch ny cng s gip bn t c k nng  vi t thi gian v nng lng lng ph hn. Ch cn mt cht n lc tp trung, c chin lc, bn s thy mnh nhanh chng tin b m khng tht vng.<br />Trong cun sch ny, chng ta s bt u bng nhng nguyn tc hc k nng lm cch no  hc nhng k nng mi nhanh nht c th. Nhng  tng v bi tp thc hnh ny khng h phc tp, nn s khng mt qu nhiu thi gian  hc. Sau , ti s gii thch cch s dng nhng nguyn tc ny trong thc t bng cch ch cho cc bn bit ti  hc 6 k nng mi di y trong vng cha ti 20 ting mi k nng, khng qu 90 pht thc hnh mi ngy, nh th no.<br />- Pht trin bi tp yoga c nhn<br />- Vit chng trnh my tnh da trn web<br />- Hc li cch g 10 ngn<br />- Khm ph boardgame c nht v phc tp nht trong lch s<br />- Chi c mt nhc c<br />- Lt vn<br />Ti hi vng cun sch ny c th khuyn khch bn phi bi danh sch nhng vic mun lm ca bn, kim tra li danh sch  v cam kt hc c iu mi m no .","num_pages":"","authors":{"author":{"id":4409125,"name":"Josh Kaufman","role":"","image_url":"https://images.gr-assets.com/authors/1309447929p5/4409125.jpg","small_image_url":"https://images.gr-assets.com/authors/1309447929p2/4409125.jpg","link":"https://www.goodreads.com/author/show/4409125.Josh_Kaufman","average_rating":4.01,"ratings_count":58409,"text_reviews_count":2645}},"average_rating":3.46,"ratings_count":8025,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18295861-the-first-fifteen-lives-of-harry-august","title":"The First Fifteen Lives of Harry August","title_without_series":"The First Fifteen Lives of Harry August","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1379133081l/18295861._SX98_.jpg","description":"Some stories cannot be told in just one lifetime. Harry August is on his deathbed. Again. No matter what he does or the decisions he makes, when death comes, Harry always returns to where he began, a child with all the knowledge of a life he has already lived a dozen times before. Nothing ever changes. Until now. As Harry nears the end of his eleventh life, a little girl appears at his bedside. \\"I nearly missed you, Doctor August,\\" she says. \\"I need to send a message.\\" This is the story of what Harry does next, and what he did before, and how he tries to save a past he cannot change and a future he cannot allow.","num_pages":416,"authors":{"author":{"id":7210024,"name":"Claire North","role":"","image_url":"https://images.gr-assets.com/authors/1440105009p5/7210024.jpg","small_image_url":"https://images.gr-assets.com/authors/1440105009p2/7210024.jpg","link":"https://www.goodreads.com/author/show/7210024.Claire_North","average_rating":3.91,"ratings_count":172667,"text_reviews_count":23086}},"average_rating":4.03,"ratings_count":98578,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/30165919-the-god-delusion","title":"The God Delusion","title_without_series":"The God Delusion","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1476116806l/30165919._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1476116806l/30165919._SX98_.jpg","description":"<i>The God Delusion</i> caused a sensation when it was published in 2006. Within weeks it became the most hotly debated topic, with Dawkins himself branded as either saint or sinner for presenting his hard-hitting, impassioned rebuttal of religion of all types.<br /><br />His argument could hardly be more topical. While Europe is becoming increasingly secularized, the rise of religious fundamentalism, whether in the Middle East or Middle America, is dramatically and dangerously dividing opinion around the world. In America, and elsewhere, a vigorous dispute between 'intelligent design' and Darwinism is seriously undermining and restricting the teaching of science. In many countries religious dogma from medieval times still serves to abuse basic human rights such as women's and gay rights. And all from a belief in a God whose existence lacks evidence of any kind.<br /><br />Dawkins attacks God in all his forms. He eviscerates the major arguments for religion and demonstrates the supreme improbability of a supreme being. He shows how religion fuels war, foments bigotry and abuses children.<br /><br /><i>The God Delusion </i>is a brilliantly argued, fascinating polemic that will be required reading for anyone interested in this most emotional and important subject.","num_pages":471,"authors":{"author":{"id":1194,"name":"Richard Dawkins","role":"","image_url":"https://images.gr-assets.com/authors/1377030297p5/1194.jpg","small_image_url":"https://images.gr-assets.com/authors/1377030297p2/1194.jpg","link":"https://www.goodreads.com/author/show/1194.Richard_Dawkins","average_rating":4.03,"ratings_count":757961,"text_reviews_count":30157}},"average_rating":3.9,"ratings_count":282104,"publication_day":"","publication_month":"","publication_year":2016},{"link":"https://www.goodreads.com/book/show/44245196-the-great-mental-models","title":"The Great Mental Models: General Thinking Concepts","title_without_series":"The Great Mental Models: General Thinking Concepts","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"The old saying goes, \\"To the man with a hammer, everything looks like a nail.\\" But anyone who has done any kind of project knows a hammer often isn't enough. <br /> <br />The more tools you have at your disposal, the more likely you'll use the right tool for the job  and get it done right. <br /> <br />The same is true when it comes to your thinking. The quality of your outcomes depends on the mental models in your head. And most people are going through life with little more than a hammer. <br /> <br />Until now. <br /> <br />The Great Mental Models: General Thinking Concepts is the first book in The Great Mental Models series designed to upgrade your thinking with the best, most useful and powerful tools so you always have the right one on hand. <br /> <br />This volume details nine of the most versatile, all-purpose mental models you can use right away to improve your decision making, productivity, and how clearly you see the world. You will discover what forces govern the universe and how to focus your efforts so you can harness them to your advantage, rather than fight with them or worse yet ignore them. <br /> <br />Upgrade your mental toolbox and get the first volume today!","num_pages":"","authors":{"author":{"id":7871969,"name":"Shane Parrish","role":"","image_url":"https://images.gr-assets.com/authors/1686056002p5/7871969.jpg","small_image_url":"https://images.gr-assets.com/authors/1686056002p2/7871969.jpg","link":"https://www.goodreads.com/author/show/7871969.Shane_Parrish","average_rating":4.12,"ratings_count":22352,"text_reviews_count":1831}},"average_rating":4.07,"ratings_count":10183,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/11797471-the-idea-factory","title":"The Idea Factory: Bell Labs and the Great Age of American Innovation","title_without_series":"The Idea Factory: Bell Labs and the Great Age of American Innovation","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338504885l/11797471._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1338504885l/11797471._SX98_.jpg","description":"From its beginnings in the 1920s until its demise in the 1980s, Bell Labsofficially, the research and development wing of AT&amp;Twas the biggest, and arguably the best, laboratory for new ideas in the world. From the transistor to the laser, its hard to find an aspect of modern life that hasnt been touched by Bell Labs.<br /><br />Why did so many transformative ideas come from Bell Labs? In The Idea Factory, Jon Gertner traces the origins of some of the twentieth centurys most important inventions and delivers a riveting and heretofore untold chapter of American history. At its heart this is a story about the life and work of a small group of brilliant and eccentric menMervin Kelly, Bill Shockley, Claude Shannon, John Pierce, and Bill Bakerwho spent their careers at Bell Labs. Their job was to research and develop the future of communications. Small-town boys, childhood hobbyists, oddballs: they give the lie to the idea that Bell Labs was a grim cathedral of top-down command and control.<br /><br />Gertner brings to life the powerful alchemy of the forces at work behind Bell Labs inventions, teasing out the intersections between science, business, and society. He distills the lessons that abide: how to recruit and nurture young talent; how to organize and lead fractious employees; how to find solutions to the most stubbornly vexing problems; how to transform a scientific discovery into a marketable product, then make it even better, cheaper, or both. Today, when the drive to invent has become a mantra, Bell Labs offers us a way to enrich our understanding of the challenges and solutions to technological innovation. Here, after all, was where the foundational ideas on the management of innovation were born.<br />The Idea Factory is the story of the origins of modern communications and the beginnings of the information agea deeply human story of extraordinary men who were given extraordinary meanstime, space, funds, and access to one anotherand edged the world into a new dimension.","num_pages":"","authors":{"author":{"id":5808423,"name":"Jon Gertner","role":"","image_url":"https://images.gr-assets.com/authors/1554851617p5/5808423.jpg","small_image_url":"https://images.gr-assets.com/authors/1554851617p2/5808423.jpg","link":"https://www.goodreads.com/author/show/5808423.Jon_Gertner","average_rating":4.2,"ratings_count":10083,"text_reviews_count":1030}},"average_rating":4.2,"ratings_count":8794,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/21856367-the-innovators","title":"The Innovators: How a Group of Hackers, Geniuses and Geeks Created the Digital Revolution","title_without_series":"The Innovators: How a Group of Hackers, Geniuses and Geeks Created the Digital Revolution","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1410191571l/21856367._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1410191571l/21856367._SX98_.jpg","description":"Following his blockbuster biography of Steve Jobs, The Innovators is Walter Isaacsons revealing story of the people who created the computer and the Internet. It is destined to be the standard history of the digital revolution and an indispensable guide to how innovation really happens.<br /><br />What were the talents that allowed certain inventors and entrepreneurs to turn their visionary ideas into disruptive realities? What led to their creative leaps? Why did some succeed and others fail?<br /><br />In his masterly saga, Isaacson begins with Ada Lovelace, Lord Byrons daughter, who pioneered computer programming in the 1840s. He explores the fascinating personalities that created our current digital revolution, such as Vannevar Bush, Alan Turing, John von Neumann, J.C.R. Licklider, Doug Engelbart, Robert Noyce, Bill Gates, Steve Wozniak, Steve Jobs, Tim Berners-Lee, and Larry Page.<br /><br />This is the story of how their minds worked and what made them so inventive. Its also a narrative of how their ability to collaborate and master the art of teamwork made them even more creative.<br /><br />For an era that seeks to foster innovation, creativity, and teamwork, The Innovators shows how they happen.","num_pages":542,"authors":{"author":{"id":7111,"name":"Walter Isaacson","role":"","image_url":"https://images.gr-assets.com/authors/1192222433p5/7111.jpg","small_image_url":"https://images.gr-assets.com/authors/1192222433p2/7111.jpg","link":"https://www.goodreads.com/author/show/7111.Walter_Isaacson","average_rating":4.16,"ratings_count":2011167,"text_reviews_count":54288}},"average_rating":4.12,"ratings_count":39629,"publication_day":7,"publication_month":10,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/37751071-the-little-book-of-common-sense-investing","title":"The Little Book of Common Sense Investing: The Only Way to Guarantee Your Fair Share of Stock Market Returns","title_without_series":"The Little Book of Common Sense Investing: The Only Way to Guarantee Your Fair Share of Stock Market Returns","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1515011941l/37751071._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1515011941l/37751071._SX98_.jpg","description":"The best-selling investing \\"bible\\" offers new information, new insights, and new perspectives<br /><br /><i>The Little Book of Common Sense Investing</i> is the classic guide to getting smart about the market. Legendary mutual fund pioneer John C. Bogle reveals his key to getting more out of investing: low-cost index funds. Bogle describes the simplest and most effective investment strategy for building wealth over the long term: buy and hold, at very low cost, a mutual fund that tracks a broad stock market Index such as the S&amp;P 500.<br /><br />While the stock market has tumbled and then soared since the first edition of <i>The Little Book of Common Sense Investing</i> was published in April 2007, Bogle's investment principles have endured and served investors well. This tenth anniversary edition includes updated data and new information but maintains the same long-term perspective as in its predecessor. Bogle has also added two new chapters designed to provide further guidance to investors: one on asset allocation, the other on retirement investing.<br /><br />A portfolio focused on index funds is the only investment that effectively guarantees your fair share of stock market returns. This strategy is favored by Warren Buffett, who said this about Bogle: \\"For decades, Jack has urged investors to invest in ultra-low-cost index funds.... Today, however, he has the satisfaction of knowing that he helped millions of investors realize far better returns on their savings than they otherwise would have earned. He is a hero to them and to me.\\"<br /><br />Bogle shows you how to make index investing work for you and help you achieve your financial goals and finds support from some of the world's best financial minds: not only Warren Buffett but Benjamin Graham, Paul Samuelson, Burton Malkiel, Yale's David Swensen, Cliff Asness of AQR, and many others.<br /><br />This new edition of <i>The Little Book of Common Sense Investing</i> offers you the same solid strategy as its predecessor for building your financial future.<br /><br /><br />Build a broadly diversified, low-cost portfolio without the risks of individual stocks, manager selection, or sector rotation.<br />Forget the fads and marketing hype, and focus on what works in the real world.<br />Understand that stock returns are generated by three sources (dividend yield, earnings growth, and change in market valuation) in order to establish rational expectations for stock returns over the coming decade.<br />Recognize that in the long run, business reality trumps market expectations.<br />Learn how to harness the magic of compounding returns while avoiding the tyranny of compounding costs.<br />While index investing allows you to sit back and let the market do the work for you, too many investors trade frantically, turning a winner's game into a loser's game. <i>The Little Book of Common Sense Investing</i> is a solid guidebook to your financial future.","num_pages":"","authors":{"author":{"id":88909,"name":"John C. Bogle","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/88909.John_C_Bogle","average_rating":4.14,"ratings_count":46044,"text_reviews_count":3598}},"average_rating":4.15,"ratings_count":25832,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/1249095.The_Logic_of_Life","title":"The Logic of Life: The Rational Economics of an Irrational World","title_without_series":"The Logic of Life: The Rational Economics of an Irrational World","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"Life sometimes seems illogical. Individuals do strange things: take drugs, have unprotected sex, mug each other. Love seems irrational, and so does divorce. On a larger scale, life seems no fairer or easier to fathom: Why do some neighborhoods thrive and others become ghettos? Why is racism so persistent? Why is your idiot boss paid a fortune for sitting behind a mahogany altar? Thorny questionsand you might be surprised to hear the answers coming from an economist. But award-winning journalist Tim Harford likes to spring surprises. In this deftly reasoned book, he argues that life is logical after all. Under the surface of everyday insanity, hidden incentives are at work, and Harford shows these incentives emerging in the most unlikely places.","num_pages":213,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60509,"text_reviews_count":4325}},"average_rating":3.81,"ratings_count":5835,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/18007564-the-martian","title":"The Martian","title_without_series":"The Martian","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1413706054l/18007564._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1413706054l/18007564._SX98_.jpg","description":"Six days ago, astronaut Mark Watney became one of the first people to walk on Mars. <br /><br />Now, hes sure hell be the first person to die there.<br /><br />After a dust storm nearly kills him and forces his crew to evacuate while thinking him dead, Mark finds himself stranded and completely alone with no way to even signal Earth that hes aliveand even if he could get word out, his supplies would be gone long before a rescue could arrive. <br /><br />Chances are, though, he wont have time to starve to death. The damaged machinery, unforgiving environment, or plain-old human error are much more likely to kill him first. <br /><br />But Mark isnt ready to give up yet. Drawing on his ingenuity, his engineering skills  and a relentless, dogged refusal to quit  he steadfastly confronts one seemingly insurmountable obstacle after the next. Will his resourcefulness be enough to overcome the impossible odds against him?<br /><br />","num_pages":384,"authors":{"author":{"id":6540057,"name":"Andy Weir","role":"","image_url":"https://images.gr-assets.com/authors/1382592903p5/6540057.jpg","small_image_url":"https://images.gr-assets.com/authors/1382592903p2/6540057.jpg","link":"https://www.goodreads.com/author/show/6540057.Andy_Weir","average_rating":4.34,"ratings_count":2739668,"text_reviews_count":277652}},"average_rating":4.42,"ratings_count":1272719,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/52578297-the-midnight-library","title":"The Midnight Library","title_without_series":"The Midnight Library","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602190253l/52578297._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602190253l/52578297._SX98_.jpg","description":"Between life and death there is a library.<br /><br />When Nora Seed finds herself in the Midnight Library, she has a chance to make things right. Up until now, her life has been full of misery and regret. She feels she has let everyone down, including herself. But things are about to change.<br /><br />The books in the Midnight Library enable Nora to live as if she had done things differently. With the help of an old friend, she can now undo every one of her regrets as she tries to work out her perfect life. But things aren't always what she imagined they'd be, and soon her choices place the library and herself in extreme danger.<br /><br />Before time runs out, she must answer the ultimate question: what is the best way to live?","num_pages":288,"authors":{"author":{"id":76360,"name":"Matt Haig","role":"","image_url":"https://images.gr-assets.com/authors/1708503977p5/76360.jpg","small_image_url":"https://images.gr-assets.com/authors/1708503977p2/76360.jpg","link":"https://www.goodreads.com/author/show/76360.Matt_Haig","average_rating":3.95,"ratings_count":3273786,"text_reviews_count":338697}},"average_rating":3.98,"ratings_count":2403221,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/998.The_Millionaire_Next_Door","title":"The Millionaire Next Door: The Surprising Secrets of America's Wealthy","title_without_series":"The Millionaire Next Door: The Surprising Secrets of America's Wealthy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"The incredible national bestseller that is changing people's lives -- and increasing their net worth! <p> <b>CAN YOU SPOT THE MILLIONAIRE NEXT DOOR?</b> </p><p> <b>Who are the rich in this country?</b></p><p> What do they do?</p><p> Where do they shop?</p><p> What do they drive?</p><p> How do they invest?</p><p> Where did their ancestors come from?</p><p> How did they get rich?</p><p> Can I ever become one of them?</p><p> </p><p> Get the answers in <i>The Millionaire Next Door,</i> the never-before-told story about wealth in America. You'll be surprised at what you find out....</p>","num_pages":258,"authors":{"author":{"id":659,"name":"Thomas J. Stanley","role":"","image_url":"https://images.gr-assets.com/authors/1555867691p5/659.jpg","small_image_url":"https://images.gr-assets.com/authors/1555867691p2/659.jpg","link":"https://www.goodreads.com/author/show/659.Thomas_J_Stanley","average_rating":4.07,"ratings_count":167056,"text_reviews_count":6465}},"average_rating":4.05,"ratings_count":132909,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50998056-the-ministry-for-the-future","title":"The Ministry for the Future","title_without_series":"The Ministry for the Future","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1668935201l/50998056._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1668935201l/50998056._SX98_.jpg","description":"Established in 2025, the purpose of the new organization was simple: To advocate for the world's future generations and to protect all living creatures, present and future. It soon became known as the Ministry for the Future, and this is its story. <br /><br />From legendary science fiction author Kim Stanley Robinson comes a vision of climate change unlike any ever imagined. <br /><br />Told entirely through fictional eye-witness accounts, <i>The Ministry for the Future</i> is a masterpiece of the imagination, the story of how climate change will affect us all over the decades to come. <br /><br />Its setting is not a desolate, post-apocalyptic world, but a future that is almost upon usand in which we might just overcome the extraordinary challenges we face. <br /><br />It is a novel both immediate and impactful, desperate and hopeful in equal measure, and it is one of the most powerful and original books on climate change ever written.","num_pages":563,"authors":{"author":{"id":1858,"name":"Kim Stanley Robinson","role":"","image_url":"https://images.gr-assets.com/authors/1376955089p5/1858.jpg","small_image_url":"https://images.gr-assets.com/authors/1376955089p2/1858.jpg","link":"https://www.goodreads.com/author/show/1858.Kim_Stanley_Robinson","average_rating":3.83,"ratings_count":496125,"text_reviews_count":36088}},"average_rating":3.86,"ratings_count":41737,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/39722612-the-people-vs-tech","title":"The People Vs Tech: How the internet is killing democracy","title_without_series":"The People Vs Tech: How the internet is killing democracy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"In the ongoing waves of the Facebook scandal, this is the book that explains all the dangers of the digital revolution, and how our mountains of personal cyberdata are being mined by everyone from our own governments and political parties to big business to exploit our trust and threaten our freedom.<br /><br />The internet was meant to set us free. But have we unwittingly handed too much away to shadowy powers behind a wall of code, all manipulated by a handful of Silicon Valley utopians, ad men, and venture capitalists? And, in light of recent data breach scandals around companies like Facebook and Cambridge Analytica, what does that mean for democracy, our delicately balanced system of government that was created long before big data, total information, and artificial intelligence? In this urgent polemic, Jamie Bartlett argues that through our unquestioning embrace of big tech, the building blocks of democracy are slowly being removed. The middle class is being eroded, sovereign authority and civil society is weakened, and we citizens are losing our critical faculties, maybe even our free will.<br /><br /><i>The People Vs Tech</i> is an enthralling account of how our fragile political system is being threatened by the digital revolution. Bartlett explains that by upholding six key pillars of democracy, we can save it before it is too late. We need to become active citizens, uphold a shared democratic culture, protect free elections, promote equality, safeguard competitive and civic freedoms, and trust in a sovereign authority. This essential book shows that the stakes couldn't be higher and that, unless we radically alter our course, democracy will join feudalism, supreme monarchies and communism as just another political experiment that quietly disappeared.","num_pages":"","authors":{"author":{"id":7489747,"name":"Jamie Bartlett","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/7489747.Jamie_Bartlett","average_rating":3.81,"ratings_count":8470,"text_reviews_count":964}},"average_rating":3.9,"ratings_count":1718,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/17255186-the-phoenix-project","title":"The Phoenix Project: A Novel About IT, DevOps, and Helping Your Business Win","title_without_series":"The Phoenix Project: A Novel About IT, DevOps, and Helping Your Business Win","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1361113128l/17255186._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1361113128l/17255186._SX98_.jpg","description":"Bill is an IT manager at Parts Unlimited. It's Tuesday morning and on his drive into the office, Bill gets a call from the CEO. <br /><br />The company's new IT initiative, code named Phoenix Project, is critical to the future of Parts Unlimited, but the project is massively over budget and very late. The CEO wants Bill to report directly to him and fix the mess in ninety days or else Bill's entire department will be outsourced. <br /><br />With the help of a prospective board member and his mysterious philosophy of The Three Ways, Bill starts to see that IT work has more in common with manufacturing plant work than he ever imagined. With the clock ticking, Bill must organize work flow streamline interdepartmental communications, and effectively serve the other business functions at Parts Unlimited. <br /><br />In a fast-paced and entertaining style, three luminaries of the DevOps movement deliver a story that anyone who works in IT will recognize. Readers will not only learn how to improve their own IT organizations, they'll never view IT the same way again.","num_pages":345,"authors":{"author":{"id":328437,"name":"Gene Kim","role":"","image_url":"https://images.gr-assets.com/authors/1361113444p5/328437.jpg","small_image_url":"https://images.gr-assets.com/authors/1361113444p2/328437.jpg","link":"https://www.goodreads.com/author/show/328437.Gene_Kim","average_rating":4.21,"ratings_count":75935,"text_reviews_count":6131}},"average_rating":4.26,"ratings_count":49700,"publication_day":10,"publication_month":1,"publication_year":2013},{"link":"https://www.goodreads.com/book/show/56696339-the-power-of-geography","title":"The Power of Geography: Ten Maps That Reveal the Future of Our World","title_without_series":"The Power of Geography: Ten Maps That Reveal the Future of Our World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610902279l/56696339._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1610902279l/56696339._SX98_.jpg","description":"In this revelatory new book, Marshall explores ten regions that are set to shape global politics in a new age of great-power rivalry: Australia, Iran, Saudi Arabia, the UK, Greece, Turkey, the Sahel, Ethiopia, Spain and Space. Find out why Europes next refugee crisis is closer than it thinks as trouble brews in the Sahel; why the Middle East must look beyond oil and sand to secure its future; why the eastern Mediterranean is one of the most volatile flashpoints of the twenty-first century; and why the Earths atmosphere is set to become the worlds next battleground.<br /><br />Delivered with Marshalls trademark wit and insight, this is a lucid and gripping exploration of the power of geography to shape humanitys past, present  and future.<br /><br />Another outstanding guide to the modern world. Marshall is a master at explaining what you need to know and why. Peter Frankopan","num_pages":360,"authors":{"author":{"id":713466,"name":"Tim  Marshall","role":"","image_url":"https://images.gr-assets.com/authors/1489696759p5/713466.jpg","small_image_url":"https://images.gr-assets.com/authors/1489696759p2/713466.jpg","link":"https://www.goodreads.com/author/show/713466.Tim_Marshall","average_rating":4.14,"ratings_count":163367,"text_reviews_count":13540}},"average_rating":4.19,"ratings_count":24306,"publication_day":22,"publication_month":4,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/17248798-the-power-of-habit","title":"The Power of Habit: Why We Do What We Do and How to Change","title_without_series":"The Power of Habit: Why We Do What We Do and How to Change","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1366562921l/17248798._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1366562921l/17248798._SX98_.jpg","description":"Habits are difficult to change. The neuroscience behind the functioning of habits is still not known to many. On one hand, there is always one section of the society which finds it exceptionally easy to adapt to new situations, new environment and frequent changes. On the other hand, there are people and organizations who strive hard to mold themselves into a changing environment.<br /><br />The Power of Habit: Why We Do What We Do and How To Change presents us with brilliant information in the most engaging way that enlightens us towards the depth of human nature and its tremendous potential to transform. Through this book we visit laboratories where neuroscientists explore how habits work and where, exactly, they reside in our brains. We also understand the importance of the right habits which led to the success of great personalities.<br /><br />Keystone habits help earn billions and can also make a difference between failure and success, life and death. Hence, The Power of Habit: Why We Do What We Do and How To Change gives the readers an insight into the world's top notch companies, Rick Warren's Saddleback Church, NFL locker rooms and the nation's largest hospital to suggest the importance of right habits.","num_pages":371,"authors":{"author":{"id":5201530,"name":"Charles Duhigg","role":"","image_url":"https://images.gr-assets.com/authors/1349273209p5/5201530.jpg","small_image_url":"https://images.gr-assets.com/authors/1349273209p2/5201530.jpg","link":"https://www.goodreads.com/author/show/5201530.Charles_Duhigg","average_rating":4.11,"ratings_count":630242,"text_reviews_count":30260}},"average_rating":4.13,"ratings_count":558242,"publication_day":"","publication_month":"","publication_year":2013},{"link":"https://www.goodreads.com/book/show/56790170-the-premonition","title":"The Premonition: A Pandemic Story","title_without_series":"The Premonition: A Pandemic Story","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1611844095l/56790170._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1611844095l/56790170._SX98_.jpg","description":"<b>For those who could read between the lines, the censored news out of China was terrifying. But the president insisted there was nothing to worry about.</b><br /><br />Fortunately, we are still a nation of skeptics. Fortunately, there are those among us who study pandemics and are willing to look unflinchingly at worst-case scenarios. Michael Lewiss taut and brilliant nonfiction thriller pits a band of medical visionaries against the wall of ignorance that was the official response of the Trump administration to the outbreak of COVID-19.<br /><br />The characters you will meet in these pages are as fascinating as they are unexpected. A thirteen-year-old girls science project on transmission of an airborne pathogen develops into a very grown-up model of disease control. A local public-health officer uses her worms-eye view to see what the CDC misses, and reveals great truths about American society. A secret team of dissenting doctors, nicknamed the Wolverines, has everything necessary to fight the pandemic: brilliant backgrounds, world-class labs, prior experience with the pandemic scares of bird flu and swine flueverything, that is, except official permission to implement their work.<br /><br />Michael Lewis is not shy about calling these people heroes for their refusal to follow directives that they know to be based on misinformation and bad science. Even the internet, as crucial as it is to their exchange of ideas, poses a risk to them. They never know for sure who else might be listening in.","num_pages":304,"authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":4.33,"ratings_count":42708,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/13766064-the-psychology-book","title":"The Psychology Book: Big Ideas Simply Explained","title_without_series":"The Psychology Book: Big Ideas Simply Explained","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1337573169l/13766064._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1337573169l/13766064._SX98_.jpg","description":"Clearly explaining more than 100 groundbreaking ideas in the field, The Psychology Book uses accessible text and easy-to-follow graphics and illustrations to explain the complex theoretical and experimental foundations of psychology.<br /><br />From its philosophical roots through behaviorism, psychotherapy, and developmental psychology, The Psychology Book looks at all the greats from Pavlov and Skinner to Freud and Jung, and is an essential reference for students and anyone with an interest in how the mind works.","num_pages":"","authors":{"author":{"id":414326,"name":"Nigel C. Benson","role":"","image_url":"https://images.gr-assets.com/authors/1388229934p5/414326.jpg","small_image_url":"https://images.gr-assets.com/authors/1388229934p2/414326.jpg","link":"https://www.goodreads.com/author/show/414326.Nigel_C_Benson","average_rating":3.98,"ratings_count":7893,"text_reviews_count":579}},"average_rating":4.17,"ratings_count":5090,"publication_day":16,"publication_month":1,"publication_year":2012},{"link":"https://www.goodreads.com/book/show/41881472-the-psychology-of-money","title":"The Psychology of Money","title_without_series":"The Psychology of Money","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1581527774l/41881472._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1581527774l/41881472._SX98_.jpg","description":"Doing well with money isn't necessarily about what you know. It's about how you behave. And behavior is hard to teach, even to really smart people. Money--investing, personal finance, and business decisions--is typically taught as a math-based field, where data and formulas tell us exactly what to do. But in the real world people don't make financial decisions on a spreadsheet. They make them at the dinner table, or in a meeting room, where personal history, your own unique view of the world, ego, pride, marketing, and odd incentives are scrambled together. In The Psychology of Money, award-winning author Morgan Housel shares 19 short stories exploring the strange ways people think about money and teaches you how to make better sense of one of life's most important topics.","num_pages":242,"authors":{"author":{"id":7499284,"name":"Morgan Housel","role":"","image_url":"https://images.gr-assets.com/authors/1669719604p5/7499284.jpg","small_image_url":"https://images.gr-assets.com/authors/1669719604p2/7499284.jpg","link":"https://www.goodreads.com/author/show/7499284.Morgan_Housel","average_rating":4.28,"ratings_count":338821,"text_reviews_count":22445}},"average_rating":4.29,"ratings_count":309398,"publication_day":8,"publication_month":9,"publication_year":2020},{"link":"https://www.goodreads.com/book/show/29807115-the-selfish-gene","title":"The Selfish Gene","title_without_series":"The Selfish Gene","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1463949436l/29807115._SX98_.jpg","description":"The million copy international bestseller, critically acclaimed and translated into over 25 languages. <br />As influential today as when it was first published, The Selfish Gene has become a classic exposition of evolutionary thought. Professor Dawkins articulates a gene's eye view of evolution - a view giving centre stage to these persistent units of information, and in which organisms can be seen as vehicles for their replication. This imaginative, powerful, and stylistically brilliant work not only brought the insights of Neo-Darwinism to a wide audience, but galvanized the biology community, generating much debate and stimulating whole new areas of research. Forty years later, its insights remain as relevant today as on the day it was published. <br />This 40th anniversary edition includes a new epilogue from the author discussing the continuing relevance of these ideas in evolutionary biology today, as well as the original prefaces and foreword, and extracts from early reviews. <br />Oxford Landmark Science books are 'must-read' classics of modern science writing which have crystallized big ideas, and shaped the way we think.<br />","num_pages":464,"authors":{"author":{"id":1194,"name":"Richard Dawkins","role":"","image_url":"https://images.gr-assets.com/authors/1377030297p5/1194.jpg","small_image_url":"https://images.gr-assets.com/authors/1377030297p2/1194.jpg","link":"https://www.goodreads.com/author/show/1194.Richard_Dawkins","average_rating":4.03,"ratings_count":757961,"text_reviews_count":30157}},"average_rating":4.16,"ratings_count":191695,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/2054761.The_Snowball","title":"The Snowball: Warren Buffett and the Business of Life","title_without_series":"The Snowball: Warren Buffett and the Business of Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320458276l/2054761._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1320458276l/2054761._SX98_.jpg","description":"Bulgarele de zapada este o biografie exhaustiva, in care detaliile despre viata personala se combina cu cele de natura profesionala, intr-un melanj impresionant, dezvaluit cu o fluiditate narativa deosebita. Pentru prima data, Warren Buffett permite accesul unui autor la timpul sau, la prietenii si familia lui, dar si la partenerii de afaceri sau documentele sale personale. Este un act de curaj, fiindca, asemenea tuturor fiintelor umane, si viata lui Buffett a fost un amestec de tarie si fragilitate. Spre deosebire de alte carti, care se rezuma doar la stilul sau de investitii, lucrarea de fata exploreaza filosofia de viata si personalitatea uluitoare a celui supranumit Oracolul din Omaha.<br /><br />Warren Buffett este un complex de paradoxuri, care si-a propus sa demonstreze ca si baietii buni pot iesi pe primul loc. De-a lungul anilor si-a tratat investitorii ca pe niste parteneri, a actionat ca indrumator al acestora, iar principala sa caracteristica in calitate de investitor, CEO, membru al diverselor consilii directoare din companii, eseist si orator a fost onestitatea, care l-a insotit pe tot parcursul vietii si in toate actiunile, ajungand la un moment cel mai bogat om din lume si cel care a facut cea mai mare donatie din istorie, si nu oricui, ci fundatiei conduse de Bill Gates, de care il leaga o stransa prietenie.<br /><br />Indiferent cat de mare este averea sa, mostenirea pe care o lasa Buffett nu se rezuma doar la bani, ci la principiile de viata si ideile cu care a imbogatit vietile celorlalti. Vom vedea astfel de ce Warren Buffett este cea mai fascinanta istorie de succes a vremurilor noastre.","num_pages":960,"authors":{"author":{"id":933665,"name":"Alice Schroeder","role":"","image_url":"https://images.gr-assets.com/authors/1227584009p5/933665.jpg","small_image_url":"https://images.gr-assets.com/authors/1227584009p2/933665.jpg","link":"https://www.goodreads.com/author/show/933665.Alice_Schroeder","average_rating":4.16,"ratings_count":54041,"text_reviews_count":1770}},"average_rating":4.16,"ratings_count":53977,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/7090.The_Soul_of_a_New_Machine","title":"The Soul of a New Machine","title_without_series":"The Soul of a New Machine","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627012239l/7090._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1627012239l/7090._SX98_.jpg","description":"The computer revolution brought with it new methods of getting work donejust look at today's news for reports of hard-driven, highly-motivated young software and online commerce developers who sacrifice evenings and weekends to meet impossible deadlines. Tracy Kidder got a preview of this world in the late 1970s when he observed the engineers of Data General design and build a new 32-bit minicomputer in just one year. His thoughtful, prescient book, <i>The Soul of a New Machine</i>, tells stories of 35-year-old \\"veteran\\" engineers hiring recent college graduates and encouraging them to work harder and faster on complex and difficult projects, exploiting the youngsters' ignorance of normal scheduling processes while engendering a new kind of work ethic.<br /><br />These days, we are used to the \\"total commitment\\" philosophy of managing technical creation, but Kidder was surprised and even a little alarmed at the obsessions and compulsions he found. From in-house political struggles to workers being permitted to tease management to marathon 24-hour work sessions, <i>The Soul of a New Machine</i> explores concepts that already seem familiar, even old-hat, less than 20 years later. Kidder plainly admires his subjects; while he admits to hopeless confusion about their work, he finds their dedication heroic. The reader wonders, though, what will become of it all, now and in the future. <i>Rob Lightner</i>","num_pages":293,"authors":{"author":{"id":4770,"name":"Tracy Kidder","role":"","image_url":"https://images.gr-assets.com/authors/1205329434p5/4770.jpg","small_image_url":"https://images.gr-assets.com/authors/1205329434p2/4770.jpg","link":"https://www.goodreads.com/author/show/4770.Tracy_Kidder","average_rating":4.15,"ratings_count":139537,"text_reviews_count":12015}},"average_rating":4.12,"ratings_count":9401,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/28257707-the-subtle-art-of-not-giving-a-f-ck","title":"The Subtle Art of Not Giving a F*ck: A Counterintuitive Approach to Living a Good Life","title_without_series":"The Subtle Art of Not Giving a F*ck: A Counterintuitive Approach to Living a Good Life","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1465761302l/28257707._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1465761302l/28257707._SX98_.jpg","description":"<i>Alternate cover edition of ISBN 9780062457738</i><br /><br />In this generation-defining self-help guide, a superstar blogger cuts through the crap to show us how to stop trying to be \\"positive\\" all the time so that we can truly become better, happier people.<br /><br />For decades, weve been told that positive thinking is the key to a happy, rich life. \\"F**k positivity,\\" Mark Manson says. \\"Lets be honest, shit is f**ked and we have to live with it.\\" In his wildly popular Internet blog, Manson doesnt sugarcoat or equivocate. He tells it like it isa dose of raw, refreshing, honest truth that is sorely lacking today. <em>The Subtle Art of Not Giving a F**k</em> is his antidote to the coddling, lets-all-feel-good mindset that has infected American society and spoiled a generation, rewarding them with gold medals just for showing up.<br /><br />Manson makes the argument, backed both by academic research and well-timed poop jokes, that improving our lives hinges not on our ability to turn lemons into lemonade, but on learning to stomach lemons better. Human beings are flawed and limited\\"not everybody can be extraordinary, there are winners and losers in society, and some of it is not fair or your fault.\\" Manson advises us to get to know our limitations and accept them. Once we embrace our fears, faults, and uncertainties, once we stop running and avoiding and start confronting painful truths, we can begin to find the courage, perseverance, honesty, responsibility, curiosity, and forgiveness we seek.<br /><br />There are only so many things we can give a f**k about so we need to figure out which ones really matter, Manson makes clear. While money is nice, caring about what you do with your life is better, because true wealth is about experience. A much-needed grab-you-by-the-shoulders-and-look-you-in-the-eye moment of real-talk, filled with entertaining stories and profane, ruthless humor, <em>The Subtle Art of Not Giving a F**k</em> is a refreshing slap for a generation to help them lead contented, grounded lives.","num_pages":212,"authors":{"author":{"id":8529755,"name":"Mark Manson","role":"","image_url":"https://images.gr-assets.com/authors/1410365708p5/8529755.jpg","small_image_url":"https://images.gr-assets.com/authors/1410365708p2/8529755.jpg","link":"https://www.goodreads.com/author/show/8529755.Mark_Manson","average_rating":3.88,"ratings_count":1579298,"text_reviews_count":90533}},"average_rating":3.87,"ratings_count":1383509,"publication_day":13,"publication_month":9,"publication_year":2016},{"link":"https://www.goodreads.com/book/show/75598048-the-things-we-make","title":"The Things We Make: The Unknown History of Invention from Cathedrals to Soda Cans","title_without_series":"The Things We Make: The Unknown History of Invention from Cathedrals to Soda Cans","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"Discover the secret method used to build the world<br /><br />For millennia, humans have used one simple method to solve problems. Whether it's planting crops, building skyscrapers, developing photographs, or designing the first microchip, all creators follow the same steps to engineer progress. But this powerful method, the \\"engineering method\\", is an all but hidden process that few of us have heard oflet alone understandbut that influences every aspect of our lives.<br /><br />Bill Hammack, a Carl Sagan award-winning professor of engineering and viral \\"The Engineer Guy\\" on Youtube, has a lifelong passion for the things we make, and how we make them. Now, for the first time, he reveals the invisible method behind every invention and takes us on a whirlwind tour of how humans built the world we know today. From the grand stone arches of medieval cathedrals to the mundane modern soda can, Hammack explains the golden rule of thumb that underlies every new building technique, every technological advancement, and every creative solution that leads us one step closer to a better, more functional world. Spanning centuries and cultures, Hammack offers a fascinating perspective on how humans engineer solutions in a world full of problems.<br /><br />A book unlike any other, The Things We Make is a captivating examination of the method that keeps pushing humanity forward, a spotlight on the achievements of the past, and a celebration of the potential of our future that will change the way we see the world around us.","num_pages":272,"authors":{"author":{"id":4633760,"name":"Bill Hammack","role":"","image_url":"https://images.gr-assets.com/authors/1413035146p5/4633760.jpg","small_image_url":"https://images.gr-assets.com/authors/1413035146p2/4633760.jpg","link":"https://www.goodreads.com/author/show/4633760.Bill_Hammack","average_rating":3.85,"ratings_count":1921,"text_reviews_count":221}},"average_rating":3.75,"ratings_count":1227,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/20518872-the-three-body-problem","title":"The Three-Body Problem (Remembrance of Earths Past, #1)","title_without_series":"The Three-Body Problem","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1415428227l/20518872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1415428227l/20518872._SX98_.jpg","description":"Set against the backdrop of China's Cultural Revolution, a secret military project sends signals into space to establish contact with aliens. An alien civilization on the brink of destruction captures the signal and plans to invade Earth. Meanwhile, on Earth, different camps start forming, planning to either welcome the superior beings and help them take over a world seen as corrupt, or to fight against the invasion.","num_pages":472,"authors":{"author":{"id":5780686,"name":"Liu Cixin","role":"","image_url":"https://images.gr-assets.com/authors/1454974329p5/5780686.jpg","small_image_url":"https://images.gr-assets.com/authors/1454974329p2/5780686.jpg","link":"https://www.goodreads.com/author/show/5780686.Liu_Cixin","average_rating":4.2,"ratings_count":932269,"text_reviews_count":88046}},"average_rating":4.08,"ratings_count":484214,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/2612.The_Tipping_Point","title":"The Tipping Point: How Little Things Can Make a Big Difference","title_without_series":"The Tipping Point: How Little Things Can Make a Big Difference","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473396980l/2612._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1473396980l/2612._SX98_.jpg","description":"<i>Alternate cover edition of ISBN 9780316346627.</i><br /><br />From the bestselling author of The Bomber Mafia: discover Malcolm Gladwell's breakthrough debut and explore the science behind viral trends in business, marketing, and human behavior.<br />The tipping point is that magic moment when an idea, trend, or social behavior crosses a threshold, tips, and spreads like wildfire. Just as a single sick person can start an epidemic of the flu, so too can a small but precisely targeted push cause a fashion trend, the popularity of a new product, or a drop in the crime rate. This widely acclaimed bestseller, in which Malcolm Gladwell explores and brilliantly illuminates the tipping point phenomenon, is already changing the way people throughout the world think about selling products and disseminating ideas.","num_pages":301,"authors":{"author":{"id":1439,"name":"Malcolm Gladwell","role":"","image_url":"https://images.gr-assets.com/authors/1564001739p5/1439.jpg","small_image_url":"https://images.gr-assets.com/authors/1564001739p2/1439.jpg","link":"https://www.goodreads.com/author/show/1439.Malcolm_Gladwell","average_rating":4.04,"ratings_count":3144403,"text_reviews_count":130486}},"average_rating":4.01,"ratings_count":851560,"publication_day":"","publication_month":"","publication_year":2002},{"link":"https://www.goodreads.com/book/show/599660.The_Undercover_Economist","title":"The Undercover Economist","title_without_series":"The Undercover Economist","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1383177118l/599660._SX98_.jpg","description":"Who makes most money from the demand for cappuccinos early in the morning at Waterloo Station? Why is it impossible to get a foot on the property ladder? How does the Mafia make money from laundries when street gangs pushing drugs dont? Who really benefits from immigration? How can China, in just fifty years, go from the worlds worst famine to one of the greatest economic revolutions of all time, lifting a million people out of poverty a month?<br /><br />Looking at familiar situations in unfamiliar ways, THE UNDERCOVER ECONOMIST is a fresh explanation of the fundamental principles of the modern economy, illuminated by examples from the streets of London to the booming skyscrapers of Shanghai to the sleepy canals of Bruges. Leaving behind textbook jargon and equations, Tim Harford will reveal the games of signals and negotiations, contests of strength and battles of wit that drive not only the economy at large but the everyday choices we make.","num_pages":278,"authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60509,"text_reviews_count":4325}},"average_rating":3.81,"ratings_count":29400,"publication_day":"","publication_month":"","publication_year":2007},{"link":"https://www.goodreads.com/book/show/19421805-the-undercover-economist-strikes-back","title":"The Undercover Economist Strikes Back: How to Run--or Ruin--an Economy","title_without_series":"The Undercover Economist Strikes Back: How to Run--or Ruin--an Economy","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>A provocative and lively exploration of the increasingly important world of macroeconomics, by the author of the bestselling <i>The Undercover Economist</i>.</b><br /> <br /> Thanks to the worldwide financial upheaval, economics is no longer a topic we can ignore. From politicians to hedge-fund managers to middle-class IRA holders, everyone must pay attention to how and why the global economy works the way it does.<br /> <br /> Enter <i>Financial Times</i> columnist and bestselling author Tim Harford. In this new book that demystifies macroeconomics, Harford strips away the spin, the hype, and the jargon to reveal the truth about how the worlds economy actually works. With the wit of a raconteur and the clear grasp of an expert, Harford explains whats really happening beyond todays headlines, why all of us should care, and what we can do about it to understand it better.<br /> <br />","num_pages":"","authors":{"author":{"id":14442,"name":"Tim Harford","role":"","image_url":"https://images.gr-assets.com/authors/1271375056p5/14442.jpg","small_image_url":"https://images.gr-assets.com/authors/1271375056p2/14442.jpg","link":"https://www.goodreads.com/author/show/14442.Tim_Harford","average_rating":3.89,"ratings_count":60509,"text_reviews_count":4325}},"average_rating":3.92,"ratings_count":3240,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/35631386-the-undoing-project","title":"The Undoing Project: A Friendship That Changed Our Minds","title_without_series":"The Undoing Project: A Friendship That Changed Our Minds","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1509135882l/35631386._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1509135882l/35631386._SX98_.jpg","description":"Brilliant. . . . Lewis has given us a spectacular account of two great men who faced up to uncertainty and the limits of human reason. William Easterly, Wall Street Journal <br /><br />Forty years ago, Israeli psychologists Daniel Kahneman and Amos Tversky wrote a series of breathtakingly original papers that invented the field of behavioral economics. One of the greatest partnerships in the history of science, Kahneman and Tverskys extraordinary friendship incited a revolution in Big Data studies, advanced evidence-based medicine, led to a new approach to government regulation, and made much of Michael Lewiss own work possible. In The Undoing Project, Lewis shows how their Nobel Prizewinning theory of the mind altered our perception of reality.","num_pages":"","authors":{"author":{"id":776,"name":"Michael   Lewis","role":"","image_url":"https://images.gr-assets.com/authors/1317447168p5/776.jpg","small_image_url":"https://images.gr-assets.com/authors/1317447168p2/776.jpg","link":"https://www.goodreads.com/author/show/776.Michael_Lewis","average_rating":4.15,"ratings_count":899964,"text_reviews_count":51864}},"average_rating":3.99,"ratings_count":63709,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/44333183-the-unicorn-project","title":"The Unicorn Project","title_without_series":"The Unicorn Project","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1566877586l/44333183._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1566877586l/44333183._SX98_.jpg","description":"The Phoenix Project wowed over a half-million readers. Now comes the Wall Street Journal Bestselling The Unicorn Project !  The Unicorn Project is amazing, and I loved it 100 times more than The Phoenix Project  FERNANDO CORNAGO, Senior Director Platform Engineering, Adidas Gene Kim does a masterful job of showing how  the efforts of many create lasting business advantages for all. DR. STEVEN SPEAR, author of The High-Velocity Edge, Sr. Lecturer at MIT, and principal of HVE LLC.  The Unicorn Project is so clever, so good, so crazy enlightening! CORNELIA DAVIS, Vice President Of Technology at Pivotal Software, Inc., Author of Cloud Native Patterns This highly anticipated follow-up to the bestselling title The Phoenix Project takes another look at Parts Unlimited, this time from the perspective of software development. In The Unicorn Project , we follow Maxine, a senior lead developer and architect, as she is exiled to the Phoenix Project, to the horror of her friends and colleagues, as punishment for contributing to a payroll outage. She tries to survive in what feels like a heartless and uncaring bureaucracy and to work within a system where no one can get anything done without endless committees, paperwork, and approvals. One day, she is approached by a ragtag bunch of misfits who say they want to overthrow the existing order, to liberate developers, to bring joy back to technology work, and to enable the business to win in a time of digital disruption. To her surprise, she finds herself drawn ever further into this movement, eventually becoming one of the leaders of the Rebellion, which puts her in the crosshairs of some familiar and very dangerous enemies. The Age of Software is here, and another mass extinction event loomsthis is a story about rebel developers and business leaders working together, racing against time to innovate, survive, and thrive in a time of unprecedented uncertainty...and opportunity.  The Unicorn Project provides insanely useful insights on how to improve your technology business. DOMINICA DEGRANDIS, author of Making Work Visible and Director of Digital Transformation at Tasktop  My goal in writing The Unicorn Project was to explore and reveal the necessary but invisible structures required to make developers (and all engineers) productive, and reveal the devastating effects of technical debt and complexity. I hope this book can create common ground for technology and business leaders to leave the past behind, and co-create a better future together.Gene Kim, November 2019","num_pages":"","authors":{"author":{"id":328437,"name":"Gene Kim","role":"","image_url":"https://images.gr-assets.com/authors/1361113444p5/328437.jpg","small_image_url":"https://images.gr-assets.com/authors/1361113444p2/328437.jpg","link":"https://www.goodreads.com/author/show/328437.Gene_Kim","average_rating":4.21,"ratings_count":75935,"text_reviews_count":6131}},"average_rating":4.07,"ratings_count":10037,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/144405196-the-worlds-i-see","title":"The Worlds I See: Curiosity, Exploration, and Discovery at the Dawn of AI","title_without_series":"The Worlds I See: Curiosity, Exploration, and Discovery at the Dawn of AI","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"The moving memoir of a scientist coming of age as an immigrant in America who finds her calling at the forefront of the AI revolution.<br /><br />Wired called Dr. Fei-Fei Li one of a tiny group of scientistsa group perhaps small enough to fit around a kitchen tablewho are responsible for AIs recent remarkable advances.<br /><br />Known to the world as the creator of ImageNet, a key catalyst of modern artificial intelligence, Dr. Li has spent more than two decades at the forefront of the field. But her career in science was improbable from the start. As immigrants, her family faced a difficult transition from Chinas middle class to American poverty. And their lives were made all the harder as they struggled to care for her ailing mother, who was working tirelessly to help them all gain a foothold in their new land.<br /><br />Fei-Feis adolescent knack for physics endured, however, and positioned her to make a crucial contribution to the breakthrough we now call AI, placing her at the center of a global transformation. Over the last decades, her work has brought her face-to-face with the extraordinary possibilitiesand the extraordinary dangersof the technology she loves.<br /><br />The Worlds I See is a story of science in the first person, documenting one of the centurys defining moments from the inside. It provides a riveting story of a scientist at work and a thrillingly clear explanation of what artificial intelligence actually isand how it came to be. Emotionally raw and intellectually uncompromising, this book is a testament not only to the passion required for even the most technical scholarship but also to the curiosity forever at its heart.","num_pages":"","authors":{"author":{"id":6759438,"name":"Fei-Fei Li","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/6759438.Fei_Fei_Li","average_rating":4.32,"ratings_count":4640,"text_reviews_count":603}},"average_rating":4.32,"ratings_count":4637,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/55539565-think-again","title":"Think Again: The Power of Knowing What You Don't Know","title_without_series":"Think Again: The Power of Knowing What You Don't Know","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602574232l/55539565._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1602574232l/55539565._SX98_.jpg","description":"<i>Think Again </i>is a book about the benefit of doubt, and about how we can get better at embracing the unknown and the joy of being wrong. Evidence has shown that creative geniuses are not attached to one identity, but constantly willing to rethink their stances and that leaders who admit they don't know something and seek critical feedback lead more productive and innovative teams.<br /><br />New evidence shows us that as a mindset and a skilllset, rethinking can be taught and Grant explains how to develop the necessary qualities to do it. Section 1 explores why we struggle to think again and how we can learn to do it as individuals, arguing that 'grit' alone can actually be counterproductive. Section 2 discusses how we can help others think again through learning about 'argument literacy'. And the final section 3 looks at how schools, businesses and governments fall short in building cultures that encourage rethinking.<br /><br />In the end, learning to <i>rethink</i> may be the secret skill to give you the edge in a world changing faster than ever.","num_pages":307,"authors":{"author":{"id":6583155,"name":"Adam M. Grant","role":"","image_url":"https://images.gr-assets.com/authors/1638361005p5/6583155.jpg","small_image_url":"https://images.gr-assets.com/authors/1638361005p2/6583155.jpg","link":"https://www.goodreads.com/author/show/6583155.Adam_M_Grant","average_rating":4.04,"ratings_count":343807,"text_reviews_count":23452}},"average_rating":4.13,"ratings_count":142891,"publication_day":2,"publication_month":2,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/17331349-think-like-a-freak","title":"Think Like a Freak","title_without_series":"Think Like a Freak","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395610974l/17331349._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1395610974l/17331349._SX98_.jpg","description":"The New York Times bestselling Freakonomics changed the way we see the world, exposing the hidden side of just about everything. Then came SuperFreakonomics, a documentary film, an award-winning podcast, and more.<br /><br />Now, with Think Like a Freak, Steven D. Levitt and Stephen J. Dubner have written their most revolutionary book yet. With their trademark blend of captivating storytelling and unconventional analysis, they take us inside their thought process and teach us all to think a bit more productively, more creatively, more rationallyto think, that is, like a Freak.<br /><br />Levitt and Dubner offer a blueprint for an entirely new way to solve problems, whether your interest lies in minor lifehacks or major global reforms. As always, no topic is off-limits. They range from business to philanthropy to sports to politics, all with the goal of retraining your brain. Along the way, youll learn the secrets of a Japanese hot-dog-eating champion, the reason an Australian doctor swallowed a batch of dangerous bacteria, and why Nigerian e-mail scammers make a point of saying theyre from Nigeria.<br /><br />Some of the steps toward thinking like a Freak<br /><br />First, put away your moral compassbecause its hard to see a problem clearly if youve already decided what to do about it. Learn to say I dont knowfor until you can admit what you dont yet know, its virtually impossible to learn what you need to. Think like a childbecause youll come up with better ideas and ask better questions. Take a master class in incentivesbecause for better or worse, incentives rule our world. Learn to persuade people who dont want to be persuadedbecause being right is rarely enough to carry the day. Learn to appreciate the upside of quittingbecause you cant solve tomorrows problem if you arent willing to abandon todays dud. Levitt and Dubner plainly see the world like no one else. Now you can too. Never before have such iconoclastic thinkers been so revealingand so much fun to read.","num_pages":293,"authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1101273,"text_reviews_count":30692}},"average_rating":3.86,"ratings_count":56069,"publication_day":12,"publication_month":5,"publication_year":2014},{"link":"https://www.goodreads.com/book/show/35957157-thinking-in-bets","title":"Thinking in Bets: Making Smarter Decisions When You Don't Have All the Facts","title_without_series":"Thinking in Bets: Making Smarter Decisions When You Don't Have All the Facts","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513351600l/35957157._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1513351600l/35957157._SX98_.jpg","description":"In Super Bowl XLIX, Seahawks coach Pete Carroll made one of the most controversial calls in football history: With 26 seconds remaining, and trailing by four at the Patriots' one-yard line, he called for a pass instead of a hand off to his star running back. The pass was intercepted and the Seahawks lost. Critics called it the dumbest play in history. But was the call really that bad? Or did Carroll actually make a great move that was ruined by bad luck?<br /><br />Even the best decision doesn't yield the best outcome every time. There's always an element of luck that you can't control, and there is always information that is hidden from view. So the key to long-term success (and avoiding worrying yourself to death) is to think in bets: How sure am I? What are the possible ways things could turn out? What decision has the highest odds of success? Did I land in the unlucky 10% on the strategy that works 90% of the time? Or is my success attributable to dumb luck rather than great decision making?<br /><br />Annie Duke, a former World Series of Poker champion turned business consultant, draws on examples from business, sports, politics, and (of course) poker to share tools anyone can use to embrace uncertainty and make better decisions. For most people, it's difficult to say \\"I'm not sure\\" in a world that values and, even, rewards the appearance of certainty. But professional poker players are comfortable with the fact that great decisions don't always lead to great outcomes and bad decisions don't always lead to bad outcomes.<br /><br />By shifting your thinking from a need for certainty to a goal of accurately assessing what you know and what you don't, you'll be less vulnerable to reactive emotions, knee-jerk biases, and destructive habits in your decision making. You'll become more confident, calm, compassionate and successful in the long run.","num_pages":"","authors":{"author":{"id":312231,"name":"Annie Duke","role":"","image_url":"https://images.gr-assets.com/authors/1521558804p5/312231.jpg","small_image_url":"https://images.gr-assets.com/authors/1521558804p2/312231.jpg","link":"https://www.goodreads.com/author/show/312231.Annie_Duke","average_rating":3.94,"ratings_count":37728,"text_reviews_count":3890}},"average_rating":3.82,"ratings_count":22783,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/25516595-thinking-fast-and-slow","title":"Thinking, Fast and Slow","title_without_series":"Thinking, Fast and Slow","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1431276290l/25516595._SX98_.jpg","description":"<b>In the highly anticipated <i>Thinking, Fast and Slow</i>, Kahneman takes us on a groundbreaking tour of the mind and explains the two systems that drive the way we think.</b><br /><br />System 1 is fast, intuitive, and emotional; System 2 is slower, more deliberative, and more logical. Kahneman exposes the extraordinary capabilities  and also the faults and biases  of fast thinking, and reveals the pervasive influence of intuitive impressions on our thoughts and behavior. <br /><br />The impact of loss aversion and overconfidence on corporate strategies, the difficulties of predicting what will make us happy in the future, the challenges of properly framing risks at work and at home, the profound effect of cognitive biases on everything from playing the stock market to planning the next vacation  each of these can be understood only by knowing how the two systems work together to shape our judgments and decisions.<br /><br />Engaging the reader in a lively conversation about how we think, Kahneman reveals where we can and cannot trust our intuitions and how we can tap into the benefits of slow thinking. He offers practical and enlightening insights into how choices are made in both our business and our personal lives  and how we can use different techniques to guard against the mental glitches that often get us into trouble. <br /><br /><i>Thinking, Fast and Slow</i> will transform the way you think about thinking.","num_pages":504,"authors":{"author":{"id":72401,"name":"Daniel Kahneman","role":"","image_url":"https://images.gr-assets.com/authors/1615917414p5/72401.jpg","small_image_url":"https://images.gr-assets.com/authors/1615917414p2/72401.jpg","link":"https://www.goodreads.com/author/show/72401.Daniel_Kahneman","average_rating":4.15,"ratings_count":603963,"text_reviews_count":21224}},"average_rating":4.17,"ratings_count":581208,"publication_day":"","publication_month":"","publication_year":2012},{"link":"https://www.goodreads.com/book/show/35510008-this-is-going-to-hurt","title":"This is Going to Hurt: Secret Diaries of a Junior Doctor","title_without_series":"This is Going to Hurt: Secret Diaries of a Junior Doctor","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"Welcome to the life of a junior doctor: 97-hour weeks, life and death decisions, a constant tsunami of bodily fluids, and the hospital parking meter earns more than you.<p>Scribbled in secret after endless days, sleepless nights and missed weekends, Adam Kay's <i>This is Going to Hurt</i> provides a no-holds-barred account of his time on the NHS front line. Hilarious, horrifying and heartbreaking, this diary is everything you wanted to know  and more than a few things you didn't  about life on and off the hospital ward.</p><p>\\n  <b>As seen on ITV's Zoe Ball Book Club </b>\\n</p><p>\\n  <b>This edition includes extra diary entries and a new afterword by the author.</b>\\n</p>","num_pages":285,"authors":{"author":{"id":17160706,"name":"Adam Kay","role":"","image_url":"https://images.gr-assets.com/authors/1594843517p5/17160706.jpg","small_image_url":"https://images.gr-assets.com/authors/1594843517p2/17160706.jpg","link":"https://www.goodreads.com/author/show/17160706.Adam_Kay","average_rating":4.31,"ratings_count":439353,"text_reviews_count":32694}},"average_rating":4.4,"ratings_count":326586,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/40876575-utopia-for-realists","title":"Utopia for Realists: How We Can Build the Ideal World","title_without_series":"Utopia for Realists: How We Can Build the Ideal World","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1618785125l/40876575._SX98_.jpg","description":"<b>Universal basic income. A 15-hour workweek. Open borders. Does it sound too good to be true? One of Europe's leading young thinkers shows how we can build an ideal world today.</b> <br /><br />After working all day at jobs we often dislike, we buy things we don't need. Rutger Bregman, a Dutch historian, reminds us it needn't be this wayand in some places it isn't. Rutger Bregman's TED Talk about universal basic income seemed impossibly radical when he delivered it in 2014. A quarter of a million views later, the subject of that video is being seriously considered by leading economists and government leaders the world over. It's just one of the many utopian ideas that Bregman proves is possible today. <br /><br /><i>Utopia for Realists</i> is one of those rare books that takes you by surprise and challenges what you think can happen. From a Canadian city that once completely eradicated poverty, to Richard Nixon's near implementation of a basic income for millions of Americans, Bregman takes us on a journey through history, and beyond the traditional left-right divides, as he champions ideas whose time have come. <br /><br />Every progressive milestone of civilizationfrom the end of slavery to the beginning of democracywas once considered a utopian fantasy. Bregman's book, both challenging and bracing, demonstrates that new utopian ideas, like the elimination of poverty and the creation of the fifteen-hour workweek, can become a reality in our lifetime. Being unrealistic and unreasonable can in fact make the impossible inevitable, and it is the only way to build the ideal world.","num_pages":262,"authors":{"author":{"id":5781839,"name":"Rutger Bregman","role":"","image_url":"https://images.gr-assets.com/authors/1729169623p5/5781839.jpg","small_image_url":"https://images.gr-assets.com/authors/1729169623p2/5781839.jpg","link":"https://www.goodreads.com/author/show/5781839.Rutger_Bregman","average_rating":4.22,"ratings_count":137733,"text_reviews_count":14039}},"average_rating":4.21,"ratings_count":42631,"publication_day":14,"publication_month":3,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/33805874-welkom-in-nederland","title":"Welkom in Nederland","title_without_series":"Welkom in Nederland","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1483717798l/33805874._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1483717798l/33805874._SX98_.jpg","description":"In Welkom in Nederland maken anderstaligen kennis met de Nederlandse maatschappij en kunnen ze zich voorbereiden op het onderdeel \\" Kennis van de Nederlandse Maatschappij \\" ( KNM ) van het inburgeringsexamen. ook wordt er geofend voor de onderdelen Lezen, Luisteren, Spreken, en Schrijven van het inburgeringsexamen op Niveau A2.","num_pages":236,"authors":{"author":{"id":16183819,"name":"Marilene Gathier","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/16183819.Marilene_Gathier","average_rating":4.13,"ratings_count":54,"text_reviews_count":15}},"average_rating":4.26,"ratings_count":31,"publication_day":"","publication_month":"","publication_year":2015},{"link":"https://www.goodreads.com/book/show/5982818-what-i-talk-about-when-i-talk-about-running","title":"What I Talk About When I Talk About Running","title_without_series":"What I Talk About When I Talk About Running","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"An intimate look at writing, running, and the incredible way they intersect, from the incomparable, bestselling author Haruki Murakami. While simply training for New York City Marathon would be enough for most people, Haruki Murakami's decided to write about it as well. The result is a beautiful memoir about his intertwined obsessions with running and writing, full of vivid memories and insights, including the eureka moment when he decided to become a writer. By turns funny and sobering, playful and philosophical, <b>What I Talk About When I Talk About Running</b><i> </i>is rich and revelatory, both for fans of this masterful yet guardedly private writer and for the exploding population of athletes who find similar satisfaction in athletic pursuit.","num_pages":190,"authors":{"author":{"id":3354,"name":"Haruki Murakami","role":"","image_url":"https://images.gr-assets.com/authors/1615497402p5/3354.jpg","small_image_url":"https://images.gr-assets.com/authors/1615497402p2/3354.jpg","link":"https://www.goodreads.com/author/show/3354.Haruki_Murakami","average_rating":3.93,"ratings_count":4190455,"text_reviews_count":359110}},"average_rating":3.87,"ratings_count":200718,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/60190659-what-if-2","title":"What If? 2: Additional Serious Scientific Answers to Absurd Hypothetical Questions (What If?, #2)","title_without_series":"What If? 2: Additional Serious Scientific Answers to Absurd Hypothetical Questions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1643644004l/60190659._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1643644004l/60190659._SX98_.jpg","description":"The #1 New York Timesbestselling author of What If? and How To provides his best answers yet to the weirdest questions you never thought to ask.<br /><br />The millions of people around the world who read and loved What If? still have questions, and those questions are getting stranger. Thank goodness xkcd creator Randall Munroe is here to help. Planning to ride a fire pole from the moon back to Earth? The hardest part is sticking the landing. Hoping to cool the atmosphere by opening everyones freezer door at the same time? Maybe its time for a brief introduction to thermodynamics. Want to know what would happen if you rode a helicopter blade, built a billion-story building, made a lava lamp out of lava, or jumped on a geyser as it erupted? Okay, if you insist.<br /><br />Before you go on a cosmic road trip, feed the residents of New York City to a T. rex, or fill every church with bananas, be sure to consult this practical guide for impractical ideas. Unfazed by absurdity, Randall consults the latest research on everything from swing-set physics to airplane-catapult design to clearly and concisely answer his readers questions. As he consistently demonstrates, you can learn a lot from examining how the world might work in very specific extreme circumstances.<br /><br />Filled with bonkers science, boundless curiosity, and Randalls signature stick-figure comics, What If? 2 is sure to be another instant classic adored by inquisitive readers of all ages.","num_pages":354,"authors":{"author":{"id":3089156,"name":"Randall Munroe","role":"","image_url":"https://images.gr-assets.com/authors/1406058780p5/3089156.jpg","small_image_url":"https://images.gr-assets.com/authors/1406058780p2/3089156.jpg","link":"https://www.goodreads.com/author/show/3089156.Randall_Munroe","average_rating":4.16,"ratings_count":254381,"text_reviews_count":17616}},"average_rating":4.37,"ratings_count":17031,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/21413662-what-if","title":"What If?: Serious Scientific Answers to Absurd Hypothetical Questions","title_without_series":"What If?: Serious Scientific Answers to Absurd Hypothetical Questions","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1451351509l/21413662._SX50_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1451351509l/21413662._SX98_.jpg","description":"Fans of the <i>xkcd</i> comic ask Munroe a lot of strange questions: What if you tried to hit a baseball pitched at 90 percent the speed of light? How fast can you hit a speed bump while driving and live? If there was a robot apocalypse, how long would humanity last? What if everyone only had one soulmate? What would happen if the moon went away?<br /><br />In pursuit of answers, Munroe runs computer simulations, pores over stacks of declassified military research memos, solves differential equations, and consults with nuclear reactor operators. His responses are masterpieces of clarity and hilarity, complemented by his signature <i>xkcd</i> comics. (They often predict the complete annihilation of humankind, or at least a really big explosion.)<br /><br />In celebration of 10 years of unusual insight, Randall Munroe has revised his classic blockbuster to ask what if? x 10. The result is 10x the adventure of scientific inquiry. Featuring brand-new 2-color annotations and illustrations, this special anniversary edition is far more than a book for geeks, <i>What If?</i> explains the laws of science in operation in a way that every intelligent reader will enjoy and feel much smarter for having read.","num_pages":303,"authors":{"author":{"id":3089156,"name":"Randall Munroe","role":"","image_url":"https://images.gr-assets.com/authors/1406058780p5/3089156.jpg","small_image_url":"https://images.gr-assets.com/authors/1406058780p2/3089156.jpg","link":"https://www.goodreads.com/author/show/3089156.Randall_Munroe","average_rating":4.16,"ratings_count":254381,"text_reviews_count":17616}},"average_rating":4.14,"ratings_count":194472,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/26198872-when-to-rob-a-bank","title":"When to Rob a Bank: ...And 131 More Warped Suggestions and Well-Intended Rants","title_without_series":"When to Rob a Bank: ...And 131 More Warped Suggestions and Well-Intended Rants","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459112898l/26198872._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1459112898l/26198872._SX98_.jpg","description":"In celebration of the 10th anniversary of the landmark book <em>Freakonomics </em>comes this curated collection from the most readable economics blog in the universe. Its the perfect solution for the millions of readers who love all things Freakonomics. Surprising and erudite, eloquent and witty,<em>When to Rob a Bank </em>demonstrates the brilliance that has made the Freakonomics guys an international sensation, with more than 7 million books sold in 40 languages, and 150 million downloads of their Freakonomics Radio podcast.","num_pages":"","authors":{"author":{"id":798,"name":"Steven D. Levitt","role":"","image_url":"https://images.gr-assets.com/authors/1215370905p5/798.jpg","small_image_url":"https://images.gr-assets.com/authors/1215370905p2/798.jpg","link":"https://www.goodreads.com/author/show/798.Steven_D_Levitt","average_rating":4,"ratings_count":1101273,"text_reviews_count":30692}},"average_rating":3.53,"ratings_count":15006,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/50887097-why-fish-don-t-exist","title":"Why Fish Dont Exist: A Story of Loss, Love, and the Hidden Order of Life","title_without_series":"Why Fish Dont Exist: A Story of Loss, Love, and the Hidden Order of Life","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b>A wondrous debut from an extraordinary new voice in nonfiction, <i>Why Fish Dont Exist</i> is a dark and astonishing tale of love, chaos, scientific obsession, andpossiblyeven murder. </b><br /><br />David Starr Jordan was a taxonomist, a man possessed with bringing order to the natural world. In time, he would be credited with discovering nearly a <i>fifth</i> of the fish known to humans in his day. But the more of the hidden blueprint of life he uncovered, the harder the universe seemed to try to thwart him. His specimen collections were demolished by lightning, by fire, and eventually by the 1906 San Francisco earthquakewhich sent more than a thousand of his discoveries, housed in fragile glass jars, plummeting to the floor. In an instant, his lifes work was shattered.<br /> <br />Many might have given up, given in to despair. But Jordan? He surveyed the wreckage at his feet, found the first fish he recognized, and confidently began to rebuild his collection. And this time, he introduced one clever innovation that he believed would at last protect his work against the chaos of the world.<br /> <br />When NPR reporter Lulu Miller first heard this anecdote in passing, she took Jordan for a fool<b></b>a cautionary tale in hubris, or denial. But as her own life slowly unraveled, she began to wonder about him. Perhaps instead he was a model for how to go on when all seemed lost. What she would unearth about his life would transform her understanding of history, morality, and the world beneath her feet.<br /> <br />Part biography, part memoir, part scientific adventure, <i>Why Fish Dont Exist </i>reads like a fable about how to persevere in a world where chaos will always prevail.","num_pages":225,"authors":{"author":{"id":17168922,"name":"Lulu Miller","role":"","image_url":"https://images.gr-assets.com/authors/1603902452p5/17168922.jpg","small_image_url":"https://images.gr-assets.com/authors/1603902452p2/17168922.jpg","link":"https://www.goodreads.com/author/show/17168922.Lulu_Miller","average_rating":4.13,"ratings_count":55354,"text_reviews_count":8856}},"average_rating":4.14,"ratings_count":54852,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/12158480-why-nations-fail","title":"Why Nations Fail: The Origins of Power, Prosperity, and Poverty","title_without_series":"Why Nations Fail: The Origins of Power, Prosperity, and Poverty","small_image_url":"https://s.gr-assets.com/assets/nophoto/book/50x75-a91bf249278a81aabab721ef782c4a74.png","image_url":"https://s.gr-assets.com/assets/nophoto/book/111x148-bcc042a9c91a29c1d680899eff700a03.png","description":"<b><i>Brilliant and engagingly written,</i> Why Nations Fail <i>answers the question that has stumped the experts for centuries: Why are some nations rich and others poor, divided by wealth and poverty, health and sickness, food and famine? <br /><br /></i></b>Is it culture, the weather, geography? Perhaps ignorance of what the right policies are? <br /><br />Simply, no. None of these factors is either definitive or destiny. Otherwise, how to explain why Botswana has become one of the fastest growing countries in the world, while other African nations, such as Zimbabwe, the Congo, and Sierra Leone, are mired in poverty and violence? <br /><br />Daron Acemoglu and James Robinson conclusively show that it is man-made political and economic institutions that underlie economic success (or lack of it). Korea, to take just one of their fascinating examples, is a remarkably homogeneous nation, yet the people of North Korea are among the poorest on earth while their brothers and sisters in South Korea are among the richest. The south forged a society that created incentives, rewarded innovation, and allowed everyone to participate in economic opportunities. The economic success thus spurred was sustained because the government became accountable and responsive to citizens and the great mass of people. Sadly, the people of the north have endured decades of famine, political repression, and very different economic institutionswith no end in sight. The differences between the Koreas is due to the politics that created these completely different institutional trajectories. <br /><br />Based on fifteen years of original research Acemoglu and Robinson marshall extraordinary historical evidence from the Roman Empire, the Mayan city-states, medieval Venice, the Soviet Union, Latin America, England, Europe, the United States, and Africa to build a new theory of political economy with great relevance for the big questions of today, including: <br /><br /> - China has built an authoritarian growth machine. Will it continue to grow at such high speed andoverwhelm the West? <br /> - Are Americas best days behind it? Are we moving from a virtuous circle in which efforts by elites to aggrandize power are resisted to a vicious one that enriches and empowers a small minority? <br /> - What is the most effective way to help move billions of people from the rut of poverty to prosperity? More <br />philanthropy from the wealthy nations of the West? Or learning the hard-won lessons of Acemoglu and Robinsons breakthrough ideas on the interplay between inclusive political and economic institutions? <br /><br /><i>Why Nations Fail </i>will change the way you look atand understandthe world.","num_pages":529,"authors":{"author":{"id":12817,"name":"Daron Acemolu","role":"","image_url":"https://images.gr-assets.com/authors/1354435300p5/12817.jpg","small_image_url":"https://images.gr-assets.com/authors/1354435300p2/12817.jpg","link":"https://www.goodreads.com/author/show/12817.Daron_Acemo_lu","average_rating":4.09,"ratings_count":68570,"text_reviews_count":6527}},"average_rating":4.09,"ratings_count":61939,"publication_day":"","publication_month":"","publication_year":""},{"link":"https://www.goodreads.com/book/show/34466963-why-we-sleep","title":"Why We Sleep: Unlocking the Power of Sleep and Dreams","title_without_series":"Why We Sleep: Unlocking the Power of Sleep and Dreams","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1556604137l/34466963._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1556604137l/34466963._SX98_.jpg","description":"<i>Alternate cover edition of <a href=\\"https://www.goodreads.com/book/show/40781394-why-we-sleep\\" rel=\\"nofollow noopener\\">ISBN 9781501144318</a>.</i><br /><br />Neuroscientist and sleep expert Matthew Walker provides a revolutionary exploration of sleep, examining how it affects every aspect of our physical and mental well-being. Charting the most cutting-edge scientific breakthroughs, and marshalling his decades of research and clinical practice, Walker explains how we can harness sleep to improve learning, mood and energy levels, regulate hormones, prevent cancer, Alzheimer's and diabetes, slow the effects of aging, and increase longevity. He also provides actionable steps towards getting a better night's sleep every night.","num_pages":368,"authors":{"author":{"id":17598726,"name":"Matthew Walker","role":"","image_url":"https://images.gr-assets.com/authors/1537277808p5/17598726.jpg","small_image_url":"https://images.gr-assets.com/authors/1537277808p2/17598726.jpg","link":"https://www.goodreads.com/author/show/17598726.Matthew_Walker","average_rating":4.37,"ratings_count":221259,"text_reviews_count":21908}},"average_rating":4.37,"ratings_count":223438,"publication_day":3,"publication_month":10,"publication_year":2017},{"link":"https://www.goodreads.com/book/show/44678031-yearbook","title":"Yearbook","title_without_series":"Yearbook","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1617146646l/44678031._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1617146646l/44678031._SX98_.jpg","description":"Hi! Im Seth! I was asked to describe my book, Yearbook, for the inside flap (which is a gross phrase) and for websites and shit like that, so here it goes!!!<br /> <br />Yearbook is a collection of true stories that I desperately hope are just funny at worst, and life-changingly amazing at best. (I understand that its likely the former, which is a fancy book way of saying the first one.) <br /> <br />I talk about my grandparents, doing stand-up comedy as a teenager, bar mitzvahs, and Jewish summer camp, and tell way more stories about doing drugs than my mother would like. I also talk about some of my adventures in Los Angeles, and surely say things about other famous people that will create a wildly awkward conversation for me at a party one day.<br /> <br />I hope you enjoy the book should you buy it, and if you dont enjoy it, Im sorry. If you ever see me on the street and explain the situation, Ill do my best to make it up to you.","num_pages":260,"authors":{"author":{"id":1307435,"name":"Seth Rogen","role":"","image_url":"https://images.gr-assets.com/authors/1614010346p5/1307435.jpg","small_image_url":"https://images.gr-assets.com/authors/1614010346p2/1307435.jpg","link":"https://www.goodreads.com/author/show/1307435.Seth_Rogen","average_rating":4.15,"ratings_count":79222,"text_reviews_count":9375}},"average_rating":4.15,"ratings_count":81516,"publication_day":11,"publication_month":5,"publication_year":2021},{"link":"https://www.goodreads.com/book/show/18050143-zero-to-one","title":"Zero to One: Notes on Startups, or How to Build the Future","title_without_series":"Zero to One: Notes on Startups, or How to Build the Future","small_image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630663027l/18050143._SY75_.jpg","image_url":"https://i.gr-assets.com/images/S/compressed.photo.goodreads.com/books/1630663027l/18050143._SX98_.jpg","description":"If you want to build a better future, you must believe in secrets.<br /><br />The great secret of our time is that there are still uncharted frontiers to explore and new inventions to create. In Zero to One, legendary entrepreneur and investor Peter Thiel shows how we can find singular ways to create those new things. <br /><br />Thiel begins with the contrarian premise that we live in an age of technological stagnation, even if were too distracted by shiny mobile devices to notice. Information technology has improved rapidly, but there is no reason why progress should be limited to computers or Silicon Valley. Progress can be achieved in any industry or area of business. It comes from the most important skill that every leader must master: learning to think for yourself.<br /><br />Doing what someone else already knows how to do takes the world from 1 to n, adding more of something familiar. But when you do something new, you go from 0 to 1. The next Bill Gates will not build an operating system. The next Larry Page or Sergey Brin wont make a search engine. Tomorrows champions will not win by competing ruthlessly in todays marketplace. They will escape competition altogether, because their businesses will be unique. <br /><br />Zero to One presents at once an optimistic view of the future of progress in America and a new way of thinking about innovation: it starts by learning to ask the questions that lead you to find value in unexpected places.","num_pages":195,"authors":{"author":{"id":8474721,"name":"Peter Thiel","role":"","image_url":"https://s.gr-assets.com/assets/nophoto/user/u_200x266-e183445fd1a1b5cc7075bb1cf7043306.png","small_image_url":"https://s.gr-assets.com/assets/nophoto/user/u_50x66-632230dc9882b4352d753eedf9396530.png","link":"https://www.goodreads.com/author/show/8474721.Peter_Thiel","average_rating":4.15,"ratings_count":397874,"text_reviews_count":10254}},"average_rating":4.15,"ratings_count":394483,"publication_day":"","publication_month":"","publication_year":""}]`),rJ=()=>Q.jsx("div",{className:"suspenseFallback",children:"Loading..."}),iJ={backgroundColor:"#eee",cursor:"pointer",overflow:"hidden",position:"relative",width:"100%",height:"100%"},oJ={transition:"transform .135s cubic-bezier(0.0,0.0,0.2,1),opacity linear .15s",display:"block",width:"100%",height:"100%"},aJ=({imageProps:r,wrapperStyle:e,onClick:t})=>Q.jsx("div",{style:{...iJ,...e},className:"lazy-image",onClick:t,children:Q.jsx(dC,{offset:200,once:!0,children:Q.jsx("img",{...r,style:{...oJ,...r?.style||{}},alt:r?.alt||""})})}),sJ=Ke.lazy(()=>aK(()=>import("./index-CWysEOdw.js"),[])),uJ=()=>{const[r,e]=Ke.useState(!1),[t,n]=Ke.useState(0),[i,o]=Ke.useState(window.outerWidth),a=()=>{o(window.outerWidth)};Ke.useEffect(()=>(window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)),[]);const s=f=>{e(!0),n(f)},u=()=>{const f=document.getElementById("root");f&&(f.style.filter="blur(5px)")},l=()=>{const f=document.getElementById("root");f&&(f.style.filter="blur(0px)"),e(!1)},c=()=>i>=959?6:i>=768?5:i>=480?4:i>=240?3:2,h=f=>f===0?Q.jsx(Ke.Suspense,{fallback:Q.jsx(rJ,{}),children:Q.jsx("div",{className:"bookShelf",children:Q.jsx(sJ,{books:nJ,margin:10,columns:c()+1})})}):null;return Q.jsxs("div",{children:[Q.jsx(eJ,{layout:"masonry",photos:tJ.map((f,m)=>({...f,src:f.image_url.replace(/_SX98_./g,""),width:98,height:148,alt:f.title,key:m.toString()})),onClick:({photo:f})=>{console.log(f),window.open(f.link,"_blank")},columns:c(),spacing:10,render:{image:f=>Q.jsx(aJ,{imageProps:f})}}),Q.jsxs("div",{className:"bookActions",children:[Q.jsxs("span",{className:"books_link",onClick:()=>s(0),children:[Q.jsx(V2,{})," More Books"]}),Q.jsxs("span",{className:"books_link",onClick:()=>window.open("https://gre.abhishek.pro.np/user/88517742/viz/rgraph","_blank"),children:[Q.jsx(V2,{})," Explore Books"]})]}),Q.jsx(vK,{isOpen:r,onAfterOpen:u,onRequestClose:l,className:"booksModal",overlayClassName:"ModalOverlay",contentLabel:"Books",ariaHideApp:!1,children:Q.jsx("div",{className:"bookModalContent",children:h(t)})})]})},lJ=()=>Q.jsx(zi.Fragment,{children:Q.jsxs("section",{className:"row interests",id:"interests",children:[Q.jsx("div",{className:"col-md-12 title",children:Q.jsxs("h2",{children:[Q.jsx(GI,{})," / Interests"]})}),Q.jsx("div",{className:"col-md-12",children:Q.jsx("div",{className:"content",children:Q.jsxs("div",{className:"row",children:[Q.jsxs("div",{className:"col-md-12",children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsxs("h3",{children:[Q.jsx(zI,{})," Books"]}),Q.jsx("p",{children:"Some of my favorite books:"})]}),Q.jsx(uJ,{})]}),Q.jsx("div",{className:"col-md-12",children:Q.jsx("div",{className:"divider",children:Q.jsx("span",{children:Q.jsx(Jp,{})})})})]})})})]})}),cJ="/assets/CCP-CpRSmDsF.png",hJ="/assets/CDVA-Djr2m9mK.png",dJ="/assets/CSAA-CfqLXySg.png",fJ="/assets/CSOA-D2_fgxH1.png",pJ={"CCP.png":cJ,"CDVA.png":hJ,"CSAA.png":dJ,"CSOA.png":fJ},mJ=(r,e)=>{const t=r.slice(),n=[];for(;t.length;)n.push(t.splice(0,e));return n},gJ=({certifications:r})=>{const e=mJ(r,3);return Q.jsxs("div",{children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsx("h3",{children:"Certifications"}),Q.jsx("p",{children:"Officially certified in"})]}),Q.jsx("div",{className:"inner-content certifications",children:e.map((t,n)=>Q.jsx("div",{className:"row",style:{marginBottom:0},children:t.map((i,o)=>Q.jsx("div",{className:`col-md-${12/t.length} certification`,children:Q.jsx("a",{href:i.url,target:"_blank",rel:"noopener noreferrer",children:Q.jsx("img",{src:pJ[i.image]||"",alt:i.title})})},o))},n))})]})},vJ=({data:r})=>{const{institution:e,startDate:t,endDate:n,studyType:i,area:o}=r,a=s=>s.split("-")[0];return Q.jsx("div",{className:"col-md-6",children:Q.jsxs("div",{className:"work-item",children:[Q.jsx(HI,{}),Q.jsxs("div",{className:"work-desc",children:[Q.jsx("h4",{children:e}),Q.jsxs("h6",{children:[a(t)," - ",a(n)]}),Q.jsxs("p",{children:[i," : ",o]})]})]})})},yJ=(r,e)=>{const t=r.slice(),n=[];for(;t.length;)n.push(t.splice(0,e));return n},bJ=({institutions:r})=>{const e=yJ(r,2);return Q.jsxs("div",{children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsx("h3",{children:"My Education"}),Q.jsx("p",{children:"The studies which partially made the developer that I am now."})]}),Q.jsx("div",{className:"inner-content",children:e.map((t,n)=>Q.jsx("div",{className:"row",children:t.map((i,o)=>Q.jsx(vJ,{data:i},o))},n))})]})},wJ=({data:r,index:e})=>{const{title:t,description:n,url:i,github:o,image:a,tags:s}=r;return Q.jsxs("div",{className:"project-card","data-index":e,children:[Q.jsx("div",{className:"project-image-container",children:Q.jsx("div",{className:"project-image-placeholder",children:a?Q.jsxs(Q.Fragment,{children:[Q.jsx("img",{src:a,alt:t,className:"project-image"}),Q.jsx("div",{className:"project-image-overlay-with-image"})]}):Q.jsx("div",{className:"project-image-overlay",children:Q.jsxs("span",{className:"project-number",children:["0",e+1]})})})}),Q.jsxs("div",{className:"project-content",children:[Q.jsxs("div",{className:"project-header",children:[Q.jsx("h3",{className:"project-title",children:t}),Q.jsxs("div",{className:"project-links",children:[o&&Q.jsx("a",{href:o,target:"_blank",rel:"noopener noreferrer",className:"project-link","aria-label":"View on GitHub",children:Q.jsx(BI,{})}),Q.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"project-link","aria-label":"Visit project",children:Q.jsx(WI,{})})]})]}),Q.jsx("p",{className:"project-description",children:n}),Q.jsx("div",{className:"project-tags",children:s.map((u,l)=>Q.jsx("span",{className:"project-tag",children:u},l))})]})]})},_J=({projects:r})=>Q.jsxs("div",{className:"projects-section",children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsx("h3",{children:"Personal Projects"}),Q.jsx("p",{children:"Passion projects that solve real-world problems and push boundaries."})]}),Q.jsx("div",{className:"inner-content",children:Q.jsx("div",{className:"projects-grid",children:r.map((e,t)=>Q.jsx(wJ,{data:e,index:t},t))})})]}),xJ=({children:r,className:e=""})=>Q.jsx("div",{className:`vertical-timeline ${e}`,children:r}),SJ=({children:r,className:e=""})=>Q.jsx("div",{className:`vertical-timeline-element ${e}`,children:Q.jsx("div",{className:"vertical-timeline-element-content",children:r})}),EJ=({data:r})=>{const{company:e,startDate:t,endDate:n,position:i,summary:o,website:a}=r;return Q.jsx(SJ,{iconStyle:{display:"none"},children:Q.jsxs("div",{className:"work-item",children:[Q.jsx("div",{className:"work-ico",children:Q.jsx(cC,{})}),Q.jsxs("div",{className:"work-desc",children:[Q.jsx("h4",{children:Q.jsx("a",{href:a,className:"no-underline",children:e})}),Q.jsx("h5",{children:i}),Q.jsxs("h6",{children:[t," - ",n]}),Q.jsx("p",{children:o})]})]})})},kJ=({companies:r})=>Q.jsxs("div",{children:[Q.jsxs("div",{className:"inner-title",children:[Q.jsx("h3",{children:"My Experiences"}),Q.jsx("p",{children:"What I did in the past and what I am doing now."})]}),Q.jsx("div",{className:"inner-content",children:Q.jsx(xJ,{children:r.map((e,t)=>Q.jsx(EJ,{data:e},t))})})]}),CJ=({education:r,work:e,certifications:t,projects:n})=>Q.jsx(zi.Fragment,{children:Q.jsxs("section",{className:"row resume",id:"resume",children:[Q.jsx("div",{className:"col-md-12 title",children:Q.jsxs("h2",{children:[Q.jsx(cC,{})," / Resume"]})}),Q.jsx("div",{className:"col-md-12",children:Q.jsxs("div",{className:"content",children:[n&&n.length>0&&Q.jsxs(Q.Fragment,{children:[Q.jsx("div",{className:"divider"}),Q.jsx(_J,{projects:n})]}),Q.jsx("div",{className:"divider",children:Q.jsx("span",{children:Q.jsx(Jp,{})})}),Q.jsx(kJ,{companies:e}),Q.jsx("div",{className:"divider",children:Q.jsx("span",{children:Q.jsx(Jp,{})})}),t&&Q.jsx(gJ,{certifications:t}),Q.jsx("div",{className:"divider",children:Q.jsx("span",{children:Q.jsx(Jp,{})})}),Q.jsx(bJ,{institutions:r})]})})]})}),TJ="https://ptdwwoy2xc.execute-api.us-east-1.amazonaws.com/prod/quotes/random";aC.initialize("UA-76263604-1",{testMode:!1});const MJ=()=>{const[r,e]=Ke.useState({quote:"People who are really serious about software should make their own hardware",author:"Alan Kay"});Ke.useEffect(()=>{aC.send({hitType:"pageview",page:window.location.pathname+window.location.search}),(async()=>{try{const c=await(await fetch(TJ)).json();c&&c.quote&&c.author&&e(c)}catch(l){console.error("Error fetching quote:",l)}})()},[]);const{basics:t,education:n,work:i,interests:o,certifications:a,projects:s}=_I;return Q.jsxs("div",{className:"App",children:[Q.jsx(rK,{name:t.name}),Q.jsx(iD,{data:t}),Q.jsx(CJ,{education:n,work:i,certifications:a,projects:s}),Q.jsx(lJ,{data:o}),Q.jsx(CD,{email:t.email}),Q.jsx(oD,{quote:r})]})},iC=document.getElementById("root");iC&&lI.createRoot(iC).render(Q.jsx(MJ,{}));export{aJ as L,eJ as P,Q as j};
